function cee(e,t){for(var r=0;r<t.length;r++){const n=t[r];if(typeof n!="string"&&!Array.isArray(n)){for(const a in n)if(a!=="default"&&!(a in e)){const i=Object.getOwnPropertyDescriptor(n,a);i&&Object.defineProperty(e,a,i.get?i:{enumerable:!0,get:()=>n[a]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function r(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerpolicy&&(i.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?i.credentials="include":a.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(a){if(a.ep)return;a.ep=!0;const i=r(a);fetch(a.href,i)}})();var qg=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function dee(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var ke={exports:{}},an={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Y1=Symbol.for("react.element"),fee=Symbol.for("react.portal"),pee=Symbol.for("react.fragment"),hee=Symbol.for("react.strict_mode"),mee=Symbol.for("react.profiler"),vee=Symbol.for("react.provider"),gee=Symbol.for("react.context"),yee=Symbol.for("react.forward_ref"),bee=Symbol.for("react.suspense"),xee=Symbol.for("react.memo"),See=Symbol.for("react.lazy"),b6=Symbol.iterator;function Cee(e){return e===null||typeof e!="object"?null:(e=b6&&e[b6]||e["@@iterator"],typeof e=="function"?e:null)}var nU={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},aU=Object.assign,iU={};function T0(e,t,r){this.props=e,this.context=t,this.refs=iU,this.updater=r||nU}T0.prototype.isReactComponent={};T0.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};T0.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function oU(){}oU.prototype=T0.prototype;function KI(e,t,r){this.props=e,this.context=t,this.refs=iU,this.updater=r||nU}var $I=KI.prototype=new oU;$I.constructor=KI;aU($I,T0.prototype);$I.isPureReactComponent=!0;var x6=Array.isArray,sU=Object.prototype.hasOwnProperty,QI={current:null},uU={key:!0,ref:!0,__self:!0,__source:!0};function lU(e,t,r){var n,a={},i=null,o=null;if(t!=null)for(n in t.ref!==void 0&&(o=t.ref),t.key!==void 0&&(i=""+t.key),t)sU.call(t,n)&&!uU.hasOwnProperty(n)&&(a[n]=t[n]);var s=arguments.length-2;if(s===1)a.children=r;else if(1<s){for(var u=Array(s),l=0;l<s;l++)u[l]=arguments[l+2];a.children=u}if(e&&e.defaultProps)for(n in s=e.defaultProps,s)a[n]===void 0&&(a[n]=s[n]);return{$$typeof:Y1,type:e,key:i,ref:o,props:a,_owner:QI.current}}function wee(e,t){return{$$typeof:Y1,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function ZI(e){return typeof e=="object"&&e!==null&&e.$$typeof===Y1}function _ee(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(r){return t[r]})}var S6=/\/+/g;function a4(e,t){return typeof e=="object"&&e!==null&&e.key!=null?_ee(""+e.key):t.toString(36)}function Bx(e,t,r,n,a){var i=typeof e;(i==="undefined"||i==="boolean")&&(e=null);var o=!1;if(e===null)o=!0;else switch(i){case"string":case"number":o=!0;break;case"object":switch(e.$$typeof){case Y1:case fee:o=!0}}if(o)return o=e,a=a(o),e=n===""?"."+a4(o,0):n,x6(a)?(r="",e!=null&&(r=e.replace(S6,"$&/")+"/"),Bx(a,t,r,"",function(l){return l})):a!=null&&(ZI(a)&&(a=wee(a,r+(!a.key||o&&o.key===a.key?"":(""+a.key).replace(S6,"$&/")+"/")+e)),t.push(a)),1;if(o=0,n=n===""?".":n+":",x6(e))for(var s=0;s<e.length;s++){i=e[s];var u=n+a4(i,s);o+=Bx(i,t,r,u,a)}else if(u=Cee(e),typeof u=="function")for(e=u.call(e),s=0;!(i=e.next()).done;)i=i.value,u=n+a4(i,s++),o+=Bx(i,t,r,u,a);else if(i==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return o}function t2(e,t,r){if(e==null)return e;var n=[],a=0;return Bx(e,n,"","",function(i){return t.call(r,i,a++)}),n}function Aee(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(r){(e._status===0||e._status===-1)&&(e._status=1,e._result=r)},function(r){(e._status===0||e._status===-1)&&(e._status=2,e._result=r)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var So={current:null},Fx={transition:null},Tee={ReactCurrentDispatcher:So,ReactCurrentBatchConfig:Fx,ReactCurrentOwner:QI};an.Children={map:t2,forEach:function(e,t,r){t2(e,function(){t.apply(this,arguments)},r)},count:function(e){var t=0;return t2(e,function(){t++}),t},toArray:function(e){return t2(e,function(t){return t})||[]},only:function(e){if(!ZI(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};an.Component=T0;an.Fragment=pee;an.Profiler=mee;an.PureComponent=KI;an.StrictMode=hee;an.Suspense=bee;an.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Tee;an.cloneElement=function(e,t,r){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var n=aU({},e.props),a=e.key,i=e.ref,o=e._owner;if(t!=null){if(t.ref!==void 0&&(i=t.ref,o=QI.current),t.key!==void 0&&(a=""+t.key),e.type&&e.type.defaultProps)var s=e.type.defaultProps;for(u in t)sU.call(t,u)&&!uU.hasOwnProperty(u)&&(n[u]=t[u]===void 0&&s!==void 0?s[u]:t[u])}var u=arguments.length-2;if(u===1)n.children=r;else if(1<u){s=Array(u);for(var l=0;l<u;l++)s[l]=arguments[l+2];n.children=s}return{$$typeof:Y1,type:e.type,key:a,ref:i,props:n,_owner:o}};an.createContext=function(e){return e={$$typeof:gee,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:vee,_context:e},e.Consumer=e};an.createElement=lU;an.createFactory=function(e){var t=lU.bind(null,e);return t.type=e,t};an.createRef=function(){return{current:null}};an.forwardRef=function(e){return{$$typeof:yee,render:e}};an.isValidElement=ZI;an.lazy=function(e){return{$$typeof:See,_payload:{_status:-1,_result:e},_init:Aee}};an.memo=function(e,t){return{$$typeof:xee,type:e,compare:t===void 0?null:t}};an.startTransition=function(e){var t=Fx.transition;Fx.transition={};try{e()}finally{Fx.transition=t}};an.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};an.useCallback=function(e,t){return So.current.useCallback(e,t)};an.useContext=function(e){return So.current.useContext(e)};an.useDebugValue=function(){};an.useDeferredValue=function(e){return So.current.useDeferredValue(e)};an.useEffect=function(e,t){return So.current.useEffect(e,t)};an.useId=function(){return So.current.useId()};an.useImperativeHandle=function(e,t,r){return So.current.useImperativeHandle(e,t,r)};an.useInsertionEffect=function(e,t){return So.current.useInsertionEffect(e,t)};an.useLayoutEffect=function(e,t){return So.current.useLayoutEffect(e,t)};an.useMemo=function(e,t){return So.current.useMemo(e,t)};an.useReducer=function(e,t,r){return So.current.useReducer(e,t,r)};an.useRef=function(e){return So.current.useRef(e)};an.useState=function(e){return So.current.useState(e)};an.useSyncExternalStore=function(e,t,r){return So.current.useSyncExternalStore(e,t,r)};an.useTransition=function(){return So.current.useTransition()};an.version="18.2.0";(function(e){e.exports=an})(ke);const sa=dee(ke.exports),C6=cee({__proto__:null,default:sa},[ke.exports]);var K1={exports:{}},Ts={},cU={exports:{}},dU={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(q,W){var V=q.length;q.push(W);e:for(;0<V;){var ee=V-1>>>1,ue=q[ee];if(0<a(ue,W))q[ee]=W,q[V]=ue,V=ee;else break e}}function r(q){return q.length===0?null:q[0]}function n(q){if(q.length===0)return null;var W=q[0],V=q.pop();if(V!==W){q[0]=V;e:for(var ee=0,ue=q.length,$=ue>>>1;ee<$;){var Q=2*(ee+1)-1,R=q[Q],Y=Q+1,re=q[Y];if(0>a(R,V))Y<ue&&0>a(re,R)?(q[ee]=re,q[Y]=V,ee=Y):(q[ee]=R,q[Q]=V,ee=Q);else if(Y<ue&&0>a(re,V))q[ee]=re,q[Y]=V,ee=Y;else break e}}return W}function a(q,W){var V=q.sortIndex-W.sortIndex;return V!==0?V:q.id-W.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;e.unstable_now=function(){return i.now()}}else{var o=Date,s=o.now();e.unstable_now=function(){return o.now()-s}}var u=[],l=[],c=1,d=null,f=3,p=!1,h=!1,m=!1,v=typeof setTimeout=="function"?setTimeout:null,g=typeof clearTimeout=="function"?clearTimeout:null,y=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function b(q){for(var W=r(l);W!==null;){if(W.callback===null)n(l);else if(W.startTime<=q)n(l),W.sortIndex=W.expirationTime,t(u,W);else break;W=r(l)}}function S(q){if(m=!1,b(q),!h)if(r(u)!==null)h=!0,j(x);else{var W=r(l);W!==null&&te(S,W.startTime-q)}}function x(q,W){h=!1,m&&(m=!1,g(_),_=-1),p=!0;var V=f;try{for(b(W),d=r(u);d!==null&&(!(d.expirationTime>W)||q&&!D());){var ee=d.callback;if(typeof ee=="function"){d.callback=null,f=d.priorityLevel;var ue=ee(d.expirationTime<=W);W=e.unstable_now(),typeof ue=="function"?d.callback=ue:d===r(u)&&n(u),b(W)}else n(u);d=r(u)}if(d!==null)var $=!0;else{var Q=r(l);Q!==null&&te(S,Q.startTime-W),$=!1}return $}finally{d=null,f=V,p=!1}}var C=!1,w=null,_=-1,E=5,P=-1;function D(){return!(e.unstable_now()-P<E)}function k(){if(w!==null){var q=e.unstable_now();P=q;var W=!0;try{W=w(!0,q)}finally{W?F():(C=!1,w=null)}}else C=!1}var F;if(typeof y=="function")F=function(){y(k)};else if(typeof MessageChannel<"u"){var X=new MessageChannel,U=X.port2;X.port1.onmessage=k,F=function(){U.postMessage(null)}}else F=function(){v(k,0)};function j(q){w=q,C||(C=!0,F())}function te(q,W){_=v(function(){q(e.unstable_now())},W)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(q){q.callback=null},e.unstable_continueExecution=function(){h||p||(h=!0,j(x))},e.unstable_forceFrameRate=function(q){0>q||125<q?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):E=0<q?Math.floor(1e3/q):5},e.unstable_getCurrentPriorityLevel=function(){return f},e.unstable_getFirstCallbackNode=function(){return r(u)},e.unstable_next=function(q){switch(f){case 1:case 2:case 3:var W=3;break;default:W=f}var V=f;f=W;try{return q()}finally{f=V}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(q,W){switch(q){case 1:case 2:case 3:case 4:case 5:break;default:q=3}var V=f;f=q;try{return W()}finally{f=V}},e.unstable_scheduleCallback=function(q,W,V){var ee=e.unstable_now();switch(typeof V=="object"&&V!==null?(V=V.delay,V=typeof V=="number"&&0<V?ee+V:ee):V=ee,q){case 1:var ue=-1;break;case 2:ue=250;break;case 5:ue=1073741823;break;case 4:ue=1e4;break;default:ue=5e3}return ue=V+ue,q={id:c++,callback:W,priorityLevel:q,startTime:V,expirationTime:ue,sortIndex:-1},V>ee?(q.sortIndex=V,t(l,q),r(u)===null&&q===r(l)&&(m?(g(_),_=-1):m=!0,te(S,V-ee))):(q.sortIndex=ue,t(u,q),h||p||(h=!0,j(x))),q},e.unstable_shouldYield=D,e.unstable_wrapCallback=function(q){var W=f;return function(){var V=f;f=W;try{return q.apply(this,arguments)}finally{f=V}}}})(dU);(function(e){e.exports=dU})(cU);/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var fU=ke.exports,ys=cU.exports;function Ot(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=1;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var pU=new Set,Wy={};function bm(e,t){n0(e,t),n0(e+"Capture",t)}function n0(e,t){for(Wy[e]=t,e=0;e<t.length;e++)pU.add(t[e])}var id=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),iE=Object.prototype.hasOwnProperty,Eee=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,w6={},_6={};function Pee(e){return iE.call(_6,e)?!0:iE.call(w6,e)?!1:Eee.test(e)?_6[e]=!0:(w6[e]=!0,!1)}function Iee(e,t,r,n){if(r!==null&&r.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return n?!1:r!==null?!r.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function Mee(e,t,r,n){if(t===null||typeof t>"u"||Iee(e,t,r,n))return!0;if(n)return!1;if(r!==null)switch(r.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function Co(e,t,r,n,a,i,o){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=n,this.attributeNamespace=a,this.mustUseProperty=r,this.propertyName=e,this.type=t,this.sanitizeURL=i,this.removeEmptyString=o}var Ri={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){Ri[e]=new Co(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];Ri[t]=new Co(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){Ri[e]=new Co(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){Ri[e]=new Co(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){Ri[e]=new Co(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){Ri[e]=new Co(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){Ri[e]=new Co(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){Ri[e]=new Co(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){Ri[e]=new Co(e,5,!1,e.toLowerCase(),null,!1,!1)});var JI=/[\-:]([a-z])/g;function eM(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(JI,eM);Ri[t]=new Co(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(JI,eM);Ri[t]=new Co(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(JI,eM);Ri[t]=new Co(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){Ri[e]=new Co(e,1,!1,e.toLowerCase(),null,!1,!1)});Ri.xlinkHref=new Co("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){Ri[e]=new Co(e,1,!1,e.toLowerCase(),null,!0,!0)});function tM(e,t,r,n){var a=Ri.hasOwnProperty(t)?Ri[t]:null;(a!==null?a.type!==0:n||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(Mee(t,r,a,n)&&(r=null),n||a===null?Pee(t)&&(r===null?e.removeAttribute(t):e.setAttribute(t,""+r)):a.mustUseProperty?e[a.propertyName]=r===null?a.type===3?!1:"":r:(t=a.attributeName,n=a.attributeNamespace,r===null?e.removeAttribute(t):(a=a.type,r=a===3||a===4&&r===!0?"":""+r,n?e.setAttributeNS(n,t,r):e.setAttribute(t,r))))}var Md=fU.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,r2=Symbol.for("react.element"),mv=Symbol.for("react.portal"),vv=Symbol.for("react.fragment"),rM=Symbol.for("react.strict_mode"),oE=Symbol.for("react.profiler"),hU=Symbol.for("react.provider"),mU=Symbol.for("react.context"),nM=Symbol.for("react.forward_ref"),sE=Symbol.for("react.suspense"),uE=Symbol.for("react.suspense_list"),aM=Symbol.for("react.memo"),wf=Symbol.for("react.lazy"),vU=Symbol.for("react.offscreen"),A6=Symbol.iterator;function cg(e){return e===null||typeof e!="object"?null:(e=A6&&e[A6]||e["@@iterator"],typeof e=="function"?e:null)}var _a=Object.assign,i4;function Wg(e){if(i4===void 0)try{throw Error()}catch(r){var t=r.stack.trim().match(/\n( *(at )?)/);i4=t&&t[1]||""}return`
`+i4+e}var o4=!1;function s4(e,t){if(!e||o4)return"";o4=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(l){var n=l}Reflect.construct(e,[],t)}else{try{t.call()}catch(l){n=l}e.call(t.prototype)}else{try{throw Error()}catch(l){n=l}e()}}catch(l){if(l&&n&&typeof l.stack=="string"){for(var a=l.stack.split(`
`),i=n.stack.split(`
`),o=a.length-1,s=i.length-1;1<=o&&0<=s&&a[o]!==i[s];)s--;for(;1<=o&&0<=s;o--,s--)if(a[o]!==i[s]){if(o!==1||s!==1)do if(o--,s--,0>s||a[o]!==i[s]){var u=`
`+a[o].replace(" at new "," at ");return e.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",e.displayName)),u}while(1<=o&&0<=s);break}}}finally{o4=!1,Error.prepareStackTrace=r}return(e=e?e.displayName||e.name:"")?Wg(e):""}function Dee(e){switch(e.tag){case 5:return Wg(e.type);case 16:return Wg("Lazy");case 13:return Wg("Suspense");case 19:return Wg("SuspenseList");case 0:case 2:case 15:return e=s4(e.type,!1),e;case 11:return e=s4(e.type.render,!1),e;case 1:return e=s4(e.type,!0),e;default:return""}}function lE(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case vv:return"Fragment";case mv:return"Portal";case oE:return"Profiler";case rM:return"StrictMode";case sE:return"Suspense";case uE:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case mU:return(e.displayName||"Context")+".Consumer";case hU:return(e._context.displayName||"Context")+".Provider";case nM:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case aM:return t=e.displayName||null,t!==null?t:lE(e.type)||"Memo";case wf:t=e._payload,e=e._init;try{return lE(e(t))}catch{}}return null}function kee(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return lE(t);case 8:return t===rM?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function dp(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function gU(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function Ree(e){var t=gU(e)?"checked":"value",r=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),n=""+e[t];if(!e.hasOwnProperty(t)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var a=r.get,i=r.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return a.call(this)},set:function(o){n=""+o,i.call(this,o)}}),Object.defineProperty(e,t,{enumerable:r.enumerable}),{getValue:function(){return n},setValue:function(o){n=""+o},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function n2(e){e._valueTracker||(e._valueTracker=Ree(e))}function yU(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var r=t.getValue(),n="";return e&&(n=gU(e)?e.checked?"true":"false":e.value),e=n,e!==r?(t.setValue(e),!0):!1}function CS(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function cE(e,t){var r=t.checked;return _a({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:r??e._wrapperState.initialChecked})}function T6(e,t){var r=t.defaultValue==null?"":t.defaultValue,n=t.checked!=null?t.checked:t.defaultChecked;r=dp(t.value!=null?t.value:r),e._wrapperState={initialChecked:n,initialValue:r,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function bU(e,t){t=t.checked,t!=null&&tM(e,"checked",t,!1)}function dE(e,t){bU(e,t);var r=dp(t.value),n=t.type;if(r!=null)n==="number"?(r===0&&e.value===""||e.value!=r)&&(e.value=""+r):e.value!==""+r&&(e.value=""+r);else if(n==="submit"||n==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?fE(e,t.type,r):t.hasOwnProperty("defaultValue")&&fE(e,t.type,dp(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function E6(e,t,r){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var n=t.type;if(!(n!=="submit"&&n!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,r||t===e.value||(e.value=t),e.defaultValue=t}r=e.name,r!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,r!==""&&(e.name=r)}function fE(e,t,r){(t!=="number"||CS(e.ownerDocument)!==e)&&(r==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+r&&(e.defaultValue=""+r))}var Xg=Array.isArray;function Lv(e,t,r,n){if(e=e.options,t){t={};for(var a=0;a<r.length;a++)t["$"+r[a]]=!0;for(r=0;r<e.length;r++)a=t.hasOwnProperty("$"+e[r].value),e[r].selected!==a&&(e[r].selected=a),a&&n&&(e[r].defaultSelected=!0)}else{for(r=""+dp(r),t=null,a=0;a<e.length;a++){if(e[a].value===r){e[a].selected=!0,n&&(e[a].defaultSelected=!0);return}t!==null||e[a].disabled||(t=e[a])}t!==null&&(t.selected=!0)}}function pE(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(Ot(91));return _a({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function P6(e,t){var r=t.value;if(r==null){if(r=t.children,t=t.defaultValue,r!=null){if(t!=null)throw Error(Ot(92));if(Xg(r)){if(1<r.length)throw Error(Ot(93));r=r[0]}t=r}t==null&&(t=""),r=t}e._wrapperState={initialValue:dp(r)}}function xU(e,t){var r=dp(t.value),n=dp(t.defaultValue);r!=null&&(r=""+r,r!==e.value&&(e.value=r),t.defaultValue==null&&e.defaultValue!==r&&(e.defaultValue=r)),n!=null&&(e.defaultValue=""+n)}function I6(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function SU(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function hE(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?SU(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var a2,CU=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,r,n,a){MSApp.execUnsafeLocalFunction(function(){return e(t,r,n,a)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(a2=a2||document.createElement("div"),a2.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=a2.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function Xy(e,t){if(t){var r=e.firstChild;if(r&&r===e.lastChild&&r.nodeType===3){r.nodeValue=t;return}}e.textContent=t}var uy={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Oee=["Webkit","ms","Moz","O"];Object.keys(uy).forEach(function(e){Oee.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),uy[t]=uy[e]})});function wU(e,t,r){return t==null||typeof t=="boolean"||t===""?"":r||typeof t!="number"||t===0||uy.hasOwnProperty(e)&&uy[e]?(""+t).trim():t+"px"}function _U(e,t){e=e.style;for(var r in t)if(t.hasOwnProperty(r)){var n=r.indexOf("--")===0,a=wU(r,t[r],n);r==="float"&&(r="cssFloat"),n?e.setProperty(r,a):e[r]=a}}var Bee=_a({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function mE(e,t){if(t){if(Bee[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(Ot(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(Ot(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(Ot(61))}if(t.style!=null&&typeof t.style!="object")throw Error(Ot(62))}}function vE(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var gE=null;function iM(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var yE=null,Nv=null,zv=null;function M6(e){if(e=Z1(e)){if(typeof yE!="function")throw Error(Ot(280));var t=e.stateNode;t&&(t=F3(t),yE(e.stateNode,e.type,t))}}function AU(e){Nv?zv?zv.push(e):zv=[e]:Nv=e}function TU(){if(Nv){var e=Nv,t=zv;if(zv=Nv=null,M6(e),t)for(e=0;e<t.length;e++)M6(t[e])}}function EU(e,t){return e(t)}function PU(){}var u4=!1;function IU(e,t,r){if(u4)return e(t,r);u4=!0;try{return EU(e,t,r)}finally{u4=!1,(Nv!==null||zv!==null)&&(PU(),TU())}}function Yy(e,t){var r=e.stateNode;if(r===null)return null;var n=F3(r);if(n===null)return null;r=n[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(e=e.type,n=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!n;break e;default:e=!1}if(e)return null;if(r&&typeof r!="function")throw Error(Ot(231,t,typeof r));return r}var bE=!1;if(id)try{var dg={};Object.defineProperty(dg,"passive",{get:function(){bE=!0}}),window.addEventListener("test",dg,dg),window.removeEventListener("test",dg,dg)}catch{bE=!1}function Fee(e,t,r,n,a,i,o,s,u){var l=Array.prototype.slice.call(arguments,3);try{t.apply(r,l)}catch(c){this.onError(c)}}var ly=!1,wS=null,_S=!1,xE=null,Lee={onError:function(e){ly=!0,wS=e}};function Nee(e,t,r,n,a,i,o,s,u){ly=!1,wS=null,Fee.apply(Lee,arguments)}function zee(e,t,r,n,a,i,o,s,u){if(Nee.apply(this,arguments),ly){if(ly){var l=wS;ly=!1,wS=null}else throw Error(Ot(198));_S||(_S=!0,xE=l)}}function xm(e){var t=e,r=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,(t.flags&4098)!==0&&(r=t.return),e=t.return;while(e)}return t.tag===3?r:null}function MU(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function D6(e){if(xm(e)!==e)throw Error(Ot(188))}function Uee(e){var t=e.alternate;if(!t){if(t=xm(e),t===null)throw Error(Ot(188));return t!==e?null:e}for(var r=e,n=t;;){var a=r.return;if(a===null)break;var i=a.alternate;if(i===null){if(n=a.return,n!==null){r=n;continue}break}if(a.child===i.child){for(i=a.child;i;){if(i===r)return D6(a),e;if(i===n)return D6(a),t;i=i.sibling}throw Error(Ot(188))}if(r.return!==n.return)r=a,n=i;else{for(var o=!1,s=a.child;s;){if(s===r){o=!0,r=a,n=i;break}if(s===n){o=!0,n=a,r=i;break}s=s.sibling}if(!o){for(s=i.child;s;){if(s===r){o=!0,r=i,n=a;break}if(s===n){o=!0,n=i,r=a;break}s=s.sibling}if(!o)throw Error(Ot(189))}}if(r.alternate!==n)throw Error(Ot(190))}if(r.tag!==3)throw Error(Ot(188));return r.stateNode.current===r?e:t}function DU(e){return e=Uee(e),e!==null?kU(e):null}function kU(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=kU(e);if(t!==null)return t;e=e.sibling}return null}var RU=ys.unstable_scheduleCallback,k6=ys.unstable_cancelCallback,Vee=ys.unstable_shouldYield,Hee=ys.unstable_requestPaint,Oa=ys.unstable_now,jee=ys.unstable_getCurrentPriorityLevel,oM=ys.unstable_ImmediatePriority,OU=ys.unstable_UserBlockingPriority,AS=ys.unstable_NormalPriority,Gee=ys.unstable_LowPriority,BU=ys.unstable_IdlePriority,k3=null,Wl=null;function qee(e){if(Wl&&typeof Wl.onCommitFiberRoot=="function")try{Wl.onCommitFiberRoot(k3,e,void 0,(e.current.flags&128)===128)}catch{}}var ju=Math.clz32?Math.clz32:Yee,Wee=Math.log,Xee=Math.LN2;function Yee(e){return e>>>=0,e===0?32:31-(Wee(e)/Xee|0)|0}var i2=64,o2=4194304;function Yg(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function TS(e,t){var r=e.pendingLanes;if(r===0)return 0;var n=0,a=e.suspendedLanes,i=e.pingedLanes,o=r&268435455;if(o!==0){var s=o&~a;s!==0?n=Yg(s):(i&=o,i!==0&&(n=Yg(i)))}else o=r&~a,o!==0?n=Yg(o):i!==0&&(n=Yg(i));if(n===0)return 0;if(t!==0&&t!==n&&(t&a)===0&&(a=n&-n,i=t&-t,a>=i||a===16&&(i&4194240)!==0))return t;if((n&4)!==0&&(n|=r&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=n;0<t;)r=31-ju(t),a=1<<r,n|=e[r],t&=~a;return n}function Kee(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function $ee(e,t){for(var r=e.suspendedLanes,n=e.pingedLanes,a=e.expirationTimes,i=e.pendingLanes;0<i;){var o=31-ju(i),s=1<<o,u=a[o];u===-1?((s&r)===0||(s&n)!==0)&&(a[o]=Kee(s,t)):u<=t&&(e.expiredLanes|=s),i&=~s}}function SE(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function FU(){var e=i2;return i2<<=1,(i2&4194240)===0&&(i2=64),e}function l4(e){for(var t=[],r=0;31>r;r++)t.push(e);return t}function $1(e,t,r){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-ju(t),e[t]=r}function Qee(e,t){var r=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var n=e.eventTimes;for(e=e.expirationTimes;0<r;){var a=31-ju(r),i=1<<a;t[a]=0,n[a]=-1,e[a]=-1,r&=~i}}function sM(e,t){var r=e.entangledLanes|=t;for(e=e.entanglements;r;){var n=31-ju(r),a=1<<n;a&t|e[n]&t&&(e[n]|=t),r&=~a}}var Dn=0;function LU(e){return e&=-e,1<e?4<e?(e&268435455)!==0?16:536870912:4:1}var NU,uM,zU,UU,VU,CE=!1,s2=[],Qf=null,Zf=null,Jf=null,Ky=new Map,$y=new Map,If=[],Zee="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function R6(e,t){switch(e){case"focusin":case"focusout":Qf=null;break;case"dragenter":case"dragleave":Zf=null;break;case"mouseover":case"mouseout":Jf=null;break;case"pointerover":case"pointerout":Ky.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":$y.delete(t.pointerId)}}function fg(e,t,r,n,a,i){return e===null||e.nativeEvent!==i?(e={blockedOn:t,domEventName:r,eventSystemFlags:n,nativeEvent:i,targetContainers:[a]},t!==null&&(t=Z1(t),t!==null&&uM(t)),e):(e.eventSystemFlags|=n,t=e.targetContainers,a!==null&&t.indexOf(a)===-1&&t.push(a),e)}function Jee(e,t,r,n,a){switch(t){case"focusin":return Qf=fg(Qf,e,t,r,n,a),!0;case"dragenter":return Zf=fg(Zf,e,t,r,n,a),!0;case"mouseover":return Jf=fg(Jf,e,t,r,n,a),!0;case"pointerover":var i=a.pointerId;return Ky.set(i,fg(Ky.get(i)||null,e,t,r,n,a)),!0;case"gotpointercapture":return i=a.pointerId,$y.set(i,fg($y.get(i)||null,e,t,r,n,a)),!0}return!1}function HU(e){var t=wh(e.target);if(t!==null){var r=xm(t);if(r!==null){if(t=r.tag,t===13){if(t=MU(r),t!==null){e.blockedOn=t,VU(e.priority,function(){zU(r)});return}}else if(t===3&&r.stateNode.current.memoizedState.isDehydrated){e.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}e.blockedOn=null}function Lx(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var r=wE(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(r===null){r=e.nativeEvent;var n=new r.constructor(r.type,r);gE=n,r.target.dispatchEvent(n),gE=null}else return t=Z1(r),t!==null&&uM(t),e.blockedOn=r,!1;t.shift()}return!0}function O6(e,t,r){Lx(e)&&r.delete(t)}function ete(){CE=!1,Qf!==null&&Lx(Qf)&&(Qf=null),Zf!==null&&Lx(Zf)&&(Zf=null),Jf!==null&&Lx(Jf)&&(Jf=null),Ky.forEach(O6),$y.forEach(O6)}function pg(e,t){e.blockedOn===t&&(e.blockedOn=null,CE||(CE=!0,ys.unstable_scheduleCallback(ys.unstable_NormalPriority,ete)))}function Qy(e){function t(a){return pg(a,e)}if(0<s2.length){pg(s2[0],e);for(var r=1;r<s2.length;r++){var n=s2[r];n.blockedOn===e&&(n.blockedOn=null)}}for(Qf!==null&&pg(Qf,e),Zf!==null&&pg(Zf,e),Jf!==null&&pg(Jf,e),Ky.forEach(t),$y.forEach(t),r=0;r<If.length;r++)n=If[r],n.blockedOn===e&&(n.blockedOn=null);for(;0<If.length&&(r=If[0],r.blockedOn===null);)HU(r),r.blockedOn===null&&If.shift()}var Uv=Md.ReactCurrentBatchConfig,ES=!0;function tte(e,t,r,n){var a=Dn,i=Uv.transition;Uv.transition=null;try{Dn=1,lM(e,t,r,n)}finally{Dn=a,Uv.transition=i}}function rte(e,t,r,n){var a=Dn,i=Uv.transition;Uv.transition=null;try{Dn=4,lM(e,t,r,n)}finally{Dn=a,Uv.transition=i}}function lM(e,t,r,n){if(ES){var a=wE(e,t,r,n);if(a===null)b4(e,t,n,PS,r),R6(e,n);else if(Jee(a,e,t,r,n))n.stopPropagation();else if(R6(e,n),t&4&&-1<Zee.indexOf(e)){for(;a!==null;){var i=Z1(a);if(i!==null&&NU(i),i=wE(e,t,r,n),i===null&&b4(e,t,n,PS,r),i===a)break;a=i}a!==null&&n.stopPropagation()}else b4(e,t,n,null,r)}}var PS=null;function wE(e,t,r,n){if(PS=null,e=iM(n),e=wh(e),e!==null)if(t=xm(e),t===null)e=null;else if(r=t.tag,r===13){if(e=MU(t),e!==null)return e;e=null}else if(r===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return PS=e,null}function jU(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(jee()){case oM:return 1;case OU:return 4;case AS:case Gee:return 16;case BU:return 536870912;default:return 16}default:return 16}}var Nf=null,cM=null,Nx=null;function GU(){if(Nx)return Nx;var e,t=cM,r=t.length,n,a="value"in Nf?Nf.value:Nf.textContent,i=a.length;for(e=0;e<r&&t[e]===a[e];e++);var o=r-e;for(n=1;n<=o&&t[r-n]===a[i-n];n++);return Nx=a.slice(e,1<n?1-n:void 0)}function zx(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function u2(){return!0}function B6(){return!1}function Es(e){function t(r,n,a,i,o){this._reactName=r,this._targetInst=a,this.type=n,this.nativeEvent=i,this.target=o,this.currentTarget=null;for(var s in e)e.hasOwnProperty(s)&&(r=e[s],this[s]=r?r(i):i[s]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?u2:B6,this.isPropagationStopped=B6,this}return _a(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=u2)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=u2)},persist:function(){},isPersistent:u2}),t}var E0={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},dM=Es(E0),Q1=_a({},E0,{view:0,detail:0}),nte=Es(Q1),c4,d4,hg,R3=_a({},Q1,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:fM,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==hg&&(hg&&e.type==="mousemove"?(c4=e.screenX-hg.screenX,d4=e.screenY-hg.screenY):d4=c4=0,hg=e),c4)},movementY:function(e){return"movementY"in e?e.movementY:d4}}),F6=Es(R3),ate=_a({},R3,{dataTransfer:0}),ite=Es(ate),ote=_a({},Q1,{relatedTarget:0}),f4=Es(ote),ste=_a({},E0,{animationName:0,elapsedTime:0,pseudoElement:0}),ute=Es(ste),lte=_a({},E0,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),cte=Es(lte),dte=_a({},E0,{data:0}),L6=Es(dte),fte={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},pte={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},hte={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function mte(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=hte[e])?!!t[e]:!1}function fM(){return mte}var vte=_a({},Q1,{key:function(e){if(e.key){var t=fte[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=zx(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?pte[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:fM,charCode:function(e){return e.type==="keypress"?zx(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?zx(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),gte=Es(vte),yte=_a({},R3,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),N6=Es(yte),bte=_a({},Q1,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:fM}),xte=Es(bte),Ste=_a({},E0,{propertyName:0,elapsedTime:0,pseudoElement:0}),Cte=Es(Ste),wte=_a({},R3,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),_te=Es(wte),Ate=[9,13,27,32],pM=id&&"CompositionEvent"in window,cy=null;id&&"documentMode"in document&&(cy=document.documentMode);var Tte=id&&"TextEvent"in window&&!cy,qU=id&&(!pM||cy&&8<cy&&11>=cy),z6=String.fromCharCode(32),U6=!1;function WU(e,t){switch(e){case"keyup":return Ate.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function XU(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var gv=!1;function Ete(e,t){switch(e){case"compositionend":return XU(t);case"keypress":return t.which!==32?null:(U6=!0,z6);case"textInput":return e=t.data,e===z6&&U6?null:e;default:return null}}function Pte(e,t){if(gv)return e==="compositionend"||!pM&&WU(e,t)?(e=GU(),Nx=cM=Nf=null,gv=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return qU&&t.locale!=="ko"?null:t.data;default:return null}}var Ite={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function V6(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!Ite[e.type]:t==="textarea"}function YU(e,t,r,n){AU(n),t=IS(t,"onChange"),0<t.length&&(r=new dM("onChange","change",null,r,n),e.push({event:r,listeners:t}))}var dy=null,Zy=null;function Mte(e){iV(e,0)}function O3(e){var t=xv(e);if(yU(t))return e}function Dte(e,t){if(e==="change")return t}var KU=!1;if(id){var p4;if(id){var h4="oninput"in document;if(!h4){var H6=document.createElement("div");H6.setAttribute("oninput","return;"),h4=typeof H6.oninput=="function"}p4=h4}else p4=!1;KU=p4&&(!document.documentMode||9<document.documentMode)}function j6(){dy&&(dy.detachEvent("onpropertychange",$U),Zy=dy=null)}function $U(e){if(e.propertyName==="value"&&O3(Zy)){var t=[];YU(t,Zy,e,iM(e)),IU(Mte,t)}}function kte(e,t,r){e==="focusin"?(j6(),dy=t,Zy=r,dy.attachEvent("onpropertychange",$U)):e==="focusout"&&j6()}function Rte(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return O3(Zy)}function Ote(e,t){if(e==="click")return O3(t)}function Bte(e,t){if(e==="input"||e==="change")return O3(t)}function Fte(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var el=typeof Object.is=="function"?Object.is:Fte;function Jy(e,t){if(el(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(n=0;n<r.length;n++){var a=r[n];if(!iE.call(t,a)||!el(e[a],t[a]))return!1}return!0}function G6(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function q6(e,t){var r=G6(e);e=0;for(var n;r;){if(r.nodeType===3){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=G6(r)}}function QU(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?QU(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function ZU(){for(var e=window,t=CS();t instanceof e.HTMLIFrameElement;){try{var r=typeof t.contentWindow.location.href=="string"}catch{r=!1}if(r)e=t.contentWindow;else break;t=CS(e.document)}return t}function hM(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function Lte(e){var t=ZU(),r=e.focusedElem,n=e.selectionRange;if(t!==r&&r&&r.ownerDocument&&QU(r.ownerDocument.documentElement,r)){if(n!==null&&hM(r)){if(t=n.start,e=n.end,e===void 0&&(e=t),"selectionStart"in r)r.selectionStart=t,r.selectionEnd=Math.min(e,r.value.length);else if(e=(t=r.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var a=r.textContent.length,i=Math.min(n.start,a);n=n.end===void 0?i:Math.min(n.end,a),!e.extend&&i>n&&(a=n,n=i,i=a),a=q6(r,i);var o=q6(r,n);a&&o&&(e.rangeCount!==1||e.anchorNode!==a.node||e.anchorOffset!==a.offset||e.focusNode!==o.node||e.focusOffset!==o.offset)&&(t=t.createRange(),t.setStart(a.node,a.offset),e.removeAllRanges(),i>n?(e.addRange(t),e.extend(o.node,o.offset)):(t.setEnd(o.node,o.offset),e.addRange(t)))}}for(t=[],e=r;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof r.focus=="function"&&r.focus(),r=0;r<t.length;r++)e=t[r],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var Nte=id&&"documentMode"in document&&11>=document.documentMode,yv=null,_E=null,fy=null,AE=!1;function W6(e,t,r){var n=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;AE||yv==null||yv!==CS(n)||(n=yv,"selectionStart"in n&&hM(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),fy&&Jy(fy,n)||(fy=n,n=IS(_E,"onSelect"),0<n.length&&(t=new dM("onSelect","select",null,t,r),e.push({event:t,listeners:n}),t.target=yv)))}function l2(e,t){var r={};return r[e.toLowerCase()]=t.toLowerCase(),r["Webkit"+e]="webkit"+t,r["Moz"+e]="moz"+t,r}var bv={animationend:l2("Animation","AnimationEnd"),animationiteration:l2("Animation","AnimationIteration"),animationstart:l2("Animation","AnimationStart"),transitionend:l2("Transition","TransitionEnd")},m4={},JU={};id&&(JU=document.createElement("div").style,"AnimationEvent"in window||(delete bv.animationend.animation,delete bv.animationiteration.animation,delete bv.animationstart.animation),"TransitionEvent"in window||delete bv.transitionend.transition);function B3(e){if(m4[e])return m4[e];if(!bv[e])return e;var t=bv[e],r;for(r in t)if(t.hasOwnProperty(r)&&r in JU)return m4[e]=t[r];return e}var eV=B3("animationend"),tV=B3("animationiteration"),rV=B3("animationstart"),nV=B3("transitionend"),aV=new Map,X6="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Tp(e,t){aV.set(e,t),bm(t,[e])}for(var v4=0;v4<X6.length;v4++){var g4=X6[v4],zte=g4.toLowerCase(),Ute=g4[0].toUpperCase()+g4.slice(1);Tp(zte,"on"+Ute)}Tp(eV,"onAnimationEnd");Tp(tV,"onAnimationIteration");Tp(rV,"onAnimationStart");Tp("dblclick","onDoubleClick");Tp("focusin","onFocus");Tp("focusout","onBlur");Tp(nV,"onTransitionEnd");n0("onMouseEnter",["mouseout","mouseover"]);n0("onMouseLeave",["mouseout","mouseover"]);n0("onPointerEnter",["pointerout","pointerover"]);n0("onPointerLeave",["pointerout","pointerover"]);bm("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));bm("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));bm("onBeforeInput",["compositionend","keypress","textInput","paste"]);bm("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));bm("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));bm("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Kg="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Vte=new Set("cancel close invalid load scroll toggle".split(" ").concat(Kg));function Y6(e,t,r){var n=e.type||"unknown-event";e.currentTarget=r,zee(n,t,void 0,e),e.currentTarget=null}function iV(e,t){t=(t&4)!==0;for(var r=0;r<e.length;r++){var n=e[r],a=n.event;n=n.listeners;e:{var i=void 0;if(t)for(var o=n.length-1;0<=o;o--){var s=n[o],u=s.instance,l=s.currentTarget;if(s=s.listener,u!==i&&a.isPropagationStopped())break e;Y6(a,s,l),i=u}else for(o=0;o<n.length;o++){if(s=n[o],u=s.instance,l=s.currentTarget,s=s.listener,u!==i&&a.isPropagationStopped())break e;Y6(a,s,l),i=u}}}if(_S)throw e=xE,_S=!1,xE=null,e}function ra(e,t){var r=t[ME];r===void 0&&(r=t[ME]=new Set);var n=e+"__bubble";r.has(n)||(oV(t,e,2,!1),r.add(n))}function y4(e,t,r){var n=0;t&&(n|=4),oV(r,e,n,t)}var c2="_reactListening"+Math.random().toString(36).slice(2);function e1(e){if(!e[c2]){e[c2]=!0,pU.forEach(function(r){r!=="selectionchange"&&(Vte.has(r)||y4(r,!1,e),y4(r,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[c2]||(t[c2]=!0,y4("selectionchange",!1,t))}}function oV(e,t,r,n){switch(jU(t)){case 1:var a=tte;break;case 4:a=rte;break;default:a=lM}r=a.bind(null,t,r,e),a=void 0,!bE||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(a=!0),n?a!==void 0?e.addEventListener(t,r,{capture:!0,passive:a}):e.addEventListener(t,r,!0):a!==void 0?e.addEventListener(t,r,{passive:a}):e.addEventListener(t,r,!1)}function b4(e,t,r,n,a){var i=n;if((t&1)===0&&(t&2)===0&&n!==null)e:for(;;){if(n===null)return;var o=n.tag;if(o===3||o===4){var s=n.stateNode.containerInfo;if(s===a||s.nodeType===8&&s.parentNode===a)break;if(o===4)for(o=n.return;o!==null;){var u=o.tag;if((u===3||u===4)&&(u=o.stateNode.containerInfo,u===a||u.nodeType===8&&u.parentNode===a))return;o=o.return}for(;s!==null;){if(o=wh(s),o===null)return;if(u=o.tag,u===5||u===6){n=i=o;continue e}s=s.parentNode}}n=n.return}IU(function(){var l=i,c=iM(r),d=[];e:{var f=aV.get(e);if(f!==void 0){var p=dM,h=e;switch(e){case"keypress":if(zx(r)===0)break e;case"keydown":case"keyup":p=gte;break;case"focusin":h="focus",p=f4;break;case"focusout":h="blur",p=f4;break;case"beforeblur":case"afterblur":p=f4;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":p=F6;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":p=ite;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":p=xte;break;case eV:case tV:case rV:p=ute;break;case nV:p=Cte;break;case"scroll":p=nte;break;case"wheel":p=_te;break;case"copy":case"cut":case"paste":p=cte;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":p=N6}var m=(t&4)!==0,v=!m&&e==="scroll",g=m?f!==null?f+"Capture":null:f;m=[];for(var y=l,b;y!==null;){b=y;var S=b.stateNode;if(b.tag===5&&S!==null&&(b=S,g!==null&&(S=Yy(y,g),S!=null&&m.push(t1(y,S,b)))),v)break;y=y.return}0<m.length&&(f=new p(f,h,null,r,c),d.push({event:f,listeners:m}))}}if((t&7)===0){e:{if(f=e==="mouseover"||e==="pointerover",p=e==="mouseout"||e==="pointerout",f&&r!==gE&&(h=r.relatedTarget||r.fromElement)&&(wh(h)||h[od]))break e;if((p||f)&&(f=c.window===c?c:(f=c.ownerDocument)?f.defaultView||f.parentWindow:window,p?(h=r.relatedTarget||r.toElement,p=l,h=h?wh(h):null,h!==null&&(v=xm(h),h!==v||h.tag!==5&&h.tag!==6)&&(h=null)):(p=null,h=l),p!==h)){if(m=F6,S="onMouseLeave",g="onMouseEnter",y="mouse",(e==="pointerout"||e==="pointerover")&&(m=N6,S="onPointerLeave",g="onPointerEnter",y="pointer"),v=p==null?f:xv(p),b=h==null?f:xv(h),f=new m(S,y+"leave",p,r,c),f.target=v,f.relatedTarget=b,S=null,wh(c)===l&&(m=new m(g,y+"enter",h,r,c),m.target=b,m.relatedTarget=v,S=m),v=S,p&&h)t:{for(m=p,g=h,y=0,b=m;b;b=qm(b))y++;for(b=0,S=g;S;S=qm(S))b++;for(;0<y-b;)m=qm(m),y--;for(;0<b-y;)g=qm(g),b--;for(;y--;){if(m===g||g!==null&&m===g.alternate)break t;m=qm(m),g=qm(g)}m=null}else m=null;p!==null&&K6(d,f,p,m,!1),h!==null&&v!==null&&K6(d,v,h,m,!0)}}e:{if(f=l?xv(l):window,p=f.nodeName&&f.nodeName.toLowerCase(),p==="select"||p==="input"&&f.type==="file")var x=Dte;else if(V6(f))if(KU)x=Bte;else{x=Rte;var C=kte}else(p=f.nodeName)&&p.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(x=Ote);if(x&&(x=x(e,l))){YU(d,x,r,c);break e}C&&C(e,f,l),e==="focusout"&&(C=f._wrapperState)&&C.controlled&&f.type==="number"&&fE(f,"number",f.value)}switch(C=l?xv(l):window,e){case"focusin":(V6(C)||C.contentEditable==="true")&&(yv=C,_E=l,fy=null);break;case"focusout":fy=_E=yv=null;break;case"mousedown":AE=!0;break;case"contextmenu":case"mouseup":case"dragend":AE=!1,W6(d,r,c);break;case"selectionchange":if(Nte)break;case"keydown":case"keyup":W6(d,r,c)}var w;if(pM)e:{switch(e){case"compositionstart":var _="onCompositionStart";break e;case"compositionend":_="onCompositionEnd";break e;case"compositionupdate":_="onCompositionUpdate";break e}_=void 0}else gv?WU(e,r)&&(_="onCompositionEnd"):e==="keydown"&&r.keyCode===229&&(_="onCompositionStart");_&&(qU&&r.locale!=="ko"&&(gv||_!=="onCompositionStart"?_==="onCompositionEnd"&&gv&&(w=GU()):(Nf=c,cM="value"in Nf?Nf.value:Nf.textContent,gv=!0)),C=IS(l,_),0<C.length&&(_=new L6(_,e,null,r,c),d.push({event:_,listeners:C}),w?_.data=w:(w=XU(r),w!==null&&(_.data=w)))),(w=Tte?Ete(e,r):Pte(e,r))&&(l=IS(l,"onBeforeInput"),0<l.length&&(c=new L6("onBeforeInput","beforeinput",null,r,c),d.push({event:c,listeners:l}),c.data=w))}iV(d,t)})}function t1(e,t,r){return{instance:e,listener:t,currentTarget:r}}function IS(e,t){for(var r=t+"Capture",n=[];e!==null;){var a=e,i=a.stateNode;a.tag===5&&i!==null&&(a=i,i=Yy(e,r),i!=null&&n.unshift(t1(e,i,a)),i=Yy(e,t),i!=null&&n.push(t1(e,i,a))),e=e.return}return n}function qm(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function K6(e,t,r,n,a){for(var i=t._reactName,o=[];r!==null&&r!==n;){var s=r,u=s.alternate,l=s.stateNode;if(u!==null&&u===n)break;s.tag===5&&l!==null&&(s=l,a?(u=Yy(r,i),u!=null&&o.unshift(t1(r,u,s))):a||(u=Yy(r,i),u!=null&&o.push(t1(r,u,s)))),r=r.return}o.length!==0&&e.push({event:t,listeners:o})}var Hte=/\r\n?/g,jte=/\u0000|\uFFFD/g;function $6(e){return(typeof e=="string"?e:""+e).replace(Hte,`
`).replace(jte,"")}function d2(e,t,r){if(t=$6(t),$6(e)!==t&&r)throw Error(Ot(425))}function MS(){}var TE=null,EE=null;function PE(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var IE=typeof setTimeout=="function"?setTimeout:void 0,Gte=typeof clearTimeout=="function"?clearTimeout:void 0,Q6=typeof Promise=="function"?Promise:void 0,qte=typeof queueMicrotask=="function"?queueMicrotask:typeof Q6<"u"?function(e){return Q6.resolve(null).then(e).catch(Wte)}:IE;function Wte(e){setTimeout(function(){throw e})}function x4(e,t){var r=t,n=0;do{var a=r.nextSibling;if(e.removeChild(r),a&&a.nodeType===8)if(r=a.data,r==="/$"){if(n===0){e.removeChild(a),Qy(t);return}n--}else r!=="$"&&r!=="$?"&&r!=="$!"||n++;r=a}while(r);Qy(t)}function ep(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function Z6(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="$"||r==="$!"||r==="$?"){if(t===0)return e;t--}else r==="/$"&&t++}e=e.previousSibling}return null}var P0=Math.random().toString(36).slice(2),Nl="__reactFiber$"+P0,r1="__reactProps$"+P0,od="__reactContainer$"+P0,ME="__reactEvents$"+P0,Xte="__reactListeners$"+P0,Yte="__reactHandles$"+P0;function wh(e){var t=e[Nl];if(t)return t;for(var r=e.parentNode;r;){if(t=r[od]||r[Nl]){if(r=t.alternate,t.child!==null||r!==null&&r.child!==null)for(e=Z6(e);e!==null;){if(r=e[Nl])return r;e=Z6(e)}return t}e=r,r=e.parentNode}return null}function Z1(e){return e=e[Nl]||e[od],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function xv(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(Ot(33))}function F3(e){return e[r1]||null}var DE=[],Sv=-1;function Ep(e){return{current:e}}function ua(e){0>Sv||(e.current=DE[Sv],DE[Sv]=null,Sv--)}function Zn(e,t){Sv++,DE[Sv]=e.current,e.current=t}var fp={},Zi=Ep(fp),No=Ep(!1),Qh=fp;function a0(e,t){var r=e.type.contextTypes;if(!r)return fp;var n=e.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===t)return n.__reactInternalMemoizedMaskedChildContext;var a={},i;for(i in r)a[i]=t[i];return n&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=a),a}function zo(e){return e=e.childContextTypes,e!=null}function DS(){ua(No),ua(Zi)}function J6(e,t,r){if(Zi.current!==fp)throw Error(Ot(168));Zn(Zi,t),Zn(No,r)}function sV(e,t,r){var n=e.stateNode;if(t=t.childContextTypes,typeof n.getChildContext!="function")return r;n=n.getChildContext();for(var a in n)if(!(a in t))throw Error(Ot(108,kee(e)||"Unknown",a));return _a({},r,n)}function kS(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||fp,Qh=Zi.current,Zn(Zi,e),Zn(No,No.current),!0}function e8(e,t,r){var n=e.stateNode;if(!n)throw Error(Ot(169));r?(e=sV(e,t,Qh),n.__reactInternalMemoizedMergedChildContext=e,ua(No),ua(Zi),Zn(Zi,e)):ua(No),Zn(No,r)}var zc=null,L3=!1,S4=!1;function uV(e){zc===null?zc=[e]:zc.push(e)}function Kte(e){L3=!0,uV(e)}function Pp(){if(!S4&&zc!==null){S4=!0;var e=0,t=Dn;try{var r=zc;for(Dn=1;e<r.length;e++){var n=r[e];do n=n(!0);while(n!==null)}zc=null,L3=!1}catch(a){throw zc!==null&&(zc=zc.slice(e+1)),RU(oM,Pp),a}finally{Dn=t,S4=!1}}return null}var Cv=[],wv=0,RS=null,OS=0,Js=[],eu=0,Zh=null,qc=1,Wc="";function fh(e,t){Cv[wv++]=OS,Cv[wv++]=RS,RS=e,OS=t}function lV(e,t,r){Js[eu++]=qc,Js[eu++]=Wc,Js[eu++]=Zh,Zh=e;var n=qc;e=Wc;var a=32-ju(n)-1;n&=~(1<<a),r+=1;var i=32-ju(t)+a;if(30<i){var o=a-a%5;i=(n&(1<<o)-1).toString(32),n>>=o,a-=o,qc=1<<32-ju(t)+a|r<<a|n,Wc=i+e}else qc=1<<i|r<<a|n,Wc=e}function mM(e){e.return!==null&&(fh(e,1),lV(e,1,0))}function vM(e){for(;e===RS;)RS=Cv[--wv],Cv[wv]=null,OS=Cv[--wv],Cv[wv]=null;for(;e===Zh;)Zh=Js[--eu],Js[eu]=null,Wc=Js[--eu],Js[eu]=null,qc=Js[--eu],Js[eu]=null}var hs=null,ds=null,va=!1,Lu=null;function cV(e,t){var r=tu(5,null,null,0);r.elementType="DELETED",r.stateNode=t,r.return=e,t=e.deletions,t===null?(e.deletions=[r],e.flags|=16):t.push(r)}function t8(e,t){switch(e.tag){case 5:var r=e.type;return t=t.nodeType!==1||r.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,hs=e,ds=ep(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,hs=e,ds=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(r=Zh!==null?{id:qc,overflow:Wc}:null,e.memoizedState={dehydrated:t,treeContext:r,retryLane:1073741824},r=tu(18,null,null,0),r.stateNode=t,r.return=e,e.child=r,hs=e,ds=null,!0):!1;default:return!1}}function kE(e){return(e.mode&1)!==0&&(e.flags&128)===0}function RE(e){if(va){var t=ds;if(t){var r=t;if(!t8(e,t)){if(kE(e))throw Error(Ot(418));t=ep(r.nextSibling);var n=hs;t&&t8(e,t)?cV(n,r):(e.flags=e.flags&-4097|2,va=!1,hs=e)}}else{if(kE(e))throw Error(Ot(418));e.flags=e.flags&-4097|2,va=!1,hs=e}}}function r8(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;hs=e}function f2(e){if(e!==hs)return!1;if(!va)return r8(e),va=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!PE(e.type,e.memoizedProps)),t&&(t=ds)){if(kE(e))throw dV(),Error(Ot(418));for(;t;)cV(e,t),t=ep(t.nextSibling)}if(r8(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(Ot(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="/$"){if(t===0){ds=ep(e.nextSibling);break e}t--}else r!=="$"&&r!=="$!"&&r!=="$?"||t++}e=e.nextSibling}ds=null}}else ds=hs?ep(e.stateNode.nextSibling):null;return!0}function dV(){for(var e=ds;e;)e=ep(e.nextSibling)}function i0(){ds=hs=null,va=!1}function gM(e){Lu===null?Lu=[e]:Lu.push(e)}var $te=Md.ReactCurrentBatchConfig;function Ru(e,t){if(e&&e.defaultProps){t=_a({},t),e=e.defaultProps;for(var r in e)t[r]===void 0&&(t[r]=e[r]);return t}return t}var BS=Ep(null),FS=null,_v=null,yM=null;function bM(){yM=_v=FS=null}function xM(e){var t=BS.current;ua(BS),e._currentValue=t}function OE(e,t,r){for(;e!==null;){var n=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,n!==null&&(n.childLanes|=t)):n!==null&&(n.childLanes&t)!==t&&(n.childLanes|=t),e===r)break;e=e.return}}function Vv(e,t){FS=e,yM=_v=null,e=e.dependencies,e!==null&&e.firstContext!==null&&((e.lanes&t)!==0&&(Lo=!0),e.firstContext=null)}function lu(e){var t=e._currentValue;if(yM!==e)if(e={context:e,memoizedValue:t,next:null},_v===null){if(FS===null)throw Error(Ot(308));_v=e,FS.dependencies={lanes:0,firstContext:e}}else _v=_v.next=e;return t}var _h=null;function SM(e){_h===null?_h=[e]:_h.push(e)}function fV(e,t,r,n){var a=t.interleaved;return a===null?(r.next=r,SM(t)):(r.next=a.next,a.next=r),t.interleaved=r,sd(e,n)}function sd(e,t){e.lanes|=t;var r=e.alternate;for(r!==null&&(r.lanes|=t),r=e,e=e.return;e!==null;)e.childLanes|=t,r=e.alternate,r!==null&&(r.childLanes|=t),r=e,e=e.return;return r.tag===3?r.stateNode:null}var _f=!1;function CM(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function pV(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function ed(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function tp(e,t,r){var n=e.updateQueue;if(n===null)return null;if(n=n.shared,(fn&2)!==0){var a=n.pending;return a===null?t.next=t:(t.next=a.next,a.next=t),n.pending=t,sd(e,r)}return a=n.interleaved,a===null?(t.next=t,SM(n)):(t.next=a.next,a.next=t),n.interleaved=t,sd(e,r)}function Ux(e,t,r){if(t=t.updateQueue,t!==null&&(t=t.shared,(r&4194240)!==0)){var n=t.lanes;n&=e.pendingLanes,r|=n,t.lanes=r,sM(e,r)}}function n8(e,t){var r=e.updateQueue,n=e.alternate;if(n!==null&&(n=n.updateQueue,r===n)){var a=null,i=null;if(r=r.firstBaseUpdate,r!==null){do{var o={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};i===null?a=i=o:i=i.next=o,r=r.next}while(r!==null);i===null?a=i=t:i=i.next=t}else a=i=t;r={baseState:n.baseState,firstBaseUpdate:a,lastBaseUpdate:i,shared:n.shared,effects:n.effects},e.updateQueue=r;return}e=r.lastBaseUpdate,e===null?r.firstBaseUpdate=t:e.next=t,r.lastBaseUpdate=t}function LS(e,t,r,n){var a=e.updateQueue;_f=!1;var i=a.firstBaseUpdate,o=a.lastBaseUpdate,s=a.shared.pending;if(s!==null){a.shared.pending=null;var u=s,l=u.next;u.next=null,o===null?i=l:o.next=l,o=u;var c=e.alternate;c!==null&&(c=c.updateQueue,s=c.lastBaseUpdate,s!==o&&(s===null?c.firstBaseUpdate=l:s.next=l,c.lastBaseUpdate=u))}if(i!==null){var d=a.baseState;o=0,c=l=u=null,s=i;do{var f=s.lane,p=s.eventTime;if((n&f)===f){c!==null&&(c=c.next={eventTime:p,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var h=e,m=s;switch(f=t,p=r,m.tag){case 1:if(h=m.payload,typeof h=="function"){d=h.call(p,d,f);break e}d=h;break e;case 3:h.flags=h.flags&-65537|128;case 0:if(h=m.payload,f=typeof h=="function"?h.call(p,d,f):h,f==null)break e;d=_a({},d,f);break e;case 2:_f=!0}}s.callback!==null&&s.lane!==0&&(e.flags|=64,f=a.effects,f===null?a.effects=[s]:f.push(s))}else p={eventTime:p,lane:f,tag:s.tag,payload:s.payload,callback:s.callback,next:null},c===null?(l=c=p,u=d):c=c.next=p,o|=f;if(s=s.next,s===null){if(s=a.shared.pending,s===null)break;f=s,s=f.next,f.next=null,a.lastBaseUpdate=f,a.shared.pending=null}}while(1);if(c===null&&(u=d),a.baseState=u,a.firstBaseUpdate=l,a.lastBaseUpdate=c,t=a.shared.interleaved,t!==null){a=t;do o|=a.lane,a=a.next;while(a!==t)}else i===null&&(a.shared.lanes=0);em|=o,e.lanes=o,e.memoizedState=d}}function a8(e,t,r){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var n=e[t],a=n.callback;if(a!==null){if(n.callback=null,n=r,typeof a!="function")throw Error(Ot(191,a));a.call(n)}}}var hV=new fU.Component().refs;function BE(e,t,r,n){t=e.memoizedState,r=r(n,t),r=r==null?t:_a({},t,r),e.memoizedState=r,e.lanes===0&&(e.updateQueue.baseState=r)}var N3={isMounted:function(e){return(e=e._reactInternals)?xm(e)===e:!1},enqueueSetState:function(e,t,r){e=e._reactInternals;var n=mo(),a=np(e),i=ed(n,a);i.payload=t,r!=null&&(i.callback=r),t=tp(e,i,a),t!==null&&(Gu(t,e,a,n),Ux(t,e,a))},enqueueReplaceState:function(e,t,r){e=e._reactInternals;var n=mo(),a=np(e),i=ed(n,a);i.tag=1,i.payload=t,r!=null&&(i.callback=r),t=tp(e,i,a),t!==null&&(Gu(t,e,a,n),Ux(t,e,a))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var r=mo(),n=np(e),a=ed(r,n);a.tag=2,t!=null&&(a.callback=t),t=tp(e,a,n),t!==null&&(Gu(t,e,n,r),Ux(t,e,n))}};function i8(e,t,r,n,a,i,o){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(n,i,o):t.prototype&&t.prototype.isPureReactComponent?!Jy(r,n)||!Jy(a,i):!0}function mV(e,t,r){var n=!1,a=fp,i=t.contextType;return typeof i=="object"&&i!==null?i=lu(i):(a=zo(t)?Qh:Zi.current,n=t.contextTypes,i=(n=n!=null)?a0(e,a):fp),t=new t(r,i),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=N3,e.stateNode=t,t._reactInternals=e,n&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=a,e.__reactInternalMemoizedMaskedChildContext=i),t}function o8(e,t,r,n){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(r,n),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(r,n),t.state!==e&&N3.enqueueReplaceState(t,t.state,null)}function FE(e,t,r,n){var a=e.stateNode;a.props=r,a.state=e.memoizedState,a.refs=hV,CM(e);var i=t.contextType;typeof i=="object"&&i!==null?a.context=lu(i):(i=zo(t)?Qh:Zi.current,a.context=a0(e,i)),a.state=e.memoizedState,i=t.getDerivedStateFromProps,typeof i=="function"&&(BE(e,t,i,r),a.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof a.getSnapshotBeforeUpdate=="function"||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(t=a.state,typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount(),t!==a.state&&N3.enqueueReplaceState(a,a.state,null),LS(e,r,a,n),a.state=e.memoizedState),typeof a.componentDidMount=="function"&&(e.flags|=4194308)}function mg(e,t,r){if(e=r.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(r._owner){if(r=r._owner,r){if(r.tag!==1)throw Error(Ot(309));var n=r.stateNode}if(!n)throw Error(Ot(147,e));var a=n,i=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===i?t.ref:(t=function(o){var s=a.refs;s===hV&&(s=a.refs={}),o===null?delete s[i]:s[i]=o},t._stringRef=i,t)}if(typeof e!="string")throw Error(Ot(284));if(!r._owner)throw Error(Ot(290,e))}return e}function p2(e,t){throw e=Object.prototype.toString.call(t),Error(Ot(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function s8(e){var t=e._init;return t(e._payload)}function vV(e){function t(g,y){if(e){var b=g.deletions;b===null?(g.deletions=[y],g.flags|=16):b.push(y)}}function r(g,y){if(!e)return null;for(;y!==null;)t(g,y),y=y.sibling;return null}function n(g,y){for(g=new Map;y!==null;)y.key!==null?g.set(y.key,y):g.set(y.index,y),y=y.sibling;return g}function a(g,y){return g=ap(g,y),g.index=0,g.sibling=null,g}function i(g,y,b){return g.index=b,e?(b=g.alternate,b!==null?(b=b.index,b<y?(g.flags|=2,y):b):(g.flags|=2,y)):(g.flags|=1048576,y)}function o(g){return e&&g.alternate===null&&(g.flags|=2),g}function s(g,y,b,S){return y===null||y.tag!==6?(y=P4(b,g.mode,S),y.return=g,y):(y=a(y,b),y.return=g,y)}function u(g,y,b,S){var x=b.type;return x===vv?c(g,y,b.props.children,S,b.key):y!==null&&(y.elementType===x||typeof x=="object"&&x!==null&&x.$$typeof===wf&&s8(x)===y.type)?(S=a(y,b.props),S.ref=mg(g,y,b),S.return=g,S):(S=Wx(b.type,b.key,b.props,null,g.mode,S),S.ref=mg(g,y,b),S.return=g,S)}function l(g,y,b,S){return y===null||y.tag!==4||y.stateNode.containerInfo!==b.containerInfo||y.stateNode.implementation!==b.implementation?(y=I4(b,g.mode,S),y.return=g,y):(y=a(y,b.children||[]),y.return=g,y)}function c(g,y,b,S,x){return y===null||y.tag!==7?(y=Lh(b,g.mode,S,x),y.return=g,y):(y=a(y,b),y.return=g,y)}function d(g,y,b){if(typeof y=="string"&&y!==""||typeof y=="number")return y=P4(""+y,g.mode,b),y.return=g,y;if(typeof y=="object"&&y!==null){switch(y.$$typeof){case r2:return b=Wx(y.type,y.key,y.props,null,g.mode,b),b.ref=mg(g,null,y),b.return=g,b;case mv:return y=I4(y,g.mode,b),y.return=g,y;case wf:var S=y._init;return d(g,S(y._payload),b)}if(Xg(y)||cg(y))return y=Lh(y,g.mode,b,null),y.return=g,y;p2(g,y)}return null}function f(g,y,b,S){var x=y!==null?y.key:null;if(typeof b=="string"&&b!==""||typeof b=="number")return x!==null?null:s(g,y,""+b,S);if(typeof b=="object"&&b!==null){switch(b.$$typeof){case r2:return b.key===x?u(g,y,b,S):null;case mv:return b.key===x?l(g,y,b,S):null;case wf:return x=b._init,f(g,y,x(b._payload),S)}if(Xg(b)||cg(b))return x!==null?null:c(g,y,b,S,null);p2(g,b)}return null}function p(g,y,b,S,x){if(typeof S=="string"&&S!==""||typeof S=="number")return g=g.get(b)||null,s(y,g,""+S,x);if(typeof S=="object"&&S!==null){switch(S.$$typeof){case r2:return g=g.get(S.key===null?b:S.key)||null,u(y,g,S,x);case mv:return g=g.get(S.key===null?b:S.key)||null,l(y,g,S,x);case wf:var C=S._init;return p(g,y,b,C(S._payload),x)}if(Xg(S)||cg(S))return g=g.get(b)||null,c(y,g,S,x,null);p2(y,S)}return null}function h(g,y,b,S){for(var x=null,C=null,w=y,_=y=0,E=null;w!==null&&_<b.length;_++){w.index>_?(E=w,w=null):E=w.sibling;var P=f(g,w,b[_],S);if(P===null){w===null&&(w=E);break}e&&w&&P.alternate===null&&t(g,w),y=i(P,y,_),C===null?x=P:C.sibling=P,C=P,w=E}if(_===b.length)return r(g,w),va&&fh(g,_),x;if(w===null){for(;_<b.length;_++)w=d(g,b[_],S),w!==null&&(y=i(w,y,_),C===null?x=w:C.sibling=w,C=w);return va&&fh(g,_),x}for(w=n(g,w);_<b.length;_++)E=p(w,g,_,b[_],S),E!==null&&(e&&E.alternate!==null&&w.delete(E.key===null?_:E.key),y=i(E,y,_),C===null?x=E:C.sibling=E,C=E);return e&&w.forEach(function(D){return t(g,D)}),va&&fh(g,_),x}function m(g,y,b,S){var x=cg(b);if(typeof x!="function")throw Error(Ot(150));if(b=x.call(b),b==null)throw Error(Ot(151));for(var C=x=null,w=y,_=y=0,E=null,P=b.next();w!==null&&!P.done;_++,P=b.next()){w.index>_?(E=w,w=null):E=w.sibling;var D=f(g,w,P.value,S);if(D===null){w===null&&(w=E);break}e&&w&&D.alternate===null&&t(g,w),y=i(D,y,_),C===null?x=D:C.sibling=D,C=D,w=E}if(P.done)return r(g,w),va&&fh(g,_),x;if(w===null){for(;!P.done;_++,P=b.next())P=d(g,P.value,S),P!==null&&(y=i(P,y,_),C===null?x=P:C.sibling=P,C=P);return va&&fh(g,_),x}for(w=n(g,w);!P.done;_++,P=b.next())P=p(w,g,_,P.value,S),P!==null&&(e&&P.alternate!==null&&w.delete(P.key===null?_:P.key),y=i(P,y,_),C===null?x=P:C.sibling=P,C=P);return e&&w.forEach(function(k){return t(g,k)}),va&&fh(g,_),x}function v(g,y,b,S){if(typeof b=="object"&&b!==null&&b.type===vv&&b.key===null&&(b=b.props.children),typeof b=="object"&&b!==null){switch(b.$$typeof){case r2:e:{for(var x=b.key,C=y;C!==null;){if(C.key===x){if(x=b.type,x===vv){if(C.tag===7){r(g,C.sibling),y=a(C,b.props.children),y.return=g,g=y;break e}}else if(C.elementType===x||typeof x=="object"&&x!==null&&x.$$typeof===wf&&s8(x)===C.type){r(g,C.sibling),y=a(C,b.props),y.ref=mg(g,C,b),y.return=g,g=y;break e}r(g,C);break}else t(g,C);C=C.sibling}b.type===vv?(y=Lh(b.props.children,g.mode,S,b.key),y.return=g,g=y):(S=Wx(b.type,b.key,b.props,null,g.mode,S),S.ref=mg(g,y,b),S.return=g,g=S)}return o(g);case mv:e:{for(C=b.key;y!==null;){if(y.key===C)if(y.tag===4&&y.stateNode.containerInfo===b.containerInfo&&y.stateNode.implementation===b.implementation){r(g,y.sibling),y=a(y,b.children||[]),y.return=g,g=y;break e}else{r(g,y);break}else t(g,y);y=y.sibling}y=I4(b,g.mode,S),y.return=g,g=y}return o(g);case wf:return C=b._init,v(g,y,C(b._payload),S)}if(Xg(b))return h(g,y,b,S);if(cg(b))return m(g,y,b,S);p2(g,b)}return typeof b=="string"&&b!==""||typeof b=="number"?(b=""+b,y!==null&&y.tag===6?(r(g,y.sibling),y=a(y,b),y.return=g,g=y):(r(g,y),y=P4(b,g.mode,S),y.return=g,g=y),o(g)):r(g,y)}return v}var o0=vV(!0),gV=vV(!1),J1={},Xl=Ep(J1),n1=Ep(J1),a1=Ep(J1);function Ah(e){if(e===J1)throw Error(Ot(174));return e}function wM(e,t){switch(Zn(a1,t),Zn(n1,e),Zn(Xl,J1),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:hE(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=hE(t,e)}ua(Xl),Zn(Xl,t)}function s0(){ua(Xl),ua(n1),ua(a1)}function yV(e){Ah(a1.current);var t=Ah(Xl.current),r=hE(t,e.type);t!==r&&(Zn(n1,e),Zn(Xl,r))}function _M(e){n1.current===e&&(ua(Xl),ua(n1))}var ba=Ep(0);function NS(e){for(var t=e;t!==null;){if(t.tag===13){var r=t.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||r.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if((t.flags&128)!==0)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var C4=[];function AM(){for(var e=0;e<C4.length;e++)C4[e]._workInProgressVersionPrimary=null;C4.length=0}var Vx=Md.ReactCurrentDispatcher,w4=Md.ReactCurrentBatchConfig,Jh=0,Ca=null,Za=null,vi=null,zS=!1,py=!1,i1=0,Qte=0;function Vi(){throw Error(Ot(321))}function TM(e,t){if(t===null)return!1;for(var r=0;r<t.length&&r<e.length;r++)if(!el(e[r],t[r]))return!1;return!0}function EM(e,t,r,n,a,i){if(Jh=i,Ca=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,Vx.current=e===null||e.memoizedState===null?tre:rre,e=r(n,a),py){i=0;do{if(py=!1,i1=0,25<=i)throw Error(Ot(301));i+=1,vi=Za=null,t.updateQueue=null,Vx.current=nre,e=r(n,a)}while(py)}if(Vx.current=US,t=Za!==null&&Za.next!==null,Jh=0,vi=Za=Ca=null,zS=!1,t)throw Error(Ot(300));return e}function PM(){var e=i1!==0;return i1=0,e}function El(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return vi===null?Ca.memoizedState=vi=e:vi=vi.next=e,vi}function cu(){if(Za===null){var e=Ca.alternate;e=e!==null?e.memoizedState:null}else e=Za.next;var t=vi===null?Ca.memoizedState:vi.next;if(t!==null)vi=t,Za=e;else{if(e===null)throw Error(Ot(310));Za=e,e={memoizedState:Za.memoizedState,baseState:Za.baseState,baseQueue:Za.baseQueue,queue:Za.queue,next:null},vi===null?Ca.memoizedState=vi=e:vi=vi.next=e}return vi}function o1(e,t){return typeof t=="function"?t(e):t}function _4(e){var t=cu(),r=t.queue;if(r===null)throw Error(Ot(311));r.lastRenderedReducer=e;var n=Za,a=n.baseQueue,i=r.pending;if(i!==null){if(a!==null){var o=a.next;a.next=i.next,i.next=o}n.baseQueue=a=i,r.pending=null}if(a!==null){i=a.next,n=n.baseState;var s=o=null,u=null,l=i;do{var c=l.lane;if((Jh&c)===c)u!==null&&(u=u.next={lane:0,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null}),n=l.hasEagerState?l.eagerState:e(n,l.action);else{var d={lane:c,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null};u===null?(s=u=d,o=n):u=u.next=d,Ca.lanes|=c,em|=c}l=l.next}while(l!==null&&l!==i);u===null?o=n:u.next=s,el(n,t.memoizedState)||(Lo=!0),t.memoizedState=n,t.baseState=o,t.baseQueue=u,r.lastRenderedState=n}if(e=r.interleaved,e!==null){a=e;do i=a.lane,Ca.lanes|=i,em|=i,a=a.next;while(a!==e)}else a===null&&(r.lanes=0);return[t.memoizedState,r.dispatch]}function A4(e){var t=cu(),r=t.queue;if(r===null)throw Error(Ot(311));r.lastRenderedReducer=e;var n=r.dispatch,a=r.pending,i=t.memoizedState;if(a!==null){r.pending=null;var o=a=a.next;do i=e(i,o.action),o=o.next;while(o!==a);el(i,t.memoizedState)||(Lo=!0),t.memoizedState=i,t.baseQueue===null&&(t.baseState=i),r.lastRenderedState=i}return[i,n]}function bV(){}function xV(e,t){var r=Ca,n=cu(),a=t(),i=!el(n.memoizedState,a);if(i&&(n.memoizedState=a,Lo=!0),n=n.queue,IM(wV.bind(null,r,n,e),[e]),n.getSnapshot!==t||i||vi!==null&&vi.memoizedState.tag&1){if(r.flags|=2048,s1(9,CV.bind(null,r,n,a,t),void 0,null),bi===null)throw Error(Ot(349));(Jh&30)!==0||SV(r,t,a)}return a}function SV(e,t,r){e.flags|=16384,e={getSnapshot:t,value:r},t=Ca.updateQueue,t===null?(t={lastEffect:null,stores:null},Ca.updateQueue=t,t.stores=[e]):(r=t.stores,r===null?t.stores=[e]:r.push(e))}function CV(e,t,r,n){t.value=r,t.getSnapshot=n,_V(t)&&AV(e)}function wV(e,t,r){return r(function(){_V(t)&&AV(e)})}function _V(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!el(e,r)}catch{return!0}}function AV(e){var t=sd(e,1);t!==null&&Gu(t,e,1,-1)}function u8(e){var t=El();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:o1,lastRenderedState:e},t.queue=e,e=e.dispatch=ere.bind(null,Ca,e),[t.memoizedState,e]}function s1(e,t,r,n){return e={tag:e,create:t,destroy:r,deps:n,next:null},t=Ca.updateQueue,t===null?(t={lastEffect:null,stores:null},Ca.updateQueue=t,t.lastEffect=e.next=e):(r=t.lastEffect,r===null?t.lastEffect=e.next=e:(n=r.next,r.next=e,e.next=n,t.lastEffect=e)),e}function TV(){return cu().memoizedState}function Hx(e,t,r,n){var a=El();Ca.flags|=e,a.memoizedState=s1(1|t,r,void 0,n===void 0?null:n)}function z3(e,t,r,n){var a=cu();n=n===void 0?null:n;var i=void 0;if(Za!==null){var o=Za.memoizedState;if(i=o.destroy,n!==null&&TM(n,o.deps)){a.memoizedState=s1(t,r,i,n);return}}Ca.flags|=e,a.memoizedState=s1(1|t,r,i,n)}function l8(e,t){return Hx(8390656,8,e,t)}function IM(e,t){return z3(2048,8,e,t)}function EV(e,t){return z3(4,2,e,t)}function PV(e,t){return z3(4,4,e,t)}function IV(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function MV(e,t,r){return r=r!=null?r.concat([e]):null,z3(4,4,IV.bind(null,t,e),r)}function MM(){}function DV(e,t){var r=cu();t=t===void 0?null:t;var n=r.memoizedState;return n!==null&&t!==null&&TM(t,n[1])?n[0]:(r.memoizedState=[e,t],e)}function kV(e,t){var r=cu();t=t===void 0?null:t;var n=r.memoizedState;return n!==null&&t!==null&&TM(t,n[1])?n[0]:(e=e(),r.memoizedState=[e,t],e)}function RV(e,t,r){return(Jh&21)===0?(e.baseState&&(e.baseState=!1,Lo=!0),e.memoizedState=r):(el(r,t)||(r=FU(),Ca.lanes|=r,em|=r,e.baseState=!0),t)}function Zte(e,t){var r=Dn;Dn=r!==0&&4>r?r:4,e(!0);var n=w4.transition;w4.transition={};try{e(!1),t()}finally{Dn=r,w4.transition=n}}function OV(){return cu().memoizedState}function Jte(e,t,r){var n=np(e);if(r={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null},BV(e))FV(t,r);else if(r=fV(e,t,r,n),r!==null){var a=mo();Gu(r,e,n,a),LV(r,t,n)}}function ere(e,t,r){var n=np(e),a={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null};if(BV(e))FV(t,a);else{var i=e.alternate;if(e.lanes===0&&(i===null||i.lanes===0)&&(i=t.lastRenderedReducer,i!==null))try{var o=t.lastRenderedState,s=i(o,r);if(a.hasEagerState=!0,a.eagerState=s,el(s,o)){var u=t.interleaved;u===null?(a.next=a,SM(t)):(a.next=u.next,u.next=a),t.interleaved=a;return}}catch{}finally{}r=fV(e,t,a,n),r!==null&&(a=mo(),Gu(r,e,n,a),LV(r,t,n))}}function BV(e){var t=e.alternate;return e===Ca||t!==null&&t===Ca}function FV(e,t){py=zS=!0;var r=e.pending;r===null?t.next=t:(t.next=r.next,r.next=t),e.pending=t}function LV(e,t,r){if((r&4194240)!==0){var n=t.lanes;n&=e.pendingLanes,r|=n,t.lanes=r,sM(e,r)}}var US={readContext:lu,useCallback:Vi,useContext:Vi,useEffect:Vi,useImperativeHandle:Vi,useInsertionEffect:Vi,useLayoutEffect:Vi,useMemo:Vi,useReducer:Vi,useRef:Vi,useState:Vi,useDebugValue:Vi,useDeferredValue:Vi,useTransition:Vi,useMutableSource:Vi,useSyncExternalStore:Vi,useId:Vi,unstable_isNewReconciler:!1},tre={readContext:lu,useCallback:function(e,t){return El().memoizedState=[e,t===void 0?null:t],e},useContext:lu,useEffect:l8,useImperativeHandle:function(e,t,r){return r=r!=null?r.concat([e]):null,Hx(4194308,4,IV.bind(null,t,e),r)},useLayoutEffect:function(e,t){return Hx(4194308,4,e,t)},useInsertionEffect:function(e,t){return Hx(4,2,e,t)},useMemo:function(e,t){var r=El();return t=t===void 0?null:t,e=e(),r.memoizedState=[e,t],e},useReducer:function(e,t,r){var n=El();return t=r!==void 0?r(t):t,n.memoizedState=n.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},n.queue=e,e=e.dispatch=Jte.bind(null,Ca,e),[n.memoizedState,e]},useRef:function(e){var t=El();return e={current:e},t.memoizedState=e},useState:u8,useDebugValue:MM,useDeferredValue:function(e){return El().memoizedState=e},useTransition:function(){var e=u8(!1),t=e[0];return e=Zte.bind(null,e[1]),El().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,r){var n=Ca,a=El();if(va){if(r===void 0)throw Error(Ot(407));r=r()}else{if(r=t(),bi===null)throw Error(Ot(349));(Jh&30)!==0||SV(n,t,r)}a.memoizedState=r;var i={value:r,getSnapshot:t};return a.queue=i,l8(wV.bind(null,n,i,e),[e]),n.flags|=2048,s1(9,CV.bind(null,n,i,r,t),void 0,null),r},useId:function(){var e=El(),t=bi.identifierPrefix;if(va){var r=Wc,n=qc;r=(n&~(1<<32-ju(n)-1)).toString(32)+r,t=":"+t+"R"+r,r=i1++,0<r&&(t+="H"+r.toString(32)),t+=":"}else r=Qte++,t=":"+t+"r"+r.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},rre={readContext:lu,useCallback:DV,useContext:lu,useEffect:IM,useImperativeHandle:MV,useInsertionEffect:EV,useLayoutEffect:PV,useMemo:kV,useReducer:_4,useRef:TV,useState:function(){return _4(o1)},useDebugValue:MM,useDeferredValue:function(e){var t=cu();return RV(t,Za.memoizedState,e)},useTransition:function(){var e=_4(o1)[0],t=cu().memoizedState;return[e,t]},useMutableSource:bV,useSyncExternalStore:xV,useId:OV,unstable_isNewReconciler:!1},nre={readContext:lu,useCallback:DV,useContext:lu,useEffect:IM,useImperativeHandle:MV,useInsertionEffect:EV,useLayoutEffect:PV,useMemo:kV,useReducer:A4,useRef:TV,useState:function(){return A4(o1)},useDebugValue:MM,useDeferredValue:function(e){var t=cu();return Za===null?t.memoizedState=e:RV(t,Za.memoizedState,e)},useTransition:function(){var e=A4(o1)[0],t=cu().memoizedState;return[e,t]},useMutableSource:bV,useSyncExternalStore:xV,useId:OV,unstable_isNewReconciler:!1};function u0(e,t){try{var r="",n=t;do r+=Dee(n),n=n.return;while(n);var a=r}catch(i){a=`
Error generating stack: `+i.message+`
`+i.stack}return{value:e,source:t,stack:a,digest:null}}function T4(e,t,r){return{value:e,source:null,stack:r??null,digest:t??null}}function LE(e,t){try{console.error(t.value)}catch(r){setTimeout(function(){throw r})}}var are=typeof WeakMap=="function"?WeakMap:Map;function NV(e,t,r){r=ed(-1,r),r.tag=3,r.payload={element:null};var n=t.value;return r.callback=function(){HS||(HS=!0,XE=n),LE(e,t)},r}function zV(e,t,r){r=ed(-1,r),r.tag=3;var n=e.type.getDerivedStateFromError;if(typeof n=="function"){var a=t.value;r.payload=function(){return n(a)},r.callback=function(){LE(e,t)}}var i=e.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(r.callback=function(){LE(e,t),typeof n!="function"&&(rp===null?rp=new Set([this]):rp.add(this));var o=t.stack;this.componentDidCatch(t.value,{componentStack:o!==null?o:""})}),r}function c8(e,t,r){var n=e.pingCache;if(n===null){n=e.pingCache=new are;var a=new Set;n.set(t,a)}else a=n.get(t),a===void 0&&(a=new Set,n.set(t,a));a.has(r)||(a.add(r),e=yre.bind(null,e,t,r),t.then(e,e))}function d8(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function f8(e,t,r,n,a){return(e.mode&1)===0?(e===t?e.flags|=65536:(e.flags|=128,r.flags|=131072,r.flags&=-52805,r.tag===1&&(r.alternate===null?r.tag=17:(t=ed(-1,1),t.tag=2,tp(r,t,1))),r.lanes|=1),e):(e.flags|=65536,e.lanes=a,e)}var ire=Md.ReactCurrentOwner,Lo=!1;function co(e,t,r,n){t.child=e===null?gV(t,null,r,n):o0(t,e.child,r,n)}function p8(e,t,r,n,a){r=r.render;var i=t.ref;return Vv(t,a),n=EM(e,t,r,n,i,a),r=PM(),e!==null&&!Lo?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,ud(e,t,a)):(va&&r&&mM(t),t.flags|=1,co(e,t,n,a),t.child)}function h8(e,t,r,n,a){if(e===null){var i=r.type;return typeof i=="function"&&!NM(i)&&i.defaultProps===void 0&&r.compare===null&&r.defaultProps===void 0?(t.tag=15,t.type=i,UV(e,t,i,n,a)):(e=Wx(r.type,null,n,t,t.mode,a),e.ref=t.ref,e.return=t,t.child=e)}if(i=e.child,(e.lanes&a)===0){var o=i.memoizedProps;if(r=r.compare,r=r!==null?r:Jy,r(o,n)&&e.ref===t.ref)return ud(e,t,a)}return t.flags|=1,e=ap(i,n),e.ref=t.ref,e.return=t,t.child=e}function UV(e,t,r,n,a){if(e!==null){var i=e.memoizedProps;if(Jy(i,n)&&e.ref===t.ref)if(Lo=!1,t.pendingProps=n=i,(e.lanes&a)!==0)(e.flags&131072)!==0&&(Lo=!0);else return t.lanes=e.lanes,ud(e,t,a)}return NE(e,t,r,n,a)}function VV(e,t,r){var n=t.pendingProps,a=n.children,i=e!==null?e.memoizedState:null;if(n.mode==="hidden")if((t.mode&1)===0)t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Zn(Tv,us),us|=r;else{if((r&1073741824)===0)return e=i!==null?i.baseLanes|r:r,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Zn(Tv,us),us|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=i!==null?i.baseLanes:r,Zn(Tv,us),us|=n}else i!==null?(n=i.baseLanes|r,t.memoizedState=null):n=r,Zn(Tv,us),us|=n;return co(e,t,a,r),t.child}function HV(e,t){var r=t.ref;(e===null&&r!==null||e!==null&&e.ref!==r)&&(t.flags|=512,t.flags|=2097152)}function NE(e,t,r,n,a){var i=zo(r)?Qh:Zi.current;return i=a0(t,i),Vv(t,a),r=EM(e,t,r,n,i,a),n=PM(),e!==null&&!Lo?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,ud(e,t,a)):(va&&n&&mM(t),t.flags|=1,co(e,t,r,a),t.child)}function m8(e,t,r,n,a){if(zo(r)){var i=!0;kS(t)}else i=!1;if(Vv(t,a),t.stateNode===null)jx(e,t),mV(t,r,n),FE(t,r,n,a),n=!0;else if(e===null){var o=t.stateNode,s=t.memoizedProps;o.props=s;var u=o.context,l=r.contextType;typeof l=="object"&&l!==null?l=lu(l):(l=zo(r)?Qh:Zi.current,l=a0(t,l));var c=r.getDerivedStateFromProps,d=typeof c=="function"||typeof o.getSnapshotBeforeUpdate=="function";d||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(s!==n||u!==l)&&o8(t,o,n,l),_f=!1;var f=t.memoizedState;o.state=f,LS(t,n,o,a),u=t.memoizedState,s!==n||f!==u||No.current||_f?(typeof c=="function"&&(BE(t,r,c,n),u=t.memoizedState),(s=_f||i8(t,r,s,n,f,u,l))?(d||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(t.flags|=4194308)):(typeof o.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=n,t.memoizedState=u),o.props=n,o.state=u,o.context=l,n=s):(typeof o.componentDidMount=="function"&&(t.flags|=4194308),n=!1)}else{o=t.stateNode,pV(e,t),s=t.memoizedProps,l=t.type===t.elementType?s:Ru(t.type,s),o.props=l,d=t.pendingProps,f=o.context,u=r.contextType,typeof u=="object"&&u!==null?u=lu(u):(u=zo(r)?Qh:Zi.current,u=a0(t,u));var p=r.getDerivedStateFromProps;(c=typeof p=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(s!==d||f!==u)&&o8(t,o,n,u),_f=!1,f=t.memoizedState,o.state=f,LS(t,n,o,a);var h=t.memoizedState;s!==d||f!==h||No.current||_f?(typeof p=="function"&&(BE(t,r,p,n),h=t.memoizedState),(l=_f||i8(t,r,l,n,f,h,u)||!1)?(c||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(n,h,u),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(n,h,u)),typeof o.componentDidUpdate=="function"&&(t.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof o.componentDidUpdate!="function"||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=1024),t.memoizedProps=n,t.memoizedState=h),o.props=n,o.state=h,o.context=u,n=l):(typeof o.componentDidUpdate!="function"||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=1024),n=!1)}return zE(e,t,r,n,i,a)}function zE(e,t,r,n,a,i){HV(e,t);var o=(t.flags&128)!==0;if(!n&&!o)return a&&e8(t,r,!1),ud(e,t,i);n=t.stateNode,ire.current=t;var s=o&&typeof r.getDerivedStateFromError!="function"?null:n.render();return t.flags|=1,e!==null&&o?(t.child=o0(t,e.child,null,i),t.child=o0(t,null,s,i)):co(e,t,s,i),t.memoizedState=n.state,a&&e8(t,r,!0),t.child}function jV(e){var t=e.stateNode;t.pendingContext?J6(e,t.pendingContext,t.pendingContext!==t.context):t.context&&J6(e,t.context,!1),wM(e,t.containerInfo)}function v8(e,t,r,n,a){return i0(),gM(a),t.flags|=256,co(e,t,r,n),t.child}var UE={dehydrated:null,treeContext:null,retryLane:0};function VE(e){return{baseLanes:e,cachePool:null,transitions:null}}function GV(e,t,r){var n=t.pendingProps,a=ba.current,i=!1,o=(t.flags&128)!==0,s;if((s=o)||(s=e!==null&&e.memoizedState===null?!1:(a&2)!==0),s?(i=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(a|=1),Zn(ba,a&1),e===null)return RE(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?((t.mode&1)===0?t.lanes=1:e.data==="$!"?t.lanes=8:t.lanes=1073741824,null):(o=n.children,e=n.fallback,i?(n=t.mode,i=t.child,o={mode:"hidden",children:o},(n&1)===0&&i!==null?(i.childLanes=0,i.pendingProps=o):i=H3(o,n,0,null),e=Lh(e,n,r,null),i.return=t,e.return=t,i.sibling=e,t.child=i,t.child.memoizedState=VE(r),t.memoizedState=UE,e):DM(t,o));if(a=e.memoizedState,a!==null&&(s=a.dehydrated,s!==null))return ore(e,t,o,n,s,a,r);if(i){i=n.fallback,o=t.mode,a=e.child,s=a.sibling;var u={mode:"hidden",children:n.children};return(o&1)===0&&t.child!==a?(n=t.child,n.childLanes=0,n.pendingProps=u,t.deletions=null):(n=ap(a,u),n.subtreeFlags=a.subtreeFlags&14680064),s!==null?i=ap(s,i):(i=Lh(i,o,r,null),i.flags|=2),i.return=t,n.return=t,n.sibling=i,t.child=n,n=i,i=t.child,o=e.child.memoizedState,o=o===null?VE(r):{baseLanes:o.baseLanes|r,cachePool:null,transitions:o.transitions},i.memoizedState=o,i.childLanes=e.childLanes&~r,t.memoizedState=UE,n}return i=e.child,e=i.sibling,n=ap(i,{mode:"visible",children:n.children}),(t.mode&1)===0&&(n.lanes=r),n.return=t,n.sibling=null,e!==null&&(r=t.deletions,r===null?(t.deletions=[e],t.flags|=16):r.push(e)),t.child=n,t.memoizedState=null,n}function DM(e,t){return t=H3({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function h2(e,t,r,n){return n!==null&&gM(n),o0(t,e.child,null,r),e=DM(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function ore(e,t,r,n,a,i,o){if(r)return t.flags&256?(t.flags&=-257,n=T4(Error(Ot(422))),h2(e,t,o,n)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(i=n.fallback,a=t.mode,n=H3({mode:"visible",children:n.children},a,0,null),i=Lh(i,a,o,null),i.flags|=2,n.return=t,i.return=t,n.sibling=i,t.child=n,(t.mode&1)!==0&&o0(t,e.child,null,o),t.child.memoizedState=VE(o),t.memoizedState=UE,i);if((t.mode&1)===0)return h2(e,t,o,null);if(a.data==="$!"){if(n=a.nextSibling&&a.nextSibling.dataset,n)var s=n.dgst;return n=s,i=Error(Ot(419)),n=T4(i,n,void 0),h2(e,t,o,n)}if(s=(o&e.childLanes)!==0,Lo||s){if(n=bi,n!==null){switch(o&-o){case 4:a=2;break;case 16:a=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:a=32;break;case 536870912:a=268435456;break;default:a=0}a=(a&(n.suspendedLanes|o))!==0?0:a,a!==0&&a!==i.retryLane&&(i.retryLane=a,sd(e,a),Gu(n,e,a,-1))}return LM(),n=T4(Error(Ot(421))),h2(e,t,o,n)}return a.data==="$?"?(t.flags|=128,t.child=e.child,t=bre.bind(null,e),a._reactRetry=t,null):(e=i.treeContext,ds=ep(a.nextSibling),hs=t,va=!0,Lu=null,e!==null&&(Js[eu++]=qc,Js[eu++]=Wc,Js[eu++]=Zh,qc=e.id,Wc=e.overflow,Zh=t),t=DM(t,n.children),t.flags|=4096,t)}function g8(e,t,r){e.lanes|=t;var n=e.alternate;n!==null&&(n.lanes|=t),OE(e.return,t,r)}function E4(e,t,r,n,a){var i=e.memoizedState;i===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:n,tail:r,tailMode:a}:(i.isBackwards=t,i.rendering=null,i.renderingStartTime=0,i.last=n,i.tail=r,i.tailMode=a)}function qV(e,t,r){var n=t.pendingProps,a=n.revealOrder,i=n.tail;if(co(e,t,n.children,r),n=ba.current,(n&2)!==0)n=n&1|2,t.flags|=128;else{if(e!==null&&(e.flags&128)!==0)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&g8(e,r,t);else if(e.tag===19)g8(e,r,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}n&=1}if(Zn(ba,n),(t.mode&1)===0)t.memoizedState=null;else switch(a){case"forwards":for(r=t.child,a=null;r!==null;)e=r.alternate,e!==null&&NS(e)===null&&(a=r),r=r.sibling;r=a,r===null?(a=t.child,t.child=null):(a=r.sibling,r.sibling=null),E4(t,!1,a,r,i);break;case"backwards":for(r=null,a=t.child,t.child=null;a!==null;){if(e=a.alternate,e!==null&&NS(e)===null){t.child=a;break}e=a.sibling,a.sibling=r,r=a,a=e}E4(t,!0,r,null,i);break;case"together":E4(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function jx(e,t){(t.mode&1)===0&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function ud(e,t,r){if(e!==null&&(t.dependencies=e.dependencies),em|=t.lanes,(r&t.childLanes)===0)return null;if(e!==null&&t.child!==e.child)throw Error(Ot(153));if(t.child!==null){for(e=t.child,r=ap(e,e.pendingProps),t.child=r,r.return=t;e.sibling!==null;)e=e.sibling,r=r.sibling=ap(e,e.pendingProps),r.return=t;r.sibling=null}return t.child}function sre(e,t,r){switch(t.tag){case 3:jV(t),i0();break;case 5:yV(t);break;case 1:zo(t.type)&&kS(t);break;case 4:wM(t,t.stateNode.containerInfo);break;case 10:var n=t.type._context,a=t.memoizedProps.value;Zn(BS,n._currentValue),n._currentValue=a;break;case 13:if(n=t.memoizedState,n!==null)return n.dehydrated!==null?(Zn(ba,ba.current&1),t.flags|=128,null):(r&t.child.childLanes)!==0?GV(e,t,r):(Zn(ba,ba.current&1),e=ud(e,t,r),e!==null?e.sibling:null);Zn(ba,ba.current&1);break;case 19:if(n=(r&t.childLanes)!==0,(e.flags&128)!==0){if(n)return qV(e,t,r);t.flags|=128}if(a=t.memoizedState,a!==null&&(a.rendering=null,a.tail=null,a.lastEffect=null),Zn(ba,ba.current),n)break;return null;case 22:case 23:return t.lanes=0,VV(e,t,r)}return ud(e,t,r)}var WV,HE,XV,YV;WV=function(e,t){for(var r=t.child;r!==null;){if(r.tag===5||r.tag===6)e.appendChild(r.stateNode);else if(r.tag!==4&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===t)break;for(;r.sibling===null;){if(r.return===null||r.return===t)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};HE=function(){};XV=function(e,t,r,n){var a=e.memoizedProps;if(a!==n){e=t.stateNode,Ah(Xl.current);var i=null;switch(r){case"input":a=cE(e,a),n=cE(e,n),i=[];break;case"select":a=_a({},a,{value:void 0}),n=_a({},n,{value:void 0}),i=[];break;case"textarea":a=pE(e,a),n=pE(e,n),i=[];break;default:typeof a.onClick!="function"&&typeof n.onClick=="function"&&(e.onclick=MS)}mE(r,n);var o;r=null;for(l in a)if(!n.hasOwnProperty(l)&&a.hasOwnProperty(l)&&a[l]!=null)if(l==="style"){var s=a[l];for(o in s)s.hasOwnProperty(o)&&(r||(r={}),r[o]="")}else l!=="dangerouslySetInnerHTML"&&l!=="children"&&l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&l!=="autoFocus"&&(Wy.hasOwnProperty(l)?i||(i=[]):(i=i||[]).push(l,null));for(l in n){var u=n[l];if(s=a?.[l],n.hasOwnProperty(l)&&u!==s&&(u!=null||s!=null))if(l==="style")if(s){for(o in s)!s.hasOwnProperty(o)||u&&u.hasOwnProperty(o)||(r||(r={}),r[o]="");for(o in u)u.hasOwnProperty(o)&&s[o]!==u[o]&&(r||(r={}),r[o]=u[o])}else r||(i||(i=[]),i.push(l,r)),r=u;else l==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,s=s?s.__html:void 0,u!=null&&s!==u&&(i=i||[]).push(l,u)):l==="children"?typeof u!="string"&&typeof u!="number"||(i=i||[]).push(l,""+u):l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&(Wy.hasOwnProperty(l)?(u!=null&&l==="onScroll"&&ra("scroll",e),i||s===u||(i=[])):(i=i||[]).push(l,u))}r&&(i=i||[]).push("style",r);var l=i;(t.updateQueue=l)&&(t.flags|=4)}};YV=function(e,t,r,n){r!==n&&(t.flags|=4)};function vg(e,t){if(!va)switch(e.tailMode){case"hidden":t=e.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e.tail=null:r.sibling=null;break;case"collapsed":r=e.tail;for(var n=null;r!==null;)r.alternate!==null&&(n=r),r=r.sibling;n===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:n.sibling=null}}function Hi(e){var t=e.alternate!==null&&e.alternate.child===e.child,r=0,n=0;if(t)for(var a=e.child;a!==null;)r|=a.lanes|a.childLanes,n|=a.subtreeFlags&14680064,n|=a.flags&14680064,a.return=e,a=a.sibling;else for(a=e.child;a!==null;)r|=a.lanes|a.childLanes,n|=a.subtreeFlags,n|=a.flags,a.return=e,a=a.sibling;return e.subtreeFlags|=n,e.childLanes=r,t}function ure(e,t,r){var n=t.pendingProps;switch(vM(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Hi(t),null;case 1:return zo(t.type)&&DS(),Hi(t),null;case 3:return n=t.stateNode,s0(),ua(No),ua(Zi),AM(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(e===null||e.child===null)&&(f2(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&(t.flags&256)===0||(t.flags|=1024,Lu!==null&&($E(Lu),Lu=null))),HE(e,t),Hi(t),null;case 5:_M(t);var a=Ah(a1.current);if(r=t.type,e!==null&&t.stateNode!=null)XV(e,t,r,n,a),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!n){if(t.stateNode===null)throw Error(Ot(166));return Hi(t),null}if(e=Ah(Xl.current),f2(t)){n=t.stateNode,r=t.type;var i=t.memoizedProps;switch(n[Nl]=t,n[r1]=i,e=(t.mode&1)!==0,r){case"dialog":ra("cancel",n),ra("close",n);break;case"iframe":case"object":case"embed":ra("load",n);break;case"video":case"audio":for(a=0;a<Kg.length;a++)ra(Kg[a],n);break;case"source":ra("error",n);break;case"img":case"image":case"link":ra("error",n),ra("load",n);break;case"details":ra("toggle",n);break;case"input":T6(n,i),ra("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!i.multiple},ra("invalid",n);break;case"textarea":P6(n,i),ra("invalid",n)}mE(r,i),a=null;for(var o in i)if(i.hasOwnProperty(o)){var s=i[o];o==="children"?typeof s=="string"?n.textContent!==s&&(i.suppressHydrationWarning!==!0&&d2(n.textContent,s,e),a=["children",s]):typeof s=="number"&&n.textContent!==""+s&&(i.suppressHydrationWarning!==!0&&d2(n.textContent,s,e),a=["children",""+s]):Wy.hasOwnProperty(o)&&s!=null&&o==="onScroll"&&ra("scroll",n)}switch(r){case"input":n2(n),E6(n,i,!0);break;case"textarea":n2(n),I6(n);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(n.onclick=MS)}n=a,t.updateQueue=n,n!==null&&(t.flags|=4)}else{o=a.nodeType===9?a:a.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=SU(r)),e==="http://www.w3.org/1999/xhtml"?r==="script"?(e=o.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof n.is=="string"?e=o.createElement(r,{is:n.is}):(e=o.createElement(r),r==="select"&&(o=e,n.multiple?o.multiple=!0:n.size&&(o.size=n.size))):e=o.createElementNS(e,r),e[Nl]=t,e[r1]=n,WV(e,t,!1,!1),t.stateNode=e;e:{switch(o=vE(r,n),r){case"dialog":ra("cancel",e),ra("close",e),a=n;break;case"iframe":case"object":case"embed":ra("load",e),a=n;break;case"video":case"audio":for(a=0;a<Kg.length;a++)ra(Kg[a],e);a=n;break;case"source":ra("error",e),a=n;break;case"img":case"image":case"link":ra("error",e),ra("load",e),a=n;break;case"details":ra("toggle",e),a=n;break;case"input":T6(e,n),a=cE(e,n),ra("invalid",e);break;case"option":a=n;break;case"select":e._wrapperState={wasMultiple:!!n.multiple},a=_a({},n,{value:void 0}),ra("invalid",e);break;case"textarea":P6(e,n),a=pE(e,n),ra("invalid",e);break;default:a=n}mE(r,a),s=a;for(i in s)if(s.hasOwnProperty(i)){var u=s[i];i==="style"?_U(e,u):i==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,u!=null&&CU(e,u)):i==="children"?typeof u=="string"?(r!=="textarea"||u!=="")&&Xy(e,u):typeof u=="number"&&Xy(e,""+u):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(Wy.hasOwnProperty(i)?u!=null&&i==="onScroll"&&ra("scroll",e):u!=null&&tM(e,i,u,o))}switch(r){case"input":n2(e),E6(e,n,!1);break;case"textarea":n2(e),I6(e);break;case"option":n.value!=null&&e.setAttribute("value",""+dp(n.value));break;case"select":e.multiple=!!n.multiple,i=n.value,i!=null?Lv(e,!!n.multiple,i,!1):n.defaultValue!=null&&Lv(e,!!n.multiple,n.defaultValue,!0);break;default:typeof a.onClick=="function"&&(e.onclick=MS)}switch(r){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return Hi(t),null;case 6:if(e&&t.stateNode!=null)YV(e,t,e.memoizedProps,n);else{if(typeof n!="string"&&t.stateNode===null)throw Error(Ot(166));if(r=Ah(a1.current),Ah(Xl.current),f2(t)){if(n=t.stateNode,r=t.memoizedProps,n[Nl]=t,(i=n.nodeValue!==r)&&(e=hs,e!==null))switch(e.tag){case 3:d2(n.nodeValue,r,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&d2(n.nodeValue,r,(e.mode&1)!==0)}i&&(t.flags|=4)}else n=(r.nodeType===9?r:r.ownerDocument).createTextNode(n),n[Nl]=t,t.stateNode=n}return Hi(t),null;case 13:if(ua(ba),n=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(va&&ds!==null&&(t.mode&1)!==0&&(t.flags&128)===0)dV(),i0(),t.flags|=98560,i=!1;else if(i=f2(t),n!==null&&n.dehydrated!==null){if(e===null){if(!i)throw Error(Ot(318));if(i=t.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(Ot(317));i[Nl]=t}else i0(),(t.flags&128)===0&&(t.memoizedState=null),t.flags|=4;Hi(t),i=!1}else Lu!==null&&($E(Lu),Lu=null),i=!0;if(!i)return t.flags&65536?t:null}return(t.flags&128)!==0?(t.lanes=r,t):(n=n!==null,n!==(e!==null&&e.memoizedState!==null)&&n&&(t.child.flags|=8192,(t.mode&1)!==0&&(e===null||(ba.current&1)!==0?Ja===0&&(Ja=3):LM())),t.updateQueue!==null&&(t.flags|=4),Hi(t),null);case 4:return s0(),HE(e,t),e===null&&e1(t.stateNode.containerInfo),Hi(t),null;case 10:return xM(t.type._context),Hi(t),null;case 17:return zo(t.type)&&DS(),Hi(t),null;case 19:if(ua(ba),i=t.memoizedState,i===null)return Hi(t),null;if(n=(t.flags&128)!==0,o=i.rendering,o===null)if(n)vg(i,!1);else{if(Ja!==0||e!==null&&(e.flags&128)!==0)for(e=t.child;e!==null;){if(o=NS(e),o!==null){for(t.flags|=128,vg(i,!1),n=o.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),t.subtreeFlags=0,n=r,r=t.child;r!==null;)i=r,e=n,i.flags&=14680066,o=i.alternate,o===null?(i.childLanes=0,i.lanes=e,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=o.childLanes,i.lanes=o.lanes,i.child=o.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=o.memoizedProps,i.memoizedState=o.memoizedState,i.updateQueue=o.updateQueue,i.type=o.type,e=o.dependencies,i.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),r=r.sibling;return Zn(ba,ba.current&1|2),t.child}e=e.sibling}i.tail!==null&&Oa()>l0&&(t.flags|=128,n=!0,vg(i,!1),t.lanes=4194304)}else{if(!n)if(e=NS(o),e!==null){if(t.flags|=128,n=!0,r=e.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),vg(i,!0),i.tail===null&&i.tailMode==="hidden"&&!o.alternate&&!va)return Hi(t),null}else 2*Oa()-i.renderingStartTime>l0&&r!==1073741824&&(t.flags|=128,n=!0,vg(i,!1),t.lanes=4194304);i.isBackwards?(o.sibling=t.child,t.child=o):(r=i.last,r!==null?r.sibling=o:t.child=o,i.last=o)}return i.tail!==null?(t=i.tail,i.rendering=t,i.tail=t.sibling,i.renderingStartTime=Oa(),t.sibling=null,r=ba.current,Zn(ba,n?r&1|2:r&1),t):(Hi(t),null);case 22:case 23:return FM(),n=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==n&&(t.flags|=8192),n&&(t.mode&1)!==0?(us&1073741824)!==0&&(Hi(t),t.subtreeFlags&6&&(t.flags|=8192)):Hi(t),null;case 24:return null;case 25:return null}throw Error(Ot(156,t.tag))}function lre(e,t){switch(vM(t),t.tag){case 1:return zo(t.type)&&DS(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return s0(),ua(No),ua(Zi),AM(),e=t.flags,(e&65536)!==0&&(e&128)===0?(t.flags=e&-65537|128,t):null;case 5:return _M(t),null;case 13:if(ua(ba),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(Ot(340));i0()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return ua(ba),null;case 4:return s0(),null;case 10:return xM(t.type._context),null;case 22:case 23:return FM(),null;case 24:return null;default:return null}}var m2=!1,Yi=!1,cre=typeof WeakSet=="function"?WeakSet:Set,Kt=null;function Av(e,t){var r=e.ref;if(r!==null)if(typeof r=="function")try{r(null)}catch(n){Pa(e,t,n)}else r.current=null}function jE(e,t,r){try{r()}catch(n){Pa(e,t,n)}}var y8=!1;function dre(e,t){if(TE=ES,e=ZU(),hM(e)){if("selectionStart"in e)var r={start:e.selectionStart,end:e.selectionEnd};else e:{r=(r=e.ownerDocument)&&r.defaultView||window;var n=r.getSelection&&r.getSelection();if(n&&n.rangeCount!==0){r=n.anchorNode;var a=n.anchorOffset,i=n.focusNode;n=n.focusOffset;try{r.nodeType,i.nodeType}catch{r=null;break e}var o=0,s=-1,u=-1,l=0,c=0,d=e,f=null;t:for(;;){for(var p;d!==r||a!==0&&d.nodeType!==3||(s=o+a),d!==i||n!==0&&d.nodeType!==3||(u=o+n),d.nodeType===3&&(o+=d.nodeValue.length),(p=d.firstChild)!==null;)f=d,d=p;for(;;){if(d===e)break t;if(f===r&&++l===a&&(s=o),f===i&&++c===n&&(u=o),(p=d.nextSibling)!==null)break;d=f,f=d.parentNode}d=p}r=s===-1||u===-1?null:{start:s,end:u}}else r=null}r=r||{start:0,end:0}}else r=null;for(EE={focusedElem:e,selectionRange:r},ES=!1,Kt=t;Kt!==null;)if(t=Kt,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,Kt=e;else for(;Kt!==null;){t=Kt;try{var h=t.alternate;if((t.flags&1024)!==0)switch(t.tag){case 0:case 11:case 15:break;case 1:if(h!==null){var m=h.memoizedProps,v=h.memoizedState,g=t.stateNode,y=g.getSnapshotBeforeUpdate(t.elementType===t.type?m:Ru(t.type,m),v);g.__reactInternalSnapshotBeforeUpdate=y}break;case 3:var b=t.stateNode.containerInfo;b.nodeType===1?b.textContent="":b.nodeType===9&&b.documentElement&&b.removeChild(b.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Ot(163))}}catch(S){Pa(t,t.return,S)}if(e=t.sibling,e!==null){e.return=t.return,Kt=e;break}Kt=t.return}return h=y8,y8=!1,h}function hy(e,t,r){var n=t.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var a=n=n.next;do{if((a.tag&e)===e){var i=a.destroy;a.destroy=void 0,i!==void 0&&jE(t,r,i)}a=a.next}while(a!==n)}}function U3(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var r=t=t.next;do{if((r.tag&e)===e){var n=r.create;r.destroy=n()}r=r.next}while(r!==t)}}function GE(e){var t=e.ref;if(t!==null){var r=e.stateNode;switch(e.tag){case 5:e=r;break;default:e=r}typeof t=="function"?t(e):t.current=e}}function KV(e){var t=e.alternate;t!==null&&(e.alternate=null,KV(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[Nl],delete t[r1],delete t[ME],delete t[Xte],delete t[Yte])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function $V(e){return e.tag===5||e.tag===3||e.tag===4}function b8(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||$V(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function qE(e,t,r){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?r.nodeType===8?r.parentNode.insertBefore(e,t):r.insertBefore(e,t):(r.nodeType===8?(t=r.parentNode,t.insertBefore(e,r)):(t=r,t.appendChild(e)),r=r._reactRootContainer,r!=null||t.onclick!==null||(t.onclick=MS));else if(n!==4&&(e=e.child,e!==null))for(qE(e,t,r),e=e.sibling;e!==null;)qE(e,t,r),e=e.sibling}function WE(e,t,r){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?r.insertBefore(e,t):r.appendChild(e);else if(n!==4&&(e=e.child,e!==null))for(WE(e,t,r),e=e.sibling;e!==null;)WE(e,t,r),e=e.sibling}var Pi=null,Bu=!1;function Qd(e,t,r){for(r=r.child;r!==null;)QV(e,t,r),r=r.sibling}function QV(e,t,r){if(Wl&&typeof Wl.onCommitFiberUnmount=="function")try{Wl.onCommitFiberUnmount(k3,r)}catch{}switch(r.tag){case 5:Yi||Av(r,t);case 6:var n=Pi,a=Bu;Pi=null,Qd(e,t,r),Pi=n,Bu=a,Pi!==null&&(Bu?(e=Pi,r=r.stateNode,e.nodeType===8?e.parentNode.removeChild(r):e.removeChild(r)):Pi.removeChild(r.stateNode));break;case 18:Pi!==null&&(Bu?(e=Pi,r=r.stateNode,e.nodeType===8?x4(e.parentNode,r):e.nodeType===1&&x4(e,r),Qy(e)):x4(Pi,r.stateNode));break;case 4:n=Pi,a=Bu,Pi=r.stateNode.containerInfo,Bu=!0,Qd(e,t,r),Pi=n,Bu=a;break;case 0:case 11:case 14:case 15:if(!Yi&&(n=r.updateQueue,n!==null&&(n=n.lastEffect,n!==null))){a=n=n.next;do{var i=a,o=i.destroy;i=i.tag,o!==void 0&&((i&2)!==0||(i&4)!==0)&&jE(r,t,o),a=a.next}while(a!==n)}Qd(e,t,r);break;case 1:if(!Yi&&(Av(r,t),n=r.stateNode,typeof n.componentWillUnmount=="function"))try{n.props=r.memoizedProps,n.state=r.memoizedState,n.componentWillUnmount()}catch(s){Pa(r,t,s)}Qd(e,t,r);break;case 21:Qd(e,t,r);break;case 22:r.mode&1?(Yi=(n=Yi)||r.memoizedState!==null,Qd(e,t,r),Yi=n):Qd(e,t,r);break;default:Qd(e,t,r)}}function x8(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var r=e.stateNode;r===null&&(r=e.stateNode=new cre),t.forEach(function(n){var a=xre.bind(null,e,n);r.has(n)||(r.add(n),n.then(a,a))})}}function Tu(e,t){var r=t.deletions;if(r!==null)for(var n=0;n<r.length;n++){var a=r[n];try{var i=e,o=t,s=o;e:for(;s!==null;){switch(s.tag){case 5:Pi=s.stateNode,Bu=!1;break e;case 3:Pi=s.stateNode.containerInfo,Bu=!0;break e;case 4:Pi=s.stateNode.containerInfo,Bu=!0;break e}s=s.return}if(Pi===null)throw Error(Ot(160));QV(i,o,a),Pi=null,Bu=!1;var u=a.alternate;u!==null&&(u.return=null),a.return=null}catch(l){Pa(a,t,l)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)ZV(t,e),t=t.sibling}function ZV(e,t){var r=e.alternate,n=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(Tu(t,e),vl(e),n&4){try{hy(3,e,e.return),U3(3,e)}catch(m){Pa(e,e.return,m)}try{hy(5,e,e.return)}catch(m){Pa(e,e.return,m)}}break;case 1:Tu(t,e),vl(e),n&512&&r!==null&&Av(r,r.return);break;case 5:if(Tu(t,e),vl(e),n&512&&r!==null&&Av(r,r.return),e.flags&32){var a=e.stateNode;try{Xy(a,"")}catch(m){Pa(e,e.return,m)}}if(n&4&&(a=e.stateNode,a!=null)){var i=e.memoizedProps,o=r!==null?r.memoizedProps:i,s=e.type,u=e.updateQueue;if(e.updateQueue=null,u!==null)try{s==="input"&&i.type==="radio"&&i.name!=null&&bU(a,i),vE(s,o);var l=vE(s,i);for(o=0;o<u.length;o+=2){var c=u[o],d=u[o+1];c==="style"?_U(a,d):c==="dangerouslySetInnerHTML"?CU(a,d):c==="children"?Xy(a,d):tM(a,c,d,l)}switch(s){case"input":dE(a,i);break;case"textarea":xU(a,i);break;case"select":var f=a._wrapperState.wasMultiple;a._wrapperState.wasMultiple=!!i.multiple;var p=i.value;p!=null?Lv(a,!!i.multiple,p,!1):f!==!!i.multiple&&(i.defaultValue!=null?Lv(a,!!i.multiple,i.defaultValue,!0):Lv(a,!!i.multiple,i.multiple?[]:"",!1))}a[r1]=i}catch(m){Pa(e,e.return,m)}}break;case 6:if(Tu(t,e),vl(e),n&4){if(e.stateNode===null)throw Error(Ot(162));a=e.stateNode,i=e.memoizedProps;try{a.nodeValue=i}catch(m){Pa(e,e.return,m)}}break;case 3:if(Tu(t,e),vl(e),n&4&&r!==null&&r.memoizedState.isDehydrated)try{Qy(t.containerInfo)}catch(m){Pa(e,e.return,m)}break;case 4:Tu(t,e),vl(e);break;case 13:Tu(t,e),vl(e),a=e.child,a.flags&8192&&(i=a.memoizedState!==null,a.stateNode.isHidden=i,!i||a.alternate!==null&&a.alternate.memoizedState!==null||(OM=Oa())),n&4&&x8(e);break;case 22:if(c=r!==null&&r.memoizedState!==null,e.mode&1?(Yi=(l=Yi)||c,Tu(t,e),Yi=l):Tu(t,e),vl(e),n&8192){if(l=e.memoizedState!==null,(e.stateNode.isHidden=l)&&!c&&(e.mode&1)!==0)for(Kt=e,c=e.child;c!==null;){for(d=Kt=c;Kt!==null;){switch(f=Kt,p=f.child,f.tag){case 0:case 11:case 14:case 15:hy(4,f,f.return);break;case 1:Av(f,f.return);var h=f.stateNode;if(typeof h.componentWillUnmount=="function"){n=f,r=f.return;try{t=n,h.props=t.memoizedProps,h.state=t.memoizedState,h.componentWillUnmount()}catch(m){Pa(n,r,m)}}break;case 5:Av(f,f.return);break;case 22:if(f.memoizedState!==null){C8(d);continue}}p!==null?(p.return=f,Kt=p):C8(d)}c=c.sibling}e:for(c=null,d=e;;){if(d.tag===5){if(c===null){c=d;try{a=d.stateNode,l?(i=a.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(s=d.stateNode,u=d.memoizedProps.style,o=u!=null&&u.hasOwnProperty("display")?u.display:null,s.style.display=wU("display",o))}catch(m){Pa(e,e.return,m)}}}else if(d.tag===6){if(c===null)try{d.stateNode.nodeValue=l?"":d.memoizedProps}catch(m){Pa(e,e.return,m)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===e)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===e)break e;for(;d.sibling===null;){if(d.return===null||d.return===e)break e;c===d&&(c=null),d=d.return}c===d&&(c=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:Tu(t,e),vl(e),n&4&&x8(e);break;case 21:break;default:Tu(t,e),vl(e)}}function vl(e){var t=e.flags;if(t&2){try{e:{for(var r=e.return;r!==null;){if($V(r)){var n=r;break e}r=r.return}throw Error(Ot(160))}switch(n.tag){case 5:var a=n.stateNode;n.flags&32&&(Xy(a,""),n.flags&=-33);var i=b8(e);WE(e,i,a);break;case 3:case 4:var o=n.stateNode.containerInfo,s=b8(e);qE(e,s,o);break;default:throw Error(Ot(161))}}catch(u){Pa(e,e.return,u)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function fre(e,t,r){Kt=e,JV(e)}function JV(e,t,r){for(var n=(e.mode&1)!==0;Kt!==null;){var a=Kt,i=a.child;if(a.tag===22&&n){var o=a.memoizedState!==null||m2;if(!o){var s=a.alternate,u=s!==null&&s.memoizedState!==null||Yi;s=m2;var l=Yi;if(m2=o,(Yi=u)&&!l)for(Kt=a;Kt!==null;)o=Kt,u=o.child,o.tag===22&&o.memoizedState!==null?w8(a):u!==null?(u.return=o,Kt=u):w8(a);for(;i!==null;)Kt=i,JV(i),i=i.sibling;Kt=a,m2=s,Yi=l}S8(e)}else(a.subtreeFlags&8772)!==0&&i!==null?(i.return=a,Kt=i):S8(e)}}function S8(e){for(;Kt!==null;){var t=Kt;if((t.flags&8772)!==0){var r=t.alternate;try{if((t.flags&8772)!==0)switch(t.tag){case 0:case 11:case 15:Yi||U3(5,t);break;case 1:var n=t.stateNode;if(t.flags&4&&!Yi)if(r===null)n.componentDidMount();else{var a=t.elementType===t.type?r.memoizedProps:Ru(t.type,r.memoizedProps);n.componentDidUpdate(a,r.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var i=t.updateQueue;i!==null&&a8(t,i,n);break;case 3:var o=t.updateQueue;if(o!==null){if(r=null,t.child!==null)switch(t.child.tag){case 5:r=t.child.stateNode;break;case 1:r=t.child.stateNode}a8(t,o,r)}break;case 5:var s=t.stateNode;if(r===null&&t.flags&4){r=s;var u=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":u.autoFocus&&r.focus();break;case"img":u.src&&(r.src=u.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var l=t.alternate;if(l!==null){var c=l.memoizedState;if(c!==null){var d=c.dehydrated;d!==null&&Qy(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Ot(163))}Yi||t.flags&512&&GE(t)}catch(f){Pa(t,t.return,f)}}if(t===e){Kt=null;break}if(r=t.sibling,r!==null){r.return=t.return,Kt=r;break}Kt=t.return}}function C8(e){for(;Kt!==null;){var t=Kt;if(t===e){Kt=null;break}var r=t.sibling;if(r!==null){r.return=t.return,Kt=r;break}Kt=t.return}}function w8(e){for(;Kt!==null;){var t=Kt;try{switch(t.tag){case 0:case 11:case 15:var r=t.return;try{U3(4,t)}catch(u){Pa(t,r,u)}break;case 1:var n=t.stateNode;if(typeof n.componentDidMount=="function"){var a=t.return;try{n.componentDidMount()}catch(u){Pa(t,a,u)}}var i=t.return;try{GE(t)}catch(u){Pa(t,i,u)}break;case 5:var o=t.return;try{GE(t)}catch(u){Pa(t,o,u)}}}catch(u){Pa(t,t.return,u)}if(t===e){Kt=null;break}var s=t.sibling;if(s!==null){s.return=t.return,Kt=s;break}Kt=t.return}}var pre=Math.ceil,VS=Md.ReactCurrentDispatcher,kM=Md.ReactCurrentOwner,iu=Md.ReactCurrentBatchConfig,fn=0,bi=null,Ya=null,Di=0,us=0,Tv=Ep(0),Ja=0,u1=null,em=0,V3=0,RM=0,my=null,Bo=null,OM=0,l0=1/0,Bc=null,HS=!1,XE=null,rp=null,v2=!1,zf=null,jS=0,vy=0,YE=null,Gx=-1,qx=0;function mo(){return(fn&6)!==0?Oa():Gx!==-1?Gx:Gx=Oa()}function np(e){return(e.mode&1)===0?1:(fn&2)!==0&&Di!==0?Di&-Di:$te.transition!==null?(qx===0&&(qx=FU()),qx):(e=Dn,e!==0||(e=window.event,e=e===void 0?16:jU(e.type)),e)}function Gu(e,t,r,n){if(50<vy)throw vy=0,YE=null,Error(Ot(185));$1(e,r,n),((fn&2)===0||e!==bi)&&(e===bi&&((fn&2)===0&&(V3|=r),Ja===4&&Mf(e,Di)),Uo(e,n),r===1&&fn===0&&(t.mode&1)===0&&(l0=Oa()+500,L3&&Pp()))}function Uo(e,t){var r=e.callbackNode;$ee(e,t);var n=TS(e,e===bi?Di:0);if(n===0)r!==null&&k6(r),e.callbackNode=null,e.callbackPriority=0;else if(t=n&-n,e.callbackPriority!==t){if(r!=null&&k6(r),t===1)e.tag===0?Kte(_8.bind(null,e)):uV(_8.bind(null,e)),qte(function(){(fn&6)===0&&Pp()}),r=null;else{switch(LU(n)){case 1:r=oM;break;case 4:r=OU;break;case 16:r=AS;break;case 536870912:r=BU;break;default:r=AS}r=sH(r,eH.bind(null,e))}e.callbackPriority=t,e.callbackNode=r}}function eH(e,t){if(Gx=-1,qx=0,(fn&6)!==0)throw Error(Ot(327));var r=e.callbackNode;if(Hv()&&e.callbackNode!==r)return null;var n=TS(e,e===bi?Di:0);if(n===0)return null;if((n&30)!==0||(n&e.expiredLanes)!==0||t)t=GS(e,n);else{t=n;var a=fn;fn|=2;var i=rH();(bi!==e||Di!==t)&&(Bc=null,l0=Oa()+500,Fh(e,t));do try{vre();break}catch(s){tH(e,s)}while(1);bM(),VS.current=i,fn=a,Ya!==null?t=0:(bi=null,Di=0,t=Ja)}if(t!==0){if(t===2&&(a=SE(e),a!==0&&(n=a,t=KE(e,a))),t===1)throw r=u1,Fh(e,0),Mf(e,n),Uo(e,Oa()),r;if(t===6)Mf(e,n);else{if(a=e.current.alternate,(n&30)===0&&!hre(a)&&(t=GS(e,n),t===2&&(i=SE(e),i!==0&&(n=i,t=KE(e,i))),t===1))throw r=u1,Fh(e,0),Mf(e,n),Uo(e,Oa()),r;switch(e.finishedWork=a,e.finishedLanes=n,t){case 0:case 1:throw Error(Ot(345));case 2:ph(e,Bo,Bc);break;case 3:if(Mf(e,n),(n&130023424)===n&&(t=OM+500-Oa(),10<t)){if(TS(e,0)!==0)break;if(a=e.suspendedLanes,(a&n)!==n){mo(),e.pingedLanes|=e.suspendedLanes&a;break}e.timeoutHandle=IE(ph.bind(null,e,Bo,Bc),t);break}ph(e,Bo,Bc);break;case 4:if(Mf(e,n),(n&4194240)===n)break;for(t=e.eventTimes,a=-1;0<n;){var o=31-ju(n);i=1<<o,o=t[o],o>a&&(a=o),n&=~i}if(n=a,n=Oa()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*pre(n/1960))-n,10<n){e.timeoutHandle=IE(ph.bind(null,e,Bo,Bc),n);break}ph(e,Bo,Bc);break;case 5:ph(e,Bo,Bc);break;default:throw Error(Ot(329))}}}return Uo(e,Oa()),e.callbackNode===r?eH.bind(null,e):null}function KE(e,t){var r=my;return e.current.memoizedState.isDehydrated&&(Fh(e,t).flags|=256),e=GS(e,t),e!==2&&(t=Bo,Bo=r,t!==null&&$E(t)),e}function $E(e){Bo===null?Bo=e:Bo.push.apply(Bo,e)}function hre(e){for(var t=e;;){if(t.flags&16384){var r=t.updateQueue;if(r!==null&&(r=r.stores,r!==null))for(var n=0;n<r.length;n++){var a=r[n],i=a.getSnapshot;a=a.value;try{if(!el(i(),a))return!1}catch{return!1}}}if(r=t.child,t.subtreeFlags&16384&&r!==null)r.return=t,t=r;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Mf(e,t){for(t&=~RM,t&=~V3,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var r=31-ju(t),n=1<<r;e[r]=-1,t&=~n}}function _8(e){if((fn&6)!==0)throw Error(Ot(327));Hv();var t=TS(e,0);if((t&1)===0)return Uo(e,Oa()),null;var r=GS(e,t);if(e.tag!==0&&r===2){var n=SE(e);n!==0&&(t=n,r=KE(e,n))}if(r===1)throw r=u1,Fh(e,0),Mf(e,t),Uo(e,Oa()),r;if(r===6)throw Error(Ot(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,ph(e,Bo,Bc),Uo(e,Oa()),null}function BM(e,t){var r=fn;fn|=1;try{return e(t)}finally{fn=r,fn===0&&(l0=Oa()+500,L3&&Pp())}}function tm(e){zf!==null&&zf.tag===0&&(fn&6)===0&&Hv();var t=fn;fn|=1;var r=iu.transition,n=Dn;try{if(iu.transition=null,Dn=1,e)return e()}finally{Dn=n,iu.transition=r,fn=t,(fn&6)===0&&Pp()}}function FM(){us=Tv.current,ua(Tv)}function Fh(e,t){e.finishedWork=null,e.finishedLanes=0;var r=e.timeoutHandle;if(r!==-1&&(e.timeoutHandle=-1,Gte(r)),Ya!==null)for(r=Ya.return;r!==null;){var n=r;switch(vM(n),n.tag){case 1:n=n.type.childContextTypes,n!=null&&DS();break;case 3:s0(),ua(No),ua(Zi),AM();break;case 5:_M(n);break;case 4:s0();break;case 13:ua(ba);break;case 19:ua(ba);break;case 10:xM(n.type._context);break;case 22:case 23:FM()}r=r.return}if(bi=e,Ya=e=ap(e.current,null),Di=us=t,Ja=0,u1=null,RM=V3=em=0,Bo=my=null,_h!==null){for(t=0;t<_h.length;t++)if(r=_h[t],n=r.interleaved,n!==null){r.interleaved=null;var a=n.next,i=r.pending;if(i!==null){var o=i.next;i.next=a,n.next=o}r.pending=n}_h=null}return e}function tH(e,t){do{var r=Ya;try{if(bM(),Vx.current=US,zS){for(var n=Ca.memoizedState;n!==null;){var a=n.queue;a!==null&&(a.pending=null),n=n.next}zS=!1}if(Jh=0,vi=Za=Ca=null,py=!1,i1=0,kM.current=null,r===null||r.return===null){Ja=1,u1=t,Ya=null;break}e:{var i=e,o=r.return,s=r,u=t;if(t=Di,s.flags|=32768,u!==null&&typeof u=="object"&&typeof u.then=="function"){var l=u,c=s,d=c.tag;if((c.mode&1)===0&&(d===0||d===11||d===15)){var f=c.alternate;f?(c.updateQueue=f.updateQueue,c.memoizedState=f.memoizedState,c.lanes=f.lanes):(c.updateQueue=null,c.memoizedState=null)}var p=d8(o);if(p!==null){p.flags&=-257,f8(p,o,s,i,t),p.mode&1&&c8(i,l,t),t=p,u=l;var h=t.updateQueue;if(h===null){var m=new Set;m.add(u),t.updateQueue=m}else h.add(u);break e}else{if((t&1)===0){c8(i,l,t),LM();break e}u=Error(Ot(426))}}else if(va&&s.mode&1){var v=d8(o);if(v!==null){(v.flags&65536)===0&&(v.flags|=256),f8(v,o,s,i,t),gM(u0(u,s));break e}}i=u=u0(u,s),Ja!==4&&(Ja=2),my===null?my=[i]:my.push(i),i=o;do{switch(i.tag){case 3:i.flags|=65536,t&=-t,i.lanes|=t;var g=NV(i,u,t);n8(i,g);break e;case 1:s=u;var y=i.type,b=i.stateNode;if((i.flags&128)===0&&(typeof y.getDerivedStateFromError=="function"||b!==null&&typeof b.componentDidCatch=="function"&&(rp===null||!rp.has(b)))){i.flags|=65536,t&=-t,i.lanes|=t;var S=zV(i,s,t);n8(i,S);break e}}i=i.return}while(i!==null)}aH(r)}catch(x){t=x,Ya===r&&r!==null&&(Ya=r=r.return);continue}break}while(1)}function rH(){var e=VS.current;return VS.current=US,e===null?US:e}function LM(){(Ja===0||Ja===3||Ja===2)&&(Ja=4),bi===null||(em&268435455)===0&&(V3&268435455)===0||Mf(bi,Di)}function GS(e,t){var r=fn;fn|=2;var n=rH();(bi!==e||Di!==t)&&(Bc=null,Fh(e,t));do try{mre();break}catch(a){tH(e,a)}while(1);if(bM(),fn=r,VS.current=n,Ya!==null)throw Error(Ot(261));return bi=null,Di=0,Ja}function mre(){for(;Ya!==null;)nH(Ya)}function vre(){for(;Ya!==null&&!Vee();)nH(Ya)}function nH(e){var t=oH(e.alternate,e,us);e.memoizedProps=e.pendingProps,t===null?aH(e):Ya=t,kM.current=null}function aH(e){var t=e;do{var r=t.alternate;if(e=t.return,(t.flags&32768)===0){if(r=ure(r,t,us),r!==null){Ya=r;return}}else{if(r=lre(r,t),r!==null){r.flags&=32767,Ya=r;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{Ja=6,Ya=null;return}}if(t=t.sibling,t!==null){Ya=t;return}Ya=t=e}while(t!==null);Ja===0&&(Ja=5)}function ph(e,t,r){var n=Dn,a=iu.transition;try{iu.transition=null,Dn=1,gre(e,t,r,n)}finally{iu.transition=a,Dn=n}return null}function gre(e,t,r,n){do Hv();while(zf!==null);if((fn&6)!==0)throw Error(Ot(327));r=e.finishedWork;var a=e.finishedLanes;if(r===null)return null;if(e.finishedWork=null,e.finishedLanes=0,r===e.current)throw Error(Ot(177));e.callbackNode=null,e.callbackPriority=0;var i=r.lanes|r.childLanes;if(Qee(e,i),e===bi&&(Ya=bi=null,Di=0),(r.subtreeFlags&2064)===0&&(r.flags&2064)===0||v2||(v2=!0,sH(AS,function(){return Hv(),null})),i=(r.flags&15990)!==0,(r.subtreeFlags&15990)!==0||i){i=iu.transition,iu.transition=null;var o=Dn;Dn=1;var s=fn;fn|=4,kM.current=null,dre(e,r),ZV(r,e),Lte(EE),ES=!!TE,EE=TE=null,e.current=r,fre(r),Hee(),fn=s,Dn=o,iu.transition=i}else e.current=r;if(v2&&(v2=!1,zf=e,jS=a),i=e.pendingLanes,i===0&&(rp=null),qee(r.stateNode),Uo(e,Oa()),t!==null)for(n=e.onRecoverableError,r=0;r<t.length;r++)a=t[r],n(a.value,{componentStack:a.stack,digest:a.digest});if(HS)throw HS=!1,e=XE,XE=null,e;return(jS&1)!==0&&e.tag!==0&&Hv(),i=e.pendingLanes,(i&1)!==0?e===YE?vy++:(vy=0,YE=e):vy=0,Pp(),null}function Hv(){if(zf!==null){var e=LU(jS),t=iu.transition,r=Dn;try{if(iu.transition=null,Dn=16>e?16:e,zf===null)var n=!1;else{if(e=zf,zf=null,jS=0,(fn&6)!==0)throw Error(Ot(331));var a=fn;for(fn|=4,Kt=e.current;Kt!==null;){var i=Kt,o=i.child;if((Kt.flags&16)!==0){var s=i.deletions;if(s!==null){for(var u=0;u<s.length;u++){var l=s[u];for(Kt=l;Kt!==null;){var c=Kt;switch(c.tag){case 0:case 11:case 15:hy(8,c,i)}var d=c.child;if(d!==null)d.return=c,Kt=d;else for(;Kt!==null;){c=Kt;var f=c.sibling,p=c.return;if(KV(c),c===l){Kt=null;break}if(f!==null){f.return=p,Kt=f;break}Kt=p}}}var h=i.alternate;if(h!==null){var m=h.child;if(m!==null){h.child=null;do{var v=m.sibling;m.sibling=null,m=v}while(m!==null)}}Kt=i}}if((i.subtreeFlags&2064)!==0&&o!==null)o.return=i,Kt=o;else e:for(;Kt!==null;){if(i=Kt,(i.flags&2048)!==0)switch(i.tag){case 0:case 11:case 15:hy(9,i,i.return)}var g=i.sibling;if(g!==null){g.return=i.return,Kt=g;break e}Kt=i.return}}var y=e.current;for(Kt=y;Kt!==null;){o=Kt;var b=o.child;if((o.subtreeFlags&2064)!==0&&b!==null)b.return=o,Kt=b;else e:for(o=y;Kt!==null;){if(s=Kt,(s.flags&2048)!==0)try{switch(s.tag){case 0:case 11:case 15:U3(9,s)}}catch(x){Pa(s,s.return,x)}if(s===o){Kt=null;break e}var S=s.sibling;if(S!==null){S.return=s.return,Kt=S;break e}Kt=s.return}}if(fn=a,Pp(),Wl&&typeof Wl.onPostCommitFiberRoot=="function")try{Wl.onPostCommitFiberRoot(k3,e)}catch{}n=!0}return n}finally{Dn=r,iu.transition=t}}return!1}function A8(e,t,r){t=u0(r,t),t=NV(e,t,1),e=tp(e,t,1),t=mo(),e!==null&&($1(e,1,t),Uo(e,t))}function Pa(e,t,r){if(e.tag===3)A8(e,e,r);else for(;t!==null;){if(t.tag===3){A8(t,e,r);break}else if(t.tag===1){var n=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(rp===null||!rp.has(n))){e=u0(r,e),e=zV(t,e,1),t=tp(t,e,1),e=mo(),t!==null&&($1(t,1,e),Uo(t,e));break}}t=t.return}}function yre(e,t,r){var n=e.pingCache;n!==null&&n.delete(t),t=mo(),e.pingedLanes|=e.suspendedLanes&r,bi===e&&(Di&r)===r&&(Ja===4||Ja===3&&(Di&130023424)===Di&&500>Oa()-OM?Fh(e,0):RM|=r),Uo(e,t)}function iH(e,t){t===0&&((e.mode&1)===0?t=1:(t=o2,o2<<=1,(o2&130023424)===0&&(o2=4194304)));var r=mo();e=sd(e,t),e!==null&&($1(e,t,r),Uo(e,r))}function bre(e){var t=e.memoizedState,r=0;t!==null&&(r=t.retryLane),iH(e,r)}function xre(e,t){var r=0;switch(e.tag){case 13:var n=e.stateNode,a=e.memoizedState;a!==null&&(r=a.retryLane);break;case 19:n=e.stateNode;break;default:throw Error(Ot(314))}n!==null&&n.delete(t),iH(e,r)}var oH;oH=function(e,t,r){if(e!==null)if(e.memoizedProps!==t.pendingProps||No.current)Lo=!0;else{if((e.lanes&r)===0&&(t.flags&128)===0)return Lo=!1,sre(e,t,r);Lo=(e.flags&131072)!==0}else Lo=!1,va&&(t.flags&1048576)!==0&&lV(t,OS,t.index);switch(t.lanes=0,t.tag){case 2:var n=t.type;jx(e,t),e=t.pendingProps;var a=a0(t,Zi.current);Vv(t,r),a=EM(null,t,n,e,a,r);var i=PM();return t.flags|=1,typeof a=="object"&&a!==null&&typeof a.render=="function"&&a.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,zo(n)?(i=!0,kS(t)):i=!1,t.memoizedState=a.state!==null&&a.state!==void 0?a.state:null,CM(t),a.updater=N3,t.stateNode=a,a._reactInternals=t,FE(t,n,e,r),t=zE(null,t,n,!0,i,r)):(t.tag=0,va&&i&&mM(t),co(null,t,a,r),t=t.child),t;case 16:n=t.elementType;e:{switch(jx(e,t),e=t.pendingProps,a=n._init,n=a(n._payload),t.type=n,a=t.tag=Cre(n),e=Ru(n,e),a){case 0:t=NE(null,t,n,e,r);break e;case 1:t=m8(null,t,n,e,r);break e;case 11:t=p8(null,t,n,e,r);break e;case 14:t=h8(null,t,n,Ru(n.type,e),r);break e}throw Error(Ot(306,n,""))}return t;case 0:return n=t.type,a=t.pendingProps,a=t.elementType===n?a:Ru(n,a),NE(e,t,n,a,r);case 1:return n=t.type,a=t.pendingProps,a=t.elementType===n?a:Ru(n,a),m8(e,t,n,a,r);case 3:e:{if(jV(t),e===null)throw Error(Ot(387));n=t.pendingProps,i=t.memoizedState,a=i.element,pV(e,t),LS(t,n,null,r);var o=t.memoizedState;if(n=o.element,i.isDehydrated)if(i={element:n,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},t.updateQueue.baseState=i,t.memoizedState=i,t.flags&256){a=u0(Error(Ot(423)),t),t=v8(e,t,n,r,a);break e}else if(n!==a){a=u0(Error(Ot(424)),t),t=v8(e,t,n,r,a);break e}else for(ds=ep(t.stateNode.containerInfo.firstChild),hs=t,va=!0,Lu=null,r=gV(t,null,n,r),t.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling;else{if(i0(),n===a){t=ud(e,t,r);break e}co(e,t,n,r)}t=t.child}return t;case 5:return yV(t),e===null&&RE(t),n=t.type,a=t.pendingProps,i=e!==null?e.memoizedProps:null,o=a.children,PE(n,a)?o=null:i!==null&&PE(n,i)&&(t.flags|=32),HV(e,t),co(e,t,o,r),t.child;case 6:return e===null&&RE(t),null;case 13:return GV(e,t,r);case 4:return wM(t,t.stateNode.containerInfo),n=t.pendingProps,e===null?t.child=o0(t,null,n,r):co(e,t,n,r),t.child;case 11:return n=t.type,a=t.pendingProps,a=t.elementType===n?a:Ru(n,a),p8(e,t,n,a,r);case 7:return co(e,t,t.pendingProps,r),t.child;case 8:return co(e,t,t.pendingProps.children,r),t.child;case 12:return co(e,t,t.pendingProps.children,r),t.child;case 10:e:{if(n=t.type._context,a=t.pendingProps,i=t.memoizedProps,o=a.value,Zn(BS,n._currentValue),n._currentValue=o,i!==null)if(el(i.value,o)){if(i.children===a.children&&!No.current){t=ud(e,t,r);break e}}else for(i=t.child,i!==null&&(i.return=t);i!==null;){var s=i.dependencies;if(s!==null){o=i.child;for(var u=s.firstContext;u!==null;){if(u.context===n){if(i.tag===1){u=ed(-1,r&-r),u.tag=2;var l=i.updateQueue;if(l!==null){l=l.shared;var c=l.pending;c===null?u.next=u:(u.next=c.next,c.next=u),l.pending=u}}i.lanes|=r,u=i.alternate,u!==null&&(u.lanes|=r),OE(i.return,r,t),s.lanes|=r;break}u=u.next}}else if(i.tag===10)o=i.type===t.type?null:i.child;else if(i.tag===18){if(o=i.return,o===null)throw Error(Ot(341));o.lanes|=r,s=o.alternate,s!==null&&(s.lanes|=r),OE(o,r,t),o=i.sibling}else o=i.child;if(o!==null)o.return=i;else for(o=i;o!==null;){if(o===t){o=null;break}if(i=o.sibling,i!==null){i.return=o.return,o=i;break}o=o.return}i=o}co(e,t,a.children,r),t=t.child}return t;case 9:return a=t.type,n=t.pendingProps.children,Vv(t,r),a=lu(a),n=n(a),t.flags|=1,co(e,t,n,r),t.child;case 14:return n=t.type,a=Ru(n,t.pendingProps),a=Ru(n.type,a),h8(e,t,n,a,r);case 15:return UV(e,t,t.type,t.pendingProps,r);case 17:return n=t.type,a=t.pendingProps,a=t.elementType===n?a:Ru(n,a),jx(e,t),t.tag=1,zo(n)?(e=!0,kS(t)):e=!1,Vv(t,r),mV(t,n,a),FE(t,n,a,r),zE(null,t,n,!0,e,r);case 19:return qV(e,t,r);case 22:return VV(e,t,r)}throw Error(Ot(156,t.tag))};function sH(e,t){return RU(e,t)}function Sre(e,t,r,n){this.tag=e,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function tu(e,t,r,n){return new Sre(e,t,r,n)}function NM(e){return e=e.prototype,!(!e||!e.isReactComponent)}function Cre(e){if(typeof e=="function")return NM(e)?1:0;if(e!=null){if(e=e.$$typeof,e===nM)return 11;if(e===aM)return 14}return 2}function ap(e,t){var r=e.alternate;return r===null?(r=tu(e.tag,t,e.key,e.mode),r.elementType=e.elementType,r.type=e.type,r.stateNode=e.stateNode,r.alternate=e,e.alternate=r):(r.pendingProps=t,r.type=e.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=e.flags&14680064,r.childLanes=e.childLanes,r.lanes=e.lanes,r.child=e.child,r.memoizedProps=e.memoizedProps,r.memoizedState=e.memoizedState,r.updateQueue=e.updateQueue,t=e.dependencies,r.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},r.sibling=e.sibling,r.index=e.index,r.ref=e.ref,r}function Wx(e,t,r,n,a,i){var o=2;if(n=e,typeof e=="function")NM(e)&&(o=1);else if(typeof e=="string")o=5;else e:switch(e){case vv:return Lh(r.children,a,i,t);case rM:o=8,a|=8;break;case oE:return e=tu(12,r,t,a|2),e.elementType=oE,e.lanes=i,e;case sE:return e=tu(13,r,t,a),e.elementType=sE,e.lanes=i,e;case uE:return e=tu(19,r,t,a),e.elementType=uE,e.lanes=i,e;case vU:return H3(r,a,i,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case hU:o=10;break e;case mU:o=9;break e;case nM:o=11;break e;case aM:o=14;break e;case wf:o=16,n=null;break e}throw Error(Ot(130,e==null?e:typeof e,""))}return t=tu(o,r,t,a),t.elementType=e,t.type=n,t.lanes=i,t}function Lh(e,t,r,n){return e=tu(7,e,n,t),e.lanes=r,e}function H3(e,t,r,n){return e=tu(22,e,n,t),e.elementType=vU,e.lanes=r,e.stateNode={isHidden:!1},e}function P4(e,t,r){return e=tu(6,e,null,t),e.lanes=r,e}function I4(e,t,r){return t=tu(4,e.children!==null?e.children:[],e.key,t),t.lanes=r,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function wre(e,t,r,n,a){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=l4(0),this.expirationTimes=l4(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=l4(0),this.identifierPrefix=n,this.onRecoverableError=a,this.mutableSourceEagerHydrationData=null}function zM(e,t,r,n,a,i,o,s,u){return e=new wre(e,t,r,s,u),t===1?(t=1,i===!0&&(t|=8)):t=0,i=tu(3,null,null,t),e.current=i,i.stateNode=e,i.memoizedState={element:n,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},CM(i),e}function _re(e,t,r){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:mv,key:n==null?null:""+n,children:e,containerInfo:t,implementation:r}}function uH(e){if(!e)return fp;e=e._reactInternals;e:{if(xm(e)!==e||e.tag!==1)throw Error(Ot(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(zo(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(Ot(171))}if(e.tag===1){var r=e.type;if(zo(r))return sV(e,r,t)}return t}function lH(e,t,r,n,a,i,o,s,u){return e=zM(r,n,!0,e,a,i,o,s,u),e.context=uH(null),r=e.current,n=mo(),a=np(r),i=ed(n,a),i.callback=t??null,tp(r,i,a),e.current.lanes=a,$1(e,a,n),Uo(e,n),e}function j3(e,t,r,n){var a=t.current,i=mo(),o=np(a);return r=uH(r),t.context===null?t.context=r:t.pendingContext=r,t=ed(i,o),t.payload={element:e},n=n===void 0?null:n,n!==null&&(t.callback=n),e=tp(a,t,o),e!==null&&(Gu(e,a,o,i),Ux(e,a,o)),o}function qS(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function T8(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var r=e.retryLane;e.retryLane=r!==0&&r<t?r:t}}function UM(e,t){T8(e,t),(e=e.alternate)&&T8(e,t)}function Are(){return null}var cH=typeof reportError=="function"?reportError:function(e){console.error(e)};function VM(e){this._internalRoot=e}G3.prototype.render=VM.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(Ot(409));j3(e,t,null,null)};G3.prototype.unmount=VM.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;tm(function(){j3(null,e,null,null)}),t[od]=null}};function G3(e){this._internalRoot=e}G3.prototype.unstable_scheduleHydration=function(e){if(e){var t=UU();e={blockedOn:null,target:e,priority:t};for(var r=0;r<If.length&&t!==0&&t<If[r].priority;r++);If.splice(r,0,e),r===0&&HU(e)}};function HM(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function q3(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function E8(){}function Tre(e,t,r,n,a){if(a){if(typeof n=="function"){var i=n;n=function(){var l=qS(o);i.call(l)}}var o=lH(t,n,e,0,null,!1,!1,"",E8);return e._reactRootContainer=o,e[od]=o.current,e1(e.nodeType===8?e.parentNode:e),tm(),o}for(;a=e.lastChild;)e.removeChild(a);if(typeof n=="function"){var s=n;n=function(){var l=qS(u);s.call(l)}}var u=zM(e,0,!1,null,null,!1,!1,"",E8);return e._reactRootContainer=u,e[od]=u.current,e1(e.nodeType===8?e.parentNode:e),tm(function(){j3(t,u,r,n)}),u}function W3(e,t,r,n,a){var i=r._reactRootContainer;if(i){var o=i;if(typeof a=="function"){var s=a;a=function(){var u=qS(o);s.call(u)}}j3(t,o,e,a)}else o=Tre(r,t,e,a,n);return qS(o)}NU=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var r=Yg(t.pendingLanes);r!==0&&(sM(t,r|1),Uo(t,Oa()),(fn&6)===0&&(l0=Oa()+500,Pp()))}break;case 13:tm(function(){var n=sd(e,1);if(n!==null){var a=mo();Gu(n,e,1,a)}}),UM(e,1)}};uM=function(e){if(e.tag===13){var t=sd(e,134217728);if(t!==null){var r=mo();Gu(t,e,134217728,r)}UM(e,134217728)}};zU=function(e){if(e.tag===13){var t=np(e),r=sd(e,t);if(r!==null){var n=mo();Gu(r,e,t,n)}UM(e,t)}};UU=function(){return Dn};VU=function(e,t){var r=Dn;try{return Dn=e,t()}finally{Dn=r}};yE=function(e,t,r){switch(t){case"input":if(dE(e,r),t=r.name,r.type==="radio"&&t!=null){for(r=e;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<r.length;t++){var n=r[t];if(n!==e&&n.form===e.form){var a=F3(n);if(!a)throw Error(Ot(90));yU(n),dE(n,a)}}}break;case"textarea":xU(e,r);break;case"select":t=r.value,t!=null&&Lv(e,!!r.multiple,t,!1)}};EU=BM;PU=tm;var Ere={usingClientEntryPoint:!1,Events:[Z1,xv,F3,AU,TU,BM]},gg={findFiberByHostInstance:wh,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},Pre={bundleType:gg.bundleType,version:gg.version,rendererPackageName:gg.rendererPackageName,rendererConfig:gg.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Md.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=DU(e),e===null?null:e.stateNode},findFiberByHostInstance:gg.findFiberByHostInstance||Are,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var g2=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!g2.isDisabled&&g2.supportsFiber)try{k3=g2.inject(Pre),Wl=g2}catch{}}Ts.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Ere;Ts.createPortal=function(e,t){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!HM(t))throw Error(Ot(200));return _re(e,t,null,r)};Ts.createRoot=function(e,t){if(!HM(e))throw Error(Ot(299));var r=!1,n="",a=cH;return t!=null&&(t.unstable_strictMode===!0&&(r=!0),t.identifierPrefix!==void 0&&(n=t.identifierPrefix),t.onRecoverableError!==void 0&&(a=t.onRecoverableError)),t=zM(e,1,!1,null,null,r,!1,n,a),e[od]=t.current,e1(e.nodeType===8?e.parentNode:e),new VM(t)};Ts.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(Ot(188)):(e=Object.keys(e).join(","),Error(Ot(268,e)));return e=DU(t),e=e===null?null:e.stateNode,e};Ts.flushSync=function(e){return tm(e)};Ts.hydrate=function(e,t,r){if(!q3(t))throw Error(Ot(200));return W3(null,e,t,!0,r)};Ts.hydrateRoot=function(e,t,r){if(!HM(e))throw Error(Ot(405));var n=r!=null&&r.hydratedSources||null,a=!1,i="",o=cH;if(r!=null&&(r.unstable_strictMode===!0&&(a=!0),r.identifierPrefix!==void 0&&(i=r.identifierPrefix),r.onRecoverableError!==void 0&&(o=r.onRecoverableError)),t=lH(t,null,e,1,r??null,a,!1,i,o),e[od]=t.current,e1(e),n)for(e=0;e<n.length;e++)r=n[e],a=r._getVersion,a=a(r._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[r,a]:t.mutableSourceEagerHydrationData.push(r,a);return new G3(t)};Ts.render=function(e,t,r){if(!q3(t))throw Error(Ot(200));return W3(null,e,t,!1,r)};Ts.unmountComponentAtNode=function(e){if(!q3(e))throw Error(Ot(40));return e._reactRootContainer?(tm(function(){W3(null,null,e,!1,function(){e._reactRootContainer=null,e[od]=null})}),!0):!1};Ts.unstable_batchedUpdates=BM;Ts.unstable_renderSubtreeIntoContainer=function(e,t,r,n){if(!q3(r))throw Error(Ot(200));if(e==null||e._reactInternals===void 0)throw Error(Ot(38));return W3(e,t,r,!1,n)};Ts.version="18.2.0-next-9e3b772b8-20220608";(function(e){function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(r){console.error(r)}}t(),e.exports=Ts})(K1);var dH,P8=K1.exports;dH=P8.createRoot,P8.hydrateRoot;function y2(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var QE={exports:{}};(function(e,t){(function(r){e.exports=r()})(function(){return function r(n,a,i){function o(l,c){if(!a[l]){if(!n[l]){var d=typeof y2=="function"&&y2;if(!c&&d)return d(l,!0);if(s)return s(l,!0);throw new Error("Cannot find module '"+l+"'")}c=a[l]={exports:{}},n[l][0].call(c.exports,function(f){var p=n[l][1][f];return o(p||f)},c,c.exports,r,n,a,i)}return a[l].exports}for(var s=typeof y2=="function"&&y2,u=0;u<i.length;u++)o(i[u]);return o}({1:[function(r,n,a){(function(i,o,s,u,l,c,d,f,p){var h=r("crypto");function m(C,w){w=y(C,w);var _;return(_=w.algorithm!=="passthrough"?h.createHash(w.algorithm):new x).write===void 0&&(_.write=_.update,_.end=_.update),S(w,_).dispatch(C),_.update||_.end(""),_.digest?_.digest(w.encoding==="buffer"?void 0:w.encoding):(C=_.read(),w.encoding!=="buffer"?C.toString(w.encoding):C)}(a=n.exports=m).sha1=function(C){return m(C)},a.keys=function(C){return m(C,{excludeValues:!0,algorithm:"sha1",encoding:"hex"})},a.MD5=function(C){return m(C,{algorithm:"md5",encoding:"hex"})},a.keysMD5=function(C){return m(C,{algorithm:"md5",encoding:"hex",excludeValues:!0})};var v=h.getHashes?h.getHashes().slice():["sha1","md5"],g=(v.push("passthrough"),["buffer","hex","binary","base64"]);function y(C,w){var _={};if(_.algorithm=(w=w||{}).algorithm||"sha1",_.encoding=w.encoding||"hex",_.excludeValues=!!w.excludeValues,_.algorithm=_.algorithm.toLowerCase(),_.encoding=_.encoding.toLowerCase(),_.ignoreUnknown=w.ignoreUnknown===!0,_.respectType=w.respectType!==!1,_.respectFunctionNames=w.respectFunctionNames!==!1,_.respectFunctionProperties=w.respectFunctionProperties!==!1,_.unorderedArrays=w.unorderedArrays===!0,_.unorderedSets=w.unorderedSets!==!1,_.unorderedObjects=w.unorderedObjects!==!1,_.replacer=w.replacer||void 0,_.excludeKeys=w.excludeKeys||void 0,C===void 0)throw new Error("Object argument required.");for(var E=0;E<v.length;++E)v[E].toLowerCase()===_.algorithm.toLowerCase()&&(_.algorithm=v[E]);if(v.indexOf(_.algorithm)===-1)throw new Error('Algorithm "'+_.algorithm+'"  not supported. supported values: '+v.join(", "));if(g.indexOf(_.encoding)===-1&&_.algorithm!=="passthrough")throw new Error('Encoding "'+_.encoding+'"  not supported. supported values: '+g.join(", "));return _}function b(C){if(typeof C=="function")return/^function\s+\w*\s*\(\s*\)\s*{\s+\[native code\]\s+}$/i.exec(Function.prototype.toString.call(C))!=null}function S(C,w,_){_=_||[];function E(P){return w.update?w.update(P,"utf8"):w.write(P,"utf8")}return{dispatch:function(P){return this["_"+((P=C.replacer?C.replacer(P):P)===null?"null":typeof P)](P)},_object:function(P){var D,k=Object.prototype.toString.call(P),F=/\[object (.*)\]/i.exec(k);if(F=(F=F?F[1]:"unknown:["+k+"]").toLowerCase(),0<=(k=_.indexOf(P)))return this.dispatch("[CIRCULAR:"+k+"]");if(_.push(P),s!==void 0&&s.isBuffer&&s.isBuffer(P))return E("buffer:"),E(P);if(F==="object"||F==="function"||F==="asyncfunction")return k=Object.keys(P),C.unorderedObjects&&(k=k.sort()),C.respectType===!1||b(P)||k.splice(0,0,"prototype","__proto__","constructor"),C.excludeKeys&&(k=k.filter(function(X){return!C.excludeKeys(X)})),E("object:"+k.length+":"),D=this,k.forEach(function(X){D.dispatch(X),E(":"),C.excludeValues||D.dispatch(P[X]),E(",")});if(!this["_"+F]){if(C.ignoreUnknown)return E("["+F+"]");throw new Error('Unknown object type "'+F+'"')}this["_"+F](P)},_array:function(P,X){X=X!==void 0?X:C.unorderedArrays!==!1;var k=this;if(E("array:"+P.length+":"),!X||P.length<=1)return P.forEach(function(U){return k.dispatch(U)});var F=[],X=P.map(function(U){var j=new x,te=_.slice();return S(C,j,te).dispatch(U),F=F.concat(te.slice(_.length)),j.read().toString()});return _=_.concat(F),X.sort(),this._array(X,!1)},_date:function(P){return E("date:"+P.toJSON())},_symbol:function(P){return E("symbol:"+P.toString())},_error:function(P){return E("error:"+P.toString())},_boolean:function(P){return E("bool:"+P.toString())},_string:function(P){E("string:"+P.length+":"),E(P.toString())},_function:function(P){E("fn:"),b(P)?this.dispatch("[native]"):this.dispatch(P.toString()),C.respectFunctionNames!==!1&&this.dispatch("function-name:"+String(P.name)),C.respectFunctionProperties&&this._object(P)},_number:function(P){return E("number:"+P.toString())},_xml:function(P){return E("xml:"+P.toString())},_null:function(){return E("Null")},_undefined:function(){return E("Undefined")},_regexp:function(P){return E("regex:"+P.toString())},_uint8array:function(P){return E("uint8array:"),this.dispatch(Array.prototype.slice.call(P))},_uint8clampedarray:function(P){return E("uint8clampedarray:"),this.dispatch(Array.prototype.slice.call(P))},_int8array:function(P){return E("int8array:"),this.dispatch(Array.prototype.slice.call(P))},_uint16array:function(P){return E("uint16array:"),this.dispatch(Array.prototype.slice.call(P))},_int16array:function(P){return E("int16array:"),this.dispatch(Array.prototype.slice.call(P))},_uint32array:function(P){return E("uint32array:"),this.dispatch(Array.prototype.slice.call(P))},_int32array:function(P){return E("int32array:"),this.dispatch(Array.prototype.slice.call(P))},_float32array:function(P){return E("float32array:"),this.dispatch(Array.prototype.slice.call(P))},_float64array:function(P){return E("float64array:"),this.dispatch(Array.prototype.slice.call(P))},_arraybuffer:function(P){return E("arraybuffer:"),this.dispatch(new Uint8Array(P))},_url:function(P){return E("url:"+P.toString())},_map:function(P){return E("map:"),P=Array.from(P),this._array(P,C.unorderedSets!==!1)},_set:function(P){return E("set:"),P=Array.from(P),this._array(P,C.unorderedSets!==!1)},_file:function(P){return E("file:"),this.dispatch([P.name,P.size,P.type,P.lastModfied])},_blob:function(){if(C.ignoreUnknown)return E("[blob]");throw Error(`Hashing Blob objects is currently not supported
(see https://github.com/puleos/object-hash/issues/26)
Use "options.replacer" or "options.ignoreUnknown"
`)},_domwindow:function(){return E("domwindow")},_bigint:function(P){return E("bigint:"+P.toString())},_process:function(){return E("process")},_timer:function(){return E("timer")},_pipe:function(){return E("pipe")},_tcp:function(){return E("tcp")},_udp:function(){return E("udp")},_tty:function(){return E("tty")},_statwatcher:function(){return E("statwatcher")},_securecontext:function(){return E("securecontext")},_connection:function(){return E("connection")},_zlib:function(){return E("zlib")},_context:function(){return E("context")},_nodescript:function(){return E("nodescript")},_httpparser:function(){return E("httpparser")},_dataview:function(){return E("dataview")},_signal:function(){return E("signal")},_fsevent:function(){return E("fsevent")},_tlswrap:function(){return E("tlswrap")}}}function x(){return{buf:"",write:function(C){this.buf+=C},end:function(C){this.buf+=C},read:function(){return this.buf}}}a.writeToStream=function(C,w,_){return _===void 0&&(_=w,w={}),S(w=y(C,w),_).dispatch(C)}}).call(this,r("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},r("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/fake_9a5aa49d.js","/")},{buffer:3,crypto:5,lYpoI2:11}],2:[function(r,n,a){(function(i,o,s,u,l,c,d,f,p){(function(h){var m=typeof Uint8Array<"u"?Uint8Array:Array,v="+".charCodeAt(0),g="/".charCodeAt(0),y="0".charCodeAt(0),b="a".charCodeAt(0),S="A".charCodeAt(0),x="-".charCodeAt(0),C="_".charCodeAt(0);function w(_){return _=_.charCodeAt(0),_===v||_===x?62:_===g||_===C?63:_<y?-1:_<y+10?_-y+26+26:_<S+26?_-S:_<b+26?_-b+26:void 0}h.toByteArray=function(_){var E,P;if(0<_.length%4)throw new Error("Invalid string. Length must be a multiple of 4");var D=_.length,D=_.charAt(D-2)==="="?2:_.charAt(D-1)==="="?1:0,k=new m(3*_.length/4-D),F=0<D?_.length-4:_.length,X=0;function U(j){k[X++]=j}for(E=0;E<F;E+=4,0)U((16711680&(P=w(_.charAt(E))<<18|w(_.charAt(E+1))<<12|w(_.charAt(E+2))<<6|w(_.charAt(E+3))))>>16),U((65280&P)>>8),U(255&P);return D==2?U(255&(P=w(_.charAt(E))<<2|w(_.charAt(E+1))>>4)):D==1&&(U((P=w(_.charAt(E))<<10|w(_.charAt(E+1))<<4|w(_.charAt(E+2))>>2)>>8&255),U(255&P)),k},h.fromByteArray=function(_){var E,P,D,k,F=_.length%3,X="";function U(j){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(j)}for(E=0,D=_.length-F;E<D;E+=3)P=(_[E]<<16)+(_[E+1]<<8)+_[E+2],X+=U((k=P)>>18&63)+U(k>>12&63)+U(k>>6&63)+U(63&k);switch(F){case 1:X=(X+=U((P=_[_.length-1])>>2))+U(P<<4&63)+"==";break;case 2:X=(X=(X+=U((P=(_[_.length-2]<<8)+_[_.length-1])>>10))+U(P>>4&63))+U(P<<2&63)+"="}return X}})(a===void 0?this.base64js={}:a)}).call(this,r("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},r("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/base64-js/lib/b64.js","/node_modules/gulp-browserify/node_modules/base64-js/lib")},{buffer:3,lYpoI2:11}],3:[function(r,n,a){(function(i,o,v,u,l,c,d,f,p){var h=r("base64-js"),m=r("ieee754");function v(L,H,Z){if(!(this instanceof v))return new v(L,H,Z);var fe,me,xe,Se,ie=typeof L;if(H==="base64"&&ie=="string")for(L=(Se=L).trim?Se.trim():Se.replace(/^\s+|\s+$/g,"");L.length%4!=0;)L+="=";if(ie=="number")fe=q(L);else if(ie=="string")fe=v.byteLength(L,H);else{if(ie!="object")throw new Error("First argument needs to be a number, array or string.");fe=q(L.length)}if(v._useTypedArrays?me=v._augment(new Uint8Array(fe)):((me=this).length=fe,me._isBuffer=!0),v._useTypedArrays&&typeof L.byteLength=="number")me._set(L);else if(W(Se=L)||v.isBuffer(Se)||Se&&typeof Se=="object"&&typeof Se.length=="number")for(xe=0;xe<fe;xe++)v.isBuffer(L)?me[xe]=L.readUInt8(xe):me[xe]=L[xe];else if(ie=="string")me.write(L,0,H);else if(ie=="number"&&!v._useTypedArrays&&!Z)for(xe=0;xe<fe;xe++)me[xe]=0;return me}function g(L,H,Z,fe){return v._charsWritten=$(function(me){for(var xe=[],Se=0;Se<me.length;Se++)xe.push(255&me.charCodeAt(Se));return xe}(H),L,Z,fe)}function y(L,H,Z,fe){return v._charsWritten=$(function(me){for(var xe,Se,ie=[],le=0;le<me.length;le++)Se=me.charCodeAt(le),xe=Se>>8,Se=Se%256,ie.push(Se),ie.push(xe);return ie}(H),L,Z,fe)}function b(L,H,Z){var fe="";Z=Math.min(L.length,Z);for(var me=H;me<Z;me++)fe+=String.fromCharCode(L[me]);return fe}function S(L,H,Z,xe){xe||(K(typeof Z=="boolean","missing or invalid endian"),K(H!=null,"missing offset"),K(H+1<L.length,"Trying to read beyond buffer length"));var me,xe=L.length;if(!(xe<=H))return Z?(me=L[H],H+1<xe&&(me|=L[H+1]<<8)):(me=L[H]<<8,H+1<xe&&(me|=L[H+1])),me}function x(L,H,Z,xe){xe||(K(typeof Z=="boolean","missing or invalid endian"),K(H!=null,"missing offset"),K(H+3<L.length,"Trying to read beyond buffer length"));var me,xe=L.length;if(!(xe<=H))return Z?(H+2<xe&&(me=L[H+2]<<16),H+1<xe&&(me|=L[H+1]<<8),me|=L[H],H+3<xe&&(me+=L[H+3]<<24>>>0)):(H+1<xe&&(me=L[H+1]<<16),H+2<xe&&(me|=L[H+2]<<8),H+3<xe&&(me|=L[H+3]),me+=L[H]<<24>>>0),me}function C(L,H,Z,fe){if(fe||(K(typeof Z=="boolean","missing or invalid endian"),K(H!=null,"missing offset"),K(H+1<L.length,"Trying to read beyond buffer length")),!(L.length<=H))return fe=S(L,H,Z,!0),32768&fe?-1*(65535-fe+1):fe}function w(L,H,Z,fe){if(fe||(K(typeof Z=="boolean","missing or invalid endian"),K(H!=null,"missing offset"),K(H+3<L.length,"Trying to read beyond buffer length")),!(L.length<=H))return fe=x(L,H,Z,!0),2147483648&fe?-1*(4294967295-fe+1):fe}function _(L,H,Z,fe){return fe||(K(typeof Z=="boolean","missing or invalid endian"),K(H+3<L.length,"Trying to read beyond buffer length")),m.read(L,H,Z,23,4)}function E(L,H,Z,fe){return fe||(K(typeof Z=="boolean","missing or invalid endian"),K(H+7<L.length,"Trying to read beyond buffer length")),m.read(L,H,Z,52,8)}function P(L,H,Z,fe,me){if(me||(K(H!=null,"missing value"),K(typeof fe=="boolean","missing or invalid endian"),K(Z!=null,"missing offset"),K(Z+1<L.length,"trying to write beyond buffer length"),R(H,65535)),me=L.length,!(me<=Z))for(var xe=0,Se=Math.min(me-Z,2);xe<Se;xe++)L[Z+xe]=(H&255<<8*(fe?xe:1-xe))>>>8*(fe?xe:1-xe)}function D(L,H,Z,fe,me){if(me||(K(H!=null,"missing value"),K(typeof fe=="boolean","missing or invalid endian"),K(Z!=null,"missing offset"),K(Z+3<L.length,"trying to write beyond buffer length"),R(H,4294967295)),me=L.length,!(me<=Z))for(var xe=0,Se=Math.min(me-Z,4);xe<Se;xe++)L[Z+xe]=H>>>8*(fe?xe:3-xe)&255}function k(L,H,Z,fe,me){me||(K(H!=null,"missing value"),K(typeof fe=="boolean","missing or invalid endian"),K(Z!=null,"missing offset"),K(Z+1<L.length,"Trying to write beyond buffer length"),Y(H,32767,-32768)),L.length<=Z||P(L,0<=H?H:65535+H+1,Z,fe,me)}function F(L,H,Z,fe,me){me||(K(H!=null,"missing value"),K(typeof fe=="boolean","missing or invalid endian"),K(Z!=null,"missing offset"),K(Z+3<L.length,"Trying to write beyond buffer length"),Y(H,2147483647,-2147483648)),L.length<=Z||D(L,0<=H?H:4294967295+H+1,Z,fe,me)}function X(L,H,Z,fe,me){me||(K(H!=null,"missing value"),K(typeof fe=="boolean","missing or invalid endian"),K(Z!=null,"missing offset"),K(Z+3<L.length,"Trying to write beyond buffer length"),re(H,34028234663852886e22,-34028234663852886e22)),L.length<=Z||m.write(L,H,Z,fe,23,4)}function U(L,H,Z,fe,me){me||(K(H!=null,"missing value"),K(typeof fe=="boolean","missing or invalid endian"),K(Z!=null,"missing offset"),K(Z+7<L.length,"Trying to write beyond buffer length"),re(H,17976931348623157e292,-17976931348623157e292)),L.length<=Z||m.write(L,H,Z,fe,52,8)}a.Buffer=v,a.SlowBuffer=v,a.INSPECT_MAX_BYTES=50,v.poolSize=8192,v._useTypedArrays=function(){try{var L=new ArrayBuffer(0),H=new Uint8Array(L);return H.foo=function(){return 42},H.foo()===42&&typeof H.subarray=="function"}catch{return!1}}(),v.isEncoding=function(L){switch(String(L).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},v.isBuffer=function(L){return!(L==null||!L._isBuffer)},v.byteLength=function(L,H){var Z;switch(L+="",H||"utf8"){case"hex":Z=L.length/2;break;case"utf8":case"utf-8":Z=ee(L).length;break;case"ascii":case"binary":case"raw":Z=L.length;break;case"base64":Z=ue(L).length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":Z=2*L.length;break;default:throw new Error("Unknown encoding")}return Z},v.concat=function(L,H){if(K(W(L),`Usage: Buffer.concat(list, [totalLength])
list should be an Array.`),L.length===0)return new v(0);if(L.length===1)return L[0];if(typeof H!="number")for(me=H=0;me<L.length;me++)H+=L[me].length;for(var Z=new v(H),fe=0,me=0;me<L.length;me++){var xe=L[me];xe.copy(Z,fe),fe+=xe.length}return Z},v.prototype.write=function(L,H,Z,fe){isFinite(H)?isFinite(Z)||(fe=Z,Z=void 0):(le=fe,fe=H,H=Z,Z=le),H=Number(H)||0;var me,xe,Se,ie,le=this.length-H;switch((!Z||le<(Z=Number(Z)))&&(Z=le),fe=String(fe||"utf8").toLowerCase()){case"hex":me=function(O,G,ve,we){ve=Number(ve)||0;var Te=O.length-ve;(!we||Te<(we=Number(we)))&&(we=Te),K((Te=G.length)%2==0,"Invalid hex string"),Te/2<we&&(we=Te/2);for(var Ue=0;Ue<we;Ue++){var Ge=parseInt(G.substr(2*Ue,2),16);K(!isNaN(Ge),"Invalid hex string"),O[ve+Ue]=Ge}return v._charsWritten=2*Ue,Ue}(this,L,H,Z);break;case"utf8":case"utf-8":xe=this,Se=H,ie=Z,me=v._charsWritten=$(ee(L),xe,Se,ie);break;case"ascii":case"binary":me=g(this,L,H,Z);break;case"base64":xe=this,Se=H,ie=Z,me=v._charsWritten=$(ue(L),xe,Se,ie);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":me=y(this,L,H,Z);break;default:throw new Error("Unknown encoding")}return me},v.prototype.toString=function(L,H,Z){var fe,me,xe,Se,ie=this;if(L=String(L||"utf8").toLowerCase(),H=Number(H)||0,(Z=Z!==void 0?Number(Z):ie.length)===H)return"";switch(L){case"hex":fe=function(le,O,G){var ve=le.length;(!O||O<0)&&(O=0),(!G||G<0||ve<G)&&(G=ve);for(var we="",Te=O;Te<G;Te++)we+=V(le[Te]);return we}(ie,H,Z);break;case"utf8":case"utf-8":fe=function(le,O,G){var ve="",we="";G=Math.min(le.length,G);for(var Te=O;Te<G;Te++)le[Te]<=127?(ve+=Q(we)+String.fromCharCode(le[Te]),we=""):we+="%"+le[Te].toString(16);return ve+Q(we)}(ie,H,Z);break;case"ascii":case"binary":fe=b(ie,H,Z);break;case"base64":me=ie,Se=Z,fe=(xe=H)===0&&Se===me.length?h.fromByteArray(me):h.fromByteArray(me.slice(xe,Se));break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":fe=function(le,O,G){for(var ve=le.slice(O,G),we="",Te=0;Te<ve.length;Te+=2)we+=String.fromCharCode(ve[Te]+256*ve[Te+1]);return we}(ie,H,Z);break;default:throw new Error("Unknown encoding")}return fe},v.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},v.prototype.copy=function(L,H,Z,fe){if(H=H||0,(fe=fe||fe===0?fe:this.length)!==(Z=Z||0)&&L.length!==0&&this.length!==0){K(Z<=fe,"sourceEnd < sourceStart"),K(0<=H&&H<L.length,"targetStart out of bounds"),K(0<=Z&&Z<this.length,"sourceStart out of bounds"),K(0<=fe&&fe<=this.length,"sourceEnd out of bounds"),fe>this.length&&(fe=this.length);var me=(fe=L.length-H<fe-Z?L.length-H+Z:fe)-Z;if(me<100||!v._useTypedArrays)for(var xe=0;xe<me;xe++)L[xe+H]=this[xe+Z];else L._set(this.subarray(Z,Z+me),H)}},v.prototype.slice=function(L,H){var Z=this.length;if(L=te(L,Z,0),H=te(H,Z,Z),v._useTypedArrays)return v._augment(this.subarray(L,H));for(var fe=H-L,me=new v(fe,void 0,!0),xe=0;xe<fe;xe++)me[xe]=this[xe+L];return me},v.prototype.get=function(L){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(L)},v.prototype.set=function(L,H){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(L,H)},v.prototype.readUInt8=function(L,H){if(H||(K(L!=null,"missing offset"),K(L<this.length,"Trying to read beyond buffer length")),!(L>=this.length))return this[L]},v.prototype.readUInt16LE=function(L,H){return S(this,L,!0,H)},v.prototype.readUInt16BE=function(L,H){return S(this,L,!1,H)},v.prototype.readUInt32LE=function(L,H){return x(this,L,!0,H)},v.prototype.readUInt32BE=function(L,H){return x(this,L,!1,H)},v.prototype.readInt8=function(L,H){if(H||(K(L!=null,"missing offset"),K(L<this.length,"Trying to read beyond buffer length")),!(L>=this.length))return 128&this[L]?-1*(255-this[L]+1):this[L]},v.prototype.readInt16LE=function(L,H){return C(this,L,!0,H)},v.prototype.readInt16BE=function(L,H){return C(this,L,!1,H)},v.prototype.readInt32LE=function(L,H){return w(this,L,!0,H)},v.prototype.readInt32BE=function(L,H){return w(this,L,!1,H)},v.prototype.readFloatLE=function(L,H){return _(this,L,!0,H)},v.prototype.readFloatBE=function(L,H){return _(this,L,!1,H)},v.prototype.readDoubleLE=function(L,H){return E(this,L,!0,H)},v.prototype.readDoubleBE=function(L,H){return E(this,L,!1,H)},v.prototype.writeUInt8=function(L,H,Z){Z||(K(L!=null,"missing value"),K(H!=null,"missing offset"),K(H<this.length,"trying to write beyond buffer length"),R(L,255)),H>=this.length||(this[H]=L)},v.prototype.writeUInt16LE=function(L,H,Z){P(this,L,H,!0,Z)},v.prototype.writeUInt16BE=function(L,H,Z){P(this,L,H,!1,Z)},v.prototype.writeUInt32LE=function(L,H,Z){D(this,L,H,!0,Z)},v.prototype.writeUInt32BE=function(L,H,Z){D(this,L,H,!1,Z)},v.prototype.writeInt8=function(L,H,Z){Z||(K(L!=null,"missing value"),K(H!=null,"missing offset"),K(H<this.length,"Trying to write beyond buffer length"),Y(L,127,-128)),H>=this.length||(0<=L?this.writeUInt8(L,H,Z):this.writeUInt8(255+L+1,H,Z))},v.prototype.writeInt16LE=function(L,H,Z){k(this,L,H,!0,Z)},v.prototype.writeInt16BE=function(L,H,Z){k(this,L,H,!1,Z)},v.prototype.writeInt32LE=function(L,H,Z){F(this,L,H,!0,Z)},v.prototype.writeInt32BE=function(L,H,Z){F(this,L,H,!1,Z)},v.prototype.writeFloatLE=function(L,H,Z){X(this,L,H,!0,Z)},v.prototype.writeFloatBE=function(L,H,Z){X(this,L,H,!1,Z)},v.prototype.writeDoubleLE=function(L,H,Z){U(this,L,H,!0,Z)},v.prototype.writeDoubleBE=function(L,H,Z){U(this,L,H,!1,Z)},v.prototype.fill=function(L,H,Z){if(H=H||0,Z=Z||this.length,K(typeof(L=typeof(L=L||0)=="string"?L.charCodeAt(0):L)=="number"&&!isNaN(L),"value is not a number"),K(H<=Z,"end < start"),Z!==H&&this.length!==0){K(0<=H&&H<this.length,"start out of bounds"),K(0<=Z&&Z<=this.length,"end out of bounds");for(var fe=H;fe<Z;fe++)this[fe]=L}},v.prototype.inspect=function(){for(var L=[],H=this.length,Z=0;Z<H;Z++)if(L[Z]=V(this[Z]),Z===a.INSPECT_MAX_BYTES){L[Z+1]="...";break}return"<Buffer "+L.join(" ")+">"},v.prototype.toArrayBuffer=function(){if(typeof Uint8Array>"u")throw new Error("Buffer.toArrayBuffer not supported in this browser");if(v._useTypedArrays)return new v(this).buffer;for(var L=new Uint8Array(this.length),H=0,Z=L.length;H<Z;H+=1)L[H]=this[H];return L.buffer};var j=v.prototype;function te(L,H,Z){return typeof L!="number"?Z:H<=(L=~~L)?H:0<=L||0<=(L+=H)?L:0}function q(L){return(L=~~Math.ceil(+L))<0?0:L}function W(L){return(Array.isArray||function(H){return Object.prototype.toString.call(H)==="[object Array]"})(L)}function V(L){return L<16?"0"+L.toString(16):L.toString(16)}function ee(L){for(var H=[],Z=0;Z<L.length;Z++){var fe=L.charCodeAt(Z);if(fe<=127)H.push(L.charCodeAt(Z));else for(var me=Z,xe=(55296<=fe&&fe<=57343&&Z++,encodeURIComponent(L.slice(me,Z+1)).substr(1).split("%")),Se=0;Se<xe.length;Se++)H.push(parseInt(xe[Se],16))}return H}function ue(L){return h.toByteArray(L)}function $(L,H,Z,fe){for(var me=0;me<fe&&!(me+Z>=H.length||me>=L.length);me++)H[me+Z]=L[me];return me}function Q(L){try{return decodeURIComponent(L)}catch{return String.fromCharCode(65533)}}function R(L,H){K(typeof L=="number","cannot write a non-number as a number"),K(0<=L,"specified a negative value for writing an unsigned value"),K(L<=H,"value is larger than maximum value for type"),K(Math.floor(L)===L,"value has a fractional component")}function Y(L,H,Z){K(typeof L=="number","cannot write a non-number as a number"),K(L<=H,"value larger than maximum allowed value"),K(Z<=L,"value smaller than minimum allowed value"),K(Math.floor(L)===L,"value has a fractional component")}function re(L,H,Z){K(typeof L=="number","cannot write a non-number as a number"),K(L<=H,"value larger than maximum allowed value"),K(Z<=L,"value smaller than minimum allowed value")}function K(L,H){if(!L)throw new Error(H||"Failed assertion")}v._augment=function(L){return L._isBuffer=!0,L._get=L.get,L._set=L.set,L.get=j.get,L.set=j.set,L.write=j.write,L.toString=j.toString,L.toLocaleString=j.toString,L.toJSON=j.toJSON,L.copy=j.copy,L.slice=j.slice,L.readUInt8=j.readUInt8,L.readUInt16LE=j.readUInt16LE,L.readUInt16BE=j.readUInt16BE,L.readUInt32LE=j.readUInt32LE,L.readUInt32BE=j.readUInt32BE,L.readInt8=j.readInt8,L.readInt16LE=j.readInt16LE,L.readInt16BE=j.readInt16BE,L.readInt32LE=j.readInt32LE,L.readInt32BE=j.readInt32BE,L.readFloatLE=j.readFloatLE,L.readFloatBE=j.readFloatBE,L.readDoubleLE=j.readDoubleLE,L.readDoubleBE=j.readDoubleBE,L.writeUInt8=j.writeUInt8,L.writeUInt16LE=j.writeUInt16LE,L.writeUInt16BE=j.writeUInt16BE,L.writeUInt32LE=j.writeUInt32LE,L.writeUInt32BE=j.writeUInt32BE,L.writeInt8=j.writeInt8,L.writeInt16LE=j.writeInt16LE,L.writeInt16BE=j.writeInt16BE,L.writeInt32LE=j.writeInt32LE,L.writeInt32BE=j.writeInt32BE,L.writeFloatLE=j.writeFloatLE,L.writeFloatBE=j.writeFloatBE,L.writeDoubleLE=j.writeDoubleLE,L.writeDoubleBE=j.writeDoubleBE,L.fill=j.fill,L.inspect=j.inspect,L.toArrayBuffer=j.toArrayBuffer,L}}).call(this,r("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},r("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/buffer/index.js","/node_modules/gulp-browserify/node_modules/buffer")},{"base64-js":2,buffer:3,ieee754:10,lYpoI2:11}],4:[function(r,n,a){(function(i,o,h,u,l,c,d,f,p){var h=r("buffer").Buffer,m=4,v=new h(m);v.fill(0),n.exports={hash:function(g,y,b,S){for(var x=y(function(P,D){P.length%m!=0&&(k=P.length+(m-P.length%m),P=h.concat([P,v],k));for(var k,F=[],X=D?P.readInt32BE:P.readInt32LE,U=0;U<P.length;U+=m)F.push(X.call(P,U));return F}(g=h.isBuffer(g)?g:new h(g),S),8*g.length),y=S,C=new h(b),w=y?C.writeInt32BE:C.writeInt32LE,_=0;_<x.length;_++)w.call(C,x[_],4*_,!0);return C}}}).call(this,r("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},r("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/helpers.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:11}],5:[function(r,n,a){(function(i,o,h,u,l,c,d,f,p){var h=r("buffer").Buffer,m=r("./sha"),v=r("./sha256"),g=r("./rng"),y={sha1:m,sha256:v,md5:r("./md5")},b=64,S=new h(b);function x(P,D){var k=y[P=P||"sha1"],F=[];return k||C("algorithm:",P,"is not yet supported"),{update:function(X){return h.isBuffer(X)||(X=new h(X)),F.push(X),X.length,this},digest:function(X){var U=h.concat(F),U=D?function(j,te,q){h.isBuffer(te)||(te=new h(te)),h.isBuffer(q)||(q=new h(q)),te.length>b?te=j(te):te.length<b&&(te=h.concat([te,S],b));for(var W=new h(b),V=new h(b),ee=0;ee<b;ee++)W[ee]=54^te[ee],V[ee]=92^te[ee];return q=j(h.concat([W,q])),j(h.concat([V,q]))}(k,D,U):k(U);return F=null,X?U.toString(X):U}}}function C(){var P=[].slice.call(arguments).join(" ");throw new Error([P,"we accept pull requests","http://github.com/dominictarr/crypto-browserify"].join(`
`))}S.fill(0),a.createHash=function(P){return x(P)},a.createHmac=x,a.randomBytes=function(P,D){if(!D||!D.call)return new h(g(P));try{D.call(this,void 0,new h(g(P)))}catch(k){D(k)}};var w,_=["createCredentials","createCipher","createCipheriv","createDecipher","createDecipheriv","createSign","createVerify","createDiffieHellman","pbkdf2"],E=function(P){a[P]=function(){C("sorry,",P,"is not implemented yet")}};for(w in _)E(_[w])}).call(this,r("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},r("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/index.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./md5":6,"./rng":7,"./sha":8,"./sha256":9,buffer:3,lYpoI2:11}],6:[function(r,n,a){(function(i,o,s,u,l,c,d,f,p){var h=r("./helpers");function m(C,w){C[w>>5]|=128<<w%32,C[14+(w+64>>>9<<4)]=w;for(var _=1732584193,E=-271733879,P=-1732584194,D=271733878,k=0;k<C.length;k+=16){var F=_,X=E,U=P,j=D,_=g(_,E,P,D,C[k+0],7,-680876936),D=g(D,_,E,P,C[k+1],12,-389564586),P=g(P,D,_,E,C[k+2],17,606105819),E=g(E,P,D,_,C[k+3],22,-1044525330);_=g(_,E,P,D,C[k+4],7,-176418897),D=g(D,_,E,P,C[k+5],12,1200080426),P=g(P,D,_,E,C[k+6],17,-1473231341),E=g(E,P,D,_,C[k+7],22,-45705983),_=g(_,E,P,D,C[k+8],7,1770035416),D=g(D,_,E,P,C[k+9],12,-1958414417),P=g(P,D,_,E,C[k+10],17,-42063),E=g(E,P,D,_,C[k+11],22,-1990404162),_=g(_,E,P,D,C[k+12],7,1804603682),D=g(D,_,E,P,C[k+13],12,-40341101),P=g(P,D,_,E,C[k+14],17,-1502002290),_=y(_,E=g(E,P,D,_,C[k+15],22,1236535329),P,D,C[k+1],5,-165796510),D=y(D,_,E,P,C[k+6],9,-1069501632),P=y(P,D,_,E,C[k+11],14,643717713),E=y(E,P,D,_,C[k+0],20,-373897302),_=y(_,E,P,D,C[k+5],5,-701558691),D=y(D,_,E,P,C[k+10],9,38016083),P=y(P,D,_,E,C[k+15],14,-660478335),E=y(E,P,D,_,C[k+4],20,-405537848),_=y(_,E,P,D,C[k+9],5,568446438),D=y(D,_,E,P,C[k+14],9,-1019803690),P=y(P,D,_,E,C[k+3],14,-187363961),E=y(E,P,D,_,C[k+8],20,1163531501),_=y(_,E,P,D,C[k+13],5,-1444681467),D=y(D,_,E,P,C[k+2],9,-51403784),P=y(P,D,_,E,C[k+7],14,1735328473),_=b(_,E=y(E,P,D,_,C[k+12],20,-1926607734),P,D,C[k+5],4,-378558),D=b(D,_,E,P,C[k+8],11,-2022574463),P=b(P,D,_,E,C[k+11],16,1839030562),E=b(E,P,D,_,C[k+14],23,-35309556),_=b(_,E,P,D,C[k+1],4,-1530992060),D=b(D,_,E,P,C[k+4],11,1272893353),P=b(P,D,_,E,C[k+7],16,-155497632),E=b(E,P,D,_,C[k+10],23,-1094730640),_=b(_,E,P,D,C[k+13],4,681279174),D=b(D,_,E,P,C[k+0],11,-358537222),P=b(P,D,_,E,C[k+3],16,-722521979),E=b(E,P,D,_,C[k+6],23,76029189),_=b(_,E,P,D,C[k+9],4,-640364487),D=b(D,_,E,P,C[k+12],11,-421815835),P=b(P,D,_,E,C[k+15],16,530742520),_=S(_,E=b(E,P,D,_,C[k+2],23,-995338651),P,D,C[k+0],6,-198630844),D=S(D,_,E,P,C[k+7],10,1126891415),P=S(P,D,_,E,C[k+14],15,-1416354905),E=S(E,P,D,_,C[k+5],21,-57434055),_=S(_,E,P,D,C[k+12],6,1700485571),D=S(D,_,E,P,C[k+3],10,-1894986606),P=S(P,D,_,E,C[k+10],15,-1051523),E=S(E,P,D,_,C[k+1],21,-2054922799),_=S(_,E,P,D,C[k+8],6,1873313359),D=S(D,_,E,P,C[k+15],10,-30611744),P=S(P,D,_,E,C[k+6],15,-1560198380),E=S(E,P,D,_,C[k+13],21,1309151649),_=S(_,E,P,D,C[k+4],6,-145523070),D=S(D,_,E,P,C[k+11],10,-1120210379),P=S(P,D,_,E,C[k+2],15,718787259),E=S(E,P,D,_,C[k+9],21,-343485551),_=x(_,F),E=x(E,X),P=x(P,U),D=x(D,j)}return Array(_,E,P,D)}function v(C,w,_,E,P,D){return x((w=x(x(w,C),x(E,D)))<<P|w>>>32-P,_)}function g(C,w,_,E,P,D,k){return v(w&_|~w&E,C,w,P,D,k)}function y(C,w,_,E,P,D,k){return v(w&E|_&~E,C,w,P,D,k)}function b(C,w,_,E,P,D,k){return v(w^_^E,C,w,P,D,k)}function S(C,w,_,E,P,D,k){return v(_^(w|~E),C,w,P,D,k)}function x(C,w){var _=(65535&C)+(65535&w);return(C>>16)+(w>>16)+(_>>16)<<16|65535&_}n.exports=function(C){return h.hash(C,m,16)}}).call(this,r("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},r("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/md5.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],7:[function(r,n,a){(function(i,o,s,u,l,c,d,f,p){n.exports=function(h){for(var m,v=new Array(h),g=0;g<h;g++)(3&g)==0&&(m=4294967296*Math.random()),v[g]=m>>>((3&g)<<3)&255;return v}}).call(this,r("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},r("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/rng.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:11}],8:[function(r,n,a){(function(i,o,s,u,l,c,d,f,p){var h=r("./helpers");function m(y,b){y[b>>5]|=128<<24-b%32,y[15+(b+64>>9<<4)]=b;for(var S,x,C,w=Array(80),_=1732584193,E=-271733879,P=-1732584194,D=271733878,k=-1009589776,F=0;F<y.length;F+=16){for(var X=_,U=E,j=P,te=D,q=k,W=0;W<80;W++){w[W]=W<16?y[F+W]:g(w[W-3]^w[W-8]^w[W-14]^w[W-16],1);var V=v(v(g(_,5),(V=E,x=P,C=D,(S=W)<20?V&x|~V&C:!(S<40)&&S<60?V&x|V&C|x&C:V^x^C)),v(v(k,w[W]),(S=W)<20?1518500249:S<40?1859775393:S<60?-1894007588:-899497514)),k=D,D=P,P=g(E,30),E=_,_=V}_=v(_,X),E=v(E,U),P=v(P,j),D=v(D,te),k=v(k,q)}return Array(_,E,P,D,k)}function v(y,b){var S=(65535&y)+(65535&b);return(y>>16)+(b>>16)+(S>>16)<<16|65535&S}function g(y,b){return y<<b|y>>>32-b}n.exports=function(y){return h.hash(y,m,20,!0)}}).call(this,r("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},r("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],9:[function(r,n,a){(function(i,o,s,u,l,c,d,f,p){function h(b,S){var x=(65535&b)+(65535&S);return(b>>16)+(S>>16)+(x>>16)<<16|65535&x}function m(b,S){var x,C=new Array(1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298),w=new Array(1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225),_=new Array(64);b[S>>5]|=128<<24-S%32,b[15+(S+64>>9<<4)]=S;for(var E,P,D=0;D<b.length;D+=16){for(var k=w[0],F=w[1],X=w[2],U=w[3],j=w[4],te=w[5],q=w[6],W=w[7],V=0;V<64;V++)_[V]=V<16?b[V+D]:h(h(h((P=_[V-2],g(P,17)^g(P,19)^y(P,10)),_[V-7]),(P=_[V-15],g(P,7)^g(P,18)^y(P,3))),_[V-16]),x=h(h(h(h(W,g(P=j,6)^g(P,11)^g(P,25)),j&te^~j&q),C[V]),_[V]),E=h(g(E=k,2)^g(E,13)^g(E,22),k&F^k&X^F&X),W=q,q=te,te=j,j=h(U,x),U=X,X=F,F=k,k=h(x,E);w[0]=h(k,w[0]),w[1]=h(F,w[1]),w[2]=h(X,w[2]),w[3]=h(U,w[3]),w[4]=h(j,w[4]),w[5]=h(te,w[5]),w[6]=h(q,w[6]),w[7]=h(W,w[7])}return w}var v=r("./helpers"),g=function(b,S){return b>>>S|b<<32-S},y=function(b,S){return b>>>S};n.exports=function(b){return v.hash(b,m,32,!0)}}).call(this,r("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},r("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha256.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],10:[function(r,n,a){(function(i,o,s,u,l,c,d,f,p){a.read=function(h,m,v,g,D){var b,S,x=8*D-g-1,C=(1<<x)-1,w=C>>1,_=-7,E=v?D-1:0,P=v?-1:1,D=h[m+E];for(E+=P,b=D&(1<<-_)-1,D>>=-_,_+=x;0<_;b=256*b+h[m+E],E+=P,_-=8);for(S=b&(1<<-_)-1,b>>=-_,_+=g;0<_;S=256*S+h[m+E],E+=P,_-=8);if(b===0)b=1-w;else{if(b===C)return S?NaN:1/0*(D?-1:1);S+=Math.pow(2,g),b-=w}return(D?-1:1)*S*Math.pow(2,b-g)},a.write=function(h,m,v,g,y,k){var S,x,C=8*k-y-1,w=(1<<C)-1,_=w>>1,E=y===23?Math.pow(2,-24)-Math.pow(2,-77):0,P=g?0:k-1,D=g?1:-1,k=m<0||m===0&&1/m<0?1:0;for(m=Math.abs(m),isNaN(m)||m===1/0?(x=isNaN(m)?1:0,S=w):(S=Math.floor(Math.log(m)/Math.LN2),m*(g=Math.pow(2,-S))<1&&(S--,g*=2),2<=(m+=1<=S+_?E/g:E*Math.pow(2,1-_))*g&&(S++,g/=2),w<=S+_?(x=0,S=w):1<=S+_?(x=(m*g-1)*Math.pow(2,y),S+=_):(x=m*Math.pow(2,_-1)*Math.pow(2,y),S=0));8<=y;h[v+P]=255&x,P+=D,x/=256,y-=8);for(S=S<<y|x,C+=y;0<C;h[v+P]=255&S,P+=D,S/=256,C-=8);h[v+P-D]|=128*k}}).call(this,r("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},r("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/ieee754/index.js","/node_modules/gulp-browserify/node_modules/ieee754")},{buffer:3,lYpoI2:11}],11:[function(r,n,a){(function(i,o,s,u,l,c,d,f,p){var h,m,v;function g(){}(i=n.exports={}).nextTick=(m=typeof window<"u"&&window.setImmediate,v=typeof window<"u"&&window.postMessage&&window.addEventListener,m?function(y){return window.setImmediate(y)}:v?(h=[],window.addEventListener("message",function(y){var b=y.source;b!==window&&b!==null||y.data!=="process-tick"||(y.stopPropagation(),0<h.length&&h.shift()())},!0),function(y){h.push(y),window.postMessage("process-tick","*")}):function(y){setTimeout(y,0)}),i.title="browser",i.browser=!0,i.env={},i.argv=[],i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.binding=function(y){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(y){throw new Error("process.chdir is not supported")}}).call(this,r("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},r("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/process/browser.js","/node_modules/gulp-browserify/node_modules/process")},{buffer:3,lYpoI2:11}]},{},[1])(1)})})(QE);var Vl;(function(e){e.V0_3="0.3",e.V0_4="0.4",e.V0_5="0.5",e.V0_6="0.6"})(Vl||(Vl={}));var Yl;(function(e){e.V0_2="0.2",e.V0_3="0.3"})(Yl||(Yl={}));const I8=Object.keys(Vl);Vl.V0_6;const M8=Object.keys(Yl),gy=Yl.V0_3;var Kr;(function(e){e.Inputs="inputs",e.Outputs="outputs",e.State="state",e.Definition="definition",e.DefinitionUpdateRequest="definitionupdaterequest",e.Error="error",e.UrlHashUpdate="urlhashupdate",e.Message="Message"})(Kr||(Kr={}));var fo;(function(e){e.InputsUpdate="InputsUpdate",e.OutputsUpdate="OutputsUpdate",e.SetupIframeClientRequest="SetupIframeClientRequest",e.SetupIframeServerResponseAck="SetupIframeServerResponseAck",e.PluginRequest="SetupIframeServerPluginRequestResponseAck",e.HashParamsUpdate="HashParamsUpdate"})(fo||(fo={}));var Xc;(function(e){e.InputsUpdate="InputsUpdate",e.MessageAck="MessageAck",e.SetupIframeServerResponse="SetupIframeServerResponse"})(Xc||(Xc={}));var ZE;(function(e){e.State="metapage/state"})(ZE||(ZE={}));const Kl="metapage/definition",ip="metapage/state",fH=M8[M8.length-1],Ire=I8[I8.length-1];function X3(e,t){const r=WS(e),n=WS(t),a=r.pop(),i=n.pop(),o=JE(r,n);return o!==0?o:a&&i?JE(a.split("."),i.split(".")):a||i?a?-1:1:0}const Mre=e=>typeof e=="string"&&/^[v\d]/.test(e)&&pH.test(e),Ev=(e,t,r)=>{Rre(r);const n=X3(e,t);return hH[r].includes(n)},Dre=(e,t)=>{const r=t.match(/^([<>=~^]+)/),n=r?r[1]:"=";if(n!=="^"&&n!=="~")return Ev(e,t,n);const[a,i,o]=WS(e),[s,u,l]=WS(t);return Xx(a,s)!==0?!1:n==="^"?JE([i,o],[u,l])>=0:Xx(i,u)!==0?!1:Xx(o,l)>=0};X3.validate=Mre;X3.compare=Ev;X3.satisfies=Dre;const pH=/^[v^~<>=]*?(\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+))?(?:-([\da-z\-]+(?:\.[\da-z\-]+)*))?(?:\+[\da-z\-]+(?:\.[\da-z\-]+)*)?)?)?$/i,WS=e=>{if(typeof e!="string")throw new TypeError("Invalid argument expected string");const t=e.match(pH);if(!t)throw new Error(`Invalid argument not valid semver ('${e}' received)`);return t.shift(),t},D8=e=>e==="*"||e==="x"||e==="X",k8=e=>{const t=parseInt(e,10);return isNaN(t)?e:t},kre=(e,t)=>typeof e!=typeof t?[String(e),String(t)]:[e,t],Xx=(e,t)=>{if(D8(e)||D8(t))return 0;const[r,n]=kre(k8(e),k8(t));return r>n?1:r<n?-1:0},JE=(e,t)=>{for(let r=0;r<Math.max(e.length,t.length);r++){const n=Xx(e[r]||0,t[r]||0);if(n!==0)return n}return 0},hH={">":[1],">=":[0,1],"=":[0],"<=":[-1,0],"<":[-1]},R8=Object.keys(hH),Rre=e=>{if(typeof e!="string")throw new TypeError(`Invalid operator type, expected string but got ${typeof e}`);if(R8.indexOf(e)===-1)throw new Error(`Invalid operator, expected one of ${R8.join("|")}`)};var Y3={exports:{}};(function(e){var t=Object.prototype.hasOwnProperty,r="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(r=!1));function a(u,l,c){this.fn=u,this.context=l,this.once=c||!1}function i(u,l,c,d,f){if(typeof c!="function")throw new TypeError("The listener must be a function");var p=new a(c,d||u,f),h=r?r+l:l;return u._events[h]?u._events[h].fn?u._events[h]=[u._events[h],p]:u._events[h].push(p):(u._events[h]=p,u._eventsCount++),u}function o(u,l){--u._eventsCount===0?u._events=new n:delete u._events[l]}function s(){this._events=new n,this._eventsCount=0}s.prototype.eventNames=function(){var l=[],c,d;if(this._eventsCount===0)return l;for(d in c=this._events)t.call(c,d)&&l.push(r?d.slice(1):d);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(c)):l},s.prototype.listeners=function(l){var c=r?r+l:l,d=this._events[c];if(!d)return[];if(d.fn)return[d.fn];for(var f=0,p=d.length,h=new Array(p);f<p;f++)h[f]=d[f].fn;return h},s.prototype.listenerCount=function(l){var c=r?r+l:l,d=this._events[c];return d?d.fn?1:d.length:0},s.prototype.emit=function(l,c,d,f,p,h){var m=r?r+l:l;if(!this._events[m])return!1;var v=this._events[m],g=arguments.length,y,b;if(v.fn){switch(v.once&&this.removeListener(l,v.fn,void 0,!0),g){case 1:return v.fn.call(v.context),!0;case 2:return v.fn.call(v.context,c),!0;case 3:return v.fn.call(v.context,c,d),!0;case 4:return v.fn.call(v.context,c,d,f),!0;case 5:return v.fn.call(v.context,c,d,f,p),!0;case 6:return v.fn.call(v.context,c,d,f,p,h),!0}for(b=1,y=new Array(g-1);b<g;b++)y[b-1]=arguments[b];v.fn.apply(v.context,y)}else{var S=v.length,x;for(b=0;b<S;b++)switch(v[b].once&&this.removeListener(l,v[b].fn,void 0,!0),g){case 1:v[b].fn.call(v[b].context);break;case 2:v[b].fn.call(v[b].context,c);break;case 3:v[b].fn.call(v[b].context,c,d);break;case 4:v[b].fn.call(v[b].context,c,d,f);break;default:if(!y)for(x=1,y=new Array(g-1);x<g;x++)y[x-1]=arguments[x];v[b].fn.apply(v[b].context,y)}}return!0},s.prototype.on=function(l,c,d){return i(this,l,c,d,!1)},s.prototype.once=function(l,c,d){return i(this,l,c,d,!0)},s.prototype.removeListener=function(l,c,d,f){var p=r?r+l:l;if(!this._events[p])return this;if(!c)return o(this,p),this;var h=this._events[p];if(h.fn)h.fn===c&&(!f||h.once)&&(!d||h.context===d)&&o(this,p);else{for(var m=0,v=[],g=h.length;m<g;m++)(h[m].fn!==c||f&&!h[m].once||d&&h[m].context!==d)&&v.push(h[m]);v.length?this._events[p]=v.length===1?v[0]:v:o(this,p)}return this},s.prototype.removeAllListeners=function(l){var c;return l?(c=r?r+l:l,this._events[c]&&o(this,c)):(this._events=new n,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=r,s.EventEmitter=s,e.exports=s})(Y3);var XS;(function(e){e.mp_debug="mp_debug"})(XS||(XS={}));const Ore=()=>{try{return window!==window.top}catch{return!1}},mH={version:gy,metaframes:{}};class Bre extends Y3.exports.EventEmitter{constructor(){super(),this._definition=mH,this.getDefinition=this.getDefinition.bind(this)}error(t){throw"Subclass should implement"}getDefinition(){return this._definition}}var Fre=globalThis&&globalThis.__awaiter||function(e,t,r,n){function a(i){return i instanceof r?i:new r(function(o){o(i)})}return new(r||(r=Promise))(function(i,o){function s(c){try{l(n.next(c))}catch(d){o(d)}}function u(c){try{l(n.throw(c))}catch(d){o(d)}}function l(c){c.done?i(c.value):a(c.value).then(s,u)}l((n=n.apply(e,t||[])).next())})},YS=globalThis&&globalThis.__rest||function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,n=Object.getOwnPropertySymbols(e);a<n.length;a++)t.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(r[n[a]]=e[n[a]]);return r};const vH=e=>{if(e===null)throw"Metapage definition cannot be null";if(typeof e=="string")try{e=JSON.parse(e)}catch{throw`Cannot parse into JSON:
${e}`}if(!e.version)throw'Missing "version" key in metapage definition';let t;switch(Ure(e.version)){case Yl.V0_2:{t=vH(zre(e));break}case Yl.V0_3:{t=e;break}default:console.warn(`Metapage definition version=${e.version} but we only know up to version ${gy}. Assuming the definition is compatible, but it's the future!`),t=e;break}return t},gH=(e,t)=>{if(!!e)switch(e.version){case void 0:case Vl.V0_3:case Vl.V0_4:return gH(Lre(e));case Vl.V0_5:return Nre(e);case Vl.V0_6:return e;default:if(t?.errorIfUnknownVersion)throw`Unsupported metaframe version. Please upgrade to a new version: npm i @metapages/metapage@latest
 ${JSON.stringify(e)}
${window.location.href}`;return console.error(`Unsupported metaframe version. Not throwing an error because you might not be able to upgrade. Please upgrade to a new version: npm i @metapages/metapage@latest
 ${JSON.stringify(e)}
${window.location.href}`),e}},Lre=e=>{const{version:t,inputs:r,outputs:n,allow:a,metadata:i}=e,o=YS(e,["version","inputs","outputs","allow","metadata"]),s=i,{title:u,author:l,image:c,descriptionUrl:d,keywords:f,iconUrl:p}=s,h=YS(s,["title","author","image","descriptionUrl","keywords","iconUrl"]),m=Object.assign({name:u,author:l,description:d,image:c,tags:f},h);return Object.assign({version:Vl.V0_5,inputs:r,outputs:n,allow:a,metadata:m},o)},Nre=e=>{var t;const{metadata:r}=e,n=YS(e,["metadata"]),a=Object.assign(Object.assign({},n),{version:Vl.V0_6});if(r){const{edit:i}=r,o=YS(r,["edit"]),s=Object.assign({},o);if(a.metadata=s,i&&!(!((t=s?.operations)===null||t===void 0)&&t.edit))switch(s.operations||(s.operations={}),i.type){case"metapage":const u=i.value,l={type:"metapage",metapage:u.definition,metaframe:u.key||"edit"};s.operations.edit=l;break;case"metaframe":const c=i.value,d={type:"url",url:c.url,params:c.params?c.params.map(f=>({to:f.to,from:f.from,toType:f.toType==="path"?void 0:f.toType})):void 0};s.operations.edit=d;break;default:throw`Unsupported edit type: ${i.type} in metadata for metaframe ${JSON.stringify(r)}`}}return a},zre=e=>(e.version=Yl.V0_3,e),KS=(e,t)=>{if(!t)return!1;let r=!1;return Object.keys(t).forEach(n=>{r=!0,t[n]===void 0?delete e[n]:e[n]=t[n]}),r},Ure=e=>{if(e==="latest")return gy;if(Ev(e,"0.2","<"))throw`Unknown version: ${e}`;return Ev(e,"0.2",">=")&&Ev(e,Yl.V0_3,"<")?Yl.V0_2:Ev(e,"0.3",">=")?Yl.V0_3:(console.log(`Could not match version=${e} to any known version, assuming ${gy}`),gy)},eP=()=>{const e=new URLSearchParams(window.location.search).get(XS.mp_debug);return e==="true"||e==="1"},Vre=e=>e.filter(r=>new URLSearchParams(window.location.search).has(r)).length>0,Hre=(e=8)=>jre(e),O8="abcdefghijklmnopqrstuvwxyz0123456789",jre=(e=8)=>{for(var t="",r=O8.length,n=0;n<e;n++)t+=O8.charAt(Math.floor(Math.random()*r));return t},jM=(e,t,r)=>{t=t||"000",t&&t.trim()==""&&(t=void 0);let n;if(typeof e=="string"?n=e:typeof e=="number"?n=e+"":n=JSON.stringify(e,null,"  "),t&&t.trim()!=""){var a=`color: #${t}`;r&&(a=`${a}; background: #${r}`),n=`%c${n}`,window.console.log(n,a)}else window.console.log(n)},yH=e=>qre(Gre(e)),Gre=e=>{var t=0;for(let r=0;r<e.length;r++)t=e.charCodeAt(r)+((t<<5)-t);return t},qre=e=>{var t=(e&16777215).toString(16).toUpperCase();return"00000".substring(0,6-t.length)+t},M4=()=>document.readyState=="complete"||document.readyState=="interactive",GM=()=>Fre(void 0,void 0,void 0,function*(){return M4()?Promise.resolve():new Promise(e=>{if(M4()){e();return}let t=!1;window.addEventListener("load",()=>{t||(t=!0,e())}),setTimeout(()=>{!t&&M4()&&(t=!0,e())},200)})});var Yc={};(function(e){(function(t){function r(f){var p=encodeURIComponent(f),h=p.replace(/%([0-9A-F]{2})/g,function(m,v){return String.fromCharCode(parseInt(v,16))});return h}function n(f){var p=r(f),h=c(p);return h}function a(f){var p=r(f);return btoa(p)}function i(f){var p=f.replace(/(.)/g,function(h,m){var v=m.charCodeAt(0).toString(16).toUpperCase();return v.length<2&&(v="0"+v),"%"+v});return decodeURIComponent(p)}function o(f){var p=u(f);return i(p)}function s(f){var p=atob(f);return i(p)}function u(f){var p=Array.prototype.map.call(f,function(h){return String.fromCharCode(h)}).join("");return p}function l(f){var p=u(f);return btoa(p)}function c(f){var p;return typeof Uint8Array<"u"?p=new Uint8Array(f.length):p=[],Array.prototype.forEach.call(f,function(h,m){p[m]=h.charCodeAt(0)}),p}function d(f){var p=atob(f),h=c(p);return h}t.Unibabel={utf8ToBinaryString:r,utf8ToBuffer:n,utf8ToBase64:a,binaryStringToUtf8:i,bufferToUtf8:o,base64ToUtf8:s,bufferToBinaryString:u,bufferToBase64:l,binaryStringToBuffer:c,base64ToBuffer:d,strToUtf8Arr:n,utf8ArrToStr:o,arrToBase64:l,base64ToArr:d}})(e||typeof window<"u"&&window||qg)})(Yc);var qM=globalThis&&globalThis.__awaiter||function(e,t,r,n){function a(i){return i instanceof r?i:new r(function(o){o(i)})}return new(r||(r=Promise))(function(i,o){function s(c){try{l(n.next(c))}catch(d){o(d)}}function u(c){try{l(n.throw(c))}catch(d){o(d)}}function l(c){c.done?i(c.value):a(c.value).then(s,u)}l((n=n.apply(e,t||[])).next())})};const K3=e=>qM(void 0,void 0,void 0,function*(){for(const t of Object.keys(e)){const r=yield Wre(e[t]);e[t]=r}return e}),yy=e=>qM(void 0,void 0,void 0,function*(){for(const t of Object.keys(e)){const r=yield Xre(e[t]);e[t]=r}return e}),Wre=e=>qM(void 0,void 0,void 0,function*(){if(e instanceof Int8Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array){const t=e,r={_s:!0,_c:e.constructor.name,value:Yc.Unibabel.bufferToBase64(new Uint8Array(t.buffer)),byteLength:t.byteLength,byteOffset:t.byteOffset};return Promise.resolve(r)}else if(e instanceof File){const t=e,r=yield t.arrayBuffer();return{_s:!0,_c:File.name,value:Yc.Unibabel.bufferToBase64(new Uint8Array(r)),name:t.name,fileType:t.type,lastModified:t.lastModified}}else if(e instanceof Blob){const t=e,r=yield t.arrayBuffer();return{_s:!0,_c:Blob.name,value:Yc.Unibabel.bufferToBase64(new Uint8Array(r)),fileType:t.type}}else if(e instanceof ArrayBuffer){const t=e,r={_s:!0,_c:ArrayBuffer.name,value:Yc.Unibabel.bufferToBase64(new Uint8Array(t))};return Promise.resolve(r)}return Promise.resolve(e)}),Xre=e=>{if(!(e&&typeof e=="object"&&e._s===!0))return e;const t=e,r=t._c;if(r===Blob.name){const o=e;return new Blob([Yc.Unibabel.base64ToBuffer(t.value)],{type:o.fileType})}else if(r===File.name){const o=e;return new File([Yc.Unibabel.base64ToBuffer(t.value)],o.name,{type:o.fileType,lastModified:o.lastModified})}else if(r===ArrayBuffer.name)return Yc.Unibabel.base64ToBuffer(t.value).buffer;const n=e,a=Yc.Unibabel.base64ToBuffer(n.value),i=n._c;try{return new globalThis[i](a,n.byteOffset,n.byteLength)}catch{}return e};var D4=globalThis&&globalThis.__awaiter||function(e,t,r,n){function a(i){return i instanceof r?i:new r(function(o){o(i)})}return new(r||(r=Promise))(function(i,o){function s(c){try{l(n.next(c))}catch(d){o(d)}}function u(c){try{l(n.throw(c))}catch(d){o(d)}}function l(c){c.done?i(c.value):a(c.value).then(s,u)}l((n=n.apply(e,t||[])).next())})};class B8 extends Y3.exports.EventEmitter{constructor(t,r,n,a,i,o=!1){if(super(),this.inputs={},this.outputs={},this._disposables=[],this._rpcListeners=[],this._loaded=!1,this._onLoaded=[],this._sendInputsAfterRegistration=!1,this._plugin=!1,this._cachedEventInputsUpdate={iframeId:void 0,inputs:void 0},this._cachedEventOutputsUpdate={iframeId:null,inputs:null},!r.startsWith("http")){for(;r.startsWith("/");)r=r.substring(1);r=window.location.protocol+"//"+window.location.hostname+(window.location.port&&window.location.port!=""?":"+window.location.port:"")+"/"+r}this.url=r,this._metapage=t;var s=new URL(this.url);o&&s.searchParams.set(XS.mp_debug,"true"),this.url=s.href,this.id=n,this._debug=o,this._parentId=a,this._color=yH(this.id),this._consoleBackgroundColor=i,this._iframe=document.createElement("iframe"),this._iframe.name=this.id;const u=this;this.iframe=new Promise(l=>{GM().then(()=>D4(this,void 0,void 0,function*(){if(u._iframe){const c=yield u.getDefinition();if(!u._iframe)return;c?.allow&&(u._iframe.allow=c.allow),u._iframe.src=this.url,l(u._iframe)}}))}),this.ack=this.ack.bind(this),this.dispose=this.dispose.bind(this),this.getDefinition=this.getDefinition.bind(this),this.getDefinitionUrl=this.getDefinitionUrl.bind(this),this.setPlugin=this.setPlugin.bind(this),this.hasPermissionsDefinition=this.hasPermissionsDefinition.bind(this),this.hasPermissionsState=this.hasPermissionsState.bind(this),this.log=this.log.bind(this),this.logInternal=this.logInternal.bind(this),this.onInput=this.onInput.bind(this),this.onInputs=this.onInputs.bind(this),this.onOutput=this.onOutput.bind(this),this.onOutputs=this.onOutputs.bind(this),this.register=this.register.bind(this),this.registered=this.registered.bind(this),this.sendInputs=this.sendInputs.bind(this),this.sendOrBufferPostMessage=this.sendOrBufferPostMessage.bind(this),this.sendRpc=this.sendRpc.bind(this),this.sendRpcInternal=this.sendRpcInternal.bind(this),this.setInput=this.setInput.bind(this),this.setInputs=this.setInputs.bind(this),this.setMetapage=this.setMetapage.bind(this),this.setOutput=this.setOutput.bind(this),this.setOutputs=this.setOutputs.bind(this),this.setPlugin=this.setPlugin.bind(this),this.addListenerReturnDisposer=this.addListenerReturnDisposer.bind(this),this.isDisposed=this.isDisposed.bind(this)}addListenerReturnDisposer(t,r){return super.addListener(t,r),()=>{super.removeListener(t,r)}}setPlugin(){if(this._loaded)throw"Cannot setPlugin after MetapageIFrameRpcClient already loaded";return this._plugin=!0,this}setMetapage(t){return this._metapage=t,this}hasPermissionsState(){return this._definition!==void 0&&this._definition.inputs!==void 0&&this._definition.inputs[ip]!==void 0}hasPermissionsDefinition(){return this._definition!==void 0&&this._definition.inputs!==void 0&&this._definition.inputs[Kl]!==void 0}getDefinitionUrl(){var t=new URL(this.url);return t.pathname=t.pathname+(t.pathname.endsWith("/")?"metaframe.json":"/metaframe.json"),t.href}getDefinition(){return D4(this,void 0,void 0,function*(){if(this._definition)return this._definition;var t=this.getDefinitionUrl();try{const r=yield window.fetch(t);if(r.ok){const n=yield r.json(),a=gH(n);return this._definition=a,this._definition}else this.emit(Kr.Error,`Failed to fetch: ${t}
Status: ${r.status}
Status text: ${r.statusText}`)}catch(r){this.emit(Kr.Error,`Failed to fetch or convert: ${t}
Error: ${r}`)}})}setInput(t,r){console.assert(!!t);var n={};n[t]=r,this.setInputs(n)}setInputs(t){if(this.log({m:"MetapageIFrameRpcClient",inputs:t}),!KS(this.inputs,t))return this;if(this._loaded||(this._sendInputsAfterRegistration=!0),this._iframe.parentNode&&this._loaded&&this.sendInputs(t),this.emit(Kr.Inputs,this.inputs),this._metapage.listenerCount(Kr.Inputs)>0){var r={};r[this.id]=t,this._metapage.emit(Kr.Inputs,r)}return this}setOutput(t,r){console.assert(!!t);var n={};n[t]=r,this.setOutputs(n)}setOutputs(t){if(!!KS(this.outputs,t)&&(this.emit(Kr.Outputs,t),this._metapage.listenerCount(Kr.Outputs)>0)){var r={};r[this.id]=this.outputs,this._metapage.emit(Kr.Outputs,r)}}onInputs(t){return this.addListenerReturnDisposer(Kr.Inputs,t)}onInput(t,r){var n=function(a){a.hasOwnProperty(t)&&r(a[t])};return this.addListenerReturnDisposer(Kr.Inputs,n)}onOutputs(t){return this.addListenerReturnDisposer(Kr.Outputs,t)}onOutput(t,r){var n=function(a){a.hasOwnProperty(t)&&r(a[t])};return this.addListenerReturnDisposer(Kr.Outputs,n)}isDisposed(){return this.inputs===void 0}dispose(){for(super.removeAllListeners();this._disposables&&this._disposables.length>0;){const t=this._disposables.pop();t&&t()}this._rpcListeners=void 0,this.inputs=void 0,this.outputs=void 0,this._iframe&&this._iframe.parentNode&&this._iframe.parentNode.removeChild(this._iframe),this._iframe=void 0,this._bufferMessages=void 0,this._bufferTimeout&&(window.clearInterval(this._bufferTimeout),this._bufferTimeout=void 0),this._metapage=void 0}register(){var t={iframeId:this.id,parentId:this._parentId,plugin:this._plugin,state:{inputs:this.inputs},version:fH};this.sendRpcInternal(Xc.SetupIframeServerResponse,t)}registered(t){if(this.log({m:"MetapageIFrameRpcClient.registered",inputs:this.inputs}),!this._loaded){if(!t)throw"Cannot register without a version";for(this.version=t,this._loaded=!0;this._onLoaded&&this._onLoaded.length>0;)this._onLoaded.pop()();this._sendInputsAfterRegistration&&this.sendInputs(this.inputs)}}sendInputs(t){return D4(this,void 0,void 0,function*(){t=yield K3(t),this.sendRpc(Xc.InputsUpdate,{inputs:t,parentId:this._parentId})})}sendRpc(t,r){if(this._iframe.parentNode&&this._loaded)this.sendRpcInternal(t,r);else{this._metapage.error("sending rpc later");const n=this;this._onLoaded.push(()=>{n.sendRpcInternal(t,r)})}}ack(t){if(this.log("\u2692 \u2692 \u2692 calling ack"),this._debug){this.log("\u2692 \u2692 \u2692 sending ack from client to frame");var r={message:t};this.sendRpc(Xc.MessageAck,r)}else this.log("\u2692 \u2692 \u2692 NOT sending ack from client to frame since not debug mode")}log(t){!this._debug||this.logInternal(t)}logInternal(t){let r;typeof t=="string"?r=t:typeof t=="string"?r=t+"":r=JSON.stringify(t),jM(`Metapage[${this._parentId}] Metaframe[${this.id}] ${r}`,this._color,this._consoleBackgroundColor)}sendRpcInternal(t,r){const n={id:"_",iframeId:this.id,jsonrpc:"2.0",method:t,params:r,parentId:this._parentId};this._iframe?this.sendOrBufferPostMessage(n):this._metapage.error(`Cannot send to child iframe messageJSON=${JSON.stringify(n).substring(0,200)}`)}sendOrBufferPostMessage(t){if(this._iframe&&this._iframe.contentWindow)this._iframe.contentWindow.postMessage(t,this.url);else if(this._bufferMessages)this._bufferMessages.push(t);else{this._bufferMessages=[t];const r=this;this._bufferTimeout=window.setInterval(function(){r._iframe&&r._iframe.contentWindow&&(r._bufferMessages.forEach(n=>r._iframe.contentWindow.postMessage(n,r.url)),window.clearInterval(r._bufferTimeout),r._bufferTimeout=void 0,r._bufferMessages=void 0)},0)}}}var Yre=globalThis&&globalThis.__awaiter||function(e,t,r,n){function a(i){return i instanceof r?i:new r(function(o){o(i)})}return new(r||(r=Promise))(function(i,o){function s(c){try{l(n.next(c))}catch(d){o(d)}}function u(c){try{l(n.throw(c))}catch(d){o(d)}}function l(c){c.done?i(c.value):a(c.value).then(s,u)}l((n=n.apply(e,t||[])).next())})},F8;(function(e){e.all="all",e.delta="delta"})(F8||(F8={}));const L8=()=>({metaframes:{inputs:{},outputs:{}},plugins:{inputs:{},outputs:{}}}),Kre=(e,t)=>!t||t==="*"||e===t?!0:t.endsWith("*")?e.startsWith(t.slice(0,-1)):t.startsWith("*")?e.endsWith(t.slice(1)):!1,$re="bcbcbc";class bu extends Bre{constructor(t){super(),this._state=L8(),this._metaframes={},this._plugins={},this._pluginOrder=[],this.debug=eP(),this._internalReceivedMessageCounter=0,this._cachedInputLookupMap={},this._inputMap={},this._id=t&&t.id?t.id:Hre(),this._consoleBackgroundColor=t&&t.color?t.color:$re,this.addPipe=this.addPipe.bind(this),this.dispose=this.dispose.bind(this),this.addMetaframe=this.addMetaframe.bind(this),this.addPlugin=this.addPlugin.bind(this),this.getInputsFromOutput=this.getInputsFromOutput.bind(this),this.getMetaframe=this.getMetaframe.bind(this),this.getMetaframeIds=this.getMetaframeIds.bind(this),this.getMetaframeOrPlugin=this.getMetaframeOrPlugin.bind(this),this.getMetaframes=this.getMetaframes.bind(this),this.getPlugin=this.getPlugin.bind(this),this.getPluginIds=this.getPluginIds.bind(this),this.getState=this.getState.bind(this),this.getStateMetaframes=this.getStateMetaframes.bind(this),this.isValidJSONRpcMessage=this.isValidJSONRpcMessage.bind(this),this.log=this.log.bind(this),this.logInternal=this.logInternal.bind(this),this.metaframeIds=this.metaframeIds.bind(this),this.metaframes=this.metaframes.bind(this),this.onMessage=this.onMessage.bind(this),this.pluginIds=this.pluginIds.bind(this),this.plugins=this.plugins.bind(this),this.removeAll=this.removeAll.bind(this),this.removeMetaframe=this.removeMetaframe.bind(this),this.removePlugin=this.removePlugin.bind(this),this.setDebugFromUrlParams=this.setDebugFromUrlParams.bind(this),this.setDefinition=this.setDefinition.bind(this),this.setInput=this.setInput.bind(this),this.setInputs=this.setInputs.bind(this),this.setInputStateOnly=this.setInputStateOnly.bind(this),this.setMetaframeClientInputAndSentClientEvent=this.setMetaframeClientInputAndSentClientEvent.bind(this),this.setOutputStateOnly=this.setOutputStateOnly.bind(this),this.setState=this.setState.bind(this),this.isDisposed=this.isDisposed.bind(this),this.updatePluginsWithDefinition=this.updatePluginsWithDefinition.bind(this),this._emitDefinitionEvent=this._emitDefinitionEvent.bind(this),GM().then(()=>{this.isDisposed()||(window.addEventListener("message",this.onMessage),this.log("Initialized"))})}static from(t,r){if(t==null)throw"Metapage definition cannot be null";if(typeof t=="string")try{t=JSON.parse(t)}catch{throw"Cannot parse into JSON:\n${metaPageDef}"}var n=new bu;return n.setDefinition(t)}isDisposed(){return this._metaframes===void 0}addListenerReturnDisposer(t,r){return super.addListener(t,r),()=>{super.removeListener(t,r)}}setDebugFromUrlParams(){return this.debug=Vre(["MP_DEBUG","DEBUG","debug","mp_debug"]),this}getState(){return this._state}setState(t){this._state=t,this.getMetaframeIds().forEach(r=>{this.getMetaframe(r).setInputs(this._state.metaframes.inputs[r]),this.getMetaframe(r).setOutputs(this._state.metaframes.outputs[r])}),this.getPluginIds().forEach(r=>{this.getPlugin(r).setInputs(this._state.plugins.inputs[r]),this.getPlugin(r).setOutputs(this._state.plugins.outputs[r])}),this.emit(Kr.State,this._state)}getStateMetaframes(){return this._state.metaframes}getDefinition(){return this._definition}setDefinition(t,r){if(!t.version)throw"Metapage definition must have a version";const n=vH(t);n.metaframes&&Object.keys(n.metaframes).forEach(i=>{if(n.plugins&&n.plugins.includes(i))throw this.emitErrorMessage(`Plugin with url=${i} matches metaframe. Metaframe ids and plugin urls are not allowed to collide`),`Plugin with url=${i} matches metaframe. Metaframe ids and plugin urls are not allowed to collide`;var o=n.metaframes[i];if(typeof o!="object")throw this.emitErrorMessage(`Metaframe "${i}" is not an object`),`Metaframe "${i}" is not an object`;if(!o.url)throw this.emitErrorMessage(`Metaframe "${i}" missing field: url`),`Metaframe "${i}" missing field: url`});const a=this._definition;return this._definition=n,Object.keys(this._metaframes).forEach(i=>{(!n.metaframes||!n.metaframes[i])&&this.removeMetaframe(i)}),Object.keys(this._plugins).forEach(i=>{n.plugins&&!n.plugins.includes(i)&&this.removePlugin(i)}),this._pluginOrder=n.plugins?n.plugins:[],r&&(this._state=r),n.metaframes&&Object.keys(n.metaframes).forEach(i=>{if(!this._metaframes.hasOwnProperty(i)){const o=n.metaframes[i];this.addMetaframe(i,o)}}),n.plugins&&n.plugins.forEach(i=>{this._plugins.hasOwnProperty(i)||this.addPlugin(i)}),a!==mH&&window.setTimeout(()=>{!this.isDisposed()&&n===this._definition&&(this._emitDefinitionEvent(),r&&this.emit(Kr.State,this._state))},0),this}_emitDefinitionEvent(){const t={definition:this._definition,metaframes:this._metaframes,plugins:this._plugins};this.emit(Kr.Definition,t)}addPipe(t,r){this._inputMap[t]||(this._inputMap[t]=[]),this._inputMap[t].push(r)}removeMetaframe(t){!this._metaframes[t]||(this._metaframes[t].dispose(),delete this._metaframes[t],delete this._state.metaframes.inputs[t],delete this._state.metaframes.outputs[t],delete this._inputMap[t],Object.keys(this._inputMap).forEach(r=>{var n;const a=this._inputMap[r];let i=0;for(;i<=a.length;)((n=a[i])===null||n===void 0?void 0:n.metaframe)===t?a.splice(i,1):i++}),this._cachedInputLookupMap={})}removePlugin(t){!this._plugins[t]||(this._plugins[t].dispose(),delete this._plugins[t],delete this._state.plugins.inputs[t],delete this._state.plugins.outputs[t])}removeAll(){Object.keys(this._metaframes).forEach(t=>this._metaframes[t].dispose()),Object.keys(this._plugins).forEach(t=>this._plugins[t].dispose()),this._metaframes={},this._plugins={},this._state=L8(),this._inputMap={},this._cachedInputLookupMap={}}metaframes(){return this.getMetaframes()}metaframeIds(){return this.getMetaframeIds()}getMetaframeIds(){return Object.keys(this._metaframes)}getMetaframes(){return Object.assign({},this._metaframes)}plugins(){return Object.assign({},this._plugins)}pluginIds(){return this.getPluginIds()}getPluginIds(){return this._pluginOrder.slice(0)}getMetaframe(t){return this._metaframes[t]}getPlugin(t){return this._plugins[t]}addMetaframe(t,r){if(!t)throw"addMetaframe missing metaframeId";if(!r)throw"addMetaframe missing definition";if(this._metaframes[t])throw this.emitErrorMessage(`Existing metaframe for id=${t}`),`Existing metaframe for id=${t}`;if(!r.url)throw this.emitErrorMessage(`Metaframe definition missing url id=${t}`),`Metaframe definition missing url id=${t}`;var n=new B8(this,r.url,t,this._id,this._consoleBackgroundColor,this.debug).setMetapage(this);return this._metaframes[t]=n,n.addListener(Kr.Error,a=>{this.emit(Kr.Error,{metaframeId:n.id,metaframeUrl:n.url,error:a})}),r.inputs&&r.inputs.forEach(a=>this.addPipe(t,a)),n.setInputs(this._state.metaframes.inputs[t]),n}addPlugin(t){if(!t)throw"Plugin missing url";const r=new B8(this,t,t,this._id,this._consoleBackgroundColor,this.debug).setInputs(this._state.plugins.inputs[t]).setMetapage(this).setPlugin();return Qre(this,r),this._plugins[t]=r,r}dispose(){this.log("disposing"),super.removeAllListeners(),window.removeEventListener("message",this.onMessage),this._metaframes&&Object.keys(this._metaframes).forEach(t=>this._metaframes[t].dispose()),this._plugins&&Object.keys(this._plugins).forEach(t=>this._plugins[t].dispose()),this._id=void 0,this._metaframes=void 0,this._plugins=void 0,this._state=void 0,this._cachedInputLookupMap=void 0,this._inputMap=void 0}log(t,r,n){!this.debug||this.logInternal(t,r,n)}error(t){this.logInternal(t,"f00",this._consoleBackgroundColor),this.emitErrorMessage(`${t}`)}emitErrorMessage(t){this.emit(Kr.Error,t)}getInputsFromOutput(t,r){if(this._cachedInputLookupMap[t]||(this._cachedInputLookupMap[t]={}),!this._cachedInputLookupMap[t][r]){var n=[];this._cachedInputLookupMap[t][r]=n,Object.keys(this._inputMap).forEach(a=>{a!==t&&this._inputMap[a].forEach(i=>{if(i.metaframe==t&&Kre(r,i.source)){var o=i.target;(!i.target||i.target.startsWith("*")||i.target==="")&&(o=r),n.push({metaframe:a,pipe:o})}})})}return this._cachedInputLookupMap[t][r]}isValidJSONRpcMessage(t){if(t.jsonrpc!=="2.0")return!1;switch(t.method){case fo.SetupIframeClientRequest:return!0;default:var n=t.iframeId;return!(n&&!(t.parentId===this._id&&(this._metaframes[n]||this._plugins[n])))}}setInput(t,r,n){this.setInputStateOnly(t,r,n),this.setMetaframeClientInputAndSentClientEvent(t,r,n),this.emit(Kr.State,this._state),this.emit(Kr.Inputs,this._state)}setMetaframeClientInputAndSentClientEvent(t,r,n){if(typeof t=="object"){if(r||n)throw"bad arguments, see API docs";const a=t;Object.keys(a).forEach(i=>{var o=i,s=a[o];if(typeof s!="object")throw"bad arguments, see API docs";var u=this._metaframes[o];u?u.setInputs(s):this.error("No iframe id=$metaframeId")})}else if(typeof t=="string"){const a=this._metaframes[t];if(a==null&&this.error(`No iframe id=${t}`),typeof r=="string")a.setInput(r,n);else if(typeof r=="object")a.setInputs(r);else throw"bad arguments, see API docs"}else throw"bad arguments, see API docs"}setInputs(t,r,n){this.setInput(t,r,n)}setOutputStateOnly(t,r,n){this._setStateOnly(!1,t,r,n)}setInputStateOnly(t,r,n){this._setStateOnly(!0,t,r,n)}_setStateOnly(t,r,n,a){if(typeof r=="object"){if(n||a)throw"If first argument is an object, subsequent args should be undefined";const i=r;Object.keys(i).forEach(o=>{var s=i[o];if(typeof s!="object")throw"Object values must be objects";const u=this._metaframes.hasOwnProperty(o);if(!u&&!this._plugins.hasOwnProperty(o))throw"No metaframe or plugin: ${metaframeId}";const l=u?t?this._state.metaframes.inputs:this._state.metaframes.outputs:t?this._state.plugins.inputs:this._state.plugins.outputs;l[o]=l[o]?l[o]:{},Object.keys(s).forEach(c=>{s[c]===void 0?delete l[o][c]:l[o][c]=s[c]})})}else if(typeof r=="string"){const i=r,o=this._metaframes.hasOwnProperty(i);if(!o&&!this._plugins.hasOwnProperty(i))throw`No metaframe or plugin: ${i}`;const s=o?t?this._state.metaframes.inputs:this._state.metaframes.outputs:t?this._state.plugins.inputs:this._state.plugins.outputs;if(typeof n=="string"){s[i]=s[i]?s[i]:{};const u=n;a===void 0?delete s[i][u]:s[i][u]=a}else if(typeof n=="object"){s[i]=s[i]?s[i]:{};const u=n;Object.keys(u).forEach(l=>{u[l]===void 0?delete s[i][l]:s[i][l]=u[l]})}else throw"Second argument must be a string or an object"}else throw"First argument must be a string or an object"}getMetaframeOrPlugin(t){var r=this._metaframes[t];return r||(r=this._plugins[t]),r}onMessage(t){if(typeof t.data=="object"){const o=t.data;if(!this.isValidJSONRpcMessage(o))return;var r=o.method;const s=o.iframeId;if(!s)return;const u=this.getMetaframeOrPlugin(s),l=this._plugins[s];switch(o._messageCount=++this._internalReceivedMessageCounter,this.debug&&this.log(`processing ${JSON.stringify(o,null,"  ").substr(0,500)}`),r){case fo.SetupIframeClientRequest:u&&u.register();break;case fo.SetupIframeServerResponseAck:if(u){const d=o.params;u.registered(d.version)}break;case fo.OutputsUpdate:const c=o.params;if(this._metaframes[s]){var n=this._metaframes[s];this.setOutputStateOnly(s,c),n.setOutputs(c),this.emit(Kr.State,this._state);var a=!1;const d=Object.keys(c),f={};d.forEach((p,h)=>{const m=this.getInputsFromOutput(s,p);m.length>0&&m.forEach(v=>{f[v.metaframe]||(f[v.metaframe]={}),f[v.metaframe][v.pipe]=c[p],this.setInputStateOnly(v.metaframe,v.pipe,c[p]),a=!0})}),Object.keys(f).forEach(p=>{this._metaframes[p].setInputs(f[p])}),a&&this.emit(Kr.State,this._state),this.debug&&n.ack({jsonrpc:o,state:this._state})}else if(this._plugins[s]){const d=!c[ip]&&!c[Kl];d&&this.setOutputStateOnly(s,c),this._plugins[s].setOutputs(c),d&&this.emit(Kr.State,this._state),this.debug&&this._plugins[s].ack({jsonrpc:o,state:this._state})}else this.error("missing metaframe/plugin=$metaframeId");break;case fo.InputsUpdate:var i=o.params;if(this.debug&&this.log(`inputs ${JSON.stringify(i)} from ${s}`),this._metaframes[s])this.setInputStateOnly(s,i),this._metaframes[s].setInputs(i),this.emit(Kr.State,this._state),this.debug&&this._metaframes[s].ack({jsonrpc:o,state:this._state});else if(this._plugins[s]){const d=!i[ip]&&!i[Kl];d&&this.setInputStateOnly(s,i),this._plugins[s].setInputs(i),d&&this.emit(Kr.State,this._state),this.debug&&this._plugins[s].ack({jsonrpc:o,state:this._state})}else console.error(`InputsUpdate failed no metaframe or plugin id: "${s}"`),this.error(`InputsUpdate failed no metaframe or plugin id: "${s}"`);break;case fo.PluginRequest:l&&u&&u.hasPermissionsState()&&(u.setInput(ip,this._state),this.debug&&u.ack({jsonrpc:o,state:this._state}));break;case fo.HashParamsUpdate:if(!l&&u){const d=o.params,f=new URL(u.url);f.hash=d.hash,u.url=f.href,this._definition.metaframes[d.metaframe].url=f.href,this._emitDefinitionEvent()}break;default:this.debug&&this.log(`Unknown RPC method: "${r}"`)}this.emit(Kr.Message,o)}}updatePluginsWithDefinition(){this.getDefinition(),Object.values(this._plugins).forEach(t=>{t.hasPermissionsDefinition()&&Zre(t)})}logInternal(t,r,n){n=n||this._consoleBackgroundColor;let a;typeof t=="string"?a=t:typeof t=="number"?a=t+"":a=JSON.stringify(t),a=this._id?`Metapage[${this._id}] ${a}`:a,jM(a,r,n)}}bu.version=fH;bu.DEFINITION=Kr.Definition;bu.DEFINITION_UPDATE_REQUEST=Kr.DefinitionUpdateRequest;bu.ERROR=Kr.Error;bu.INPUTS=Kr.Inputs;bu.MESSAGE=Kr.Message;bu.OUTPUTS=Kr.Outputs;bu.STATE=Kr.State;bu.deserializeInputs=yy;bu.serializeInputs=K3;const Qre=(e,t)=>Yre(void 0,void 0,void 0,function*(){try{const a=yield t.getDefinition();if(!a)throw`${t.url}`;if(t.isDisposed())return;if(t.hasPermissionsDefinition()){var r=e.addListenerReturnDisposer(Kr.Definition,i=>{t.setInput(Kl,i.definition)});t._disposables.push(r);var n=e.getDefinition();if(n&&(t.setInput(Kl,n),a.outputs)){var r=t.onOutput(Kl,o=>{QE.exports.sha1(o)!==QE.exports.sha1(n)&&e.emit(Kr.DefinitionUpdateRequest,o)});t._disposables.push(r)}}if(t.hasPermissionsState()&&a.outputs){var r=t.onOutput(ip,o=>{e.setState(o)});t._disposables.push(r)}}catch(a){console.error(a),e.emit(Kr.Error,`Failed to get plugin definition from "${t.getDefinitionUrl()}", error=${a}`)}}),Zre=e=>{const t=e._metapage.getDefinition();e.setInput(Kl,t)};var yg=globalThis&&globalThis.__awaiter||function(e,t,r,n){function a(i){return i instanceof r?i:new r(function(o){o(i)})}return new(r||(r=Promise))(function(i,o){function s(c){try{l(n.next(c))}catch(d){o(d)}}function u(c){try{l(n.throw(c))}catch(d){o(d)}}function l(c){c.done?i(c.value):a(c.value).then(s,u)}l((n=n.apply(e,t||[])).next())})},Af;(function(e){e.WaitingForPageLoad="WaitingForPageLoad",e.SentSetupIframeClientRequest="SentSetupIframeClientRequest",e.Ready="Ready"})(Af||(Af={}));var pi;(function(e){e.Connected="connected",e.Error="error",e.Input="input",e.Inputs="inputs",e.Message="message"})(pi||(pi={}));class du extends Y3.exports.EventEmitter{constructor(t){if(super(),this._inputPipeValues={},this._outputPipeValues={},this._state=Af.WaitingForPageLoad,this._messageSendCount=0,this.debug=eP(),this.isInputOutputBlobSerialization=!0,this.id=window.name,this.debug=eP(),this._isIframe=Ore(),this.addListener=this.addListener.bind(this),this.dispose=this.dispose.bind(this),this.error=this.error.bind(this),this.getInput=this.getInput.bind(this),this.getInputs=this.getInputs.bind(this),this.log=this.log.bind(this),this.logInternal=this.logInternal.bind(this),this.onInput=this.onInput.bind(this),this.onInputs=this.onInputs.bind(this),this.onMessage=this.onMessage.bind(this),this.sendRpc=this.sendRpc.bind(this),this.setInput=this.setInput.bind(this),this.setInputs=this.setInputs.bind(this),this.setInternalInputsAndNotify=this.setInternalInputsAndNotify.bind(this),this.setOutput=this.setOutput.bind(this),this.setOutputs=this.setOutputs.bind(this),this.warn=this.warn.bind(this),this._resolveSetupIframeServerResponse=this._resolveSetupIframeServerResponse.bind(this),this.addListenerReturnDisposer=this.addListenerReturnDisposer.bind(this),this.connected=this.connected.bind(this),this.disableNotifyOnHashUrlChange=this.disableNotifyOnHashUrlChange.bind(this),this._onHashUrlChange=this._onHashUrlChange.bind(this),!this._isIframe){this.log("Not an iframe, metaframe code disabled");return}const r=this;GM().then(()=>{this.log("pageLoaded"),window.addEventListener("message",this.onMessage),r.sendRpc(fo.SetupIframeClientRequest,{version:du.version}),r._state=Af.SentSetupIframeClientRequest}),t?.disableHashChangeEvent||window.addEventListener("hashchange",this._onHashUrlChange)}_resolveSetupIframeServerResponse(t){if(this._state===Af.WaitingForPageLoad)throw"Got message but page has not finished loading, we should never get in this state";yg(this,void 0,void 0,function*(){this._parentId?this.log("Got JsonRpcMethods.SetupIframeServerResponse but already resolved"):(this._parentVersion=t.version,this.color=yH(this.id),this._parentId=t.parentId,this.log(`metapage[${this._parentId}](v${this._parentVersion?this._parentVersion:"unknown"}) registered`),t.state&&t.state.inputs&&(this.isInputOutputBlobSerialization?this._inputPipeValues=yield yy(t.state.inputs):this._inputPipeValues=t.state.inputs),this._state=Af.Ready,this.sendRpc(fo.SetupIframeServerResponseAck,{version:du.version}),this._inputPipeValues&&Object.keys(this._inputPipeValues).length>0&&(this.emit(pi.Inputs,this._inputPipeValues),Object.keys(this._inputPipeValues).forEach(r=>this.emit(pi.Input,r,this._inputPipeValues[r]))),this.emit(pi.Inputs,this._inputPipeValues),t.plugin&&(this.plugin=new Jre(this)),this.emit(pi.Connected))})}connected(){return yg(this,void 0,void 0,function*(){if(this._state!==Af.Ready)return new Promise((t,r)=>{let n;n=this.addListenerReturnDisposer(pi.Connected,()=>{t(),n()})})})}addListenerReturnDisposer(t,r){return super.addListener(t,r),()=>{super.removeListener(t,r)}}log(t,r,n){!this.debug||this.logInternal(t,r||this.color)}warn(t){!this.debug||this.logInternal(t,"000",this.color)}error(t){this.logInternal(t,this.color,"f00")}logInternal(t,r,n){let a;typeof t=="string"?a=t:typeof t=="number"?a=t+"":a=JSON.stringify(t),r=r&&r+"",a=(this.id?`Metaframe[${this.id}] `:"")+`${a}`,jM(a,r,n)}dispose(){super.removeAllListeners(),window.removeEventListener("message",this.onMessage),this.disableNotifyOnHashUrlChange(),this._inputPipeValues=void 0,this._outputPipeValues=void 0}addListener(t,r){return super.addListener(t,r),t===pi.Inputs&&window.setTimeout(()=>{this._inputPipeValues&&r(this._inputPipeValues)},0),this}onInput(t,r){return this.addListenerReturnDisposer(pi.Input,(n,a)=>{t===n&&r(a)})}onInputs(t){return this.addListenerReturnDisposer(pi.Inputs,t)}setInput(t,r){var n={};n[t]=r,this.setInputs(n)}setInputs(t){return yg(this,void 0,void 0,function*(){this.isInputOutputBlobSerialization&&(t=yield yy(t)),this.sendRpc(fo.InputsUpdate,t)})}setInternalInputsAndNotify(t){return yg(this,void 0,void 0,function*(){this.isInputOutputBlobSerialization&&(t=yield yy(t)),KS(this._inputPipeValues,t)&&(Object.keys(t).forEach(r=>this.emit(pi.Input,r,t[r])),this.emit(pi.Inputs,t))})}getInput(t){return console.assert(!!t),this._inputPipeValues[t]}getInputs(){return this._inputPipeValues}setOutput(t,r){console.assert(!!t);var n={};n[t]=r,this.setOutputs(n)}setOutputs(t){return yg(this,void 0,void 0,function*(){this.isInputOutputBlobSerialization&&(t=yield K3(t)),KS(this._outputPipeValues,t)&&this.sendRpc(fo.OutputsUpdate,t)})}disableNotifyOnHashUrlChange(){window.removeEventListener("hashchange",this._onHashUrlChange)}_onHashUrlChange(t){const r={hash:window.location.hash,metaframe:this.id};this.sendRpc(fo.HashParamsUpdate,r)}sendRpc(t,r){if(this._isIframe){const n={jsonrpc:"2.0",id:++this._messageSendCount,method:t,params:r,iframeId:this.id,parentId:this._parentId};window.parent.postMessage(n,"*")}else this.log("Cannot send JSON-RPC window message: there is no window.parent which means we are not an iframe")}onMessage(t){if(typeof t.data=="object"){let n=t.data;if(n.jsonrpc==="2.0"){var r=n.method;if(!(r==Xc.SetupIframeServerResponse||n.parentId==this._parentId&&n.iframeId==this.id)){this.log(`window.message: received message but jsonrpc.parentId=${n.parentId} _parentId=${this._parentId} jsonrpc.iframeId=${n.iframeId} id=${this.id}`);return}switch(r){case Xc.SetupIframeServerResponse:this._resolveSetupIframeServerResponse(n.params);break;case Xc.InputsUpdate:if(this._state!==Af.Ready)throw"Got InputsUpdate but metaframe is not MetaframeLoadingState.Ready";this.setInternalInputsAndNotify(n.params.inputs);break;case Xc.MessageAck:this.debug&&this.log(`ACK: ${JSON.stringify(n)}`);break;default:this.debug&&this.log(`window.message: unknown JSON-RPC method: ${JSON.stringify(n)}`);break}this.emit(pi.Message,n)}}}}du.version=Ire;du.ERROR=pi.Error;du.CONNECTED=pi.Connected;du.INPUT=pi.Input;du.INPUTS=pi.Inputs;du.MESSAGE=pi.Message;du.deserializeInputs=yy;du.serializeInputs=K3;class Jre{constructor(t){this._metaframe=t,this.requestState=this.requestState.bind(this),this.onState=this.onState.bind(this),this.getState=this.getState.bind(this),this.setState=this.setState.bind(this),this.onDefinition=this.onDefinition.bind(this),this.getDefinition=this.getDefinition.bind(this),this.setDefinition=this.setDefinition.bind(this)}requestState(){var t={method:ZE.State};this._metaframe.sendRpc(fo.PluginRequest,t)}onState(t){const r=this._metaframe.onInput(ip,t);return this.getState()&&t(this.getState()),r}getState(){return this._metaframe.getInput(ip)}setState(t){this._metaframe.setOutput(ip,t)}onDefinition(t){var r=this._metaframe.onInput(Kl,t);return this.getDefinition()&&t(this.getDefinition()),r}setDefinition(t){this._metaframe.setOutput(Kl,t)}getDefinition(){return this._metaframe.getInput(Kl)}}const ene={inputs:{}},tne={},rne=ke.exports.createContext(tne);ke.exports.createContext(ene);const nne=e=>{const[t,r]=ke.exports.useState({}),[n,a]=ke.exports.useState(void 0);return ke.exports.useEffect(()=>{const i=new du;return a(i),()=>{i.dispose()}},[a]),ke.exports.useEffect(()=>{n&&r({metaframe:n})},[n]),sa.createElement(rne.Provider,{value:t},e.children)};var $S=Boolean(globalThis?.document)?ke.exports.useLayoutEffect:ke.exports.useEffect,$3={exports:{}},Q3={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ane=ke.exports,ine=Symbol.for("react.element"),one=Symbol.for("react.fragment"),sne=Object.prototype.hasOwnProperty,une=ane.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,lne={key:!0,ref:!0,__self:!0,__source:!0};function bH(e,t,r){var n,a={},i=null,o=null;r!==void 0&&(i=""+r),t.key!==void 0&&(i=""+t.key),t.ref!==void 0&&(o=t.ref);for(n in t)sne.call(t,n)&&!lne.hasOwnProperty(n)&&(a[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps,t)a[n]===void 0&&(a[n]=t[n]);return{$$typeof:ine,type:e,key:i,ref:o,props:a,_owner:une.current}}Q3.Fragment=one;Q3.jsx=bH;Q3.jsxs=bH;(function(e){e.exports=Q3})($3);const Nt=$3.exports.Fragment,B=$3.exports.jsx,Pe=$3.exports.jsxs;var WM=ke.exports.createContext({});WM.displayName="ColorModeContext";function XM(){const e=ke.exports.useContext(WM);if(e===void 0)throw new Error("useColorMode must be used within a ColorModeProvider");return e}var b2={light:"chakra-ui-light",dark:"chakra-ui-dark"};function cne(e={}){const{preventTransition:t=!0}=e,r={setDataset:n=>{const a=t?r.preventTransition():void 0;document.documentElement.dataset.theme=n,document.documentElement.style.colorScheme=n,a?.()},setClassName(n){document.body.classList.add(n?b2.dark:b2.light),document.body.classList.remove(n?b2.light:b2.dark)},query(){return window.matchMedia("(prefers-color-scheme: dark)")},getSystemTheme(n){return r.query().matches??n==="dark"?"dark":"light"},addListener(n){const a=r.query(),i=o=>{n(o.matches?"dark":"light")};return typeof a.addListener=="function"?a.addListener(i):a.addEventListener("change",i),()=>{typeof a.removeListener=="function"?a.removeListener(i):a.removeEventListener("change",i)}},preventTransition(){const n=document.createElement("style");return n.appendChild(document.createTextNode("*{-webkit-transition:none!important;-moz-transition:none!important;-o-transition:none!important;-ms-transition:none!important;transition:none!important}")),document.head.appendChild(n),()=>{window.getComputedStyle(document.body),requestAnimationFrame(()=>{requestAnimationFrame(()=>{document.head.removeChild(n)})})}}};return r}var dne="chakra-ui-color-mode";function fne(e){return{ssr:!1,type:"localStorage",get(t){if(!globalThis?.document)return t;let r;try{r=localStorage.getItem(e)||t}catch{}return r||t},set(t){try{localStorage.setItem(e,t)}catch{}}}}var pne=fne(dne),N8=()=>{};function z8(e,t){return e.type==="cookie"&&e.ssr?e.get(t):t}function xH(e){const{value:t,children:r,options:{useSystemColorMode:n,initialColorMode:a,disableTransitionOnChange:i}={},colorModeManager:o=pne}=e,s=a==="dark"?"dark":"light",[u,l]=ke.exports.useState(()=>z8(o,s)),[c,d]=ke.exports.useState(()=>z8(o)),{getSystemTheme:f,setClassName:p,setDataset:h,addListener:m}=ke.exports.useMemo(()=>cne({preventTransition:i}),[i]),v=a==="system"&&!u?c:u,g=ke.exports.useCallback(S=>{const x=S==="system"?f():S;l(x),p(x==="dark"),h(x),o.set(x)},[o,f,p,h]);$S(()=>{a==="system"&&d(f())},[]),ke.exports.useEffect(()=>{const S=o.get();if(S){g(S);return}if(a==="system"){g("system");return}g(s)},[o,s,a,g]);const y=ke.exports.useCallback(()=>{g(v==="dark"?"light":"dark")},[v,g]);ke.exports.useEffect(()=>{if(!!n)return m(g)},[n,m,g]);const b=ke.exports.useMemo(()=>({colorMode:t??v,toggleColorMode:t?N8:y,setColorMode:t?N8:g,forced:t!==void 0}),[v,y,g,t]);return B(WM.Provider,{value:b,children:r})}xH.displayName="ColorModeProvider";var tP={exports:{}};(function(e,t){var r=200,n="__lodash_hash_undefined__",a=800,i=16,o=9007199254740991,s="[object Arguments]",u="[object Array]",l="[object AsyncFunction]",c="[object Boolean]",d="[object Date]",f="[object Error]",p="[object Function]",h="[object GeneratorFunction]",m="[object Map]",v="[object Number]",g="[object Null]",y="[object Object]",b="[object Proxy]",S="[object RegExp]",x="[object Set]",C="[object String]",w="[object Undefined]",_="[object WeakMap]",E="[object ArrayBuffer]",P="[object DataView]",D="[object Float32Array]",k="[object Float64Array]",F="[object Int8Array]",X="[object Int16Array]",U="[object Int32Array]",j="[object Uint8Array]",te="[object Uint8ClampedArray]",q="[object Uint16Array]",W="[object Uint32Array]",V=/[\\^$.*+?()[\]{}|]/g,ee=/^\[object .+?Constructor\]$/,ue=/^(?:0|[1-9]\d*)$/,$={};$[D]=$[k]=$[F]=$[X]=$[U]=$[j]=$[te]=$[q]=$[W]=!0,$[s]=$[u]=$[E]=$[c]=$[P]=$[d]=$[f]=$[p]=$[m]=$[v]=$[y]=$[S]=$[x]=$[C]=$[_]=!1;var Q=typeof qg=="object"&&qg&&qg.Object===Object&&qg,R=typeof self=="object"&&self&&self.Object===Object&&self,Y=Q||R||Function("return this")(),re=t&&!t.nodeType&&t,K=re&&!0&&e&&!e.nodeType&&e,L=K&&K.exports===re,H=L&&Q.process,Z=function(){try{var _e=K&&K.require&&K.require("util").types;return _e||H&&H.binding&&H.binding("util")}catch{}}(),fe=Z&&Z.isTypedArray;function me(_e,Ve,rt){switch(rt.length){case 0:return _e.call(Ve);case 1:return _e.call(Ve,rt[0]);case 2:return _e.call(Ve,rt[0],rt[1]);case 3:return _e.call(Ve,rt[0],rt[1],rt[2])}return _e.apply(Ve,rt)}function xe(_e,Ve){for(var rt=-1,Ht=Array(_e);++rt<_e;)Ht[rt]=Ve(rt);return Ht}function Se(_e){return function(Ve){return _e(Ve)}}function ie(_e,Ve){return _e?.[Ve]}function le(_e,Ve){return function(rt){return _e(Ve(rt))}}var O=Array.prototype,G=Function.prototype,ve=Object.prototype,we=Y["__core-js_shared__"],Te=G.toString,Ue=ve.hasOwnProperty,Ge=function(){var _e=/[^.]+$/.exec(we&&we.keys&&we.keys.IE_PROTO||"");return _e?"Symbol(src)_1."+_e:""}(),Je=ve.toString,st=Te.call(Object),ze=RegExp("^"+Te.call(Ue).replace(V,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),et=L?Y.Buffer:void 0,ut=Y.Symbol,pt=Y.Uint8Array,ht=et?et.allocUnsafe:void 0,Re=le(Object.getPrototypeOf,Object),it=Object.create,Fe=ve.propertyIsEnumerable,tt=O.splice,wt=ut?ut.toStringTag:void 0,dt=function(){try{var _e=Hm(Object,"defineProperty");return _e({},"",{}),_e}catch{}}(),Et=et?et.isBuffer:void 0,oe=Math.max,ge=Date.now,Ee=Hm(Y,"Map"),Ze=Hm(Object,"create"),xt=function(){function _e(){}return function(Ve){if(!Jo(Ve))return{};if(it)return it(Ve);_e.prototype=Ve;var rt=new _e;return _e.prototype=void 0,rt}}();function Tt(_e){var Ve=-1,rt=_e==null?0:_e.length;for(this.clear();++Ve<rt;){var Ht=_e[Ve];this.set(Ht[0],Ht[1])}}function Qt(){this.__data__=Ze?Ze(null):{},this.size=0}function dr(_e){var Ve=this.has(_e)&&delete this.__data__[_e];return this.size-=Ve?1:0,Ve}function _r(_e){var Ve=this.__data__;if(Ze){var rt=Ve[_e];return rt===n?void 0:rt}return Ue.call(Ve,_e)?Ve[_e]:void 0}function Jt(_e){var Ve=this.__data__;return Ze?Ve[_e]!==void 0:Ue.call(Ve,_e)}function ea(_e,Ve){var rt=this.__data__;return this.size+=this.has(_e)?0:1,rt[_e]=Ze&&Ve===void 0?n:Ve,this}Tt.prototype.clear=Qt,Tt.prototype.delete=dr,Tt.prototype.get=_r,Tt.prototype.has=Jt,Tt.prototype.set=ea;function On(_e){var Ve=-1,rt=_e==null?0:_e.length;for(this.clear();++Ve<rt;){var Ht=_e[Ve];this.set(Ht[0],Ht[1])}}function La(){this.__data__=[],this.size=0}function no(_e){var Ve=this.__data__,rt=_u(Ve,_e);if(rt<0)return!1;var Ht=Ve.length-1;return rt==Ht?Ve.pop():tt.call(Ve,rt,1),--this.size,!0}function Os(_e){var Ve=this.__data__,rt=_u(Ve,_e);return rt<0?void 0:Ve[rt][1]}function wu(_e){return _u(this.__data__,_e)>-1}function $o(_e,Ve){var rt=this.__data__,Ht=_u(rt,_e);return Ht<0?(++this.size,rt.push([_e,Ve])):rt[Ht][1]=Ve,this}On.prototype.clear=La,On.prototype.delete=no,On.prototype.get=Os,On.prototype.has=wu,On.prototype.set=$o;function _o(_e){var Ve=-1,rt=_e==null?0:_e.length;for(this.clear();++Ve<rt;){var Ht=_e[Ve];this.set(Ht[0],Ht[1])}}function mc(){this.size=0,this.__data__={hash:new Tt,map:new(Ee||On),string:new Tt}}function Ui(_e){var Ve=Lp(this,_e).delete(_e);return this.size-=Ve?1:0,Ve}function cl(_e){return Lp(this,_e).get(_e)}function Um(_e){return Lp(this,_e).has(_e)}function vc(_e,Ve){var rt=Lp(this,_e),Ht=rt.size;return rt.set(_e,Ve),this.size+=rt.size==Ht?0:1,this}_o.prototype.clear=mc,_o.prototype.delete=Ui,_o.prototype.get=cl,_o.prototype.has=Um,_o.prototype.set=vc;function Ao(_e){var Ve=this.__data__=new On(_e);this.size=Ve.size}function wi(){this.__data__=new On,this.size=0}function Jr(_e){var Ve=this.__data__,rt=Ve.delete(_e);return this.size=Ve.size,rt}function Z0(_e){return this.__data__.get(_e)}function Bb(_e){return this.__data__.has(_e)}function Wr(_e,Ve){var rt=this.__data__;if(rt instanceof On){var Ht=rt.__data__;if(!Ee||Ht.length<r-1)return Ht.push([_e,Ve]),this.size=++rt.size,this;rt=this.__data__=new _o(Ht)}return rt.set(_e,Ve),this.size=rt.size,this}Ao.prototype.clear=wi,Ao.prototype.delete=Jr,Ao.prototype.get=Z0,Ao.prototype.has=Bb,Ao.prototype.set=Wr;function Bp(_e,Ve){var rt=ig(_e),Ht=!rt&&Vp(_e),Qr=!rt&&!Ht&&og(_e),En=!rt&&!Ht&&!Qr&&jm(_e),Xn=rt||Ht||Qr||En,Hr=Xn?xe(_e.length,String):[],Yn=Hr.length;for(var ao in _e)(Ve||Ue.call(_e,ao))&&!(Xn&&(ao=="length"||Qr&&(ao=="offset"||ao=="parent")||En&&(ao=="buffer"||ao=="byteLength"||ao=="byteOffset")||Hb(ao,Yn)))&&Hr.push(ao);return Hr}function dl(_e,Ve,rt){(rt!==void 0&&!Up(_e[Ve],rt)||rt===void 0&&!(Ve in _e))&&Qo(_e,Ve,rt)}function Fp(_e,Ve,rt){var Ht=_e[Ve];(!(Ue.call(_e,Ve)&&Up(Ht,rt))||rt===void 0&&!(Ve in _e))&&Qo(_e,Ve,rt)}function _u(_e,Ve){for(var rt=_e.length;rt--;)if(Up(_e[rt][0],Ve))return rt;return-1}function Qo(_e,Ve,rt){Ve=="__proto__"&&dt?dt(_e,Ve,{configurable:!0,enumerable:!0,value:rt,writable:!0}):_e[Ve]=rt}var J0=Ub();function Xd(_e){return _e==null?_e===void 0?w:g:wt&&wt in Object(_e)?Vb(_e):Gb(_e)}function eg(_e){return Un(_e)&&Xd(_e)==s}function tg(_e){if(!Jo(_e)||$_(_e))return!1;var Ve=Fs(_e)?ze:ee;return Ve.test(zp(_e))}function Fb(_e){return Un(_e)&&jp(_e.length)&&!!$[Xd(_e)]}function Zo(_e){if(!Jo(_e))return jb(_e);var Ve=Bn(_e),rt=[];for(var Ht in _e)Ht=="constructor"&&(Ve||!Ue.call(_e,Ht))||rt.push(Ht);return rt}function rg(_e,Ve,rt,Ht,Qr){_e!==Ve&&J0(Ve,function(En,Xn){if(Qr||(Qr=new Ao),Jo(En))ng(_e,Ve,Xn,rt,rg,Ht,Qr);else{var Hr=Ht?Ht(Bs(_e,Xn),En,Xn+"",_e,Ve,Qr):void 0;Hr===void 0&&(Hr=En),dl(_e,Xn,Hr)}},Gp)}function ng(_e,Ve,rt,Ht,Qr,En,Xn){var Hr=Bs(_e,rt),Yn=Bs(Ve,rt),ao=Xn.get(Yn);if(ao){dl(_e,rt,ao);return}var io=En?En(Hr,Yn,rt+"",_e,Ve,Xn):void 0,$d=io===void 0;if($d){var sg=ig(Yn),ug=!sg&&og(Yn),yc=!sg&&!ug&&jm(Yn);io=Yn,sg||ug||yc?ig(Hr)?io=Hr:Yd(Hr)?io=Vm(Hr):ug?($d=!1,io=G_(Yn,!0)):yc?($d=!1,io=W_(Yn,!0)):io=[]:Wb(Yn)||Vp(Yn)?(io=Hr,Vp(Hr)?io=Xb(Hr):(!Jo(Hr)||Fs(Hr))&&(io=X_(Yn))):$d=!1}$d&&(Xn.set(Yn,io),Qr(io,Yn,Ht,En,Xn),Xn.delete(Yn)),dl(_e,rt,io)}function Lb(_e,Ve){return Np(_i(_e,Ve,gc),_e+"")}var ag=dt?function(_e,Ve){return dt(_e,"toString",{configurable:!0,enumerable:!1,value:To(Ve),writable:!0})}:gc;function G_(_e,Ve){if(Ve)return _e.slice();var rt=_e.length,Ht=ht?ht(rt):new _e.constructor(rt);return _e.copy(Ht),Ht}function q_(_e){var Ve=new _e.constructor(_e.byteLength);return new pt(Ve).set(new pt(_e)),Ve}function W_(_e,Ve){var rt=Ve?q_(_e.buffer):_e.buffer;return new _e.constructor(rt,_e.byteOffset,_e.length)}function Vm(_e,Ve){var rt=-1,Ht=_e.length;for(Ve||(Ve=Array(Ht));++rt<Ht;)Ve[rt]=_e[rt];return Ve}function Nb(_e,Ve,rt,Ht){var Qr=!rt;rt||(rt={});for(var En=-1,Xn=Ve.length;++En<Xn;){var Hr=Ve[En],Yn=Ht?Ht(rt[Hr],_e[Hr],Hr,rt,_e):void 0;Yn===void 0&&(Yn=_e[Hr]),Qr?Qo(rt,Hr,Yn):Fp(rt,Hr,Yn)}return rt}function zb(_e){return Lb(function(Ve,rt){var Ht=-1,Qr=rt.length,En=Qr>1?rt[Qr-1]:void 0,Xn=Qr>2?rt[2]:void 0;for(En=_e.length>3&&typeof En=="function"?(Qr--,En):void 0,Xn&&Y_(rt[0],rt[1],Xn)&&(En=Qr<3?void 0:En,Qr=1),Ve=Object(Ve);++Ht<Qr;){var Hr=rt[Ht];Hr&&_e(Ve,Hr,Ht,En)}return Ve})}function Ub(_e){return function(Ve,rt,Ht){for(var Qr=-1,En=Object(Ve),Xn=Ht(Ve),Hr=Xn.length;Hr--;){var Yn=Xn[_e?Hr:++Qr];if(rt(En[Yn],Yn,En)===!1)break}return Ve}}function Lp(_e,Ve){var rt=_e.__data__;return K_(Ve)?rt[typeof Ve=="string"?"string":"hash"]:rt.map}function Hm(_e,Ve){var rt=ie(_e,Ve);return tg(rt)?rt:void 0}function Vb(_e){var Ve=Ue.call(_e,wt),rt=_e[wt];try{_e[wt]=void 0;var Ht=!0}catch{}var Qr=Je.call(_e);return Ht&&(Ve?_e[wt]=rt:delete _e[wt]),Qr}function X_(_e){return typeof _e.constructor=="function"&&!Bn(_e)?xt(Re(_e)):{}}function Hb(_e,Ve){var rt=typeof _e;return Ve=Ve??o,!!Ve&&(rt=="number"||rt!="symbol"&&ue.test(_e))&&_e>-1&&_e%1==0&&_e<Ve}function Y_(_e,Ve,rt){if(!Jo(rt))return!1;var Ht=typeof Ve;return(Ht=="number"?Hp(rt)&&Hb(Ve,rt.length):Ht=="string"&&Ve in rt)?Up(rt[Ve],_e):!1}function K_(_e){var Ve=typeof _e;return Ve=="string"||Ve=="number"||Ve=="symbol"||Ve=="boolean"?_e!=="__proto__":_e===null}function $_(_e){return!!Ge&&Ge in _e}function Bn(_e){var Ve=_e&&_e.constructor,rt=typeof Ve=="function"&&Ve.prototype||ve;return _e===rt}function jb(_e){var Ve=[];if(_e!=null)for(var rt in Object(_e))Ve.push(rt);return Ve}function Gb(_e){return Je.call(_e)}function _i(_e,Ve,rt){return Ve=oe(Ve===void 0?_e.length-1:Ve,0),function(){for(var Ht=arguments,Qr=-1,En=oe(Ht.length-Ve,0),Xn=Array(En);++Qr<En;)Xn[Qr]=Ht[Ve+Qr];Qr=-1;for(var Hr=Array(Ve+1);++Qr<Ve;)Hr[Qr]=Ht[Qr];return Hr[Ve]=rt(Xn),me(_e,this,Hr)}}function Bs(_e,Ve){if(!(Ve==="constructor"&&typeof _e[Ve]=="function")&&Ve!="__proto__")return _e[Ve]}var Np=qb(ag);function qb(_e){var Ve=0,rt=0;return function(){var Ht=ge(),Qr=i-(Ht-rt);if(rt=Ht,Qr>0){if(++Ve>=a)return arguments[0]}else Ve=0;return _e.apply(void 0,arguments)}}function zp(_e){if(_e!=null){try{return Te.call(_e)}catch{}try{return _e+""}catch{}}return""}function Up(_e,Ve){return _e===Ve||_e!==_e&&Ve!==Ve}var Vp=eg(function(){return arguments}())?eg:function(_e){return Un(_e)&&Ue.call(_e,"callee")&&!Fe.call(_e,"callee")},ig=Array.isArray;function Hp(_e){return _e!=null&&jp(_e.length)&&!Fs(_e)}function Yd(_e){return Un(_e)&&Hp(_e)}var og=Et||Kd;function Fs(_e){if(!Jo(_e))return!1;var Ve=Xd(_e);return Ve==p||Ve==h||Ve==l||Ve==b}function jp(_e){return typeof _e=="number"&&_e>-1&&_e%1==0&&_e<=o}function Jo(_e){var Ve=typeof _e;return _e!=null&&(Ve=="object"||Ve=="function")}function Un(_e){return _e!=null&&typeof _e=="object"}function Wb(_e){if(!Un(_e)||Xd(_e)!=y)return!1;var Ve=Re(_e);if(Ve===null)return!0;var rt=Ue.call(Ve,"constructor")&&Ve.constructor;return typeof rt=="function"&&rt instanceof rt&&Te.call(rt)==st}var jm=fe?Se(fe):Fb;function Xb(_e){return Nb(_e,Gp(_e))}function Gp(_e){return Hp(_e)?Bp(_e,!0):Zo(_e)}var Yb=zb(function(_e,Ve,rt,Ht){rg(_e,Ve,rt,Ht)});function To(_e){return function(){return _e}}function gc(_e){return _e}function Kd(){return!1}e.exports=Yb})(tP,tP.exports);const Hl=tP.exports;function $l(e){const t=typeof e;return e!=null&&(t==="object"||t==="function")&&!Array.isArray(e)}function Th(e,...t){return hne(e)?e(...t):e}var hne=e=>typeof e=="function",mne=e=>/!(important)?$/.test(e),U8=e=>typeof e=="string"?e.replace(/!(important)?$/,"").trim():e,vne=(e,t)=>r=>{const n=String(t),a=mne(n),i=U8(n),o=e?`${e}.${i}`:i;let s=$l(r.__cssMap)&&o in r.__cssMap?r.__cssMap[o].varRef:t;return s=U8(s),a?`${s} !important`:s};function l1(e){const{scale:t,transform:r,compose:n}=e;return(i,o)=>{const s=vne(t,i)(o);let u=r?.(s,o)??s;return n&&(u=n(u,o)),u}}var x2=(...e)=>t=>e.reduce((r,n)=>n(r),t);function Eu(e,t){return r=>{const n={property:r,scale:e};return n.transform=l1({scale:e,transform:t}),n}}var gne=({rtl:e,ltr:t})=>r=>r.direction==="rtl"?e:t;function yne(e){const{property:t,scale:r,transform:n}=e;return{scale:r,property:gne(t),transform:r?l1({scale:r,compose:n}):n}}var SH=["rotate(var(--chakra-rotate, 0))","scaleX(var(--chakra-scale-x, 1))","scaleY(var(--chakra-scale-y, 1))","skewX(var(--chakra-skew-x, 0))","skewY(var(--chakra-skew-y, 0))"];function bne(){return["translateX(var(--chakra-translate-x, 0))","translateY(var(--chakra-translate-y, 0))",...SH].join(" ")}function xne(){return["translate3d(var(--chakra-translate-x, 0), var(--chakra-translate-y, 0), 0)",...SH].join(" ")}var Sne={"--chakra-blur":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-brightness":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-contrast":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-grayscale":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-hue-rotate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-invert":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-saturate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-sepia":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-drop-shadow":"var(--chakra-empty,/*!*/ /*!*/)",filter:["var(--chakra-blur)","var(--chakra-brightness)","var(--chakra-contrast)","var(--chakra-grayscale)","var(--chakra-hue-rotate)","var(--chakra-invert)","var(--chakra-saturate)","var(--chakra-sepia)","var(--chakra-drop-shadow)"].join(" ")},Cne={backdropFilter:["var(--chakra-backdrop-blur)","var(--chakra-backdrop-brightness)","var(--chakra-backdrop-contrast)","var(--chakra-backdrop-grayscale)","var(--chakra-backdrop-hue-rotate)","var(--chakra-backdrop-invert)","var(--chakra-backdrop-opacity)","var(--chakra-backdrop-saturate)","var(--chakra-backdrop-sepia)"].join(" "),"--chakra-backdrop-blur":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-brightness":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-contrast":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-grayscale":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-hue-rotate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-invert":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-opacity":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-saturate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-sepia":"var(--chakra-empty,/*!*/ /*!*/)"};function wne(e){return{"--chakra-ring-offset-shadow":"var(--chakra-ring-inset) 0 0 0 var(--chakra-ring-offset-width) var(--chakra-ring-offset-color)","--chakra-ring-shadow":"var(--chakra-ring-inset) 0 0 0 calc(var(--chakra-ring-width) + var(--chakra-ring-offset-width)) var(--chakra-ring-color)","--chakra-ring-width":e,boxShadow:["var(--chakra-ring-offset-shadow)","var(--chakra-ring-shadow)","var(--chakra-shadow, 0 0 #0000)"].join(", ")}}var _ne={"row-reverse":{space:"--chakra-space-x-reverse",divide:"--chakra-divide-x-reverse"},"column-reverse":{space:"--chakra-space-y-reverse",divide:"--chakra-divide-y-reverse"}},CH="& > :not(style) ~ :not(style)",Ane={[CH]:{marginInlineStart:"calc(var(--chakra-space-x) * calc(1 - var(--chakra-space-x-reverse)))",marginInlineEnd:"calc(var(--chakra-space-x) * var(--chakra-space-x-reverse))"}},Tne={[CH]:{marginTop:"calc(var(--chakra-space-y) * calc(1 - var(--chakra-space-y-reverse)))",marginBottom:"calc(var(--chakra-space-y) * var(--chakra-space-y-reverse))"}},rP={"to-t":"to top","to-tr":"to top right","to-r":"to right","to-br":"to bottom right","to-b":"to bottom","to-bl":"to bottom left","to-l":"to left","to-tl":"to top left"},Ene=new Set(Object.values(rP)),wH=new Set(["none","-moz-initial","inherit","initial","revert","unset"]),Pne=e=>e.trim();function Ine(e,t){var r;if(e==null||wH.has(e))return e;const n=/(?<type>^[a-z-A-Z]+)\((?<values>(.*))\)/g,{type:a,values:i}=((r=n.exec(e))==null?void 0:r.groups)??{};if(!a||!i)return e;const o=a.includes("-gradient")?a:`${a}-gradient`,[s,...u]=i.split(",").map(Pne).filter(Boolean);if(u?.length===0)return e;const l=s in rP?rP[s]:s;u.unshift(l);const c=u.map(d=>{if(Ene.has(d))return d;const f=d.indexOf(" "),[p,h]=f!==-1?[d.substr(0,f),d.substr(f+1)]:[d],m=_H(h)?h:h&&h.split(" "),v=`colors.${p}`,g=v in t.__cssMap?t.__cssMap[v].varRef:p;return m?[g,...Array.isArray(m)?m:[m]].join(" "):g});return`${o}(${c.join(", ")})`}var _H=e=>typeof e=="string"&&e.includes("(")&&e.includes(")"),Mne=(e,t)=>Ine(e,t??{});function Dne(e){return/^var\(--.+\)$/.test(e)}var kne=e=>{const t=parseFloat(e.toString()),r=e.toString().replace(String(t),"");return{unitless:!r,value:t,unit:r}},gl=e=>t=>`${e}(${t})`,ln={filter(e){return e!=="auto"?e:Sne},backdropFilter(e){return e!=="auto"?e:Cne},ring(e){return wne(ln.px(e))},bgClip(e){return e==="text"?{color:"transparent",backgroundClip:"text"}:{backgroundClip:e}},transform(e){return e==="auto"?bne():e==="auto-gpu"?xne():e},vh(e){return e==="$100vh"?"var(--chakra-vh)":e},px(e){if(e==null)return e;const{unitless:t}=kne(e);return t||typeof e=="number"?`${e}px`:e},fraction(e){return typeof e!="number"||e>1?e:`${e*100}%`},float(e,t){const r={left:"right",right:"left"};return t.direction==="rtl"?r[e]:e},degree(e){if(Dne(e)||e==null)return e;const t=typeof e=="string"&&!e.endsWith("deg");return typeof e=="number"||t?`${e}deg`:e},gradient:Mne,blur:gl("blur"),opacity:gl("opacity"),brightness:gl("brightness"),contrast:gl("contrast"),dropShadow:gl("drop-shadow"),grayscale:gl("grayscale"),hueRotate:gl("hue-rotate"),invert:gl("invert"),saturate:gl("saturate"),sepia:gl("sepia"),bgImage(e){return e==null||_H(e)||wH.has(e)?e:`url(${e})`},outline(e){const t=String(e)==="0"||String(e)==="none";return e!==null&&t?{outline:"2px solid transparent",outlineOffset:"2px"}:{outline:e}},flexDirection(e){const{space:t,divide:r}=_ne[e]??{},n={flexDirection:e};return t&&(n[t]=1),r&&(n[r]=1),n}},je={borderWidths:Eu("borderWidths"),borderStyles:Eu("borderStyles"),colors:Eu("colors"),borders:Eu("borders"),radii:Eu("radii",ln.px),space:Eu("space",x2(ln.vh,ln.px)),spaceT:Eu("space",x2(ln.vh,ln.px)),degreeT(e){return{property:e,transform:ln.degree}},prop(e,t,r){return{property:e,scale:t,...t&&{transform:l1({scale:t,transform:r})}}},propT(e,t){return{property:e,transform:t}},sizes:Eu("sizes",x2(ln.vh,ln.px)),sizesT:Eu("sizes",x2(ln.vh,ln.fraction)),shadows:Eu("shadows"),logical:yne,blur:Eu("blur",ln.blur)},Yx={background:je.colors("background"),backgroundColor:je.colors("backgroundColor"),backgroundImage:je.propT("backgroundImage",ln.bgImage),backgroundSize:!0,backgroundPosition:!0,backgroundRepeat:!0,backgroundAttachment:!0,backgroundClip:{transform:ln.bgClip},bgSize:je.prop("backgroundSize"),bgPosition:je.prop("backgroundPosition"),bg:je.colors("background"),bgColor:je.colors("backgroundColor"),bgPos:je.prop("backgroundPosition"),bgRepeat:je.prop("backgroundRepeat"),bgAttachment:je.prop("backgroundAttachment"),bgGradient:je.propT("backgroundImage",ln.gradient),bgClip:{transform:ln.bgClip}};Object.assign(Yx,{bgImage:Yx.backgroundImage,bgImg:Yx.backgroundImage});var gn={border:je.borders("border"),borderWidth:je.borderWidths("borderWidth"),borderStyle:je.borderStyles("borderStyle"),borderColor:je.colors("borderColor"),borderRadius:je.radii("borderRadius"),borderTop:je.borders("borderTop"),borderBlockStart:je.borders("borderBlockStart"),borderTopLeftRadius:je.radii("borderTopLeftRadius"),borderStartStartRadius:je.logical({scale:"radii",property:{ltr:"borderTopLeftRadius",rtl:"borderTopRightRadius"}}),borderEndStartRadius:je.logical({scale:"radii",property:{ltr:"borderBottomLeftRadius",rtl:"borderBottomRightRadius"}}),borderTopRightRadius:je.radii("borderTopRightRadius"),borderStartEndRadius:je.logical({scale:"radii",property:{ltr:"borderTopRightRadius",rtl:"borderTopLeftRadius"}}),borderEndEndRadius:je.logical({scale:"radii",property:{ltr:"borderBottomRightRadius",rtl:"borderBottomLeftRadius"}}),borderRight:je.borders("borderRight"),borderInlineEnd:je.borders("borderInlineEnd"),borderBottom:je.borders("borderBottom"),borderBlockEnd:je.borders("borderBlockEnd"),borderBottomLeftRadius:je.radii("borderBottomLeftRadius"),borderBottomRightRadius:je.radii("borderBottomRightRadius"),borderLeft:je.borders("borderLeft"),borderInlineStart:{property:"borderInlineStart",scale:"borders"},borderInlineStartRadius:je.logical({scale:"radii",property:{ltr:["borderTopLeftRadius","borderBottomLeftRadius"],rtl:["borderTopRightRadius","borderBottomRightRadius"]}}),borderInlineEndRadius:je.logical({scale:"radii",property:{ltr:["borderTopRightRadius","borderBottomRightRadius"],rtl:["borderTopLeftRadius","borderBottomLeftRadius"]}}),borderX:je.borders(["borderLeft","borderRight"]),borderInline:je.borders("borderInline"),borderY:je.borders(["borderTop","borderBottom"]),borderBlock:je.borders("borderBlock"),borderTopWidth:je.borderWidths("borderTopWidth"),borderBlockStartWidth:je.borderWidths("borderBlockStartWidth"),borderTopColor:je.colors("borderTopColor"),borderBlockStartColor:je.colors("borderBlockStartColor"),borderTopStyle:je.borderStyles("borderTopStyle"),borderBlockStartStyle:je.borderStyles("borderBlockStartStyle"),borderBottomWidth:je.borderWidths("borderBottomWidth"),borderBlockEndWidth:je.borderWidths("borderBlockEndWidth"),borderBottomColor:je.colors("borderBottomColor"),borderBlockEndColor:je.colors("borderBlockEndColor"),borderBottomStyle:je.borderStyles("borderBottomStyle"),borderBlockEndStyle:je.borderStyles("borderBlockEndStyle"),borderLeftWidth:je.borderWidths("borderLeftWidth"),borderInlineStartWidth:je.borderWidths("borderInlineStartWidth"),borderLeftColor:je.colors("borderLeftColor"),borderInlineStartColor:je.colors("borderInlineStartColor"),borderLeftStyle:je.borderStyles("borderLeftStyle"),borderInlineStartStyle:je.borderStyles("borderInlineStartStyle"),borderRightWidth:je.borderWidths("borderRightWidth"),borderInlineEndWidth:je.borderWidths("borderInlineEndWidth"),borderRightColor:je.colors("borderRightColor"),borderInlineEndColor:je.colors("borderInlineEndColor"),borderRightStyle:je.borderStyles("borderRightStyle"),borderInlineEndStyle:je.borderStyles("borderInlineEndStyle"),borderTopRadius:je.radii(["borderTopLeftRadius","borderTopRightRadius"]),borderBottomRadius:je.radii(["borderBottomLeftRadius","borderBottomRightRadius"]),borderLeftRadius:je.radii(["borderTopLeftRadius","borderBottomLeftRadius"]),borderRightRadius:je.radii(["borderTopRightRadius","borderBottomRightRadius"])};Object.assign(gn,{rounded:gn.borderRadius,roundedTop:gn.borderTopRadius,roundedTopLeft:gn.borderTopLeftRadius,roundedTopRight:gn.borderTopRightRadius,roundedTopStart:gn.borderStartStartRadius,roundedTopEnd:gn.borderStartEndRadius,roundedBottom:gn.borderBottomRadius,roundedBottomLeft:gn.borderBottomLeftRadius,roundedBottomRight:gn.borderBottomRightRadius,roundedBottomStart:gn.borderEndStartRadius,roundedBottomEnd:gn.borderEndEndRadius,roundedLeft:gn.borderLeftRadius,roundedRight:gn.borderRightRadius,roundedStart:gn.borderInlineStartRadius,roundedEnd:gn.borderInlineEndRadius,borderStart:gn.borderInlineStart,borderEnd:gn.borderInlineEnd,borderTopStartRadius:gn.borderStartStartRadius,borderTopEndRadius:gn.borderStartEndRadius,borderBottomStartRadius:gn.borderEndStartRadius,borderBottomEndRadius:gn.borderEndEndRadius,borderStartRadius:gn.borderInlineStartRadius,borderEndRadius:gn.borderInlineEndRadius,borderStartWidth:gn.borderInlineStartWidth,borderEndWidth:gn.borderInlineEndWidth,borderStartColor:gn.borderInlineStartColor,borderEndColor:gn.borderInlineEndColor,borderStartStyle:gn.borderInlineStartStyle,borderEndStyle:gn.borderInlineEndStyle});var Rne={color:je.colors("color"),textColor:je.colors("color"),fill:je.colors("fill"),stroke:je.colors("stroke")},nP={boxShadow:je.shadows("boxShadow"),mixBlendMode:!0,blendMode:je.prop("mixBlendMode"),backgroundBlendMode:!0,bgBlendMode:je.prop("backgroundBlendMode"),opacity:!0};Object.assign(nP,{shadow:nP.boxShadow});var One={filter:{transform:ln.filter},blur:je.blur("--chakra-blur"),brightness:je.propT("--chakra-brightness",ln.brightness),contrast:je.propT("--chakra-contrast",ln.contrast),hueRotate:je.degreeT("--chakra-hue-rotate"),invert:je.propT("--chakra-invert",ln.invert),saturate:je.propT("--chakra-saturate",ln.saturate),dropShadow:je.propT("--chakra-drop-shadow",ln.dropShadow),backdropFilter:{transform:ln.backdropFilter},backdropBlur:je.blur("--chakra-backdrop-blur"),backdropBrightness:je.propT("--chakra-backdrop-brightness",ln.brightness),backdropContrast:je.propT("--chakra-backdrop-contrast",ln.contrast),backdropHueRotate:je.degreeT("--chakra-backdrop-hue-rotate"),backdropInvert:je.propT("--chakra-backdrop-invert",ln.invert),backdropSaturate:je.propT("--chakra-backdrop-saturate",ln.saturate)},QS={alignItems:!0,alignContent:!0,justifyItems:!0,justifyContent:!0,flexWrap:!0,flexDirection:{transform:ln.flexDirection},experimental_spaceX:{static:Ane,transform:l1({scale:"space",transform:e=>e!==null?{"--chakra-space-x":e}:null})},experimental_spaceY:{static:Tne,transform:l1({scale:"space",transform:e=>e!=null?{"--chakra-space-y":e}:null})},flex:!0,flexFlow:!0,flexGrow:!0,flexShrink:!0,flexBasis:je.sizes("flexBasis"),justifySelf:!0,alignSelf:!0,order:!0,placeItems:!0,placeContent:!0,placeSelf:!0,gap:je.space("gap"),rowGap:je.space("rowGap"),columnGap:je.space("columnGap")};Object.assign(QS,{flexDir:QS.flexDirection});var AH={gridGap:je.space("gridGap"),gridColumnGap:je.space("gridColumnGap"),gridRowGap:je.space("gridRowGap"),gridColumn:!0,gridRow:!0,gridAutoFlow:!0,gridAutoColumns:!0,gridColumnStart:!0,gridColumnEnd:!0,gridRowStart:!0,gridRowEnd:!0,gridAutoRows:!0,gridTemplate:!0,gridTemplateColumns:!0,gridTemplateRows:!0,gridTemplateAreas:!0,gridArea:!0},Bne={appearance:!0,cursor:!0,resize:!0,userSelect:!0,pointerEvents:!0,outline:{transform:ln.outline},outlineOffset:!0,outlineColor:je.colors("outlineColor")},Ws={width:je.sizesT("width"),inlineSize:je.sizesT("inlineSize"),height:je.sizes("height"),blockSize:je.sizes("blockSize"),boxSize:je.sizes(["width","height"]),minWidth:je.sizes("minWidth"),minInlineSize:je.sizes("minInlineSize"),minHeight:je.sizes("minHeight"),minBlockSize:je.sizes("minBlockSize"),maxWidth:je.sizes("maxWidth"),maxInlineSize:je.sizes("maxInlineSize"),maxHeight:je.sizes("maxHeight"),maxBlockSize:je.sizes("maxBlockSize"),overflow:!0,overflowX:!0,overflowY:!0,overscrollBehavior:!0,overscrollBehaviorX:!0,overscrollBehaviorY:!0,display:!0,verticalAlign:!0,boxSizing:!0,boxDecorationBreak:!0,float:je.propT("float",ln.float),objectFit:!0,objectPosition:!0,visibility:!0,isolation:!0};Object.assign(Ws,{w:Ws.width,h:Ws.height,minW:Ws.minWidth,maxW:Ws.maxWidth,minH:Ws.minHeight,maxH:Ws.maxHeight,overscroll:Ws.overscrollBehavior,overscrollX:Ws.overscrollBehaviorX,overscrollY:Ws.overscrollBehaviorY});var Fne={listStyleType:!0,listStylePosition:!0,listStylePos:je.prop("listStylePosition"),listStyleImage:!0,listStyleImg:je.prop("listStyleImage")};function Lne(e,t,r,n){const a=typeof t=="string"?t.split("."):[t];for(n=0;n<a.length&&e;n+=1)e=e[a[n]];return e===void 0?r:e}var Nne=e=>{const t=new WeakMap;return(n,a,i,o)=>{if(typeof n>"u")return e(n,a,i);t.has(n)||t.set(n,new Map);const s=t.get(n);if(s.has(a))return s.get(a);const u=e(n,a,i,o);return s.set(a,u),u}},zne=Nne(Lne),Une={border:"0px",clip:"rect(0, 0, 0, 0)",width:"1px",height:"1px",margin:"-1px",padding:"0px",overflow:"hidden",whiteSpace:"nowrap",position:"absolute"},Vne={position:"static",width:"auto",height:"auto",clip:"auto",padding:"0",margin:"0",overflow:"visible",whiteSpace:"normal"},k4=(e,t,r)=>{const n={},a=zne(e,t,{});for(const i in a)i in r&&r[i]!=null||(n[i]=a[i]);return n},Hne={srOnly:{transform(e){return e===!0?Une:e==="focusable"?Vne:{}}},layerStyle:{processResult:!0,transform:(e,t,r)=>k4(t,`layerStyles.${e}`,r)},textStyle:{processResult:!0,transform:(e,t,r)=>k4(t,`textStyles.${e}`,r)},apply:{processResult:!0,transform:(e,t,r)=>k4(t,e,r)}},by={position:!0,pos:je.prop("position"),zIndex:je.prop("zIndex","zIndices"),inset:je.spaceT("inset"),insetX:je.spaceT(["left","right"]),insetInline:je.spaceT("insetInline"),insetY:je.spaceT(["top","bottom"]),insetBlock:je.spaceT("insetBlock"),top:je.spaceT("top"),insetBlockStart:je.spaceT("insetBlockStart"),bottom:je.spaceT("bottom"),insetBlockEnd:je.spaceT("insetBlockEnd"),left:je.spaceT("left"),insetInlineStart:je.logical({scale:"space",property:{ltr:"left",rtl:"right"}}),right:je.spaceT("right"),insetInlineEnd:je.logical({scale:"space",property:{ltr:"right",rtl:"left"}})};Object.assign(by,{insetStart:by.insetInlineStart,insetEnd:by.insetInlineEnd});var jne={ring:{transform:ln.ring},ringColor:je.colors("--chakra-ring-color"),ringOffset:je.prop("--chakra-ring-offset-width"),ringOffsetColor:je.colors("--chakra-ring-offset-color"),ringInset:je.prop("--chakra-ring-inset")},na={margin:je.spaceT("margin"),marginTop:je.spaceT("marginTop"),marginBlockStart:je.spaceT("marginBlockStart"),marginRight:je.spaceT("marginRight"),marginInlineEnd:je.spaceT("marginInlineEnd"),marginBottom:je.spaceT("marginBottom"),marginBlockEnd:je.spaceT("marginBlockEnd"),marginLeft:je.spaceT("marginLeft"),marginInlineStart:je.spaceT("marginInlineStart"),marginX:je.spaceT(["marginInlineStart","marginInlineEnd"]),marginInline:je.spaceT("marginInline"),marginY:je.spaceT(["marginTop","marginBottom"]),marginBlock:je.spaceT("marginBlock"),padding:je.space("padding"),paddingTop:je.space("paddingTop"),paddingBlockStart:je.space("paddingBlockStart"),paddingRight:je.space("paddingRight"),paddingBottom:je.space("paddingBottom"),paddingBlockEnd:je.space("paddingBlockEnd"),paddingLeft:je.space("paddingLeft"),paddingInlineStart:je.space("paddingInlineStart"),paddingInlineEnd:je.space("paddingInlineEnd"),paddingX:je.space(["paddingInlineStart","paddingInlineEnd"]),paddingInline:je.space("paddingInline"),paddingY:je.space(["paddingTop","paddingBottom"]),paddingBlock:je.space("paddingBlock")};Object.assign(na,{m:na.margin,mt:na.marginTop,mr:na.marginRight,me:na.marginInlineEnd,marginEnd:na.marginInlineEnd,mb:na.marginBottom,ml:na.marginLeft,ms:na.marginInlineStart,marginStart:na.marginInlineStart,mx:na.marginX,my:na.marginY,p:na.padding,pt:na.paddingTop,py:na.paddingY,px:na.paddingX,pb:na.paddingBottom,pl:na.paddingLeft,ps:na.paddingInlineStart,paddingStart:na.paddingInlineStart,pr:na.paddingRight,pe:na.paddingInlineEnd,paddingEnd:na.paddingInlineEnd});var Gne={textDecorationColor:je.colors("textDecorationColor"),textDecoration:!0,textDecor:{property:"textDecoration"},textDecorationLine:!0,textDecorationStyle:!0,textDecorationThickness:!0,textUnderlineOffset:!0,textShadow:je.shadows("textShadow")},qne={clipPath:!0,transform:je.propT("transform",ln.transform),transformOrigin:!0,translateX:je.spaceT("--chakra-translate-x"),translateY:je.spaceT("--chakra-translate-y"),skewX:je.degreeT("--chakra-skew-x"),skewY:je.degreeT("--chakra-skew-y"),scaleX:je.prop("--chakra-scale-x"),scaleY:je.prop("--chakra-scale-y"),scale:je.prop(["--chakra-scale-x","--chakra-scale-y"]),rotate:je.degreeT("--chakra-rotate")},Wne={transition:!0,transitionDelay:!0,animation:!0,willChange:!0,transitionDuration:je.prop("transitionDuration","transition.duration"),transitionProperty:je.prop("transitionProperty","transition.property"),transitionTimingFunction:je.prop("transitionTimingFunction","transition.easing")},Xne={fontFamily:je.prop("fontFamily","fonts"),fontSize:je.prop("fontSize","fontSizes",ln.px),fontWeight:je.prop("fontWeight","fontWeights"),lineHeight:je.prop("lineHeight","lineHeights"),letterSpacing:je.prop("letterSpacing","letterSpacings"),textAlign:!0,fontStyle:!0,wordBreak:!0,overflowWrap:!0,textOverflow:!0,textTransform:!0,whiteSpace:!0,noOfLines:{static:{overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:"var(--chakra-line-clamp)"},property:"--chakra-line-clamp"}},Yne={scrollBehavior:!0,scrollSnapAlign:!0,scrollSnapStop:!0,scrollSnapType:!0,scrollMargin:je.spaceT("scrollMargin"),scrollMarginTop:je.spaceT("scrollMarginTop"),scrollMarginBottom:je.spaceT("scrollMarginBottom"),scrollMarginLeft:je.spaceT("scrollMarginLeft"),scrollMarginRight:je.spaceT("scrollMarginRight"),scrollMarginX:je.spaceT(["scrollMarginLeft","scrollMarginRight"]),scrollMarginY:je.spaceT(["scrollMarginTop","scrollMarginBottom"]),scrollPadding:je.spaceT("scrollPadding"),scrollPaddingTop:je.spaceT("scrollPaddingTop"),scrollPaddingBottom:je.spaceT("scrollPaddingBottom"),scrollPaddingLeft:je.spaceT("scrollPaddingLeft"),scrollPaddingRight:je.spaceT("scrollPaddingRight"),scrollPaddingX:je.spaceT(["scrollPaddingLeft","scrollPaddingRight"]),scrollPaddingY:je.spaceT(["scrollPaddingTop","scrollPaddingBottom"])};function TH(e){return $l(e)&&e.reference?e.reference:String(e)}var Z3=(e,...t)=>t.map(TH).join(` ${e} `).replace(/calc/g,""),V8=(...e)=>`calc(${Z3("+",...e)})`,H8=(...e)=>`calc(${Z3("-",...e)})`,aP=(...e)=>`calc(${Z3("*",...e)})`,j8=(...e)=>`calc(${Z3("/",...e)})`,G8=e=>{const t=TH(e);return t!=null&&!Number.isNaN(parseFloat(t))?String(t).startsWith("-")?String(t).slice(1):`-${t}`:aP(t,-1)},vh=Object.assign(e=>({add:(...t)=>vh(V8(e,...t)),subtract:(...t)=>vh(H8(e,...t)),multiply:(...t)=>vh(aP(e,...t)),divide:(...t)=>vh(j8(e,...t)),negate:()=>vh(G8(e)),toString:()=>e.toString()}),{add:V8,subtract:H8,multiply:aP,divide:j8,negate:G8});function Kne(e,t="-"){return e.replace(/\s+/g,t)}function $ne(e){const t=Kne(e.toString());return Zne(Qne(t))}function Qne(e){return e.includes("\\.")?e:!Number.isInteger(parseFloat(e.toString()))?e.replace(".","\\."):e}function Zne(e){return e.replace(/[!-,/:-@[-^`{-~]/g,"\\$&")}function Jne(e,t=""){return[t,e].filter(Boolean).join("-")}function eae(e,t){return`var(${e}${t?`, ${t}`:""})`}function tae(e,t=""){return $ne(`--${Jne(e,t)}`)}function Ip(e,t,r){const n=tae(e,r);return{variable:n,reference:eae(n,t)}}function rae(e){const t=typeof e;return e!=null&&(t==="object"||t==="function")&&!Array.isArray(e)}Object.freeze(["base","sm","md","lg","xl","2xl"]);function nae(e){const t=e==null?0:e.length;return t?e[t-1]:void 0}function aae(e){const t=parseFloat(e.toString()),r=e.toString().replace(String(t),"");return{unitless:!r,value:t,unit:r}}function iP(e){if(e==null)return e;const{unitless:t}=aae(e);return t||typeof e=="number"?`${e}px`:e}var EH=(e,t)=>parseInt(e[1],10)>parseInt(t[1],10)?1:-1,YM=e=>Object.fromEntries(Object.entries(e).sort(EH));function q8(e){const t=YM(e);return Object.assign(Object.values(t),t)}function iae(e){const t=Object.keys(YM(e));return new Set(t)}function W8(e){if(!e)return e;e=iP(e)??e;const t=e.endsWith("px")?-1:-.0625;return typeof e=="number"?`${e+t}`:e.replace(/(\d+\.?\d*)/u,r=>`${parseFloat(r)+t}`)}function $g(e,t){const r=["@media screen"];return e&&r.push("and",`(min-width: ${iP(e)})`),t&&r.push("and",`(max-width: ${iP(t)})`),r.join(" ")}function oae(e){if(!e)return null;e.base=e.base??"0px";const t=q8(e),r=Object.entries(e).sort(EH).map(([i,o],s,u)=>{let[,l]=u[s+1]??[];return l=parseFloat(l)>0?W8(l):void 0,{_minW:W8(o),breakpoint:i,minW:o,maxW:l,maxWQuery:$g(null,l),minWQuery:$g(o),minMaxQuery:$g(o,l)}}),n=iae(e),a=Array.from(n.values());return{keys:n,normalized:t,isResponsive(i){const o=Object.keys(i);return o.length>0&&o.every(s=>n.has(s))},asObject:YM(e),asArray:q8(e),details:r,media:[null,...t.map(i=>$g(i)).slice(1)],toArrayValue(i){if(!rae(i))throw new Error("toArrayValue: value must be an object");const o=a.map(s=>i[s]??null);for(;nae(o)===null;)o.pop();return o},toObjectValue(i){if(!Array.isArray(i))throw new Error("toObjectValue: value must be an array");return i.reduce((o,s,u)=>{const l=a[u];return l!=null&&s!=null&&(o[l]=s),o},{})}}}var Ti={hover:(e,t)=>`${e}:hover ${t}, ${e}[data-hover] ${t}`,focus:(e,t)=>`${e}:focus ${t}, ${e}[data-focus] ${t}`,focusVisible:(e,t)=>`${e}:focus-visible ${t}`,focusWithin:(e,t)=>`${e}:focus-within ${t}`,active:(e,t)=>`${e}:active ${t}, ${e}[data-active] ${t}`,disabled:(e,t)=>`${e}:disabled ${t}, ${e}[data-disabled] ${t}`,invalid:(e,t)=>`${e}:invalid ${t}, ${e}[data-invalid] ${t}`,checked:(e,t)=>`${e}:checked ${t}, ${e}[data-checked] ${t}`,indeterminate:(e,t)=>`${e}:indeterminate ${t}, ${e}[aria-checked=mixed] ${t}, ${e}[data-indeterminate] ${t}`,readOnly:(e,t)=>`${e}:read-only ${t}, ${e}[readonly] ${t}, ${e}[data-read-only] ${t}`,expanded:(e,t)=>`${e}:read-only ${t}, ${e}[aria-expanded=true] ${t}, ${e}[data-expanded] ${t}`,placeholderShown:(e,t)=>`${e}:placeholder-shown ${t}`},Zd=e=>PH(t=>e(t,"&"),"[role=group]","[data-group]",".group"),bc=e=>PH(t=>e(t,"~ &"),"[data-peer]",".peer"),PH=(e,...t)=>t.map(e).join(", "),J3={_hover:"&:hover, &[data-hover]",_active:"&:active, &[data-active]",_focus:"&:focus, &[data-focus]",_highlighted:"&[data-highlighted]",_focusWithin:"&:focus-within",_focusVisible:"&:focus-visible, &[data-focus-visible]",_disabled:"&:disabled, &[aria-disabled=true], &[data-disabled]",_readOnly:"&[aria-readonly=true], &[readonly], &[data-readonly]",_before:"&::before",_after:"&::after",_empty:"&:empty",_expanded:"&[aria-expanded=true], &[data-expanded]",_checked:"&[aria-checked=true], &[data-checked]",_grabbed:"&[aria-grabbed=true], &[data-grabbed]",_pressed:"&[aria-pressed=true], &[data-pressed]",_invalid:"&[aria-invalid=true], &[data-invalid]",_valid:"&[data-valid], &[data-state=valid]",_loading:"&[data-loading], &[aria-busy=true]",_selected:"&[aria-selected=true], &[data-selected]",_hidden:"&[hidden], &[data-hidden]",_autofill:"&:-webkit-autofill",_even:"&:nth-of-type(even)",_odd:"&:nth-of-type(odd)",_first:"&:first-of-type",_last:"&:last-of-type",_notFirst:"&:not(:first-of-type)",_notLast:"&:not(:last-of-type)",_visited:"&:visited",_activeLink:"&[aria-current=page]",_activeStep:"&[aria-current=step]",_indeterminate:"&:indeterminate, &[aria-checked=mixed], &[data-indeterminate]",_groupHover:Zd(Ti.hover),_peerHover:bc(Ti.hover),_groupFocus:Zd(Ti.focus),_peerFocus:bc(Ti.focus),_groupFocusVisible:Zd(Ti.focusVisible),_peerFocusVisible:bc(Ti.focusVisible),_groupActive:Zd(Ti.active),_peerActive:bc(Ti.active),_groupDisabled:Zd(Ti.disabled),_peerDisabled:bc(Ti.disabled),_groupInvalid:Zd(Ti.invalid),_peerInvalid:bc(Ti.invalid),_groupChecked:Zd(Ti.checked),_peerChecked:bc(Ti.checked),_groupFocusWithin:Zd(Ti.focusWithin),_peerFocusWithin:bc(Ti.focusWithin),_peerPlaceholderShown:bc(Ti.placeholderShown),_placeholder:"&::placeholder",_placeholderShown:"&:placeholder-shown",_fullScreen:"&:fullscreen",_selection:"&::selection",_rtl:"[dir=rtl] &, &[dir=rtl]",_ltr:"[dir=ltr] &, &[dir=ltr]",_mediaDark:"@media (prefers-color-scheme: dark)",_mediaReduceMotion:"@media (prefers-reduced-motion: reduce)",_dark:".chakra-ui-dark &:not([data-theme]),[data-theme=dark] &:not([data-theme]),&[data-theme=dark]",_light:".chakra-ui-light &:not([data-theme]),[data-theme=light] &:not([data-theme]),&[data-theme=light]"},sae=Object.keys(J3);function X8(e,t){return Ip(String(e).replace(/\./g,"-"),void 0,t)}function uae(e,t){let r={};const n={};for(const[a,i]of Object.entries(e)){const{isSemantic:o,value:s}=i,{variable:u,reference:l}=X8(a,t?.cssVarPrefix);if(!o){if(a.startsWith("space")){const f=a.split("."),[p,...h]=f,m=`${p}.-${h.join(".")}`,v=vh.negate(s),g=vh.negate(l);n[m]={value:v,var:u,varRef:g}}r[u]=s,n[a]={value:s,var:u,varRef:l};continue}const c=f=>{const h=[String(a).split(".")[0],f].join(".");if(!e[h])return f;const{reference:v}=X8(h,t?.cssVarPrefix);return v},d=$l(s)?s:{default:s};r=Hl(r,Object.entries(d).reduce((f,[p,h])=>{var m;const v=c(h);if(p==="default")return f[u]=v,f;const g=((m=J3)==null?void 0:m[p])??p;return f[g]={[u]:v},f},{})),n[a]={value:l,var:u,varRef:l}}return{cssVars:r,cssMap:n}}function lae(e,t=[]){const r=Object.assign({},e);for(const n of t)n in r&&delete r[n];return r}function cae(e,t){const r={};for(const n of t)n in e&&(r[n]=e[n]);return r}var dae=["colors","borders","borderWidths","borderStyles","fonts","fontSizes","fontWeights","letterSpacings","lineHeights","radii","space","shadows","sizes","zIndices","transition","blur"];function fae(e){return cae(e,dae)}function pae(e){return e.semanticTokens}function hae(e){const{__cssMap:t,__cssVars:r,__breakpoints:n,...a}=e;return a}function mae({tokens:e,semanticTokens:t}){const r=Object.entries(oP(e)??{}).map(([a,i])=>[a,{isSemantic:!1,value:i}]),n=Object.entries(oP(t,1)??{}).map(([a,i])=>[a,{isSemantic:!0,value:i}]);return Object.fromEntries([...r,...n])}function oP(e,t=1/0){return!$l(e)&&!Array.isArray(e)||!t?e:Object.entries(e).reduce((r,[n,a])=>($l(a)||Array.isArray(a)?Object.entries(oP(a,t-1)).forEach(([i,o])=>{r[`${n}.${i}`]=o}):r[n]=a,r),{})}function vae(e){var t;const r=hae(e),n=fae(r),a=pae(r),i=mae({tokens:n,semanticTokens:a}),o=(t=r.config)==null?void 0:t.cssVarPrefix,{cssMap:s,cssVars:u}=uae(i,{cssVarPrefix:o});return Object.assign(r,{__cssVars:{...{"--chakra-ring-inset":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-ring-offset-width":"0px","--chakra-ring-offset-color":"#fff","--chakra-ring-color":"rgba(66, 153, 225, 0.6)","--chakra-ring-offset-shadow":"0 0 #0000","--chakra-ring-shadow":"0 0 #0000","--chakra-space-x-reverse":"0","--chakra-space-y-reverse":"0"},...u},__cssMap:s,__breakpoints:oae(r.breakpoints)}),r}var KM=Hl({},Yx,gn,Rne,QS,Ws,One,jne,Bne,AH,Hne,by,nP,na,Yne,Xne,Gne,qne,Fne,Wne);Object.assign({},na,Ws,QS,AH,by);var gae=[...Object.keys(KM),...sae],yae={...KM,...J3},bae=e=>e in yae,xae=e=>t=>{if(!t.__breakpoints)return e;const{isResponsive:r,toArrayValue:n,media:a}=t.__breakpoints,i={};for(const o in e){let s=Th(e[o],t);if(s==null)continue;if(s=$l(s)&&r(s)?n(s):s,!Array.isArray(s)){i[o]=s;continue}const u=s.slice(0,a.length).length;for(let l=0;l<u;l+=1){const c=a?.[l];if(!c){i[o]=s[l];continue}i[c]=i[c]||{},s[l]!=null&&(i[c][o]=s[l])}}return i};function Sae(e){const t=[];let r="",n=!1;for(let a=0;a<e.length;a++){const i=e[a];i==="("?(n=!0,r+=i):i===")"?(n=!1,r+=i):i===","&&!n?(t.push(r),r=""):r+=i}return r=r.trim(),r&&t.push(r),t}function Cae(e){return/^var\(--.+\)$/.test(e)}var wae=(e,t)=>e.startsWith("--")&&typeof t=="string"&&!Cae(t),_ae=(e,t)=>{if(t==null)return t;const r=o=>{var s,u;return(u=(s=e.__cssMap)==null?void 0:s[o])==null?void 0:u.varRef},n=o=>r(o)??o,[a,i]=Sae(t);return t=r(a)??n(i)??n(t),t};function Aae(e){const{configs:t={},pseudos:r={},theme:n}=e,a=(i,o=!1)=>{var s;const u=Th(i,n),l=xae(u)(n);let c={};for(let d in l){const f=l[d];let p=Th(f,n);d in r&&(d=r[d]),wae(d,p)&&(p=_ae(n,p));let h=t[d];if(h===!0&&(h={property:d}),$l(p)){c[d]=c[d]??{},c[d]=Hl({},c[d],a(p,!0));continue}let m=((s=h?.transform)==null?void 0:s.call(h,p,n,u))??p;m=h?.processResult?a(m,!0):m;const v=Th(h?.property,n);if(!o&&h?.static){const g=Th(h.static,n);c=Hl({},c,g)}if(v&&Array.isArray(v)){for(const g of v)c[g]=m;continue}if(v){v==="&"&&$l(m)?c=Hl({},c,m):c[v]=m;continue}if($l(m)){c=Hl({},c,m);continue}c[d]=m}return c};return a}var IH=e=>t=>Aae({theme:t,pseudos:J3,configs:KM})(e);function ga(e){return{definePartsStyle(t){return t},defineMultiStyleConfig(t){return{parts:e,...t}}}}function Tae(e,t){if(Array.isArray(e))return e;if($l(e))return t(e);if(e!=null)return[e]}function Eae(e,t){for(let r=t+1;r<e.length;r++)if(e[r]!=null)return r;return-1}function Pae(e){const t=e.__breakpoints;return function(n,a,i,o){var s,u;if(!t)return;const l={},c=Tae(i,t.toArrayValue);if(!c)return l;const d=c.length,f=d===1,p=!!n.parts;for(let h=0;h<d;h++){const m=t.details[h],v=t.details[Eae(c,h)],g=$g(m.minW,v?._minW),y=Th((s=n[a])==null?void 0:s[c[h]],o);if(!!y){if(p){(u=n.parts)==null||u.forEach(b=>{Hl(l,{[b]:f?y[b]:{[g]:y[b]}})});continue}if(!p){f?Hl(l,y):l[g]=y;continue}l[g]=y}}return l}}function Iae(e){return t=>{const{variant:r,size:n,theme:a}=t,i=Pae(a);return Hl({},Th(e.baseStyle??{},t),i(e,"sizes",n,t),i(e,"variants",r,t))}}function $M(e){return lae(e,["styleConfig","size","variant","colorScheme"])}function Mae(e){if(e.sheet)return e.sheet;for(var t=0;t<document.styleSheets.length;t++)if(document.styleSheets[t].ownerNode===e)return document.styleSheets[t]}function Dae(e){var t=document.createElement("style");return t.setAttribute("data-emotion",e.key),e.nonce!==void 0&&t.setAttribute("nonce",e.nonce),t.appendChild(document.createTextNode("")),t.setAttribute("data-s",""),t}var kae=function(){function e(r){var n=this;this._insertTag=function(a){var i;n.tags.length===0?n.insertionPoint?i=n.insertionPoint.nextSibling:n.prepend?i=n.container.firstChild:i=n.before:i=n.tags[n.tags.length-1].nextSibling,n.container.insertBefore(a,i),n.tags.push(a)},this.isSpeedy=r.speedy===void 0?!0:r.speedy,this.tags=[],this.ctr=0,this.nonce=r.nonce,this.key=r.key,this.container=r.container,this.prepend=r.prepend,this.insertionPoint=r.insertionPoint,this.before=null}var t=e.prototype;return t.hydrate=function(n){n.forEach(this._insertTag)},t.insert=function(n){this.ctr%(this.isSpeedy?65e3:1)===0&&this._insertTag(Dae(this));var a=this.tags[this.tags.length-1];if(this.isSpeedy){var i=Mae(a);try{i.insertRule(n,i.cssRules.length)}catch{}}else a.appendChild(document.createTextNode(n));this.ctr++},t.flush=function(){this.tags.forEach(function(n){return n.parentNode&&n.parentNode.removeChild(n)}),this.tags=[],this.ctr=0},e}(),ji="-ms-",ZS="-moz-",yn="-webkit-",MH="comm",QM="rule",ZM="decl",Rae="@import",DH="@keyframes",Oae=Math.abs,ew=String.fromCharCode,Bae=Object.assign;function Fae(e,t){return(((t<<2^Oo(e,0))<<2^Oo(e,1))<<2^Oo(e,2))<<2^Oo(e,3)}function kH(e){return e.trim()}function Lae(e,t){return(e=t.exec(e))?e[0]:e}function _n(e,t,r){return e.replace(t,r)}function sP(e,t){return e.indexOf(t)}function Oo(e,t){return e.charCodeAt(t)|0}function c1(e,t,r){return e.slice(t,r)}function Rl(e){return e.length}function JM(e){return e.length}function S2(e,t){return t.push(e),e}function Nae(e,t){return e.map(t).join("")}var tw=1,c0=1,RH=0,Ho=0,Xa=0,I0="";function rw(e,t,r,n,a,i,o){return{value:e,root:t,parent:r,type:n,props:a,children:i,line:tw,column:c0,length:o,return:""}}function bg(e,t){return Bae(rw("",null,null,"",null,null,0),e,{length:-e.length},t)}function zae(){return Xa}function Uae(){return Xa=Ho>0?Oo(I0,--Ho):0,c0--,Xa===10&&(c0=1,tw--),Xa}function ms(){return Xa=Ho<RH?Oo(I0,Ho++):0,c0++,Xa===10&&(c0=1,tw++),Xa}function Ql(){return Oo(I0,Ho)}function Kx(){return Ho}function eb(e,t){return c1(I0,e,t)}function d1(e){switch(e){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function OH(e){return tw=c0=1,RH=Rl(I0=e),Ho=0,[]}function BH(e){return I0="",e}function $x(e){return kH(eb(Ho-1,uP(e===91?e+2:e===40?e+1:e)))}function Vae(e){for(;(Xa=Ql())&&Xa<33;)ms();return d1(e)>2||d1(Xa)>3?"":" "}function Hae(e,t){for(;--t&&ms()&&!(Xa<48||Xa>102||Xa>57&&Xa<65||Xa>70&&Xa<97););return eb(e,Kx()+(t<6&&Ql()==32&&ms()==32))}function uP(e){for(;ms();)switch(Xa){case e:return Ho;case 34:case 39:e!==34&&e!==39&&uP(Xa);break;case 40:e===41&&uP(e);break;case 92:ms();break}return Ho}function jae(e,t){for(;ms()&&e+Xa!==47+10;)if(e+Xa===42+42&&Ql()===47)break;return"/*"+eb(t,Ho-1)+"*"+ew(e===47?e:ms())}function Gae(e){for(;!d1(Ql());)ms();return eb(e,Ho)}function qae(e){return BH(Qx("",null,null,null,[""],e=OH(e),0,[0],e))}function Qx(e,t,r,n,a,i,o,s,u){for(var l=0,c=0,d=o,f=0,p=0,h=0,m=1,v=1,g=1,y=0,b="",S=a,x=i,C=n,w=b;v;)switch(h=y,y=ms()){case 40:if(h!=108&&w.charCodeAt(d-1)==58){sP(w+=_n($x(y),"&","&\f"),"&\f")!=-1&&(g=-1);break}case 34:case 39:case 91:w+=$x(y);break;case 9:case 10:case 13:case 32:w+=Vae(h);break;case 92:w+=Hae(Kx()-1,7);continue;case 47:switch(Ql()){case 42:case 47:S2(Wae(jae(ms(),Kx()),t,r),u);break;default:w+="/"}break;case 123*m:s[l++]=Rl(w)*g;case 125*m:case 59:case 0:switch(y){case 0:case 125:v=0;case 59+c:p>0&&Rl(w)-d&&S2(p>32?K8(w+";",n,r,d-1):K8(_n(w," ","")+";",n,r,d-2),u);break;case 59:w+=";";default:if(S2(C=Y8(w,t,r,l,c,a,s,b,S=[],x=[],d),i),y===123)if(c===0)Qx(w,t,C,C,S,i,d,s,x);else switch(f){case 100:case 109:case 115:Qx(e,C,C,n&&S2(Y8(e,C,C,0,0,a,s,b,a,S=[],d),x),a,x,d,s,n?S:x);break;default:Qx(w,C,C,C,[""],x,0,s,x)}}l=c=p=0,m=g=1,b=w="",d=o;break;case 58:d=1+Rl(w),p=h;default:if(m<1){if(y==123)--m;else if(y==125&&m++==0&&Uae()==125)continue}switch(w+=ew(y),y*m){case 38:g=c>0?1:(w+="\f",-1);break;case 44:s[l++]=(Rl(w)-1)*g,g=1;break;case 64:Ql()===45&&(w+=$x(ms())),f=Ql(),c=d=Rl(b=w+=Gae(Kx())),y++;break;case 45:h===45&&Rl(w)==2&&(m=0)}}return i}function Y8(e,t,r,n,a,i,o,s,u,l,c){for(var d=a-1,f=a===0?i:[""],p=JM(f),h=0,m=0,v=0;h<n;++h)for(var g=0,y=c1(e,d+1,d=Oae(m=o[h])),b=e;g<p;++g)(b=kH(m>0?f[g]+" "+y:_n(y,/&\f/g,f[g])))&&(u[v++]=b);return rw(e,t,r,a===0?QM:s,u,l,c)}function Wae(e,t,r){return rw(e,t,r,MH,ew(zae()),c1(e,2,-2),0)}function K8(e,t,r,n){return rw(e,t,r,ZM,c1(e,0,n),c1(e,n+1,-1),n)}function FH(e,t){switch(Fae(e,t)){case 5103:return yn+"print-"+e+e;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return yn+e+e;case 5349:case 4246:case 4810:case 6968:case 2756:return yn+e+ZS+e+ji+e+e;case 6828:case 4268:return yn+e+ji+e+e;case 6165:return yn+e+ji+"flex-"+e+e;case 5187:return yn+e+_n(e,/(\w+).+(:[^]+)/,yn+"box-$1$2"+ji+"flex-$1$2")+e;case 5443:return yn+e+ji+"flex-item-"+_n(e,/flex-|-self/,"")+e;case 4675:return yn+e+ji+"flex-line-pack"+_n(e,/align-content|flex-|-self/,"")+e;case 5548:return yn+e+ji+_n(e,"shrink","negative")+e;case 5292:return yn+e+ji+_n(e,"basis","preferred-size")+e;case 6060:return yn+"box-"+_n(e,"-grow","")+yn+e+ji+_n(e,"grow","positive")+e;case 4554:return yn+_n(e,/([^-])(transform)/g,"$1"+yn+"$2")+e;case 6187:return _n(_n(_n(e,/(zoom-|grab)/,yn+"$1"),/(image-set)/,yn+"$1"),e,"")+e;case 5495:case 3959:return _n(e,/(image-set\([^]*)/,yn+"$1$`$1");case 4968:return _n(_n(e,/(.+:)(flex-)?(.*)/,yn+"box-pack:$3"+ji+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+yn+e+e;case 4095:case 3583:case 4068:case 2532:return _n(e,/(.+)-inline(.+)/,yn+"$1$2")+e;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(Rl(e)-1-t>6)switch(Oo(e,t+1)){case 109:if(Oo(e,t+4)!==45)break;case 102:return _n(e,/(.+:)(.+)-([^]+)/,"$1"+yn+"$2-$3$1"+ZS+(Oo(e,t+3)==108?"$3":"$2-$3"))+e;case 115:return~sP(e,"stretch")?FH(_n(e,"stretch","fill-available"),t)+e:e}break;case 4949:if(Oo(e,t+1)!==115)break;case 6444:switch(Oo(e,Rl(e)-3-(~sP(e,"!important")&&10))){case 107:return _n(e,":",":"+yn)+e;case 101:return _n(e,/(.+:)([^;!]+)(;|!.+)?/,"$1"+yn+(Oo(e,14)===45?"inline-":"")+"box$3$1"+yn+"$2$3$1"+ji+"$2box$3")+e}break;case 5936:switch(Oo(e,t+11)){case 114:return yn+e+ji+_n(e,/[svh]\w+-[tblr]{2}/,"tb")+e;case 108:return yn+e+ji+_n(e,/[svh]\w+-[tblr]{2}/,"tb-rl")+e;case 45:return yn+e+ji+_n(e,/[svh]\w+-[tblr]{2}/,"lr")+e}return yn+e+ji+e+e}return e}function jv(e,t){for(var r="",n=JM(e),a=0;a<n;a++)r+=t(e[a],a,e,t)||"";return r}function Xae(e,t,r,n){switch(e.type){case Rae:case ZM:return e.return=e.return||e.value;case MH:return"";case DH:return e.return=e.value+"{"+jv(e.children,n)+"}";case QM:e.value=e.props.join(",")}return Rl(r=jv(e.children,n))?e.return=e.value+"{"+r+"}":""}function Yae(e){var t=JM(e);return function(r,n,a,i){for(var o="",s=0;s<t;s++)o+=e[s](r,n,a,i)||"";return o}}function Kae(e){return function(t){t.root||(t=t.return)&&e(t)}}function $ae(e,t,r,n){if(e.length>-1&&!e.return)switch(e.type){case ZM:e.return=FH(e.value,e.length);break;case DH:return jv([bg(e,{value:_n(e.value,"@","@"+yn)})],n);case QM:if(e.length)return Nae(e.props,function(a){switch(Lae(a,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return jv([bg(e,{props:[_n(a,/:(read-\w+)/,":"+ZS+"$1")]})],n);case"::placeholder":return jv([bg(e,{props:[_n(a,/:(plac\w+)/,":"+yn+"input-$1")]}),bg(e,{props:[_n(a,/:(plac\w+)/,":"+ZS+"$1")]}),bg(e,{props:[_n(a,/:(plac\w+)/,ji+"input-$1")]})],n)}return""})}}var $8=function(t){var r=new WeakMap;return function(n){if(r.has(n))return r.get(n);var a=t(n);return r.set(n,a),a}};function LH(e){var t=Object.create(null);return function(r){return t[r]===void 0&&(t[r]=e(r)),t[r]}}var Qae=function(t,r,n){for(var a=0,i=0;a=i,i=Ql(),a===38&&i===12&&(r[n]=1),!d1(i);)ms();return eb(t,Ho)},Zae=function(t,r){var n=-1,a=44;do switch(d1(a)){case 0:a===38&&Ql()===12&&(r[n]=1),t[n]+=Qae(Ho-1,r,n);break;case 2:t[n]+=$x(a);break;case 4:if(a===44){t[++n]=Ql()===58?"&\f":"",r[n]=t[n].length;break}default:t[n]+=ew(a)}while(a=ms());return t},Jae=function(t,r){return BH(Zae(OH(t),r))},Q8=new WeakMap,eie=function(t){if(!(t.type!=="rule"||!t.parent||t.length<1)){for(var r=t.value,n=t.parent,a=t.column===n.column&&t.line===n.line;n.type!=="rule";)if(n=n.parent,!n)return;if(!(t.props.length===1&&r.charCodeAt(0)!==58&&!Q8.get(n))&&!a){Q8.set(t,!0);for(var i=[],o=Jae(r,i),s=n.props,u=0,l=0;u<o.length;u++)for(var c=0;c<s.length;c++,l++)t.props[l]=i[u]?o[u].replace(/&\f/g,s[c]):s[c]+" "+o[u]}}},tie=function(t){if(t.type==="decl"){var r=t.value;r.charCodeAt(0)===108&&r.charCodeAt(2)===98&&(t.return="",t.value="")}},rie=[$ae],nie=function(t){var r=t.key;if(r==="css"){var n=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(n,function(m){var v=m.getAttribute("data-emotion");v.indexOf(" ")!==-1&&(document.head.appendChild(m),m.setAttribute("data-s",""))})}var a=t.stylisPlugins||rie,i={},o,s=[];o=t.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+r+' "]'),function(m){for(var v=m.getAttribute("data-emotion").split(" "),g=1;g<v.length;g++)i[v[g]]=!0;s.push(m)});var u,l=[eie,tie];{var c,d=[Xae,Kae(function(m){c.insert(m)})],f=Yae(l.concat(a,d)),p=function(v){return jv(qae(v),f)};u=function(v,g,y,b){c=y,p(v?v+"{"+g.styles+"}":g.styles),b&&(h.inserted[g.name]=!0)}}var h={key:r,sheet:new kae({key:r,container:o,nonce:t.nonce,speedy:t.speedy,prepend:t.prepend,insertionPoint:t.insertionPoint}),nonce:t.nonce,inserted:i,registered:{},insert:u};return h.sheet.hydrate(s),h};function JS(){return JS=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},JS.apply(this,arguments)}var NH={exports:{}},Rn={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Si=typeof Symbol=="function"&&Symbol.for,eD=Si?Symbol.for("react.element"):60103,tD=Si?Symbol.for("react.portal"):60106,nw=Si?Symbol.for("react.fragment"):60107,aw=Si?Symbol.for("react.strict_mode"):60108,iw=Si?Symbol.for("react.profiler"):60114,ow=Si?Symbol.for("react.provider"):60109,sw=Si?Symbol.for("react.context"):60110,rD=Si?Symbol.for("react.async_mode"):60111,uw=Si?Symbol.for("react.concurrent_mode"):60111,lw=Si?Symbol.for("react.forward_ref"):60112,cw=Si?Symbol.for("react.suspense"):60113,aie=Si?Symbol.for("react.suspense_list"):60120,dw=Si?Symbol.for("react.memo"):60115,fw=Si?Symbol.for("react.lazy"):60116,iie=Si?Symbol.for("react.block"):60121,oie=Si?Symbol.for("react.fundamental"):60117,sie=Si?Symbol.for("react.responder"):60118,uie=Si?Symbol.for("react.scope"):60119;function Ps(e){if(typeof e=="object"&&e!==null){var t=e.$$typeof;switch(t){case eD:switch(e=e.type,e){case rD:case uw:case nw:case iw:case aw:case cw:return e;default:switch(e=e&&e.$$typeof,e){case sw:case lw:case fw:case dw:case ow:return e;default:return t}}case tD:return t}}}function zH(e){return Ps(e)===uw}Rn.AsyncMode=rD;Rn.ConcurrentMode=uw;Rn.ContextConsumer=sw;Rn.ContextProvider=ow;Rn.Element=eD;Rn.ForwardRef=lw;Rn.Fragment=nw;Rn.Lazy=fw;Rn.Memo=dw;Rn.Portal=tD;Rn.Profiler=iw;Rn.StrictMode=aw;Rn.Suspense=cw;Rn.isAsyncMode=function(e){return zH(e)||Ps(e)===rD};Rn.isConcurrentMode=zH;Rn.isContextConsumer=function(e){return Ps(e)===sw};Rn.isContextProvider=function(e){return Ps(e)===ow};Rn.isElement=function(e){return typeof e=="object"&&e!==null&&e.$$typeof===eD};Rn.isForwardRef=function(e){return Ps(e)===lw};Rn.isFragment=function(e){return Ps(e)===nw};Rn.isLazy=function(e){return Ps(e)===fw};Rn.isMemo=function(e){return Ps(e)===dw};Rn.isPortal=function(e){return Ps(e)===tD};Rn.isProfiler=function(e){return Ps(e)===iw};Rn.isStrictMode=function(e){return Ps(e)===aw};Rn.isSuspense=function(e){return Ps(e)===cw};Rn.isValidElementType=function(e){return typeof e=="string"||typeof e=="function"||e===nw||e===uw||e===iw||e===aw||e===cw||e===aie||typeof e=="object"&&e!==null&&(e.$$typeof===fw||e.$$typeof===dw||e.$$typeof===ow||e.$$typeof===sw||e.$$typeof===lw||e.$$typeof===oie||e.$$typeof===sie||e.$$typeof===uie||e.$$typeof===iie)};Rn.typeOf=Ps;(function(e){e.exports=Rn})(NH);var UH=NH.exports,lie={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},cie={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},VH={};VH[UH.ForwardRef]=lie;VH[UH.Memo]=cie;var die=!0;function fie(e,t,r){var n="";return r.split(" ").forEach(function(a){e[a]!==void 0?t.push(e[a]+";"):n+=a+" "}),n}var HH=function(t,r,n){var a=t.key+"-"+r.name;(n===!1||die===!1)&&t.registered[a]===void 0&&(t.registered[a]=r.styles)},jH=function(t,r,n){HH(t,r,n);var a=t.key+"-"+r.name;if(t.inserted[r.name]===void 0){var i=r;do t.insert(r===i?"."+a:"",i,t.sheet,!0),i=i.next;while(i!==void 0)}};function pie(e){for(var t=0,r,n=0,a=e.length;a>=4;++n,a-=4)r=e.charCodeAt(n)&255|(e.charCodeAt(++n)&255)<<8|(e.charCodeAt(++n)&255)<<16|(e.charCodeAt(++n)&255)<<24,r=(r&65535)*1540483477+((r>>>16)*59797<<16),r^=r>>>24,t=(r&65535)*1540483477+((r>>>16)*59797<<16)^(t&65535)*1540483477+((t>>>16)*59797<<16);switch(a){case 3:t^=(e.charCodeAt(n+2)&255)<<16;case 2:t^=(e.charCodeAt(n+1)&255)<<8;case 1:t^=e.charCodeAt(n)&255,t=(t&65535)*1540483477+((t>>>16)*59797<<16)}return t^=t>>>13,t=(t&65535)*1540483477+((t>>>16)*59797<<16),((t^t>>>15)>>>0).toString(36)}var hie={animationIterationCount:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},mie=/[A-Z]|^ms/g,vie=/_EMO_([^_]+?)_([^]*?)_EMO_/g,GH=function(t){return t.charCodeAt(1)===45},Z8=function(t){return t!=null&&typeof t!="boolean"},R4=LH(function(e){return GH(e)?e:e.replace(mie,"-$&").toLowerCase()}),J8=function(t,r){switch(t){case"animation":case"animationName":if(typeof r=="string")return r.replace(vie,function(n,a,i){return Ol={name:a,styles:i,next:Ol},a})}return hie[t]!==1&&!GH(t)&&typeof r=="number"&&r!==0?r+"px":r};function f1(e,t,r){if(r==null)return"";if(r.__emotion_styles!==void 0)return r;switch(typeof r){case"boolean":return"";case"object":{if(r.anim===1)return Ol={name:r.name,styles:r.styles,next:Ol},r.name;if(r.styles!==void 0){var n=r.next;if(n!==void 0)for(;n!==void 0;)Ol={name:n.name,styles:n.styles,next:Ol},n=n.next;var a=r.styles+";";return a}return gie(e,t,r)}case"function":{if(e!==void 0){var i=Ol,o=r(e);return Ol=i,f1(e,t,o)}break}}if(t==null)return r;var s=t[r];return s!==void 0?s:r}function gie(e,t,r){var n="";if(Array.isArray(r))for(var a=0;a<r.length;a++)n+=f1(e,t,r[a])+";";else for(var i in r){var o=r[i];if(typeof o!="object")t!=null&&t[o]!==void 0?n+=i+"{"+t[o]+"}":Z8(o)&&(n+=R4(i)+":"+J8(i,o)+";");else if(Array.isArray(o)&&typeof o[0]=="string"&&(t==null||t[o[0]]===void 0))for(var s=0;s<o.length;s++)Z8(o[s])&&(n+=R4(i)+":"+J8(i,o[s])+";");else{var u=f1(e,t,o);switch(i){case"animation":case"animationName":{n+=R4(i)+":"+u+";";break}default:n+=i+"{"+u+"}"}}}return n}var eO=/label:\s*([^\s;\n{]+)\s*(;|$)/g,Ol,nD=function(t,r,n){if(t.length===1&&typeof t[0]=="object"&&t[0]!==null&&t[0].styles!==void 0)return t[0];var a=!0,i="";Ol=void 0;var o=t[0];o==null||o.raw===void 0?(a=!1,i+=f1(n,r,o)):i+=o[0];for(var s=1;s<t.length;s++)i+=f1(n,r,t[s]),a&&(i+=o[s]);eO.lastIndex=0;for(var u="",l;(l=eO.exec(i))!==null;)u+="-"+l[1];var c=pie(i)+u;return{name:c,styles:i,next:Ol}},yie=function(t){return t()},qH=C6["useInsertionEffect"]?C6["useInsertionEffect"]:!1,bie=qH||yie,tO=qH||ke.exports.useLayoutEffect,WH=ke.exports.createContext(typeof HTMLElement<"u"?nie({key:"css"}):null);WH.Provider;var XH=function(t){return ke.exports.forwardRef(function(r,n){var a=ke.exports.useContext(WH);return t(r,a,n)})},p1=ke.exports.createContext({}),xie=function(t,r){if(typeof r=="function"){var n=r(t);return n}return JS({},t,r)},Sie=$8(function(e){return $8(function(t){return xie(e,t)})}),Cie=function(t){var r=ke.exports.useContext(p1);return t.theme!==r&&(r=Sie(r)(t.theme)),ke.exports.createElement(p1.Provider,{value:r},t.children)},pw=XH(function(e,t){var r=e.styles,n=nD([r],void 0,ke.exports.useContext(p1)),a=ke.exports.useRef();return tO(function(){var i=t.key+"-global",o=new t.sheet.constructor({key:i,nonce:t.sheet.nonce,container:t.sheet.container,speedy:t.sheet.isSpeedy}),s=!1,u=document.querySelector('style[data-emotion="'+i+" "+n.name+'"]');return t.sheet.tags.length&&(o.before=t.sheet.tags[0]),u!==null&&(s=!0,u.setAttribute("data-emotion",i),o.hydrate([u])),a.current=[o,s],function(){o.flush()}},[t]),tO(function(){var i=a.current,o=i[0],s=i[1];if(s){i[1]=!1;return}if(n.next!==void 0&&jH(t,n.next,!0),o.tags.length){var u=o.tags[o.tags.length-1].nextElementSibling;o.before=u,o.flush()}t.insert("",n,o,!1)},[t,n.name]),null});function wie(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return nD(t)}var _ie=function(){var t=wie.apply(void 0,arguments),r="animation-"+t.name;return{name:r,styles:"@keyframes "+r+"{"+t.styles+"}",anim:1,toString:function(){return"_EMO_"+this.name+"_"+this.styles+"_EMO_"}}};function Aie(e){return typeof e=="function"}function Tie(e,t){const r={};return Object.keys(e).forEach(n=>{t.includes(n)||(r[n]=e[n])}),r}function Eie(e,t,r,n){const a=typeof t=="string"?t.split("."):[t];for(n=0;n<a.length&&e;n+=1)e=e[a[n]];return e===void 0?r:e}var Pie=e=>{const t=new WeakMap;return(n,a,i,o)=>{if(typeof n>"u")return e(n,a,i);t.has(n)||t.set(n,new Map);const s=t.get(n);if(s.has(a))return s.get(a);const u=e(n,a,i,o);return s.set(a,u),u}},YH=Pie(Eie);function KH(e,t){const r={};return Object.keys(e).forEach(n=>{const a=e[n];t(a,n,e)&&(r[n]=a)}),r}var $H=e=>KH(e,t=>t!=null);function QH(e,...t){return Aie(e)?e(...t):e}Object.freeze(["base","sm","md","lg","xl","2xl"]);function Iie(e={}){const{strict:t=!0,errorMessage:r="useContext: `context` is undefined. Seems you forgot to wrap component within the Provider",name:n}=e,a=ke.exports.createContext(void 0);a.displayName=n;function i(){var o;const s=ke.exports.useContext(a);if(!s&&t){const u=new Error(r);throw u.name="ContextError",(o=Error.captureStackTrace)==null||o.call(Error,u,i),u}return s}return[a.Provider,i,a]}var Mie=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|abbr|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|download|draggable|encType|enterKeyHint|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|translate|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|incremental|fallback|inert|itemProp|itemScope|itemType|itemID|itemRef|on|option|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,Die=LH(function(e){return Mie.test(e)||e.charCodeAt(0)===111&&e.charCodeAt(1)===110&&e.charCodeAt(2)<91}),kie=Die,Rie=function(t){return t!=="theme"},rO=function(t){return typeof t=="string"&&t.charCodeAt(0)>96?kie:Rie},nO=function(t,r,n){var a;if(r){var i=r.shouldForwardProp;a=t.__emotion_forwardProp&&i?function(o){return t.__emotion_forwardProp(o)&&i(o)}:i}return typeof a!="function"&&n&&(a=t.__emotion_forwardProp),a},Oie=function(t){var r=t.cache,n=t.serialized,a=t.isStringTag;return HH(r,n,a),bie(function(){return jH(r,n,a)}),null},Bie=function e(t,r){var n=t.__emotion_real===t,a=n&&t.__emotion_base||t,i,o;r!==void 0&&(i=r.label,o=r.target);var s=nO(t,r,n),u=s||rO(a),l=!u("as");return function(){var c=arguments,d=n&&t.__emotion_styles!==void 0?t.__emotion_styles.slice(0):[];if(i!==void 0&&d.push("label:"+i+";"),c[0]==null||c[0].raw===void 0)d.push.apply(d,c);else{d.push(c[0][0]);for(var f=c.length,p=1;p<f;p++)d.push(c[p],c[0][p])}var h=XH(function(m,v,g){var y=l&&m.as||a,b="",S=[],x=m;if(m.theme==null){x={};for(var C in m)x[C]=m[C];x.theme=ke.exports.useContext(p1)}typeof m.className=="string"?b=fie(v.registered,S,m.className):m.className!=null&&(b=m.className+" ");var w=nD(d.concat(S),v.registered,x);b+=v.key+"-"+w.name,o!==void 0&&(b+=" "+o);var _=l&&s===void 0?rO(y):u,E={};for(var P in m)l&&P==="as"||_(P)&&(E[P]=m[P]);return E.className=b,E.ref=g,ke.exports.createElement(ke.exports.Fragment,null,ke.exports.createElement(Oie,{cache:v,serialized:w,isStringTag:typeof y=="string"}),ke.exports.createElement(y,E))});return h.displayName=i!==void 0?i:"Styled("+(typeof a=="string"?a:a.displayName||a.name||"Component")+")",h.defaultProps=t.defaultProps,h.__emotion_real=h,h.__emotion_base=a,h.__emotion_styles=d,h.__emotion_forwardProp=s,Object.defineProperty(h,"toString",{value:function(){return"."+o}}),h.withComponent=function(m,v){return e(m,JS({},r,v,{shouldForwardProp:nO(h,v,!0)})).apply(void 0,d)},h}},Fie=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"],lP=Bie.bind();Fie.forEach(function(e){lP[e]=lP(e)});var Lie=typeof Element<"u",Nie=typeof Map=="function",zie=typeof Set=="function",Uie=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function Zx(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var r,n,a;if(Array.isArray(e)){if(r=e.length,r!=t.length)return!1;for(n=r;n--!==0;)if(!Zx(e[n],t[n]))return!1;return!0}var i;if(Nie&&e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(i=e.entries();!(n=i.next()).done;)if(!t.has(n.value[0]))return!1;for(i=e.entries();!(n=i.next()).done;)if(!Zx(n.value[1],t.get(n.value[0])))return!1;return!0}if(zie&&e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(i=e.entries();!(n=i.next()).done;)if(!t.has(n.value[0]))return!1;return!0}if(Uie&&ArrayBuffer.isView(e)&&ArrayBuffer.isView(t)){if(r=e.length,r!=t.length)return!1;for(n=r;n--!==0;)if(e[n]!==t[n])return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===t.toString();if(a=Object.keys(e),r=a.length,r!==Object.keys(t).length)return!1;for(n=r;n--!==0;)if(!Object.prototype.hasOwnProperty.call(t,a[n]))return!1;if(Lie&&e instanceof Element)return!1;for(n=r;n--!==0;)if(!((a[n]==="_owner"||a[n]==="__v"||a[n]==="__o")&&e.$$typeof)&&!Zx(e[a[n]],t[a[n]]))return!1;return!0}return e!==e&&t!==t}var Vie=function(t,r){try{return Zx(t,r)}catch(n){if((n.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw n}};function Hie(){const e=ke.exports.useContext(p1);if(!e)throw Error("useTheme: `theme` is undefined. Seems you forgot to wrap your app in `<ChakraProvider />` or `<ThemeProvider />`");return e}function jie(){const e=XM(),t=Hie();return{...e,theme:t}}function Gie(e){const{cssVarsRoot:t,theme:r,children:n}=e,a=ke.exports.useMemo(()=>vae(r),[r]);return Pe(Cie,{theme:a,children:[B(qie,{root:t}),n]})}function qie({root:e=":host, :root"}){const t=[e,"[data-theme]"].join(",");return B(pw,{styles:r=>({[t]:r.__cssVars})})}Iie({name:"StylesContext",errorMessage:"useStyles: `styles` is undefined. Seems you forgot to wrap the components in `<StylesProvider />` "});function Wie(){const{colorMode:e}=XM();return B(pw,{styles:t=>{const r=YH(t,"styles.global"),n=QH(r,{theme:t,colorMode:e});return n?IH(n)(t):void 0}})}var Xie=new Set([...gae,"textStyle","layerStyle","apply","noOfLines","focusBorderColor","errorBorderColor","as","__css","css","sx"]),Yie=new Set(["htmlWidth","htmlHeight","htmlSize"]);function Kie(e){return Yie.has(e)||!Xie.has(e)}var $ie=({baseStyle:e})=>t=>{const{theme:r,css:n,__css:a,sx:i,...o}=t,s=KH(o,(d,f)=>bae(f)),u=QH(e,t),l=Object.assign({},a,u,$H(s),i),c=IH(l)(t.theme);return n?[c,n]:c};function O4(e,t){const{baseStyle:r,...n}=t??{};n.shouldForwardProp||(n.shouldForwardProp=Kie);const a=$ie({baseStyle:r}),i=lP(e,n)(a);return sa.forwardRef(function(u,l){const{colorMode:c,forced:d}=XM();return sa.createElement(i,{ref:l,"data-theme":d?c:void 0,...u})})}function M0(e){return ke.exports.forwardRef(e)}function ZH(e,t={}){const{styleConfig:r,...n}=t,{theme:a,colorMode:i}=jie(),o=YH(a,`components.${e}`),s=r||o,u=Hl({theme:a,colorMode:i},s?.defaultProps??{},$H(Tie(n,["children"]))),l=ke.exports.useRef({});if(s){const d=Iae(s)(u);Vie(l.current,d)||(l.current=d)}return l.current}function JH(e,t={}){return ZH(e,t)}function Qie(e,t={}){return ZH(e,t)}function Zie(){const e=new Map;return new Proxy(O4,{apply(t,r,n){return O4(...n)},get(t,r){return e.has(r)||e.set(r,O4(r)),e.get(r)}})}var tl=Zie();function Jie(e,t){return`${e} returned \`undefined\`. Seems you forgot to wrap component within ${t}`}function hw(e={}){const{name:t,strict:r=!0,hookName:n="useContext",providerName:a="Provider",errorMessage:i}=e,o=ke.exports.createContext(void 0);o.displayName=t;function s(){var u;const l=ke.exports.useContext(o);if(!l&&r){const c=new Error(i??Jie(n,a));throw c.name="ContextError",(u=Error.captureStackTrace)==null||u.call(Error,c,s),c}return l}return[o.Provider,s,o]}var eoe=(...e)=>e.filter(Boolean).join(" "),aO={path:Pe("g",{stroke:"currentColor",strokeWidth:"1.5",children:[B("path",{strokeLinecap:"round",fill:"none",d:"M9,9a3,3,0,1,1,4,2.829,1.5,1.5,0,0,0-1,1.415V14.25"}),B("path",{fill:"currentColor",strokeLinecap:"round",d:"M12,17.25a.375.375,0,1,0,.375.375A.375.375,0,0,0,12,17.25h0"}),B("circle",{fill:"none",strokeMiterlimit:"10",cx:"12",cy:"12",r:"11.25"})]}),viewBox:"0 0 24 24"},tb=M0((e,t)=>{const{as:r,viewBox:n,color:a="currentColor",focusable:i=!1,children:o,className:s,__css:u,...l}=e,c=eoe("chakra-icon",s),d={w:"1em",h:"1em",display:"inline-block",lineHeight:"1em",flexShrink:0,color:a,...u},f={ref:t,focusable:i,className:c,__css:d},p=n??aO.viewBox;if(r&&typeof r!="string")return sa.createElement(tl.svg,{as:r,...f,...l});const h=o??aO.path;return sa.createElement(tl.svg,{verticalAlign:"middle",viewBox:p,...f,...l},h)});tb.displayName="Icon";function toe(e,t=[]){const r=ke.exports.useRef(e);return ke.exports.useEffect(()=>{r.current=e}),ke.exports.useCallback((...n)=>{var a;return(a=r.current)==null?void 0:a.call(r,...n)},t)}const aD=ke.exports.createContext({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"}),mw=ke.exports.createContext({});function roe(){return ke.exports.useContext(mw).visualElement}const D0=ke.exports.createContext(null),Sm=typeof document<"u",eC=Sm?ke.exports.useLayoutEffect:ke.exports.useEffect,ej=ke.exports.createContext({strict:!1});function noe(e,t,r,n){const a=roe(),i=ke.exports.useContext(ej),o=ke.exports.useContext(D0),s=ke.exports.useContext(aD).reducedMotion,u=ke.exports.useRef(void 0);n=n||i.renderer,!u.current&&n&&(u.current=n(e,{visualState:t,parent:a,props:r,presenceId:o?o.id:void 0,blockInitialAnimation:o?o.initial===!1:!1,reducedMotionConfig:s}));const l=u.current;return eC(()=>{l&&l.syncRender()}),ke.exports.useEffect(()=>{l&&l.animationState&&l.animationState.animateChanges()}),eC(()=>()=>l&&l.notifyUnmount(),[]),l}function Pv(e){return typeof e=="object"&&Object.prototype.hasOwnProperty.call(e,"current")}function aoe(e,t,r){return ke.exports.useCallback(n=>{n&&e.mount&&e.mount(n),t&&(n?t.mount(n):t.unmount()),r&&(typeof r=="function"?r(n):Pv(r)&&(r.current=n))},[t])}function h1(e){return typeof e=="string"||Array.isArray(e)}function vw(e){return typeof e=="object"&&typeof e.start=="function"}const ioe=["initial","animate","exit","whileHover","whileDrag","whileTap","whileFocus","whileInView"];function gw(e){return vw(e.animate)||ioe.some(t=>h1(e[t]))}function tj(e){return Boolean(gw(e)||e.variants)}function ooe(e,t){if(gw(e)){const{initial:r,animate:n}=e;return{initial:r===!1||h1(r)?r:void 0,animate:h1(n)?n:void 0}}return e.inherit!==!1?t:{}}function soe(e){const{initial:t,animate:r}=ooe(e,ke.exports.useContext(mw));return ke.exports.useMemo(()=>({initial:t,animate:r}),[iO(t),iO(r)])}function iO(e){return Array.isArray(e)?e.join(" "):e}const xc=e=>({isEnabled:t=>e.some(r=>!!t[r])}),m1={measureLayout:xc(["layout","layoutId","drag"]),animation:xc(["animate","exit","variants","whileHover","whileTap","whileFocus","whileDrag","whileInView"]),exit:xc(["exit"]),drag:xc(["drag","dragControls"]),focus:xc(["whileFocus"]),hover:xc(["whileHover","onHoverStart","onHoverEnd"]),tap:xc(["whileTap","onTap","onTapStart","onTapCancel"]),pan:xc(["onPan","onPanStart","onPanSessionStart","onPanEnd"]),inView:xc(["whileInView","onViewportEnter","onViewportLeave"])};function uoe(e){for(const t in e)t==="projectionNodeConstructor"?m1.projectionNodeConstructor=e[t]:m1[t].Component=e[t]}function yw(e){const t=ke.exports.useRef(null);return t.current===null&&(t.current=e()),t.current}const xy={hasAnimatedSinceResize:!0,hasEverUpdated:!1};let loe=1;function coe(){return yw(()=>{if(xy.hasEverUpdated)return loe++})}const iD=ke.exports.createContext({});class doe extends sa.Component{getSnapshotBeforeUpdate(){const{visualElement:t,props:r}=this.props;return t&&t.setProps(r),null}componentDidUpdate(){}render(){return this.props.children}}const rj=ke.exports.createContext({}),foe=Symbol.for("motionComponentSymbol");function poe({preloadedFeatures:e,createVisualElement:t,projectionNodeConstructor:r,useRender:n,useVisualState:a,Component:i}){e&&uoe(e);function o(u,l){const c={...ke.exports.useContext(aD),...u,layoutId:hoe(u)},{isStatic:d}=c;let f=null;const p=soe(u),h=d?void 0:coe(),m=a(u,d);if(!d&&Sm){p.visualElement=noe(i,m,c,t);const v=ke.exports.useContext(ej).strict,g=ke.exports.useContext(rj);p.visualElement&&(f=p.visualElement.loadFeatures(c,v,e,h,r||m1.projectionNodeConstructor,g))}return Pe(doe,{visualElement:p.visualElement,props:c,children:[f,B(mw.Provider,{value:p,children:n(i,u,h,aoe(m,p.visualElement,l),m,d,p.visualElement)})]})}const s=ke.exports.forwardRef(o);return s[foe]=i,s}function hoe({layoutId:e}){const t=ke.exports.useContext(iD).id;return t&&e!==void 0?t+"-"+e:e}function moe(e){function t(n,a={}){return poe(e(n,a))}if(typeof Proxy>"u")return t;const r=new Map;return new Proxy(t,{get:(n,a)=>(r.has(a)||r.set(a,t(a)),r.get(a))})}const voe=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","svg","switch","symbol","text","tspan","use","view"];function oD(e){return typeof e!="string"||e.includes("-")?!1:!!(voe.indexOf(e)>-1||/[A-Z]/.test(e))}const tC={};function goe(e){Object.assign(tC,e)}const rC=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],rb=new Set(rC);function nj(e,{layout:t,layoutId:r}){return rb.has(e)||e.startsWith("origin")||(t||r!==void 0)&&(!!tC[e]||e==="opacity")}const rc=e=>!!e?.getVelocity,yoe={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},boe=(e,t)=>rC.indexOf(e)-rC.indexOf(t);function xoe({transform:e,transformKeys:t},{enableHardwareAcceleration:r=!0,allowTransformNone:n=!0},a,i){let o="";t.sort(boe);for(const s of t)o+=`${yoe[s]||s}(${e[s]}) `;return r&&!e.z&&(o+="translateZ(0)"),o=o.trim(),i?o=i(e,a?"":o):n&&a&&(o="none"),o}function aj(e){return e.startsWith("--")}const Soe=(e,t)=>t&&typeof e=="number"?t.transform(e):e,ij=(e,t)=>r=>Math.max(Math.min(r,t),e),Sy=e=>e%1?Number(e.toFixed(5)):e,v1=/(-)?([\d]*\.?[\d])+/g,cP=/(#[0-9a-f]{6}|#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2}(-?[\d\.]+%?)\s*[\,\/]?\s*[\d\.]*%?\))/gi,Coe=/^(#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2}(-?[\d\.]+%?)\s*[\,\/]?\s*[\d\.]*%?\))$/i;function nb(e){return typeof e=="string"}const Cm={test:e=>typeof e=="number",parse:parseFloat,transform:e=>e},Cy=Object.assign(Object.assign({},Cm),{transform:ij(0,1)}),C2=Object.assign(Object.assign({},Cm),{default:1}),ab=e=>({test:t=>nb(t)&&t.endsWith(e)&&t.split(" ").length===1,parse:parseFloat,transform:t=>`${t}${e}`}),Sf=ab("deg"),Zl=ab("%"),br=ab("px"),woe=ab("vh"),_oe=ab("vw"),oO=Object.assign(Object.assign({},Zl),{parse:e=>Zl.parse(e)/100,transform:e=>Zl.transform(e*100)}),sD=(e,t)=>r=>Boolean(nb(r)&&Coe.test(r)&&r.startsWith(e)||t&&Object.prototype.hasOwnProperty.call(r,t)),oj=(e,t,r)=>n=>{if(!nb(n))return n;const[a,i,o,s]=n.match(v1);return{[e]:parseFloat(a),[t]:parseFloat(i),[r]:parseFloat(o),alpha:s!==void 0?parseFloat(s):1}},Eh={test:sD("hsl","hue"),parse:oj("hue","saturation","lightness"),transform:({hue:e,saturation:t,lightness:r,alpha:n=1})=>"hsla("+Math.round(e)+", "+Zl.transform(Sy(t))+", "+Zl.transform(Sy(r))+", "+Sy(Cy.transform(n))+")"},Aoe=ij(0,255),B4=Object.assign(Object.assign({},Cm),{transform:e=>Math.round(Aoe(e))}),Uf={test:sD("rgb","red"),parse:oj("red","green","blue"),transform:({red:e,green:t,blue:r,alpha:n=1})=>"rgba("+B4.transform(e)+", "+B4.transform(t)+", "+B4.transform(r)+", "+Sy(Cy.transform(n))+")"};function Toe(e){let t="",r="",n="",a="";return e.length>5?(t=e.substr(1,2),r=e.substr(3,2),n=e.substr(5,2),a=e.substr(7,2)):(t=e.substr(1,1),r=e.substr(2,1),n=e.substr(3,1),a=e.substr(4,1),t+=t,r+=r,n+=n,a+=a),{red:parseInt(t,16),green:parseInt(r,16),blue:parseInt(n,16),alpha:a?parseInt(a,16)/255:1}}const dP={test:sD("#"),parse:Toe,transform:Uf.transform},lo={test:e=>Uf.test(e)||dP.test(e)||Eh.test(e),parse:e=>Uf.test(e)?Uf.parse(e):Eh.test(e)?Eh.parse(e):dP.parse(e),transform:e=>nb(e)?e:e.hasOwnProperty("red")?Uf.transform(e):Eh.transform(e)},sj="${c}",uj="${n}";function Eoe(e){var t,r,n,a;return isNaN(e)&&nb(e)&&((r=(t=e.match(v1))===null||t===void 0?void 0:t.length)!==null&&r!==void 0?r:0)+((a=(n=e.match(cP))===null||n===void 0?void 0:n.length)!==null&&a!==void 0?a:0)>0}function lj(e){typeof e=="number"&&(e=`${e}`);const t=[];let r=0;const n=e.match(cP);n&&(r=n.length,e=e.replace(cP,sj),t.push(...n.map(lo.parse)));const a=e.match(v1);return a&&(e=e.replace(v1,uj),t.push(...a.map(Cm.parse))),{values:t,numColors:r,tokenised:e}}function cj(e){return lj(e).values}function dj(e){const{values:t,numColors:r,tokenised:n}=lj(e),a=t.length;return i=>{let o=n;for(let s=0;s<a;s++)o=o.replace(s<r?sj:uj,s<r?lo.transform(i[s]):Sy(i[s]));return o}}const Poe=e=>typeof e=="number"?0:e;function Ioe(e){const t=cj(e);return dj(e)(t.map(Poe))}const ld={test:Eoe,parse:cj,createTransformer:dj,getAnimatableNone:Ioe},Moe=new Set(["brightness","contrast","saturate","opacity"]);function Doe(e){let[t,r]=e.slice(0,-1).split("(");if(t==="drop-shadow")return e;const[n]=r.match(v1)||[];if(!n)return e;const a=r.replace(n,"");let i=Moe.has(t)?1:0;return n!==r&&(i*=100),t+"("+i+a+")"}const koe=/([a-z-]*)\(.*?\)/g,fP=Object.assign(Object.assign({},ld),{getAnimatableNone:e=>{const t=e.match(koe);return t?t.map(Doe).join(" "):e}}),sO={...Cm,transform:Math.round},fj={borderWidth:br,borderTopWidth:br,borderRightWidth:br,borderBottomWidth:br,borderLeftWidth:br,borderRadius:br,radius:br,borderTopLeftRadius:br,borderTopRightRadius:br,borderBottomRightRadius:br,borderBottomLeftRadius:br,width:br,maxWidth:br,height:br,maxHeight:br,size:br,top:br,right:br,bottom:br,left:br,padding:br,paddingTop:br,paddingRight:br,paddingBottom:br,paddingLeft:br,margin:br,marginTop:br,marginRight:br,marginBottom:br,marginLeft:br,rotate:Sf,rotateX:Sf,rotateY:Sf,rotateZ:Sf,scale:C2,scaleX:C2,scaleY:C2,scaleZ:C2,skew:Sf,skewX:Sf,skewY:Sf,distance:br,translateX:br,translateY:br,translateZ:br,x:br,y:br,z:br,perspective:br,transformPerspective:br,opacity:Cy,originX:oO,originY:oO,originZ:br,zIndex:sO,fillOpacity:Cy,strokeOpacity:Cy,numOctaves:sO};function uD(e,t,r,n){const{style:a,vars:i,transform:o,transformKeys:s,transformOrigin:u}=e;s.length=0;let l=!1,c=!1,d=!0;for(const f in t){const p=t[f];if(aj(f)){i[f]=p;continue}const h=fj[f],m=Soe(p,h);if(rb.has(f)){if(l=!0,o[f]=m,s.push(f),!d)continue;p!==(h.default||0)&&(d=!1)}else f.startsWith("origin")?(c=!0,u[f]=m):a[f]=m}if(l||n?a.transform=xoe(e,r,d,n):!t.transform&&a.transform&&(a.transform="none"),c){const{originX:f="50%",originY:p="50%",originZ:h=0}=u;a.transformOrigin=`${f} ${p} ${h}`}}const lD=()=>({style:{},transform:{},transformKeys:[],transformOrigin:{},vars:{}});function pj(e,t,r){for(const n in t)!rc(t[n])&&!nj(n,r)&&(e[n]=t[n])}function Roe({transformTemplate:e},t,r){return ke.exports.useMemo(()=>{const n=lD();return uD(n,t,{enableHardwareAcceleration:!r},e),Object.assign({},n.vars,n.style)},[t])}function Ooe(e,t,r){const n=e.style||{},a={};return pj(a,n,e),Object.assign(a,Roe(e,t,r)),e.transformValues?e.transformValues(a):a}function Boe(e,t,r){const n={},a=Ooe(e,t,r);return e.drag&&e.dragListener!==!1&&(n.draggable=!1,a.userSelect=a.WebkitUserSelect=a.WebkitTouchCallout="none",a.touchAction=e.drag===!0?"none":`pan-${e.drag==="x"?"y":"x"}`),n.style=a,n}const Foe=["animate","exit","variants","whileHover","whileTap","whileFocus","whileDrag","whileInView"],Loe=["whileTap","onTap","onTapStart","onTapCancel"],Noe=["onPan","onPanStart","onPanSessionStart","onPanEnd"],zoe=["whileInView","onViewportEnter","onViewportLeave","viewport"],Uoe=new Set(["initial","style","variants","transition","transformTemplate","transformValues","custom","inherit","layout","layoutId","layoutDependency","onLayoutAnimationStart","onLayoutAnimationComplete","onLayoutMeasure","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","drag","dragControls","dragListener","dragConstraints","dragDirectionLock","dragSnapToOrigin","_dragX","_dragY","dragElastic","dragMomentum","dragPropagation","dragTransition","onHoverStart","onHoverEnd","layoutScroll",...zoe,...Loe,...Foe,...Noe]);function nC(e){return Uoe.has(e)}let hj=e=>!nC(e);function Voe(e){!e||(hj=t=>t.startsWith("on")?!nC(t):e(t))}try{Voe(require("@emotion/is-prop-valid").default)}catch{}function Hoe(e,t,r){const n={};for(const a in e)(hj(a)||r===!0&&nC(a)||!t&&!nC(a)||e.draggable&&a.startsWith("onDrag"))&&(n[a]=e[a]);return n}function uO(e,t,r){return typeof e=="string"?e:br.transform(t+r*e)}function joe(e,t,r){const n=uO(t,e.x,e.width),a=uO(r,e.y,e.height);return`${n} ${a}`}const Goe={offset:"stroke-dashoffset",array:"stroke-dasharray"},qoe={offset:"strokeDashoffset",array:"strokeDasharray"};function Woe(e,t,r=1,n=0,a=!0){e.pathLength=1;const i=a?Goe:qoe;e[i.offset]=br.transform(-n);const o=br.transform(t),s=br.transform(r);e[i.array]=`${o} ${s}`}function cD(e,{attrX:t,attrY:r,originX:n,originY:a,pathLength:i,pathSpacing:o=1,pathOffset:s=0,...u},l,c){uD(e,u,l,c),e.attrs=e.style,e.style={};const{attrs:d,style:f,dimensions:p}=e;d.transform&&(p&&(f.transform=d.transform),delete d.transform),p&&(n!==void 0||a!==void 0||f.transform)&&(f.transformOrigin=joe(p,n!==void 0?n:.5,a!==void 0?a:.5)),t!==void 0&&(d.x=t),r!==void 0&&(d.y=r),i!==void 0&&Woe(d,i,o,s,!1)}const mj=()=>({...lD(),attrs:{}});function Xoe(e,t){const r=ke.exports.useMemo(()=>{const n=mj();return cD(n,t,{enableHardwareAcceleration:!1},e.transformTemplate),{...n.attrs,style:{...n.style}}},[t]);if(e.style){const n={};pj(n,e.style,e),r.style={...n,...r.style}}return r}function Yoe(e=!1){return(r,n,a,i,{latestValues:o},s)=>{const l=(oD(r)?Xoe:Boe)(n,o,s),d={...Hoe(n,typeof r=="string",e),...l,ref:i};return a&&(d["data-projection-id"]=a),ke.exports.createElement(r,d)}}const vj=e=>e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();function gj(e,{style:t,vars:r},n,a){Object.assign(e.style,t,a&&a.getProjectionStyles(n));for(const i in r)e.style.setProperty(i,r[i])}const yj=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength"]);function bj(e,t,r,n){gj(e,t,void 0,n);for(const a in t.attrs)e.setAttribute(yj.has(a)?a:vj(a),t.attrs[a])}function dD(e){const{style:t}=e,r={};for(const n in t)(rc(t[n])||nj(n,e))&&(r[n]=t[n]);return r}function xj(e){const t=dD(e);for(const r in e)if(rc(e[r])){const n=r==="x"||r==="y"?"attr"+r.toUpperCase():r;t[n]=e[r]}return t}function Sj(e,t,r,n={},a={}){return typeof t=="function"&&(t=t(r!==void 0?r:e.custom,n,a)),typeof t=="string"&&(t=e.variants&&e.variants[t]),typeof t=="function"&&(t=t(r!==void 0?r:e.custom,n,a)),t}const g1=e=>Array.isArray(e),Koe=e=>Boolean(e&&typeof e=="object"&&e.mix&&e.toValue),Cj=e=>g1(e)?e[e.length-1]||0:e;function Jx(e){const t=rc(e)?e.get():e;return Koe(t)?t.toValue():t}function $oe({scrapeMotionValuesFromProps:e,createRenderState:t,onMount:r},n,a,i){const o={latestValues:Qoe(n,a,i,e),renderState:t()};return r&&(o.mount=s=>r(n,s,o)),o}const wj=e=>(t,r)=>{const n=ke.exports.useContext(mw),a=ke.exports.useContext(D0),i=()=>$oe(e,t,n,a);return r?i():yw(i)};function Qoe(e,t,r,n){const a={},i=n(e);for(const f in i)a[f]=Jx(i[f]);let{initial:o,animate:s}=e;const u=gw(e),l=tj(e);t&&l&&!u&&e.inherit!==!1&&(o===void 0&&(o=t.initial),s===void 0&&(s=t.animate));let c=r?r.initial===!1:!1;c=c||o===!1;const d=c?s:o;return d&&typeof d!="boolean"&&!vw(d)&&(Array.isArray(d)?d:[d]).forEach(p=>{const h=Sj(e,p);if(!h)return;const{transitionEnd:m,transition:v,...g}=h;for(const y in g){let b=g[y];if(Array.isArray(b)){const S=c?b.length-1:0;b=b[S]}b!==null&&(a[y]=b)}for(const y in m)a[y]=m[y]}),a}const Zoe={useVisualState:wj({scrapeMotionValuesFromProps:xj,createRenderState:mj,onMount:(e,t,{renderState:r,latestValues:n})=>{try{r.dimensions=typeof t.getBBox=="function"?t.getBBox():t.getBoundingClientRect()}catch{r.dimensions={x:0,y:0,width:0,height:0}}cD(r,n,{enableHardwareAcceleration:!1},e.transformTemplate),bj(t,r)}})},Joe={useVisualState:wj({scrapeMotionValuesFromProps:dD,createRenderState:lD})};function ese(e,{forwardMotionProps:t=!1},r,n,a){return{...oD(e)?Zoe:Joe,preloadedFeatures:r,useRender:Yoe(t),createVisualElement:n,projectionNodeConstructor:a,Component:e}}var $n;(function(e){e.Animate="animate",e.Hover="whileHover",e.Tap="whileTap",e.Drag="whileDrag",e.Focus="whileFocus",e.InView="whileInView",e.Exit="exit"})($n||($n={}));function bw(e,t,r,n={passive:!0}){return e.addEventListener(t,r,n),()=>e.removeEventListener(t,r)}function pP(e,t,r,n){ke.exports.useEffect(()=>{const a=e.current;if(r&&a)return bw(a,t,r,n)},[e,t,r,n])}function tse({whileFocus:e,visualElement:t}){const{animationState:r}=t,n=()=>{r&&r.setActive($n.Focus,!0)},a=()=>{r&&r.setActive($n.Focus,!1)};pP(t,"focus",e?n:void 0),pP(t,"blur",e?a:void 0)}function _j(e){return typeof PointerEvent<"u"&&e instanceof PointerEvent?e.pointerType==="mouse":e instanceof MouseEvent}function Aj(e){return!!e.touches}function rse(e){return t=>{const r=t instanceof MouseEvent;(!r||r&&t.button===0)&&e(t)}}const nse={pageX:0,pageY:0};function ase(e,t="page"){const n=e.touches[0]||e.changedTouches[0]||nse;return{x:n[t+"X"],y:n[t+"Y"]}}function ise(e,t="page"){return{x:e[t+"X"],y:e[t+"Y"]}}function fD(e,t="page"){return{point:Aj(e)?ase(e,t):ise(e,t)}}const Tj=(e,t=!1)=>{const r=n=>e(n,fD(n));return t?rse(r):r},ose=()=>Sm&&window.onpointerdown===null,sse=()=>Sm&&window.ontouchstart===null,use=()=>Sm&&window.onmousedown===null,lse={pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointercancel:"mousecancel",pointerover:"mouseover",pointerout:"mouseout",pointerenter:"mouseenter",pointerleave:"mouseleave"},cse={pointerdown:"touchstart",pointermove:"touchmove",pointerup:"touchend",pointercancel:"touchcancel"};function Ej(e){return ose()?e:sse()?cse[e]:use()?lse[e]:e}function Gv(e,t,r,n){return bw(e,Ej(t),Tj(r,t==="pointerdown"),n)}function aC(e,t,r,n){return pP(e,Ej(t),r&&Tj(r,t==="pointerdown"),n)}function Pj(e){let t=null;return()=>{const r=()=>{t=null};return t===null?(t=e,r):!1}}const lO=Pj("dragHorizontal"),cO=Pj("dragVertical");function Ij(e){let t=!1;if(e==="y")t=cO();else if(e==="x")t=lO();else{const r=lO(),n=cO();r&&n?t=()=>{r(),n()}:(r&&r(),n&&n())}return t}function Mj(){const e=Ij(!0);return e?(e(),!1):!0}function dO(e,t,r){return(n,a)=>{!_j(n)||Mj()||(e.animationState&&e.animationState.setActive($n.Hover,t),r&&r(n,a))}}function dse({onHoverStart:e,onHoverEnd:t,whileHover:r,visualElement:n}){aC(n,"pointerenter",e||r?dO(n,!0,e):void 0,{passive:!e}),aC(n,"pointerleave",t||r?dO(n,!1,t):void 0,{passive:!t})}const Dj=(e,t)=>t?e===t?!0:Dj(e,t.parentElement):!1;function pD(e){return ke.exports.useEffect(()=>()=>e(),[])}function kj(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,n=Object.getOwnPropertySymbols(e);a<n.length;a++)t.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(r[n[a]]=e[n[a]]);return r}var fse=function(){},iC=function(){};const oC=(e,t,r)=>Math.min(Math.max(r,e),t),F4=.001,pse=.01,fO=10,hse=.05,mse=1;function vse({duration:e=800,bounce:t=.25,velocity:r=0,mass:n=1}){let a,i;fse(e<=fO*1e3);let o=1-t;o=oC(hse,mse,o),e=oC(pse,fO,e/1e3),o<1?(a=l=>{const c=l*o,d=c*e,f=c-r,p=hP(l,o),h=Math.exp(-d);return F4-f/p*h},i=l=>{const d=l*o*e,f=d*r+r,p=Math.pow(o,2)*Math.pow(l,2)*e,h=Math.exp(-d),m=hP(Math.pow(l,2),o);return(-a(l)+F4>0?-1:1)*((f-p)*h)/m}):(a=l=>{const c=Math.exp(-l*e),d=(l-r)*e+1;return-F4+c*d},i=l=>{const c=Math.exp(-l*e),d=(r-l)*(e*e);return c*d});const s=5/e,u=yse(a,i,s);if(e=e*1e3,isNaN(u))return{stiffness:100,damping:10,duration:e};{const l=Math.pow(u,2)*n;return{stiffness:l,damping:o*2*Math.sqrt(n*l),duration:e}}}const gse=12;function yse(e,t,r){let n=r;for(let a=1;a<gse;a++)n=n-e(n)/t(n);return n}function hP(e,t){return e*Math.sqrt(1-t*t)}const bse=["duration","bounce"],xse=["stiffness","damping","mass"];function pO(e,t){return t.some(r=>e[r]!==void 0)}function Sse(e){let t=Object.assign({velocity:0,stiffness:100,damping:10,mass:1,isResolvedFromDuration:!1},e);if(!pO(e,xse)&&pO(e,bse)){const r=vse(e);t=Object.assign(Object.assign(Object.assign({},t),r),{velocity:0,mass:1}),t.isResolvedFromDuration=!0}return t}function hD(e){var{from:t=0,to:r=1,restSpeed:n=2,restDelta:a}=e,i=kj(e,["from","to","restSpeed","restDelta"]);const o={done:!1,value:t};let{stiffness:s,damping:u,mass:l,velocity:c,duration:d,isResolvedFromDuration:f}=Sse(i),p=hO,h=hO;function m(){const v=c?-(c/1e3):0,g=r-t,y=u/(2*Math.sqrt(s*l)),b=Math.sqrt(s/l)/1e3;if(a===void 0&&(a=Math.min(Math.abs(r-t)/100,.4)),y<1){const S=hP(b,y);p=x=>{const C=Math.exp(-y*b*x);return r-C*((v+y*b*g)/S*Math.sin(S*x)+g*Math.cos(S*x))},h=x=>{const C=Math.exp(-y*b*x);return y*b*C*(Math.sin(S*x)*(v+y*b*g)/S+g*Math.cos(S*x))-C*(Math.cos(S*x)*(v+y*b*g)-S*g*Math.sin(S*x))}}else if(y===1)p=S=>r-Math.exp(-b*S)*(g+(v+b*g)*S);else{const S=b*Math.sqrt(y*y-1);p=x=>{const C=Math.exp(-y*b*x),w=Math.min(S*x,300);return r-C*((v+y*b*g)*Math.sinh(w)+S*g*Math.cosh(w))/S}}}return m(),{next:v=>{const g=p(v);if(f)o.done=v>=d;else{const y=h(v)*1e3,b=Math.abs(y)<=n,S=Math.abs(r-g)<=a;o.done=b&&S}return o.value=o.done?r:g,o},flipTarget:()=>{c=-c,[t,r]=[r,t],m()}}}hD.needsInterpolation=(e,t)=>typeof e=="string"||typeof t=="string";const hO=e=>0,y1=(e,t,r)=>{const n=t-e;return n===0?1:(r-e)/n},Ma=(e,t,r)=>-r*e+r*t+e;function L4(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+(t-e)*6*r:r<1/2?t:r<2/3?e+(t-e)*(2/3-r)*6:e}function mO({hue:e,saturation:t,lightness:r,alpha:n}){e/=360,t/=100,r/=100;let a=0,i=0,o=0;if(!t)a=i=o=r;else{const s=r<.5?r*(1+t):r+t-r*t,u=2*r-s;a=L4(u,s,e+1/3),i=L4(u,s,e),o=L4(u,s,e-1/3)}return{red:Math.round(a*255),green:Math.round(i*255),blue:Math.round(o*255),alpha:n}}const Cse=(e,t,r)=>{const n=e*e,a=t*t;return Math.sqrt(Math.max(0,r*(a-n)+n))},wse=[dP,Uf,Eh],vO=e=>wse.find(t=>t.test(e)),Rj=(e,t)=>{let r=vO(e),n=vO(t),a=r.parse(e),i=n.parse(t);r===Eh&&(a=mO(a),r=Uf),n===Eh&&(i=mO(i),n=Uf);const o=Object.assign({},a);return s=>{for(const u in o)u!=="alpha"&&(o[u]=Cse(a[u],i[u],s));return o.alpha=Ma(a.alpha,i.alpha,s),r.transform(o)}},mP=e=>typeof e=="number",_se=(e,t)=>r=>t(e(r)),xw=(...e)=>e.reduce(_se);function Oj(e,t){return mP(e)?r=>Ma(e,t,r):lo.test(e)?Rj(e,t):Fj(e,t)}const Bj=(e,t)=>{const r=[...e],n=r.length,a=e.map((i,o)=>Oj(i,t[o]));return i=>{for(let o=0;o<n;o++)r[o]=a[o](i);return r}},Ase=(e,t)=>{const r=Object.assign(Object.assign({},e),t),n={};for(const a in r)e[a]!==void 0&&t[a]!==void 0&&(n[a]=Oj(e[a],t[a]));return a=>{for(const i in n)r[i]=n[i](a);return r}};function gO(e){const t=ld.parse(e),r=t.length;let n=0,a=0,i=0;for(let o=0;o<r;o++)n||typeof t[o]=="number"?n++:t[o].hue!==void 0?i++:a++;return{parsed:t,numNumbers:n,numRGB:a,numHSL:i}}const Fj=(e,t)=>{const r=ld.createTransformer(t),n=gO(e),a=gO(t);return n.numHSL===a.numHSL&&n.numRGB===a.numRGB&&n.numNumbers>=a.numNumbers?xw(Bj(n.parsed,a.parsed),r):o=>`${o>0?t:e}`},Tse=(e,t)=>r=>Ma(e,t,r);function Ese(e){if(typeof e=="number")return Tse;if(typeof e=="string")return lo.test(e)?Rj:Fj;if(Array.isArray(e))return Bj;if(typeof e=="object")return Ase}function Pse(e,t,r){const n=[],a=r||Ese(e[0]),i=e.length-1;for(let o=0;o<i;o++){let s=a(e[o],e[o+1]);if(t){const u=Array.isArray(t)?t[o]:t;s=xw(u,s)}n.push(s)}return n}function Ise([e,t],[r]){return n=>r(y1(e,t,n))}function Mse(e,t){const r=e.length,n=r-1;return a=>{let i=0,o=!1;if(a<=e[0]?o=!0:a>=e[n]&&(i=n-1,o=!0),!o){let u=1;for(;u<r&&!(e[u]>a||u===n);u++);i=u-1}const s=y1(e[i],e[i+1],a);return t[i](s)}}function Lj(e,t,{clamp:r=!0,ease:n,mixer:a}={}){const i=e.length;iC(i===t.length),iC(!n||!Array.isArray(n)||n.length===i-1),e[0]>e[i-1]&&(e=[].concat(e),t=[].concat(t),e.reverse(),t.reverse());const o=Pse(t,n,a),s=i===2?Ise(e,o):Mse(e,o);return r?u=>s(oC(e[0],e[i-1],u)):s}const Sw=e=>t=>1-e(1-t),mD=e=>t=>t<=.5?e(2*t)/2:(2-e(2*(1-t)))/2,Dse=e=>t=>Math.pow(t,e),Nj=e=>t=>t*t*((e+1)*t-e),kse=e=>{const t=Nj(e);return r=>(r*=2)<1?.5*t(r):.5*(2-Math.pow(2,-10*(r-1)))},zj=1.525,Rse=4/11,Ose=8/11,Bse=9/10,vD=e=>e,gD=Dse(2),Fse=Sw(gD),Uj=mD(gD),Vj=e=>1-Math.sin(Math.acos(e)),yD=Sw(Vj),Lse=mD(yD),bD=Nj(zj),Nse=Sw(bD),zse=mD(bD),Use=kse(zj),Vse=4356/361,Hse=35442/1805,jse=16061/1805,sC=e=>{if(e===1||e===0)return e;const t=e*e;return e<Rse?7.5625*t:e<Ose?9.075*t-9.9*e+3.4:e<Bse?Vse*t-Hse*e+jse:10.8*e*e-20.52*e+10.72},Gse=Sw(sC),qse=e=>e<.5?.5*(1-sC(1-e*2)):.5*sC(e*2-1)+.5;function Wse(e,t){return e.map(()=>t||Uj).splice(0,e.length-1)}function Xse(e){const t=e.length;return e.map((r,n)=>n!==0?n/(t-1):0)}function Yse(e,t){return e.map(r=>r*t)}function eS({from:e=0,to:t=1,ease:r,offset:n,duration:a=300}){const i={done:!1,value:e},o=Array.isArray(t)?t:[e,t],s=Yse(n&&n.length===o.length?n:Xse(o),a);function u(){return Lj(s,o,{ease:Array.isArray(r)?r:Wse(o,r)})}let l=u();return{next:c=>(i.value=l(c),i.done=c>=a,i),flipTarget:()=>{o.reverse(),l=u()}}}function Kse({velocity:e=0,from:t=0,power:r=.8,timeConstant:n=350,restDelta:a=.5,modifyTarget:i}){const o={done:!1,value:t};let s=r*e;const u=t+s,l=i===void 0?u:i(u);return l!==u&&(s=l-t),{next:c=>{const d=-s*Math.exp(-c/n);return o.done=!(d>a||d<-a),o.value=o.done?l:l+d,o},flipTarget:()=>{}}}const yO={keyframes:eS,spring:hD,decay:Kse};function $se(e){if(Array.isArray(e.to))return eS;if(yO[e.type])return yO[e.type];const t=new Set(Object.keys(e));return t.has("ease")||t.has("duration")&&!t.has("dampingRatio")?eS:t.has("dampingRatio")||t.has("stiffness")||t.has("mass")||t.has("damping")||t.has("restSpeed")||t.has("restDelta")?hD:eS}const Hj=1/60*1e3,Qse=typeof performance<"u"?()=>performance.now():()=>Date.now(),jj=typeof window<"u"?e=>window.requestAnimationFrame(e):e=>setTimeout(()=>e(Qse()),Hj);function Zse(e){let t=[],r=[],n=0,a=!1,i=!1;const o=new WeakSet,s={schedule:(u,l=!1,c=!1)=>{const d=c&&a,f=d?t:r;return l&&o.add(u),f.indexOf(u)===-1&&(f.push(u),d&&a&&(n=t.length)),u},cancel:u=>{const l=r.indexOf(u);l!==-1&&r.splice(l,1),o.delete(u)},process:u=>{if(a){i=!0;return}if(a=!0,[t,r]=[r,t],r.length=0,n=t.length,n)for(let l=0;l<n;l++){const c=t[l];c(u),o.has(c)&&(s.schedule(c),e())}a=!1,i&&(i=!1,s.process(u))}};return s}const Jse=40;let vP=!0,b1=!1,gP=!1;const qv={delta:0,timestamp:0},ib=["read","update","preRender","render","postRender"],Cw=ib.reduce((e,t)=>(e[t]=Zse(()=>b1=!0),e),{}),eue=ib.reduce((e,t)=>{const r=Cw[t];return e[t]=(n,a=!1,i=!1)=>(b1||nue(),r.schedule(n,a,i)),e},{}),tue=ib.reduce((e,t)=>(e[t]=Cw[t].cancel,e),{});ib.reduce((e,t)=>(e[t]=()=>Cw[t].process(qv),e),{});const rue=e=>Cw[e].process(qv),Gj=e=>{b1=!1,qv.delta=vP?Hj:Math.max(Math.min(e-qv.timestamp,Jse),1),qv.timestamp=e,gP=!0,ib.forEach(rue),gP=!1,b1&&(vP=!1,jj(Gj))},nue=()=>{b1=!0,vP=!0,gP||jj(Gj)},aue=()=>qv;function qj(e,t,r=0){return e-t-r}function iue(e,t,r=0,n=!0){return n?qj(t+-e,t,r):t-(e-t)+r}function oue(e,t,r,n){return n?e>=t+r:e<=-r}const sue=e=>{const t=({delta:r})=>e(r);return{start:()=>eue.update(t,!0),stop:()=>tue.update(t)}};function Wj(e){var t,r,{from:n,autoplay:a=!0,driver:i=sue,elapsed:o=0,repeat:s=0,repeatType:u="loop",repeatDelay:l=0,onPlay:c,onStop:d,onComplete:f,onRepeat:p,onUpdate:h}=e,m=kj(e,["from","autoplay","driver","elapsed","repeat","repeatType","repeatDelay","onPlay","onStop","onComplete","onRepeat","onUpdate"]);let{to:v}=m,g,y=0,b=m.duration,S,x=!1,C=!0,w;const _=$se(m);!((r=(t=_).needsInterpolation)===null||r===void 0)&&r.call(t,n,v)&&(w=Lj([0,100],[n,v],{clamp:!1}),n=0,v=100);const E=_(Object.assign(Object.assign({},m),{from:n,to:v}));function P(){y++,u==="reverse"?(C=y%2===0,o=iue(o,b,l,C)):(o=qj(o,b,l),u==="mirror"&&E.flipTarget()),x=!1,p&&p()}function D(){g.stop(),f&&f()}function k(X){if(C||(X=-X),o+=X,!x){const U=E.next(Math.max(0,o));S=U.value,w&&(S=w(S)),x=C?U.done:o<=0}h?.(S),x&&(y===0&&(b??(b=o)),y<s?oue(o,b,l,C)&&P():D())}function F(){c?.(),g=i(k),g.start()}return a&&F(),{stop:()=>{d?.(),g.stop()}}}function Xj(e,t){return t?e*(1e3/t):0}function uue({from:e=0,velocity:t=0,min:r,max:n,power:a=.8,timeConstant:i=750,bounceStiffness:o=500,bounceDamping:s=10,restDelta:u=1,modifyTarget:l,driver:c,onUpdate:d,onComplete:f,onStop:p}){let h;function m(b){return r!==void 0&&b<r||n!==void 0&&b>n}function v(b){return r===void 0?n:n===void 0||Math.abs(r-b)<Math.abs(n-b)?r:n}function g(b){h?.stop(),h=Wj(Object.assign(Object.assign({},b),{driver:c,onUpdate:S=>{var x;d?.(S),(x=b.onUpdate)===null||x===void 0||x.call(b,S)},onComplete:f,onStop:p}))}function y(b){g(Object.assign({type:"spring",stiffness:o,damping:s,restDelta:u},b))}if(m(e))y({from:e,velocity:t,to:v(e)});else{let b=a*t+e;typeof l<"u"&&(b=l(b));const S=v(b),x=S===r?-1:1;let C,w;const _=E=>{C=w,w=E,t=Xj(E-C,aue().delta),(x===1&&E>S||x===-1&&E<S)&&y({from:E,to:S,velocity:t})};g({type:"decay",from:e,velocity:t,timeConstant:i,power:a,restDelta:u,modifyTarget:l,onUpdate:m(b)?_:void 0})}return{stop:()=>h?.stop()}}const yP=e=>e.hasOwnProperty("x")&&e.hasOwnProperty("y"),bO=e=>yP(e)&&e.hasOwnProperty("z"),w2=(e,t)=>Math.abs(e-t);function xD(e,t){if(mP(e)&&mP(t))return w2(e,t);if(yP(e)&&yP(t)){const r=w2(e.x,t.x),n=w2(e.y,t.y),a=bO(e)&&bO(t)?w2(e.z,t.z):0;return Math.sqrt(Math.pow(r,2)+Math.pow(n,2)+Math.pow(a,2))}}const Yj=(e,t)=>1-3*t+3*e,Kj=(e,t)=>3*t-6*e,$j=e=>3*e,uC=(e,t,r)=>((Yj(t,r)*e+Kj(t,r))*e+$j(t))*e,Qj=(e,t,r)=>3*Yj(t,r)*e*e+2*Kj(t,r)*e+$j(t),lue=1e-7,cue=10;function due(e,t,r,n,a){let i,o,s=0;do o=t+(r-t)/2,i=uC(o,n,a)-e,i>0?r=o:t=o;while(Math.abs(i)>lue&&++s<cue);return o}const fue=8,pue=.001;function hue(e,t,r,n){for(let a=0;a<fue;++a){const i=Qj(t,r,n);if(i===0)return t;t-=(uC(t,r,n)-e)/i}return t}const tS=11,_2=1/(tS-1);function mue(e,t,r,n){if(e===t&&r===n)return vD;const a=new Float32Array(tS);for(let o=0;o<tS;++o)a[o]=uC(o*_2,e,r);function i(o){let s=0,u=1;const l=tS-1;for(;u!==l&&a[u]<=o;++u)s+=_2;--u;const c=(o-a[u])/(a[u+1]-a[u]),d=s+c*_2,f=Qj(d,e,r);return f>=pue?hue(o,d,e,r):f===0?d:due(o,s,s+_2,e,r)}return o=>o===0||o===1?o:uC(i(o),t,n)}function vue({onTap:e,onTapStart:t,onTapCancel:r,whileTap:n,visualElement:a}){const i=e||t||r||n,o=ke.exports.useRef(!1),s=ke.exports.useRef(null),u={passive:!(t||e||r||p)};function l(){s.current&&s.current(),s.current=null}function c(){return l(),o.current=!1,a.animationState&&a.animationState.setActive($n.Tap,!1),!Mj()}function d(h,m){!c()||(Dj(a.getInstance(),h.target)?e&&e(h,m):r&&r(h,m))}function f(h,m){!c()||r&&r(h,m)}function p(h,m){l(),!o.current&&(o.current=!0,s.current=xw(Gv(window,"pointerup",d,u),Gv(window,"pointercancel",f,u)),a.animationState&&a.animationState.setActive($n.Tap,!0),t&&t(h,m))}aC(a,"pointerdown",i?p:void 0,u),pD(l)}const gue="production",Zj=typeof process>"u"||process.env===void 0?gue:"production",xO=new Set;function Jj(e,t,r){e||xO.has(t)||(console.warn(t),r&&console.warn(r),xO.add(t))}const bP=new WeakMap,N4=new WeakMap,yue=e=>{const t=bP.get(e.target);t&&t(e)},bue=e=>{e.forEach(yue)};function xue({root:e,...t}){const r=e||document;N4.has(r)||N4.set(r,{});const n=N4.get(r),a=JSON.stringify(t);return n[a]||(n[a]=new IntersectionObserver(bue,{root:e,...t})),n[a]}function Sue(e,t,r){const n=xue(t);return bP.set(e,r),n.observe(e),()=>{bP.delete(e),n.unobserve(e)}}function Cue({visualElement:e,whileInView:t,onViewportEnter:r,onViewportLeave:n,viewport:a={}}){const i=ke.exports.useRef({hasEnteredView:!1,isInView:!1});let o=Boolean(t||r||n);a.once&&i.current.hasEnteredView&&(o=!1),(typeof IntersectionObserver>"u"?Aue:_ue)(o,i.current,e,a)}const wue={some:0,all:1};function _ue(e,t,r,{root:n,margin:a,amount:i="some",once:o}){ke.exports.useEffect(()=>{if(!e)return;const s={root:n?.current,rootMargin:a,threshold:typeof i=="number"?i:wue[i]},u=l=>{const{isIntersecting:c}=l;if(t.isInView===c||(t.isInView=c,o&&!c&&t.hasEnteredView))return;c&&(t.hasEnteredView=!0),r.animationState&&r.animationState.setActive($n.InView,c);const d=r.getProps(),f=c?d.onViewportEnter:d.onViewportLeave;f&&f(l)};return Sue(r.getInstance(),s,u)},[e,n,a,i])}function Aue(e,t,r,{fallback:n=!0}){ke.exports.useEffect(()=>{!e||!n||(Zj!=="production"&&Jj(!1,"IntersectionObserver not available on this device. whileInView animations will trigger on mount."),requestAnimationFrame(()=>{t.hasEnteredView=!0;const{onViewportEnter:a}=r.getProps();a&&a(null),r.animationState&&r.animationState.setActive($n.InView,!0)}))},[e])}const Vf=e=>t=>(e(t),null),Tue={inView:Vf(Cue),tap:Vf(vue),focus:Vf(tse),hover:Vf(dse)};function eG(){const e=ke.exports.useContext(D0);if(e===null)return[!0,null];const{isPresent:t,onExitComplete:r,register:n}=e,a=ke.exports.useId();return ke.exports.useEffect(()=>n(a),[]),!t&&r?[!1,()=>r&&r(a)]:[!0]}function Eue(){return Pue(ke.exports.useContext(D0))}function Pue(e){return e===null?!0:e.isPresent}function tG(e,t){if(!Array.isArray(t))return!1;const r=t.length;if(r!==e.length)return!1;for(let n=0;n<r;n++)if(t[n]!==e[n])return!1;return!0}const lC=e=>e*1e3,Iue={linear:vD,easeIn:gD,easeInOut:Uj,easeOut:Fse,circIn:Vj,circInOut:Lse,circOut:yD,backIn:bD,backInOut:zse,backOut:Nse,anticipate:Use,bounceIn:Gse,bounceInOut:qse,bounceOut:sC},SO=e=>{if(Array.isArray(e)){iC(e.length===4);const[t,r,n,a]=e;return mue(t,r,n,a)}else if(typeof e=="string")return Iue[e];return e},Mue=e=>Array.isArray(e)&&typeof e[0]!="number",CO=(e,t)=>e==="zIndex"?!1:!!(typeof t=="number"||Array.isArray(t)||typeof t=="string"&&ld.test(t)&&!t.startsWith("url(")),qp=()=>({type:"spring",stiffness:500,damping:25,restSpeed:10}),A2=e=>({type:"spring",stiffness:550,damping:e===0?2*Math.sqrt(550):30,restSpeed:10}),z4=()=>({type:"keyframes",ease:"linear",duration:.3}),Due=e=>({type:"keyframes",duration:.8,values:e}),wO={x:qp,y:qp,z:qp,rotate:qp,rotateX:qp,rotateY:qp,rotateZ:qp,scaleX:A2,scaleY:A2,scale:A2,opacity:z4,backgroundColor:z4,color:z4,default:A2},kue=(e,t)=>{let r;return g1(t)?r=Due:r=wO[e]||wO.default,{to:t,...r(t)}},Rue={...fj,color:lo,backgroundColor:lo,outlineColor:lo,fill:lo,stroke:lo,borderColor:lo,borderTopColor:lo,borderRightColor:lo,borderBottomColor:lo,borderLeftColor:lo,filter:fP,WebkitFilter:fP},SD=e=>Rue[e];function CD(e,t){var r;let n=SD(e);return n!==fP&&(n=ld),(r=n.getAnimatableNone)===null||r===void 0?void 0:r.call(n,t)}const Oue={current:!1};function Bue({when:e,delay:t,delayChildren:r,staggerChildren:n,staggerDirection:a,repeat:i,repeatType:o,repeatDelay:s,from:u,...l}){return!!Object.keys(l).length}function Fue({ease:e,times:t,yoyo:r,flip:n,loop:a,...i}){const o={...i};return t&&(o.offset=t),i.duration&&(o.duration=lC(i.duration)),i.repeatDelay&&(o.repeatDelay=lC(i.repeatDelay)),e&&(o.ease=Mue(e)?e.map(SO):SO(e)),i.type==="tween"&&(o.type="keyframes"),(r||a||n)&&(r?o.repeatType="reverse":a?o.repeatType="loop":n&&(o.repeatType="mirror"),o.repeat=a||r||n||i.repeat),i.type!=="spring"&&(o.type="keyframes"),o}function Lue(e,t){var r,n;return(n=(r=(wD(e,t)||{}).delay)!==null&&r!==void 0?r:e.delay)!==null&&n!==void 0?n:0}function Nue(e){return Array.isArray(e.to)&&e.to[0]===null&&(e.to=[...e.to],e.to[0]=e.from),e}function zue(e,t,r){return Array.isArray(t.to)&&e.duration===void 0&&(e.duration=.8),Nue(t),Bue(e)||(e={...e,...kue(r,t.to)}),{...t,...Fue(e)}}function Uue(e,t,r,n,a){const i=wD(n,e)||{};let o=i.from!==void 0?i.from:t.get();const s=CO(e,r);o==="none"&&s&&typeof r=="string"?o=CD(e,r):_O(o)&&typeof r=="string"?o=AO(r):!Array.isArray(r)&&_O(r)&&typeof o=="string"&&(r=AO(o));const u=CO(e,o);function l(){const d={from:o,to:r,velocity:t.getVelocity(),onComplete:a,onUpdate:f=>t.set(f)};return i.type==="inertia"||i.type==="decay"?uue({...d,...i}):Wj({...zue(i,d,e),onUpdate:f=>{d.onUpdate(f),i.onUpdate&&i.onUpdate(f)},onComplete:()=>{d.onComplete(),i.onComplete&&i.onComplete()}})}function c(){const d=Cj(r);return t.set(d),a(),i.onUpdate&&i.onUpdate(d),i.onComplete&&i.onComplete(),{stop:()=>{}}}return!u||!s||i.type===!1?c:l}function _O(e){return e===0||typeof e=="string"&&parseFloat(e)===0&&e.indexOf(" ")===-1}function AO(e){return typeof e=="number"?0:CD("",e)}function wD(e,t){return e[t]||e.default||e}function _D(e,t,r,n={}){return Oue.current&&(n={type:!1}),t.start(a=>{let i,o;const s=Uue(e,t,r,n,a),u=Lue(n,e),l=()=>o=s();return u?i=window.setTimeout(l,lC(u)):l(),()=>{clearTimeout(i),o&&o.stop()}})}const Vue=e=>/^\-?\d*\.?\d+$/.test(e),Hue=e=>/^0[^.\s]+$/.test(e),rG=1/60*1e3,jue=typeof performance<"u"?()=>performance.now():()=>Date.now(),nG=typeof window<"u"?e=>window.requestAnimationFrame(e):e=>setTimeout(()=>e(jue()),rG);function Gue(e){let t=[],r=[],n=0,a=!1,i=!1;const o=new WeakSet,s={schedule:(u,l=!1,c=!1)=>{const d=c&&a,f=d?t:r;return l&&o.add(u),f.indexOf(u)===-1&&(f.push(u),d&&a&&(n=t.length)),u},cancel:u=>{const l=r.indexOf(u);l!==-1&&r.splice(l,1),o.delete(u)},process:u=>{if(a){i=!0;return}if(a=!0,[t,r]=[r,t],r.length=0,n=t.length,n)for(let l=0;l<n;l++){const c=t[l];c(u),o.has(c)&&(s.schedule(c),e())}a=!1,i&&(i=!1,s.process(u))}};return s}const que=40;let xP=!0,x1=!1,SP=!1;const Wv={delta:0,timestamp:0},ob=["read","update","preRender","render","postRender"],ww=ob.reduce((e,t)=>(e[t]=Gue(()=>x1=!0),e),{}),Jl=ob.reduce((e,t)=>{const r=ww[t];return e[t]=(n,a=!1,i=!1)=>(x1||Xue(),r.schedule(n,a,i)),e},{}),S1=ob.reduce((e,t)=>(e[t]=ww[t].cancel,e),{}),U4=ob.reduce((e,t)=>(e[t]=()=>ww[t].process(Wv),e),{}),Wue=e=>ww[e].process(Wv),aG=e=>{x1=!1,Wv.delta=xP?rG:Math.max(Math.min(e-Wv.timestamp,que),1),Wv.timestamp=e,SP=!0,ob.forEach(Wue),SP=!1,x1&&(xP=!1,nG(aG))},Xue=()=>{x1=!0,xP=!0,SP||nG(aG)},CP=()=>Wv;function AD(e,t){e.indexOf(t)===-1&&e.push(t)}function TD(e,t){const r=e.indexOf(t);r>-1&&e.splice(r,1)}class wy{constructor(){this.subscriptions=[]}add(t){return AD(this.subscriptions,t),()=>TD(this.subscriptions,t)}notify(t,r,n){const a=this.subscriptions.length;if(!!a)if(a===1)this.subscriptions[0](t,r,n);else for(let i=0;i<a;i++){const o=this.subscriptions[i];o&&o(t,r,n)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const Yue=e=>!isNaN(parseFloat(e));class Kue{constructor(t){this.version="7.3.6",this.timeDelta=0,this.lastUpdated=0,this.updateSubscribers=new wy,this.velocityUpdateSubscribers=new wy,this.renderSubscribers=new wy,this.canTrackVelocity=!1,this.updateAndNotify=(r,n=!0)=>{this.prev=this.current,this.current=r;const{delta:a,timestamp:i}=CP();this.lastUpdated!==i&&(this.timeDelta=a,this.lastUpdated=i,Jl.postRender(this.scheduleVelocityCheck)),this.prev!==this.current&&this.updateSubscribers.notify(this.current),this.velocityUpdateSubscribers.getSize()&&this.velocityUpdateSubscribers.notify(this.getVelocity()),n&&this.renderSubscribers.notify(this.current)},this.scheduleVelocityCheck=()=>Jl.postRender(this.velocityCheck),this.velocityCheck=({timestamp:r})=>{r!==this.lastUpdated&&(this.prev=this.current,this.velocityUpdateSubscribers.notify(this.getVelocity()))},this.hasAnimated=!1,this.prev=this.current=t,this.canTrackVelocity=Yue(this.current)}onChange(t){return this.updateSubscribers.add(t)}clearListeners(){this.updateSubscribers.clear()}onRenderRequest(t){return t(this.get()),this.renderSubscribers.add(t)}attach(t){this.passiveEffect=t}set(t,r=!0){!r||!this.passiveEffect?this.updateAndNotify(t,r):this.passiveEffect(t,this.updateAndNotify)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){return this.canTrackVelocity?Xj(parseFloat(this.current)-parseFloat(this.prev),this.timeDelta):0}start(t){return this.stop(),new Promise(r=>{this.hasAnimated=!0,this.stopAnimation=t(r)}).then(()=>this.clearAnimation())}stop(){this.stopAnimation&&this.stopAnimation(),this.clearAnimation()}isAnimating(){return!!this.stopAnimation}clearAnimation(){this.stopAnimation=null}destroy(){this.updateSubscribers.clear(),this.renderSubscribers.clear(),this.stop()}}function d0(e){return new Kue(e)}const iG=e=>t=>t.test(e),$ue={test:e=>e==="auto",parse:e=>e},oG=[Cm,br,Zl,Sf,_oe,woe,$ue],xg=e=>oG.find(iG(e)),Que=[...oG,lo,ld],Zue=e=>Que.find(iG(e));function Jue(e){const t={};return e.forEachValue((r,n)=>t[n]=r.get()),t}function ele(e){const t={};return e.forEachValue((r,n)=>t[n]=r.getVelocity()),t}function _w(e,t,r){const n=e.getProps();return Sj(n,t,r!==void 0?r:n.custom,Jue(e),ele(e))}function tle(e,t,r){e.hasValue(t)?e.getValue(t).set(r):e.addValue(t,d0(r))}function rle(e,t){const r=_w(e,t);let{transitionEnd:n={},transition:a={},...i}=r?e.makeTargetAnimatable(r,!1):{};i={...i,...n};for(const o in i){const s=Cj(i[o]);tle(e,o,s)}}function nle(e,t,r){var n,a;const i=Object.keys(t).filter(s=>!e.hasValue(s)),o=i.length;if(!!o)for(let s=0;s<o;s++){const u=i[s],l=t[u];let c=null;Array.isArray(l)&&(c=l[0]),c===null&&(c=(a=(n=r[u])!==null&&n!==void 0?n:e.readValue(u))!==null&&a!==void 0?a:t[u]),c!=null&&(typeof c=="string"&&(Vue(c)||Hue(c))?c=parseFloat(c):!Zue(c)&&ld.test(l)&&(c=CD(u,l)),e.addValue(u,d0(c)),r[u]===void 0&&(r[u]=c),e.setBaseTarget(u,c))}}function ale(e,t){return t?(t[e]||t.default||t).from:void 0}function ile(e,t,r){var n;const a={};for(const i in e){const o=ale(i,t);a[i]=o!==void 0?o:(n=r.getValue(i))===null||n===void 0?void 0:n.get()}return a}function cC(e){return Boolean(rc(e)&&e.add)}function ole(e,t,r={}){e.notifyAnimationStart(t);let n;if(Array.isArray(t)){const a=t.map(i=>wP(e,i,r));n=Promise.all(a)}else if(typeof t=="string")n=wP(e,t,r);else{const a=typeof t=="function"?_w(e,t,r.custom):t;n=sG(e,a,r)}return n.then(()=>e.notifyAnimationComplete(t))}function wP(e,t,r={}){var n;const a=_w(e,t,r.custom);let{transition:i=e.getDefaultTransition()||{}}=a||{};r.transitionOverride&&(i=r.transitionOverride);const o=a?()=>sG(e,a,r):()=>Promise.resolve(),s=!((n=e.variantChildren)===null||n===void 0)&&n.size?(l=0)=>{const{delayChildren:c=0,staggerChildren:d,staggerDirection:f}=i;return sle(e,t,c+l,d,f,r)}:()=>Promise.resolve(),{when:u}=i;if(u){const[l,c]=u==="beforeChildren"?[o,s]:[s,o];return l().then(c)}else return Promise.all([o(),s(r.delay)])}function sG(e,t,{delay:r=0,transitionOverride:n,type:a}={}){var i;let{transition:o=e.getDefaultTransition(),transitionEnd:s,...u}=e.makeTargetAnimatable(t);const l=e.getValue("willChange");n&&(o=n);const c=[],d=a&&((i=e.animationState)===null||i===void 0?void 0:i.getState()[a]);for(const f in u){const p=e.getValue(f),h=u[f];if(!p||h===void 0||d&&lle(d,f))continue;let m={delay:r,...o};e.shouldReduceMotion&&rb.has(f)&&(m={...m,type:!1,delay:0});let v=_D(f,p,h,m);cC(l)&&(l.add(f),v=v.then(()=>l.remove(f))),c.push(v)}return Promise.all(c).then(()=>{s&&rle(e,s)})}function sle(e,t,r=0,n=0,a=1,i){const o=[],s=(e.variantChildren.size-1)*n,u=a===1?(l=0)=>l*n:(l=0)=>s-l*n;return Array.from(e.variantChildren).sort(ule).forEach((l,c)=>{o.push(wP(l,t,{...i,delay:r+u(c)}).then(()=>l.notifyAnimationComplete(t)))}),Promise.all(o)}function ule(e,t){return e.sortNodePosition(t)}function lle({protectedKeys:e,needsAnimating:t},r){const n=e.hasOwnProperty(r)&&t[r]!==!0;return t[r]=!1,n}const ED=[$n.Animate,$n.InView,$n.Focus,$n.Hover,$n.Tap,$n.Drag,$n.Exit],cle=[...ED].reverse(),dle=ED.length;function fle(e){return t=>Promise.all(t.map(({animation:r,options:n})=>ole(e,r,n)))}function ple(e){let t=fle(e);const r=mle();let n=!0;const a=(u,l)=>{const c=_w(e,l);if(c){const{transition:d,transitionEnd:f,...p}=c;u={...u,...p,...f}}return u};function i(u){t=u(e)}function o(u,l){var c;const d=e.getProps(),f=e.getVariantContext(!0)||{},p=[],h=new Set;let m={},v=1/0;for(let y=0;y<dle;y++){const b=cle[y],S=r[b],x=(c=d[b])!==null&&c!==void 0?c:f[b],C=h1(x),w=b===l?S.isActive:null;w===!1&&(v=y);let _=x===f[b]&&x!==d[b]&&C;if(_&&n&&e.manuallyAnimateOnMount&&(_=!1),S.protectedKeys={...m},!S.isActive&&w===null||!x&&!S.prevProp||vw(x)||typeof x=="boolean")continue;const E=hle(S.prevProp,x);let P=E||b===l&&S.isActive&&!_&&C||y>v&&C;const D=Array.isArray(x)?x:[x];let k=D.reduce(a,{});w===!1&&(k={});const{prevResolvedValues:F={}}=S,X={...F,...k},U=j=>{P=!0,h.delete(j),S.needsAnimating[j]=!0};for(const j in X){const te=k[j],q=F[j];m.hasOwnProperty(j)||(te!==q?g1(te)&&g1(q)?!tG(te,q)||E?U(j):S.protectedKeys[j]=!0:te!==void 0?U(j):h.add(j):te!==void 0&&h.has(j)?U(j):S.protectedKeys[j]=!0)}S.prevProp=x,S.prevResolvedValues=k,S.isActive&&(m={...m,...k}),n&&e.blockInitialAnimation&&(P=!1),P&&!_&&p.push(...D.map(j=>({animation:j,options:{type:b,...u}})))}if(h.size){const y={};h.forEach(b=>{const S=e.getBaseTarget(b);S!==void 0&&(y[b]=S)}),p.push({animation:y})}let g=Boolean(p.length);return n&&d.initial===!1&&!e.manuallyAnimateOnMount&&(g=!1),n=!1,g?t(p):Promise.resolve()}function s(u,l,c){var d;if(r[u].isActive===l)return Promise.resolve();(d=e.variantChildren)===null||d===void 0||d.forEach(p=>{var h;return(h=p.animationState)===null||h===void 0?void 0:h.setActive(u,l)}),r[u].isActive=l;const f=o(c,u);for(const p in r)r[p].protectedKeys={};return f}return{animateChanges:o,setActive:s,setAnimateFunction:i,getState:()=>r}}function hle(e,t){return typeof t=="string"?t!==e:Array.isArray(t)?!tG(t,e):!1}function Wp(e=!1){return{isActive:e,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function mle(){return{[$n.Animate]:Wp(!0),[$n.InView]:Wp(),[$n.Hover]:Wp(),[$n.Tap]:Wp(),[$n.Drag]:Wp(),[$n.Focus]:Wp(),[$n.Exit]:Wp()}}const vle={animation:Vf(({visualElement:e,animate:t})=>{e.animationState||(e.animationState=ple(e)),vw(t)&&ke.exports.useEffect(()=>t.subscribe(e),[t])}),exit:Vf(e=>{const{custom:t,visualElement:r}=e,[n,a]=eG(),i=ke.exports.useContext(D0);ke.exports.useEffect(()=>{r.isPresent=n;const o=r.animationState&&r.animationState.setActive($n.Exit,!n,{custom:i&&i.custom||t});o&&!n&&o.then(a)},[n])})};class uG{constructor(t,r,{transformPagePoint:n}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const l=H4(this.lastMoveEventInfo,this.history),c=this.startEvent!==null,d=xD(l.offset,{x:0,y:0})>=3;if(!c&&!d)return;const{point:f}=l,{timestamp:p}=CP();this.history.push({...f,timestamp:p});const{onStart:h,onMove:m}=this.handlers;c||(h&&h(this.lastMoveEvent,l),this.startEvent=this.lastMoveEvent),m&&m(this.lastMoveEvent,l)},this.handlePointerMove=(l,c)=>{if(this.lastMoveEvent=l,this.lastMoveEventInfo=V4(c,this.transformPagePoint),_j(l)&&l.buttons===0){this.handlePointerUp(l,c);return}Jl.update(this.updatePoint,!0)},this.handlePointerUp=(l,c)=>{this.end();const{onEnd:d,onSessionEnd:f}=this.handlers,p=H4(V4(c,this.transformPagePoint),this.history);this.startEvent&&d&&d(l,p),f&&f(l,p)},Aj(t)&&t.touches.length>1)return;this.handlers=r,this.transformPagePoint=n;const a=fD(t),i=V4(a,this.transformPagePoint),{point:o}=i,{timestamp:s}=CP();this.history=[{...o,timestamp:s}];const{onSessionStart:u}=r;u&&u(t,H4(i,this.history)),this.removeListeners=xw(Gv(window,"pointermove",this.handlePointerMove),Gv(window,"pointerup",this.handlePointerUp),Gv(window,"pointercancel",this.handlePointerUp))}updateHandlers(t){this.handlers=t}end(){this.removeListeners&&this.removeListeners(),S1.update(this.updatePoint)}}function V4(e,t){return t?{point:t(e.point)}:e}function TO(e,t){return{x:e.x-t.x,y:e.y-t.y}}function H4({point:e},t){return{point:e,delta:TO(e,lG(t)),offset:TO(e,gle(t)),velocity:yle(t,.1)}}function gle(e){return e[0]}function lG(e){return e[e.length-1]}function yle(e,t){if(e.length<2)return{x:0,y:0};let r=e.length-1,n=null;const a=lG(e);for(;r>=0&&(n=e[r],!(a.timestamp-n.timestamp>lC(t)));)r--;if(!n)return{x:0,y:0};const i=(a.timestamp-n.timestamp)/1e3;if(i===0)return{x:0,y:0};const o={x:(a.x-n.x)/i,y:(a.y-n.y)/i};return o.x===1/0&&(o.x=0),o.y===1/0&&(o.y=0),o}function bs(e){return e.max-e.min}function EO(e,t=0,r=.01){return xD(e,t)<r}function PO(e,t,r,n=.5){e.origin=n,e.originPoint=Ma(t.min,t.max,e.origin),e.scale=bs(r)/bs(t),(EO(e.scale,1,1e-4)||isNaN(e.scale))&&(e.scale=1),e.translate=Ma(r.min,r.max,e.origin)-e.originPoint,(EO(e.translate)||isNaN(e.translate))&&(e.translate=0)}function _y(e,t,r,n){PO(e.x,t.x,r.x,n?.originX),PO(e.y,t.y,r.y,n?.originY)}function IO(e,t,r){e.min=r.min+t.min,e.max=e.min+bs(t)}function ble(e,t,r){IO(e.x,t.x,r.x),IO(e.y,t.y,r.y)}function MO(e,t,r){e.min=t.min-r.min,e.max=e.min+bs(t)}function Ay(e,t,r){MO(e.x,t.x,r.x),MO(e.y,t.y,r.y)}function xle(e,{min:t,max:r},n){return t!==void 0&&e<t?e=n?Ma(t,e,n.min):Math.max(e,t):r!==void 0&&e>r&&(e=n?Ma(r,e,n.max):Math.min(e,r)),e}function DO(e,t,r){return{min:t!==void 0?e.min+t:void 0,max:r!==void 0?e.max+r-(e.max-e.min):void 0}}function Sle(e,{top:t,left:r,bottom:n,right:a}){return{x:DO(e.x,r,a),y:DO(e.y,t,n)}}function kO(e,t){let r=t.min-e.min,n=t.max-e.max;return t.max-t.min<e.max-e.min&&([r,n]=[n,r]),{min:r,max:n}}function Cle(e,t){return{x:kO(e.x,t.x),y:kO(e.y,t.y)}}function wle(e,t){let r=.5;const n=bs(e),a=bs(t);return a>n?r=y1(t.min,t.max-n,e.min):n>a&&(r=y1(e.min,e.max-a,t.min)),oC(0,1,r)}function _le(e,t){const r={};return t.min!==void 0&&(r.min=t.min-e.min),t.max!==void 0&&(r.max=t.max-e.min),r}const _P=.35;function Ale(e=_P){return e===!1?e=0:e===!0&&(e=_P),{x:RO(e,"left","right"),y:RO(e,"top","bottom")}}function RO(e,t,r){return{min:OO(e,t),max:OO(e,r)}}function OO(e,t){var r;return typeof e=="number"?e:(r=e[t])!==null&&r!==void 0?r:0}const BO=()=>({translate:0,scale:1,origin:0,originPoint:0}),Ty=()=>({x:BO(),y:BO()}),FO=()=>({min:0,max:0}),Ei=()=>({x:FO(),y:FO()});function Pl(e){return[e("x"),e("y")]}function cG({top:e,left:t,right:r,bottom:n}){return{x:{min:t,max:r},y:{min:e,max:n}}}function Tle({x:e,y:t}){return{top:t.min,right:e.max,bottom:t.max,left:e.min}}function Ele(e,t){if(!t)return e;const r=t({x:e.left,y:e.top}),n=t({x:e.right,y:e.bottom});return{top:r.y,left:r.x,bottom:n.y,right:n.x}}function j4(e){return e===void 0||e===1}function dG({scale:e,scaleX:t,scaleY:r}){return!j4(e)||!j4(t)||!j4(r)}function Cf(e){return dG(e)||LO(e.x)||LO(e.y)||e.z||e.rotate||e.rotateX||e.rotateY}function LO(e){return e&&e!=="0%"}function dC(e,t,r){const n=e-r,a=t*n;return r+a}function NO(e,t,r,n,a){return a!==void 0&&(e=dC(e,a,n)),dC(e,r,n)+t}function AP(e,t=0,r=1,n,a){e.min=NO(e.min,t,r,n,a),e.max=NO(e.max,t,r,n,a)}function fG(e,{x:t,y:r}){AP(e.x,t.translate,t.scale,t.originPoint),AP(e.y,r.translate,r.scale,r.originPoint)}function Ple(e,t,r,n=!1){var a,i;const o=r.length;if(!o)return;t.x=t.y=1;let s,u;for(let l=0;l<o;l++)s=r[l],u=s.projectionDelta,((i=(a=s.instance)===null||a===void 0?void 0:a.style)===null||i===void 0?void 0:i.display)!=="contents"&&(n&&s.options.layoutScroll&&s.scroll&&s!==s.root&&Iv(e,{x:-s.scroll.x,y:-s.scroll.y}),u&&(t.x*=u.x.scale,t.y*=u.y.scale,fG(e,u)),n&&Cf(s.latestValues)&&Iv(e,s.latestValues))}function Tf(e,t){e.min=e.min+t,e.max=e.max+t}function zO(e,t,[r,n,a]){const i=t[a]!==void 0?t[a]:.5,o=Ma(e.min,e.max,i);AP(e,t[r],t[n],o,t.scale)}const Ile=["x","scaleX","originX"],Mle=["y","scaleY","originY"];function Iv(e,t){zO(e.x,t,Ile),zO(e.y,t,Mle)}function pG(e,t){return cG(Ele(e.getBoundingClientRect(),t))}function Dle(e,t,r){const n=pG(e,r),{scroll:a}=t;return a&&(Tf(n.x,a.x),Tf(n.y,a.y)),n}const kle=new WeakMap;class Rle{constructor(t){this.openGlobalLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=Ei(),this.visualElement=t}start(t,{snapToCursor:r=!1}={}){if(this.visualElement.isPresent===!1)return;const n=s=>{this.stopAnimation(),r&&this.snapToCursor(fD(s,"page").point)},a=(s,u)=>{var l;const{drag:c,dragPropagation:d,onDragStart:f}=this.getProps();c&&!d&&(this.openGlobalLock&&this.openGlobalLock(),this.openGlobalLock=Ij(c),!this.openGlobalLock)||(this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Pl(p=>{var h,m;let v=this.getAxisMotionValue(p).get()||0;if(Zl.test(v)){const g=(m=(h=this.visualElement.projection)===null||h===void 0?void 0:h.layout)===null||m===void 0?void 0:m.actual[p];g&&(v=bs(g)*(parseFloat(v)/100))}this.originPoint[p]=v}),f?.(s,u),(l=this.visualElement.animationState)===null||l===void 0||l.setActive($n.Drag,!0))},i=(s,u)=>{const{dragPropagation:l,dragDirectionLock:c,onDirectionLock:d,onDrag:f}=this.getProps();if(!l&&!this.openGlobalLock)return;const{offset:p}=u;if(c&&this.currentDirection===null){this.currentDirection=Ole(p),this.currentDirection!==null&&d?.(this.currentDirection);return}this.updateAxis("x",u.point,p),this.updateAxis("y",u.point,p),this.visualElement.syncRender(),f?.(s,u)},o=(s,u)=>this.stop(s,u);this.panSession=new uG(t,{onSessionStart:n,onStart:a,onMove:i,onSessionEnd:o},{transformPagePoint:this.visualElement.getTransformPagePoint()})}stop(t,r){const n=this.isDragging;if(this.cancel(),!n)return;const{velocity:a}=r;this.startAnimation(a);const{onDragEnd:i}=this.getProps();i?.(t,r)}cancel(){var t,r;this.isDragging=!1,this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!1),(t=this.panSession)===null||t===void 0||t.end(),this.panSession=void 0;const{dragPropagation:n}=this.getProps();!n&&this.openGlobalLock&&(this.openGlobalLock(),this.openGlobalLock=null),(r=this.visualElement.animationState)===null||r===void 0||r.setActive($n.Drag,!1)}updateAxis(t,r,n){const{drag:a}=this.getProps();if(!n||!T2(t,a,this.currentDirection))return;const i=this.getAxisMotionValue(t);let o=this.originPoint[t]+n[t];this.constraints&&this.constraints[t]&&(o=xle(o,this.constraints[t],this.elastic[t])),i.set(o)}resolveConstraints(){const{dragConstraints:t,dragElastic:r}=this.getProps(),{layout:n}=this.visualElement.projection||{},a=this.constraints;t&&Pv(t)?this.constraints||(this.constraints=this.resolveRefConstraints()):t&&n?this.constraints=Sle(n.actual,t):this.constraints=!1,this.elastic=Ale(r),a!==this.constraints&&n&&this.constraints&&!this.hasMutatedConstraints&&Pl(i=>{this.getAxisMotionValue(i)&&(this.constraints[i]=_le(n.actual[i],this.constraints[i]))})}resolveRefConstraints(){const{dragConstraints:t,onMeasureDragConstraints:r}=this.getProps();if(!t||!Pv(t))return!1;const n=t.current,{projection:a}=this.visualElement;if(!a||!a.layout)return!1;const i=Dle(n,a.root,this.visualElement.getTransformPagePoint());let o=Cle(a.layout.actual,i);if(r){const s=r(Tle(o));this.hasMutatedConstraints=!!s,s&&(o=cG(s))}return o}startAnimation(t){const{drag:r,dragMomentum:n,dragElastic:a,dragTransition:i,dragSnapToOrigin:o,onDragTransitionEnd:s}=this.getProps(),u=this.constraints||{},l=Pl(c=>{var d;if(!T2(c,r,this.currentDirection))return;let f=(d=u?.[c])!==null&&d!==void 0?d:{};o&&(f={min:0,max:0});const p=a?200:1e6,h=a?40:1e7,m={type:"inertia",velocity:n?t[c]:0,bounceStiffness:p,bounceDamping:h,timeConstant:750,restDelta:1,restSpeed:10,...i,...f};return this.startAxisValueAnimation(c,m)});return Promise.all(l).then(s)}startAxisValueAnimation(t,r){const n=this.getAxisMotionValue(t);return _D(t,n,0,r)}stopAnimation(){Pl(t=>this.getAxisMotionValue(t).stop())}getAxisMotionValue(t){var r,n;const a="_drag"+t.toUpperCase(),i=this.visualElement.getProps()[a];return i||this.visualElement.getValue(t,(n=(r=this.visualElement.getProps().initial)===null||r===void 0?void 0:r[t])!==null&&n!==void 0?n:0)}snapToCursor(t){Pl(r=>{const{drag:n}=this.getProps();if(!T2(r,n,this.currentDirection))return;const{projection:a}=this.visualElement,i=this.getAxisMotionValue(r);if(a&&a.layout){const{min:o,max:s}=a.layout.actual[r];i.set(t[r]-Ma(o,s,.5))}})}scalePositionWithinConstraints(){var t;const{drag:r,dragConstraints:n}=this.getProps(),{projection:a}=this.visualElement;if(!Pv(n)||!a||!this.constraints)return;this.stopAnimation();const i={x:0,y:0};Pl(s=>{const u=this.getAxisMotionValue(s);if(u){const l=u.get();i[s]=wle({min:l,max:l},this.constraints[s])}});const{transformTemplate:o}=this.visualElement.getProps();this.visualElement.getInstance().style.transform=o?o({},""):"none",(t=a.root)===null||t===void 0||t.updateScroll(),a.updateLayout(),this.resolveConstraints(),Pl(s=>{if(!T2(s,r,null))return;const u=this.getAxisMotionValue(s),{min:l,max:c}=this.constraints[s];u.set(Ma(l,c,i[s]))})}addListeners(){var t;kle.set(this.visualElement,this);const r=this.visualElement.getInstance(),n=Gv(r,"pointerdown",l=>{const{drag:c,dragListener:d=!0}=this.getProps();c&&d&&this.start(l)}),a=()=>{const{dragConstraints:l}=this.getProps();Pv(l)&&(this.constraints=this.resolveRefConstraints())},{projection:i}=this.visualElement,o=i.addEventListener("measure",a);i&&!i.layout&&((t=i.root)===null||t===void 0||t.updateScroll(),i.updateLayout()),a();const s=bw(window,"resize",()=>this.scalePositionWithinConstraints()),u=i.addEventListener("didUpdate",({delta:l,hasLayoutChanged:c})=>{this.isDragging&&c&&(Pl(d=>{const f=this.getAxisMotionValue(d);!f||(this.originPoint[d]+=l[d].translate,f.set(f.get()+l[d].translate))}),this.visualElement.syncRender())});return()=>{s(),n(),o(),u?.()}}getProps(){const t=this.visualElement.getProps(),{drag:r=!1,dragDirectionLock:n=!1,dragPropagation:a=!1,dragConstraints:i=!1,dragElastic:o=_P,dragMomentum:s=!0}=t;return{...t,drag:r,dragDirectionLock:n,dragPropagation:a,dragConstraints:i,dragElastic:o,dragMomentum:s}}}function T2(e,t,r){return(t===!0||t===e)&&(r===null||r===e)}function Ole(e,t=10){let r=null;return Math.abs(e.y)>t?r="y":Math.abs(e.x)>t&&(r="x"),r}function Ble(e){const{dragControls:t,visualElement:r}=e,n=yw(()=>new Rle(r));ke.exports.useEffect(()=>t&&t.subscribe(n),[n,t]),ke.exports.useEffect(()=>n.addListeners(),[n])}function Fle({onPan:e,onPanStart:t,onPanEnd:r,onPanSessionStart:n,visualElement:a}){const i=e||t||r||n,o=ke.exports.useRef(null),{transformPagePoint:s}=ke.exports.useContext(aD),u={onSessionStart:n,onStart:t,onMove:e,onEnd:(c,d)=>{o.current=null,r&&r(c,d)}};ke.exports.useEffect(()=>{o.current!==null&&o.current.updateHandlers(u)});function l(c){o.current=new uG(c,u,{transformPagePoint:s})}aC(a,"pointerdown",i&&l),pD(()=>o.current&&o.current.end())}const Lle={pan:Vf(Fle),drag:Vf(Ble)},TP={current:null},hG={current:!1};function Nle(){if(hG.current=!0,!!Sm)if(window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion)"),t=()=>TP.current=e.matches;e.addListener(t),t()}else TP.current=!1}const E2=["LayoutMeasure","BeforeLayoutMeasure","LayoutUpdate","ViewportBoxUpdate","Update","Render","AnimationComplete","LayoutAnimationComplete","AnimationStart","LayoutAnimationStart","SetAxisTarget","Unmount"];function zle(){const e=E2.map(()=>new wy),t={},r={clearAllListeners:()=>e.forEach(n=>n.clear()),updatePropListeners:n=>{E2.forEach(a=>{var i;const o="on"+a,s=n[o];(i=t[a])===null||i===void 0||i.call(t),s&&(t[a]=r[o](s))})}};return e.forEach((n,a)=>{r["on"+E2[a]]=i=>n.add(i),r["notify"+E2[a]]=(...i)=>n.notify(...i)}),r}function Ule(e,t,r){const{willChange:n}=t;for(const a in t){const i=t[a],o=r[a];if(rc(i))e.addValue(a,i),cC(n)&&n.add(a);else if(rc(o))e.addValue(a,d0(i)),cC(n)&&n.remove(a);else if(o!==i)if(e.hasValue(a)){const s=e.getValue(a);!s.hasAnimated&&s.set(i)}else{const s=e.getStaticValue(a);e.addValue(a,d0(s!==void 0?s:i))}}for(const a in r)t[a]===void 0&&e.removeValue(a);return t}const mG=Object.keys(m1),Vle=mG.length,vG=({treeType:e="",build:t,getBaseTarget:r,makeTargetAnimatable:n,measureViewportBox:a,render:i,readValueFromInstance:o,removeValueFromRenderState:s,sortNodePosition:u,scrapeMotionValuesFromProps:l})=>({parent:c,props:d,presenceId:f,blockInitialAnimation:p,visualState:h,reducedMotionConfig:m},v={})=>{let g=!1;const{latestValues:y,renderState:b}=h;let S;const x=zle(),C=new Map,w=new Map;let _={};const E={...y};let P;function D(){!S||!g||(k(),i(S,b,d.style,W.projection))}function k(){t(W,b,y,v,d)}function F(){x.notifyUpdate(y)}function X(V,ee){const ue=ee.onChange(Q=>{y[V]=Q,d.onUpdate&&Jl.update(F,!1,!0)}),$=ee.onRenderRequest(W.scheduleRender);w.set(V,()=>{ue(),$()})}const{willChange:U,...j}=l(d);for(const V in j){const ee=j[V];y[V]!==void 0&&rc(ee)&&(ee.set(y[V],!1),cC(U)&&U.add(V))}const te=gw(d),q=tj(d),W={treeType:e,current:null,depth:c?c.depth+1:0,parent:c,children:new Set,presenceId:f,shouldReduceMotion:null,variantChildren:q?new Set:void 0,isVisible:void 0,manuallyAnimateOnMount:Boolean(c?.isMounted()),blockInitialAnimation:p,isMounted:()=>Boolean(S),mount(V){g=!0,S=W.current=V,W.projection&&W.projection.mount(V),q&&c&&!te&&(P=c?.addVariantChild(W)),C.forEach((ee,ue)=>X(ue,ee)),hG.current||Nle(),W.shouldReduceMotion=m==="never"?!1:m==="always"?!0:TP.current,c?.children.add(W),W.setProps(d)},unmount(){var V;(V=W.projection)===null||V===void 0||V.unmount(),S1.update(F),S1.render(D),w.forEach(ee=>ee()),P?.(),c?.children.delete(W),x.clearAllListeners(),S=void 0,g=!1},loadFeatures(V,ee,ue,$,Q,R){const Y=[];for(let re=0;re<Vle;re++){const K=mG[re],{isEnabled:L,Component:H}=m1[K];L(V)&&H&&Y.push(ke.exports.createElement(H,{key:K,...V,visualElement:W}))}if(!W.projection&&Q){W.projection=new Q($,W.getLatestValues(),c&&c.projection);const{layoutId:re,layout:K,drag:L,dragConstraints:H,layoutScroll:Z}=V;W.projection.setOptions({layoutId:re,layout:K,alwaysMeasureLayout:Boolean(L)||H&&Pv(H),visualElement:W,scheduleRender:()=>W.scheduleRender(),animationType:typeof K=="string"?K:"both",initialPromotionConfig:R,layoutScroll:Z})}return Y},addVariantChild(V){var ee;const ue=W.getClosestVariantNode();if(ue)return(ee=ue.variantChildren)===null||ee===void 0||ee.add(V),()=>ue.variantChildren.delete(V)},sortNodePosition(V){return!u||e!==V.treeType?0:u(W.getInstance(),V.getInstance())},getClosestVariantNode:()=>q?W:c?.getClosestVariantNode(),getLayoutId:()=>d.layoutId,getInstance:()=>S,getStaticValue:V=>y[V],setStaticValue:(V,ee)=>y[V]=ee,getLatestValues:()=>y,setVisibility(V){W.isVisible!==V&&(W.isVisible=V,W.scheduleRender())},makeTargetAnimatable(V,ee=!0){return n(W,V,d,ee)},measureViewportBox(){return a(S,d)},addValue(V,ee){W.hasValue(V)&&W.removeValue(V),C.set(V,ee),y[V]=ee.get(),X(V,ee)},removeValue(V){var ee;C.delete(V),(ee=w.get(V))===null||ee===void 0||ee(),w.delete(V),delete y[V],s(V,b)},hasValue:V=>C.has(V),getValue(V,ee){let ue=C.get(V);return ue===void 0&&ee!==void 0&&(ue=d0(ee),W.addValue(V,ue)),ue},forEachValue:V=>C.forEach(V),readValue:V=>y[V]!==void 0?y[V]:o(S,V,v),setBaseTarget(V,ee){E[V]=ee},getBaseTarget(V){if(r){const ee=r(d,V);if(ee!==void 0&&!rc(ee))return ee}return E[V]},...x,build(){return k(),b},scheduleRender(){Jl.render(D,!1,!0)},syncRender:D,setProps(V){(V.transformTemplate||d.transformTemplate)&&W.scheduleRender(),d=V,x.updatePropListeners(V),_=Ule(W,l(d),_)},getProps:()=>d,getVariant:V=>{var ee;return(ee=d.variants)===null||ee===void 0?void 0:ee[V]},getDefaultTransition:()=>d.transition,getTransformPagePoint:()=>d.transformPagePoint,getVariantContext(V=!1){if(V)return c?.getVariantContext();if(!te){const ue=c?.getVariantContext()||{};return d.initial!==void 0&&(ue.initial=d.initial),ue}const ee={};for(let ue=0;ue<Hle;ue++){const $=gG[ue],Q=d[$];(h1(Q)||Q===!1)&&(ee[$]=Q)}return ee}};return W},gG=["initial",...ED],Hle=gG.length;function EP(e){return typeof e=="string"&&e.startsWith("var(--")}const yG=/var\((--[a-zA-Z0-9-_]+),? ?([a-zA-Z0-9 ()%#.,-]+)?\)/;function jle(e){const t=yG.exec(e);if(!t)return[,];const[,r,n]=t;return[r,n]}function PP(e,t,r=1){const[n,a]=jle(e);if(!n)return;const i=window.getComputedStyle(t).getPropertyValue(n);return i?i.trim():EP(a)?PP(a,t,r+1):a}function Gle(e,{...t},r){const n=e.getInstance();if(!(n instanceof Element))return{target:t,transitionEnd:r};r&&(r={...r}),e.forEachValue(a=>{const i=a.get();if(!EP(i))return;const o=PP(i,n);o&&a.set(o)});for(const a in t){const i=t[a];if(!EP(i))continue;const o=PP(i,n);!o||(t[a]=o,r&&r[a]===void 0&&(r[a]=i))}return{target:t,transitionEnd:r}}const qle=new Set(["width","height","top","left","right","bottom","x","y"]),bG=e=>qle.has(e),Wle=e=>Object.keys(e).some(bG),xG=(e,t)=>{e.set(t,!1),e.set(t)},UO=e=>e===Cm||e===br;var VO;(function(e){e.width="width",e.height="height",e.left="left",e.right="right",e.top="top",e.bottom="bottom"})(VO||(VO={}));const HO=(e,t)=>parseFloat(e.split(", ")[t]),jO=(e,t)=>(r,{transform:n})=>{if(n==="none"||!n)return 0;const a=n.match(/^matrix3d\((.+)\)$/);if(a)return HO(a[1],t);{const i=n.match(/^matrix\((.+)\)$/);return i?HO(i[1],e):0}},Xle=new Set(["x","y","z"]),Yle=rC.filter(e=>!Xle.has(e));function Kle(e){const t=[];return Yle.forEach(r=>{const n=e.getValue(r);n!==void 0&&(t.push([r,n.get()]),n.set(r.startsWith("scale")?1:0))}),t.length&&e.syncRender(),t}const GO={width:({x:e},{paddingLeft:t="0",paddingRight:r="0"})=>e.max-e.min-parseFloat(t)-parseFloat(r),height:({y:e},{paddingTop:t="0",paddingBottom:r="0"})=>e.max-e.min-parseFloat(t)-parseFloat(r),top:(e,{top:t})=>parseFloat(t),left:(e,{left:t})=>parseFloat(t),bottom:({y:e},{top:t})=>parseFloat(t)+(e.max-e.min),right:({x:e},{left:t})=>parseFloat(t)+(e.max-e.min),x:jO(4,13),y:jO(5,14)},$le=(e,t,r)=>{const n=t.measureViewportBox(),a=t.getInstance(),i=getComputedStyle(a),{display:o}=i,s={};o==="none"&&t.setStaticValue("display",e.display||"block"),r.forEach(l=>{s[l]=GO[l](n,i)}),t.syncRender();const u=t.measureViewportBox();return r.forEach(l=>{const c=t.getValue(l);xG(c,s[l]),e[l]=GO[l](u,i)}),e},Qle=(e,t,r={},n={})=>{t={...t},n={...n};const a=Object.keys(t).filter(bG);let i=[],o=!1;const s=[];if(a.forEach(u=>{const l=e.getValue(u);if(!e.hasValue(u))return;let c=r[u],d=xg(c);const f=t[u];let p;if(g1(f)){const h=f.length,m=f[0]===null?1:0;c=f[m],d=xg(c);for(let v=m;v<h;v++)p?iC(xg(f[v])===p):p=xg(f[v])}else p=xg(f);if(d!==p)if(UO(d)&&UO(p)){const h=l.get();typeof h=="string"&&l.set(parseFloat(h)),typeof f=="string"?t[u]=parseFloat(f):Array.isArray(f)&&p===br&&(t[u]=f.map(parseFloat))}else d?.transform&&p?.transform&&(c===0||f===0)?c===0?l.set(p.transform(c)):t[u]=d.transform(f):(o||(i=Kle(e),o=!0),s.push(u),n[u]=n[u]!==void 0?n[u]:t[u],xG(l,f))}),s.length){const u=s.indexOf("height")>=0?window.pageYOffset:null,l=$le(t,e,s);return i.length&&i.forEach(([c,d])=>{e.getValue(c).set(d)}),e.syncRender(),Sm&&u!==null&&window.scrollTo({top:u}),{target:l,transitionEnd:n}}else return{target:t,transitionEnd:n}};function Zle(e,t,r,n){return Wle(t)?Qle(e,t,r,n):{target:t,transitionEnd:n}}const Jle=(e,t,r,n)=>{const a=Gle(e,t,n);return t=a.target,n=a.transitionEnd,Zle(e,t,r,n)};function ece(e){return window.getComputedStyle(e)}const SG={treeType:"dom",readValueFromInstance(e,t){if(rb.has(t)){const r=SD(t);return r&&r.default||0}else{const r=ece(e),n=(aj(t)?r.getPropertyValue(t):r[t])||0;return typeof n=="string"?n.trim():n}},sortNodePosition(e,t){return e.compareDocumentPosition(t)&2?1:-1},getBaseTarget(e,t){var r;return(r=e.style)===null||r===void 0?void 0:r[t]},measureViewportBox(e,{transformPagePoint:t}){return pG(e,t)},resetTransform(e,t,r){const{transformTemplate:n}=r;t.style.transform=n?n({},""):"none",e.scheduleRender()},restoreTransform(e,t){e.style.transform=t.style.transform},removeValueFromRenderState(e,{vars:t,style:r}){delete t[e],delete r[e]},makeTargetAnimatable(e,{transition:t,transitionEnd:r,...n},{transformValues:a},i=!0){let o=ile(n,t||{},e);if(a&&(r&&(r=a(r)),n&&(n=a(n)),o&&(o=a(o))),i){nle(e,n,o);const s=Jle(e,n,o,r);r=s.transitionEnd,n=s.target}return{transition:t,transitionEnd:r,...n}},scrapeMotionValuesFromProps:dD,build(e,t,r,n,a){e.isVisible!==void 0&&(t.style.visibility=e.isVisible?"visible":"hidden"),uD(t,r,n,a.transformTemplate)},render:gj},tce=vG(SG),rce=vG({...SG,getBaseTarget(e,t){return e[t]},readValueFromInstance(e,t){var r;return rb.has(t)?((r=SD(t))===null||r===void 0?void 0:r.default)||0:(t=yj.has(t)?t:vj(t),e.getAttribute(t))},scrapeMotionValuesFromProps:xj,build(e,t,r,n,a){cD(t,r,n,a.transformTemplate)},render:bj}),nce=(e,t)=>oD(e)?rce(t,{enableHardwareAcceleration:!1}):tce(t,{enableHardwareAcceleration:!0});function qO(e,t){return t.max===t.min?0:e/(t.max-t.min)*100}const Sg={correct:(e,t)=>{if(!t.target)return e;if(typeof e=="string")if(br.test(e))e=parseFloat(e);else return e;const r=qO(e,t.target.x),n=qO(e,t.target.y);return`${r}% ${n}%`}},WO="_$css",ace={correct:(e,{treeScale:t,projectionDelta:r})=>{const n=e,a=e.includes("var("),i=[];a&&(e=e.replace(yG,p=>(i.push(p),WO)));const o=ld.parse(e);if(o.length>5)return n;const s=ld.createTransformer(e),u=typeof o[0]!="number"?1:0,l=r.x.scale*t.x,c=r.y.scale*t.y;o[0+u]/=l,o[1+u]/=c;const d=Ma(l,c,.5);typeof o[2+u]=="number"&&(o[2+u]/=d),typeof o[3+u]=="number"&&(o[3+u]/=d);let f=s(o);if(a){let p=0;f=f.replace(WO,()=>{const h=i[p];return p++,h})}return f}};class ice extends sa.Component{componentDidMount(){const{visualElement:t,layoutGroup:r,switchLayoutGroup:n,layoutId:a}=this.props,{projection:i}=t;goe(sce),i&&(r.group&&r.group.add(i),n&&n.register&&a&&n.register(i),i.root.didUpdate(),i.addEventListener("animationComplete",()=>{this.safeToRemove()}),i.setOptions({...i.options,onExitComplete:()=>this.safeToRemove()})),xy.hasEverUpdated=!0}getSnapshotBeforeUpdate(t){const{layoutDependency:r,visualElement:n,drag:a,isPresent:i}=this.props,o=n.projection;return o&&(o.isPresent=i,a||t.layoutDependency!==r||r===void 0?o.willUpdate():this.safeToRemove(),t.isPresent!==i&&(i?o.promote():o.relegate()||Jl.postRender(()=>{var s;!((s=o.getStack())===null||s===void 0)&&s.members.length||this.safeToRemove()}))),null}componentDidUpdate(){const{projection:t}=this.props.visualElement;t&&(t.root.didUpdate(),!t.currentAnimation&&t.isLead()&&this.safeToRemove())}componentWillUnmount(){const{visualElement:t,layoutGroup:r,switchLayoutGroup:n}=this.props,{projection:a}=t;a&&(a.scheduleCheckAfterUnmount(),r?.group&&r.group.remove(a),n?.deregister&&n.deregister(a))}safeToRemove(){const{safeToRemove:t}=this.props;t?.()}render(){return null}}function oce(e){const[t,r]=eG(),n=ke.exports.useContext(iD);return B(ice,{...e,layoutGroup:n,switchLayoutGroup:ke.exports.useContext(rj),isPresent:t,safeToRemove:r})}const sce={borderRadius:{...Sg,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:Sg,borderTopRightRadius:Sg,borderBottomLeftRadius:Sg,borderBottomRightRadius:Sg,boxShadow:ace},uce={measureLayout:oce};function lce(e,t,r={}){const n=rc(e)?e:d0(e);return _D("",n,t,r),{stop:()=>n.stop(),isAnimating:()=>n.isAnimating()}}const CG=["TopLeft","TopRight","BottomLeft","BottomRight"],cce=CG.length,XO=e=>typeof e=="string"?parseFloat(e):e,YO=e=>typeof e=="number"||br.test(e);function dce(e,t,r,n,a,i){var o,s,u,l;a?(e.opacity=Ma(0,(o=r.opacity)!==null&&o!==void 0?o:1,fce(n)),e.opacityExit=Ma((s=t.opacity)!==null&&s!==void 0?s:1,0,pce(n))):i&&(e.opacity=Ma((u=t.opacity)!==null&&u!==void 0?u:1,(l=r.opacity)!==null&&l!==void 0?l:1,n));for(let c=0;c<cce;c++){const d=`border${CG[c]}Radius`;let f=KO(t,d),p=KO(r,d);if(f===void 0&&p===void 0)continue;f||(f=0),p||(p=0),f===0||p===0||YO(f)===YO(p)?(e[d]=Math.max(Ma(XO(f),XO(p),n),0),(Zl.test(p)||Zl.test(f))&&(e[d]+="%")):e[d]=p}(t.rotate||r.rotate)&&(e.rotate=Ma(t.rotate||0,r.rotate||0,n))}function KO(e,t){var r;return(r=e[t])!==null&&r!==void 0?r:e.borderRadius}const fce=wG(0,.5,yD),pce=wG(.5,.95,vD);function wG(e,t,r){return n=>n<e?0:n>t?1:r(y1(e,t,n))}function $O(e,t){e.min=t.min,e.max=t.max}function Pu(e,t){$O(e.x,t.x),$O(e.y,t.y)}function QO(e,t,r,n,a){return e-=t,e=dC(e,1/r,n),a!==void 0&&(e=dC(e,1/a,n)),e}function hce(e,t=0,r=1,n=.5,a,i=e,o=e){if(Zl.test(t)&&(t=parseFloat(t),t=Ma(o.min,o.max,t/100)-o.min),typeof t!="number")return;let s=Ma(i.min,i.max,n);e===i&&(s-=t),e.min=QO(e.min,t,r,s,a),e.max=QO(e.max,t,r,s,a)}function ZO(e,t,[r,n,a],i,o){hce(e,t[r],t[n],t[a],t.scale,i,o)}const mce=["x","scaleX","originX"],vce=["y","scaleY","originY"];function JO(e,t,r,n){ZO(e.x,t,mce,r?.x,n?.x),ZO(e.y,t,vce,r?.y,n?.y)}function eB(e){return e.translate===0&&e.scale===1}function _G(e){return eB(e.x)&&eB(e.y)}function AG(e,t){return e.x.min===t.x.min&&e.x.max===t.x.max&&e.y.min===t.y.min&&e.y.max===t.y.max}function tB(e){return bs(e.x)/bs(e.y)}function gce(e,t,r=.1){return xD(e,t)<=r}class yce{constructor(){this.members=[]}add(t){AD(this.members,t),t.scheduleRender()}remove(t){if(TD(this.members,t),t===this.prevLead&&(this.prevLead=void 0),t===this.lead){const r=this.members[this.members.length-1];r&&this.promote(r)}}relegate(t){const r=this.members.findIndex(a=>t===a);if(r===0)return!1;let n;for(let a=r;a>=0;a--){const i=this.members[a];if(i.isPresent!==!1){n=i;break}}return n?(this.promote(n),!0):!1}promote(t,r){var n;const a=this.lead;if(t!==a&&(this.prevLead=a,this.lead=t,t.show(),a)){a.instance&&a.scheduleRender(),t.scheduleRender(),t.resumeFrom=a,r&&(t.resumeFrom.preserveOpacity=!0),a.snapshot&&(t.snapshot=a.snapshot,t.snapshot.latestValues=a.animationValues||a.latestValues,t.snapshot.isShared=!0),!((n=t.root)===null||n===void 0)&&n.isUpdating&&(t.isLayoutDirty=!0);const{crossfade:i}=t.options;i===!1&&a.hide()}}exitAnimationComplete(){this.members.forEach(t=>{var r,n,a,i,o;(n=(r=t.options).onExitComplete)===null||n===void 0||n.call(r),(o=(a=t.resumingFrom)===null||a===void 0?void 0:(i=a.options).onExitComplete)===null||o===void 0||o.call(i)})}scheduleRender(){this.members.forEach(t=>{t.instance&&t.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}const bce="translate3d(0px, 0px, 0) scale(1, 1) scale(1, 1)";function rB(e,t,r){const n=e.x.translate/t.x,a=e.y.translate/t.y;let i=`translate3d(${n}px, ${a}px, 0) `;if(i+=`scale(${1/t.x}, ${1/t.y}) `,r){const{rotate:u,rotateX:l,rotateY:c}=r;u&&(i+=`rotate(${u}deg) `),l&&(i+=`rotateX(${l}deg) `),c&&(i+=`rotateY(${c}deg) `)}const o=e.x.scale*t.x,s=e.y.scale*t.y;return i+=`scale(${o}, ${s})`,i===bce?"none":i}const xce=(e,t)=>e.depth-t.depth;class Sce{constructor(){this.children=[],this.isDirty=!1}add(t){AD(this.children,t),this.isDirty=!0}remove(t){TD(this.children,t),this.isDirty=!0}forEach(t){this.isDirty&&this.children.sort(xce),this.isDirty=!1,this.children.forEach(t)}}const nB=["","X","Y","Z"],aB=1e3;function TG({attachResizeListener:e,defaultParent:t,measureScroll:r,checkIsScrollRoot:n,resetTransform:a}){return class{constructor(o,s={},u=t?.()){this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.potentialNodes=new Map,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.nodes.forEach(Ece),this.nodes.forEach(Pce)},this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.id=o,this.latestValues=s,this.root=u?u.root||u:this,this.path=u?[...u.path,u]:[],this.parent=u,this.depth=u?u.depth+1:0,o&&this.root.registerPotentialNode(o,this);for(let l=0;l<this.path.length;l++)this.path[l].shouldResetTransform=!0;this.root===this&&(this.nodes=new Sce)}addEventListener(o,s){return this.eventHandlers.has(o)||this.eventHandlers.set(o,new wy),this.eventHandlers.get(o).add(s)}notifyListeners(o,...s){const u=this.eventHandlers.get(o);u?.notify(...s)}hasListeners(o){return this.eventHandlers.has(o)}registerPotentialNode(o,s){this.potentialNodes.set(o,s)}mount(o,s=!1){var u;if(this.instance)return;this.isSVG=o instanceof SVGElement&&o.tagName!=="svg",this.instance=o;const{layoutId:l,layout:c,visualElement:d}=this.options;if(d&&!d.getInstance()&&d.mount(o),this.root.nodes.add(this),(u=this.parent)===null||u===void 0||u.children.add(this),this.id&&this.root.potentialNodes.delete(this.id),s&&(c||l)&&(this.isLayoutDirty=!0),e){let f;const p=()=>this.root.updateBlockedByResize=!1;e(o,()=>{this.root.updateBlockedByResize=!0,clearTimeout(f),f=window.setTimeout(p,250),xy.hasAnimatedSinceResize&&(xy.hasAnimatedSinceResize=!1,this.nodes.forEach(Tce))})}l&&this.root.registerSharedNode(l,this),this.options.animate!==!1&&d&&(l||c)&&this.addEventListener("didUpdate",({delta:f,hasLayoutChanged:p,hasRelativeTargetChanged:h,layout:m})=>{var v,g,y,b,S;if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const x=(g=(v=this.options.transition)!==null&&v!==void 0?v:d.getDefaultTransition())!==null&&g!==void 0?g:Rce,{onLayoutAnimationStart:C,onLayoutAnimationComplete:w}=d.getProps(),_=!this.targetLayout||!AG(this.targetLayout,m)||h,E=!p&&h;if(((y=this.resumeFrom)===null||y===void 0?void 0:y.instance)||E||p&&(_||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(f,E);const P={...wD(x,"layout"),onPlay:C,onComplete:w};d.shouldReduceMotion&&(P.delay=0,P.type=!1),this.startAnimation(P)}else!p&&this.animationProgress===0&&this.finishAnimation(),this.isLead()&&((S=(b=this.options).onExitComplete)===null||S===void 0||S.call(b));this.targetLayout=m})}unmount(){var o,s;this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this),(o=this.getStack())===null||o===void 0||o.remove(this),(s=this.parent)===null||s===void 0||s.children.delete(this),this.instance=void 0,S1.preRender(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){var o;return this.isAnimationBlocked||((o=this.parent)===null||o===void 0?void 0:o.isTreeAnimationBlocked())||!1}startUpdate(){var o;this.isUpdateBlocked()||(this.isUpdating=!0,(o=this.nodes)===null||o===void 0||o.forEach(Ice))}willUpdate(o=!0){var s,u,l;if(this.root.isUpdateBlocked()){(u=(s=this.options).onExitComplete)===null||u===void 0||u.call(s);return}if(!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let p=0;p<this.path.length;p++){const h=this.path[p];h.shouldResetTransform=!0,h.updateScroll()}const{layoutId:c,layout:d}=this.options;if(c===void 0&&!d)return;const f=(l=this.options.visualElement)===null||l===void 0?void 0:l.getProps().transformTemplate;this.prevTransformTemplateValue=f?.(this.latestValues,""),this.updateSnapshot(),o&&this.notifyListeners("willUpdate")}didUpdate(){if(this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(iB);return}!this.isUpdating||(this.isUpdating=!1,this.potentialNodes.size&&(this.potentialNodes.forEach(Oce),this.potentialNodes.clear()),this.nodes.forEach(Ace),this.nodes.forEach(Cce),this.nodes.forEach(wce),this.clearAllSnapshots(),U4.update(),U4.preRender(),U4.render())}clearAllSnapshots(){this.nodes.forEach(_ce),this.sharedNodes.forEach(Mce)}scheduleUpdateProjection(){Jl.preRender(this.updateProjection,!1,!0)}scheduleCheckAfterUnmount(){Jl.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){if(this.snapshot||!this.instance)return;const o=this.measure(),s=this.removeTransform(this.removeElementScroll(o));lB(s),this.snapshot={measured:o,layout:s,latestValues:{}}}updateLayout(){var o;if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let l=0;l<this.path.length;l++)this.path[l].updateScroll();const s=this.measure();lB(s);const u=this.layout;this.layout={measured:s,actual:this.removeElementScroll(s)},this.layoutCorrected=Ei(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.actual),(o=this.options.visualElement)===null||o===void 0||o.notifyLayoutMeasure(this.layout.actual,u?.actual)}updateScroll(){this.options.layoutScroll&&this.instance&&(this.isScrollRoot=n(this.instance),this.scroll=r(this.instance))}resetTransform(){var o;if(!a)return;const s=this.isLayoutDirty||this.shouldResetTransform,u=this.projectionDelta&&!_G(this.projectionDelta),l=(o=this.options.visualElement)===null||o===void 0?void 0:o.getProps().transformTemplate,c=l?.(this.latestValues,""),d=c!==this.prevTransformTemplateValue;s&&(u||Cf(this.latestValues)||d)&&(a(this.instance,c),this.shouldResetTransform=!1,this.scheduleRender())}measure(){const{visualElement:o}=this.options;if(!o)return Ei();const s=o.measureViewportBox(),{scroll:u}=this.root;return u&&(Tf(s.x,u.x),Tf(s.y,u.y)),s}removeElementScroll(o){const s=Ei();Pu(s,o);for(let u=0;u<this.path.length;u++){const l=this.path[u],{scroll:c,options:d,isScrollRoot:f}=l;if(l!==this.root&&c&&d.layoutScroll){if(f){Pu(s,o);const{scroll:p}=this.root;p&&(Tf(s.x,-p.x),Tf(s.y,-p.y))}Tf(s.x,c.x),Tf(s.y,c.y)}}return s}applyTransform(o,s=!1){const u=Ei();Pu(u,o);for(let l=0;l<this.path.length;l++){const c=this.path[l];!s&&c.options.layoutScroll&&c.scroll&&c!==c.root&&Iv(u,{x:-c.scroll.x,y:-c.scroll.y}),Cf(c.latestValues)&&Iv(u,c.latestValues)}return Cf(this.latestValues)&&Iv(u,this.latestValues),u}removeTransform(o){var s;const u=Ei();Pu(u,o);for(let l=0;l<this.path.length;l++){const c=this.path[l];if(!c.instance||!Cf(c.latestValues))continue;dG(c.latestValues)&&c.updateSnapshot();const d=Ei(),f=c.measure();Pu(d,f),JO(u,c.latestValues,(s=c.snapshot)===null||s===void 0?void 0:s.layout,d)}return Cf(this.latestValues)&&JO(u,this.latestValues),u}setTargetDelta(o){this.targetDelta=o,this.root.scheduleUpdateProjection()}setOptions(o){this.options={...this.options,...o,crossfade:o.crossfade!==void 0?o.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}resolveTargetDelta(){var o;const{layout:s,layoutId:u}=this.options;!this.layout||!(s||u)||(!this.targetDelta&&!this.relativeTarget&&(this.relativeParent=this.getClosestProjectingParent(),this.relativeParent&&this.relativeParent.layout&&(this.relativeTarget=Ei(),this.relativeTargetOrigin=Ei(),Ay(this.relativeTargetOrigin,this.layout.actual,this.relativeParent.layout.actual),Pu(this.relativeTarget,this.relativeTargetOrigin))),!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=Ei(),this.targetWithTransforms=Ei()),this.relativeTarget&&this.relativeTargetOrigin&&((o=this.relativeParent)===null||o===void 0?void 0:o.target)?ble(this.target,this.relativeTarget,this.relativeParent.target):this.targetDelta?(Boolean(this.resumingFrom)?this.target=this.applyTransform(this.layout.actual):Pu(this.target,this.layout.actual),fG(this.target,this.targetDelta)):Pu(this.target,this.layout.actual),this.attemptToResolveRelativeTarget&&(this.attemptToResolveRelativeTarget=!1,this.relativeParent=this.getClosestProjectingParent(),this.relativeParent&&Boolean(this.relativeParent.resumingFrom)===Boolean(this.resumingFrom)&&!this.relativeParent.options.layoutScroll&&this.relativeParent.target&&(this.relativeTarget=Ei(),this.relativeTargetOrigin=Ei(),Ay(this.relativeTargetOrigin,this.target,this.relativeParent.target),Pu(this.relativeTarget,this.relativeTargetOrigin)))))}getClosestProjectingParent(){if(!(!this.parent||Cf(this.parent.latestValues)))return(this.parent.relativeTarget||this.parent.targetDelta)&&this.parent.layout?this.parent:this.parent.getClosestProjectingParent()}calcProjection(){var o;const{layout:s,layoutId:u}=this.options;if(this.isTreeAnimating=Boolean(((o=this.parent)===null||o===void 0?void 0:o.isTreeAnimating)||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(s||u))return;const l=this.getLead();Pu(this.layoutCorrected,this.layout.actual),Ple(this.layoutCorrected,this.treeScale,this.path,Boolean(this.resumingFrom)||this!==l);const{target:c}=l;if(!c)return;this.projectionDelta||(this.projectionDelta=Ty(),this.projectionDeltaWithTransform=Ty());const d=this.treeScale.x,f=this.treeScale.y,p=this.projectionTransform;_y(this.projectionDelta,this.layoutCorrected,c,this.latestValues),this.projectionTransform=rB(this.projectionDelta,this.treeScale),(this.projectionTransform!==p||this.treeScale.x!==d||this.treeScale.y!==f)&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",c))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(o=!0){var s,u,l;(u=(s=this.options).scheduleRender)===null||u===void 0||u.call(s),o&&((l=this.getStack())===null||l===void 0||l.scheduleRender()),this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}setAnimationOrigin(o,s=!1){var u;const l=this.snapshot,c=l?.latestValues||{},d={...this.latestValues},f=Ty();this.relativeTarget=this.relativeTargetOrigin=void 0,this.attemptToResolveRelativeTarget=!s;const p=Ei(),h=l?.isShared,m=(((u=this.getStack())===null||u===void 0?void 0:u.members.length)||0)<=1,v=Boolean(h&&!m&&this.options.crossfade===!0&&!this.path.some(kce));this.animationProgress=0,this.mixTargetDelta=g=>{var y;const b=g/1e3;oB(f.x,o.x,b),oB(f.y,o.y,b),this.setTargetDelta(f),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&((y=this.relativeParent)===null||y===void 0?void 0:y.layout)&&(Ay(p,this.layout.actual,this.relativeParent.layout.actual),Dce(this.relativeTarget,this.relativeTargetOrigin,p,b)),h&&(this.animationValues=d,dce(d,c,this.latestValues,b,v,m)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=b},this.mixTargetDelta(0)}startAnimation(o){var s,u;this.notifyListeners("animationStart"),(s=this.currentAnimation)===null||s===void 0||s.stop(),this.resumingFrom&&((u=this.resumingFrom.currentAnimation)===null||u===void 0||u.stop()),this.pendingAnimation&&(S1.update(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Jl.update(()=>{xy.hasAnimatedSinceResize=!0,this.currentAnimation=lce(0,aB,{...o,onUpdate:l=>{var c;this.mixTargetDelta(l),(c=o.onUpdate)===null||c===void 0||c.call(o,l)},onComplete:()=>{var l;(l=o.onComplete)===null||l===void 0||l.call(o),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){var o;this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0),(o=this.getStack())===null||o===void 0||o.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){var o;this.currentAnimation&&((o=this.mixTargetDelta)===null||o===void 0||o.call(this,aB),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const o=this.getLead();let{targetWithTransforms:s,target:u,layout:l,latestValues:c}=o;if(!(!s||!u||!l)){if(this!==o&&this.layout&&l&&EG(this.options.animationType,this.layout.actual,l.actual)){u=this.target||Ei();const d=bs(this.layout.actual.x);u.x.min=o.target.x.min,u.x.max=u.x.min+d;const f=bs(this.layout.actual.y);u.y.min=o.target.y.min,u.y.max=u.y.min+f}Pu(s,u),Iv(s,c),_y(this.projectionDeltaWithTransform,this.layoutCorrected,s,c)}}registerSharedNode(o,s){var u,l,c;this.sharedNodes.has(o)||this.sharedNodes.set(o,new yce),this.sharedNodes.get(o).add(s),s.promote({transition:(u=s.options.initialPromotionConfig)===null||u===void 0?void 0:u.transition,preserveFollowOpacity:(c=(l=s.options.initialPromotionConfig)===null||l===void 0?void 0:l.shouldPreserveFollowOpacity)===null||c===void 0?void 0:c.call(l,s)})}isLead(){const o=this.getStack();return o?o.lead===this:!0}getLead(){var o;const{layoutId:s}=this.options;return s?((o=this.getStack())===null||o===void 0?void 0:o.lead)||this:this}getPrevLead(){var o;const{layoutId:s}=this.options;return s?(o=this.getStack())===null||o===void 0?void 0:o.prevLead:void 0}getStack(){const{layoutId:o}=this.options;if(o)return this.root.sharedNodes.get(o)}promote({needsReset:o,transition:s,preserveFollowOpacity:u}={}){const l=this.getStack();l&&l.promote(this,u),o&&(this.projectionDelta=void 0,this.needsReset=!0),s&&this.setOptions({transition:s})}relegate(){const o=this.getStack();return o?o.relegate(this):!1}resetRotation(){const{visualElement:o}=this.options;if(!o)return;let s=!1;const u={};for(let l=0;l<nB.length;l++){const c=nB[l],d="rotate"+c;!o.getStaticValue(d)||(s=!0,u[d]=o.getStaticValue(d),o.setStaticValue(d,0))}if(!!s){o?.syncRender();for(const l in u)o.setStaticValue(l,u[l]);o.scheduleRender()}}getProjectionStyles(o={}){var s,u,l;const c={};if(!this.instance||this.isSVG)return c;if(this.isVisible)c.visibility="";else return{visibility:"hidden"};const d=(s=this.options.visualElement)===null||s===void 0?void 0:s.getProps().transformTemplate;if(this.needsReset)return this.needsReset=!1,c.opacity="",c.pointerEvents=Jx(o.pointerEvents)||"",c.transform=d?d(this.latestValues,""):"none",c;const f=this.getLead();if(!this.projectionDelta||!this.layout||!f.target){const v={};return this.options.layoutId&&(v.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,v.pointerEvents=Jx(o.pointerEvents)||""),this.hasProjected&&!Cf(this.latestValues)&&(v.transform=d?d({},""):"none",this.hasProjected=!1),v}const p=f.animationValues||f.latestValues;this.applyTransformsToTarget(),c.transform=rB(this.projectionDeltaWithTransform,this.treeScale,p),d&&(c.transform=d(p,c.transform));const{x:h,y:m}=this.projectionDelta;c.transformOrigin=`${h.origin*100}% ${m.origin*100}% 0`,f.animationValues?c.opacity=f===this?(l=(u=p.opacity)!==null&&u!==void 0?u:this.latestValues.opacity)!==null&&l!==void 0?l:1:this.preserveOpacity?this.latestValues.opacity:p.opacityExit:c.opacity=f===this?p.opacity!==void 0?p.opacity:"":p.opacityExit!==void 0?p.opacityExit:0;for(const v in tC){if(p[v]===void 0)continue;const{correct:g,applyTo:y}=tC[v],b=g(p[v],f);if(y){const S=y.length;for(let x=0;x<S;x++)c[y[x]]=b}else c[v]=b}return this.options.layoutId&&(c.pointerEvents=f===this?Jx(o.pointerEvents)||"":"none"),c}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(o=>{var s;return(s=o.currentAnimation)===null||s===void 0?void 0:s.stop()}),this.root.nodes.forEach(iB),this.root.sharedNodes.clear()}}}function Cce(e){e.updateLayout()}function wce(e){var t,r,n;const a=((t=e.resumeFrom)===null||t===void 0?void 0:t.snapshot)||e.snapshot;if(e.isLead()&&e.layout&&a&&e.hasListeners("didUpdate")){const{actual:i,measured:o}=e.layout,{animationType:s}=e.options;s==="size"?Pl(f=>{const p=a.isShared?a.measured[f]:a.layout[f],h=bs(p);p.min=i[f].min,p.max=p.min+h}):EG(s,a.layout,i)&&Pl(f=>{const p=a.isShared?a.measured[f]:a.layout[f],h=bs(i[f]);p.max=p.min+h});const u=Ty();_y(u,i,a.layout);const l=Ty();a.isShared?_y(l,e.applyTransform(o,!0),a.measured):_y(l,i,a.layout);const c=!_G(u);let d=!1;if(!e.resumeFrom&&(e.relativeParent=e.getClosestProjectingParent(),e.relativeParent&&!e.relativeParent.resumeFrom)){const{snapshot:f,layout:p}=e.relativeParent;if(f&&p){const h=Ei();Ay(h,a.layout,f.layout);const m=Ei();Ay(m,i,p.actual),AG(h,m)||(d=!0)}}e.notifyListeners("didUpdate",{layout:i,snapshot:a,delta:l,layoutDelta:u,hasLayoutChanged:c,hasRelativeTargetChanged:d})}else e.isLead()&&((n=(r=e.options).onExitComplete)===null||n===void 0||n.call(r));e.options.transition=void 0}function _ce(e){e.clearSnapshot()}function iB(e){e.clearMeasurements()}function Ace(e){const{visualElement:t}=e.options;t?.getProps().onBeforeLayoutMeasure&&t.notifyBeforeLayoutMeasure(),e.resetTransform()}function Tce(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0}function Ece(e){e.resolveTargetDelta()}function Pce(e){e.calcProjection()}function Ice(e){e.resetRotation()}function Mce(e){e.removeLeadSnapshot()}function oB(e,t,r){e.translate=Ma(t.translate,0,r),e.scale=Ma(t.scale,1,r),e.origin=t.origin,e.originPoint=t.originPoint}function sB(e,t,r,n){e.min=Ma(t.min,r.min,n),e.max=Ma(t.max,r.max,n)}function Dce(e,t,r,n){sB(e.x,t.x,r.x,n),sB(e.y,t.y,r.y,n)}function kce(e){return e.animationValues&&e.animationValues.opacityExit!==void 0}const Rce={duration:.45,ease:[.4,0,.1,1]};function Oce(e,t){let r=e.root;for(let i=e.path.length-1;i>=0;i--)if(Boolean(e.path[i].instance)){r=e.path[i];break}const a=(r&&r!==e.root?r.instance:document).querySelector(`[data-projection-id="${t}"]`);a&&e.mount(a,!0)}function uB(e){e.min=Math.round(e.min),e.max=Math.round(e.max)}function lB(e){uB(e.x),uB(e.y)}function EG(e,t,r){return e==="position"||e==="preserve-aspect"&&!gce(tB(t),tB(r),.2)}const Bce=TG({attachResizeListener:(e,t)=>bw(e,"resize",t),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),G4={current:void 0},Fce=TG({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!G4.current){const e=new Bce(0,{});e.mount(window),e.setOptions({layoutScroll:!0}),G4.current=e}return G4.current},resetTransform:(e,t)=>{e.style.transform=t!==void 0?t:"none"},checkIsScrollRoot:e=>Boolean(window.getComputedStyle(e).position==="fixed")}),Lce={...vle,...Tue,...Lle,...uce},Nce=moe((e,t)=>ese(e,t,Lce,nce,Fce));function PG(){const e=ke.exports.useRef(!1);return eC(()=>(e.current=!0,()=>{e.current=!1}),[]),e}function zce(){const e=PG(),[t,r]=ke.exports.useState(0),n=ke.exports.useCallback(()=>{e.current&&r(t+1)},[t]);return[ke.exports.useCallback(()=>Jl.postRender(n),[n]),t]}class Uce extends ke.exports.Component{getSnapshotBeforeUpdate(t){const r=this.props.childRef.current;if(r&&t.isPresent&&!this.props.isPresent){const n=this.props.sizeRef.current;n.height=r.offsetHeight||0,n.width=r.offsetWidth||0,n.top=r.offsetTop,n.left=r.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function Vce({children:e,isPresent:t}){const r=ke.exports.useId(),n=ke.exports.useRef(null),a=ke.exports.useRef({width:0,height:0,top:0,left:0});return ke.exports.useInsertionEffect(()=>{const{width:i,height:o,top:s,left:u}=a.current;if(t||!n.current||!i||!o)return;n.current.dataset.motionPopId=r;const l=document.createElement("style");return document.head.appendChild(l),l.sheet&&l.sheet.insertRule(`
          [data-motion-pop-id="${r}"] {
            position: absolute !important;
            width: ${i}px !important;
            height: ${o}px !important;
            top: ${s}px !important;
            left: ${u}px !important;
          }
        `),()=>{document.head.removeChild(l)}},[t]),B(Uce,{isPresent:t,childRef:n,sizeRef:a,children:ke.exports.cloneElement(e,{ref:n})})}const q4=({children:e,initial:t,isPresent:r,onExitComplete:n,custom:a,presenceAffectsLayout:i,mode:o})=>{const s=yw(Hce),u=ke.exports.useId(),l=ke.exports.useMemo(()=>({id:u,initial:t,isPresent:r,custom:a,onExitComplete:c=>{s.set(c,!0);for(const d of s.values())if(!d)return;n&&n()},register:c=>(s.set(c,!1),()=>s.delete(c))}),i?void 0:[r]);return ke.exports.useMemo(()=>{s.forEach((c,d)=>s.set(d,!1))},[r]),ke.exports.useEffect(()=>{!r&&!s.size&&n&&n()},[r]),o==="popLayout"&&(e=B(Vce,{isPresent:r,children:e})),B(D0.Provider,{value:l,children:e})};function Hce(){return new Map}const dv=e=>e.key||"";function jce(e,t){e.forEach(r=>{const n=dv(r);t.set(n,r)})}function Gce(e){const t=[];return ke.exports.Children.forEach(e,r=>{ke.exports.isValidElement(r)&&t.push(r)}),t}const qce=({children:e,custom:t,initial:r=!0,onExitComplete:n,exitBeforeEnter:a,presenceAffectsLayout:i=!0,mode:o="sync"})=>{a&&(o="wait",Jj(!1,"Replace exitBeforeEnter with mode='wait'"));let[s]=zce();const u=ke.exports.useContext(iD).forceRender;u&&(s=u);const l=PG(),c=Gce(e);let d=c;const f=new Set,p=ke.exports.useRef(d),h=ke.exports.useRef(new Map).current,m=ke.exports.useRef(!0);if(eC(()=>{m.current=!1,jce(c,h),p.current=d}),pD(()=>{m.current=!0,h.clear(),f.clear()}),m.current)return B(Nt,{children:d.map(b=>B(q4,{isPresent:!0,initial:r?void 0:!1,presenceAffectsLayout:i,mode:o,children:b},dv(b)))});d=[...d];const v=p.current.map(dv),g=c.map(dv),y=v.length;for(let b=0;b<y;b++){const S=v[b];g.indexOf(S)===-1&&f.add(S)}return o==="wait"&&f.size&&(d=[]),f.forEach(b=>{if(g.indexOf(b)!==-1)return;const S=h.get(b);if(!S)return;const x=v.indexOf(b),C=()=>{h.delete(b),f.delete(b);const w=p.current.findIndex(_=>_.key===b);if(p.current.splice(w,1),!f.size){if(p.current=c,l.current===!1)return;s(),n&&n()}};d.splice(x,0,B(q4,{isPresent:!1,onExitComplete:C,custom:t,presenceAffectsLayout:i,mode:o,children:S},dv(S)))}),d=d.map(b=>{const S=b.key;return f.has(S)?b:B(q4,{isPresent:!0,presenceAffectsLayout:i,mode:o,children:b},dv(b))}),Zj!=="production"&&o==="wait"&&d.length>1&&console.warn(`You're attempting to animate multiple children within AnimatePresence, but its mode is set to "wait". This will lead to odd visual behaviour.`),B(Nt,{children:f.size?d:d.map(b=>ke.exports.cloneElement(b))})};var Wce=(...e)=>e.filter(Boolean).join(" "),Xce=_ie({"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}}),IG=M0((e,t)=>{const r=JH("Spinner",e),{label:n="Loading...",thickness:a="2px",speed:i="0.45s",emptyColor:o="transparent",className:s,...u}=$M(e),l=Wce("chakra-spinner",s),c={display:"inline-block",borderColor:"currentColor",borderStyle:"solid",borderRadius:"99999px",borderWidth:a,borderBottomColor:o,borderLeftColor:o,animation:`${Xce} ${i} linear infinite`,...r};return sa.createElement(tl.div,{ref:t,__css:c,className:l,...u},n&&sa.createElement(tl.span,{srOnly:!0},n))});IG.displayName="Spinner";var Aw=(...e)=>e.filter(Boolean).join(" ");function Yce(e){return B(tb,{viewBox:"0 0 24 24",...e,children:B("path",{fill:"currentColor",d:"M12,0A12,12,0,1,0,24,12,12.014,12.014,0,0,0,12,0Zm6.927,8.2-6.845,9.289a1.011,1.011,0,0,1-1.43.188L5.764,13.769a1,1,0,1,1,1.25-1.562l4.076,3.261,6.227-8.451A1,1,0,1,1,18.927,8.2Z"})})}function Kce(e){return B(tb,{viewBox:"0 0 24 24",...e,children:B("path",{fill:"currentColor",d:"M12,0A12,12,0,1,0,24,12,12.013,12.013,0,0,0,12,0Zm.25,5a1.5,1.5,0,1,1-1.5,1.5A1.5,1.5,0,0,1,12.25,5ZM14.5,18.5h-4a1,1,0,0,1,0-2h.75a.25.25,0,0,0,.25-.25v-4.5a.25.25,0,0,0-.25-.25H10.5a1,1,0,0,1,0-2h1a2,2,0,0,1,2,2v4.75a.25.25,0,0,0,.25.25h.75a1,1,0,1,1,0,2Z"})})}function cB(e){return B(tb,{viewBox:"0 0 24 24",...e,children:B("path",{fill:"currentColor",d:"M11.983,0a12.206,12.206,0,0,0-8.51,3.653A11.8,11.8,0,0,0,0,12.207,11.779,11.779,0,0,0,11.8,24h.214A12.111,12.111,0,0,0,24,11.791h0A11.766,11.766,0,0,0,11.983,0ZM10.5,16.542a1.476,1.476,0,0,1,1.449-1.53h.027a1.527,1.527,0,0,1,1.523,1.47,1.475,1.475,0,0,1-1.449,1.53h-.027A1.529,1.529,0,0,1,10.5,16.542ZM11,12.5v-6a1,1,0,0,1,2,0v6a1,1,0,1,1-2,0Z"})})}var[$ce,Qce]=hw({name:"AlertContext",hookName:"useAlertContext",providerName:"<Alert />"}),[Zce,PD]=hw({name:"AlertStylesContext",hookName:"useAlertStyles",providerName:"<Alert />"}),MG={info:{icon:Kce,colorScheme:"blue"},warning:{icon:cB,colorScheme:"orange"},success:{icon:Yce,colorScheme:"green"},error:{icon:cB,colorScheme:"red"},loading:{icon:IG,colorScheme:"blue"}};function Jce(e){return MG[e].colorScheme}function ede(e){return MG[e].icon}var DG=M0(function(t,r){const{status:n="info",addRole:a=!0,...i}=$M(t),o=t.colorScheme??Jce(n),s=Qie("Alert",{...t,colorScheme:o}),u={width:"100%",display:"flex",alignItems:"center",position:"relative",overflow:"hidden",...s.container};return sa.createElement($ce,{value:{status:n}},sa.createElement(Zce,{value:s},sa.createElement(tl.div,{role:a?"alert":void 0,ref:r,...i,className:Aw("chakra-alert",t.className),__css:u})))});DG.displayName="Alert";var kG=M0(function(t,r){const n=PD(),a={display:"inline",...n.description};return sa.createElement(tl.div,{ref:r,...t,className:Aw("chakra-alert__desc",t.className),__css:a})});kG.displayName="AlertDescription";function RG(e){const{status:t}=Qce(),r=ede(t),n=PD(),a=t==="loading"?n.spinner:n.icon;return sa.createElement(tl.span,{display:"inherit",...e,className:Aw("chakra-alert__icon",e.className),__css:a},e.children||B(r,{h:"100%",w:"100%"}))}RG.displayName="AlertIcon";var OG=M0(function(t,r){const n=PD();return sa.createElement(tl.div,{ref:r,...t,className:Aw("chakra-alert__title",t.className),__css:n.title})});OG.displayName="AlertTitle";function dB(e,t){const r=ke.exports.useRef(!1),n=ke.exports.useRef(!1);ke.exports.useEffect(()=>{if(r.current&&n.current)return e();n.current=!0},t),ke.exports.useEffect(()=>(r.current=!0,()=>{r.current=!1}),[])}function tde(e){return B(tb,{focusable:"false","aria-hidden":!0,...e,children:B("path",{fill:"currentColor",d:"M.439,21.44a1.5,1.5,0,0,0,2.122,2.121L11.823,14.3a.25.25,0,0,1,.354,0l9.262,9.263a1.5,1.5,0,1,0,2.122-2.121L14.3,12.177a.25.25,0,0,1,0-.354l9.263-9.262A1.5,1.5,0,0,0,21.439.44L12.177,9.7a.25.25,0,0,1-.354,0L2.561.44A1.5,1.5,0,0,0,.439,2.561L9.7,11.823a.25.25,0,0,1,0,.354Z"})})}var BG=M0(function(t,r){const n=JH("CloseButton",t),{children:a,isDisabled:i,__css:o,...s}=$M(t),u={outline:0,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0};return sa.createElement(tl.button,{type:"button","aria-label":"Close",ref:r,disabled:i,__css:{...u,...n,...o},...s},a||B(tde,{width:"1em",height:"1em"}))});BG.displayName="CloseButton";var FG=`
  :root {
    --chakra-vh: 100vh;
  }

  @supports (height: -webkit-fill-available) {
    :root {
      --chakra-vh: -webkit-fill-available;
    }
  }

  @supports (height: -moz-fill-available) {
    :root {
      --chakra-vh: -moz-fill-available;
    }
  }

  @supports (height: 100lvh) {
    :root {
      --chakra-vh: 100lvh;
    }
  }
`,rde=()=>B(pw,{styles:FG}),nde=()=>B(pw,{styles:`
      html {
        line-height: 1.5;
        -webkit-text-size-adjust: 100%;
        font-family: system-ui, sans-serif;
        -webkit-font-smoothing: antialiased;
        text-rendering: optimizeLegibility;
        -moz-osx-font-smoothing: grayscale;
        touch-action: manipulation;
      }

      body {
        position: relative;
        min-height: 100%;
        font-feature-settings: 'kern';
      }

      *,
      *::before,
      *::after {
        border-width: 0;
        border-style: solid;
        box-sizing: border-box;
      }

      main {
        display: block;
      }

      hr {
        border-top-width: 1px;
        box-sizing: content-box;
        height: 0;
        overflow: visible;
      }

      pre,
      code,
      kbd,
      samp {
        font-family: SFMono-Regular,  Menlo, Monaco, Consolas, monospace;
        font-size: 1em;
      }

      a {
        background-color: transparent;
        color: inherit;
        text-decoration: inherit;
      }

      abbr[title] {
        border-bottom: none;
        text-decoration: underline;
        -webkit-text-decoration: underline dotted;
        text-decoration: underline dotted;
      }

      b,
      strong {
        font-weight: bold;
      }

      small {
        font-size: 80%;
      }

      sub,
      sup {
        font-size: 75%;
        line-height: 0;
        position: relative;
        vertical-align: baseline;
      }

      sub {
        bottom: -0.25em;
      }

      sup {
        top: -0.5em;
      }

      img {
        border-style: none;
      }

      button,
      input,
      optgroup,
      select,
      textarea {
        font-family: inherit;
        font-size: 100%;
        line-height: 1.15;
        margin: 0;
      }

      button,
      input {
        overflow: visible;
      }

      button,
      select {
        text-transform: none;
      }

      button::-moz-focus-inner,
      [type="button"]::-moz-focus-inner,
      [type="reset"]::-moz-focus-inner,
      [type="submit"]::-moz-focus-inner {
        border-style: none;
        padding: 0;
      }

      fieldset {
        padding: 0.35em 0.75em 0.625em;
      }

      legend {
        box-sizing: border-box;
        color: inherit;
        display: table;
        max-width: 100%;
        padding: 0;
        white-space: normal;
      }

      progress {
        vertical-align: baseline;
      }

      textarea {
        overflow: auto;
      }

      [type="checkbox"],
      [type="radio"] {
        box-sizing: border-box;
        padding: 0;
      }

      [type="number"]::-webkit-inner-spin-button,
      [type="number"]::-webkit-outer-spin-button {
        -webkit-appearance: none !important;
      }

      input[type="number"] {
        -moz-appearance: textfield;
      }

      [type="search"] {
        -webkit-appearance: textfield;
        outline-offset: -2px;
      }

      [type="search"]::-webkit-search-decoration {
        -webkit-appearance: none !important;
      }

      ::-webkit-file-upload-button {
        -webkit-appearance: button;
        font: inherit;
      }

      details {
        display: block;
      }

      summary {
        display: list-item;
      }

      template {
        display: none;
      }

      [hidden] {
        display: none !important;
      }

      body,
      blockquote,
      dl,
      dd,
      h1,
      h2,
      h3,
      h4,
      h5,
      h6,
      hr,
      figure,
      p,
      pre {
        margin: 0;
      }

      button {
        background: transparent;
        padding: 0;
      }

      fieldset {
        margin: 0;
        padding: 0;
      }

      ol,
      ul {
        margin: 0;
        padding: 0;
      }

      textarea {
        resize: vertical;
      }

      button,
      [role="button"] {
        cursor: pointer;
      }

      button::-moz-focus-inner {
        border: 0 !important;
      }

      table {
        border-collapse: collapse;
      }

      h1,
      h2,
      h3,
      h4,
      h5,
      h6 {
        font-size: inherit;
        font-weight: inherit;
      }

      button,
      input,
      optgroup,
      select,
      textarea {
        padding: 0;
        line-height: inherit;
        color: inherit;
      }

      img,
      svg,
      video,
      canvas,
      audio,
      iframe,
      embed,
      object {
        display: block;
      }

      img,
      video {
        max-width: 100%;
        height: auto;
      }

      [data-js-focus-visible] :focus:not([data-focus-visible-added]):not([data-focus-visible-disabled]) {
        outline: none;
        box-shadow: none;
      }

      select::-ms-expand {
        display: none;
      }

      ${FG}
    `}),ade={body:{classList:{add(){},remove(){}}},addEventListener(){},removeEventListener(){},activeElement:{blur(){},nodeName:""},querySelector(){return null},querySelectorAll(){return[]},getElementById(){return null},createEvent(){return{initEvent(){}}},createElement(){return{children:[],childNodes:[],style:{},setAttribute(){},getElementsByTagName(){return[]}}}},LG=ade,Wm=()=>{},ide={document:LG,navigator:{userAgent:""},CustomEvent:function(){return this},addEventListener:Wm,removeEventListener:Wm,getComputedStyle(){return{getPropertyValue(){return""}}},matchMedia(){return{matches:!1,addListener:Wm,removeListener:Wm}},requestAnimationFrame(e){return typeof setTimeout>"u"?(e(),null):setTimeout(e,0)},cancelAnimationFrame(e){typeof setTimeout>"u"||clearTimeout(e)},setTimeout:()=>0,clearTimeout:Wm,setInterval:()=>0,clearInterval:Wm},ode=ide,sde={window:ode,document:LG},NG=typeof window<"u"?{window,document}:sde,zG=ke.exports.createContext(NG);zG.displayName="EnvironmentContext";function UG(e){const{children:t,environment:r}=e,[n,a]=ke.exports.useState(null),[i,o]=ke.exports.useState(!1);ke.exports.useEffect(()=>o(!0),[]);const s=ke.exports.useMemo(()=>{if(r)return r;const u=n?.ownerDocument,l=n?.ownerDocument.defaultView;return u?{document:u,window:l}:NG},[n,r]);return Pe(zG.Provider,{value:s,children:[t,!r&&i&&B("span",{id:"__chakra_env",hidden:!0,ref:u=>{ke.exports.startTransition(()=>{u&&a(u)})}})]})}UG.displayName="EnvironmentProvider";var[ude,lde]=hw({strict:!1,name:"PortalManagerContext"});function VG(e){const{children:t,zIndex:r}=e;return B(ude,{value:{zIndex:r},children:t})}VG.displayName="PortalManager";var[HG,cde]=hw({strict:!1,name:"PortalContext"}),ID="chakra-portal",dde=".chakra-portal",fde=e=>B("div",{className:"chakra-portal-zIndex",style:{position:"absolute",zIndex:e.zIndex,top:0,left:0,right:0},children:e.children}),pde=e=>{const{appendToParentPortal:t,children:r}=e,[n,a]=ke.exports.useState(null),i=ke.exports.useRef(null),[,o]=ke.exports.useState({});ke.exports.useEffect(()=>o({}),[]);const s=cde(),u=lde();$S(()=>{if(!n)return;const c=n.ownerDocument,d=t?s??c.body:c.body;if(!d)return;i.current=c.createElement("div"),i.current.className=ID,d.appendChild(i.current),o({});const f=i.current;return()=>{d.contains(f)&&d.removeChild(f)}},[n]);const l=u?.zIndex?B(fde,{zIndex:u?.zIndex,children:r}):r;return i.current?K1.exports.createPortal(B(HG,{value:i.current,children:l}),i.current):B("span",{ref:c=>{c&&a(c)}})},hde=e=>{const{children:t,containerRef:r,appendToParentPortal:n}=e,a=r.current,i=a??(typeof window<"u"?document.body:void 0),o=ke.exports.useMemo(()=>{const u=a?.ownerDocument.createElement("div");return u&&(u.className=ID),u},[a]),[,s]=ke.exports.useState({});return $S(()=>s({}),[]),$S(()=>{if(!(!o||!i))return i.appendChild(o),()=>{i.removeChild(o)}},[o,i]),i&&o?K1.exports.createPortal(B(HG,{value:n?o:null,children:t}),o):null};function sb(e){const{containerRef:t,...r}=e;return t?B(hde,{containerRef:t,...r}):B(pde,{...r})}sb.defaultProps={appendToParentPortal:!0};sb.className=ID;sb.selector=dde;sb.displayName="Portal";function kn(e,t={}){let r=!1;function n(){if(!r){r=!0;return}throw new Error("[anatomy] .part(...) should only be called once. Did you mean to use .extend(...) ?")}function a(...c){n();for(const d of c)t[d]=u(d);return kn(e,t)}function i(...c){for(const d of c)d in t||(t[d]=u(d));return kn(e,t)}function o(){return Object.fromEntries(Object.entries(t).map(([d,f])=>[d,f.selector]))}function s(){return Object.fromEntries(Object.entries(t).map(([d,f])=>[d,f.className]))}function u(c){const p=`chakra-${(["container","root"].includes(c??"")?[e]:[e,c]).filter(Boolean).join("__")}`;return{className:p,selector:`.${p}`,toString:()=>c}}return{parts:a,toPart:u,extend:i,selectors:o,classnames:s,get keys(){return Object.keys(t)},__type:{}}}var mde=kn("accordion").parts("root","container","button","panel").extend("icon"),vde=kn("alert").parts("title","description","container").extend("icon","spinner"),gde=kn("avatar").parts("label","badge","container").extend("excessLabel","group"),yde=kn("breadcrumb").parts("link","item","container").extend("separator");kn("button").parts();var bde=kn("checkbox").parts("control","icon","container").extend("label");kn("progress").parts("track","filledTrack").extend("label");var xde=kn("drawer").parts("overlay","dialogContainer","dialog").extend("header","closeButton","body","footer"),Sde=kn("editable").parts("preview","input","textarea"),Cde=kn("form").parts("container","requiredIndicator","helperText"),wde=kn("formError").parts("text","icon"),_de=kn("input").parts("addon","field","element"),Ade=kn("list").parts("container","item","icon"),Tde=kn("menu").parts("button","list","item").extend("groupTitle","command","divider"),Ede=kn("modal").parts("overlay","dialogContainer","dialog").extend("header","closeButton","body","footer"),Pde=kn("numberinput").parts("root","field","stepperGroup","stepper");kn("pininput").parts("field");var Ide=kn("popover").parts("content","header","body","footer").extend("popper","arrow","closeButton"),Mde=kn("progress").parts("label","filledTrack","track"),Dde=kn("radio").parts("container","control","label"),kde=kn("select").parts("field","icon"),Rde=kn("slider").parts("container","track","thumb","filledTrack","mark"),Ode=kn("stat").parts("container","label","helpText","number","icon"),Bde=kn("switch").parts("container","track","thumb"),Fde=kn("table").parts("table","thead","tbody","tr","th","td","tfoot","caption"),Lde=kn("tabs").parts("root","tab","tablist","tabpanel","tabpanels","indicator"),Nde=kn("tag").parts("container","label","closeButton");function ki(e,t){zde(e)&&(e="100%");var r=Ude(e);return e=t===360?e:Math.min(t,Math.max(0,parseFloat(e))),r&&(e=parseInt(String(e*t),10)/100),Math.abs(e-t)<1e-6?1:(t===360?e=(e<0?e%t+t:e%t)/parseFloat(String(t)):e=e%t/parseFloat(String(t)),e)}function P2(e){return Math.min(1,Math.max(0,e))}function zde(e){return typeof e=="string"&&e.indexOf(".")!==-1&&parseFloat(e)===1}function Ude(e){return typeof e=="string"&&e.indexOf("%")!==-1}function jG(e){return e=parseFloat(e),(isNaN(e)||e<0||e>1)&&(e=1),e}function I2(e){return e<=1?"".concat(Number(e)*100,"%"):e}function Ph(e){return e.length===1?"0"+e:String(e)}function Vde(e,t,r){return{r:ki(e,255)*255,g:ki(t,255)*255,b:ki(r,255)*255}}function fB(e,t,r){e=ki(e,255),t=ki(t,255),r=ki(r,255);var n=Math.max(e,t,r),a=Math.min(e,t,r),i=0,o=0,s=(n+a)/2;if(n===a)o=0,i=0;else{var u=n-a;switch(o=s>.5?u/(2-n-a):u/(n+a),n){case e:i=(t-r)/u+(t<r?6:0);break;case t:i=(r-e)/u+2;break;case r:i=(e-t)/u+4;break}i/=6}return{h:i,s:o,l:s}}function W4(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+(t-e)*(6*r):r<1/2?t:r<2/3?e+(t-e)*(2/3-r)*6:e}function Hde(e,t,r){var n,a,i;if(e=ki(e,360),t=ki(t,100),r=ki(r,100),t===0)a=r,i=r,n=r;else{var o=r<.5?r*(1+t):r+t-r*t,s=2*r-o;n=W4(s,o,e+1/3),a=W4(s,o,e),i=W4(s,o,e-1/3)}return{r:n*255,g:a*255,b:i*255}}function pB(e,t,r){e=ki(e,255),t=ki(t,255),r=ki(r,255);var n=Math.max(e,t,r),a=Math.min(e,t,r),i=0,o=n,s=n-a,u=n===0?0:s/n;if(n===a)i=0;else{switch(n){case e:i=(t-r)/s+(t<r?6:0);break;case t:i=(r-e)/s+2;break;case r:i=(e-t)/s+4;break}i/=6}return{h:i,s:u,v:o}}function jde(e,t,r){e=ki(e,360)*6,t=ki(t,100),r=ki(r,100);var n=Math.floor(e),a=e-n,i=r*(1-t),o=r*(1-a*t),s=r*(1-(1-a)*t),u=n%6,l=[r,o,i,i,s,r][u],c=[s,r,r,o,i,i][u],d=[i,i,s,r,r,o][u];return{r:l*255,g:c*255,b:d*255}}function hB(e,t,r,n){var a=[Ph(Math.round(e).toString(16)),Ph(Math.round(t).toString(16)),Ph(Math.round(r).toString(16))];return n&&a[0].startsWith(a[0].charAt(1))&&a[1].startsWith(a[1].charAt(1))&&a[2].startsWith(a[2].charAt(1))?a[0].charAt(0)+a[1].charAt(0)+a[2].charAt(0):a.join("")}function Gde(e,t,r,n,a){var i=[Ph(Math.round(e).toString(16)),Ph(Math.round(t).toString(16)),Ph(Math.round(r).toString(16)),Ph(qde(n))];return a&&i[0].startsWith(i[0].charAt(1))&&i[1].startsWith(i[1].charAt(1))&&i[2].startsWith(i[2].charAt(1))&&i[3].startsWith(i[3].charAt(1))?i[0].charAt(0)+i[1].charAt(0)+i[2].charAt(0)+i[3].charAt(0):i.join("")}function qde(e){return Math.round(parseFloat(e)*255).toString(16)}function mB(e){return os(e)/255}function os(e){return parseInt(e,16)}function Wde(e){return{r:e>>16,g:(e&65280)>>8,b:e&255}}var IP={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",goldenrod:"#daa520",gold:"#ffd700",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavenderblush:"#fff0f5",lavender:"#e6e6fa",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};function Xde(e){var t={r:0,g:0,b:0},r=1,n=null,a=null,i=null,o=!1,s=!1;return typeof e=="string"&&(e=$de(e)),typeof e=="object"&&(Sc(e.r)&&Sc(e.g)&&Sc(e.b)?(t=Vde(e.r,e.g,e.b),o=!0,s=String(e.r).substr(-1)==="%"?"prgb":"rgb"):Sc(e.h)&&Sc(e.s)&&Sc(e.v)?(n=I2(e.s),a=I2(e.v),t=jde(e.h,n,a),o=!0,s="hsv"):Sc(e.h)&&Sc(e.s)&&Sc(e.l)&&(n=I2(e.s),i=I2(e.l),t=Hde(e.h,n,i),o=!0,s="hsl"),Object.prototype.hasOwnProperty.call(e,"a")&&(r=e.a)),r=jG(r),{ok:o,format:e.format||s,r:Math.min(255,Math.max(t.r,0)),g:Math.min(255,Math.max(t.g,0)),b:Math.min(255,Math.max(t.b,0)),a:r}}var Yde="[-\\+]?\\d+%?",Kde="[-\\+]?\\d*\\.\\d+%?",Hf="(?:".concat(Kde,")|(?:").concat(Yde,")"),X4="[\\s|\\(]+(".concat(Hf,")[,|\\s]+(").concat(Hf,")[,|\\s]+(").concat(Hf,")\\s*\\)?"),Y4="[\\s|\\(]+(".concat(Hf,")[,|\\s]+(").concat(Hf,")[,|\\s]+(").concat(Hf,")[,|\\s]+(").concat(Hf,")\\s*\\)?"),ku={CSS_UNIT:new RegExp(Hf),rgb:new RegExp("rgb"+X4),rgba:new RegExp("rgba"+Y4),hsl:new RegExp("hsl"+X4),hsla:new RegExp("hsla"+Y4),hsv:new RegExp("hsv"+X4),hsva:new RegExp("hsva"+Y4),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/};function $de(e){if(e=e.trim().toLowerCase(),e.length===0)return!1;var t=!1;if(IP[e])e=IP[e],t=!0;else if(e==="transparent")return{r:0,g:0,b:0,a:0,format:"name"};var r=ku.rgb.exec(e);return r?{r:r[1],g:r[2],b:r[3]}:(r=ku.rgba.exec(e),r?{r:r[1],g:r[2],b:r[3],a:r[4]}:(r=ku.hsl.exec(e),r?{h:r[1],s:r[2],l:r[3]}:(r=ku.hsla.exec(e),r?{h:r[1],s:r[2],l:r[3],a:r[4]}:(r=ku.hsv.exec(e),r?{h:r[1],s:r[2],v:r[3]}:(r=ku.hsva.exec(e),r?{h:r[1],s:r[2],v:r[3],a:r[4]}:(r=ku.hex8.exec(e),r?{r:os(r[1]),g:os(r[2]),b:os(r[3]),a:mB(r[4]),format:t?"name":"hex8"}:(r=ku.hex6.exec(e),r?{r:os(r[1]),g:os(r[2]),b:os(r[3]),format:t?"name":"hex"}:(r=ku.hex4.exec(e),r?{r:os(r[1]+r[1]),g:os(r[2]+r[2]),b:os(r[3]+r[3]),a:mB(r[4]+r[4]),format:t?"name":"hex8"}:(r=ku.hex3.exec(e),r?{r:os(r[1]+r[1]),g:os(r[2]+r[2]),b:os(r[3]+r[3]),format:t?"name":"hex"}:!1)))))))))}function Sc(e){return Boolean(ku.CSS_UNIT.exec(String(e)))}var ub=function(){function e(t,r){t===void 0&&(t=""),r===void 0&&(r={});var n;if(t instanceof e)return t;typeof t=="number"&&(t=Wde(t)),this.originalInput=t;var a=Xde(t);this.originalInput=t,this.r=a.r,this.g=a.g,this.b=a.b,this.a=a.a,this.roundA=Math.round(100*this.a)/100,this.format=(n=r.format)!==null&&n!==void 0?n:a.format,this.gradientType=r.gradientType,this.r<1&&(this.r=Math.round(this.r)),this.g<1&&(this.g=Math.round(this.g)),this.b<1&&(this.b=Math.round(this.b)),this.isValid=a.ok}return e.prototype.isDark=function(){return this.getBrightness()<128},e.prototype.isLight=function(){return!this.isDark()},e.prototype.getBrightness=function(){var t=this.toRgb();return(t.r*299+t.g*587+t.b*114)/1e3},e.prototype.getLuminance=function(){var t=this.toRgb(),r,n,a,i=t.r/255,o=t.g/255,s=t.b/255;return i<=.03928?r=i/12.92:r=Math.pow((i+.055)/1.055,2.4),o<=.03928?n=o/12.92:n=Math.pow((o+.055)/1.055,2.4),s<=.03928?a=s/12.92:a=Math.pow((s+.055)/1.055,2.4),.2126*r+.7152*n+.0722*a},e.prototype.getAlpha=function(){return this.a},e.prototype.setAlpha=function(t){return this.a=jG(t),this.roundA=Math.round(100*this.a)/100,this},e.prototype.toHsv=function(){var t=pB(this.r,this.g,this.b);return{h:t.h*360,s:t.s,v:t.v,a:this.a}},e.prototype.toHsvString=function(){var t=pB(this.r,this.g,this.b),r=Math.round(t.h*360),n=Math.round(t.s*100),a=Math.round(t.v*100);return this.a===1?"hsv(".concat(r,", ").concat(n,"%, ").concat(a,"%)"):"hsva(".concat(r,", ").concat(n,"%, ").concat(a,"%, ").concat(this.roundA,")")},e.prototype.toHsl=function(){var t=fB(this.r,this.g,this.b);return{h:t.h*360,s:t.s,l:t.l,a:this.a}},e.prototype.toHslString=function(){var t=fB(this.r,this.g,this.b),r=Math.round(t.h*360),n=Math.round(t.s*100),a=Math.round(t.l*100);return this.a===1?"hsl(".concat(r,", ").concat(n,"%, ").concat(a,"%)"):"hsla(".concat(r,", ").concat(n,"%, ").concat(a,"%, ").concat(this.roundA,")")},e.prototype.toHex=function(t){return t===void 0&&(t=!1),hB(this.r,this.g,this.b,t)},e.prototype.toHexString=function(t){return t===void 0&&(t=!1),"#"+this.toHex(t)},e.prototype.toHex8=function(t){return t===void 0&&(t=!1),Gde(this.r,this.g,this.b,this.a,t)},e.prototype.toHex8String=function(t){return t===void 0&&(t=!1),"#"+this.toHex8(t)},e.prototype.toRgb=function(){return{r:Math.round(this.r),g:Math.round(this.g),b:Math.round(this.b),a:this.a}},e.prototype.toRgbString=function(){var t=Math.round(this.r),r=Math.round(this.g),n=Math.round(this.b);return this.a===1?"rgb(".concat(t,", ").concat(r,", ").concat(n,")"):"rgba(".concat(t,", ").concat(r,", ").concat(n,", ").concat(this.roundA,")")},e.prototype.toPercentageRgb=function(){var t=function(r){return"".concat(Math.round(ki(r,255)*100),"%")};return{r:t(this.r),g:t(this.g),b:t(this.b),a:this.a}},e.prototype.toPercentageRgbString=function(){var t=function(r){return Math.round(ki(r,255)*100)};return this.a===1?"rgb(".concat(t(this.r),"%, ").concat(t(this.g),"%, ").concat(t(this.b),"%)"):"rgba(".concat(t(this.r),"%, ").concat(t(this.g),"%, ").concat(t(this.b),"%, ").concat(this.roundA,")")},e.prototype.toName=function(){if(this.a===0)return"transparent";if(this.a<1)return!1;for(var t="#"+hB(this.r,this.g,this.b,!1),r=0,n=Object.entries(IP);r<n.length;r++){var a=n[r],i=a[0],o=a[1];if(t===o)return i}return!1},e.prototype.toString=function(t){var r=Boolean(t);t=t??this.format;var n=!1,a=this.a<1&&this.a>=0,i=!r&&a&&(t.startsWith("hex")||t==="name");return i?t==="name"&&this.a===0?this.toName():this.toRgbString():(t==="rgb"&&(n=this.toRgbString()),t==="prgb"&&(n=this.toPercentageRgbString()),(t==="hex"||t==="hex6")&&(n=this.toHexString()),t==="hex3"&&(n=this.toHexString(!0)),t==="hex4"&&(n=this.toHex8String(!0)),t==="hex8"&&(n=this.toHex8String()),t==="name"&&(n=this.toName()),t==="hsl"&&(n=this.toHslString()),t==="hsv"&&(n=this.toHsvString()),n||this.toHexString())},e.prototype.toNumber=function(){return(Math.round(this.r)<<16)+(Math.round(this.g)<<8)+Math.round(this.b)},e.prototype.clone=function(){return new e(this.toString())},e.prototype.lighten=function(t){t===void 0&&(t=10);var r=this.toHsl();return r.l+=t/100,r.l=P2(r.l),new e(r)},e.prototype.brighten=function(t){t===void 0&&(t=10);var r=this.toRgb();return r.r=Math.max(0,Math.min(255,r.r-Math.round(255*-(t/100)))),r.g=Math.max(0,Math.min(255,r.g-Math.round(255*-(t/100)))),r.b=Math.max(0,Math.min(255,r.b-Math.round(255*-(t/100)))),new e(r)},e.prototype.darken=function(t){t===void 0&&(t=10);var r=this.toHsl();return r.l-=t/100,r.l=P2(r.l),new e(r)},e.prototype.tint=function(t){return t===void 0&&(t=10),this.mix("white",t)},e.prototype.shade=function(t){return t===void 0&&(t=10),this.mix("black",t)},e.prototype.desaturate=function(t){t===void 0&&(t=10);var r=this.toHsl();return r.s-=t/100,r.s=P2(r.s),new e(r)},e.prototype.saturate=function(t){t===void 0&&(t=10);var r=this.toHsl();return r.s+=t/100,r.s=P2(r.s),new e(r)},e.prototype.greyscale=function(){return this.desaturate(100)},e.prototype.spin=function(t){var r=this.toHsl(),n=(r.h+t)%360;return r.h=n<0?360+n:n,new e(r)},e.prototype.mix=function(t,r){r===void 0&&(r=50);var n=this.toRgb(),a=new e(t).toRgb(),i=r/100,o={r:(a.r-n.r)*i+n.r,g:(a.g-n.g)*i+n.g,b:(a.b-n.b)*i+n.b,a:(a.a-n.a)*i+n.a};return new e(o)},e.prototype.analogous=function(t,r){t===void 0&&(t=6),r===void 0&&(r=30);var n=this.toHsl(),a=360/r,i=[this];for(n.h=(n.h-(a*t>>1)+720)%360;--t;)n.h=(n.h+a)%360,i.push(new e(n));return i},e.prototype.complement=function(){var t=this.toHsl();return t.h=(t.h+180)%360,new e(t)},e.prototype.monochromatic=function(t){t===void 0&&(t=6);for(var r=this.toHsv(),n=r.h,a=r.s,i=r.v,o=[],s=1/t;t--;)o.push(new e({h:n,s:a,v:i})),i=(i+s)%1;return o},e.prototype.splitcomplement=function(){var t=this.toHsl(),r=t.h;return[this,new e({h:(r+72)%360,s:t.s,l:t.l}),new e({h:(r+216)%360,s:t.s,l:t.l})]},e.prototype.onBackground=function(t){var r=this.toRgb(),n=new e(t).toRgb();return new e({r:n.r+(r.r-n.r)*r.a,g:n.g+(r.g-n.g)*r.a,b:n.b+(r.b-n.b)*r.a})},e.prototype.triad=function(){return this.polyad(3)},e.prototype.tetrad=function(){return this.polyad(4)},e.prototype.polyad=function(t){for(var r=this.toHsl(),n=r.h,a=[this],i=360/t,o=1;o<t;o++)a.push(new e({h:(n+o*i)%360,s:r.s,l:r.l}));return a},e.prototype.equals=function(t){return this.toRgbString()===new e(t).toRgbString()},e}();function GG(e){if(e===void 0&&(e={}),e.count!==void 0&&e.count!==null){var t=e.count,r=[];for(e.count=void 0;t>r.length;)e.count=null,e.seed&&(e.seed+=1),r.push(GG(e));return e.count=t,r}var n=Qde(e.hue,e.seed),a=Zde(n,e),i=Jde(n,a,e),o={h:n,s:a,v:i};return e.alpha!==void 0&&(o.a=e.alpha),new ub(o)}function Qde(e,t){var r=tfe(e),n=fC(r,t);return n<0&&(n=360+n),n}function Zde(e,t){if(t.hue==="monochrome")return 0;if(t.luminosity==="random")return fC([0,100],t.seed);var r=qG(e).saturationRange,n=r[0],a=r[1];switch(t.luminosity){case"bright":n=55;break;case"dark":n=a-10;break;case"light":a=55;break}return fC([n,a],t.seed)}function Jde(e,t,r){var n=efe(e,t),a=100;switch(r.luminosity){case"dark":a=n+20;break;case"light":n=(a+n)/2;break;case"random":n=0,a=100;break}return fC([n,a],r.seed)}function efe(e,t){for(var r=qG(e).lowerBounds,n=0;n<r.length-1;n++){var a=r[n][0],i=r[n][1],o=r[n+1][0],s=r[n+1][1];if(t>=a&&t<=o){var u=(s-i)/(o-a),l=i-u*a;return u*t+l}}return 0}function tfe(e){var t=parseInt(e,10);if(!Number.isNaN(t)&&t<360&&t>0)return[t,t];if(typeof e=="string"){var r=XG.find(function(o){return o.name===e});if(r){var n=WG(r);if(n.hueRange)return n.hueRange}var a=new ub(e);if(a.isValid){var i=a.toHsv().h;return[i,i]}}return[0,360]}function qG(e){e>=334&&e<=360&&(e-=360);for(var t=0,r=XG;t<r.length;t++){var n=r[t],a=WG(n);if(a.hueRange&&e>=a.hueRange[0]&&e<=a.hueRange[1])return a}throw Error("Color not found")}function fC(e,t){if(t===void 0)return Math.floor(e[0]+Math.random()*(e[1]+1-e[0]));var r=e[1]||1,n=e[0]||0;t=(t*9301+49297)%233280;var a=t/233280;return Math.floor(n+a*(r-n))}function WG(e){var t=e.lowerBounds[0][0],r=e.lowerBounds[e.lowerBounds.length-1][0],n=e.lowerBounds[e.lowerBounds.length-1][1],a=e.lowerBounds[0][1];return{name:e.name,hueRange:e.hueRange,lowerBounds:e.lowerBounds,saturationRange:[t,r],brightnessRange:[n,a]}}var XG=[{name:"monochrome",hueRange:null,lowerBounds:[[0,0],[100,0]]},{name:"red",hueRange:[-26,18],lowerBounds:[[20,100],[30,92],[40,89],[50,85],[60,78],[70,70],[80,60],[90,55],[100,50]]},{name:"orange",hueRange:[19,46],lowerBounds:[[20,100],[30,93],[40,88],[50,86],[60,85],[70,70],[100,70]]},{name:"yellow",hueRange:[47,62],lowerBounds:[[25,100],[40,94],[50,89],[60,86],[70,84],[80,82],[90,80],[100,75]]},{name:"green",hueRange:[63,178],lowerBounds:[[30,100],[40,90],[50,85],[60,81],[70,74],[80,64],[90,50],[100,40]]},{name:"blue",hueRange:[179,257],lowerBounds:[[20,100],[30,86],[40,80],[50,74],[60,60],[70,52],[80,44],[90,39],[100,35]]},{name:"purple",hueRange:[258,282],lowerBounds:[[20,100],[30,87],[40,79],[50,70],[60,65],[70,59],[80,52],[90,45],[100,42]]},{name:"pink",hueRange:[283,334],lowerBounds:[[20,100],[30,90],[40,86],[60,84],[80,80],[90,75],[100,73]]}];function rfe(e,t,r,n,a){for(t=t.split?t.split("."):t,n=0;n<t.length;n++)e=e?e[t[n]]:a;return e===a?r:e}var nfe=e=>Object.keys(e).length===0,ei=(e,t,r)=>{const n=rfe(e,`colors.${t}`,t),{isValid:a}=new ub(n);return a?n:r},afe=e=>t=>{const r=ei(t,e);return new ub(r).isDark()?"dark":"light"},ife=e=>t=>afe(e)(t)==="dark",f0=(e,t)=>r=>{const n=ei(r,e);return new ub(n).setAlpha(t).toRgbString()};function vB(e="1rem",t="rgba(255, 255, 255, 0.15)"){return{backgroundImage:`linear-gradient(
    45deg,
    ${t} 25%,
    transparent 25%,
    transparent 50%,
    ${t} 50%,
    ${t} 75%,
    transparent 75%,
    transparent
  )`,backgroundSize:`${e} ${e}`}}function ofe(e){const t=GG().toHexString();return!e||nfe(e)?t:e.string&&e.colors?ufe(e.string,e.colors):e.string&&!e.colors?sfe(e.string):e.colors&&!e.string?lfe(e.colors):t}function sfe(e){let t=0;if(e.length===0)return t.toString();for(let n=0;n<e.length;n+=1)t=e.charCodeAt(n)+((t<<5)-t),t=t&t;let r="#";for(let n=0;n<3;n+=1)r+=`00${(t>>n*8&255).toString(16)}`.substr(-2);return r}function ufe(e,t){let r=0;if(e.length===0)return t[0];for(let n=0;n<e.length;n+=1)r=e.charCodeAt(n)+((r<<5)-r),r=r&r;return r=(r%t.length+t.length)%t.length,t[r]}function lfe(e){return e[Math.floor(Math.random()*e.length)]}function At(e,t){return r=>r.colorMode==="dark"?t:e}function MD(e){const{orientation:t,vertical:r,horizontal:n}=e;return t?t==="vertical"?r:n:{}}function cfe(e){const t=typeof e;return e!=null&&(t==="object"||t==="function")&&!Array.isArray(e)}function YG(e){return cfe(e)&&e.reference?e.reference:String(e)}var Tw=(e,...t)=>t.map(YG).join(` ${e} `).replace(/calc/g,""),gB=(...e)=>`calc(${Tw("+",...e)})`,yB=(...e)=>`calc(${Tw("-",...e)})`,MP=(...e)=>`calc(${Tw("*",...e)})`,bB=(...e)=>`calc(${Tw("/",...e)})`,xB=e=>{const t=YG(e);return t!=null&&!Number.isNaN(parseFloat(t))?String(t).startsWith("-")?String(t).slice(1):`-${t}`:MP(t,-1)},Hc=Object.assign(e=>({add:(...t)=>Hc(gB(e,...t)),subtract:(...t)=>Hc(yB(e,...t)),multiply:(...t)=>Hc(MP(e,...t)),divide:(...t)=>Hc(bB(e,...t)),negate:()=>Hc(xB(e)),toString:()=>e.toString()}),{add:gB,subtract:yB,multiply:MP,divide:bB,negate:xB});function dfe(e){return!Number.isInteger(parseFloat(e.toString()))}function ffe(e,t="-"){return e.replace(/\s+/g,t)}function KG(e){const t=ffe(e.toString());return t.includes("\\.")?e:dfe(e)?t.replace(".","\\."):e}function pfe(e,t=""){return[t,KG(e)].filter(Boolean).join("-")}function hfe(e,t){return`var(${KG(e)}${t?`, ${t}`:""})`}function mfe(e,t=""){return`--${pfe(e,t)}`}function Xo(e,t){const r=mfe(e,t?.prefix);return{variable:r,reference:hfe(r,vfe(t?.fallback))}}function vfe(e){return typeof e=="string"?e:e?.reference}var{definePartsStyle:gfe,defineMultiStyleConfig:yfe}=ga(mde.keys),bfe={borderTopWidth:"1px",borderColor:"inherit",_last:{borderBottomWidth:"1px"}},xfe={transitionProperty:"common",transitionDuration:"normal",fontSize:"md",_focusVisible:{boxShadow:"outline"},_hover:{bg:"blackAlpha.50"},_disabled:{opacity:.4,cursor:"not-allowed"},px:"4",py:"2"},Sfe={pt:"2",px:"4",pb:"5"},Cfe={fontSize:"1.25em"},wfe=gfe({container:bfe,button:xfe,panel:Sfe,icon:Cfe}),_fe=yfe({baseStyle:wfe}),{definePartsStyle:lb,defineMultiStyleConfig:Afe}=ga(vde.keys),cd=Ip("alert-fg"),cb=Ip("alert-bg"),Tfe=lb({container:{bg:cb.reference,px:"4",py:"3"},title:{fontWeight:"bold",lineHeight:"6",marginEnd:"2"},description:{lineHeight:"6"},icon:{color:cd.reference,flexShrink:0,marginEnd:"3",w:"5",h:"6"},spinner:{color:cd.reference,flexShrink:0,marginEnd:"3",w:"5",h:"5"}});function DD(e){const{theme:t,colorScheme:r}=e,n=ei(t,`${r}.100`,r),a=f0(`${r}.200`,.16)(t);return At(n,a)(e)}var Efe=lb(e=>{const{colorScheme:t}=e,r=At(`${t}.500`,`${t}.200`)(e);return{container:{[cb.variable]:DD(e),[cd.variable]:`colors.${r}`}}}),Pfe=lb(e=>{const{colorScheme:t}=e,r=At(`${t}.500`,`${t}.200`)(e);return{container:{[cb.variable]:DD(e),[cd.variable]:`colors.${r}`,paddingStart:"3",borderStartWidth:"4px",borderStartColor:cd.reference}}}),Ife=lb(e=>{const{colorScheme:t}=e,r=At(`${t}.500`,`${t}.200`)(e);return{container:{[cb.variable]:DD(e),[cd.variable]:`colors.${r}`,pt:"2",borderTopWidth:"4px",borderTopColor:cd.reference}}}),Mfe=lb(e=>{const{colorScheme:t}=e,r=At(`${t}.500`,`${t}.200`)(e),n=At("white","gray.900")(e);return{container:{[cb.variable]:`colors.${r}`,[cd.variable]:`colors.${n}`,color:cd.reference}}}),Dfe={subtle:Efe,"left-accent":Pfe,"top-accent":Ife,solid:Mfe},kfe=Afe({baseStyle:Tfe,variants:Dfe,defaultProps:{variant:"subtle",colorScheme:"blue"}}),$G={px:"1px",.5:"0.125rem",1:"0.25rem",1.5:"0.375rem",2:"0.5rem",2.5:"0.625rem",3:"0.75rem",3.5:"0.875rem",4:"1rem",5:"1.25rem",6:"1.5rem",7:"1.75rem",8:"2rem",9:"2.25rem",10:"2.5rem",12:"3rem",14:"3.5rem",16:"4rem",20:"5rem",24:"6rem",28:"7rem",32:"8rem",36:"9rem",40:"10rem",44:"11rem",48:"12rem",52:"13rem",56:"14rem",60:"15rem",64:"16rem",72:"18rem",80:"20rem",96:"24rem"},Rfe={max:"max-content",min:"min-content",full:"100%","3xs":"14rem","2xs":"16rem",xs:"20rem",sm:"24rem",md:"28rem",lg:"32rem",xl:"36rem","2xl":"42rem","3xl":"48rem","4xl":"56rem","5xl":"64rem","6xl":"72rem","7xl":"80rem","8xl":"90rem",prose:"60ch"},Ofe={sm:"640px",md:"768px",lg:"1024px",xl:"1280px"},Bfe={...$G,...Rfe,container:Ofe},QG=Bfe,Ffe=e=>typeof e=="function";function Fa(e,...t){return Ffe(e)?e(...t):e}var{definePartsStyle:ZG,defineMultiStyleConfig:Lfe}=ga(gde.keys),Nfe=e=>({borderRadius:"full",border:"0.2em solid",borderColor:At("white","gray.800")(e)}),zfe=e=>({bg:At("gray.200","whiteAlpha.400")(e)}),Ufe=e=>{const{name:t,theme:r}=e,n=t?ofe({string:t}):"gray.400",a=ife(n)(r);let i="white";a||(i="gray.800");const o=At("white","gray.800")(e);return{bg:n,color:i,borderColor:o,verticalAlign:"top"}},Vfe=ZG(e=>({badge:Fa(Nfe,e),excessLabel:Fa(zfe,e),container:Fa(Ufe,e)}));function Jd(e){const t=e!=="100%"?QG[e]:void 0;return ZG({container:{width:e,height:e,fontSize:`calc(${t??e} / 2.5)`},excessLabel:{width:e,height:e},label:{fontSize:`calc(${t??e} / 2.5)`,lineHeight:e!=="100%"?t??e:void 0}})}var Hfe={"2xs":Jd(4),xs:Jd(6),sm:Jd(8),md:Jd(12),lg:Jd(16),xl:Jd(24),"2xl":Jd(32),full:Jd("100%")},jfe=Lfe({baseStyle:Vfe,sizes:Hfe,defaultProps:{size:"md"}}),Gfe={px:1,textTransform:"uppercase",fontSize:"xs",borderRadius:"sm",fontWeight:"bold"},qfe=e=>{const{colorScheme:t,theme:r}=e,n=f0(`${t}.500`,.6)(r);return{bg:At(`${t}.500`,n)(e),color:At("white","whiteAlpha.800")(e)}},Wfe=e=>{const{colorScheme:t,theme:r}=e,n=f0(`${t}.200`,.16)(r);return{bg:At(`${t}.100`,n)(e),color:At(`${t}.800`,`${t}.200`)(e)}},Xfe=e=>{const{colorScheme:t,theme:r}=e,n=f0(`${t}.200`,.8)(r),a=ei(r,`${t}.500`),i=At(a,n)(e);return{color:i,boxShadow:`inset 0 0 0px 1px ${i}`}},Yfe={solid:qfe,subtle:Wfe,outline:Xfe},Ey={baseStyle:Gfe,variants:Yfe,defaultProps:{variant:"subtle",colorScheme:"gray"}},{defineMultiStyleConfig:Kfe,definePartsStyle:$fe}=ga(yde.keys),Qfe={transitionProperty:"common",transitionDuration:"fast",transitionTimingFunction:"ease-out",cursor:"pointer",textDecoration:"none",outline:"none",color:"inherit",_hover:{textDecoration:"underline"},_focusVisible:{boxShadow:"outline"}},Zfe=$fe({link:Qfe}),Jfe=Kfe({baseStyle:Zfe}),epe={lineHeight:"1.2",borderRadius:"md",fontWeight:"semibold",transitionProperty:"common",transitionDuration:"normal",_focusVisible:{boxShadow:"outline"},_disabled:{opacity:.4,cursor:"not-allowed",boxShadow:"none"},_hover:{_disabled:{bg:"initial"}}},JG=e=>{const{colorScheme:t,theme:r}=e;if(t==="gray")return{color:At("inherit","whiteAlpha.900")(e),_hover:{bg:At("gray.100","whiteAlpha.200")(e)},_active:{bg:At("gray.200","whiteAlpha.300")(e)}};const n=f0(`${t}.200`,.12)(r),a=f0(`${t}.200`,.24)(r);return{color:At(`${t}.600`,`${t}.200`)(e),bg:"transparent",_hover:{bg:At(`${t}.50`,n)(e)},_active:{bg:At(`${t}.100`,a)(e)}}},tpe=e=>{const{colorScheme:t}=e,r=At("gray.200","whiteAlpha.300")(e);return{border:"1px solid",borderColor:t==="gray"?r:"currentColor",".chakra-button__group[data-attached] > &:not(:last-of-type)":{marginEnd:"-1px"},...Fa(JG,e)}},rpe={yellow:{bg:"yellow.400",color:"black",hoverBg:"yellow.500",activeBg:"yellow.600"},cyan:{bg:"cyan.400",color:"black",hoverBg:"cyan.500",activeBg:"cyan.600"}},npe=e=>{const{colorScheme:t}=e;if(t==="gray"){const s=At("gray.100","whiteAlpha.200")(e);return{bg:s,_hover:{bg:At("gray.200","whiteAlpha.300")(e),_disabled:{bg:s}},_active:{bg:At("gray.300","whiteAlpha.400")(e)}}}const{bg:r=`${t}.500`,color:n="white",hoverBg:a=`${t}.600`,activeBg:i=`${t}.700`}=rpe[t]??{},o=At(r,`${t}.200`)(e);return{bg:o,color:At(n,"gray.800")(e),_hover:{bg:At(a,`${t}.300`)(e),_disabled:{bg:o}},_active:{bg:At(i,`${t}.400`)(e)}}},ape=e=>{const{colorScheme:t}=e;return{padding:0,height:"auto",lineHeight:"normal",verticalAlign:"baseline",color:At(`${t}.500`,`${t}.200`)(e),_hover:{textDecoration:"underline",_disabled:{textDecoration:"none"}},_active:{color:At(`${t}.700`,`${t}.500`)(e)}}},ipe={bg:"none",color:"inherit",display:"inline",lineHeight:"inherit",m:"0",p:"0"},ope={ghost:JG,outline:tpe,solid:npe,link:ape,unstyled:ipe},spe={lg:{h:"12",minW:"12",fontSize:"lg",px:"6"},md:{h:"10",minW:"10",fontSize:"md",px:"4"},sm:{h:"8",minW:"8",fontSize:"sm",px:"3"},xs:{h:"6",minW:"6",fontSize:"xs",px:"2"}},upe={baseStyle:epe,variants:ope,sizes:spe,defaultProps:{variant:"solid",size:"md",colorScheme:"gray"}},{definePartsStyle:rS,defineMultiStyleConfig:lpe}=ga(bde.keys),Py=Ip("checkbox-size"),cpe=e=>{const{colorScheme:t}=e;return{w:Py.reference,h:Py.reference,transitionProperty:"box-shadow",transitionDuration:"normal",border:"2px solid",borderRadius:"sm",borderColor:"inherit",color:"white",_checked:{bg:At(`${t}.500`,`${t}.200`)(e),borderColor:At(`${t}.500`,`${t}.200`)(e),color:At("white","gray.900")(e),_hover:{bg:At(`${t}.600`,`${t}.300`)(e),borderColor:At(`${t}.600`,`${t}.300`)(e)},_disabled:{borderColor:At("gray.200","transparent")(e),bg:At("gray.200","whiteAlpha.300")(e),color:At("gray.500","whiteAlpha.500")(e)}},_indeterminate:{bg:At(`${t}.500`,`${t}.200`)(e),borderColor:At(`${t}.500`,`${t}.200`)(e),color:At("white","gray.900")(e)},_disabled:{bg:At("gray.100","whiteAlpha.100")(e),borderColor:At("gray.100","transparent")(e)},_focusVisible:{boxShadow:"outline"},_invalid:{borderColor:At("red.500","red.300")(e)}}},dpe={_disabled:{cursor:"not-allowed"}},fpe={userSelect:"none",_disabled:{opacity:.4}},ppe={transitionProperty:"transform",transitionDuration:"normal"},hpe=rS(e=>({icon:ppe,container:dpe,control:Fa(cpe,e),label:fpe})),mpe={sm:rS({control:{[Py.variable]:"sizes.3"},label:{fontSize:"sm"},icon:{fontSize:"3xs"}}),md:rS({control:{[Py.variable]:"sizes.4"},label:{fontSize:"md"},icon:{fontSize:"2xs"}}),lg:rS({control:{[Py.variable]:"sizes.5"},label:{fontSize:"lg"},icon:{fontSize:"2xs"}})},pC=lpe({baseStyle:hpe,sizes:mpe,defaultProps:{size:"md",colorScheme:"blue"}}),Iy=Xo("close-button-size"),vpe=e=>{const t=At("blackAlpha.100","whiteAlpha.100")(e),r=At("blackAlpha.200","whiteAlpha.200")(e);return{w:[Iy.reference],h:[Iy.reference],borderRadius:"md",transitionProperty:"common",transitionDuration:"normal",_disabled:{opacity:.4,cursor:"not-allowed",boxShadow:"none"},_hover:{bg:t},_active:{bg:r},_focusVisible:{boxShadow:"outline"}}},gpe={lg:{[Iy.variable]:"sizes.10",fontSize:"md"},md:{[Iy.variable]:"sizes.8",fontSize:"xs"},sm:{[Iy.variable]:"sizes.6",fontSize:"2xs"}},ype={baseStyle:vpe,sizes:gpe,defaultProps:{size:"md"}},{variants:bpe,defaultProps:xpe}=Ey,Spe={fontFamily:"mono",fontSize:"sm",px:"0.2em",borderRadius:"sm"},Cpe={baseStyle:Spe,variants:bpe,defaultProps:xpe},wpe={w:"100%",mx:"auto",maxW:"prose",px:"4"},_pe={baseStyle:wpe},Ape={opacity:.6,borderColor:"inherit"},Tpe={borderStyle:"solid"},Epe={borderStyle:"dashed"},Ppe={solid:Tpe,dashed:Epe},Ipe={baseStyle:Ape,variants:Ppe,defaultProps:{variant:"solid"}},{definePartsStyle:DP,defineMultiStyleConfig:Mpe}=ga(xde.keys);function Xm(e){return DP(e==="full"?{dialog:{maxW:"100vw",h:"100vh"}}:{dialog:{maxW:e}})}var Dpe={bg:"blackAlpha.600",zIndex:"overlay"},kpe={display:"flex",zIndex:"modal",justifyContent:"center"},Rpe=e=>{const{isFullHeight:t}=e;return{...t&&{height:"100vh"},zIndex:"modal",maxH:"100vh",bg:At("white","gray.700")(e),color:"inherit",boxShadow:At("lg","dark-lg")(e)}},Ope={px:"6",py:"4",fontSize:"xl",fontWeight:"semibold"},Bpe={position:"absolute",top:"2",insetEnd:"3"},Fpe={px:"6",py:"2",flex:"1",overflow:"auto"},Lpe={px:"6",py:"4"},Npe=DP(e=>({overlay:Dpe,dialogContainer:kpe,dialog:Fa(Rpe,e),header:Ope,closeButton:Bpe,body:Fpe,footer:Lpe})),zpe={xs:Xm("xs"),sm:Xm("md"),md:Xm("lg"),lg:Xm("2xl"),xl:Xm("4xl"),full:Xm("full")},Upe=Mpe({baseStyle:Npe,sizes:zpe,defaultProps:{size:"xs"}}),{definePartsStyle:Vpe,defineMultiStyleConfig:Hpe}=ga(Sde.keys),jpe={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal"},Gpe={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal",width:"full",_focusVisible:{boxShadow:"outline"},_placeholder:{opacity:.6}},qpe={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal",width:"full",_focusVisible:{boxShadow:"outline"},_placeholder:{opacity:.6}},Wpe=Vpe({preview:jpe,input:Gpe,textarea:qpe}),Xpe=Hpe({baseStyle:Wpe}),{definePartsStyle:Ype,defineMultiStyleConfig:Kpe}=ga(Cde.keys),$pe=e=>({marginStart:"1",color:At("red.500","red.300")(e)}),Qpe=e=>({mt:"2",color:At("gray.600","whiteAlpha.600")(e),lineHeight:"normal",fontSize:"sm"}),Zpe=Ype(e=>({container:{width:"100%",position:"relative"},requiredIndicator:Fa($pe,e),helperText:Fa(Qpe,e)})),Jpe=Kpe({baseStyle:Zpe}),{definePartsStyle:ehe,defineMultiStyleConfig:the}=ga(wde.keys),rhe=e=>({color:At("red.500","red.300")(e),mt:"2",fontSize:"sm",lineHeight:"normal"}),nhe=e=>({marginEnd:"0.5em",color:At("red.500","red.300")(e)}),ahe=ehe(e=>({text:Fa(rhe,e),icon:Fa(nhe,e)})),ihe=the({baseStyle:ahe}),ohe={fontSize:"md",marginEnd:"3",mb:"2",fontWeight:"medium",transitionProperty:"common",transitionDuration:"normal",opacity:1,_disabled:{opacity:.4}},she={baseStyle:ohe},uhe={fontFamily:"heading",fontWeight:"bold"},lhe={"4xl":{fontSize:["6xl",null,"7xl"],lineHeight:1},"3xl":{fontSize:["5xl",null,"6xl"],lineHeight:1},"2xl":{fontSize:["4xl",null,"5xl"],lineHeight:[1.2,null,1]},xl:{fontSize:["3xl",null,"4xl"],lineHeight:[1.33,null,1.2]},lg:{fontSize:["2xl",null,"3xl"],lineHeight:[1.33,null,1.2]},md:{fontSize:"xl",lineHeight:1.2},sm:{fontSize:"md",lineHeight:1.2},xs:{fontSize:"sm",lineHeight:1.2}},che={baseStyle:uhe,sizes:lhe,defaultProps:{size:"xl"}},{definePartsStyle:Kc,defineMultiStyleConfig:dhe}=ga(_de.keys),fhe=Kc({field:{width:"100%",minWidth:0,outline:0,position:"relative",appearance:"none",transitionProperty:"common",transitionDuration:"normal",_disabled:{opacity:.4,cursor:"not-allowed"}}}),ef={lg:{fontSize:"lg",px:"4",h:"12",borderRadius:"md"},md:{fontSize:"md",px:"4",h:"10",borderRadius:"md"},sm:{fontSize:"sm",px:"3",h:"8",borderRadius:"sm"},xs:{fontSize:"xs",px:"2",h:"6",borderRadius:"sm"}},phe={lg:Kc({field:ef.lg,addon:ef.lg}),md:Kc({field:ef.md,addon:ef.md}),sm:Kc({field:ef.sm,addon:ef.sm}),xs:Kc({field:ef.xs,addon:ef.xs})};function kD(e){const{focusBorderColor:t,errorBorderColor:r}=e;return{focusBorderColor:t||At("blue.500","blue.300")(e),errorBorderColor:r||At("red.500","red.300")(e)}}var hhe=Kc(e=>{const{theme:t}=e,{focusBorderColor:r,errorBorderColor:n}=kD(e);return{field:{border:"1px solid",borderColor:"inherit",bg:"inherit",_hover:{borderColor:At("gray.300","whiteAlpha.400")(e)},_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:ei(t,n),boxShadow:`0 0 0 1px ${ei(t,n)}`},_focusVisible:{zIndex:1,borderColor:ei(t,r),boxShadow:`0 0 0 1px ${ei(t,r)}`}},addon:{border:"1px solid",borderColor:At("inherit","whiteAlpha.50")(e),bg:At("gray.100","whiteAlpha.300")(e)}}}),mhe=Kc(e=>{const{theme:t}=e,{focusBorderColor:r,errorBorderColor:n}=kD(e);return{field:{border:"2px solid",borderColor:"transparent",bg:At("gray.100","whiteAlpha.50")(e),_hover:{bg:At("gray.200","whiteAlpha.100")(e)},_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:ei(t,n)},_focusVisible:{bg:"transparent",borderColor:ei(t,r)}},addon:{border:"2px solid",borderColor:"transparent",bg:At("gray.100","whiteAlpha.50")(e)}}}),vhe=Kc(e=>{const{theme:t}=e,{focusBorderColor:r,errorBorderColor:n}=kD(e);return{field:{borderBottom:"1px solid",borderColor:"inherit",borderRadius:"0",px:"0",bg:"transparent",_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:ei(t,n),boxShadow:`0px 1px 0px 0px ${ei(t,n)}`},_focusVisible:{borderColor:ei(t,r),boxShadow:`0px 1px 0px 0px ${ei(t,r)}`}},addon:{borderBottom:"2px solid",borderColor:"inherit",borderRadius:"0",px:"0",bg:"transparent"}}}),ghe=Kc({field:{bg:"transparent",px:"0",height:"auto"},addon:{bg:"transparent",px:"0",height:"auto"}}),yhe={outline:hhe,filled:mhe,flushed:vhe,unstyled:ghe},Sn=dhe({baseStyle:fhe,sizes:phe,variants:yhe,defaultProps:{size:"md",variant:"outline"}}),bhe=e=>({bg:At("gray.100","whiteAlpha")(e),borderRadius:"md",borderWidth:"1px",borderBottomWidth:"3px",fontSize:"0.8em",fontWeight:"bold",lineHeight:"normal",px:"0.4em",whiteSpace:"nowrap"}),xhe={baseStyle:bhe},She={transitionProperty:"common",transitionDuration:"fast",transitionTimingFunction:"ease-out",cursor:"pointer",textDecoration:"none",outline:"none",color:"inherit",_hover:{textDecoration:"underline"},_focusVisible:{boxShadow:"outline"}},Che={baseStyle:She},{defineMultiStyleConfig:whe,definePartsStyle:_he}=ga(Ade.keys),Ahe={marginEnd:"2",display:"inline",verticalAlign:"text-bottom"},The=_he({icon:Ahe}),Ehe=whe({baseStyle:The}),{defineMultiStyleConfig:Phe,definePartsStyle:Ihe}=ga(Tde.keys),Mhe=e=>({bg:At("#fff","gray.700")(e),boxShadow:At("sm","dark-lg")(e),color:"inherit",minW:"3xs",py:"2",zIndex:1,borderRadius:"md",borderWidth:"1px"}),Dhe=e=>({py:"1.5",px:"3",transitionProperty:"background",transitionDuration:"ultra-fast",transitionTimingFunction:"ease-in",_focus:{bg:At("gray.100","whiteAlpha.100")(e)},_active:{bg:At("gray.200","whiteAlpha.200")(e)},_expanded:{bg:At("gray.100","whiteAlpha.100")(e)},_disabled:{opacity:.4,cursor:"not-allowed"}}),khe={mx:4,my:2,fontWeight:"semibold",fontSize:"sm"},Rhe={opacity:.6},Ohe={border:0,borderBottom:"1px solid",borderColor:"inherit",my:"2",opacity:.6},Bhe={transitionProperty:"common",transitionDuration:"normal"},Fhe=Ihe(e=>({button:Bhe,list:Fa(Mhe,e),item:Fa(Dhe,e),groupTitle:khe,command:Rhe,divider:Ohe})),Lhe=Phe({baseStyle:Fhe}),{defineMultiStyleConfig:Nhe,definePartsStyle:kP}=ga(Ede.keys),zhe={bg:"blackAlpha.600",zIndex:"modal"},Uhe=e=>{const{isCentered:t,scrollBehavior:r}=e;return{display:"flex",zIndex:"modal",justifyContent:"center",alignItems:t?"center":"flex-start",overflow:r==="inside"?"hidden":"auto"}},Vhe=e=>{const{scrollBehavior:t}=e;return{borderRadius:"md",bg:At("white","gray.700")(e),color:"inherit",my:"16",zIndex:"modal",maxH:t==="inside"?"calc(100% - 7.5rem)":void 0,boxShadow:At("lg","dark-lg")(e)}},Hhe={px:"6",py:"4",fontSize:"xl",fontWeight:"semibold"},jhe={position:"absolute",top:"2",insetEnd:"3"},Ghe=e=>{const{scrollBehavior:t}=e;return{px:"6",py:"2",flex:"1",overflow:t==="inside"?"auto":void 0}},qhe={px:"6",py:"4"},Whe=kP(e=>({overlay:zhe,dialogContainer:Fa(Uhe,e),dialog:Fa(Vhe,e),header:Hhe,closeButton:jhe,body:Fa(Ghe,e),footer:qhe}));function Iu(e){return kP(e==="full"?{dialog:{maxW:"100vw",minH:"$100vh",my:"0",borderRadius:"0"}}:{dialog:{maxW:e}})}var Xhe={xs:Iu("xs"),sm:Iu("sm"),md:Iu("md"),lg:Iu("lg"),xl:Iu("xl"),"2xl":Iu("2xl"),"3xl":Iu("3xl"),"4xl":Iu("4xl"),"5xl":Iu("5xl"),"6xl":Iu("6xl"),full:Iu("full")},Yhe=Nhe({baseStyle:Whe,sizes:Xhe,defaultProps:{size:"md"}}),Khe={letterSpacings:{tighter:"-0.05em",tight:"-0.025em",normal:"0",wide:"0.025em",wider:"0.05em",widest:"0.1em"},lineHeights:{normal:"normal",none:1,shorter:1.25,short:1.375,base:1.5,tall:1.625,taller:"2",3:".75rem",4:"1rem",5:"1.25rem",6:"1.5rem",7:"1.75rem",8:"2rem",9:"2.25rem",10:"2.5rem"},fontWeights:{hairline:100,thin:200,light:300,normal:400,medium:500,semibold:600,bold:700,extrabold:800,black:900},fonts:{heading:'-apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',body:'-apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',mono:'SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace'},fontSizes:{"3xs":"0.45rem","2xs":"0.625rem",xs:"0.75rem",sm:"0.875rem",md:"1rem",lg:"1.125rem",xl:"1.25rem","2xl":"1.5rem","3xl":"1.875rem","4xl":"2.25rem","5xl":"3rem","6xl":"3.75rem","7xl":"4.5rem","8xl":"6rem","9xl":"8rem"}},eq=Khe,{defineMultiStyleConfig:$he,definePartsStyle:tq}=ga(Pde.keys),RD=Xo("number-input-stepper-width"),rq=Xo("number-input-input-padding"),Qhe=Hc(RD).add("0.5rem").toString(),Zhe={[RD.variable]:"sizes.6",[rq.variable]:Qhe},Jhe=e=>{var t;return((t=Fa(Sn.baseStyle,e))==null?void 0:t.field)??{}},eme={width:[RD.reference]},tme=e=>({borderStart:"1px solid",borderStartColor:At("inherit","whiteAlpha.300")(e),color:At("inherit","whiteAlpha.800")(e),_active:{bg:At("gray.200","whiteAlpha.300")(e)},_disabled:{opacity:.4,cursor:"not-allowed"}}),rme=tq(e=>({root:Zhe,field:Jhe,stepperGroup:eme,stepper:Fa(tme,e)??{}}));function M2(e){var t,r;const n=(t=Sn.sizes)==null?void 0:t[e],a={lg:"md",md:"md",sm:"sm",xs:"sm"},i=((r=n.field)==null?void 0:r.fontSize)??"md",o=eq.fontSizes[i];return tq({field:{...n.field,paddingInlineEnd:rq.reference,verticalAlign:"top"},stepper:{fontSize:Hc(o).multiply(.75).toString(),_first:{borderTopEndRadius:a[e]},_last:{borderBottomEndRadius:a[e],mt:"-1px",borderTopWidth:1}}})}var nme={xs:M2("xs"),sm:M2("sm"),md:M2("md"),lg:M2("lg")},ame=$he({baseStyle:rme,sizes:nme,variants:Sn.variants,defaultProps:Sn.defaultProps}),SB,ime={...(SB=Sn.baseStyle)==null?void 0:SB.field,textAlign:"center"},ome={lg:{fontSize:"lg",w:12,h:12,borderRadius:"md"},md:{fontSize:"md",w:10,h:10,borderRadius:"md"},sm:{fontSize:"sm",w:8,h:8,borderRadius:"sm"},xs:{fontSize:"xs",w:6,h:6,borderRadius:"sm"}},CB,sme={outline:e=>{var t,r;return((r=Fa((t=Sn.variants)==null?void 0:t.outline,e))==null?void 0:r.field)??{}},flushed:e=>{var t,r;return((r=Fa((t=Sn.variants)==null?void 0:t.flushed,e))==null?void 0:r.field)??{}},filled:e=>{var t,r;return((r=Fa((t=Sn.variants)==null?void 0:t.filled,e))==null?void 0:r.field)??{}},unstyled:((CB=Sn.variants)==null?void 0:CB.unstyled.field)??{}},ume={baseStyle:ime,sizes:ome,variants:sme,defaultProps:Sn.defaultProps},{defineMultiStyleConfig:lme,definePartsStyle:cme}=ga(Ide.keys),K4=Xo("popper-bg"),dme=Xo("popper-arrow-bg"),fme=Xo("popper-arrow-shadow-color"),pme={zIndex:10},hme=e=>{const t=At("white","gray.700")(e),r=At("gray.200","whiteAlpha.300")(e);return{[K4.variable]:`colors.${t}`,bg:K4.reference,[dme.variable]:K4.reference,[fme.variable]:`colors.${r}`,width:"xs",border:"1px solid",borderColor:"inherit",borderRadius:"md",boxShadow:"sm",zIndex:"inherit",_focusVisible:{outline:0,boxShadow:"outline"}}},mme={px:3,py:2,borderBottomWidth:"1px"},vme={px:3,py:2},gme={px:3,py:2,borderTopWidth:"1px"},yme={position:"absolute",borderRadius:"md",top:1,insetEnd:2,padding:2},bme=cme(e=>({popper:pme,content:hme(e),header:mme,body:vme,footer:gme,closeButton:yme})),xme=lme({baseStyle:bme}),{defineMultiStyleConfig:Sme,definePartsStyle:Qg}=ga(Mde.keys),Cme=e=>{const{colorScheme:t,theme:r,isIndeterminate:n,hasStripe:a}=e,i=At(vB(),vB("1rem","rgba(0,0,0,0.1)"))(e),o=At(`${t}.500`,`${t}.200`)(e),s=`linear-gradient(
    to right,
    transparent 0%,
    ${ei(r,o)} 50%,
    transparent 100%
  )`;return{...!n&&a&&i,...n?{bgImage:s}:{bgColor:o}}},wme={lineHeight:"1",fontSize:"0.25em",fontWeight:"bold",color:"white"},_me=e=>({bg:At("gray.100","whiteAlpha.300")(e)}),Ame=e=>({transitionProperty:"common",transitionDuration:"slow",...Cme(e)}),Tme=Qg(e=>({label:wme,filledTrack:Ame(e),track:_me(e)})),Eme={xs:Qg({track:{h:"1"}}),sm:Qg({track:{h:"2"}}),md:Qg({track:{h:"3"}}),lg:Qg({track:{h:"4"}})},Pme=Sme({sizes:Eme,baseStyle:Tme,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:Ime,definePartsStyle:nS}=ga(Dde.keys),Mme=e=>{var t;const r=(t=Fa(pC.baseStyle,e))==null?void 0:t.control;return{...r,borderRadius:"full",_checked:{...r?._checked,_before:{content:'""',display:"inline-block",pos:"relative",w:"50%",h:"50%",borderRadius:"50%",bg:"currentColor"}}}},Dme=nS(e=>{var t,r,n,a;return{label:(r=(t=pC).baseStyle)==null?void 0:r.call(t,e).label,container:(a=(n=pC).baseStyle)==null?void 0:a.call(n,e).container,control:Mme(e)}}),kme={md:nS({control:{w:"4",h:"4"},label:{fontSize:"md"}}),lg:nS({control:{w:"5",h:"5"},label:{fontSize:"lg"}}),sm:nS({control:{width:"3",height:"3"},label:{fontSize:"sm"}})},Rme=Ime({baseStyle:Dme,sizes:kme,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:Ome,definePartsStyle:Bme}=ga(kde.keys),Fme=e=>{var t;return{...(t=Sn.baseStyle)==null?void 0:t.field,bg:At("white","gray.700")(e),appearance:"none",paddingBottom:"1px",lineHeight:"normal","> option, > optgroup":{bg:At("white","gray.700")(e)}}},Lme={width:"6",height:"100%",insetEnd:"2",position:"relative",color:"currentColor",fontSize:"xl",_disabled:{opacity:.5}},Nme=Bme(e=>({field:Fme(e),icon:Lme})),D2={paddingInlineEnd:"8"},wB,_B,AB,TB,EB,PB,IB,MB,zme={lg:{...(wB=Sn.sizes)==null?void 0:wB.lg,field:{...(_B=Sn.sizes)==null?void 0:_B.lg.field,...D2}},md:{...(AB=Sn.sizes)==null?void 0:AB.md,field:{...(TB=Sn.sizes)==null?void 0:TB.md.field,...D2}},sm:{...(EB=Sn.sizes)==null?void 0:EB.sm,field:{...(PB=Sn.sizes)==null?void 0:PB.sm.field,...D2}},xs:{...(IB=Sn.sizes)==null?void 0:IB.xs,field:{...(MB=Sn.sizes)==null?void 0:MB.xs.field,...D2},icon:{insetEnd:"1"}}},Ume=Ome({baseStyle:Nme,sizes:zme,variants:Sn.variants,defaultProps:Sn.defaultProps}),Vme=Ip("skeleton-start-color"),Hme=Ip("skeleton-end-color"),jme=e=>{const t=At("gray.100","gray.800")(e),r=At("gray.400","gray.600")(e),{startColor:n=t,endColor:a=r,theme:i}=e,o=ei(i,n),s=ei(i,a);return{[Vme.variable]:o,[Hme.variable]:s,opacity:.7,borderRadius:"2px",borderColor:o,background:s}},Gme={baseStyle:jme},qme=e=>({borderRadius:"md",fontWeight:"semibold",_focusVisible:{boxShadow:"outline",padding:"4",position:"fixed",top:"6",insetStart:"6",bg:At("white","gray.700")(e)}}),Wme={baseStyle:qme},{defineMultiStyleConfig:Xme,definePartsStyle:Ew}=ga(Rde.keys),C1=Ip("slider-thumb-size"),w1=Ip("slider-track-size"),Yme=e=>{const{orientation:t}=e;return{display:"inline-block",position:"relative",cursor:"pointer",_disabled:{opacity:.6,cursor:"default",pointerEvents:"none"},...MD({orientation:t,vertical:{h:"100%"},horizontal:{w:"100%"}})}},Kme=e=>({...MD({orientation:e.orientation,horizontal:{h:w1.reference},vertical:{w:w1.reference}}),overflow:"hidden",borderRadius:"sm",bg:At("gray.200","whiteAlpha.200")(e),_disabled:{bg:At("gray.300","whiteAlpha.300")(e)}}),$me=e=>{const{orientation:t}=e;return{...MD({orientation:t,vertical:{left:"50%",transform:"translateX(-50%)",_active:{transform:"translateX(-50%) scale(1.15)"}},horizontal:{top:"50%",transform:"translateY(-50%)",_active:{transform:"translateY(-50%) scale(1.15)"}}}),w:C1.reference,h:C1.reference,display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",outline:0,zIndex:1,borderRadius:"full",bg:"white",boxShadow:"base",border:"1px solid",borderColor:"transparent",transitionProperty:"transform",transitionDuration:"normal",_focusVisible:{boxShadow:"outline"},_disabled:{bg:"gray.300"}}},Qme=e=>{const{colorScheme:t}=e;return{width:"inherit",height:"inherit",bg:At(`${t}.500`,`${t}.200`)(e)}},Zme=Ew(e=>({container:Yme(e),track:Kme(e),thumb:$me(e),filledTrack:Qme(e)})),Jme=Ew({container:{[C1.variable]:"sizes.4",[w1.variable]:"sizes.1"}}),eve=Ew({container:{[C1.variable]:"sizes.3.5",[w1.variable]:"sizes.1"}}),tve=Ew({container:{[C1.variable]:"sizes.2.5",[w1.variable]:"sizes.0.5"}}),rve={lg:Jme,md:eve,sm:tve},nve=Xme({baseStyle:Zme,sizes:rve,defaultProps:{size:"md",colorScheme:"blue"}}),gh=Xo("spinner-size"),ave={width:[gh.reference],height:[gh.reference]},ive={xs:{[gh.variable]:"sizes.3"},sm:{[gh.variable]:"sizes.4"},md:{[gh.variable]:"sizes.6"},lg:{[gh.variable]:"sizes.8"},xl:{[gh.variable]:"sizes.12"}},ove={baseStyle:ave,sizes:ive,defaultProps:{size:"md"}},{defineMultiStyleConfig:sve,definePartsStyle:nq}=ga(Ode.keys),uve={fontWeight:"medium"},lve={opacity:.8,marginBottom:"2"},cve={verticalAlign:"baseline",fontWeight:"semibold"},dve={marginEnd:1,w:"3.5",h:"3.5",verticalAlign:"middle"},fve=nq({container:{},label:uve,helpText:lve,number:cve,icon:dve}),pve={md:nq({label:{fontSize:"sm"},helpText:{fontSize:"sm"},number:{fontSize:"2xl"}})},hve=sve({baseStyle:fve,sizes:pve,defaultProps:{size:"md"}}),{defineMultiStyleConfig:mve,definePartsStyle:aS}=ga(Bde.keys),My=Xo("switch-track-width"),Nh=Xo("switch-track-height"),$4=Xo("switch-track-diff"),vve=Hc.subtract(My,Nh),RP=Xo("switch-thumb-x"),gve=e=>{const{colorScheme:t}=e;return{borderRadius:"full",p:"0.5",width:[My.reference],height:[Nh.reference],transitionProperty:"common",transitionDuration:"fast",bg:At("gray.300","whiteAlpha.400")(e),_focusVisible:{boxShadow:"outline"},_disabled:{opacity:.4,cursor:"not-allowed"},_checked:{bg:At(`${t}.500`,`${t}.200`)(e)}}},yve={bg:"white",transitionProperty:"transform",transitionDuration:"normal",borderRadius:"inherit",width:[Nh.reference],height:[Nh.reference],_checked:{transform:`translateX(${RP.reference})`}},bve=aS(e=>({container:{[$4.variable]:vve,[RP.variable]:$4.reference,_rtl:{[RP.variable]:Hc($4).negate().toString()}},track:gve(e),thumb:yve})),xve={sm:aS({container:{[My.variable]:"1.375rem",[Nh.variable]:"sizes.3"}}),md:aS({container:{[My.variable]:"1.875rem",[Nh.variable]:"sizes.4"}}),lg:aS({container:{[My.variable]:"2.875rem",[Nh.variable]:"sizes.6"}})},Sve=mve({baseStyle:bve,sizes:xve,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:Cve,definePartsStyle:Xv}=ga(Fde.keys),wve=Xv({table:{fontVariantNumeric:"lining-nums tabular-nums",borderCollapse:"collapse",width:"full"},th:{fontFamily:"heading",fontWeight:"bold",textTransform:"uppercase",letterSpacing:"wider",textAlign:"start"},td:{textAlign:"start"},caption:{mt:4,fontFamily:"heading",textAlign:"center",fontWeight:"medium"}}),hC={"&[data-is-numeric=true]":{textAlign:"end"}},_ve=Xv(e=>{const{colorScheme:t}=e;return{th:{color:At("gray.600","gray.400")(e),borderBottom:"1px",borderColor:At(`${t}.100`,`${t}.700`)(e),...hC},td:{borderBottom:"1px",borderColor:At(`${t}.100`,`${t}.700`)(e),...hC},caption:{color:At("gray.600","gray.100")(e)},tfoot:{tr:{"&:last-of-type":{th:{borderBottomWidth:0}}}}}}),Ave=Xv(e=>{const{colorScheme:t}=e;return{th:{color:At("gray.600","gray.400")(e),borderBottom:"1px",borderColor:At(`${t}.100`,`${t}.700`)(e),...hC},td:{borderBottom:"1px",borderColor:At(`${t}.100`,`${t}.700`)(e),...hC},caption:{color:At("gray.600","gray.100")(e)},tbody:{tr:{"&:nth-of-type(odd)":{"th, td":{borderBottomWidth:"1px",borderColor:At(`${t}.100`,`${t}.700`)(e)},td:{background:At(`${t}.100`,`${t}.700`)(e)}}}},tfoot:{tr:{"&:last-of-type":{th:{borderBottomWidth:0}}}}}}),Tve={simple:_ve,striped:Ave,unstyled:{}},Eve={sm:Xv({th:{px:"4",py:"1",lineHeight:"4",fontSize:"xs"},td:{px:"4",py:"2",fontSize:"sm",lineHeight:"4"},caption:{px:"4",py:"2",fontSize:"xs"}}),md:Xv({th:{px:"6",py:"3",lineHeight:"4",fontSize:"xs"},td:{px:"6",py:"4",lineHeight:"5"},caption:{px:"6",py:"2",fontSize:"sm"}}),lg:Xv({th:{px:"8",py:"4",lineHeight:"5",fontSize:"sm"},td:{px:"8",py:"5",lineHeight:"6"},caption:{px:"6",py:"2",fontSize:"md"}})},Pve=Cve({baseStyle:wve,variants:Tve,sizes:Eve,defaultProps:{variant:"simple",size:"md",colorScheme:"gray"}}),{defineMultiStyleConfig:Ive,definePartsStyle:ec}=ga(Lde.keys),Mve=e=>{const{orientation:t}=e;return{display:t==="vertical"?"flex":"block"}},Dve=e=>{const{isFitted:t}=e;return{flex:t?1:void 0,transitionProperty:"common",transitionDuration:"normal",_focusVisible:{zIndex:1,boxShadow:"outline"},_disabled:{cursor:"not-allowed",opacity:.4}}},kve=e=>{const{align:t="start",orientation:r}=e;return{justifyContent:{end:"flex-end",center:"center",start:"flex-start"}[t],flexDirection:r==="vertical"?"column":"row"}},Rve={p:4},Ove=ec(e=>({root:Mve(e),tab:Dve(e),tablist:kve(e),tabpanel:Rve})),Bve={sm:ec({tab:{py:1,px:4,fontSize:"sm"}}),md:ec({tab:{fontSize:"md",py:2,px:4}}),lg:ec({tab:{fontSize:"lg",py:3,px:4}})},Fve=ec(e=>{const{colorScheme:t,orientation:r}=e,n=r==="vertical",a=r==="vertical"?"borderStart":"borderBottom",i=n?"marginStart":"marginBottom";return{tablist:{[a]:"2px solid",borderColor:"inherit"},tab:{[a]:"2px solid",borderColor:"transparent",[i]:"-2px",_selected:{color:At(`${t}.600`,`${t}.300`)(e),borderColor:"currentColor"},_active:{bg:At("gray.200","whiteAlpha.300")(e)},_disabled:{_active:{bg:"none"}}}}}),Lve=ec(e=>{const{colorScheme:t}=e;return{tab:{borderTopRadius:"md",border:"1px solid",borderColor:"transparent",mb:"-1px",_selected:{color:At(`${t}.600`,`${t}.300`)(e),borderColor:"inherit",borderBottomColor:At("white","gray.800")(e)}},tablist:{mb:"-1px",borderBottom:"1px solid",borderColor:"inherit"}}}),Nve=ec(e=>{const{colorScheme:t}=e;return{tab:{border:"1px solid",borderColor:"inherit",bg:At("gray.50","whiteAlpha.50")(e),mb:"-1px",_notLast:{marginEnd:"-1px"},_selected:{bg:At("#fff","gray.800")(e),color:At(`${t}.600`,`${t}.300`)(e),borderColor:"inherit",borderTopColor:"currentColor",borderBottomColor:"transparent"}},tablist:{mb:"-1px",borderBottom:"1px solid",borderColor:"inherit"}}}),zve=ec(e=>{const{colorScheme:t,theme:r}=e;return{tab:{borderRadius:"full",fontWeight:"semibold",color:"gray.600",_selected:{color:ei(r,`${t}.700`),bg:ei(r,`${t}.100`)}}}}),Uve=ec(e=>{const{colorScheme:t}=e;return{tab:{borderRadius:"full",fontWeight:"semibold",color:At("gray.600","inherit")(e),_selected:{color:At("#fff","gray.800")(e),bg:At(`${t}.600`,`${t}.300`)(e)}}}}),Vve=ec({}),Hve={line:Fve,enclosed:Lve,"enclosed-colored":Nve,"soft-rounded":zve,"solid-rounded":Uve,unstyled:Vve},jve=Ive({baseStyle:Ove,sizes:Bve,variants:Hve,defaultProps:{size:"md",variant:"line",colorScheme:"blue"}}),{defineMultiStyleConfig:Gve,definePartsStyle:zh}=ga(Nde.keys),qve={fontWeight:"medium",lineHeight:1.2,outline:0,borderRadius:"md",_focusVisible:{boxShadow:"outline"}},Wve={lineHeight:1.2,overflow:"visible"},Xve={fontSize:"lg",w:"5",h:"5",transitionProperty:"common",transitionDuration:"normal",borderRadius:"full",marginStart:"1.5",marginEnd:"-1",opacity:.5,_disabled:{opacity:.4},_focusVisible:{boxShadow:"outline",bg:"rgba(0, 0, 0, 0.14)"},_hover:{opacity:.8},_active:{opacity:1}},Yve=zh({container:qve,label:Wve,closeButton:Xve}),Kve={sm:zh({container:{minH:"5",minW:"5",fontSize:"xs",px:"2"},closeButton:{marginEnd:"-2px",marginStart:"0.35rem"}}),md:zh({container:{minH:"6",minW:"6",fontSize:"sm",px:"2"}}),lg:zh({container:{minH:"8",minW:"8",fontSize:"md",px:"3"}})},$ve={subtle:zh(e=>{var t;return{container:(t=Ey.variants)==null?void 0:t.subtle(e)}}),solid:zh(e=>{var t;return{container:(t=Ey.variants)==null?void 0:t.solid(e)}}),outline:zh(e=>{var t;return{container:(t=Ey.variants)==null?void 0:t.outline(e)}})},Qve=Gve({variants:$ve,baseStyle:Yve,sizes:Kve,defaultProps:{size:"md",variant:"subtle",colorScheme:"gray"}}),DB,Zve={...(DB=Sn.baseStyle)==null?void 0:DB.field,paddingY:"2",minHeight:"20",lineHeight:"short",verticalAlign:"top"},kB,Jve={outline:e=>{var t;return((t=Sn.variants)==null?void 0:t.outline(e).field)??{}},flushed:e=>{var t;return((t=Sn.variants)==null?void 0:t.flushed(e).field)??{}},filled:e=>{var t;return((t=Sn.variants)==null?void 0:t.filled(e).field)??{}},unstyled:((kB=Sn.variants)==null?void 0:kB.unstyled.field)??{}},RB,OB,BB,FB,e0e={xs:((RB=Sn.sizes)==null?void 0:RB.xs.field)??{},sm:((OB=Sn.sizes)==null?void 0:OB.sm.field)??{},md:((BB=Sn.sizes)==null?void 0:BB.md.field)??{},lg:((FB=Sn.sizes)==null?void 0:FB.lg.field)??{}},t0e={baseStyle:Zve,sizes:e0e,variants:Jve,defaultProps:{size:"md",variant:"outline"}},Q4=Xo("tooltip-bg"),LB=Xo("tooltip-fg"),r0e=Xo("popper-arrow-bg"),n0e=e=>{const t=At("gray.700","gray.300")(e),r=At("whiteAlpha.900","gray.900")(e);return{bg:Q4.reference,color:LB.reference,[Q4.variable]:`colors.${t}`,[LB.variable]:`colors.${r}`,[r0e.variable]:Q4.reference,px:"2",py:"0.5",borderRadius:"sm",fontWeight:"medium",fontSize:"sm",boxShadow:"md",maxW:"xs",zIndex:"tooltip"}},a0e={baseStyle:n0e},i0e={Accordion:_fe,Alert:kfe,Avatar:jfe,Badge:Ey,Breadcrumb:Jfe,Button:upe,Checkbox:pC,CloseButton:ype,Code:Cpe,Container:_pe,Divider:Ipe,Drawer:Upe,Editable:Xpe,Form:Jpe,FormError:ihe,FormLabel:she,Heading:che,Input:Sn,Kbd:xhe,Link:Che,List:Ehe,Menu:Lhe,Modal:Yhe,NumberInput:ame,PinInput:ume,Popover:xme,Progress:Pme,Radio:Rme,Select:Ume,Skeleton:Gme,SkipLink:Wme,Slider:nve,Spinner:ove,Stat:hve,Switch:Sve,Table:Pve,Tabs:jve,Tag:Qve,Textarea:t0e,Tooltip:a0e},o0e={none:0,"1px":"1px solid","2px":"2px solid","4px":"4px solid","8px":"8px solid"},s0e=o0e,u0e={base:"0em",sm:"30em",md:"48em",lg:"62em",xl:"80em","2xl":"96em"},l0e=u0e,c0e={transparent:"transparent",current:"currentColor",black:"#000000",white:"#FFFFFF",whiteAlpha:{50:"rgba(255, 255, 255, 0.04)",100:"rgba(255, 255, 255, 0.06)",200:"rgba(255, 255, 255, 0.08)",300:"rgba(255, 255, 255, 0.16)",400:"rgba(255, 255, 255, 0.24)",500:"rgba(255, 255, 255, 0.36)",600:"rgba(255, 255, 255, 0.48)",700:"rgba(255, 255, 255, 0.64)",800:"rgba(255, 255, 255, 0.80)",900:"rgba(255, 255, 255, 0.92)"},blackAlpha:{50:"rgba(0, 0, 0, 0.04)",100:"rgba(0, 0, 0, 0.06)",200:"rgba(0, 0, 0, 0.08)",300:"rgba(0, 0, 0, 0.16)",400:"rgba(0, 0, 0, 0.24)",500:"rgba(0, 0, 0, 0.36)",600:"rgba(0, 0, 0, 0.48)",700:"rgba(0, 0, 0, 0.64)",800:"rgba(0, 0, 0, 0.80)",900:"rgba(0, 0, 0, 0.92)"},gray:{50:"#F7FAFC",100:"#EDF2F7",200:"#E2E8F0",300:"#CBD5E0",400:"#A0AEC0",500:"#718096",600:"#4A5568",700:"#2D3748",800:"#1A202C",900:"#171923"},red:{50:"#FFF5F5",100:"#FED7D7",200:"#FEB2B2",300:"#FC8181",400:"#F56565",500:"#E53E3E",600:"#C53030",700:"#9B2C2C",800:"#822727",900:"#63171B"},orange:{50:"#FFFAF0",100:"#FEEBC8",200:"#FBD38D",300:"#F6AD55",400:"#ED8936",500:"#DD6B20",600:"#C05621",700:"#9C4221",800:"#7B341E",900:"#652B19"},yellow:{50:"#FFFFF0",100:"#FEFCBF",200:"#FAF089",300:"#F6E05E",400:"#ECC94B",500:"#D69E2E",600:"#B7791F",700:"#975A16",800:"#744210",900:"#5F370E"},green:{50:"#F0FFF4",100:"#C6F6D5",200:"#9AE6B4",300:"#68D391",400:"#48BB78",500:"#38A169",600:"#2F855A",700:"#276749",800:"#22543D",900:"#1C4532"},teal:{50:"#E6FFFA",100:"#B2F5EA",200:"#81E6D9",300:"#4FD1C5",400:"#38B2AC",500:"#319795",600:"#2C7A7B",700:"#285E61",800:"#234E52",900:"#1D4044"},blue:{50:"#ebf8ff",100:"#bee3f8",200:"#90cdf4",300:"#63b3ed",400:"#4299e1",500:"#3182ce",600:"#2b6cb0",700:"#2c5282",800:"#2a4365",900:"#1A365D"},cyan:{50:"#EDFDFD",100:"#C4F1F9",200:"#9DECF9",300:"#76E4F7",400:"#0BC5EA",500:"#00B5D8",600:"#00A3C4",700:"#0987A0",800:"#086F83",900:"#065666"},purple:{50:"#FAF5FF",100:"#E9D8FD",200:"#D6BCFA",300:"#B794F4",400:"#9F7AEA",500:"#805AD5",600:"#6B46C1",700:"#553C9A",800:"#44337A",900:"#322659"},pink:{50:"#FFF5F7",100:"#FED7E2",200:"#FBB6CE",300:"#F687B3",400:"#ED64A6",500:"#D53F8C",600:"#B83280",700:"#97266D",800:"#702459",900:"#521B41"},linkedin:{50:"#E8F4F9",100:"#CFEDFB",200:"#9BDAF3",300:"#68C7EC",400:"#34B3E4",500:"#00A0DC",600:"#008CC9",700:"#0077B5",800:"#005E93",900:"#004471"},facebook:{50:"#E8F4F9",100:"#D9DEE9",200:"#B7C2DA",300:"#6482C0",400:"#4267B2",500:"#385898",600:"#314E89",700:"#29487D",800:"#223B67",900:"#1E355B"},messenger:{50:"#D0E6FF",100:"#B9DAFF",200:"#A2CDFF",300:"#7AB8FF",400:"#2E90FF",500:"#0078FF",600:"#0063D1",700:"#0052AC",800:"#003C7E",900:"#002C5C"},whatsapp:{50:"#dffeec",100:"#b9f5d0",200:"#90edb3",300:"#65e495",400:"#3cdd78",500:"#22c35e",600:"#179848",700:"#0c6c33",800:"#01421c",900:"#001803"},twitter:{50:"#E5F4FD",100:"#C8E9FB",200:"#A8DCFA",300:"#83CDF7",400:"#57BBF5",500:"#1DA1F2",600:"#1A94DA",700:"#1681BF",800:"#136B9E",900:"#0D4D71"},telegram:{50:"#E3F2F9",100:"#C5E4F3",200:"#A2D4EC",300:"#7AC1E4",400:"#47A9DA",500:"#0088CC",600:"#007AB8",700:"#006BA1",800:"#005885",900:"#003F5E"}},d0e=c0e,f0e={none:"0",sm:"0.125rem",base:"0.25rem",md:"0.375rem",lg:"0.5rem",xl:"0.75rem","2xl":"1rem","3xl":"1.5rem",full:"9999px"},p0e=f0e,h0e={xs:"0 0 0 1px rgba(0, 0, 0, 0.05)",sm:"0 1px 2px 0 rgba(0, 0, 0, 0.05)",base:"0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06)",md:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)",lg:"0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)",xl:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)","2xl":"0 25px 50px -12px rgba(0, 0, 0, 0.25)",outline:"0 0 0 3px rgba(66, 153, 225, 0.6)",inner:"inset 0 2px 4px 0 rgba(0,0,0,0.06)",none:"none","dark-lg":"rgba(0, 0, 0, 0.1) 0px 0px 0px 1px, rgba(0, 0, 0, 0.2) 0px 5px 10px, rgba(0, 0, 0, 0.4) 0px 15px 40px"},m0e=h0e,v0e={common:"background-color, border-color, color, fill, stroke, opacity, box-shadow, transform",colors:"background-color, border-color, color, fill, stroke",dimensions:"width, height",position:"left, right, top, bottom",background:"background-color, background-image, background-position"},g0e={"ease-in":"cubic-bezier(0.4, 0, 1, 1)","ease-out":"cubic-bezier(0, 0, 0.2, 1)","ease-in-out":"cubic-bezier(0.4, 0, 0.2, 1)"},y0e={"ultra-fast":"50ms",faster:"100ms",fast:"150ms",normal:"200ms",slow:"300ms",slower:"400ms","ultra-slow":"500ms"},b0e={property:v0e,easing:g0e,duration:y0e},x0e=b0e,S0e={hide:-1,auto:"auto",base:0,docked:10,dropdown:1e3,sticky:1100,banner:1200,overlay:1300,modal:1400,popover:1500,skipLink:1600,toast:1700,tooltip:1800},C0e=S0e,w0e={none:0,sm:"4px",base:"8px",md:"12px",lg:"16px",xl:"24px","2xl":"40px","3xl":"64px"},_0e=w0e,A0e={breakpoints:l0e,zIndices:C0e,radii:p0e,blur:_0e,colors:d0e,...eq,sizes:QG,shadows:m0e,space:$G,borders:s0e,transition:x0e},T0e={colors:{"chakra-body-text":{_light:"gray.800",_dark:"whiteAlpha.900"},"chakra-body-bg":{_light:"white",_dark:"gray.800"},"chakra-border-color":{_light:"gray.200",_dark:"whiteAlpha.300"},"chakra-placeholder-color":{_light:"gray.500",_dark:"whiteAlpha.400"}}},E0e={global:{body:{fontFamily:"body",color:"chakra-body-text",bg:"chakra-body-bg",transitionProperty:"background-color",transitionDuration:"normal",lineHeight:"base"},"*::placeholder":{color:"chakra-placeholder-color"},"*, *::before, &::after":{borderColor:"chakra-border-color",wordWrap:"break-word"}}},P0e="ltr",I0e={useSystemColorMode:!1,initialColorMode:"light",cssVarPrefix:"chakra"},M0e={semanticTokens:T0e,direction:P0e,...A0e,components:i0e,styles:E0e,config:I0e};function D0e(e,t){const r=toe(e);ke.exports.useEffect(()=>{if(t==null)return;let n=null;return n=window.setTimeout(()=>{r()},t),()=>{n&&window.clearTimeout(n)}},[t,r])}function k0e(e,...t){return R0e(e)?e(...t):e}var R0e=e=>typeof e=="function",O0e=(e,t)=>e.find(r=>r.id===t);function NB(e,t){const r=aq(e,t),n=r?e[r].findIndex(a=>a.id===t):-1;return{position:r,index:n}}function aq(e,t){for(const[r,n]of Object.entries(e))if(O0e(n,t))return r}function B0e(e){const t=e.includes("right"),r=e.includes("left");let n="center";return t&&(n="flex-end"),r&&(n="flex-start"),{display:"flex",flexDirection:"column",alignItems:n}}function F0e(e){const r=e==="top"||e==="bottom"?"0 auto":void 0,n=e.includes("top")?"env(safe-area-inset-top, 0px)":void 0,a=e.includes("bottom")?"env(safe-area-inset-bottom, 0px)":void 0,i=e.includes("left")?void 0:"env(safe-area-inset-right, 0px)",o=e.includes("right")?void 0:"env(safe-area-inset-left, 0px)";return{position:"fixed",zIndex:5500,pointerEvents:"none",display:"flex",flexDirection:"column",margin:r,top:n,bottom:a,right:i,left:o}}var L0e={top:[],"top-left":[],"top-right":[],"bottom-left":[],bottom:[],"bottom-right":[]},Dy=N0e(L0e);function N0e(e){let t=e;const r=new Set,n=a=>{t=a(t),r.forEach(i=>i())};return{getState:()=>t,subscribe:a=>(r.add(a),()=>{n(()=>e),r.delete(a)}),removeToast:(a,i)=>{n(o=>({...o,[i]:o[i].filter(s=>s.id!=a)}))},notify:(a,i)=>{const o=z0e(a,i),{position:s,id:u}=o;return n(l=>{const d=s.includes("top")?[o,...l[s]??[]]:[...l[s]??[],o];return{...l,[s]:d}}),u},update:(a,i)=>{!a||n(o=>{const s={...o},{position:u,index:l}=NB(s,a);return u&&l!==-1&&(s[u][l]={...s[u][l],...i,message:V0e(i)}),s})},closeAll:({positions:a}={})=>{n(i=>(a??["bottom","bottom-right","bottom-left","top","top-left","top-right"]).reduce((u,l)=>(u[l]=i[l].map(c=>({...c,requestClose:!0})),u),{...i}))},close:a=>{n(i=>{const o=aq(i,a);return o?{...i,[o]:i[o].map(s=>s.id==a?{...s,requestClose:!0}:s)}:i})},isActive:a=>Boolean(NB(Dy.getState(),a).position)}}var zB=0;function z0e(e,t={}){zB+=1;const r=t.id??zB,n=t.position??"bottom";return{id:r,message:e,position:n,duration:t.duration,onCloseComplete:t.onCloseComplete,onRequestRemove:()=>Dy.removeToast(String(r),n),status:t.status,requestClose:!1,containerStyle:t.containerStyle}}var U0e=e=>{const{status:t,variant:r="solid",id:n,title:a,isClosable:i,onClose:o,description:s,icon:u}=e,l=n?{root:`toast-${n}`,title:`toast-${n}-title`,description:`toast-${n}-description`}:void 0;return sa.createElement(DG,{addRole:!1,status:t,variant:r,id:l?.root,alignItems:"start",borderRadius:"md",boxShadow:"lg",paddingEnd:8,textAlign:"start",width:"auto"},B(RG,{children:u}),sa.createElement(tl.div,{flex:"1",maxWidth:"100%"},a&&B(OG,{id:l?.title,children:a}),s&&B(kG,{id:l?.description,display:"block",children:s})),i&&B(BG,{size:"sm",onClick:o,position:"absolute",insetEnd:1,top:1}))};function V0e(e={}){const{render:t,toastComponent:r=U0e}=e;return a=>typeof t=="function"?t(a):B(r,{...a,...e})}var H0e={initial:e=>{const{position:t}=e,r=["top","bottom"].includes(t)?"y":"x";let n=["top-right","bottom-right"].includes(t)?1:-1;return t==="bottom"&&(n=1),{opacity:0,[r]:n*24}},animate:{opacity:1,y:0,x:0,scale:1,transition:{duration:.4,ease:[.4,0,.2,1]}},exit:{opacity:0,scale:.85,transition:{duration:.2,ease:[.4,0,1,1]}}},iq=ke.exports.memo(e=>{const{id:t,message:r,onCloseComplete:n,onRequestRemove:a,requestClose:i=!1,position:o="bottom",duration:s=5e3,containerStyle:u,motionVariants:l=H0e,toastSpacing:c="0.5rem"}=e,[d,f]=ke.exports.useState(s),p=Eue();dB(()=>{p||n?.()},[p]),dB(()=>{f(s)},[s]);const h=()=>f(null),m=()=>f(s),v=()=>{p&&a()};ke.exports.useEffect(()=>{p&&i&&a()},[p,i,a]),D0e(v,d);const g=ke.exports.useMemo(()=>({pointerEvents:"auto",maxWidth:560,minWidth:300,margin:c,...u}),[u,c]),y=ke.exports.useMemo(()=>B0e(o),[o]);return sa.createElement(Nce.li,{layout:!0,className:"chakra-toast",variants:l,initial:"initial",animate:"animate",exit:"exit",onHoverStart:h,onHoverEnd:m,custom:{position:o},style:y},sa.createElement(tl.div,{role:"status","aria-atomic":"true",className:"chakra-toast__inner",__css:g},k0e(r,{id:t,onClose:v})))});iq.displayName="ToastComponent";var j0e=e=>{const t=ke.exports.useSyncExternalStore(Dy.subscribe,Dy.getState,Dy.getState),{children:r,motionVariants:n,component:a=iq,portalProps:i}=e,s=Object.keys(t).map(u=>{const l=t[u];return B("ul",{role:"region","aria-live":"polite",id:`chakra-toast-manager-${u}`,style:F0e(u),children:B(qce,{initial:!1,children:l.map(c=>B(a,{motionVariants:n,...c},c.id))})},u)});return Pe(Nt,{children:[r,B(sb,{...i,children:s})]})},G0e=e=>{const{children:t,colorModeManager:r,portalZIndex:n,resetCSS:a=!0,theme:i={},environment:o,cssVarsRoot:s}=e,u=B(UG,{environment:o,children:t});return B(Gie,{theme:i,cssVarsRoot:s,children:Pe(xH,{colorModeManager:r,options:i.config,children:[a?B(nde,{}):B(rde,{}),B(Wie,{}),n?B(VG,{zIndex:n,children:u}):u]})})};function q0e({children:e,theme:t=M0e,toastOptions:r,...n}){return Pe(G0e,{theme:t,...n,children:[e,B(j0e,{...r})]})}var W0e={exports:{}};(function(e){var t=function(r){var n=Object.prototype,a=n.hasOwnProperty,i,o=typeof Symbol=="function"?Symbol:{},s=o.iterator||"@@iterator",u=o.asyncIterator||"@@asyncIterator",l=o.toStringTag||"@@toStringTag";function c(q,W,V){return Object.defineProperty(q,W,{value:V,enumerable:!0,configurable:!0,writable:!0}),q[W]}try{c({},"")}catch{c=function(W,V,ee){return W[V]=ee}}function d(q,W,V,ee){var ue=W&&W.prototype instanceof y?W:y,$=Object.create(ue.prototype),Q=new U(ee||[]);return $._invoke=D(q,V,Q),$}r.wrap=d;function f(q,W,V){try{return{type:"normal",arg:q.call(W,V)}}catch(ee){return{type:"throw",arg:ee}}}var p="suspendedStart",h="suspendedYield",m="executing",v="completed",g={};function y(){}function b(){}function S(){}var x={};c(x,s,function(){return this});var C=Object.getPrototypeOf,w=C&&C(C(j([])));w&&w!==n&&a.call(w,s)&&(x=w);var _=S.prototype=y.prototype=Object.create(x);b.prototype=S,c(_,"constructor",S),c(S,"constructor",b),b.displayName=c(S,l,"GeneratorFunction");function E(q){["next","throw","return"].forEach(function(W){c(q,W,function(V){return this._invoke(W,V)})})}r.isGeneratorFunction=function(q){var W=typeof q=="function"&&q.constructor;return W?W===b||(W.displayName||W.name)==="GeneratorFunction":!1},r.mark=function(q){return Object.setPrototypeOf?Object.setPrototypeOf(q,S):(q.__proto__=S,c(q,l,"GeneratorFunction")),q.prototype=Object.create(_),q},r.awrap=function(q){return{__await:q}};function P(q,W){function V($,Q,R,Y){var re=f(q[$],q,Q);if(re.type==="throw")Y(re.arg);else{var K=re.arg,L=K.value;return L&&typeof L=="object"&&a.call(L,"__await")?W.resolve(L.__await).then(function(H){V("next",H,R,Y)},function(H){V("throw",H,R,Y)}):W.resolve(L).then(function(H){K.value=H,R(K)},function(H){return V("throw",H,R,Y)})}}var ee;function ue($,Q){function R(){return new W(function(Y,re){V($,Q,Y,re)})}return ee=ee?ee.then(R,R):R()}this._invoke=ue}E(P.prototype),c(P.prototype,u,function(){return this}),r.AsyncIterator=P,r.async=function(q,W,V,ee,ue){ue===void 0&&(ue=Promise);var $=new P(d(q,W,V,ee),ue);return r.isGeneratorFunction(W)?$:$.next().then(function(Q){return Q.done?Q.value:$.next()})};function D(q,W,V){var ee=p;return function($,Q){if(ee===m)throw new Error("Generator is already running");if(ee===v){if($==="throw")throw Q;return te()}for(V.method=$,V.arg=Q;;){var R=V.delegate;if(R){var Y=k(R,V);if(Y){if(Y===g)continue;return Y}}if(V.method==="next")V.sent=V._sent=V.arg;else if(V.method==="throw"){if(ee===p)throw ee=v,V.arg;V.dispatchException(V.arg)}else V.method==="return"&&V.abrupt("return",V.arg);ee=m;var re=f(q,W,V);if(re.type==="normal"){if(ee=V.done?v:h,re.arg===g)continue;return{value:re.arg,done:V.done}}else re.type==="throw"&&(ee=v,V.method="throw",V.arg=re.arg)}}}function k(q,W){var V=q.iterator[W.method];if(V===i){if(W.delegate=null,W.method==="throw"){if(q.iterator.return&&(W.method="return",W.arg=i,k(q,W),W.method==="throw"))return g;W.method="throw",W.arg=new TypeError("The iterator does not provide a 'throw' method")}return g}var ee=f(V,q.iterator,W.arg);if(ee.type==="throw")return W.method="throw",W.arg=ee.arg,W.delegate=null,g;var ue=ee.arg;if(!ue)return W.method="throw",W.arg=new TypeError("iterator result is not an object"),W.delegate=null,g;if(ue.done)W[q.resultName]=ue.value,W.next=q.nextLoc,W.method!=="return"&&(W.method="next",W.arg=i);else return ue;return W.delegate=null,g}E(_),c(_,l,"Generator"),c(_,s,function(){return this}),c(_,"toString",function(){return"[object Generator]"});function F(q){var W={tryLoc:q[0]};1 in q&&(W.catchLoc=q[1]),2 in q&&(W.finallyLoc=q[2],W.afterLoc=q[3]),this.tryEntries.push(W)}function X(q){var W=q.completion||{};W.type="normal",delete W.arg,q.completion=W}function U(q){this.tryEntries=[{tryLoc:"root"}],q.forEach(F,this),this.reset(!0)}r.keys=function(q){var W=[];for(var V in q)W.push(V);return W.reverse(),function ee(){for(;W.length;){var ue=W.pop();if(ue in q)return ee.value=ue,ee.done=!1,ee}return ee.done=!0,ee}};function j(q){if(q){var W=q[s];if(W)return W.call(q);if(typeof q.next=="function")return q;if(!isNaN(q.length)){var V=-1,ee=function ue(){for(;++V<q.length;)if(a.call(q,V))return ue.value=q[V],ue.done=!1,ue;return ue.value=i,ue.done=!0,ue};return ee.next=ee}}return{next:te}}r.values=j;function te(){return{value:i,done:!0}}return U.prototype={constructor:U,reset:function(q){if(this.prev=0,this.next=0,this.sent=this._sent=i,this.done=!1,this.delegate=null,this.method="next",this.arg=i,this.tryEntries.forEach(X),!q)for(var W in this)W.charAt(0)==="t"&&a.call(this,W)&&!isNaN(+W.slice(1))&&(this[W]=i)},stop:function(){this.done=!0;var q=this.tryEntries[0],W=q.completion;if(W.type==="throw")throw W.arg;return this.rval},dispatchException:function(q){if(this.done)throw q;var W=this;function V(Y,re){return $.type="throw",$.arg=q,W.next=Y,re&&(W.method="next",W.arg=i),!!re}for(var ee=this.tryEntries.length-1;ee>=0;--ee){var ue=this.tryEntries[ee],$=ue.completion;if(ue.tryLoc==="root")return V("end");if(ue.tryLoc<=this.prev){var Q=a.call(ue,"catchLoc"),R=a.call(ue,"finallyLoc");if(Q&&R){if(this.prev<ue.catchLoc)return V(ue.catchLoc,!0);if(this.prev<ue.finallyLoc)return V(ue.finallyLoc)}else if(Q){if(this.prev<ue.catchLoc)return V(ue.catchLoc,!0)}else if(R){if(this.prev<ue.finallyLoc)return V(ue.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(q,W){for(var V=this.tryEntries.length-1;V>=0;--V){var ee=this.tryEntries[V];if(ee.tryLoc<=this.prev&&a.call(ee,"finallyLoc")&&this.prev<ee.finallyLoc){var ue=ee;break}}ue&&(q==="break"||q==="continue")&&ue.tryLoc<=W&&W<=ue.finallyLoc&&(ue=null);var $=ue?ue.completion:{};return $.type=q,$.arg=W,ue?(this.method="next",this.next=ue.finallyLoc,g):this.complete($)},complete:function(q,W){if(q.type==="throw")throw q.arg;return q.type==="break"||q.type==="continue"?this.next=q.arg:q.type==="return"?(this.rval=this.arg=q.arg,this.method="return",this.next="end"):q.type==="normal"&&W&&(this.next=W),g},finish:function(q){for(var W=this.tryEntries.length-1;W>=0;--W){var V=this.tryEntries[W];if(V.finallyLoc===q)return this.complete(V.completion,V.afterLoc),X(V),g}},catch:function(q){for(var W=this.tryEntries.length-1;W>=0;--W){var V=this.tryEntries[W];if(V.tryLoc===q){var ee=V.completion;if(ee.type==="throw"){var ue=ee.arg;X(V)}return ue}}throw new Error("illegal catch attempt")},delegateYield:function(q,W,V){return this.delegate={iterator:j(q),resultName:W,nextLoc:V},this.method==="next"&&(this.arg=i),g}},r}(e.exports);try{regeneratorRuntime=t}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}})(W0e);function UB(e,t,r,n,a,i,o){try{var s=e[i](o),u=s.value}catch(l){r(l);return}s.done?t(u):Promise.resolve(u).then(n,a)}function VB(e){return function(){var t=this,r=arguments;return new Promise(function(n,a){var i=e.apply(t,r);function o(u){UB(i,n,a,o,s,"next",u)}function s(u){UB(i,n,a,o,s,"throw",u)}o(void 0)})}}var X0e=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},oq={exports:{}},zn={};/** @license React v16.13.1
* react-is.production.min.js
*
* Copyright (c) Facebook, Inc. and its affiliates.
*
* This source code is licensed under the MIT license found in the
* LICENSE file in the root directory of this source tree.
*/var Ci=typeof Symbol=="function"&&Symbol.for,OD=Ci?Symbol.for("react.element"):60103,BD=Ci?Symbol.for("react.portal"):60106,Pw=Ci?Symbol.for("react.fragment"):60107,Iw=Ci?Symbol.for("react.strict_mode"):60108,Mw=Ci?Symbol.for("react.profiler"):60114,Dw=Ci?Symbol.for("react.provider"):60109,kw=Ci?Symbol.for("react.context"):60110,FD=Ci?Symbol.for("react.async_mode"):60111,Rw=Ci?Symbol.for("react.concurrent_mode"):60111,Ow=Ci?Symbol.for("react.forward_ref"):60112,Bw=Ci?Symbol.for("react.suspense"):60113,Y0e=Ci?Symbol.for("react.suspense_list"):60120,Fw=Ci?Symbol.for("react.memo"):60115,Lw=Ci?Symbol.for("react.lazy"):60116,K0e=Ci?Symbol.for("react.block"):60121,$0e=Ci?Symbol.for("react.fundamental"):60117,Q0e=Ci?Symbol.for("react.responder"):60118,Z0e=Ci?Symbol.for("react.scope"):60119;function Is(e){if(typeof e=="object"&&e!==null){var t=e.$$typeof;switch(t){case OD:switch(e=e.type,e){case FD:case Rw:case Pw:case Mw:case Iw:case Bw:return e;default:switch(e=e&&e.$$typeof,e){case kw:case Ow:case Lw:case Fw:case Dw:return e;default:return t}}case BD:return t}}}function sq(e){return Is(e)===Rw}zn.AsyncMode=FD;zn.ConcurrentMode=Rw;zn.ContextConsumer=kw;zn.ContextProvider=Dw;zn.Element=OD;zn.ForwardRef=Ow;zn.Fragment=Pw;zn.Lazy=Lw;zn.Memo=Fw;zn.Portal=BD;zn.Profiler=Mw;zn.StrictMode=Iw;zn.Suspense=Bw;zn.isAsyncMode=function(e){return sq(e)||Is(e)===FD};zn.isConcurrentMode=sq;zn.isContextConsumer=function(e){return Is(e)===kw};zn.isContextProvider=function(e){return Is(e)===Dw};zn.isElement=function(e){return typeof e=="object"&&e!==null&&e.$$typeof===OD};zn.isForwardRef=function(e){return Is(e)===Ow};zn.isFragment=function(e){return Is(e)===Pw};zn.isLazy=function(e){return Is(e)===Lw};zn.isMemo=function(e){return Is(e)===Fw};zn.isPortal=function(e){return Is(e)===BD};zn.isProfiler=function(e){return Is(e)===Mw};zn.isStrictMode=function(e){return Is(e)===Iw};zn.isSuspense=function(e){return Is(e)===Bw};zn.isValidElementType=function(e){return typeof e=="string"||typeof e=="function"||e===Pw||e===Rw||e===Mw||e===Iw||e===Bw||e===Y0e||typeof e=="object"&&e!==null&&(e.$$typeof===Lw||e.$$typeof===Fw||e.$$typeof===Dw||e.$$typeof===kw||e.$$typeof===Ow||e.$$typeof===$0e||e.$$typeof===Q0e||e.$$typeof===Z0e||e.$$typeof===K0e)};zn.typeOf=Is;/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var HB=Object.getOwnPropertySymbols,J0e=Object.prototype.hasOwnProperty,ege=Object.prototype.propertyIsEnumerable;function tge(e){if(e==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}function rge(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de",Object.getOwnPropertyNames(e)[0]==="5")return!1;for(var t={},r=0;r<10;r++)t["_"+String.fromCharCode(r)]=r;var n=Object.getOwnPropertyNames(t).map(function(i){return t[i]});if(n.join("")!=="0123456789")return!1;var a={};return"abcdefghijklmnopqrst".split("").forEach(function(i){a[i]=i}),Object.keys(Object.assign({},a)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}rge();var nge="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",age=nge;Function.call.bind(Object.prototype.hasOwnProperty);var ige=age;function uq(){}function lq(){}lq.resetWarningCache=uq;var oge=function(){function e(n,a,i,o,s,u){if(u!==ige){var l=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw l.name="Invariant Violation",l}}e.isRequired=e;function t(){return e}var r={array:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:lq,resetWarningCache:uq};return r.PropTypes=r,r};oq.exports=oge();var tf=oq.exports;/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var OP=function(e,t){return OP=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},OP(e,t)};function Le(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");OP(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}var T=function(){return T=Object.assign||function(t){for(var r,n=1,a=arguments.length;n<a;n++){r=arguments[n];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t},T.apply(this,arguments)};function pe(e,t,r,n){function a(i){return i instanceof r?i:new r(function(o){o(i)})}return new(r||(r=Promise))(function(i,o){function s(c){try{l(n.next(c))}catch(d){o(d)}}function u(c){try{l(n.throw(c))}catch(d){o(d)}}function l(c){c.done?i(c.value):a(c.value).then(s,u)}l((n=n.apply(e,t||[])).next())})}function he(e,t){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,a,i,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(l){return function(c){return u([l,c])}}function u(l){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(i=l[0]&2?a.return:l[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,l[1])).done)return i;switch(a=0,i&&(l=[l[0]&2,i.value]),l[0]){case 0:case 1:i=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,a=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!i||l[1]>i[0]&&l[1]<i[3])){r.label=l[1];break}if(l[0]===6&&r.label<i[1]){r.label=i[1],i=l;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(l);break}i[2]&&r.ops.pop(),r.trys.pop();continue}l=t.call(e,r)}catch(c){l=[6,c],a=0}finally{n=i=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function Gt(e,t,r){if(r||arguments.length===2)for(var n=0,a=t.length,i;n<a;n++)(i||!(n in t))&&(i||(i=Array.prototype.slice.call(t,0,n)),i[n]=t[n]);return e.concat(i||t)}var pp;(function(e){function t(n){return n}e.create=t;function r(n,a){var i,o;if(a.customDurationMs)return a.customDurationMs;var s=(o=(i=a.definition).getDuration)===null||o===void 0?void 0:o.call(i,a.params,n);if(s?.kind==="fixed")return s.durationMs}e.getDuration=r})(pp||(pp={}));var Oi;(function(e){function t(a){return a}e.create=t;function r(a,i){return(a&i)!==0}e.has=r;function n(a,i){return!!i&&(a&i)===i}e.hasAll=n})(Oi||(Oi={}));var Lr;(function(e){function t(S){return S===void 0&&(S=512),{current:[],offset:0,capacity:S,chunks:[]}}e.create=t;function r(S){return S.chunks.length?(S.offset>0&&(S.chunks[S.chunks.length]=S.current.length===S.offset?S.current.join(""):S.current.slice(0,S.offset).join("")),S.chunks.join("")):S.current.length===S.offset?S.current.join(""):S.current.splice(0,S.offset).join("")}e.getString=r;function n(S){for(var x=0,C=0,w=S.chunks;C<w.length;C++){var _=w[C];x+=_.length}for(var E=0;E<S.offset;E++)x+=S.current[E].length;return x}e.getSize=n;function a(S){return S.offset>0&&(S.current.length===S.offset?S.chunks[S.chunks.length]=S.current.join(""):S.chunks[S.chunks.length]=S.current.slice(0,S.offset).join(""),S.offset=0),S.chunks}e.getChunks=a;var i=[];(function(){for(var S="",x=0;x<512;x++)i[x]=S,S=S+" "})();function o(S){c(S,`
`)}e.newline=o;function s(S,x){x>0&&c(S,i[x])}e.whitespace=s;function u(S){c(S," ")}e.whitespace1=u;function l(S,x){!x||(S.offset===S.capacity&&(S.chunks[S.chunks.length]=S.current.join(""),S.offset=0),S.current[S.offset++]=x)}e.write=l;function c(S,x){S.offset===S.capacity&&(S.chunks[S.chunks.length]=S.current.join(""),S.offset=0),S.current[S.offset++]=x}e.writeSafe=c;function d(S,x,C){if(!x){s(S,C);return}var w=C-x.length;s(S,w),c(S,x)}e.writePadLeft=d;function f(S,x,C){if(!x){s(S,C);return}var w=C-x.length;c(S,x),s(S,w)}e.writePadRight=f;function p(S,x){c(S,""+x)}e.writeInteger=p;function h(S,x){c(S,""+x+" ")}e.writeIntegerAndSpace=h;function m(S,x,C){var w=""+x,_=C-w.length;s(S,_),c(S,w)}e.writeIntegerPadLeft=m;function v(S,x,C){var w=""+x,_=C-w.length;c(S,w),s(S,_)}e.writeIntegerPadRight=v;function g(S,x,C){c(S,""+Math.round(C*x)/C)}e.writeFloat=g;function y(S,x,C,w){var _=""+Math.round(C*x)/C,E=w-_.length;s(S,E),c(S,_)}e.writeFloatPadLeft=y;function b(S,x,C,w){var _=""+Math.round(C*x)/C,E=w-_.length;c(S,_),s(S,E)}e.writeFloatPadRight=b})(Lr||(Lr={}));var Gn=function(){if(typeof window<"u"&&window.performance){var e=window.performance;return function(){return e.now()}}else return typeof process<"u"&&process.hrtime!=="undefined"&&typeof process.hrtime=="function"?function(){var t=process.hrtime();return t[0]*1e3+t[1]/1e6}:Date.now?function(){return Date.now()}:function(){return+new Date}}();function iS(e,t){if(t===void 0&&(t=!0),isNaN(e))return"n/a";for(var r=Math.floor(e/(60*60*1e3)),n=Math.floor(e/(60*1e3)%60),a=Math.floor(e/1e3%60),i=Math.floor(e%1e3).toString();i.length<3;)i="0"+i;for(;!t&&i.length>1&&i[i.length-1]==="0";)i=i.substr(0,i.length-1);return r>0?r+"h"+n+"m"+a+"."+i+"s":n>0?n+"m"+a+"."+i+"s":a>0?a+"."+i+"s":e.toFixed(0)+"ms"}var Cn;(function(e){var t=typeof btoa<"u"?btoa:function(o){return Buffer.from(o).toString("base64")},r=[];function n(){for(var o=+new Date+Gn(),s=0;s<16;s++)r[s]=String.fromCharCode((o+Math.random()*255)%255|0),o=Math.floor(o/255);return t(r.join("")).replace(/\+/g,"-").replace(/\//g,"_").substr(0,22)}e.create22=n;function a(){var o=+new Date+Gn(),s="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(u){var l=(o+Math.random()*16)%16|0;return o=Math.floor(o/16),(u==="x"?l:l&3|8).toString(16)});return s}e.createv4=a;function i(o){return typeof o=="string"}e.is=i})(Cn||(Cn={}));function sge(e,t){return e-t}function uge(e){return Array.prototype.sort.call(e,sge),e}var jB;(function(e){var t=function(){function p(){this.size=0}return p.prototype.has=function(h){return!1},p.prototype.forEach=function(h,m){return m},p}(),r=function(){function p(h){this.idx=h,this.size=1}return p.prototype.has=function(h){return h===this.idx},p.prototype.forEach=function(h,m){return h(this.idx,m),m},p}(),n=function(){function p(h,m){this.mask=h,this.size=m,this.length=h.length}return p.prototype.has=function(h){return h<this.length&&!!this.mask[h]},p.prototype._forEach=function(h,m){for(var v=0;v<this.length;v++)this.mask[v]&&h(v,m)},p.prototype.forEach=function(h,m){return this._forEach(h,m),m},p}(),a=function(){function p(h){this.size=h}return p.prototype.has=function(h){return!0},p.prototype._forEach=function(h,m){for(var v=0;v<this.size;v++)h(v,m)},p.prototype.forEach=function(h,m){return this._forEach(h,m),m},p}(),i=function(){function p(h){this.set=h,this._flat=void 0,this.size=h.size}return p.prototype.has=function(h){return this.set.has(h)},p.prototype._forEach=function(h,m){for(var v=0,g=this.flatten();v<g.length;v++){var y=g[v];h(y,m)}},p.prototype.flatten=function(){if(this._flat)return this._flat;var h=new Int32Array(this.size),m=0;return this.set.forEach(function(v){return h[m++]=v}),uge(h),this._flat=h,this._flat},p.prototype.forEach=function(h,m){return this._forEach(h,m),m},p}();function o(p){return new a(p)}e.always=o,e.never=new t;function s(p){return new i(p)}e.ofSet=s;function u(p){return new r(p)}e.singleton=u;function l(p){var h=p.length;if(h===0)return new t;if(h===1)return new r(p[0]);for(var m=0,v=0,g=p;v<g.length;v++){var y=g[v];y>m&&(m=y)}if(h===m)return new a(h);var b=h/m;if(b<1/12){for(var S=new Set,x=0,C=p;x<C.length;x++){var y=C[x];S.add(y)}return new i(S)}for(var w=new Int8Array(m+1),_=0,E=p;_<E.length;_++){var y=E[_];w[y]=1}return new n(w,p.length)}e.ofUniqueIndices=l;function c(p,h){return new n(p,h)}e.ofMask=c;function d(p,h){for(var m=0,v=h;m<v.length;m++){var g=v[m];if(p.has(g))return!0}return!1}e.hasAny=d;function f(p,h){var m=0,v=0;if(h.forEach(function(b){p.has(b)||(m++,b>v&&(v=b))}),m/v<1/12){var g=new Set;return h.forEach(function(b){p.has(b)||g.add(b)}),s(g)}else{var y=new Uint8Array(v+1);return h.forEach(function(b){p.has(b)||(y[b]=1)}),c(y,m)}}e.complement=f})(jB||(jB={}));function ro(e,t){e===void 0&&(e=0),t===void 0&&(t=Number.MAX_SAFE_INTEGER);var r=e;return function(){var n=r;return r=(r+1)%t,n}}var ky;(function(e){function t(n){return{ref:n}}e.create=t;function r(n,a){return n.ref=a,n}e.set=r})(ky||(ky={}));var lge=ro(0,2147483647),hp;(function(e){function t(n,a){return{id:lge(),version:0,value:n,metadata:a}}e.create=t;function r(n,a){return{id:n.id,version:n.version+1,value:a,metadata:n.metadata}}e.withValue=r})(hp||(hp={}));var N;(function(e){function t(i,o){return ky.create(hp.create(i,o))}e.create=t;function r(i,o){return ky.set(i,hp.withValue(i.ref,o))}e.update=r;function n(i,o){return ky.set(i,o)}e.set=n;function a(i,o){return i.ref.value!==o?r(i,o):i}e.updateIfChanged=a})(N||(N={}));var Df=function(){};function yo(e,t){var r=e.length;if(r!==t.length)return!1;for(var n=0;n<r;n++)if(e[n]!==t[n])return!1;return!0}var cq=Object.prototype.hasOwnProperty;function dd(e,t){if(e===t)return!0;var r=Array.isArray(e),n=Array.isArray(t);if(r&&n){if(e.length!==t.length)return!1;for(var a=0;a<e.length;a++)if(!dd(e[a],t[a]))return!1;return!0}if(r!==n)return!1;if(e&&t&&typeof e=="object"&&typeof t=="object"){var i=Object.keys(e);if(i.length!==Object.keys(t).length)return!1;var o=e instanceof Date,s=t instanceof Date;if(o&&s)return e.getTime()===t.getTime();if(o!==s)return!1;var u=e instanceof RegExp,l=t instanceof RegExp;if(u&&l)return e.toString()===t.toString();if(u!==l)return!1;for(var a=0;a<i.length;a++)if(!cq.call(t,i[a]))return!1;for(var a=0;a<i.length;a++)if(!dd(e[i[a]],t[i[a]]))return!1;return!0}return!1}function mC(e,t){if(e===t)return!0;var r=Array.isArray(e),n=Array.isArray(t);return r&&n?cge(e,t):r!==n?!1:e&&t&&typeof e=="object"&&typeof t=="object"?p0(e,t):!1}function p0(e,t){if(e===t)return!0;if(!e||!t)return!1;var r=Object.keys(e);if(Object.keys(t).length!==r.length)return!1;for(var n=0,a=r;n<a.length;n++){var i=a[n];if(!cq.call(e,i)||e[i]!==t[i])return!1}return!0}function cge(e,t){if(e===t)return!0;if(!e||!t||e.length!==t.length)return!1;for(var r=0,n=e.length;r<n;++r)if(e[r]!==t[r])return!1;return!0}function ja(e,t){return e!==void 0?e:t}function GB(e){return(e<10?"0":"")+e}function dge(e){var t=e.getHours(),r=e.getMinutes(),n=e.getSeconds();return t+":"+GB(r)+":"+GB(n)}var qn;(function(e){function t(){return function(a){return r(a)}}e.factory=t;function r(a){var i;return i=function(){function o(s,u){this.data=s,this.id=Cn.create22(),this.type=a,this.label=u&&u.label||a.name,this.description=u&&u.description}return o.is=function(s){return!!s&&a===s.type},o}(),i.type=a,i}e.create=r;function n(a,i){if(!a.tags)return!1;for(var o=0,s=a.tags;o<s.length;o++){var u=s[o];if(u===i)return!0}return!1}e.hasTag=n,e.Null={id:Cn.create22(),type:{name:"Null",typeClass:"Null"},data:void 0,label:"Null"}})(qn||(qn={}));var _1;(function(e){function t(n){var a=n;return!!a&&!!a.transform&&!!a.parent&&!!a.status}e.is=t;function r(n,a){var i=typeof a=="string"?a:e.is(a)?a.transform.ref:a.ref;return n.cells.get(i)}e.resolve=r})(_1||(_1={}));var dq=function(){function e(t,r){this.ref=t,this.state=r}return Object.defineProperty(e.prototype,"cell",{get:function(){var t;return(t=this.state)===null||t===void 0?void 0:t.cells.get(this.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"obj",{get:function(){var t,r;return(r=(t=this.state)===null||t===void 0?void 0:t.cells.get(this.ref))===null||r===void 0?void 0:r.obj},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"data",{get:function(){var t;return(t=this.obj)===null||t===void 0?void 0:t.data},enumerable:!1,configurable:!0}),e.prototype.update=function(t,r){if(!this.state)throw new Error("To use update() from StateObjectSelector, 'state' must be defined.");return r||(r=this.state.build()),(r||this.state.build()).to(this).update(t),r},e.prototype.checkValid=function(){if(!this.state)throw new Error("Unassigned State.");var t=this.cell;if(!t)throw new Error("Not created at all. Did you await/then the corresponding state update?");if(t.status==="ok")return!0;throw t.status==="error"?new Error(t.errorText):t.obj===qn.Null?new Error("The object is Null."):new Error("Unresolved. Did you await/then the corresponding state update?")},Object.defineProperty(e.prototype,"isOk",{get:function(){var t=this.cell;return t&&t.status==="ok"&&t.obj!==qn.Null},enumerable:!1,configurable:!0}),e}(),Ka;(function(e){function t(a){var i;if(!!a)return typeof a=="string"?a:_1.is(a)?a.transform.ref:(i=a.cell)===null||i===void 0?void 0:i.transform.ref}e.resolveRef=t;function r(a,i){if(!!i)return _1.is(i)?i:typeof i=="string"?a.cells.get(i):i.cell}e.resolve=r;function n(a,i){var o=r(a,i);if(!(!o||!o.obj||o.status!=="ok"))return o}e.resolveAndCheck=n})(Ka||(Ka={}));var ma={exports:{}};(function(e,t){(function(r,n){e.exports=n()})(X0e,function(){var r=Array.prototype.slice;function n(I,z){z&&(I.prototype=Object.create(z.prototype)),I.prototype.constructor=I}function a(I){return u(I)?I:me(I)}n(i,a);function i(I){return l(I)?I:xe(I)}n(o,a);function o(I){return c(I)?I:Se(I)}n(s,a);function s(I){return u(I)&&!d(I)?I:ie(I)}function u(I){return!!(I&&I[p])}function l(I){return!!(I&&I[h])}function c(I){return!!(I&&I[m])}function d(I){return l(I)||c(I)}function f(I){return!!(I&&I[v])}a.isIterable=u,a.isKeyed=l,a.isIndexed=c,a.isAssociative=d,a.isOrdered=f,a.Keyed=i,a.Indexed=o,a.Set=s;var p="@@__IMMUTABLE_ITERABLE__@@",h="@@__IMMUTABLE_KEYED__@@",m="@@__IMMUTABLE_INDEXED__@@",v="@@__IMMUTABLE_ORDERED__@@",g="delete",y=5,b=1<<y,S=b-1,x={},C={value:!1},w={value:!1};function _(I){return I.value=!1,I}function E(I){I&&(I.value=!0)}function P(){}function D(I,z){z=z||0;for(var J=Math.max(0,I.length-z),ne=new Array(J),se=0;se<J;se++)ne[se]=I[se+z];return ne}function k(I){return I.size===void 0&&(I.size=I.__iterate(X)),I.size}function F(I,z){if(typeof z!="number"){var J=z>>>0;if(""+J!==z||J===4294967295)return NaN;z=J}return z<0?k(I)+z:z}function X(){return!0}function U(I,z,J){return(I===0||J!==void 0&&I<=-J)&&(z===void 0||J!==void 0&&z>=J)}function j(I,z){return q(I,z,0)}function te(I,z){return q(I,z,z)}function q(I,z,J){return I===void 0?J:I<0?Math.max(0,z+I):z===void 0?I:Math.min(z,I)}var W=0,V=1,ee=2,ue=typeof Symbol=="function"&&Symbol.iterator,$="@@iterator",Q=ue||$;function R(I){this.next=I}R.prototype.toString=function(){return"[Iterator]"},R.KEYS=W,R.VALUES=V,R.ENTRIES=ee,R.prototype.inspect=R.prototype.toSource=function(){return this.toString()},R.prototype[Q]=function(){return this};function Y(I,z,J,ne){var se=I===0?z:I===1?J:[z,J];return ne?ne.value=se:ne={value:se,done:!1},ne}function re(){return{value:void 0,done:!0}}function K(I){return!!Z(I)}function L(I){return I&&typeof I.next=="function"}function H(I){var z=Z(I);return z&&z.call(I)}function Z(I){var z=I&&(ue&&I[ue]||I[$]);if(typeof z=="function")return z}function fe(I){return I&&typeof I.length=="number"}n(me,a);function me(I){return I==null?Ge():u(I)?I.toSeq():ze(I)}me.of=function(){return me(arguments)},me.prototype.toSeq=function(){return this},me.prototype.toString=function(){return this.__toString("Seq {","}")},me.prototype.cacheResult=function(){return!this._cache&&this.__iterateUncached&&(this._cache=this.entrySeq().toArray(),this.size=this._cache.length),this},me.prototype.__iterate=function(I,z){return ut(this,I,z,!0)},me.prototype.__iterator=function(I,z){return pt(this,I,z,!0)},n(xe,me);function xe(I){return I==null?Ge().toKeyedSeq():u(I)?l(I)?I.toSeq():I.fromEntrySeq():Je(I)}xe.prototype.toKeyedSeq=function(){return this},n(Se,me);function Se(I){return I==null?Ge():u(I)?l(I)?I.entrySeq():I.toIndexedSeq():st(I)}Se.of=function(){return Se(arguments)},Se.prototype.toIndexedSeq=function(){return this},Se.prototype.toString=function(){return this.__toString("Seq [","]")},Se.prototype.__iterate=function(I,z){return ut(this,I,z,!1)},Se.prototype.__iterator=function(I,z){return pt(this,I,z,!1)},n(ie,me);function ie(I){return(I==null?Ge():u(I)?l(I)?I.entrySeq():I:st(I)).toSetSeq()}ie.of=function(){return ie(arguments)},ie.prototype.toSetSeq=function(){return this},me.isSeq=Te,me.Keyed=xe,me.Set=ie,me.Indexed=Se;var le="@@__IMMUTABLE_SEQ__@@";me.prototype[le]=!0,n(O,Se);function O(I){this._array=I,this.size=I.length}O.prototype.get=function(I,z){return this.has(I)?this._array[F(this,I)]:z},O.prototype.__iterate=function(I,z){for(var J=this._array,ne=J.length-1,se=0;se<=ne;se++)if(I(J[z?ne-se:se],se,this)===!1)return se+1;return se},O.prototype.__iterator=function(I,z){var J=this._array,ne=J.length-1,se=0;return new R(function(){return se>ne?re():Y(I,se,J[z?ne-se++:se++])})},n(G,xe);function G(I){var z=Object.keys(I);this._object=I,this._keys=z,this.size=z.length}G.prototype.get=function(I,z){return z!==void 0&&!this.has(I)?z:this._object[I]},G.prototype.has=function(I){return this._object.hasOwnProperty(I)},G.prototype.__iterate=function(I,z){for(var J=this._object,ne=this._keys,se=ne.length-1,Ce=0;Ce<=se;Ce++){var Ie=ne[z?se-Ce:Ce];if(I(J[Ie],Ie,this)===!1)return Ce+1}return Ce},G.prototype.__iterator=function(I,z){var J=this._object,ne=this._keys,se=ne.length-1,Ce=0;return new R(function(){var Ie=ne[z?se-Ce:Ce];return Ce++>se?re():Y(I,Ie,J[Ie])})},G.prototype[v]=!0,n(ve,Se);function ve(I){this._iterable=I,this.size=I.length||I.size}ve.prototype.__iterateUncached=function(I,z){if(z)return this.cacheResult().__iterate(I,z);var J=this._iterable,ne=H(J),se=0;if(L(ne))for(var Ce;!(Ce=ne.next()).done&&I(Ce.value,se++,this)!==!1;);return se},ve.prototype.__iteratorUncached=function(I,z){if(z)return this.cacheResult().__iterator(I,z);var J=this._iterable,ne=H(J);if(!L(ne))return new R(re);var se=0;return new R(function(){var Ce=ne.next();return Ce.done?Ce:Y(I,se++,Ce.value)})},n(we,Se);function we(I){this._iterator=I,this._iteratorCache=[]}we.prototype.__iterateUncached=function(I,z){if(z)return this.cacheResult().__iterate(I,z);for(var J=this._iterator,ne=this._iteratorCache,se=0;se<ne.length;)if(I(ne[se],se++,this)===!1)return se;for(var Ce;!(Ce=J.next()).done;){var Ie=Ce.value;if(ne[se]=Ie,I(Ie,se++,this)===!1)break}return se},we.prototype.__iteratorUncached=function(I,z){if(z)return this.cacheResult().__iterator(I,z);var J=this._iterator,ne=this._iteratorCache,se=0;return new R(function(){if(se>=ne.length){var Ce=J.next();if(Ce.done)return Ce;ne[se]=Ce.value}return Y(I,se,ne[se++])})};function Te(I){return!!(I&&I[le])}var Ue;function Ge(){return Ue||(Ue=new O([]))}function Je(I){var z=Array.isArray(I)?new O(I).fromEntrySeq():L(I)?new we(I).fromEntrySeq():K(I)?new ve(I).fromEntrySeq():typeof I=="object"?new G(I):void 0;if(!z)throw new TypeError("Expected Array or iterable object of [k, v] entries, or keyed object: "+I);return z}function st(I){var z=et(I);if(!z)throw new TypeError("Expected Array or iterable object of values: "+I);return z}function ze(I){var z=et(I)||typeof I=="object"&&new G(I);if(!z)throw new TypeError("Expected Array or iterable object of values, or keyed object: "+I);return z}function et(I){return fe(I)?new O(I):L(I)?new we(I):K(I)?new ve(I):void 0}function ut(I,z,J,ne){var se=I._cache;if(se){for(var Ce=se.length-1,Ie=0;Ie<=Ce;Ie++){var qe=se[J?Ce-Ie:Ie];if(z(qe[1],ne?qe[0]:Ie,I)===!1)return Ie+1}return Ie}return I.__iterateUncached(z,J)}function pt(I,z,J,ne){var se=I._cache;if(se){var Ce=se.length-1,Ie=0;return new R(function(){var qe=se[J?Ce-Ie:Ie];return Ie++>Ce?re():Y(z,ne?qe[0]:Ie-1,qe[1])})}return I.__iteratorUncached(z,J)}function ht(I,z){return z?Re(z,I,"",{"":I}):it(I)}function Re(I,z,J,ne){return Array.isArray(z)?I.call(ne,J,Se(z).map(function(se,Ce){return Re(I,se,Ce,z)})):Fe(z)?I.call(ne,J,xe(z).map(function(se,Ce){return Re(I,se,Ce,z)})):z}function it(I){return Array.isArray(I)?Se(I).map(it).toList():Fe(I)?xe(I).map(it).toMap():I}function Fe(I){return I&&(I.constructor===Object||I.constructor===void 0)}function tt(I,z){if(I===z||I!==I&&z!==z)return!0;if(!I||!z)return!1;if(typeof I.valueOf=="function"&&typeof z.valueOf=="function"){if(I=I.valueOf(),z=z.valueOf(),I===z||I!==I&&z!==z)return!0;if(!I||!z)return!1}return!!(typeof I.equals=="function"&&typeof z.equals=="function"&&I.equals(z))}function wt(I,z){if(I===z)return!0;if(!u(z)||I.size!==void 0&&z.size!==void 0&&I.size!==z.size||I.__hash!==void 0&&z.__hash!==void 0&&I.__hash!==z.__hash||l(I)!==l(z)||c(I)!==c(z)||f(I)!==f(z))return!1;if(I.size===0&&z.size===0)return!0;var J=!d(I);if(f(I)){var ne=I.entries();return z.every(function(at,ft){var Ct=ne.next().value;return Ct&&tt(Ct[1],at)&&(J||tt(Ct[0],ft))})&&ne.next().done}var se=!1;if(I.size===void 0)if(z.size===void 0)typeof I.cacheResult=="function"&&I.cacheResult();else{se=!0;var Ce=I;I=z,z=Ce}var Ie=!0,qe=z.__iterate(function(at,ft){if(J?!I.has(at):se?!tt(at,I.get(ft,x)):!tt(I.get(ft,x),at))return Ie=!1,!1});return Ie&&I.size===qe}n(dt,Se);function dt(I,z){if(!(this instanceof dt))return new dt(I,z);if(this._value=I,this.size=z===void 0?1/0:Math.max(0,z),this.size===0){if(Et)return Et;Et=this}}dt.prototype.toString=function(){return this.size===0?"Repeat []":"Repeat [ "+this._value+" "+this.size+" times ]"},dt.prototype.get=function(I,z){return this.has(I)?this._value:z},dt.prototype.includes=function(I){return tt(this._value,I)},dt.prototype.slice=function(I,z){var J=this.size;return U(I,z,J)?this:new dt(this._value,te(z,J)-j(I,J))},dt.prototype.reverse=function(){return this},dt.prototype.indexOf=function(I){return tt(this._value,I)?0:-1},dt.prototype.lastIndexOf=function(I){return tt(this._value,I)?this.size:-1},dt.prototype.__iterate=function(I,z){for(var J=0;J<this.size;J++)if(I(this._value,J,this)===!1)return J+1;return J},dt.prototype.__iterator=function(I,z){var J=this,ne=0;return new R(function(){return ne<J.size?Y(I,ne++,J._value):re()})},dt.prototype.equals=function(I){return I instanceof dt?tt(this._value,I._value):wt(I)};var Et;function oe(I,z){if(!I)throw new Error(z)}n(ge,Se);function ge(I,z,J){if(!(this instanceof ge))return new ge(I,z,J);if(oe(J!==0,"Cannot step a Range by 0"),I=I||0,z===void 0&&(z=1/0),J=J===void 0?1:Math.abs(J),z<I&&(J=-J),this._start=I,this._end=z,this._step=J,this.size=Math.max(0,Math.ceil((z-I)/J-1)+1),this.size===0){if(Ee)return Ee;Ee=this}}ge.prototype.toString=function(){return this.size===0?"Range []":"Range [ "+this._start+"..."+this._end+(this._step!==1?" by "+this._step:"")+" ]"},ge.prototype.get=function(I,z){return this.has(I)?this._start+F(this,I)*this._step:z},ge.prototype.includes=function(I){var z=(I-this._start)/this._step;return z>=0&&z<this.size&&z===Math.floor(z)},ge.prototype.slice=function(I,z){return U(I,z,this.size)?this:(I=j(I,this.size),z=te(z,this.size),z<=I?new ge(0,0):new ge(this.get(I,this._end),this.get(z,this._end),this._step))},ge.prototype.indexOf=function(I){var z=I-this._start;if(z%this._step===0){var J=z/this._step;if(J>=0&&J<this.size)return J}return-1},ge.prototype.lastIndexOf=function(I){return this.indexOf(I)},ge.prototype.__iterate=function(I,z){for(var J=this.size-1,ne=this._step,se=z?this._start+J*ne:this._start,Ce=0;Ce<=J;Ce++){if(I(se,Ce,this)===!1)return Ce+1;se+=z?-ne:ne}return Ce},ge.prototype.__iterator=function(I,z){var J=this.size-1,ne=this._step,se=z?this._start+J*ne:this._start,Ce=0;return new R(function(){var Ie=se;return se+=z?-ne:ne,Ce>J?re():Y(I,Ce++,Ie)})},ge.prototype.equals=function(I){return I instanceof ge?this._start===I._start&&this._end===I._end&&this._step===I._step:wt(this,I)};var Ee;n(Ze,a);function Ze(){throw TypeError("Abstract")}n(xt,Ze);function xt(){}n(Tt,Ze);function Tt(){}n(Qt,Ze);function Qt(){}Ze.Keyed=xt,Ze.Indexed=Tt,Ze.Set=Qt;var dr=typeof Math.imul=="function"&&Math.imul(4294967295,2)===-2?Math.imul:function(z,J){z=z|0,J=J|0;var ne=z&65535,se=J&65535;return ne*se+((z>>>16)*se+ne*(J>>>16)<<16>>>0)|0};function _r(I){return I>>>1&1073741824|I&3221225471}function Jt(I){if(I===!1||I===null||I===void 0||typeof I.valueOf=="function"&&(I=I.valueOf(),I===!1||I===null||I===void 0))return 0;if(I===!0)return 1;var z=typeof I;if(z==="number"){if(I!==I||I===1/0)return 0;var J=I|0;for(J!==I&&(J^=I*4294967295);I>4294967295;)I/=4294967295,J^=I;return _r(J)}if(z==="string")return I.length>cl?ea(I):On(I);if(typeof I.hashCode=="function")return I.hashCode();if(z==="object")return La(I);if(typeof I.toString=="function")return On(I.toString());throw new Error("Value type "+z+" cannot be hashed.")}function ea(I){var z=Ao[I];return z===void 0&&(z=On(I),vc===Um&&(vc=0,Ao={}),vc++,Ao[I]=z),z}function On(I){for(var z=0,J=0;J<I.length;J++)z=31*z+I.charCodeAt(J)|0;return _r(z)}function La(I){var z;if($o&&(z=_o.get(I),z!==void 0)||(z=I[Ui],z!==void 0)||!Os&&(z=I.propertyIsEnumerable&&I.propertyIsEnumerable[Ui],z!==void 0||(z=wu(I),z!==void 0)))return z;if(z=++mc,mc&1073741824&&(mc=0),$o)_o.set(I,z);else{if(no!==void 0&&no(I)===!1)throw new Error("Non-extensible objects are not allowed as keys.");if(Os)Object.defineProperty(I,Ui,{enumerable:!1,configurable:!1,writable:!1,value:z});else if(I.propertyIsEnumerable!==void 0&&I.propertyIsEnumerable===I.constructor.prototype.propertyIsEnumerable)I.propertyIsEnumerable=function(){return this.constructor.prototype.propertyIsEnumerable.apply(this,arguments)},I.propertyIsEnumerable[Ui]=z;else if(I.nodeType!==void 0)I[Ui]=z;else throw new Error("Unable to set a non-enumerable property on object.")}return z}var no=Object.isExtensible,Os=function(){try{return Object.defineProperty({},"@",{}),!0}catch{return!1}}();function wu(I){if(I&&I.nodeType>0)switch(I.nodeType){case 1:return I.uniqueID;case 9:return I.documentElement&&I.documentElement.uniqueID}}var $o=typeof WeakMap=="function",_o;$o&&(_o=new WeakMap);var mc=0,Ui="__immutablehash__";typeof Symbol=="function"&&(Ui=Symbol(Ui));var cl=16,Um=255,vc=0,Ao={};function wi(I){oe(I!==1/0,"Cannot perform this action with an infinite size.")}n(Jr,xt);function Jr(I){return I==null?Zo():Z0(I)&&!f(I)?I:Zo().withMutations(function(z){var J=i(I);wi(J.size),J.forEach(function(ne,se){return z.set(se,ne)})})}Jr.of=function(){var I=r.call(arguments,0);return Zo().withMutations(function(z){for(var J=0;J<I.length;J+=2){if(J+1>=I.length)throw new Error("Missing value for key: "+I[J]);z.set(I[J],I[J+1])}})},Jr.prototype.toString=function(){return this.__toString("Map {","}")},Jr.prototype.get=function(I,z){return this._root?this._root.get(0,void 0,I,z):z},Jr.prototype.set=function(I,z){return rg(this,I,z)},Jr.prototype.setIn=function(I,z){return this.updateIn(I,x,function(){return z})},Jr.prototype.remove=function(I){return rg(this,I,x)},Jr.prototype.deleteIn=function(I){return this.updateIn(I,function(){return x})},Jr.prototype.update=function(I,z,J){return arguments.length===1?I(this):this.updateIn([I],z,J)},Jr.prototype.updateIn=function(I,z,J){J||(J=z,z=void 0);var ne=Lp(this,a6(I),z,J);return ne===x?void 0:ne},Jr.prototype.clear=function(){return this.size===0?this:this.__ownerID?(this.size=0,this._root=null,this.__hash=void 0,this.__altered=!0,this):Zo()},Jr.prototype.merge=function(){return Vm(this,void 0,arguments)},Jr.prototype.mergeWith=function(I){var z=r.call(arguments,1);return Vm(this,I,z)},Jr.prototype.mergeIn=function(I){var z=r.call(arguments,1);return this.updateIn(I,Zo(),function(J){return typeof J.merge=="function"?J.merge.apply(J,z):z[z.length-1]})},Jr.prototype.mergeDeep=function(){return Vm(this,Nb,arguments)},Jr.prototype.mergeDeepWith=function(I){var z=r.call(arguments,1);return Vm(this,zb(I),z)},Jr.prototype.mergeDeepIn=function(I){var z=r.call(arguments,1);return this.updateIn(I,Zo(),function(J){return typeof J.mergeDeep=="function"?J.mergeDeep.apply(J,z):z[z.length-1]})},Jr.prototype.sort=function(I){return Un(yc(this,I))},Jr.prototype.sortBy=function(I,z){return Un(yc(this,z,I))},Jr.prototype.withMutations=function(I){var z=this.asMutable();return I(z),z.wasAltered()?z.__ensureOwner(this.__ownerID):this},Jr.prototype.asMutable=function(){return this.__ownerID?this:this.__ensureOwner(new P)},Jr.prototype.asImmutable=function(){return this.__ensureOwner()},Jr.prototype.wasAltered=function(){return this.__altered},Jr.prototype.__iterator=function(I,z){return new J0(this,I,z)},Jr.prototype.__iterate=function(I,z){var J=this,ne=0;return this._root&&this._root.iterate(function(se){return ne++,I(se[1],se[0],J)},z),ne},Jr.prototype.__ensureOwner=function(I){return I===this.__ownerID?this:I?tg(this.size,this._root,I,this.__hash):(this.__ownerID=I,this.__altered=!1,this)};function Z0(I){return!!(I&&I[Bb])}Jr.isMap=Z0;var Bb="@@__IMMUTABLE_MAP__@@",Wr=Jr.prototype;Wr[Bb]=!0,Wr[g]=Wr.remove,Wr.removeIn=Wr.deleteIn;function Bp(I,z){this.ownerID=I,this.entries=z}Bp.prototype.get=function(I,z,J,ne){for(var se=this.entries,Ce=0,Ie=se.length;Ce<Ie;Ce++)if(tt(J,se[Ce][0]))return se[Ce][1];return ne},Bp.prototype.update=function(I,z,J,ne,se,Ce,Ie){for(var qe=se===x,at=this.entries,ft=0,Ct=at.length;ft<Ct&&!tt(ne,at[ft][0]);ft++);var jt=ft<Ct;if(jt?at[ft][1]===se:qe)return this;if(E(Ie),(qe||!jt)&&E(Ce),!(qe&&at.length===1)){if(!jt&&!qe&&at.length>=Y_)return G_(I,at,ne,se);var er=I&&I===this.ownerID,Er=er?at:D(at);return jt?qe?ft===Ct-1?Er.pop():Er[ft]=Er.pop():Er[ft]=[ne,se]:Er.push([ne,se]),er?(this.entries=Er,this):new Bp(I,Er)}};function dl(I,z,J){this.ownerID=I,this.bitmap=z,this.nodes=J}dl.prototype.get=function(I,z,J,ne){z===void 0&&(z=Jt(J));var se=1<<((I===0?z:z>>>I)&S),Ce=this.bitmap;return(Ce&se)===0?ne:this.nodes[Hm(Ce&se-1)].get(I+y,z,J,ne)},dl.prototype.update=function(I,z,J,ne,se,Ce,Ie){J===void 0&&(J=Jt(ne));var qe=(z===0?J:J>>>z)&S,at=1<<qe,ft=this.bitmap,Ct=(ft&at)!==0;if(!Ct&&se===x)return this;var jt=Hm(ft&at-1),er=this.nodes,Er=Ct?er[jt]:void 0,Xr=ng(Er,I,z+y,J,ne,se,Ce,Ie);if(Xr===Er)return this;if(!Ct&&Xr&&er.length>=K_)return W_(I,er,ft,qe,Xr);if(Ct&&!Xr&&er.length===2&&Lb(er[jt^1]))return er[jt^1];if(Ct&&Xr&&er.length===1&&Lb(Xr))return Xr;var ca=I&&I===this.ownerID,Au=Ct?Xr?ft:ft^at:ft|at,ml=Ct?Xr?Vb(er,jt,Xr,ca):Hb(er,jt,ca):X_(er,jt,Xr,ca);return ca?(this.bitmap=Au,this.nodes=ml,this):new dl(I,Au,ml)};function Fp(I,z,J){this.ownerID=I,this.count=z,this.nodes=J}Fp.prototype.get=function(I,z,J,ne){z===void 0&&(z=Jt(J));var se=(I===0?z:z>>>I)&S,Ce=this.nodes[se];return Ce?Ce.get(I+y,z,J,ne):ne},Fp.prototype.update=function(I,z,J,ne,se,Ce,Ie){J===void 0&&(J=Jt(ne));var qe=(z===0?J:J>>>z)&S,at=se===x,ft=this.nodes,Ct=ft[qe];if(at&&!Ct)return this;var jt=ng(Ct,I,z+y,J,ne,se,Ce,Ie);if(jt===Ct)return this;var er=this.count;if(!Ct)er++;else if(!jt&&(er--,er<$_))return q_(I,ft,er,qe);var Er=I&&I===this.ownerID,Xr=Vb(ft,qe,jt,Er);return Er?(this.count=er,this.nodes=Xr,this):new Fp(I,er,Xr)};function _u(I,z,J){this.ownerID=I,this.keyHash=z,this.entries=J}_u.prototype.get=function(I,z,J,ne){for(var se=this.entries,Ce=0,Ie=se.length;Ce<Ie;Ce++)if(tt(J,se[Ce][0]))return se[Ce][1];return ne},_u.prototype.update=function(I,z,J,ne,se,Ce,Ie){J===void 0&&(J=Jt(ne));var qe=se===x;if(J!==this.keyHash)return qe?this:(E(Ie),E(Ce),ag(this,I,z,J,[ne,se]));for(var at=this.entries,ft=0,Ct=at.length;ft<Ct&&!tt(ne,at[ft][0]);ft++);var jt=ft<Ct;if(jt?at[ft][1]===se:qe)return this;if(E(Ie),(qe||!jt)&&E(Ce),qe&&Ct===2)return new Qo(I,this.keyHash,at[ft^1]);var er=I&&I===this.ownerID,Er=er?at:D(at);return jt?qe?ft===Ct-1?Er.pop():Er[ft]=Er.pop():Er[ft]=[ne,se]:Er.push([ne,se]),er?(this.entries=Er,this):new _u(I,this.keyHash,Er)};function Qo(I,z,J){this.ownerID=I,this.keyHash=z,this.entry=J}Qo.prototype.get=function(I,z,J,ne){return tt(J,this.entry[0])?this.entry[1]:ne},Qo.prototype.update=function(I,z,J,ne,se,Ce,Ie){var qe=se===x,at=tt(ne,this.entry[0]);if(at?se===this.entry[1]:qe)return this;if(E(Ie),qe){E(Ce);return}return at?I&&I===this.ownerID?(this.entry[1]=se,this):new Qo(I,this.keyHash,[ne,se]):(E(Ce),ag(this,I,z,Jt(ne),[ne,se]))},Bp.prototype.iterate=_u.prototype.iterate=function(I,z){for(var J=this.entries,ne=0,se=J.length-1;ne<=se;ne++)if(I(J[z?se-ne:ne])===!1)return!1},dl.prototype.iterate=Fp.prototype.iterate=function(I,z){for(var J=this.nodes,ne=0,se=J.length-1;ne<=se;ne++){var Ce=J[z?se-ne:ne];if(Ce&&Ce.iterate(I,z)===!1)return!1}},Qo.prototype.iterate=function(I,z){return I(this.entry)},n(J0,R);function J0(I,z,J){this._type=z,this._reverse=J,this._stack=I._root&&eg(I._root)}J0.prototype.next=function(){for(var I=this._type,z=this._stack;z;){var J=z.node,ne=z.index++,se;if(J.entry){if(ne===0)return Xd(I,J.entry)}else if(J.entries){if(se=J.entries.length-1,ne<=se)return Xd(I,J.entries[this._reverse?se-ne:ne])}else if(se=J.nodes.length-1,ne<=se){var Ce=J.nodes[this._reverse?se-ne:ne];if(Ce){if(Ce.entry)return Xd(I,Ce.entry);z=this._stack=eg(Ce,z)}continue}z=this._stack=this._stack.__prev}return re()};function Xd(I,z){return Y(I,z[0],z[1])}function eg(I,z){return{node:I,index:0,__prev:z}}function tg(I,z,J,ne){var se=Object.create(Wr);return se.size=I,se._root=z,se.__ownerID=J,se.__hash=ne,se.__altered=!1,se}var Fb;function Zo(){return Fb||(Fb=tg(0))}function rg(I,z,J){var ne,se;if(I._root){var Ce=_(C),Ie=_(w);if(ne=ng(I._root,I.__ownerID,0,void 0,z,J,Ce,Ie),!Ie.value)return I;se=I.size+(Ce.value?J===x?-1:1:0)}else{if(J===x)return I;se=1,ne=new Bp(I.__ownerID,[[z,J]])}return I.__ownerID?(I.size=se,I._root=ne,I.__hash=void 0,I.__altered=!0,I):ne?tg(se,ne):Zo()}function ng(I,z,J,ne,se,Ce,Ie,qe){return I?I.update(z,J,ne,se,Ce,Ie,qe):Ce===x?I:(E(qe),E(Ie),new Qo(z,ne,[se,Ce]))}function Lb(I){return I.constructor===Qo||I.constructor===_u}function ag(I,z,J,ne,se){if(I.keyHash===ne)return new _u(z,ne,[I.entry,se]);var Ce=(J===0?I.keyHash:I.keyHash>>>J)&S,Ie=(J===0?ne:ne>>>J)&S,qe,at=Ce===Ie?[ag(I,z,J+y,ne,se)]:(qe=new Qo(z,ne,se),Ce<Ie?[I,qe]:[qe,I]);return new dl(z,1<<Ce|1<<Ie,at)}function G_(I,z,J,ne){I||(I=new P);for(var se=new Qo(I,Jt(J),[J,ne]),Ce=0;Ce<z.length;Ce++){var Ie=z[Ce];se=se.update(I,0,void 0,Ie[0],Ie[1])}return se}function q_(I,z,J,ne){for(var se=0,Ce=0,Ie=new Array(J),qe=0,at=1,ft=z.length;qe<ft;qe++,at<<=1){var Ct=z[qe];Ct!==void 0&&qe!==ne&&(se|=at,Ie[Ce++]=Ct)}return new dl(I,se,Ie)}function W_(I,z,J,ne,se){for(var Ce=0,Ie=new Array(b),qe=0;J!==0;qe++,J>>>=1)Ie[qe]=J&1?z[Ce++]:void 0;return Ie[ne]=se,new Fp(I,Ce+1,Ie)}function Vm(I,z,J){for(var ne=[],se=0;se<J.length;se++){var Ce=J[se],Ie=i(Ce);u(Ce)||(Ie=Ie.map(function(qe){return ht(qe)})),ne.push(Ie)}return Ub(I,z,ne)}function Nb(I,z,J){return I&&I.mergeDeep&&u(z)?I.mergeDeep(z):tt(I,z)?I:z}function zb(I){return function(z,J,ne){if(z&&z.mergeDeepWith&&u(J))return z.mergeDeepWith(I,J);var se=I(z,J,ne);return tt(z,se)?z:se}}function Ub(I,z,J){return J=J.filter(function(ne){return ne.size!==0}),J.length===0?I:I.size===0&&!I.__ownerID&&J.length===1?I.constructor(J[0]):I.withMutations(function(ne){for(var se=z?function(Ie,qe){ne.update(qe,x,function(at){return at===x?Ie:z(at,Ie,qe)})}:function(Ie,qe){ne.set(qe,Ie)},Ce=0;Ce<J.length;Ce++)J[Ce].forEach(se)})}function Lp(I,z,J,ne){var se=I===x,Ce=z.next();if(Ce.done){var Ie=se?J:I,qe=ne(Ie);return qe===Ie?I:qe}oe(se||I&&I.set,"invalid keyPath");var at=Ce.value,ft=se?x:I.get(at,x),Ct=Lp(ft,z,J,ne);return Ct===ft?I:Ct===x?I.remove(at):(se?Zo():I).set(at,Ct)}function Hm(I){return I=I-(I>>1&1431655765),I=(I&858993459)+(I>>2&858993459),I=I+(I>>4)&252645135,I=I+(I>>8),I=I+(I>>16),I&127}function Vb(I,z,J,ne){var se=ne?I:D(I);return se[z]=J,se}function X_(I,z,J,ne){var se=I.length+1;if(ne&&z+1===se)return I[z]=J,I;for(var Ce=new Array(se),Ie=0,qe=0;qe<se;qe++)qe===z?(Ce[qe]=J,Ie=-1):Ce[qe]=I[qe+Ie];return Ce}function Hb(I,z,J){var ne=I.length-1;if(J&&z===ne)return I.pop(),I;for(var se=new Array(ne),Ce=0,Ie=0;Ie<ne;Ie++)Ie===z&&(Ce=1),se[Ie]=I[Ie+Ce];return se}var Y_=b/4,K_=b/2,$_=b/4;n(Bn,Tt);function Bn(I){var z=Vp();if(I==null)return z;if(jb(I))return I;var J=o(I),ne=J.size;return ne===0?z:(wi(ne),ne>0&&ne<b?zp(0,ne,y,null,new Bs(J.toArray())):z.withMutations(function(se){se.setSize(ne),J.forEach(function(Ce,Ie){return se.set(Ie,Ce)})}))}Bn.of=function(){return this(arguments)},Bn.prototype.toString=function(){return this.__toString("List [","]")},Bn.prototype.get=function(I,z){if(I=F(this,I),I>=0&&I<this.size){I+=this._origin;var J=og(this,I);return J&&J.array[I&S]}return z},Bn.prototype.set=function(I,z){return ig(this,I,z)},Bn.prototype.remove=function(I){return this.has(I)?I===0?this.shift():I===this.size-1?this.pop():this.splice(I,1):this},Bn.prototype.insert=function(I,z){return this.splice(I,0,z)},Bn.prototype.clear=function(){return this.size===0?this:this.__ownerID?(this.size=this._origin=this._capacity=0,this._level=y,this._root=this._tail=null,this.__hash=void 0,this.__altered=!0,this):Vp()},Bn.prototype.push=function(){var I=arguments,z=this.size;return this.withMutations(function(J){Fs(J,0,z+I.length);for(var ne=0;ne<I.length;ne++)J.set(z+ne,I[ne])})},Bn.prototype.pop=function(){return Fs(this,0,-1)},Bn.prototype.unshift=function(){var I=arguments;return this.withMutations(function(z){Fs(z,-I.length);for(var J=0;J<I.length;J++)z.set(J,I[J])})},Bn.prototype.shift=function(){return Fs(this,1)},Bn.prototype.merge=function(){return jp(this,void 0,arguments)},Bn.prototype.mergeWith=function(I){var z=r.call(arguments,1);return jp(this,I,z)},Bn.prototype.mergeDeep=function(){return jp(this,Nb,arguments)},Bn.prototype.mergeDeepWith=function(I){var z=r.call(arguments,1);return jp(this,zb(I),z)},Bn.prototype.setSize=function(I){return Fs(this,0,I)},Bn.prototype.slice=function(I,z){var J=this.size;return U(I,z,J)?this:Fs(this,j(I,J),te(z,J))},Bn.prototype.__iterator=function(I,z){var J=0,ne=qb(this,z);return new R(function(){var se=ne();return se===Np?re():Y(I,J++,se)})},Bn.prototype.__iterate=function(I,z){for(var J=0,ne=qb(this,z),se;(se=ne())!==Np&&I(se,J++,this)!==!1;);return J},Bn.prototype.__ensureOwner=function(I){return I===this.__ownerID?this:I?zp(this._origin,this._capacity,this._level,this._root,this._tail,I,this.__hash):(this.__ownerID=I,this)};function jb(I){return!!(I&&I[Gb])}Bn.isList=jb;var Gb="@@__IMMUTABLE_LIST__@@",_i=Bn.prototype;_i[Gb]=!0,_i[g]=_i.remove,_i.setIn=Wr.setIn,_i.deleteIn=_i.removeIn=Wr.removeIn,_i.update=Wr.update,_i.updateIn=Wr.updateIn,_i.mergeIn=Wr.mergeIn,_i.mergeDeepIn=Wr.mergeDeepIn,_i.withMutations=Wr.withMutations,_i.asMutable=Wr.asMutable,_i.asImmutable=Wr.asImmutable,_i.wasAltered=Wr.wasAltered;function Bs(I,z){this.array=I,this.ownerID=z}Bs.prototype.removeBefore=function(I,z,J){if(J===z?1<<z:this.array.length===0)return this;var ne=J>>>z&S;if(ne>=this.array.length)return new Bs([],I);var se=ne===0,Ce;if(z>0){var Ie=this.array[ne];if(Ce=Ie&&Ie.removeBefore(I,z-y,J),Ce===Ie&&se)return this}if(se&&!Ce)return this;var qe=Yd(this,I);if(!se)for(var at=0;at<ne;at++)qe.array[at]=void 0;return Ce&&(qe.array[ne]=Ce),qe},Bs.prototype.removeAfter=function(I,z,J){if(J===(z?1<<z:0)||this.array.length===0)return this;var ne=J-1>>>z&S;if(ne>=this.array.length)return this;var se;if(z>0){var Ce=this.array[ne];if(se=Ce&&Ce.removeAfter(I,z-y,J),se===Ce&&ne===this.array.length-1)return this}var Ie=Yd(this,I);return Ie.array.splice(ne+1),se&&(Ie.array[ne]=se),Ie};var Np={};function qb(I,z){var J=I._origin,ne=I._capacity,se=Jo(ne),Ce=I._tail;return Ie(I._root,I._level,0);function Ie(ft,Ct,jt){return Ct===0?qe(ft,jt):at(ft,Ct,jt)}function qe(ft,Ct){var jt=Ct===se?Ce&&Ce.array:ft&&ft.array,er=Ct>J?0:J-Ct,Er=ne-Ct;return Er>b&&(Er=b),function(){if(er===Er)return Np;var Xr=z?--Er:er++;return jt&&jt[Xr]}}function at(ft,Ct,jt){var er,Er=ft&&ft.array,Xr=jt>J?0:J-jt>>Ct,ca=(ne-jt>>Ct)+1;return ca>b&&(ca=b),function(){do{if(er){var Au=er();if(Au!==Np)return Au;er=null}if(Xr===ca)return Np;var ml=z?--ca:Xr++;er=Ie(Er&&Er[ml],Ct-y,jt+(ml<<Ct))}while(!0)}}}function zp(I,z,J,ne,se,Ce,Ie){var qe=Object.create(_i);return qe.size=z-I,qe._origin=I,qe._capacity=z,qe._level=J,qe._root=ne,qe._tail=se,qe.__ownerID=Ce,qe.__hash=Ie,qe.__altered=!1,qe}var Up;function Vp(){return Up||(Up=zp(0,0,y))}function ig(I,z,J){if(z=F(I,z),z!==z)return I;if(z>=I.size||z<0)return I.withMutations(function(Ie){z<0?Fs(Ie,z).set(0,J):Fs(Ie,0,z+1).set(z,J)});z+=I._origin;var ne=I._tail,se=I._root,Ce=_(w);return z>=Jo(I._capacity)?ne=Hp(ne,I.__ownerID,0,z,J,Ce):se=Hp(se,I.__ownerID,I._level,z,J,Ce),Ce.value?I.__ownerID?(I._root=se,I._tail=ne,I.__hash=void 0,I.__altered=!0,I):zp(I._origin,I._capacity,I._level,se,ne):I}function Hp(I,z,J,ne,se,Ce){var Ie=ne>>>J&S,qe=I&&Ie<I.array.length;if(!qe&&se===void 0)return I;var at;if(J>0){var ft=I&&I.array[Ie],Ct=Hp(ft,z,J-y,ne,se,Ce);return Ct===ft?I:(at=Yd(I,z),at.array[Ie]=Ct,at)}return qe&&I.array[Ie]===se?I:(E(Ce),at=Yd(I,z),se===void 0&&Ie===at.array.length-1?at.array.pop():at.array[Ie]=se,at)}function Yd(I,z){return z&&I&&z===I.ownerID?I:new Bs(I?I.array.slice():[],z)}function og(I,z){if(z>=Jo(I._capacity))return I._tail;if(z<1<<I._level+y){for(var J=I._root,ne=I._level;J&&ne>0;)J=J.array[z>>>ne&S],ne-=y;return J}}function Fs(I,z,J){z!==void 0&&(z=z|0),J!==void 0&&(J=J|0);var ne=I.__ownerID||new P,se=I._origin,Ce=I._capacity,Ie=se+z,qe=J===void 0?Ce:J<0?Ce+J:se+J;if(Ie===se&&qe===Ce)return I;if(Ie>=qe)return I.clear();for(var at=I._level,ft=I._root,Ct=0;Ie+Ct<0;)ft=new Bs(ft&&ft.array.length?[void 0,ft]:[],ne),at+=y,Ct+=1<<at;Ct&&(Ie+=Ct,se+=Ct,qe+=Ct,Ce+=Ct);for(var jt=Jo(Ce),er=Jo(qe);er>=1<<at+y;)ft=new Bs(ft&&ft.array.length?[ft]:[],ne),at+=y;var Er=I._tail,Xr=er<jt?og(I,qe-1):er>jt?new Bs([],ne):Er;if(Er&&er>jt&&Ie<Ce&&Er.array.length){ft=Yd(ft,ne);for(var ca=ft,Au=at;Au>y;Au-=y){var ml=jt>>>Au&S;ca=ca.array[ml]=Yd(ca.array[ml],ne)}ca.array[jt>>>y&S]=Er}if(qe<Ce&&(Xr=Xr&&Xr.removeAfter(ne,0,qe)),Ie>=er)Ie-=er,qe-=er,at=y,ft=null,Xr=Xr&&Xr.removeBefore(ne,0,Ie);else if(Ie>se||er<jt){for(Ct=0;ft;){var e2=Ie>>>at&S;if(e2!==er>>>at&S)break;e2&&(Ct+=(1<<at)*e2),at-=y,ft=ft.array[e2]}ft&&Ie>se&&(ft=ft.removeBefore(ne,at,Ie-Ct)),ft&&er<jt&&(ft=ft.removeAfter(ne,at,er-Ct)),Ct&&(Ie-=Ct,qe-=Ct)}return I.__ownerID?(I.size=qe-Ie,I._origin=Ie,I._capacity=qe,I._level=at,I._root=ft,I._tail=Xr,I.__hash=void 0,I.__altered=!0,I):zp(Ie,qe,at,ft,Xr)}function jp(I,z,J){for(var ne=[],se=0,Ce=0;Ce<J.length;Ce++){var Ie=J[Ce],qe=o(Ie);qe.size>se&&(se=qe.size),u(Ie)||(qe=qe.map(function(at){return ht(at)})),ne.push(qe)}return se>I.size&&(I=I.setSize(se)),Ub(I,z,ne)}function Jo(I){return I<b?0:I-1>>>y<<y}n(Un,Jr);function Un(I){return I==null?Gp():Wb(I)?I:Gp().withMutations(function(z){var J=i(I);wi(J.size),J.forEach(function(ne,se){return z.set(se,ne)})})}Un.of=function(){return this(arguments)},Un.prototype.toString=function(){return this.__toString("OrderedMap {","}")},Un.prototype.get=function(I,z){var J=this._map.get(I);return J!==void 0?this._list.get(J)[1]:z},Un.prototype.clear=function(){return this.size===0?this:this.__ownerID?(this.size=0,this._map.clear(),this._list.clear(),this):Gp()},Un.prototype.set=function(I,z){return Yb(this,I,z)},Un.prototype.remove=function(I){return Yb(this,I,x)},Un.prototype.wasAltered=function(){return this._map.wasAltered()||this._list.wasAltered()},Un.prototype.__iterate=function(I,z){var J=this;return this._list.__iterate(function(ne){return ne&&I(ne[1],ne[0],J)},z)},Un.prototype.__iterator=function(I,z){return this._list.fromEntrySeq().__iterator(I,z)},Un.prototype.__ensureOwner=function(I){if(I===this.__ownerID)return this;var z=this._map.__ensureOwner(I),J=this._list.__ensureOwner(I);return I?jm(z,J,I,this.__hash):(this.__ownerID=I,this._map=z,this._list=J,this)};function Wb(I){return Z0(I)&&f(I)}Un.isOrderedMap=Wb,Un.prototype[v]=!0,Un.prototype[g]=Un.prototype.remove;function jm(I,z,J,ne){var se=Object.create(Un.prototype);return se.size=I?I.size:0,se._map=I,se._list=z,se.__ownerID=J,se.__hash=ne,se}var Xb;function Gp(){return Xb||(Xb=jm(Zo(),Vp()))}function Yb(I,z,J){var ne=I._map,se=I._list,Ce=ne.get(z),Ie=Ce!==void 0,qe,at;if(J===x){if(!Ie)return I;se.size>=b&&se.size>=ne.size*2?(at=se.filter(function(ft,Ct){return ft!==void 0&&Ce!==Ct}),qe=at.toKeyedSeq().map(function(ft){return ft[0]}).flip().toMap(),I.__ownerID&&(qe.__ownerID=at.__ownerID=I.__ownerID)):(qe=ne.remove(z),at=Ce===se.size-1?se.pop():se.set(Ce,void 0))}else if(Ie){if(J===se.get(Ce)[1])return I;qe=ne,at=se.set(Ce,[z,J])}else qe=ne.set(z,se.size),at=se.set(se.size,[z,J]);return I.__ownerID?(I.size=qe.size,I._map=qe,I._list=at,I.__hash=void 0,I):jm(qe,at)}n(To,xe);function To(I,z){this._iter=I,this._useKeys=z,this.size=I.size}To.prototype.get=function(I,z){return this._iter.get(I,z)},To.prototype.has=function(I){return this._iter.has(I)},To.prototype.valueSeq=function(){return this._iter.valueSeq()},To.prototype.reverse=function(){var I=this,z=Ht(this,!0);return this._useKeys||(z.valueSeq=function(){return I._iter.toSeq().reverse()}),z},To.prototype.map=function(I,z){var J=this,ne=rt(this,I,z);return this._useKeys||(ne.valueSeq=function(){return J._iter.toSeq().map(I,z)}),ne},To.prototype.__iterate=function(I,z){var J=this,ne;return this._iter.__iterate(this._useKeys?function(se,Ce){return I(se,Ce,J)}:(ne=z?t6(this):0,function(se){return I(se,z?--ne:ne++,J)}),z)},To.prototype.__iterator=function(I,z){if(this._useKeys)return this._iter.__iterator(I,z);var J=this._iter.__iterator(V,z),ne=z?t6(this):0;return new R(function(){var se=J.next();return se.done?se:Y(I,z?--ne:ne++,se.value,se)})},To.prototype[v]=!0,n(gc,Se);function gc(I){this._iter=I,this.size=I.size}gc.prototype.includes=function(I){return this._iter.includes(I)},gc.prototype.__iterate=function(I,z){var J=this,ne=0;return this._iter.__iterate(function(se){return I(se,ne++,J)},z)},gc.prototype.__iterator=function(I,z){var J=this._iter.__iterator(V,z),ne=0;return new R(function(){var se=J.next();return se.done?se:Y(I,ne++,se.value,se)})},n(Kd,ie);function Kd(I){this._iter=I,this.size=I.size}Kd.prototype.has=function(I){return this._iter.includes(I)},Kd.prototype.__iterate=function(I,z){var J=this;return this._iter.__iterate(function(ne){return I(ne,ne,J)},z)},Kd.prototype.__iterator=function(I,z){var J=this._iter.__iterator(V,z);return new R(function(){var ne=J.next();return ne.done?ne:Y(I,ne.value,ne.value,ne)})},n(_e,xe);function _e(I){this._iter=I,this.size=I.size}_e.prototype.entrySeq=function(){return this._iter.toSeq()},_e.prototype.__iterate=function(I,z){var J=this;return this._iter.__iterate(function(ne){if(ne){e6(ne);var se=u(ne);return I(se?ne.get(1):ne[1],se?ne.get(0):ne[0],J)}},z)},_e.prototype.__iterator=function(I,z){var J=this._iter.__iterator(V,z);return new R(function(){for(;;){var ne=J.next();if(ne.done)return ne;var se=ne.value;if(se){e6(se);var Ce=u(se);return Y(I,Ce?se.get(0):se[0],Ce?se.get(1):se[1],ne)}}})},gc.prototype.cacheResult=To.prototype.cacheResult=Kd.prototype.cacheResult=_e.prototype.cacheResult=Z_;function Ve(I){var z=fl(I);return z._iter=I,z.size=I.size,z.flip=function(){return I},z.reverse=function(){var J=I.reverse.apply(this);return J.flip=function(){return I.reverse()},J},z.has=function(J){return I.includes(J)},z.includes=function(J){return I.has(J)},z.cacheResult=Z_,z.__iterateUncached=function(J,ne){var se=this;return I.__iterate(function(Ce,Ie){return J(Ie,Ce,se)!==!1},ne)},z.__iteratorUncached=function(J,ne){if(J===ee){var se=I.__iterator(J,ne);return new R(function(){var Ce=se.next();if(!Ce.done){var Ie=Ce.value[0];Ce.value[0]=Ce.value[1],Ce.value[1]=Ie}return Ce})}return I.__iterator(J===V?W:V,ne)},z}function rt(I,z,J){var ne=fl(I);return ne.size=I.size,ne.has=function(se){return I.has(se)},ne.get=function(se,Ce){var Ie=I.get(se,x);return Ie===x?Ce:z.call(J,Ie,se,I)},ne.__iterateUncached=function(se,Ce){var Ie=this;return I.__iterate(function(qe,at,ft){return se(z.call(J,qe,at,ft),at,Ie)!==!1},Ce)},ne.__iteratorUncached=function(se,Ce){var Ie=I.__iterator(ee,Ce);return new R(function(){var qe=Ie.next();if(qe.done)return qe;var at=qe.value,ft=at[0];return Y(se,ft,z.call(J,at[1],ft,I),qe)})},ne}function Ht(I,z){var J=fl(I);return J._iter=I,J.size=I.size,J.reverse=function(){return I},I.flip&&(J.flip=function(){var ne=Ve(I);return ne.reverse=function(){return I.flip()},ne}),J.get=function(ne,se){return I.get(z?ne:-1-ne,se)},J.has=function(ne){return I.has(z?ne:-1-ne)},J.includes=function(ne){return I.includes(ne)},J.cacheResult=Z_,J.__iterate=function(ne,se){var Ce=this;return I.__iterate(function(Ie,qe){return ne(Ie,qe,Ce)},!se)},J.__iterator=function(ne,se){return I.__iterator(ne,!se)},J}function Qr(I,z,J,ne){var se=fl(I);return ne&&(se.has=function(Ce){var Ie=I.get(Ce,x);return Ie!==x&&!!z.call(J,Ie,Ce,I)},se.get=function(Ce,Ie){var qe=I.get(Ce,x);return qe!==x&&z.call(J,qe,Ce,I)?qe:Ie}),se.__iterateUncached=function(Ce,Ie){var qe=this,at=0;return I.__iterate(function(ft,Ct,jt){if(z.call(J,ft,Ct,jt))return at++,Ce(ft,ne?Ct:at-1,qe)},Ie),at},se.__iteratorUncached=function(Ce,Ie){var qe=I.__iterator(ee,Ie),at=0;return new R(function(){for(;;){var ft=qe.next();if(ft.done)return ft;var Ct=ft.value,jt=Ct[0],er=Ct[1];if(z.call(J,er,jt,I))return Y(Ce,ne?jt:at++,er,ft)}})},se}function En(I,z,J){var ne=Jr().asMutable();return I.__iterate(function(se,Ce){ne.update(z.call(J,se,Ce,I),0,function(Ie){return Ie+1})}),ne.asImmutable()}function Xn(I,z,J){var ne=l(I),se=(f(I)?Un():Jr()).asMutable();I.__iterate(function(Ie,qe){se.update(z.call(J,Ie,qe,I),function(at){return at=at||[],at.push(ne?[qe,Ie]:Ie),at})});var Ce=r6(I);return se.map(function(Ie){return Vn(I,Ce(Ie))})}function Hr(I,z,J,ne){var se=I.size;if(z!==void 0&&(z=z|0),J!==void 0&&(J===1/0?J=se:J=J|0),U(z,J,se))return I;var Ce=j(z,se),Ie=te(J,se);if(Ce!==Ce||Ie!==Ie)return Hr(I.toSeq().cacheResult(),z,J,ne);var qe=Ie-Ce,at;qe===qe&&(at=qe<0?0:qe);var ft=fl(I);return ft.size=at===0?at:I.size&&at||void 0,!ne&&Te(I)&&at>=0&&(ft.get=function(Ct,jt){return Ct=F(this,Ct),Ct>=0&&Ct<at?I.get(Ct+Ce,jt):jt}),ft.__iterateUncached=function(Ct,jt){var er=this;if(at===0)return 0;if(jt)return this.cacheResult().__iterate(Ct,jt);var Er=0,Xr=!0,ca=0;return I.__iterate(function(Au,ml){if(!(Xr&&(Xr=Er++<Ce)))return ca++,Ct(Au,ne?ml:ca-1,er)!==!1&&ca!==at}),ca},ft.__iteratorUncached=function(Ct,jt){if(at!==0&&jt)return this.cacheResult().__iterator(Ct,jt);var er=at!==0&&I.__iterator(Ct,jt),Er=0,Xr=0;return new R(function(){for(;Er++<Ce;)er.next();if(++Xr>at)return re();var ca=er.next();return ne||Ct===V?ca:Ct===W?Y(Ct,Xr-1,void 0,ca):Y(Ct,Xr-1,ca.value[1],ca)})},ft}function Yn(I,z,J){var ne=fl(I);return ne.__iterateUncached=function(se,Ce){var Ie=this;if(Ce)return this.cacheResult().__iterate(se,Ce);var qe=0;return I.__iterate(function(at,ft,Ct){return z.call(J,at,ft,Ct)&&++qe&&se(at,ft,Ie)}),qe},ne.__iteratorUncached=function(se,Ce){var Ie=this;if(Ce)return this.cacheResult().__iterator(se,Ce);var qe=I.__iterator(ee,Ce),at=!0;return new R(function(){if(!at)return re();var ft=qe.next();if(ft.done)return ft;var Ct=ft.value,jt=Ct[0],er=Ct[1];return z.call(J,er,jt,Ie)?se===ee?ft:Y(se,jt,er,ft):(at=!1,re())})},ne}function ao(I,z,J,ne){var se=fl(I);return se.__iterateUncached=function(Ce,Ie){var qe=this;if(Ie)return this.cacheResult().__iterate(Ce,Ie);var at=!0,ft=0;return I.__iterate(function(Ct,jt,er){if(!(at&&(at=z.call(J,Ct,jt,er))))return ft++,Ce(Ct,ne?jt:ft-1,qe)}),ft},se.__iteratorUncached=function(Ce,Ie){var qe=this;if(Ie)return this.cacheResult().__iterator(Ce,Ie);var at=I.__iterator(ee,Ie),ft=!0,Ct=0;return new R(function(){var jt,er,Er;do{if(jt=at.next(),jt.done)return ne||Ce===V?jt:Ce===W?Y(Ce,Ct++,void 0,jt):Y(Ce,Ct++,jt.value[1],jt);var Xr=jt.value;er=Xr[0],Er=Xr[1],ft&&(ft=z.call(J,Er,er,qe))}while(ft);return Ce===ee?jt:Y(Ce,er,Er,jt)})},se}function io(I,z){var J=l(I),ne=[I].concat(z).map(function(Ie){return u(Ie)?J&&(Ie=i(Ie)):Ie=J?Je(Ie):st(Array.isArray(Ie)?Ie:[Ie]),Ie}).filter(function(Ie){return Ie.size!==0});if(ne.length===0)return I;if(ne.length===1){var se=ne[0];if(se===I||J&&l(se)||c(I)&&c(se))return se}var Ce=new O(ne);return J?Ce=Ce.toKeyedSeq():c(I)||(Ce=Ce.toSetSeq()),Ce=Ce.flatten(!0),Ce.size=ne.reduce(function(Ie,qe){if(Ie!==void 0){var at=qe.size;if(at!==void 0)return Ie+at}},0),Ce}function $d(I,z,J){var ne=fl(I);return ne.__iterateUncached=function(se,Ce){var Ie=0,qe=!1;function at(ft,Ct){var jt=this;ft.__iterate(function(er,Er){return(!z||Ct<z)&&u(er)?at(er,Ct+1):se(er,J?Er:Ie++,jt)===!1&&(qe=!0),!qe},Ce)}return at(I,0),Ie},ne.__iteratorUncached=function(se,Ce){var Ie=I.__iterator(se,Ce),qe=[],at=0;return new R(function(){for(;Ie;){var ft=Ie.next();if(ft.done!==!1){Ie=qe.pop();continue}var Ct=ft.value;if(se===ee&&(Ct=Ct[1]),(!z||qe.length<z)&&u(Ct))qe.push(Ie),Ie=Ct.__iterator(se,Ce);else return J?ft:Y(se,at++,Ct,ft)}return re()})},ne}function sg(I,z,J){var ne=r6(I);return I.toSeq().map(function(se,Ce){return ne(z.call(J,se,Ce,I))}).flatten(!0)}function ug(I,z){var J=fl(I);return J.size=I.size&&I.size*2-1,J.__iterateUncached=function(ne,se){var Ce=this,Ie=0;return I.__iterate(function(qe,at){return(!Ie||ne(z,Ie++,Ce)!==!1)&&ne(qe,Ie++,Ce)!==!1},se),Ie},J.__iteratorUncached=function(ne,se){var Ce=I.__iterator(V,se),Ie=0,qe;return new R(function(){return(!qe||Ie%2)&&(qe=Ce.next(),qe.done)?qe:Ie%2?Y(ne,Ie++,z):Y(ne,Ie++,qe.value,qe)})},J}function yc(I,z,J){z||(z=n6);var ne=l(I),se=0,Ce=I.toSeq().map(function(Ie,qe){return[qe,Ie,se++,J?J(Ie,qe,I):Ie]}).toArray();return Ce.sort(function(Ie,qe){return z(Ie[3],qe[3])||Ie[2]-qe[2]}).forEach(ne?function(Ie,qe){Ce[qe].length=2}:function(Ie,qe){Ce[qe]=Ie[1]}),ne?xe(Ce):c(I)?Se(Ce):ie(Ce)}function Kb(I,z,J){if(z||(z=n6),J){var ne=I.toSeq().map(function(se,Ce){return[se,J(se,Ce,I)]}).reduce(function(se,Ce){return JR(z,se[1],Ce[1])?Ce:se});return ne&&ne[0]}else return I.reduce(function(se,Ce){return JR(z,se,Ce)?Ce:se})}function JR(I,z,J){var ne=I(J,z);return ne===0&&J!==z&&(J==null||J!==J)||ne>0}function Q_(I,z,J){var ne=fl(I);return ne.size=new O(J).map(function(se){return se.size}).min(),ne.__iterate=function(se,Ce){for(var Ie=this.__iterator(V,Ce),qe,at=0;!(qe=Ie.next()).done&&se(qe.value,at++,this)!==!1;);return at},ne.__iteratorUncached=function(se,Ce){var Ie=J.map(function(ft){return ft=a(ft),H(Ce?ft.reverse():ft)}),qe=0,at=!1;return new R(function(){var ft;return at||(ft=Ie.map(function(Ct){return Ct.next()}),at=ft.some(function(Ct){return Ct.done})),at?re():Y(se,qe++,z.apply(null,ft.map(function(Ct){return Ct.value})))})},ne}function Vn(I,z){return Te(I)?z:I.constructor(z)}function e6(I){if(I!==Object(I))throw new TypeError("Expected [K, V] tuple: "+I)}function t6(I){return wi(I.size),k(I)}function r6(I){return l(I)?i:c(I)?o:s}function fl(I){return Object.create((l(I)?xe:c(I)?Se:ie).prototype)}function Z_(){return this._iter.cacheResult?(this._iter.cacheResult(),this.size=this._iter.size,this):me.prototype.cacheResult.call(this)}function n6(I,z){return I>z?1:I<z?-1:0}function a6(I){var z=H(I);if(!z){if(!fe(I))throw new TypeError("Expected iterable or array-like: "+I);z=H(a(I))}return z}n(es,xt);function es(I,z){var J,ne=function(Ie){if(Ie instanceof ne)return Ie;if(!(this instanceof ne))return new ne(Ie);if(!J){J=!0;var qe=Object.keys(I);ree(se,qe),se.size=qe.length,se._name=z,se._keys=qe,se._defaultValues=I}this._map=Jr(Ie)},se=ne.prototype=Object.create(Ai);return se.constructor=ne,ne}es.prototype.toString=function(){return this.__toString(i6(this)+" {","}")},es.prototype.has=function(I){return this._defaultValues.hasOwnProperty(I)},es.prototype.get=function(I,z){if(!this.has(I))return z;var J=this._defaultValues[I];return this._map?this._map.get(I,J):J},es.prototype.clear=function(){if(this.__ownerID)return this._map&&this._map.clear(),this;var I=this.constructor;return I._empty||(I._empty=$b(this,Zo()))},es.prototype.set=function(I,z){if(!this.has(I))throw new Error('Cannot set unknown key "'+I+'" on '+i6(this));if(this._map&&!this._map.has(I)){var J=this._defaultValues[I];if(z===J)return this}var ne=this._map&&this._map.set(I,z);return this.__ownerID||ne===this._map?this:$b(this,ne)},es.prototype.remove=function(I){if(!this.has(I))return this;var z=this._map&&this._map.remove(I);return this.__ownerID||z===this._map?this:$b(this,z)},es.prototype.wasAltered=function(){return this._map.wasAltered()},es.prototype.__iterator=function(I,z){var J=this;return i(this._defaultValues).map(function(ne,se){return J.get(se)}).__iterator(I,z)},es.prototype.__iterate=function(I,z){var J=this;return i(this._defaultValues).map(function(ne,se){return J.get(se)}).__iterate(I,z)},es.prototype.__ensureOwner=function(I){if(I===this.__ownerID)return this;var z=this._map&&this._map.__ensureOwner(I);return I?$b(this,z,I):(this.__ownerID=I,this._map=z,this)};var Ai=es.prototype;Ai[g]=Ai.remove,Ai.deleteIn=Ai.removeIn=Wr.removeIn,Ai.merge=Wr.merge,Ai.mergeWith=Wr.mergeWith,Ai.mergeIn=Wr.mergeIn,Ai.mergeDeep=Wr.mergeDeep,Ai.mergeDeepWith=Wr.mergeDeepWith,Ai.mergeDeepIn=Wr.mergeDeepIn,Ai.setIn=Wr.setIn,Ai.update=Wr.update,Ai.updateIn=Wr.updateIn,Ai.withMutations=Wr.withMutations,Ai.asMutable=Wr.asMutable,Ai.asImmutable=Wr.asImmutable;function $b(I,z,J){var ne=Object.create(Object.getPrototypeOf(I));return ne._map=z,ne.__ownerID=J,ne}function i6(I){return I._name||I.constructor.name||"Record"}function ree(I,z){try{z.forEach(nee.bind(void 0,I))}catch{}}function nee(I,z){Object.defineProperty(I,z,{get:function(){return this.get(z)},set:function(J){oe(this.__ownerID,"Cannot set on an immutable record."),this.set(z,J)}})}n(la,Qt);function la(I){return I==null?t4():J_(I)&&!f(I)?I:t4().withMutations(function(z){var J=s(I);wi(J.size),J.forEach(function(ne){return z.add(ne)})})}la.of=function(){return this(arguments)},la.fromKeys=function(I){return this(i(I).keySeq())},la.prototype.toString=function(){return this.__toString("Set {","}")},la.prototype.has=function(I){return this._map.has(I)},la.prototype.add=function(I){return e4(this,this._map.set(I,!0))},la.prototype.remove=function(I){return e4(this,this._map.remove(I))},la.prototype.clear=function(){return e4(this,this._map.clear())},la.prototype.union=function(){var I=r.call(arguments,0);return I=I.filter(function(z){return z.size!==0}),I.length===0?this:this.size===0&&!this.__ownerID&&I.length===1?this.constructor(I[0]):this.withMutations(function(z){for(var J=0;J<I.length;J++)s(I[J]).forEach(function(ne){return z.add(ne)})})},la.prototype.intersect=function(){var I=r.call(arguments,0);if(I.length===0)return this;I=I.map(function(J){return s(J)});var z=this;return this.withMutations(function(J){z.forEach(function(ne){I.every(function(se){return se.includes(ne)})||J.remove(ne)})})},la.prototype.subtract=function(){var I=r.call(arguments,0);if(I.length===0)return this;I=I.map(function(J){return s(J)});var z=this;return this.withMutations(function(J){z.forEach(function(ne){I.some(function(se){return se.includes(ne)})&&J.remove(ne)})})},la.prototype.merge=function(){return this.union.apply(this,arguments)},la.prototype.mergeWith=function(I){var z=r.call(arguments,1);return this.union.apply(this,z)},la.prototype.sort=function(I){return pl(yc(this,I))},la.prototype.sortBy=function(I,z){return pl(yc(this,z,I))},la.prototype.wasAltered=function(){return this._map.wasAltered()},la.prototype.__iterate=function(I,z){var J=this;return this._map.__iterate(function(ne,se){return I(se,se,J)},z)},la.prototype.__iterator=function(I,z){return this._map.map(function(J,ne){return ne}).__iterator(I,z)},la.prototype.__ensureOwner=function(I){if(I===this.__ownerID)return this;var z=this._map.__ensureOwner(I);return I?this.__make(z,I):(this.__ownerID=I,this._map=z,this)};function J_(I){return!!(I&&I[o6])}la.isSet=J_;var o6="@@__IMMUTABLE_SET__@@",ts=la.prototype;ts[o6]=!0,ts[g]=ts.remove,ts.mergeDeep=ts.merge,ts.mergeDeepWith=ts.mergeWith,ts.withMutations=Wr.withMutations,ts.asMutable=Wr.asMutable,ts.asImmutable=Wr.asImmutable,ts.__empty=t4,ts.__make=s6;function e4(I,z){return I.__ownerID?(I.size=z.size,I._map=z,I):z===I._map?I:z.size===0?I.__empty():I.__make(z)}function s6(I,z){var J=Object.create(ts);return J.size=I?I.size:0,J._map=I,J.__ownerID=z,J}var u6;function t4(){return u6||(u6=s6(Zo()))}n(pl,la);function pl(I){return I==null?r4():l6(I)?I:r4().withMutations(function(z){var J=s(I);wi(J.size),J.forEach(function(ne){return z.add(ne)})})}pl.of=function(){return this(arguments)},pl.fromKeys=function(I){return this(i(I).keySeq())},pl.prototype.toString=function(){return this.__toString("OrderedSet {","}")};function l6(I){return J_(I)&&f(I)}pl.isOrderedSet=l6;var Qb=pl.prototype;Qb[v]=!0,Qb.__empty=r4,Qb.__make=c6;function c6(I,z){var J=Object.create(Qb);return J.size=I?I.size:0,J._map=I,J.__ownerID=z,J}var d6;function r4(){return d6||(d6=c6(Gp()))}n(Na,Tt);function Na(I){return I==null?n4():f6(I)?I:n4().unshiftAll(I)}Na.of=function(){return this(arguments)},Na.prototype.toString=function(){return this.__toString("Stack [","]")},Na.prototype.get=function(I,z){var J=this._head;for(I=F(this,I);J&&I--;)J=J.next;return J?J.value:z},Na.prototype.peek=function(){return this._head&&this._head.value},Na.prototype.push=function(){if(arguments.length===0)return this;for(var I=this.size+arguments.length,z=this._head,J=arguments.length-1;J>=0;J--)z={value:arguments[J],next:z};return this.__ownerID?(this.size=I,this._head=z,this.__hash=void 0,this.__altered=!0,this):lg(I,z)},Na.prototype.pushAll=function(I){if(I=o(I),I.size===0)return this;wi(I.size);var z=this.size,J=this._head;return I.reverse().forEach(function(ne){z++,J={value:ne,next:J}}),this.__ownerID?(this.size=z,this._head=J,this.__hash=void 0,this.__altered=!0,this):lg(z,J)},Na.prototype.pop=function(){return this.slice(1)},Na.prototype.unshift=function(){return this.push.apply(this,arguments)},Na.prototype.unshiftAll=function(I){return this.pushAll(I)},Na.prototype.shift=function(){return this.pop.apply(this,arguments)},Na.prototype.clear=function(){return this.size===0?this:this.__ownerID?(this.size=0,this._head=void 0,this.__hash=void 0,this.__altered=!0,this):n4()},Na.prototype.slice=function(I,z){if(U(I,z,this.size))return this;var J=j(I,this.size),ne=te(z,this.size);if(ne!==this.size)return Tt.prototype.slice.call(this,I,z);for(var se=this.size-J,Ce=this._head;J--;)Ce=Ce.next;return this.__ownerID?(this.size=se,this._head=Ce,this.__hash=void 0,this.__altered=!0,this):lg(se,Ce)},Na.prototype.__ensureOwner=function(I){return I===this.__ownerID?this:I?lg(this.size,this._head,I,this.__hash):(this.__ownerID=I,this.__altered=!1,this)},Na.prototype.__iterate=function(I,z){if(z)return this.reverse().__iterate(I);for(var J=0,ne=this._head;ne&&I(ne.value,J++,this)!==!1;)ne=ne.next;return J},Na.prototype.__iterator=function(I,z){if(z)return this.reverse().__iterator(I);var J=0,ne=this._head;return new R(function(){if(ne){var se=ne.value;return ne=ne.next,Y(I,J++,se)}return re()})};function f6(I){return!!(I&&I[p6])}Na.isStack=f6;var p6="@@__IMMUTABLE_STACK__@@",Gm=Na.prototype;Gm[p6]=!0,Gm.withMutations=Wr.withMutations,Gm.asMutable=Wr.asMutable,Gm.asImmutable=Wr.asImmutable,Gm.wasAltered=Wr.wasAltered;function lg(I,z,J,ne){var se=Object.create(Gm);return se.size=I,se._head=z,se.__ownerID=J,se.__hash=ne,se.__altered=!1,se}var h6;function n4(){return h6||(h6=lg(0))}function hl(I,z){var J=function(ne){I.prototype[ne]=z[ne]};return Object.keys(z).forEach(J),Object.getOwnPropertySymbols&&Object.getOwnPropertySymbols(z).forEach(J),I}a.Iterator=R,hl(a,{toArray:function(){wi(this.size);var I=new Array(this.size||0);return this.valueSeq().__iterate(function(z,J){I[J]=z}),I},toIndexedSeq:function(){return new gc(this)},toJS:function(){return this.toSeq().map(function(I){return I&&typeof I.toJS=="function"?I.toJS():I}).__toJS()},toJSON:function(){return this.toSeq().map(function(I){return I&&typeof I.toJSON=="function"?I.toJSON():I}).__toJS()},toKeyedSeq:function(){return new To(this,!0)},toMap:function(){return Jr(this.toKeyedSeq())},toObject:function(){wi(this.size);var I={};return this.__iterate(function(z,J){I[J]=z}),I},toOrderedMap:function(){return Un(this.toKeyedSeq())},toOrderedSet:function(){return pl(l(this)?this.valueSeq():this)},toSet:function(){return la(l(this)?this.valueSeq():this)},toSetSeq:function(){return new Kd(this)},toSeq:function(){return c(this)?this.toIndexedSeq():l(this)?this.toKeyedSeq():this.toSetSeq()},toStack:function(){return Na(l(this)?this.valueSeq():this)},toList:function(){return Bn(l(this)?this.valueSeq():this)},toString:function(){return"[Iterable]"},__toString:function(I,z){return this.size===0?I+z:I+" "+this.toSeq().map(this.__toStringMapper).join(", ")+" "+z},concat:function(){var I=r.call(arguments,0);return Vn(this,io(this,I))},includes:function(I){return this.some(function(z){return tt(z,I)})},entries:function(){return this.__iterator(ee)},every:function(I,z){wi(this.size);var J=!0;return this.__iterate(function(ne,se,Ce){if(!I.call(z,ne,se,Ce))return J=!1,!1}),J},filter:function(I,z){return Vn(this,Qr(this,I,z,!0))},find:function(I,z,J){var ne=this.findEntry(I,z);return ne?ne[1]:J},forEach:function(I,z){return wi(this.size),this.__iterate(z?I.bind(z):I)},join:function(I){wi(this.size),I=I!==void 0?""+I:",";var z="",J=!0;return this.__iterate(function(ne){J?J=!1:z+=I,z+=ne!=null?ne.toString():""}),z},keys:function(){return this.__iterator(W)},map:function(I,z){return Vn(this,rt(this,I,z))},reduce:function(I,z,J){wi(this.size);var ne,se;return arguments.length<2?se=!0:ne=z,this.__iterate(function(Ce,Ie,qe){se?(se=!1,ne=Ce):ne=I.call(J,ne,Ce,Ie,qe)}),ne},reduceRight:function(I,z,J){var ne=this.toKeyedSeq().reverse();return ne.reduce.apply(ne,arguments)},reverse:function(){return Vn(this,Ht(this,!0))},slice:function(I,z){return Vn(this,Hr(this,I,z,!0))},some:function(I,z){return!this.every(Jb(I),z)},sort:function(I){return Vn(this,yc(this,I))},values:function(){return this.__iterator(V)},butLast:function(){return this.slice(0,-1)},isEmpty:function(){return this.size!==void 0?this.size===0:!this.some(function(){return!0})},count:function(I,z){return k(I?this.toSeq().filter(I,z):this)},countBy:function(I,z){return En(this,I,z)},equals:function(I){return wt(this,I)},entrySeq:function(){var I=this;if(I._cache)return new O(I._cache);var z=I.toSeq().map(iee).toIndexedSeq();return z.fromEntrySeq=function(){return I.toSeq()},z},filterNot:function(I,z){return this.filter(Jb(I),z)},findEntry:function(I,z,J){var ne=J;return this.__iterate(function(se,Ce,Ie){if(I.call(z,se,Ce,Ie))return ne=[Ce,se],!1}),ne},findKey:function(I,z){var J=this.findEntry(I,z);return J&&J[0]},findLast:function(I,z,J){return this.toKeyedSeq().reverse().find(I,z,J)},findLastEntry:function(I,z,J){return this.toKeyedSeq().reverse().findEntry(I,z,J)},findLastKey:function(I,z){return this.toKeyedSeq().reverse().findKey(I,z)},first:function(){return this.find(X)},flatMap:function(I,z){return Vn(this,sg(this,I,z))},flatten:function(I){return Vn(this,$d(this,I,!0))},fromEntrySeq:function(){return new _e(this)},get:function(I,z){return this.find(function(J,ne){return tt(ne,I)},void 0,z)},getIn:function(I,z){for(var J=this,ne=a6(I),se;!(se=ne.next()).done;){var Ce=se.value;if(J=J&&J.get?J.get(Ce,x):x,J===x)return z}return J},groupBy:function(I,z){return Xn(this,I,z)},has:function(I){return this.get(I,x)!==x},hasIn:function(I){return this.getIn(I,x)!==x},isSubset:function(I){return I=typeof I.includes=="function"?I:a(I),this.every(function(z){return I.includes(z)})},isSuperset:function(I){return I=typeof I.isSubset=="function"?I:a(I),I.isSubset(this)},keyOf:function(I){return this.findKey(function(z){return tt(z,I)})},keySeq:function(){return this.toSeq().map(aee).toIndexedSeq()},last:function(){return this.toSeq().reverse().first()},lastKeyOf:function(I){return this.toKeyedSeq().reverse().keyOf(I)},max:function(I){return Kb(this,I)},maxBy:function(I,z){return Kb(this,z,I)},min:function(I){return Kb(this,I?m6(I):g6)},minBy:function(I,z){return Kb(this,z?m6(z):g6,I)},rest:function(){return this.slice(1)},skip:function(I){return this.slice(Math.max(0,I))},skipLast:function(I){return Vn(this,this.toSeq().reverse().skip(I).reverse())},skipWhile:function(I,z){return Vn(this,ao(this,I,z,!0))},skipUntil:function(I,z){return this.skipWhile(Jb(I),z)},sortBy:function(I,z){return Vn(this,yc(this,z,I))},take:function(I){return this.slice(0,Math.max(0,I))},takeLast:function(I){return Vn(this,this.toSeq().reverse().take(I).reverse())},takeWhile:function(I,z){return Vn(this,Yn(this,I,z))},takeUntil:function(I,z){return this.takeWhile(Jb(I),z)},valueSeq:function(){return this.toIndexedSeq()},hashCode:function(){return this.__hash||(this.__hash=see(this))}});var oo=a.prototype;oo[p]=!0,oo[Q]=oo.values,oo.__toJS=oo.toArray,oo.__toStringMapper=v6,oo.inspect=oo.toSource=function(){return this.toString()},oo.chain=oo.flatMap,oo.contains=oo.includes,hl(i,{flip:function(){return Vn(this,Ve(this))},mapEntries:function(I,z){var J=this,ne=0;return Vn(this,this.toSeq().map(function(se,Ce){return I.call(z,[Ce,se],ne++,J)}).fromEntrySeq())},mapKeys:function(I,z){var J=this;return Vn(this,this.toSeq().flip().map(function(ne,se){return I.call(z,ne,se,J)}).flip())}});var Zb=i.prototype;Zb[h]=!0,Zb[Q]=oo.entries,Zb.__toJS=oo.toObject,Zb.__toStringMapper=function(I,z){return JSON.stringify(z)+": "+v6(I)},hl(o,{toKeyedSeq:function(){return new To(this,!1)},filter:function(I,z){return Vn(this,Qr(this,I,z,!1))},findIndex:function(I,z){var J=this.findEntry(I,z);return J?J[0]:-1},indexOf:function(I){var z=this.keyOf(I);return z===void 0?-1:z},lastIndexOf:function(I){var z=this.lastKeyOf(I);return z===void 0?-1:z},reverse:function(){return Vn(this,Ht(this,!1))},slice:function(I,z){return Vn(this,Hr(this,I,z,!1))},splice:function(I,z){var J=arguments.length;if(z=Math.max(z|0,0),J===0||J===2&&!z)return this;I=j(I,I<0?this.count():this.size);var ne=this.slice(0,I);return Vn(this,J===1?ne:ne.concat(D(arguments,2),this.slice(I+z)))},findLastIndex:function(I,z){var J=this.findLastEntry(I,z);return J?J[0]:-1},first:function(){return this.get(0)},flatten:function(I){return Vn(this,$d(this,I,!1))},get:function(I,z){return I=F(this,I),I<0||this.size===1/0||this.size!==void 0&&I>this.size?z:this.find(function(J,ne){return ne===I},void 0,z)},has:function(I){return I=F(this,I),I>=0&&(this.size!==void 0?this.size===1/0||I<this.size:this.indexOf(I)!==-1)},interpose:function(I){return Vn(this,ug(this,I))},interleave:function(){var I=[this].concat(D(arguments)),z=Q_(this.toSeq(),Se.of,I),J=z.flatten(!0);return z.size&&(J.size=z.size*I.length),Vn(this,J)},keySeq:function(){return ge(0,this.size)},last:function(){return this.get(-1)},skipWhile:function(I,z){return Vn(this,ao(this,I,z,!1))},zip:function(){var I=[this].concat(D(arguments));return Vn(this,Q_(this,oee,I))},zipWith:function(I){var z=D(arguments);return z[0]=this,Vn(this,Q_(this,I,z))}}),o.prototype[m]=!0,o.prototype[v]=!0,hl(s,{get:function(I,z){return this.has(I)?I:z},includes:function(I){return this.has(I)},keySeq:function(){return this.valueSeq()}}),s.prototype.has=oo.includes,s.prototype.contains=s.prototype.includes,hl(xe,i.prototype),hl(Se,o.prototype),hl(ie,s.prototype),hl(xt,i.prototype),hl(Tt,o.prototype),hl(Qt,s.prototype);function aee(I,z){return z}function iee(I,z){return[z,I]}function Jb(I){return function(){return!I.apply(this,arguments)}}function m6(I){return function(){return-I.apply(this,arguments)}}function v6(I){return typeof I=="string"?JSON.stringify(I):String(I)}function oee(){return D(arguments)}function g6(I,z){return I<z?1:I>z?-1:0}function see(I){if(I.size===1/0)return 0;var z=f(I),J=l(I),ne=z?1:0,se=I.__iterate(J?z?function(Ce,Ie){ne=31*ne+y6(Jt(Ce),Jt(Ie))|0}:function(Ce,Ie){ne=ne+y6(Jt(Ce),Jt(Ie))|0}:z?function(Ce){ne=31*ne+Jt(Ce)|0}:function(Ce){ne=ne+Jt(Ce)|0});return uee(se,ne)}function uee(I,z){return z=dr(z,3432918353),z=dr(z<<15|z>>>-15,461845907),z=dr(z<<13|z>>>-13,5),z=(z+3864292196|0)^I,z=dr(z^z>>>16,2246822507),z=dr(z^z>>>13,3266489909),z=_r(z^z>>>16),z}function y6(I,z){return I^z+2654435769+(I<<6)+(I>>2)|0}var lee={Iterable:a,Seq:me,Collection:Ze,Map:Jr,OrderedMap:Un,List:Bn,Stack:Na,Set:la,OrderedSet:pl,Record:es,Range:ge,Repeat:dt,is:tt,fromJS:ht};return lee})})(ma);var jn=1e-6;function Hn(e,t,r){return Math.abs(e-t)<=r}var Ry=Math.PI/2,fq=Math.PI/180;function rn(e){return e*fq}function qu(e){return e/fq}function fge(e){return e!==0&&(e&e-1)===0}function pge(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r=0,n=0,a=0,i=e.length;a<i;++a){var o=e[a],s=Math.abs(o);s>n&&(r=o,n=s)}return r}function pq(e,t){return e*t}function de(){return de.zero()}(function(e){function t(){var O=[.1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];return O[0]=0,O}e.zero=t;function r(){var O=t();return O[0]=1,O[1]=0,O[2]=0,O[3]=0,O[4]=0,O[5]=1,O[6]=0,O[7]=0,O[8]=0,O[9]=0,O[10]=1,O[11]=0,O[12]=0,O[13]=0,O[14]=0,O[15]=1,O}e.identity=r;function n(O){return O[0]=1,O[1]=0,O[2]=0,O[3]=0,O[4]=0,O[5]=1,O[6]=0,O[7]=0,O[8]=0,O[9]=0,O[10]=1,O[11]=0,O[12]=0,O[13]=0,O[14]=0,O[15]=1,O}e.setIdentity=n;function a(O){for(var G=0;G<16;G++)O[G]=0;return O}e.setZero=a;function i(O){for(var G=t(),ve=0;ve<4;ve++)for(var we=O[ve],Te=0;Te<4;Te++)G[4*Te+ve]=we[Te];return G}e.ofRows=i;var o=r();function s(O,G){return l(O,o,typeof G>"u"?jn:G)}e.isIdentity=s;function u(O){for(var G=0;G<16;G++)if(isNaN(O[G]))return!0;return!1}e.hasNaN=u;function l(O,G,ve){for(var we=0;we<16;we++)if(Math.abs(O[we]-G[we])>ve)return!1;return!0}e.areEqual=l;function c(O,G,ve,we){O[4*ve+G]=we}e.setValue=c;function d(O,G,ve){return O[4*ve+G]}e.getValue=d;function f(O,G,ve){return G[ve+0]=O[0],G[ve+1]=O[1],G[ve+2]=O[2],G[ve+3]=O[3],G[ve+4]=O[4],G[ve+5]=O[5],G[ve+6]=O[6],G[ve+7]=O[7],G[ve+8]=O[8],G[ve+9]=O[9],G[ve+10]=O[10],G[ve+11]=O[11],G[ve+12]=O[12],G[ve+13]=O[13],G[ve+14]=O[14],G[ve+15]=O[15],G}e.toArray=f;function p(O,G,ve){return O[0]=G[ve+0],O[1]=G[ve+1],O[2]=G[ve+2],O[3]=G[ve+3],O[4]=G[ve+4],O[5]=G[ve+5],O[6]=G[ve+6],O[7]=G[ve+7],O[8]=G[ve+8],O[9]=G[ve+9],O[10]=G[ve+10],O[11]=G[ve+11],O[12]=G[ve+12],O[13]=G[ve+13],O[14]=G[ve+14],O[15]=G[ve+15],O}e.fromArray=p;function h(O,G,ve,we){return a(O),c(O,0,0,G[0]),c(O,1,0,G[1]),c(O,2,0,G[2]),c(O,0,1,ve[0]),c(O,1,1,ve[1]),c(O,2,1,ve[2]),c(O,0,2,we[0]),c(O,1,2,we[1]),c(O,2,2,we[2]),c(O,3,3,1),O}e.fromBasis=h;function m(O,G){return O[0]=G[0],O[1]=G[1],O[2]=G[2],O[3]=G[3],O[4]=G[4],O[5]=G[5],O[6]=G[6],O[7]=G[7],O[8]=G[8],O[9]=G[9],O[10]=G[10],O[11]=G[11],O[12]=G[12],O[13]=G[13],O[14]=G[14],O[15]=G[15],O}e.copy=m;function v(O){return m(t(),O)}e.clone=v;function g(O,G){return O[0]=G[12],O[1]=G[13],O[2]=G[14],O}e.getTranslation=g;function y(O,G){var ve=G[0],we=G[1],Te=G[2],Ue=G[4],Ge=G[5],Je=G[6],st=G[8],ze=G[9],et=G[10];return O[0]=Math.sqrt(ve*ve+we*we+Te*Te),O[1]=Math.sqrt(Ue*Ue+Ge*Ge+Je*Je),O[2]=Math.sqrt(st*st+ze*ze+et*et),O}e.getScaling=y;function b(O,G){var ve=G[0]+G[5]+G[10],we=0;return ve>0?(we=Math.sqrt(ve+1)*2,O[3]=.25*we,O[0]=(G[6]-G[9])/we,O[1]=(G[8]-G[2])/we,O[2]=(G[1]-G[4])/we):G[0]>G[5]&&G[0]>G[10]?(we=Math.sqrt(1+G[0]-G[5]-G[10])*2,O[3]=(G[6]-G[9])/we,O[0]=.25*we,O[1]=(G[1]+G[4])/we,O[2]=(G[8]+G[2])/we):G[5]>G[10]?(we=Math.sqrt(1+G[5]-G[0]-G[10])*2,O[3]=(G[8]-G[2])/we,O[0]=(G[1]+G[4])/we,O[1]=.25*we,O[2]=(G[6]+G[9])/we):(we=Math.sqrt(1+G[10]-G[0]-G[5])*2,O[3]=(G[1]-G[4])/we,O[0]=(G[8]+G[2])/we,O[1]=(G[6]+G[9])/we,O[2]=.25*we),O}e.getRotation=b;function S(O,G){var ve=1/Math.sqrt(G[0]*G[0]+G[1]*G[1]+G[2]*G[2]),we=1/Math.sqrt(G[4]*G[4]+G[5]*G[5]+G[6]*G[6]),Te=1/Math.sqrt(G[8]*G[8]+G[9]*G[9]+G[10]*G[10]);return O[0]=G[0]*ve,O[1]=G[1]*ve,O[2]=G[2]*ve,O[3]=0,O[4]=G[4]*we,O[5]=G[5]*we,O[6]=G[6]*we,O[7]=0,O[8]=G[8]*Te,O[9]=G[9]*Te,O[10]=G[10]*Te,O[11]=0,O[12]=0,O[13]=0,O[14]=0,O[15]=1,O}e.extractRotation=S;function x(O,G){if(O===G){var ve=G[1],we=G[2],Te=G[3],Ue=G[6],Ge=G[7],Je=G[11];O[1]=G[4],O[2]=G[8],O[3]=G[12],O[4]=ve,O[6]=G[9],O[7]=G[13],O[8]=we,O[9]=Ue,O[11]=G[14],O[12]=Te,O[13]=Ge,O[14]=Je}else O[0]=G[0],O[1]=G[4],O[2]=G[8],O[3]=G[12],O[4]=G[1],O[5]=G[5],O[6]=G[9],O[7]=G[13],O[8]=G[2],O[9]=G[6],O[10]=G[10],O[11]=G[14],O[12]=G[3],O[13]=G[7],O[14]=G[11],O[15]=G[15];return O}e.transpose=x;function C(O,G){var ve=G[0],we=G[1],Te=G[2],Ue=G[3],Ge=G[4],Je=G[5],st=G[6],ze=G[7],et=G[8],ut=G[9],pt=G[10],ht=G[11],Re=G[12],it=G[13],Fe=G[14],tt=G[15],wt=ve*Je-we*Ge,dt=ve*st-Te*Ge,Et=ve*ze-Ue*Ge,oe=we*st-Te*Je,ge=we*ze-Ue*Je,Ee=Te*ze-Ue*st,Ze=et*it-ut*Re,xt=et*Fe-pt*Re,Tt=et*tt-ht*Re,Qt=ut*Fe-pt*it,dr=ut*tt-ht*it,_r=pt*tt-ht*Fe,Jt=wt*_r-dt*dr+Et*Qt+oe*Tt-ge*xt+Ee*Ze;return Jt?(Jt=1/Jt,O[0]=(Je*_r-st*dr+ze*Qt)*Jt,O[1]=(Te*dr-we*_r-Ue*Qt)*Jt,O[2]=(it*Ee-Fe*ge+tt*oe)*Jt,O[3]=(pt*ge-ut*Ee-ht*oe)*Jt,O[4]=(st*Tt-Ge*_r-ze*xt)*Jt,O[5]=(ve*_r-Te*Tt+Ue*xt)*Jt,O[6]=(Fe*Et-Re*Ee-tt*dt)*Jt,O[7]=(et*Ee-pt*Et+ht*dt)*Jt,O[8]=(Ge*dr-Je*Tt+ze*Ze)*Jt,O[9]=(we*Tt-ve*dr-Ue*Ze)*Jt,O[10]=(Re*ge-it*Et+tt*wt)*Jt,O[11]=(ut*Et-et*ge-ht*wt)*Jt,O[12]=(Je*xt-Ge*Qt-st*Ze)*Jt,O[13]=(ve*Qt-we*xt+Te*Ze)*Jt,O[14]=(it*dt-Re*oe-Fe*wt)*Jt,O[15]=(et*oe-ut*dt+pt*wt)*Jt,!0):!1}e.tryInvert=C;function w(O,G){return C(O,G)||console.warn("non-invertible matrix.",G),O}e.invert=w;function _(O,G,ve){var we=G[0],Te=G[1],Ue=G[2],Ge=G[3],Je=G[4],st=G[5],ze=G[6],et=G[7],ut=G[8],pt=G[9],ht=G[10],Re=G[11],it=G[12],Fe=G[13],tt=G[14],wt=G[15],dt=ve[0],Et=ve[1],oe=ve[2],ge=ve[3];return O[0]=dt*we+Et*Je+oe*ut+ge*it,O[1]=dt*Te+Et*st+oe*pt+ge*Fe,O[2]=dt*Ue+Et*ze+oe*ht+ge*tt,O[3]=dt*Ge+Et*et+oe*Re+ge*wt,dt=ve[4],Et=ve[5],oe=ve[6],ge=ve[7],O[4]=dt*we+Et*Je+oe*ut+ge*it,O[5]=dt*Te+Et*st+oe*pt+ge*Fe,O[6]=dt*Ue+Et*ze+oe*ht+ge*tt,O[7]=dt*Ge+Et*et+oe*Re+ge*wt,dt=ve[8],Et=ve[9],oe=ve[10],ge=ve[11],O[8]=dt*we+Et*Je+oe*ut+ge*it,O[9]=dt*Te+Et*st+oe*pt+ge*Fe,O[10]=dt*Ue+Et*ze+oe*ht+ge*tt,O[11]=dt*Ge+Et*et+oe*Re+ge*wt,dt=ve[12],Et=ve[13],oe=ve[14],ge=ve[15],O[12]=dt*we+Et*Je+oe*ut+ge*it,O[13]=dt*Te+Et*st+oe*pt+ge*Fe,O[14]=dt*Ue+Et*ze+oe*ht+ge*tt,O[15]=dt*Ge+Et*et+oe*Re+ge*wt,O}e.mul=_;function E(O,G,ve,we,Te,Ue){var Ge=G[0+Te],Je=G[1+Te],st=G[2+Te],ze=G[3+Te],et=G[4+Te],ut=G[5+Te],pt=G[6+Te],ht=G[7+Te],Re=G[8+Te],it=G[9+Te],Fe=G[10+Te],tt=G[11+Te],wt=G[12+Te],dt=G[13+Te],Et=G[14+Te],oe=G[15+Te],ge=ve[0+Ue],Ee=ve[1+Ue],Ze=ve[2+Ue],xt=ve[3+Ue];return O[0+we]=ge*Ge+Ee*et+Ze*Re+xt*wt,O[1+we]=ge*Je+Ee*ut+Ze*it+xt*dt,O[2+we]=ge*st+Ee*pt+Ze*Fe+xt*Et,O[3+we]=ge*ze+Ee*ht+Ze*tt+xt*oe,ge=ve[4+Ue],Ee=ve[5+Ue],Ze=ve[6+Ue],xt=ve[7+Ue],O[4+we]=ge*Ge+Ee*et+Ze*Re+xt*wt,O[5+we]=ge*Je+Ee*ut+Ze*it+xt*dt,O[6+we]=ge*st+Ee*pt+Ze*Fe+xt*Et,O[7+we]=ge*ze+Ee*ht+Ze*tt+xt*oe,ge=ve[8+Ue],Ee=ve[9+Ue],Ze=ve[10+Ue],xt=ve[11+Ue],O[8+we]=ge*Ge+Ee*et+Ze*Re+xt*wt,O[9+we]=ge*Je+Ee*ut+Ze*it+xt*dt,O[10+we]=ge*st+Ee*pt+Ze*Fe+xt*Et,O[11+we]=ge*ze+Ee*ht+Ze*tt+xt*oe,ge=ve[12+Ue],Ee=ve[13+Ue],Ze=ve[14+Ue],xt=ve[15+Ue],O[12+we]=ge*Ge+Ee*et+Ze*Re+xt*wt,O[13+we]=ge*Je+Ee*ut+Ze*it+xt*dt,O[14+we]=ge*st+Ee*pt+Ze*Fe+xt*Et,O[15+we]=ge*ze+Ee*ht+Ze*tt+xt*oe,O}e.mulOffset=E;function P(O,G,ve,we){return _(O,_(O,G,ve),we)}e.mul3=P;function D(O,G,ve){var we=ve[0],Te=ve[1],Ue=ve[2],Ge,Je,st,ze,et,ut,pt,ht,Re,it,Fe,tt;return G===O?(O[12]=G[0]*we+G[4]*Te+G[8]*Ue+G[12],O[13]=G[1]*we+G[5]*Te+G[9]*Ue+G[13],O[14]=G[2]*we+G[6]*Te+G[10]*Ue+G[14],O[15]=G[3]*we+G[7]*Te+G[11]*Ue+G[15]):(Ge=G[0],Je=G[1],st=G[2],ze=G[3],et=G[4],ut=G[5],pt=G[6],ht=G[7],Re=G[8],it=G[9],Fe=G[10],tt=G[11],O[0]=Ge,O[1]=Je,O[2]=st,O[3]=ze,O[4]=et,O[5]=ut,O[6]=pt,O[7]=ht,O[8]=Re,O[9]=it,O[10]=Fe,O[11]=tt,O[12]=Ge*we+et*Te+Re*Ue+G[12],O[13]=Je*we+ut*Te+it*Ue+G[13],O[14]=st*we+pt*Te+Fe*Ue+G[14],O[15]=ze*we+ht*Te+tt*Ue+G[15]),O}e.translate=D;function k(O,G){return O[0]=1,O[1]=0,O[2]=0,O[3]=0,O[4]=0,O[5]=1,O[6]=0,O[7]=0,O[8]=0,O[9]=0,O[10]=1,O[11]=0,O[12]=G[0],O[13]=G[1],O[14]=G[2],O[15]=1,O}e.fromTranslation=k;function F(O,G){return O[12]=G[0],O[13]=G[1],O[14]=G[2],O}e.setTranslation=F;function X(O,G,ve,we){return O[0]=ve[0],O[4]=ve[1],O[8]=ve[2],O[1]=we[0],O[5]=we[1],O[9]=we[2],O[2]=G[0],O[6]=G[1],O[10]=G[2],O}e.setAxes=X;function U(O,G,ve,we){var Te=we[0],Ue=we[1],Ge=we[2],Je=Math.sqrt(Te*Te+Ue*Ue+Ge*Ge),st,ze,et,ut,pt,ht,Re,it,Fe,tt,wt,dt,Et,oe,ge,Ee,Ze,xt,Tt,Qt,dr,_r,Jt,ea;return Math.abs(Je)<jn?r():(Je=1/Je,Te*=Je,Ue*=Je,Ge*=Je,st=Math.sin(ve),ze=Math.cos(ve),et=1-ze,ut=G[0],pt=G[1],ht=G[2],Re=G[3],it=G[4],Fe=G[5],tt=G[6],wt=G[7],dt=G[8],Et=G[9],oe=G[10],ge=G[11],Ee=Te*Te*et+ze,Ze=Ue*Te*et+Ge*st,xt=Ge*Te*et-Ue*st,Tt=Te*Ue*et-Ge*st,Qt=Ue*Ue*et+ze,dr=Ge*Ue*et+Te*st,_r=Te*Ge*et+Ue*st,Jt=Ue*Ge*et-Te*st,ea=Ge*Ge*et+ze,O[0]=ut*Ee+it*Ze+dt*xt,O[1]=pt*Ee+Fe*Ze+Et*xt,O[2]=ht*Ee+tt*Ze+oe*xt,O[3]=Re*Ee+wt*Ze+ge*xt,O[4]=ut*Tt+it*Qt+dt*dr,O[5]=pt*Tt+Fe*Qt+Et*dr,O[6]=ht*Tt+tt*Qt+oe*dr,O[7]=Re*Tt+wt*Qt+ge*dr,O[8]=ut*_r+it*Jt+dt*ea,O[9]=pt*_r+Fe*Jt+Et*ea,O[10]=ht*_r+tt*Jt+oe*ea,O[11]=Re*_r+wt*Jt+ge*ea,G!==O&&(O[12]=G[12],O[13]=G[13],O[14]=G[14],O[15]=G[15]),O)}e.rotate=U;function j(O,G,ve){var we=ve[0],Te=ve[1],Ue=ve[2],Ge=Math.sqrt(we*we+Te*Te+Ue*Ue),Je,st,ze;return Math.abs(Ge)<jn?n(O):(Ge=1/Ge,we*=Ge,Te*=Ge,Ue*=Ge,Je=Math.sin(G),st=Math.cos(G),ze=1-st,O[0]=we*we*ze+st,O[1]=Te*we*ze+Ue*Je,O[2]=Ue*we*ze-Te*Je,O[3]=0,O[4]=we*Te*ze-Ue*Je,O[5]=Te*Te*ze+st,O[6]=Ue*Te*ze+we*Je,O[7]=0,O[8]=we*Ue*ze+Te*Je,O[9]=Te*Ue*ze-we*Je,O[10]=Ue*Ue*ze+st,O[11]=0,O[12]=0,O[13]=0,O[14]=0,O[15]=1,O)}e.fromRotation=j;function te(O,G,ve){var we=ve[0],Te=ve[1],Ue=ve[2];return O[0]=G[0]*we,O[1]=G[1]*we,O[2]=G[2]*we,O[3]=G[3]*we,O[4]=G[4]*Te,O[5]=G[5]*Te,O[6]=G[6]*Te,O[7]=G[7]*Te,O[8]=G[8]*Ue,O[9]=G[9]*Ue,O[10]=G[10]*Ue,O[11]=G[11]*Ue,O[12]=G[12],O[13]=G[13],O[14]=G[14],O[15]=G[15],O}e.scale=te;function q(O,G,ve){return O[0]=G[0]*ve,O[1]=G[1]*ve,O[2]=G[2]*ve,O[3]=G[3]*ve,O[4]=G[4]*ve,O[5]=G[5]*ve,O[6]=G[6]*ve,O[7]=G[7]*ve,O[8]=G[8]*ve,O[9]=G[9]*ve,O[10]=G[10]*ve,O[11]=G[11]*ve,O[12]=G[12],O[13]=G[13],O[14]=G[14],O[15]=G[15],O}e.scaleUniformly=q;function W(O,G){return O[0]=G[0],O[1]=0,O[2]=0,O[3]=0,O[4]=0,O[5]=G[1],O[6]=0,O[7]=0,O[8]=0,O[9]=0,O[10]=G[2],O[11]=0,O[12]=0,O[13]=0,O[14]=0,O[15]=1,O}e.fromScaling=W;function V(O,G){return O[0]=G,O[1]=0,O[2]=0,O[3]=0,O[4]=0,O[5]=G,O[6]=0,O[7]=0,O[8]=0,O[9]=0,O[10]=G,O[11]=0,O[12]=0,O[13]=0,O[14]=0,O[15]=1,O}e.fromUniformScaling=V;function ee(O,G){return O[0]=G[0],O[1]=G[1],O[2]=G[2],O[4]=G[3],O[5]=G[4],O[6]=G[5],O[8]=G[6],O[9]=G[7],O[10]=G[8],O}e.fromMat3=ee;function ue(O){for(var G="",ve=0;ve<4;ve++){for(var we=0;we<4;we++)G+=O[4*we+ve].toString(),we<3&&(G+=" ");ve<3&&(G+=`
`)}return G}e.makeTable=ue;function $(O){var G=O[0],ve=O[1],we=O[2],Te=O[3],Ue=O[4],Ge=O[5],Je=O[6],st=O[7],ze=O[8],et=O[9],ut=O[10],pt=O[11],ht=O[12],Re=O[13],it=O[14],Fe=O[15],tt=G*Ge-ve*Ue,wt=G*Je-we*Ue,dt=G*st-Te*Ue,Et=ve*Je-we*Ge,oe=ve*st-Te*Ge,ge=we*st-Te*Je,Ee=ze*Re-et*ht,Ze=ze*it-ut*ht,xt=ze*Fe-pt*ht,Tt=et*it-ut*Re,Qt=et*Fe-pt*Re,dr=ut*Fe-pt*it;return tt*dr-wt*Qt+dt*Tt+Et*xt-oe*Ze+ge*Ee}e.determinant=$;function Q(O,G){return R(O,typeof G<"u"?G:jn)}e.isRotationAndTranslation=Q;function R(O,G){var ve=O[0],we=O[1],Te=O[2],Ue=O[3],Ge=O[4],Je=O[5],st=O[6],ze=O[7],et=O[8],ut=O[9],pt=O[10],ht=O[11],Re=O[15];if(!Hn(Re,1,G)||!Hn(Ue,0,G)||!Hn(ze,0,G)||!Hn(ht,0,G))return!1;var it=Math.abs(ve*(Je*pt-st*ut)-we*(Ge*pt-st*et)+Te*(Ge*ut-Je*et));return!!Hn(it,1,G)}function Y(O,G){return re(O,typeof G<"u"?G:jn)}e.isTranslationAndUniformScaling=Y;function re(O,G){var ve=O[0];return Hn(O[1],0,G)&&Hn(O[2],0,G)&&Hn(O[3],0,G)&&Hn(O[4],0,G)&&Hn(O[5],ve,G)&&Hn(O[6],0,G)&&Hn(O[7],0,G)&&Hn(O[8],0,G)&&Hn(O[9],0,G)&&Hn(O[10],ve,G)&&Hn(O[11],0,G)&&Hn(O[15],1,G)}function K(O,G){var ve=G[0],we=G[1],Te=G[2],Ue=G[3],Ge=ve+ve,Je=we+we,st=Te+Te,ze=ve*Ge,et=we*Ge,ut=we*Je,pt=Te*Ge,ht=Te*Je,Re=Te*st,it=Ue*Ge,Fe=Ue*Je,tt=Ue*st;return O[0]=1-ut-Re,O[1]=et+tt,O[2]=pt-Fe,O[3]=0,O[4]=et-tt,O[5]=1-ze-Re,O[6]=ht+it,O[7]=0,O[8]=pt+Fe,O[9]=ht-it,O[10]=1-ze-ut,O[11]=0,O[12]=0,O[13]=0,O[14]=0,O[15]=1,O}e.fromQuat=K;function L(O,G,ve,we,Te,Ue,Ge){var Je=2*Ue/(ve-G),st=2*Ue/(we-Te),ze=(ve+G)/(ve-G),et=(we+Te)/(we-Te),ut=-(Ge+Ue)/(Ge-Ue),pt=-2*Ge*Ue/(Ge-Ue);return O[0]=Je,O[1]=0,O[2]=0,O[3]=0,O[4]=0,O[5]=st,O[6]=0,O[7]=0,O[8]=ze,O[9]=et,O[10]=ut,O[11]=-1,O[12]=0,O[13]=0,O[14]=pt,O[15]=0,O}e.perspective=L;function H(O,G,ve,we,Te,Ue,Ge){var Je=1/(ve-G),st=1/(we-Te),ze=1/(Ge-Ue),et=(ve+G)*Je,ut=(we+Te)*st,pt=(Ge+Ue)*ze;return O[0]=2*Je,O[1]=0,O[2]=0,O[3]=0,O[4]=0,O[5]=2*st,O[6]=0,O[7]=0,O[8]=0,O[9]=0,O[10]=-2*ze,O[11]=0,O[12]=-et,O[13]=-ut,O[14]=-pt,O[15]=1,O}e.ortho=H;function Z(O,G,ve,we){var Te,Ue,Ge,Je,st,ze,et,ut,pt,ht,Re=G[0],it=G[1],Fe=G[2],tt=we[0],wt=we[1],dt=we[2],Et=ve[0],oe=ve[1],ge=ve[2];return Math.abs(Re-Et)<jn&&Math.abs(it-oe)<jn&&Math.abs(Fe-ge)<jn?n(O):(et=Re-Et,ut=it-oe,pt=Fe-ge,ht=1/Math.sqrt(et*et+ut*ut+pt*pt),et*=ht,ut*=ht,pt*=ht,Te=wt*pt-dt*ut,Ue=dt*et-tt*pt,Ge=tt*ut-wt*et,ht=Math.sqrt(Te*Te+Ue*Ue+Ge*Ge),ht?(ht=1/ht,Te*=ht,Ue*=ht,Ge*=ht):(Te=0,Ue=0,Ge=0),Je=ut*Ge-pt*Ue,st=pt*Te-et*Ge,ze=et*Ue-ut*Te,ht=Math.sqrt(Je*Je+st*st+ze*ze),ht?(ht=1/ht,Je*=ht,st*=ht,ze*=ht):(Je=0,st=0,ze=0),O[0]=Te,O[1]=Je,O[2]=et,O[3]=0,O[4]=Ue,O[5]=st,O[6]=ut,O[7]=0,O[8]=Ge,O[9]=ze,O[10]=pt,O[11]=0,O[12]=-(Te*Re+Ue*it+Ge*Fe),O[13]=-(Je*Re+st*it+ze*Fe),O[14]=-(et*Re+ut*it+pt*Fe),O[15]=1,O)}e.lookAt=Z;function fe(O,G,ve,we){var Te=G[0],Ue=G[1],Ge=G[2],Je=we[0],st=we[1],ze=we[2],et=Te-ve[0],ut=Ue-ve[1],pt=Ge-ve[2],ht=et*et+ut*ut+pt*pt;ht>0&&(ht=1/Math.sqrt(ht),et*=ht,ut*=ht,pt*=ht);var Re=st*pt-ze*ut,it=ze*et-Je*pt,Fe=Je*ut-st*et;return ht=Re*Re+it*it+Fe*Fe,ht>0&&(ht=1/Math.sqrt(ht),Re*=ht,it*=ht,Fe*=ht),O[0]=Re,O[1]=it,O[2]=Fe,O[3]=0,O[4]=ut*Fe-pt*it,O[5]=pt*Re-et*Fe,O[6]=et*it-ut*Re,O[7]=0,O[8]=et,O[9]=ut,O[10]=pt,O[11]=0,O[12]=Te,O[13]=Ue,O[14]=Ge,O[15]=1,O}e.targetTo=fe;function me(O,G){a(O);for(var ve=0;ve<4;ve++){var we=G[ve];c(O,ve,we,1)}return O}e.fromPermutation=me;function xe(O){var G=O[0]*O[0]+O[1]*O[1]+O[2]*O[2],ve=O[4]*O[4]+O[5]*O[5]+O[6]*O[6],we=O[8]*O[8]+O[9]*O[9]+O[10]*O[10];return Math.sqrt(Math.max(G,ve,we))}e.getMaxScaleOnAxis=xe;var Se=[1,0,0],ie=[0,1,0],le=[0,0,1];e.rotX90=j(t(),rn(90),Se),e.rotX180=j(t(),rn(180),Se),e.rotY90=j(t(),rn(90),ie),e.rotY180=j(t(),rn(180),ie),e.rotY270=j(t(),rn(270),ie),e.rotZ90=j(t(),rn(90),le),e.rotZ180=j(t(),rn(180),le),e.rotXY90=_(t(),e.rotX90,e.rotY90),e.rotZY90=_(t(),e.rotZ90,e.rotY90),e.rotZYZ90=_(t(),e.rotZY90,e.rotZ90),e.rotZ90X180=_(t(),e.rotZ90,e.rotX180),e.rotY90Z180=_(t(),e.rotY90,e.rotZ180),e.id=r()})(de||(de={}));function hge(e,t,r){return(e-t)/(r-t)}function $i(e,t,r){return Math.max(t,Math.min(r,e))}function mge(e){return $i(e,0,1)}function fs(e,t,r){return e+(t-e)*r}function oS(e,t,r,n,a,i){var o=(r-e)*i,s=(n-t)*i,u=a*a,l=a*u;return(2*t-2*r+o+s)*l+(-3*t+3*r-2*o-s)*u+o*a+t}function Z4(e,t,r,n){var a=1-n;return a*a*e+2*a*n*t+n*n*r}function vge(e,t,r){return r=mge(hge(r,e,t)),r*r*(3-2*r)}function A(){return A.zero()}(function(e){function t(){var oe=[.1,0,0];return oe[0]=0,oe}e.zero=t;function r(oe){var ge=t();return ge[0]=oe[0],ge[1]=oe[1],ge[2]=oe[2],ge}e.clone=r;function n(oe){return isNaN(oe[0])||isNaN(oe[1])||isNaN(oe[2])}e.hasNaN=n;function a(oe){return oe[0]=NaN,oe[1]=NaN,oe[2]=NaN,oe}e.setNaN=a;function i(oe){return l(oe.x,oe.y,oe.z)}e.fromObj=i;function o(oe){return{x:oe[0],y:oe[1],z:oe[2]}}e.toObj=o;function s(oe,ge,Ee){return oe[0]=ge[Ee+0],oe[1]=ge[Ee+1],oe[2]=ge[Ee+2],oe}e.fromArray=s;function u(oe,ge,Ee){return ge[Ee+0]=oe[0],ge[Ee+1]=oe[1],ge[Ee+2]=oe[2],ge}e.toArray=u;function l(oe,ge,Ee){var Ze=t();return Ze[0]=oe,Ze[1]=ge,Ze[2]=Ee,Ze}e.create=l;function c(oe){var ge=t();return ge[0]=oe[0],ge[1]=oe[1],ge[2]=oe[2],ge}e.ofArray=c;function d(oe,ge,Ee,Ze){return oe[0]=ge,oe[1]=Ee,oe[2]=Ze,oe}e.set=d;function f(oe,ge){return oe[0]=ge[0],oe[1]=ge[1],oe[2]=ge[2],oe}e.copy=f;function p(oe,ge,Ee){return oe[0]=ge[0]+Ee[0],oe[1]=ge[1]+Ee[1],oe[2]=ge[2]+Ee[2],oe}e.add=p;function h(oe,ge,Ee){return oe[0]=ge[0]-Ee[0],oe[1]=ge[1]-Ee[1],oe[2]=ge[2]-Ee[2],oe}e.sub=h;function m(oe,ge,Ee){return oe[0]=ge[0]*Ee[0],oe[1]=ge[1]*Ee[1],oe[2]=ge[2]*Ee[2],oe}e.mul=m;function v(oe,ge,Ee){return oe[0]=ge[0]/Ee[0],oe[1]=ge[1]/Ee[1],oe[2]=ge[2]/Ee[2],oe}e.div=v;function g(oe,ge,Ee){return oe[0]=ge[0]*Ee,oe[1]=ge[1]*Ee,oe[2]=ge[2]*Ee,oe}e.scale=g;function y(oe,ge,Ee,Ze){return oe[0]=ge[0]+Ee[0]*Ze,oe[1]=ge[1]+Ee[1]*Ze,oe[2]=ge[2]+Ee[2]*Ze,oe}e.scaleAndAdd=y;function b(oe,ge,Ee,Ze){return oe[0]=ge[0]-Ee[0]*Ze,oe[1]=ge[1]-Ee[1]*Ze,oe[2]=ge[2]-Ee[2]*Ze,oe}e.scaleAndSub=b;function S(oe,ge,Ee){return oe[0]=ge[0]+Ee,oe[1]=ge[1]+Ee,oe[2]=ge[2]+Ee,oe}e.addScalar=S;function x(oe,ge,Ee){return oe[0]=ge[0]-Ee,oe[1]=ge[1]-Ee,oe[2]=ge[2]-Ee,oe}e.subScalar=x;function C(oe,ge){return oe[0]=Math.round(ge[0]),oe[1]=Math.round(ge[1]),oe[2]=Math.round(ge[2]),oe}e.round=C;function w(oe,ge){return oe[0]=Math.ceil(ge[0]),oe[1]=Math.ceil(ge[1]),oe[2]=Math.ceil(ge[2]),oe}e.ceil=w;function _(oe,ge){return oe[0]=Math.floor(ge[0]),oe[1]=Math.floor(ge[1]),oe[2]=Math.floor(ge[2]),oe}e.floor=_;function E(oe,ge){return oe[0]=Math.trunc(ge[0]),oe[1]=Math.trunc(ge[1]),oe[2]=Math.trunc(ge[2]),oe}e.trunc=E;function P(oe,ge){return oe[0]=Math.abs(ge[0]),oe[1]=Math.abs(ge[1]),oe[2]=Math.abs(ge[2]),oe}e.abs=P;function D(oe,ge,Ee){return oe[0]=Math.min(ge[0],Ee[0]),oe[1]=Math.min(ge[1],Ee[1]),oe[2]=Math.min(ge[2],Ee[2]),oe}e.min=D;function k(oe,ge,Ee){return oe[0]=Math.max(ge[0],Ee[0]),oe[1]=Math.max(ge[1],Ee[1]),oe[2]=Math.max(ge[2],Ee[2]),oe}e.max=k;function F(oe,ge){var Ee=ge[0]-oe[0],Ze=ge[1]-oe[1],xt=ge[2]-oe[2];return Math.sqrt(Ee*Ee+Ze*Ze+xt*xt)}e.distance=F;function X(oe,ge){var Ee=ge[0]-oe[0],Ze=ge[1]-oe[1],xt=ge[2]-oe[2];return Ee*Ee+Ze*Ze+xt*xt}e.squaredDistance=X;function U(oe){var ge=oe[0],Ee=oe[1],Ze=oe[2];return Math.sqrt(ge*ge+Ee*Ee+Ze*Ze)}e.magnitude=U;function j(oe){var ge=oe[0],Ee=oe[1],Ze=oe[2];return ge*ge+Ee*Ee+Ze*Ze}e.squaredMagnitude=j;function te(oe,ge,Ee){return g(oe,V(oe,ge),Ee)}e.setMagnitude=te;function q(oe,ge){return oe[0]=-ge[0],oe[1]=-ge[1],oe[2]=-ge[2],oe}e.negate=q;function W(oe,ge){return oe[0]=1/ge[0],oe[1]=1/ge[1],oe[2]=1/ge[2],oe}e.inverse=W;function V(oe,ge){var Ee=ge[0],Ze=ge[1],xt=ge[2],Tt=Ee*Ee+Ze*Ze+xt*xt;return Tt>0&&(Tt=1/Math.sqrt(Tt),oe[0]=ge[0]*Tt,oe[1]=ge[1]*Tt,oe[2]=ge[2]*Tt),oe}e.normalize=V;function ee(oe,ge){return oe[0]*ge[0]+oe[1]*ge[1]+oe[2]*ge[2]}e.dot=ee;function ue(oe,ge,Ee){var Ze=ge[0],xt=ge[1],Tt=ge[2],Qt=Ee[0],dr=Ee[1],_r=Ee[2];return oe[0]=xt*_r-Tt*dr,oe[1]=Tt*Qt-Ze*_r,oe[2]=Ze*dr-xt*Qt,oe}e.cross=ue;function $(oe,ge,Ee,Ze){var xt=ge[0],Tt=ge[1],Qt=ge[2];return oe[0]=xt+Ze*(Ee[0]-xt),oe[1]=Tt+Ze*(Ee[1]-Tt),oe[2]=Qt+Ze*(Ee[2]-Qt),oe}e.lerp=$;var Q=t();function R(oe,ge,Ee,Ze){var xt=$i(ee(ge,Ee),-1,1),Tt=Math.acos(xt)*Ze;return y(Q,Ee,ge,-xt),V(Q,Q),p(oe,g(oe,ge,Math.cos(Tt)),g(Q,Q,Math.sin(Tt)))}e.slerp=R;function Y(oe,ge,Ee,Ze,xt,Tt){var Qt=Tt*Tt,dr=Qt*(2*Tt-3)+1,_r=Qt*(Tt-2)+Tt,Jt=Qt*(Tt-1),ea=Qt*(3-2*Tt);return oe[0]=ge[0]*dr+Ee[0]*_r+Ze[0]*Jt+xt[0]*ea,oe[1]=ge[1]*dr+Ee[1]*_r+Ze[1]*Jt+xt[1]*ea,oe[2]=ge[2]*dr+Ee[2]*_r+Ze[2]*Jt+xt[2]*ea,oe}e.hermite=Y;function re(oe,ge,Ee,Ze,xt,Tt){var Qt=1-Tt,dr=Qt*Qt,_r=Tt*Tt,Jt=dr*Qt,ea=3*Tt*dr,On=3*_r*Qt,La=_r*Tt;return oe[0]=ge[0]*Jt+Ee[0]*ea+Ze[0]*On+xt[0]*La,oe[1]=ge[1]*Jt+Ee[1]*ea+Ze[1]*On+xt[1]*La,oe[2]=ge[2]*Jt+Ee[2]*ea+Ze[2]*On+xt[2]*La,oe}e.bezier=re;function K(oe,ge,Ee,Ze,xt){return oe[0]=Z4(ge[0],Ee[0],Ze[0],xt),oe[1]=Z4(ge[1],Ee[1],Ze[1],xt),oe[2]=Z4(ge[2],Ee[2],Ze[2],xt),oe}e.quadraticBezier=K;function L(oe,ge,Ee,Ze,xt,Tt,Qt){return oe[0]=oS(ge[0],Ee[0],Ze[0],xt[0],Tt,Qt),oe[1]=oS(ge[1],Ee[1],Ze[1],xt[1],Tt,Qt),oe[2]=oS(ge[2],Ee[2],Ze[2],xt[2],Tt,Qt),oe}e.spline=L;function H(oe,ge){var Ee=Math.random()*2*Math.PI,Ze=Math.random()*2-1,xt=Math.sqrt(1-Ze*Ze)*ge;return oe[0]=Math.cos(Ee)*xt,oe[1]=Math.sin(Ee)*xt,oe[2]=Ze*ge,oe}e.random=H;function Z(oe,ge,Ee){var Ze=ge[0],xt=ge[1],Tt=ge[2],Qt=1/(Ee[3]*Ze+Ee[7]*xt+Ee[11]*Tt+Ee[15]||1);return oe[0]=(Ee[0]*Ze+Ee[4]*xt+Ee[8]*Tt+Ee[12])*Qt,oe[1]=(Ee[1]*Ze+Ee[5]*xt+Ee[9]*Tt+Ee[13])*Qt,oe[2]=(Ee[2]*Ze+Ee[6]*xt+Ee[10]*Tt+Ee[14])*Qt,oe}e.transformMat4=Z;function fe(oe,ge,Ee,Ze,xt,Tt){var Qt=ge[0+xt],dr=ge[1+xt],_r=ge[2+xt],Jt=1/(Ee[3+Tt]*Qt+Ee[7+Tt]*dr+Ee[11+Tt]*_r+Ee[15+Tt]||1);return oe[0+Ze]=(Ee[0+Tt]*Qt+Ee[4+Tt]*dr+Ee[8+Tt]*_r+Ee[12+Tt])*Jt,oe[1+Ze]=(Ee[1+Tt]*Qt+Ee[5+Tt]*dr+Ee[9+Tt]*_r+Ee[13+Tt])*Jt,oe[2+Ze]=(Ee[2+Tt]*Qt+Ee[6+Tt]*dr+Ee[10+Tt]*_r+Ee[14+Tt])*Jt,oe}e.transformMat4Offset=fe;function me(oe,ge,Ee){var Ze=ge[0],xt=ge[1],Tt=ge[2];return oe[0]=Ze*Ee[0]+xt*Ee[3]+Tt*Ee[6],oe[1]=Ze*Ee[1]+xt*Ee[4]+Tt*Ee[7],oe[2]=Ze*Ee[2]+xt*Ee[5]+Tt*Ee[8],oe}e.transformMat3=me;function xe(oe,ge,Ee){var Ze=ge[0],xt=ge[1],Tt=ge[2],Qt=Ee[0],dr=Ee[1],_r=Ee[2],Jt=Ee[3],ea=Jt*Ze+dr*Tt-_r*xt,On=Jt*xt+_r*Ze-Qt*Tt,La=Jt*Tt+Qt*xt-dr*Ze,no=-Qt*Ze-dr*xt-_r*Tt;return oe[0]=ea*Jt+no*-Qt+On*-_r-La*-dr,oe[1]=On*Jt+no*-dr+La*-Qt-ea*-_r,oe[2]=La*Jt+no*-_r+ea*-dr-On*-Qt,oe}e.transformQuat=xe;function Se(oe,ge){var Ee=ee(oe,ge)/Math.sqrt(j(oe)*j(ge));return Math.acos($i(Ee,-1,1))}e.angle=Se;var ie=t(),le=t(),O=t(),G=t(),ve=t(),we=t(),Te=t();function Ue(oe,ge,Ee,Ze){h(ie,oe,ge),h(le,Ee,ge),h(O,ge,Ee),h(G,Ze,Ee),ue(ve,ie,le),ue(we,O,G);var xt=Se(ve,we);return ue(Te,ve,we),ee(le,Te)>0?xt:-xt}e.dihedralAngle=Ue;function Ge(oe,ge){return oe[0]===ge[0]&&oe[1]===ge[1]&&oe[2]===ge[2]}e.exactEquals=Ge;function Je(oe,ge){var Ee=oe[0],Ze=oe[1],xt=oe[2],Tt=ge[0],Qt=ge[1],dr=ge[2];return Math.abs(Ee-Tt)<=jn*Math.max(1,Math.abs(Ee),Math.abs(Tt))&&Math.abs(Ze-Qt)<=jn*Math.max(1,Math.abs(Ze),Math.abs(Qt))&&Math.abs(xt-dr)<=jn*Math.max(1,Math.abs(xt),Math.abs(dr))}e.equals=Je;var st=t();function ze(oe,ge,Ee){var Ze=Se(ge,Ee);if(Math.abs(Ze)<1e-4)return de.setIdentity(oe);if(Math.abs(Ze-Math.PI)<jn)return de.fromScaling(oe,e.negUnit);var xt=ue(st,ge,Ee);return de.fromRotation(oe,Ze,xt)}e.makeRotation=ze;function et(oe){return oe[0]===0&&oe[1]===0&&oe[2]===0}e.isZero=et;function ut(oe,ge,Ee,Ze){h(oe,f(oe,ge),Ze);var xt=ee(Ee,oe)/j(Ee);return p(oe,g(oe,f(oe,Ee),xt),Ze)}e.projectPointOnVector=ut;function pt(oe,ge,Ee){var Ze=ee(Ee,ge)/j(Ee);return g(oe,Ee,Ze)}e.projectOnVector=pt;var ht=t();function Re(oe,ge,Ee){return pt(ht,ge,Ee),h(oe,ge,ht)}e.projectOnPlane=Re;function it(oe,ge,Ee){return V(oe,ue(oe,ue(oe,ge,Ee),ge))}e.orthogonalize=it;function Fe(oe,ge,Ee){return ee(ge,Ee)>0?f(oe,ge):q(oe,f(oe,ge)),oe}e.matchDirection=Fe;var tt=t(),wt=t();function dt(oe,ge,Ee,Ze){return h(tt,Ee,ge),h(wt,Ze,ge),V(oe,ue(oe,tt,wt))}e.triangleNormal=dt;function Et(oe,ge){return"["+oe[0].toPrecision(ge)+" "+oe[1].toPrecision(ge)+" "+oe[2].toPrecision(ge)+"]"}e.toString=Et,e.origin=l(0,0,0),e.unit=l(1,1,1),e.negUnit=l(-1,-1,-1),e.unitX=l(1,0,0),e.unitY=l(0,1,0),e.unitZ=l(0,0,1),e.negUnitX=l(-1,0,0),e.negUnitY=l(0,-1,0),e.negUnitZ=l(0,0,-1)})(A||(A={}));function ia(){return ia.zero()}(function(e){function t(){var $=[.1,0,0,0,0,0,0,0,0];return $[0]=0,$}e.zero=t;function r(){var $=t();return $[0]=1,$[1]=0,$[2]=0,$[3]=0,$[4]=1,$[5]=0,$[6]=0,$[7]=0,$[8]=1,$}e.identity=r;function n($){return $[0]=1,$[1]=0,$[2]=0,$[3]=0,$[4]=1,$[5]=0,$[6]=0,$[7]=0,$[8]=1,$}e.setIdentity=n;function a($,Q,R){return Q[R+0]=$[0],Q[R+1]=$[1],Q[R+2]=$[2],Q[R+3]=$[3],Q[R+4]=$[4],Q[R+5]=$[5],Q[R+6]=$[6],Q[R+7]=$[7],Q[R+8]=$[8],Q}e.toArray=a;function i($,Q,R){return $[0]=Q[R+0],$[1]=Q[R+1],$[2]=Q[R+2],$[3]=Q[R+3],$[4]=Q[R+4],$[5]=Q[R+5],$[6]=Q[R+6],$[7]=Q[R+7],$[8]=Q[R+8],$}e.fromArray=i;function o($,Q){return $[0]=Q[0],$[1]=Q[1],$[2]=Q[2],$[3]=Q[4],$[4]=Q[5],$[5]=Q[6],$[6]=Q[8],$[7]=Q[9],$[8]=Q[10],$}e.fromMat4=o;function s($,Q,R,Y,re,K,L,H,Z){var fe=t();return fe[0]=$,fe[1]=Q,fe[2]=R,fe[3]=Y,fe[4]=re,fe[5]=K,fe[6]=L,fe[7]=H,fe[8]=Z,fe}e.create=s;var u=r();function l($,Q){return f($,u,typeof Q>"u"?jn:Q)}e.isIdentity=l;function c($){for(var Q=0;Q<9;Q++)if(isNaN($[Q]))return!0;return!1}e.hasNaN=c;function d($){return m(t(),$)}e.clone=d;function f($,Q,R){for(var Y=0;Y<9;Y++)if(Math.abs($[Y]-Q[Y])>R)return!1;return!0}e.areEqual=f;function p($,Q,R,Y){$[3*R+Q]=Y}e.setValue=p;function h($,Q,R){return $[3*R+Q]}e.getValue=h;function m($,Q){return $[0]=Q[0],$[1]=Q[1],$[2]=Q[2],$[3]=Q[3],$[4]=Q[4],$[5]=Q[5],$[6]=Q[6],$[7]=Q[7],$[8]=Q[8],$}e.copy=m;function v($,Q){if($===Q){var R=Q[1],Y=Q[2],re=Q[5];$[1]=Q[3],$[2]=Q[6],$[3]=R,$[5]=Q[7],$[6]=Y,$[7]=re}else $[0]=Q[0],$[1]=Q[3],$[2]=Q[6],$[3]=Q[1],$[4]=Q[4],$[5]=Q[7],$[6]=Q[2],$[7]=Q[5],$[8]=Q[8];return $}e.transpose=v;function g($,Q){var R=Q[0],Y=Q[1],re=Q[2],K=Q[3],L=Q[4],H=Q[5],Z=Q[6],fe=Q[7],me=Q[8],xe=me*L-H*fe,Se=-me*K+H*Z,ie=fe*K-L*Z,le=R*xe+Y*Se+re*ie;return le?(le=1/le,$[0]=xe*le,$[1]=(-me*Y+re*fe)*le,$[2]=(H*Y-re*L)*le,$[3]=Se*le,$[4]=(me*R-re*Z)*le,$[5]=(-H*R+re*K)*le,$[6]=ie*le,$[7]=(-fe*R+Y*Z)*le,$[8]=(L*R-Y*K)*le,$):(console.warn("non-invertible matrix.",Q),$)}e.invert=g;function y($,Q){return $===Q?($[3]=Q[1],$[6]=Q[2],$[7]=Q[5]):($[0]=Q[0],$[1]=Q[1],$[2]=Q[2],$[3]=Q[1],$[4]=Q[4],$[5]=Q[5],$[6]=Q[2],$[7]=Q[5],$[8]=Q[8]),$}e.symmtricFromUpper=y;function b($,Q){return $===Q?($[1]=Q[3],$[2]=Q[6],$[5]=Q[7]):($[0]=Q[0],$[1]=Q[3],$[2]=Q[6],$[3]=Q[3],$[4]=Q[4],$[5]=Q[7],$[6]=Q[6],$[7]=Q[7],$[8]=Q[8]),$}e.symmtricFromLower=b;function S($){var Q=$[0],R=$[1],Y=$[2],re=$[3],K=$[4],L=$[5],H=$[6],Z=$[7],fe=$[8],me=fe*K-L*Z,xe=-fe*re+L*H,Se=Z*re-K*H;return Q*me+R*xe+Y*Se}e.determinant=S;function x($){return $[0]+$[4]+$[8]}e.trace=x;function C($,Q,R){return $[0]=Q[0]-R[0],$[1]=Q[1]-R[1],$[2]=Q[2]-R[2],$[3]=Q[3]-R[3],$[4]=Q[4]-R[4],$[5]=Q[5]-R[5],$[6]=Q[6]-R[6],$[7]=Q[7]-R[7],$[8]=Q[8]-R[8],$}e.sub=C;function w($,Q,R){return $[0]=Q[0]+R[0],$[1]=Q[1]+R[1],$[2]=Q[2]+R[2],$[3]=Q[3]+R[3],$[4]=Q[4]+R[4],$[5]=Q[5]+R[5],$[6]=Q[6]+R[6],$[7]=Q[7]+R[7],$[8]=Q[8]+R[8],$}e.add=w;function _($,Q,R){var Y=Q[0],re=Q[1],K=Q[2],L=Q[3],H=Q[4],Z=Q[5],fe=Q[6],me=Q[7],xe=Q[8],Se=R[0],ie=R[1],le=R[2],O=R[3],G=R[4],ve=R[5],we=R[6],Te=R[7],Ue=R[8];return $[0]=Se*Y+ie*L+le*fe,$[1]=Se*re+ie*H+le*me,$[2]=Se*K+ie*Z+le*xe,$[3]=O*Y+G*L+ve*fe,$[4]=O*re+G*H+ve*me,$[5]=O*K+G*Z+ve*xe,$[6]=we*Y+Te*L+Ue*fe,$[7]=we*re+Te*H+Ue*me,$[8]=we*K+Te*Z+Ue*xe,$}e.mul=_;function E($,Q,R){return $[0]=Q[0]-R,$[1]=Q[1]-R,$[2]=Q[2]-R,$[3]=Q[3]-R,$[4]=Q[4]-R,$[5]=Q[5]-R,$[6]=Q[6]-R,$[7]=Q[7]-R,$[8]=Q[8]-R,$}e.subScalar=E;function P($,Q,R){return $[0]=Q[0]+R,$[1]=Q[1]+R,$[2]=Q[2]+R,$[3]=Q[3]+R,$[4]=Q[4]+R,$[5]=Q[5]+R,$[6]=Q[6]+R,$[7]=Q[7]+R,$[8]=Q[8]+R,$}e.addScalar=P;function D($,Q,R){return $[0]=Q[0]*R,$[1]=Q[1]*R,$[2]=Q[2]*R,$[3]=Q[3]*R,$[4]=Q[4]*R,$[5]=Q[5]*R,$[6]=Q[6]*R,$[7]=Q[7]*R,$[8]=Q[8]*R,$}e.mulScalar=D;var k=Math.PI/3,F=t();function X($,Q){var R=Q[1]*Q[1]+Q[2]*Q[2]+Q[5]*Q[5];if(R===0)$[0]=Q[0],$[1]=Q[4],$[2]=Q[8];else{var Y=x(Q)/3,re=Q[0]-Y,K=Q[4]-Y,L=Q[8]-Y,H=re*re+K*K+L*L+2*R,Z=Math.sqrt(H/6);D(F,e.Identity,Y),C(F,Q,F),D(F,F,1/Z);var fe=S(F)/2,me=fe<=-1?k:fe>=1?0:Math.acos(fe)/3;$[0]=Y+2*Z*Math.cos(me),$[2]=Y+2*Z*Math.cos(me+2*k),$[1]=3*Y-$[0]-$[2]}return $}e.symmetricEigenvalues=X;var U=[.1,0,0],j=[.1,0,0],te=[.1,0,0],q=[.1,0,0],W=[.1,0,0],V=[.1,0,0];function ee($,Q,R){A.set(U,Q[0]-R,Q[1],Q[2]),A.set(j,Q[1],Q[4]-R,Q[5]),A.set(te,Q[2],Q[5],Q[8]-R),A.cross(q,U,j),A.cross(W,U,te),A.cross(V,j,te);var Y=A.dot(q,q),re=A.dot(W,W),K=A.dot(V,V),L=Y,H=0;return re>L&&(L=re,H=1),K>L&&(H=2),H===0?A.scale($,q,1/Math.sqrt(Y)):H===1?A.scale($,W,1/Math.sqrt(re)):A.scale($,V,1/Math.sqrt(K)),$}e.eigenvector=ee;function ue($,Q){return o($,Q),g($,$),v($,$),$}e.directionTransform=ue,e.Identity=r()})(ia||(ia={}));function Xe(){return Xe.zero()}(function(e){function t(){var _=[.1,0];return _[0]=0,_}e.zero=t;function r(_){var E=t();return E[0]=_[0],E[1]=_[1],E}e.clone=r;function n(_,E){var P=t();return P[0]=_,P[1]=E,P}e.create=n;function a(_){return isNaN(_[0])||isNaN(_[1])}e.hasNaN=a;function i(_,E,P){return E[P+0]=_[0],E[P+1]=_[1],E}e.toArray=i;function o(_,E,P){return _[0]=E[P+0],_[1]=E[P+1],_}e.fromArray=o;function s(_,E){return _[0]=E[0],_[1]=E[1],_}e.copy=s;function u(_,E,P){return _[0]=E,_[1]=P,_}e.set=u;function l(_,E,P){return _[0]=E[0]+P[0],_[1]=E[1]+P[1],_}e.add=l;function c(_,E,P){return _[0]=E[0]-P[0],_[1]=E[1]-P[1],_}e.sub=c;function d(_,E,P){return _[0]=E[0]*P[0],_[1]=E[1]*P[1],_}e.mul=d;function f(_,E,P){return _[0]=E[0]/P[0],_[1]=E[1]/P[1],_}e.div=f;function p(_,E,P){return _[0]=E[0]*P,_[1]=E[1]*P,_}e.scale=p;function h(_,E){return _[0]=Math.round(E[0]),_[1]=Math.round(E[1]),_}e.round=h;function m(_,E){return _[0]=Math.ceil(E[0]),_[1]=Math.ceil(E[1]),_}e.ceil=m;function v(_,E){return _[0]=Math.floor(E[0]),_[1]=Math.floor(E[1]),_}e.floor=v;function g(_,E){var P=E[0]-_[0],D=E[1]-_[1];return Math.sqrt(P*P+D*D)}e.distance=g;function y(_,E){var P=E[0]-_[0],D=E[1]-_[1];return P*P+D*D}e.squaredDistance=y;function b(_){var E=_[0],P=_[1];return Math.sqrt(E*E+P*P)}e.magnitude=b;function S(_){var E=_[0],P=_[1];return E*E+P*P}e.squaredMagnitude=S;function x(_,E){return _[0]=1/E[0],_[1]=1/E[1],_}e.inverse=x;function C(_,E){return _[0]===E[0]&&_[1]===E[1]}e.areEqual=C;function w(_,E){return"["+_[0].toPrecision(E)+" "+_[1].toPrecision(E)+"}]"}e.toString=w})(Xe||(Xe={}));function Mr(){return Mr.zero()}(function(e){function t(){var k=[.1,0,0,0];return k[0]=0,k}e.zero=t;function r(k){var F=t();return F[0]=k[0],F[1]=k[1],F[2]=k[2],F[3]=k[3],F}e.clone=r;function n(k,F,X,U){var j=t();return j[0]=k,j[1]=F,j[2]=X,j[3]=U,j}e.create=n;function a(k,F){return k[0]=F.center[0],k[1]=F.center[1],k[2]=F.center[2],k[3]=F.radius,k}e.fromSphere=a;function i(k){return a(t(),k)}e.ofSphere=i;function o(k){return isNaN(k[0])||isNaN(k[1])||isNaN(k[2])||isNaN(k[3])}e.hasNaN=o;function s(k,F,X){return F[X+0]=k[0],F[X+1]=k[1],F[X+2]=k[2],F[X+3]=k[3],F}e.toArray=s;function u(k,F,X){return k[0]=F[X+0],k[1]=F[X+1],k[2]=F[X+2],k[3]=F[X+3],k}e.fromArray=u;function l(k,F,X){F[X+0]=k[0],F[X+1]=k[1],F[X+2]=k[2]}e.toVec3Array=l;function c(k,F,X){return k[0]=F[X+0],k[1]=F[X+1],k[2]=F[X+2],k[3]=0,k}e.fromVec3Array=c;function d(k,F){return k[0]=F[0],k[1]=F[1],k[2]=F[2],k[3]=F[3],k}e.copy=d;function f(k,F,X,U,j){return k[0]=F,k[1]=X,k[2]=U,k[3]=j,k}e.set=f;function p(k,F,X){return k[0]=F[0]+X[0],k[1]=F[1]+X[1],k[2]=F[2]+X[2],k[3]=F[3]+X[3],k}e.add=p;function h(k,F){var X=F[0]-k[0],U=F[1]-k[1],j=F[2]-k[2],te=F[3]-k[3];return Math.sqrt(X*X+U*U+j*j+te*te)}e.distance=h;function m(k,F,X){return k[0]=F[0]*X,k[1]=F[1]*X,k[2]=F[2]*X,k[4]=F[4]*X,k}e.scale=m;function v(k,F){return k[0]=Math.round(F[0]),k[1]=Math.round(F[1]),k[2]=Math.round(F[2]),k[3]=Math.round(F[3]),k}e.round=v;function g(k,F){return k[0]=Math.ceil(F[0]),k[1]=Math.ceil(F[1]),k[2]=Math.ceil(F[2]),k[3]=Math.ceil(F[3]),k}e.ceil=g;function y(k,F){return k[0]=Math.floor(F[0]),k[1]=Math.floor(F[1]),k[2]=Math.floor(F[2]),k[3]=Math.floor(F[3]),k}e.floor=y;function b(k,F){var X=F[0]-k[0],U=F[1]-k[1],j=F[2]-k[2],te=F[3]-k[3];return X*X+U*U+j*j+te*te}e.squaredDistance=b;function S(k){var F=k[0],X=k[1],U=k[2],j=k[3];return Math.sqrt(F*F+X*X+U*U+j*j)}e.norm=S;function x(k){var F=k[0],X=k[1],U=k[2],j=k[3];return F*F+X*X+U*U+j*j}e.squaredNorm=x;function C(k,F,X){var U=F[0],j=F[1],te=F[2],q=F[3];return k[0]=X[0]*U+X[4]*j+X[8]*te+X[12]*q,k[1]=X[1]*U+X[5]*j+X[9]*te+X[13]*q,k[2]=X[2]*U+X[6]*j+X[10]*te+X[14]*q,k[3]=X[3]*U+X[7]*j+X[11]*te+X[15]*q,k}e.transformMat4=C;function w(k,F){return k[0]*F[0]+k[1]*F[1]+k[2]*F[2]+k[3]*F[3]}e.dot=w;function _(k,F){return k[0]=1/F[0],k[1]=1/F[1],k[2]=1/F[2],k[3]=1/F[3],k}e.inverse=_;function E(k,F){return k[0]===F[0]&&k[1]===F[1]&&k[2]===F[2]&&k[3]===F[3]}e.exactEquals=E;function P(k,F){var X=k[0],U=k[1],j=k[2],te=k[3],q=F[0],W=F[1],V=F[2],ee=F[3];return Math.abs(X-q)<=jn*Math.max(1,Math.abs(X),Math.abs(q))&&Math.abs(U-W)<=jn*Math.max(1,Math.abs(U),Math.abs(W))&&Math.abs(j-V)<=jn*Math.max(1,Math.abs(j),Math.abs(V))&&Math.abs(te-ee)<=jn*Math.max(1,Math.abs(te),Math.abs(ee))}e.equals=P;function D(k,F){return"["+k[0].toPrecision(F)+" "+k[1].toPrecision(F)+" "+k[2].toPrecision(F)+"  "+k[3].toPrecision(F)+"]"}e.toString=D})(Mr||(Mr={}));function aa(){return aa.zero()}(function(e){function t(){var V=[.1,0,0,0];return V[0]=0,V}e.zero=t;function r(){var V=t();return V[3]=1,V}e.identity=r;function n(V){V[0]=0,V[1]=0,V[2]=0,V[3]=1}e.setIdentity=n;function a(V){return isNaN(V[0])||isNaN(V[1])||isNaN(V[2])||isNaN(V[3])}e.hasNaN=a;function i(V,ee,ue,$){var Q=r();return Q[0]=V,Q[1]=ee,Q[2]=ue,Q[3]=$,Q}e.create=i;function o(V,ee,ue){ue=ue*.5;var $=Math.sin(ue);return V[0]=$*ee[0],V[1]=$*ee[1],V[2]=$*ee[2],V[3]=Math.cos(ue),V}e.setAxisAngle=o;function s(V,ee){var ue=Math.acos(ee[3])*2,$=Math.sin(ue/2);return $!==0?(V[0]=ee[0]/$,V[1]=ee[1]/$,V[2]=ee[2]/$):(V[0]=1,V[1]=0,V[2]=0),ue}e.getAxisAngle=s;function u(V,ee,ue){var $=ee[0],Q=ee[1],R=ee[2],Y=ee[3],re=ue[0],K=ue[1],L=ue[2],H=ue[3];return V[0]=$*H+Y*re+Q*L-R*K,V[1]=Q*H+Y*K+R*re-$*L,V[2]=R*H+Y*L+$*K-Q*re,V[3]=Y*H-$*re-Q*K-R*L,V}e.multiply=u;function l(V,ee,ue){ue*=.5;var $=ee[0],Q=ee[1],R=ee[2],Y=ee[3],re=Math.sin(ue),K=Math.cos(ue);return V[0]=$*K+Y*re,V[1]=Q*K+R*re,V[2]=R*K-Q*re,V[3]=Y*K-$*re,V}e.rotateX=l;function c(V,ee,ue){ue*=.5;var $=ee[0],Q=ee[1],R=ee[2],Y=ee[3],re=Math.sin(ue),K=Math.cos(ue);return V[0]=$*K-R*re,V[1]=Q*K+Y*re,V[2]=R*K+$*re,V[3]=Y*K-Q*re,V}e.rotateY=c;function d(V,ee,ue){ue*=.5;var $=ee[0],Q=ee[1],R=ee[2],Y=ee[3],re=Math.sin(ue),K=Math.cos(ue);return V[0]=$*K+Q*re,V[1]=Q*K-$*re,V[2]=R*K+Y*re,V[3]=Y*K-R*re,V}e.rotateZ=d;function f(V,ee){var ue=ee[0],$=ee[1],Q=ee[2];return V[0]=ue,V[1]=$,V[2]=Q,V[3]=Math.sqrt(Math.abs(1-ue*ue-$*$-Q*Q)),V}e.calculateW=f;function p(V,ee,ue,$){var Q=ee[0],R=ee[1],Y=ee[2],re=ee[3],K=ue[0],L=ue[1],H=ue[2],Z=ue[3],fe,me,xe,Se,ie;return me=Q*K+R*L+Y*H+re*Z,me<0&&(me=-me,K=-K,L=-L,H=-H,Z=-Z),1-me>1e-6?(fe=Math.acos(me),xe=Math.sin(fe),Se=Math.sin((1-$)*fe)/xe,ie=Math.sin($*fe)/xe):(Se=1-$,ie=$),V[0]=Se*Q+ie*K,V[1]=Se*R+ie*L,V[2]=Se*Y+ie*H,V[3]=Se*re+ie*Z,V}e.slerp=p;function h(V,ee){var ue=ee[0],$=ee[1],Q=ee[2],R=ee[3],Y=ue*ue+$*$+Q*Q+R*R,re=Y?1/Y:0;return V[0]=-ue*re,V[1]=-$*re,V[2]=-Q*re,V[3]=R*re,V}e.invert=h;function m(V,ee){return V[0]=-ee[0],V[1]=-ee[1],V[2]=-ee[2],V[3]=ee[3],V}e.conjugate=m;function v(V,ee){var ue=ee[0]+ee[4]+ee[8],$;if(ue>0)$=Math.sqrt(ue+1),V[3]=.5*$,$=.5/$,V[0]=(ee[5]-ee[7])*$,V[1]=(ee[6]-ee[2])*$,V[2]=(ee[1]-ee[3])*$;else{var Q=0;ee[4]>ee[0]&&(Q=1),ee[8]>ee[Q*3+Q]&&(Q=2);var R=(Q+1)%3,Y=(Q+2)%3;$=Math.sqrt(ee[Q*3+Q]-ee[R*3+R]-ee[Y*3+Y]+1),V[Q]=.5*$,$=.5/$,V[3]=(ee[R*3+Y]-ee[Y*3+R])*$,V[R]=(ee[R*3+Q]+ee[Q*3+R])*$,V[Y]=(ee[Y*3+Q]+ee[Q*3+Y])*$}return V}e.fromMat3=v;var g=[0,0,0];function y(V,ee,ue){var $=A.dot(ee,ue)+1;return $<jn?($=0,Math.abs(ee[0])>Math.abs(ee[2])?A.set(g,-ee[1],ee[0],0):A.set(g,0,-ee[2],ee[1])):A.cross(g,ee,ue),V[0]=g[0],V[1]=g[1],V[2]=g[2],V[3]=$,E(V,V),V}e.fromUnitVec3=y;function b(V){var ee=t();return ee[0]=V[0],ee[1]=V[1],ee[2]=V[2],ee[3]=V[3],ee}e.clone=b;function S(V,ee,ue){return ee[ue+0]=V[0],ee[ue+1]=V[1],ee[ue+2]=V[2],ee[ue+3]=V[3],ee}e.toArray=S;function x(V,ee,ue){return V[0]=ee[ue+0],V[1]=ee[ue+1],V[2]=ee[ue+2],V[3]=ee[ue+3],V}e.fromArray=x;function C(V,ee){return V[0]=ee[0],V[1]=ee[1],V[2]=ee[2],V[3]=ee[3],V}e.copy=C;function w(V,ee,ue,$,Q){return V[0]=ee,V[1]=ue,V[2]=$,V[3]=Q,V}e.set=w;function _(V,ee,ue){return V[0]=ee[0]+ue[0],V[1]=ee[1]+ue[1],V[2]=ee[2]+ue[2],V[3]=ee[3]+ue[3],V}e.add=_;function E(V,ee){var ue=ee[0],$=ee[1],Q=ee[2],R=ee[3],Y=ue*ue+$*$+Q*Q+R*R;return Y>0&&(Y=1/Math.sqrt(Y),V[0]=ue*Y,V[1]=$*Y,V[2]=Q*Y,V[3]=R*Y),V}e.normalize=E;var P=[0,0,0],D=[1,0,0],k=[0,1,0];function F(V,ee,ue){var $=A.dot(ee,ue);return $<-.999999?(A.cross(P,D,ee),A.magnitude(P)<1e-6&&A.cross(P,k,ee),A.normalize(P,P),o(V,P,Math.PI),V):$>.999999?(V[0]=0,V[1]=0,V[2]=0,V[3]=1,V):(A.cross(P,ee,ue),V[0]=P[0],V[1]=P[1],V[2]=P[2],V[3]=1+$,E(V,V))}e.rotationTo=F;var X=t(),U=t();function j(V,ee,ue,$,Q,R){return p(X,ee,Q,R),p(U,ue,$,R),p(V,X,U,2*R*(1-R)),V}e.sqlerp=j;var te=[0,0,0,0,0,0,0,0,0];function q(V,ee,ue,$){return te[0]=ue[0],te[3]=ue[1],te[6]=ue[2],te[1]=$[0],te[4]=$[1],te[7]=$[2],te[2]=-ee[0],te[5]=-ee[1],te[8]=-ee[2],E(V,v(V,te))}e.setAxes=q;function W(V,ee){return"["+V[0].toPrecision(ee)+" "+V[1].toPrecision(ee)+" "+V[2].toPrecision(ee)+"  "+V[3].toPrecision(ee)+"]"}e.toString=W,e.Identity=r()})(aa||(aa={}));var Rr;(function(e){function t(x,C,w){for(var _=[],E=0;E<C.length;E++)_[E]=C[C.length-E-1];for(var P=[1],E=1;E<x.length;E++)P[E]=x[_[E-1]];return{dimensions:x,axisOrderFastToSlow:_,axisOrderSlowToFast:C,accessDimensions:P,defaultCtor:w||Float64Array}}function r(x,C){return{space:x,data:C}}e.create=r;function n(x,C,w){var _=t(x,C,w),E=p(_),P=E.get,D=E.set,k=E.add,F=E.dataOffset,X=E.getCoords;return{rank:x.length,dimensions:x,axisOrderSlowToFast:C,create:h(_),get:P,set:D,add:k,dataOffset:F,getCoords:X}}e.Space=n;function a(x){return x}e.Data1=a;function i(x,C){return n([x],[0],C)}e.Vector=i;function o(x,C,w){return n([x,C],[1,0],w)}e.ColumnMajorMatrix=o;function s(x,C,w){return n([x,C],[0,1],w)}e.RowMajorMatrix=s;function u(x,C,w){if(C.rank!==2)throw new Error("Invalid tensor rank");for(var _=Math.min(4,C.dimensions[0]),E=Math.min(4,C.dimensions[1]),P=0;P<_;P++)for(var D=0;D<E;D++)de.setValue(x,P,D,C.get(w,P,D));return x}e.toMat4=u;function l(x,C,w){if(C.rank!==2)throw new Error("Invalid tensor rank");for(var _=Math.min(3,C.dimensions[0]),E=Math.min(3,C.dimensions[1]),P=0;P<_;P++)for(var D=0;D<E;D++)ia.setValue(x,P,D,C.get(w,P,D));return x}e.toMat3=l;function c(x,C,w){if(C.rank!==1)throw new Error("Invalid tensor rank");for(var _=Math.min(3,C.dimensions[0]),E=0;E<_;E++)x[E]=w[E];return x}e.toVec3=c;function d(x,C,w){if(C.rank!==1)throw new Error("Invalid tensor rank");for(var _=Math.min(4,C.dimensions[0]),E=0;E<_;E++)x[E]=w[E];return x}e.toVec4=d;function f(x,C){var w=x.length;if(w!==C.length)return!1;for(var _=0;_<w;_++)if(x[_]!==C[_])return!1;return!0}e.areEqualExact=f;function p(x){var C=x.dimensions,w=x.axisOrderFastToSlow;switch(C.length){case 1:return{get:function(K,L){return K[L]},set:function(K,L,H){return K[L]=H},add:function(K,L,H){return K[L]+=H},dataOffset:function(K){return K},getCoords:function(K,L){return L[0]=K,L}};case 2:{if(w[0]===0&&w[1]===1){var _=C[0];return{get:function(K,L,H){return K[H*_+L]},set:function(K,L,H,Z){return K[H*_+L]=Z},add:function(K,L,H,Z){return K[H*_+L]+=Z},dataOffset:function(K,L){return L*_+K},getCoords:function(K,L){return L[0]=K%_,L[1]=Math.floor(K/_),L}}}if(w[0]===1&&w[1]===0){var E=C[1];return{get:function(K,L,H){return K[L*E+H]},set:function(K,L,H,Z){return K[L*E+H]=Z},add:function(K,L,H,Z){return K[L*E+H]+=Z},dataOffset:function(K,L){return K*E+L},getCoords:function(K,L){return L[0]=Math.floor(K/E),L[1]=K%E,L}}}throw new Error("bad axis order")}case 3:{if(w[0]===0&&w[1]===1&&w[2]===2){var P=C[0],D=C[1],k=P*D;return{get:function(K,L,H,Z){return K[L+H*P+Z*k]},set:function(K,L,H,Z,fe){return K[L+H*P+Z*k]=fe},add:function(K,L,H,Z,fe){return K[L+H*P+Z*k]+=fe},dataOffset:function(K,L,H){return K+L*P+H*k},getCoords:function(K,L){var H=Math.floor(K/P);return L[0]=K%P,L[1]=H%D,L[2]=Math.floor(H/D),L}}}if(w[0]===0&&w[1]===2&&w[2]===1){var F=C[0],X=C[2],U=F*X;return{get:function(K,L,H,Z){return K[L+Z*F+H*U]},set:function(K,L,H,Z,fe){return K[L+Z*F+H*U]=fe},add:function(K,L,H,Z,fe){return K[L+Z*F+H*U]+=fe},dataOffset:function(K,L,H){return K+H*F+L*U},getCoords:function(K,L){var H=Math.floor(K/F);return L[0]=K%F,L[1]=Math.floor(H/X),L[2]=H%X,L}}}if(w[0]===1&&w[1]===0&&w[2]===2){var j=C[1],te=C[0],q=j*te;return{get:function(K,L,H,Z){return K[H+L*j+Z*q]},set:function(K,L,H,Z,fe){return K[H+L*j+Z*q]=fe},add:function(K,L,H,Z,fe){return K[H+L*j+Z*q]+=fe},dataOffset:function(K,L,H){return L+K*j+H*q},getCoords:function(K,L){var H=Math.floor(K/j);return L[0]=H%te,L[1]=K%j,L[2]=Math.floor(H/te),L}}}if(w[0]===1&&w[1]===2&&w[2]===0){var W=C[1],V=C[2],ee=W*V;return{get:function(K,L,H,Z){return K[H+Z*W+L*ee]},set:function(K,L,H,Z,fe){return K[H+Z*W+L*ee]=fe},add:function(K,L,H,Z,fe){return K[H+Z*W+L*ee]+=fe},dataOffset:function(K,L,H){return L+H*W+K*ee},getCoords:function(K,L){var H=Math.floor(K/W);return L[0]=Math.floor(H/V),L[1]=K%W,L[2]=H%V,L}}}if(w[0]===2&&w[1]===0&&w[2]===1){var ue=C[2],$=C[0],Q=ue*$;return{get:function(K,L,H,Z){return K[Z+L*ue+H*Q]},set:function(K,L,H,Z,fe){return K[Z+L*ue+H*Q]=fe},add:function(K,L,H,Z,fe){return K[Z+L*ue+H*Q]+=fe},dataOffset:function(K,L,H){return H+K*ue+L*Q},getCoords:function(K,L){var H=Math.floor(K/ue);return L[0]=H%$,L[1]=Math.floor(H/$),L[2]=K%ue,L}}}if(w[0]===2&&w[1]===1&&w[2]===0){var R=C[2],Y=C[1],re=R*Y;return{get:function(K,L,H,Z){return K[Z+H*R+L*re]},set:function(K,L,H,Z,fe){return K[Z+H*R+L*re]=fe},add:function(K,L,H,Z,fe){return K[Z+H*R+L*re]+=fe},dataOffset:function(K,L,H){return H+L*R+K*re},getCoords:function(K,L){var H=Math.floor(K/R);return L[0]=Math.floor(H/Y),L[1]=H%Y,L[2]=K%R,L}}}throw new Error("bad axis order")}default:return{get:function(K){for(var L=[],H=1;H<arguments.length;H++)L[H-1]=arguments[H];return K[m(x,L)]},set:function(K){for(var L=[],H=1;H<arguments.length;H++)L[H-1]=arguments[H];return K[m(x,L)]=L[L.length-1]},add:function(K){for(var L=[],H=1;H<arguments.length;H++)L[H-1]=arguments[H];return K[m(x,L)]+=L[L.length-1]},dataOffset:function(){for(var K=[],L=0;L<arguments.length;L++)K[L]=arguments[L];return m(x,K)},getCoords:function(K,L){return v(x,K,L)}}}}function h(x){for(var C=x.dimensions,w=1,_=0,E=C.length;_<E;_++)w*=C[_];return function(P){return new(P||x.defaultCtor)(w)}}function m(x,C){for(var w=x.accessDimensions,_=x.axisOrderFastToSlow,E=w.length-1,P=w[E]*C[_[E]],D=E-1;D>=0;D--)P=(P+C[_[D]])*w[D];return P}function v(x,C,w){for(var _=x.dimensions,E=x.axisOrderFastToSlow,P=_.length,D=C,k=0;k<P;k++){var F=_[E[k]];w[E[k]]=D%F,D=Math.floor(D/F)}return w[E[P+1]]=D,w}function g(x){for(var C=[],w=0;w<x.length;w++)C[w]=x[x.length-w-1];return C}e.invertAxisOrder=g;function y(x,C){for(var w=[],_=0;_<x.length;_++)w[_]=x[C[_]];return w}function b(x){for(var C=new Int32Array(x.length),w=0;w<x.length;w++)C[x[w]]=w;return function(_){return y(_,C)}}e.convertToCanonicalAxisIndicesFastToSlow=b;function S(x){for(var C=new Int32Array(x.length),w=0;w<x.length;w++)C[x[x.length-w-1]]=w;return function(_){return y(_,C)}}e.convertToCanonicalAxisIndicesSlowToFast=S})(Rr||(Rr={}));var Nw=Object.prototype.hasOwnProperty;function gge(e,t){for(var r=0,n=Object.keys(t);r<n.length;r++){var a=n[r];!Nw.call(t,a)||typeof e[a]>"u"&&(e[a]=t[a])}return e}function yge(e,t){for(var r=!1,n=0,a=Object.keys(t);n<a.length;n++){var i=a[n];if(!!Nw.call(t,i)&&t[i]!==e[i]){r=!0;break}}return r?Object.assign({},e,t):e}function LD(e,t){if(!e)return!t;if(!t)return!1;var r=Object.keys(e);if(Object.keys(t).length!==r.length)return!1;for(var n=0,a=r;n<a.length;n++){var i=a[n];if(!Nw.call(e,i)||e[i]!==t[i])return!1}return!0}function bge(e,t){for(var r=e,n=0;n<t.length;n++)if(!!t[n]&&(r=yge(e,t[n]),r!==e)){for(var a=n+1;a<t.length;a++)r=Object.assign(r,t[a]);break}return r}function mp(e){if(e===null||typeof e!="object")return e;if(e instanceof Array){for(var t=[],r=0,n=e.length;r<n;r++)t[r]=mp(e[r]);return t}if(typeof e=="object"&&!("prototype"in e)){var t={};for(var a in e)Nw.call(e,a)&&(t[a]=mp(e[a]));return t}throw new Error(`Can't clone, type "`+typeof e+'" unsupported')}function rl(e,t){if(!!e)for(var r=0,n=Object.keys(e);r<n.length;r++){var a=n[r];t(e[a],a)}}function hq(e,t){return t===void 0&&(t=" "),e.replace(/([a-z\xE0-\xFF])([A-Z\xC0\xDF])/g,"$1"+t+"$2")}function Ji(e){return k0(hq(e))}var xge=function(e){return e.toUpperCase()};function Sge(e){return e?typeof e=="string"?e.toUpperCase():(""+e).toUpperCase():""}function k0(e){return e.toLowerCase().replace(/^\w|\s\w/g,xge)}function Cge(e){return e.replace(/_/g," ")}function wge(e){return e.replace(/-/g," ")}function vs(e){return k0(hq(Cge(wge(e))))}function Ta(e,t,r,n){var a=n.length;if(a>r-t)return!1;for(var i=0;i<a;i++)if(e.charCodeAt(t+i)!==n.charCodeAt(i))return!1;return!0}function _ge(e,t){var r=Object.keys(t),n=Object.values(t);return new(Function.bind.apply(Function,Gt(Gt([void 0],r),["return `"+e+"`;"])))().apply(void 0,n)}function jf(e){return e.replace(/<\/?[^>]+>/g,"")}function gi(){return gi.zero()}(function(e){function t(){var P=[.1,0,0];return P[0]=0,P}e.zero=t;function r(P,D,k){var F=t();return F[0]=P,F[1]=D,F[2]=k,F}e.create=r;function n(P,D){var k=vt.toRgb(D),F=k[0],X=k[1],U=k[2],j=E(F,X,U),te=j[0],q=j[1],W=j[2],V=116*q-16;return P[0]=V<0?0:V,P[1]=500*(te-q),P[2]=200*(q-W),P}e.fromColor=n;function a(P,D){return tc.toLab(P,D)}e.fromHcl=a;function i(P){var D=(P[0]+16)/116,k=isNaN(P[1])?D:D+P[1]/500,F=isNaN(P[2])?D:D-P[2]/200;D=m*C(D),k=h*C(k),F=v*C(F);var X=x(3.2404542*k-1.5371385*D-.4985314*F),U=x(-.969266*k+1.8760108*D+.041556*F),j=x(.0556434*k-.2040259*D+1.0572252*F);return vt.fromRgb(Math.round($i(X,0,255)),Math.round($i(U,0,255)),Math.round($i(j,0,255)))}e.toColor=i;function o(P,D){var k=D[0],F=D[1],X=D[2],U=Math.sqrt(F*F+X*X),j=(qu(Math.atan2(X,F))+360)%360;return Math.round(U*1e4)===0&&(j=Number.NaN),P[0]=j,P[1]=U,P[2]=k,P}e.toHcl=o;function s(P,D){return P[0]=D[0],P[1]=D[1],P[2]=D[2],P}e.copy=s;function u(P,D,k){return P[0]=D[0]-p*k,P[1]=D[1],P[2]=D[2],P}e.darken=u;function l(P,D,k){return u(P,D,-k)}e.lighten=l;var c=[0,0,0];function d(P,D,k){return o(c,D),tc.toLab(P,tc.saturate(c,c,k))}e.saturate=d;function f(P,D,k){return d(P,D,-k)}e.desaturate=f;var p=18,h=.95047,m=1,v=1.08883,g=.137931034,y=.206896552,b=.12841855,S=.008856452;function x(P){return 255*(P<=.00304?12.92*P:1.055*Math.pow(P,1/2.4)-.055)}function C(P){return P>y?P*P*P:b*(P-g)}function w(P){return(P/=255)<=.04045?P/12.92:Math.pow((P+.055)/1.055,2.4)}function _(P){return P>S?Math.pow(P,1/3):P/b+g}function E(P,D,k){P=w(P),D=w(D),k=w(k);var F=_((.4124564*P+.3575761*D+.1804375*k)/h),X=_((.2126729*P+.7151522*D+.072175*k)/m),U=_((.0193339*P+.119192*D+.9503041*k)/v);return[F,X,U]}})(gi||(gi={}));function tc(){return tc.zero()}(function(e){function t(){var v=[.1,0,0];return v[0]=0,v}e.zero=t;function r(v,g,y){var b=t();return b[0]=v,b[1]=g,b[2]=y,b}e.create=r;var n=[0,0,0];function a(v,g){return gi.toHcl(v,gi.fromColor(n,g))}e.fromColor=a;function i(v,g){return gi.toHcl(v,g)}e.fromLab=i;var o=[0,0,0];function s(v){return gi.toColor(u(o,v))}e.toColor=s;function u(v,g){var y=g[0],b=g[1],S=g[2];return isNaN(y)&&(y=0),y=rn(y),v[0]=S,v[1]=Math.cos(y)*b,v[2]=Math.sin(y)*b,v}e.toLab=u;function l(v,g){return v[0]=g[0],v[1]=g[1],v[2]=g[2],v}e.copy=l;function c(v,g,y){return v[0]=g[0],v[1]=Math.max(0,g[1]+m*y),v[2]=g[2],v}e.saturate=c;function d(v,g,y){return c(v,g,-y)}e.desaturate=d;var f=[0,0,0];function p(v,g,y){return u(f,g),gi.toHcl(v,gi.darken(f,f,y))}e.darken=p;function h(v,g,y){return p(v,g,-y)}e.lighten=h;var m=18})(tc||(tc={}));function vt(e){return e}(function(e){function t(E){return"rgb("+(E>>16&255)+", "+(E>>8&255)+", "+(E&255)+")"}e.toStyle=t;function r(E){return"0x"+("000000"+E.toString(16)).slice(-6)}e.toHexString=r;function n(E){return"RGB: "+e.toRgb(E).join(", ")}e.toRgbString=n;function a(E){return[E>>16&255,E>>8&255,E&255]}e.toRgb=a;function i(E){return[(E>>16&255)/255,(E>>8&255)/255,(E&255)/255]}e.toRgbNormalized=i;function o(E,P,D){return E<<16|P<<8|D}e.fromRgb=o;function s(E,P,D){return E*255<<16|P*255<<8|D*255}e.fromNormalizedRgb=s;function u(E,P){return o(E[P],E[P+1],E[P+2])}e.fromArray=u;function l(E,P){return s(E[P],E[P+1],E[P+2])}e.fromNormalizedArray=l;function c(E,P,D){return P[D]=E>>16&255,P[D+1]=E>>8&255,P[D+2]=E&255,P}e.toArray=c;function d(E,P,D){return P[D]=(E>>16&255)/255,P[D+1]=(E>>8&255)/255,P[D+2]=(E&255)/255,P}e.toArrayNormalized=d;function f(E,P){return E[0]=P>>16&255,E[1]=P>>8&255,E[2]=P&255,E}e.toVec3=f;function p(E,P){return E[0]=(P>>16&255)/255,E[1]=(P>>8&255)/255,E[2]=(P&255)/255,E}e.toVec3Normalized=p;function h(E,P,D){var k=E>>16&255,F=E>>8&255,X=E&255,U=P>>16&255,j=P>>8&255,te=P&255,q=k+(U-k)*D,W=F+(j-F)*D,V=X+(te-X)*D;return q<<16|W<<8|V}e.interpolate=h;var m=[0,0,0];function v(E,P){return tc.fromColor(m,E),tc.toColor(tc.saturate(m,m,P))}e.saturate=v;function g(E,P){return v(E,-P)}e.desaturate=g;var y=[0,0,0];function b(E,P){return gi.fromColor(y,E),gi.toColor(gi.darken(y,y,P))}e.darken=b;function S(E,P){return b(E,-P)}e.lighten=S;function x(E){return E<.04045?E*.0773993808:Math.pow(E*.9478672986+.0521327014,2.4)}function C(E){return s(x((E>>16&255)/255),x((E>>8&255)/255),x((E&255)/255))}e.sRGBToLinear=C;function w(E){return E<.0031308?E*12.92:1.055*Math.pow(E,.41666)-.055}function _(E){return s(w((E>>16&255)/255),w((E>>8&255)/255),w((E&255)/255))}e.linearToSRGB=_})(vt||(vt={}));function Ar(e,t,r,n){return{label:e,description:r,list:n,type:t}}function zw(e,t,r){var n={};for(var a in e){var i=e[a];i=vt.saturate(i,t),i=vt.darken(i,-r),n[a]=i}return n}var Vo={"orange-red":Ar("Orange-Red","sequential","Orange-Red, sequential color scheme from ColorBrewer 2.0",[16775148,16705736,16635038,16628612,16551257,15689032,14102559,11730944,8323072]),"purple-blue":Ar("Purple-Blue","sequential","Purple-Blue, sequential color scheme from ColorBrewer 2.0",[16775163,15525874,13685222,10927579,7645647,3576e3,356528,285325,145496]),"blue-purple":Ar("Blue-Purple","sequential","Blue-Purple, sequential color scheme from ColorBrewer 2.0",[16252157,14740724,12571622,10403034,9213638,9202609,8929693,8458108,5046347]),oranges:Ar("Oranges","sequential","",[16774635,16705230,16634018,16625259,16616764,15821075,14239745,10892803,8333060]),"blue-green":Ar("Blue-Green","sequential","",[16252157,15070713,13429990,10082505,6734500,4304502,2329413,27948,17435]),"yellow-orange-brown":Ar("Yellow-Orange-Brown","sequential","",[16777189,16775100,16704401,16696399,16685353,15495188,13388802,10040324,6694150]),"yellow-green":Ar("Yellow-Green","sequential","",[16777189,16252089,14282915,11394446,7915129,4303709,2327619,26679,17705]),reds:Ar("Reds","sequential","",[16774640,16703698,16563105,16552562,16476746,15678252,13309981,10817301,6750221]),"red-purple":Ar("Red-Purple","sequential","",[16775155,16638173,16565696,16424885,16214177,14496919,11403646,7995767,4784234]),greens:Ar("Greens","sequential","",[16252149,15070688,13101504,10607003,7652470,4303709,2329413,27948,17435]),"yellow-green-blue":Ar("Yellow-Green-Blue","sequential","",[16777177,15595697,13101492,8375739,4306628,1937856,2252456,2438292,531800]),purples:Ar("Purples","sequential","",[16579581,15724021,14342891,12369372,10394312,8420794,6967715,5515151,4128893]),"green-blue":Ar("Green-Blue","sequential","",[16252144,14742491,13429701,11066805,8113348,5157843,2854078,551084,540801]),greys:Ar("Greys","sequential","",[16777215,15790320,14277081,12434877,9868950,7566195,5395026,2434341,0]),"yellow-orange-red":Ar("Yellow-Orange-Red","sequential","",[16777164,16772512,16701814,16691788,16616764,16535082,14883356,12386342,8388646]),"purple-red":Ar("Purple-Red","sequential","",[16250105,15196655,13941210,13210823,14640560,15149450,13505110,9961539,6750239]),blues:Ar("Blues","sequential","",[16251903,14609399,13032431,10406625,7057110,4362950,2191797,545180,536683]),"purple-blue-green":Ar("Purple-Blue-Green","sequential","",[16775163,15524592,13685222,10927579,6793679,3576e3,164234,93273,83510]),spectral:Ar("Spectral","diverging","",[10355010,13975119,16018755,16625249,16703627,16777151,15136152,11263396,6734501,3311805,6180770]),"red-yellow-green":Ar("Red-Yellow-Green","diverging","",[10813478,14102567,16018755,16625249,16703627,16777151,14282635,10934634,6733155,1742928,26679]),"red-blue":Ar("Red-Blue","diverging","",[6750239,11671595,14049357,16033154,16636871,16250871,13755888,9618910,4428739,2188972,340065]),"pink-yellow-green":Ar("Pink-Yellow-Green","diverging","",[9306450,12917629,14579630,15840986,16638191,16250871,15136208,12116358,8371265,5083681,2581529]),"purple-green":Ar("Purple-Green","diverging","",[4194379,7744131,10055851,12756431,15193320,16250871,14282963,10935200,5942881,1800247,17435]),"red-yellow-blue":Ar("Red-Yellow-Blue","diverging","Red-Yellow-Blue, diverging color scheme from ColorBrewer 2.0",[10813478,14102567,16018755,16625249,16703632,16777151,14742520,11262441,7646673,4552116,3225237]),"brown-white-green":Ar("Brown-White-Green","diverging","",[5517317,9195786,12550445,14664317,16181443,16119285,13101797,8441281,3512207,91742,15408]),"red-grey":Ar("Red-Grey","diverging","",[6750239,11671595,14049357,16033154,16636871,16777215,14737632,12237498,8882055,5066061,1710618]),"orange-purple":Ar("Orange-Purple","diverging","",[8338184,11753478,14713364,16627811,16703670,16250871,14211819,11709394,8418220,5515144,2949195]),"set-2":Ar("Set-2","qualitative","",[6734501,16551266,9281739,15174339,10934356,16767279,15058068,11776947]),accent:Ar("Accent","qualitative","",[8374655,12496596,16629894,16777113,3697840,15729279,12540695,6710886]),"set-1":Ar("Set-1","qualitative","",[14948892,3636920,5091146,9981603,16744192,16777011,10901032,16220607,10066329]),"set-3":Ar("Set-3","qualitative","",[9294791,16777139,12499674,16482418,8434131,16626786,11787881,16567781,14277081,12353725,13429701,16772463]),"dark-2":Ar("Dark-2","qualitative","",[1810039,14245634,7696563,15149450,6727198,15117058,10909213,6710886]),paired:Ar("Paired","qualitative","",[10931939,2062516,11722634,3383340,16489113,14883356,16629615,16744192,13284054,6962586,16777113,11622696]),"pastel-2":Ar("Pastel-2","qualitative","",[11789005,16633260,13358568,16042724,15136201,16773806,15852236,13421772]),"pastel-1":Ar("Pastel-1","qualitative","",[16495790,11783651,13429701,14601188,16701862,16777164,15063229,16636652,15921906]),"many-distinct":Ar("Many-Distinct","qualitative","",[1810039,14245634,7696563,15149450,6727198,15117058,10909213,6710886,14948892,3636920,5091146,9981603,16744192,16777011,10901032,16220607,10066329,6734501,16551266,9281739,15174339,10934356,16767279,15058068,11776947]),magma:Ar("Magma","sequential","Perceptually uniform shades of black-red-white",[4329332,4853881,5378684,5903742,6363263,6888576,7413633,7938689,8463745,8988801,9513600,10038655,10563454,11088508,11613562,12138360,12728949,13254258,13714030,14239338,14699366,15094114,15489119,15753309,16017499,16216411,16350045,16483424,16551523,16619368,16621934,16689780,16692091,16694402,16696969,16633746,16636058,16638371,16575148,16577461,16514239]),inferno:Ar("Inferno","sequential","Perceptually uniform shades of black-red-yellow",[4721514,5246316,5771373,6296430,6821486,7346542,7871597,8396651,8921450,9446504,9971557,10496610,10956127,11481435,12006486,12466258,12926285,13386056,13780802,14241085,14570295,14965297,15229227,15558693,15757342,15956248,16154897,16288267,16421638,16489734,16492043,16494612,16496926,16368426,16305463,16111429,15982678,15853928,15856253,16119953,16580260]),plasma:Ar("Plasma","sequential","Perceptually uniform shades of blue-red-yellow",[1771148,2426257,3081365,3671193,4195228,4784799,5308834,5833124,6357158,6815911,7340200,7864744,8324007,8783782,9309348,9769377,10164126,10624154,11018902,11413393,11808141,12137352,12466307,12795519,13124730,13453685,13717361,14046573,14309992,14573668,14837344,15035483,15299159,15497299,15695438,15893834,16091974,16224833,16357693,16425017,16557877,16625457,16627245,16629289,16631334,16567845,16438820,16310052,16115494,15921190,15726625]),viridis:Ar("Viridis","sequential","Perceptually uniform shades of blue-green-yellow",[4524123,4656994,4658793,4726127,4727668,4663929,4599933,4535937,4406404,4276870,4081800,3952010,3822475,3627148,3497356,3302029,3172237,3042446,2912654,2782862,2652814,2523022,2393229,2328973,2198924,2069132,2004874,2005897,2007175,2139525,2337154,2666111,3060348,3520376,4045684,4570991,5227369,5883748,6605661,7392854,8180303,8967495,9819967,10672695,11525166,12443174,13295646,14148121,15000344,15852828,16639780]),cividis:Ar("Cividis","sequential","Perceptually uniform shades of blue-green-yellow, should look effectively identical to colorblind and non-colorblind users",[11367,12400,537456,1455727,2046574,2571629,3031404,3425388,3754092,4148075,4476779,4805227,5133932,5396844,5725549,5988462,6317166,6580079,6843249,7171698,7434867,7697781,7960951,8289656,8618104,8881272,9209976,9538679,9867127,10195830,10524533,10853235,11181938,11510640,11839343,12168045,12497002,12891240,13219941,13548642,13943134,14271834,14666326,14995025,15389516,15718470,16112703,16507190,16639799]),twilight:Ar("Twilight","sequential","Perceptually uniform shades of white-blue-black-red-white, cyclic",[14670305,14211037,13554648,12766675,11847630,10993866,10139847,9351365,8628419,8036290,7509952,7048895,6718653,6519739,6386105,6252470,6184114,6181293,6112935,6044831,5976470,5777291,5447293,5052270,4592479,4067665,3674181,3281211,3150646,3543352,4067644,4657728,5379141,6166345,6953549,7741007,8463184,9120336,9777743,10304079,10830671,11291984,11687762,12083541,12348505,12613471,12878439,13077872,13211771,13411209,13545111,13809830,14074293,14338756,14537169,14735067,14801121]),turbo:Ar("Turbo","sequential","Improved (smooth) rainbow colormap for visualization",[4866485,4872413,4354034,3770361,3120629,2667241,2475736,2611140,3073454,3928216,5109892,6487408,8126047,9829201,11531332,13167162,14605618,15780908,16693543,16753699,16748063,16741916,16146200,15026195,13644558,12198408,10818563,9833728]),rainbow:Ar("Rainbow","sequential","",[3367393,3516485,16383744,15501073,12526114]),"red-white-blue":Ar("Red-White-Blue","diverging","",[12526114,16777215,3367393])},Age=Object.keys(Vo),ND=Age.map(function(e){return[e,Vo[e].label,k0(Vo[e].type)]}),Tge=ND.filter(function(e){return Vo[e[0]].type==="diverging"||Vo[e[0]].type==="sequential"}),Ege=ND.filter(function(e){return Vo[e[0]].type==="qualitative"});function fu(e){return e in Vo?Vo[e]:(console.warn("unknown color list named '"+e+"'"),Vo["red-yellow-blue"])}var Ke;(function(e){function t(f){return f.creator&&f.chunkSize}e.is=t;function r(f){var p=f.growBy*f.elementSize;f.currentSize=p,f.currentIndex=0,f.currentChunk=new f.ctor(p),f.allocatedSize+=p,f.chunks[f.chunks.length]=f.currentChunk}function n(f,p,h,m,v){f.currentIndex>=f.currentSize&&r(f);var g=f.currentChunk,y=f.currentIndex;return g[y]=p,g[y+1]=h,g[y+2]=m,g[y+3]=v,f.currentIndex+=4,f.elementCount++}e.add4=n;function a(f,p,h,m){f.currentIndex>=f.currentSize&&r(f);var v=f.currentChunk,g=f.currentIndex;return v[g]=p,v[g+1]=h,v[g+2]=m,f.currentIndex+=3,f.elementCount++}e.add3=a;function i(f,p,h){f.currentIndex>=f.currentSize&&r(f);var m=f.currentChunk,v=f.currentIndex;return m[v]=p,m[v+1]=h,f.currentIndex+=2,f.elementCount++}e.add2=i;function o(f,p){return f.currentIndex>=f.currentSize&&r(f),f.currentChunk[f.currentIndex]=p,f.currentIndex+=1,f.elementCount++}e.add=o;function s(f,p,h){for(var m=0;m<p;m++)f.currentIndex>=f.currentSize&&r(f),f.currentChunk[f.currentIndex++]=h,f.elementCount++;return f.elementCount}e.addRepeat=s;function u(f,p){for(var h=f.elementSize,m=0,v=p.length;m<v;m+=h){f.currentIndex>=f.currentSize&&r(f);for(var g=f.currentChunk,y=0;y<h;y++)g[f.currentIndex++]=p[m+y];f.elementCount++}return f.elementCount}e.addMany=u;function l(f,p){return p===void 0&&(p=!1),c(f,p)}e.compact=l;function c(f,p){var h=f.ctor,m=f.chunks,v=f.currentIndex;if(!m.length)return new h(0);if(m.length===1&&(p||v===f.allocatedSize))return m[0];for(var g=0,y=0,b=m.length-1;y<b;y++)g+=m[y].length;g+=f.currentIndex;var S=new h(g),x=0;if(S.buffer)for(var y=0,b=m.length-1;y<b;y++)S.set(m[y],x),x+=m[y].length;else for(var y=0,b=m.length-1;y<b;y++){for(var C=m[y],w=0,_=C.length;w<_;w++)S[x+w]=C[w];x+=C.length}var E=m[m.length-1];if(S.buffer&&v>=f.currentSize)S.set(E,x);else for(var w=0,_=E.length;w<_;w++)S[x+w]=E[w];return S}e._compact=c;function d(f,p,h,m){var v={ctor:f,elementSize:p,growBy:Math.max(1,Math.ceil(h)),allocatedSize:0,elementCount:0,currentSize:0,currentChunk:void 0,currentIndex:0,chunks:[]};if(typeof m>"u")return v;if(typeof m=="number")return v.currentChunk=new f(m*p),v.allocatedSize=m*p,v.currentSize=v.currentChunk.length,v.chunks[0]=v.currentChunk,v;var g=m;if(g.length%p!==0)throw new Error("initialChunk length must be a multiple of the element size.");return v.currentChunk=g,v.allocatedSize=g.length,v.currentSize=g.length,v.chunks[0]=g,v}e.create=d})(Ke||(Ke={}));function vC(e,t,r){return e[t]-e[r]}function Ih(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function mq(e,t,r,n){var a=r+n>>1;return t(e,r,n)>0?t(e,r,a)>0?t(e,a,n)>0?a:n:r:t(e,n,a)>0?t(e,a,r)>0?a:r:n}function Pge(e,t,r){var n=e.cmp,a=e.swap,i=e.data,o=e.parts,s=t+1,u=r;for(a(i,t,mq(i,n,t,r));n(i,u,t)>0;)--u;for(var l=t+1;l<=u;l++){var c=n(i,l,t);if(c>0){for(a(i,l,u),--u;n(i,u,t)>0;)--u;l--}else c===0&&(a(i,l,s),s++)}for(var l=t;l<s;l++)a(i,l,t+u-l);o[0]=u-s+t+1,o[1]=u}function Ige(e,t,r){for(var n=e.data,a=e.cmp,i=e.swap,o=t+1;o<=r;o++)for(var s=o-1;s>=t&&a(n,s,s+1)>0;)i(n,s,s+1),s=s-1}function gC(e,t,r){for(var n=e.parts;t<r;){if(r-t<16){Ige(e,t,r);return}Pge(e,t,r);var a=n[0],i=n[1];a-t<r-i?(gC(e,t,a-1),t=i+1):(gC(e,i+1,r),r=a-1)}}function Mge(e,t,r,n){var a=r+1,i=n;Ih(e,r,mq(e,vC,r,n));for(var o=e[r];e[i]>o;)--i;for(var s=r+1;s<=i;s++){var u=e[s];if(u>o){for(Ih(e,s,i),--i;e[i]>o;)--i;s--}else u===o&&(Ih(e,s,a),++a)}for(var s=r;s<a;s++)Ih(e,s,r+i-s);t[0]=i-a+r+1,t[1]=i}function Dge(e,t,r){for(var n=t+1;n<=r;n++){for(var a=e[n],i=n-1;i>=t&&e[i]>a;)e[i+1]=e[i],i=i-1;e[i+1]=a}}function BP(e,t,r,n){for(;r<n;){if(n-r<16){Dge(e,r,n);return}Mge(e,t,r,n);var a=t[0],i=t[1];a-r<n-i?(BP(e,t,r,a-1),r=i+1):(BP(e,t,i+1,n),n=a-1)}}function Wu(e,t){return t===void 0&&(t=vC),kge(e,0,e.length,t)}function kge(e,t,r,n){return n===void 0&&(n=vC),n===vC?BP(e,[0,0],t,r-1):gC({data:e,cmp:n,swap:Ih,parts:[0,0]},t,r-1),e}function vq(e,t,r,n,a){var i={data:e,cmp:n,swap:a,parts:[0,0]};return gC(i,t,r-1),e}function Rge(e,t,r){return e[t].key<e[r].key?-1:1}function Oge(e,t,r,n,a){for(var i=new Map,o=[],s=t(e[0]),u=!0,l=n;l<a;l++){var c=t(e[l]);if(i.has(c))i.get(c).count++,s!==c&&(u=!1);else{var d={key:c,count:1,offset:l};i.set(c,d),o[o.length]=d}s=c}var f=new Int32Array(o.length+1);f[o.length]=a;var p=!0;if(r){for(var l=1,h=o.length;l<h;l++)if(o[l-1].key>o[l].key){p=!1;break}}if(u&&p){for(var l=0;l<o.length;l++)f[l]=o[l].offset;return f}r&&!p&&vq(o,0,o.length,Rge,Ih);for(var m=0,l=0;l<o.length;l++){var v=o[l];v.offset=m,m+=v.count}for(var g=new Int32Array(a-n),l=n;l<a;l++){var c=t(e[l]),d=i.get(c);g[d.offset++]=e[l]}for(var l=0,h=g.length;l<h;l++)e[l+n]=g[l];f[0]=n;for(var l=1;l<o.length;l++)f[l]=o[l-1].offset+n;return f}function J4(e,t,r){var n=r&&r.start||0,a=r&&r.end||e.length;if(a-n<=0)throw new Error("Can only bucket non-empty collections.");return Oge(e,t,!!(r&&r.sort),n,a)}var Bge=function(){function e(t,r){this.getHash=t,this.areEqual=r,this.id=0,this.byHash=new Map,this.groups=[]}return e.prototype.createGroup=function(t,r){var n=this.id++,a=[t];return this.groups[n]=a,{id:n,keys:a,value:r}},e.prototype.add=function(t,r){var n=this.getHash(r);if(this.byHash.has(n)){for(var a=this.byHash.get(n),i=0,o=a.length;i<o;i++){var s=a[i];if(this.areEqual(r,s.value))return s.keys[s.keys.length]=t,s.value}var u=this.createGroup(t,r);return a[a.length]=u,u.value}else{var u=this.createGroup(t,r);return this.byHash.set(n,[u]),u.value}},e}();function Fge(e,t){return new Bge(e,t)}function gq(e){var t=e^e>>4;return t=(t^3735928559)+(t<<5),t=t^t>>11,t}function wm(e,t){var r=23;return r=31*r+e|0,r=31*r+t|0,r=r^r>>4,r=(r^3735928559)+(r<<5),r=r^r>>11,r}function Lge(e,t,r){var n=23;return n=31*n+e|0,n=31*n+t|0,n=31*n+r|0,n=n^n>>4,n=(n^3735928559)+(n<<5),n=n^n>>11,n}function Nge(e,t,r,n){var a=23;return a=31*a+e|0,a=31*a+t|0,a=31*a+r|0,a=31*a+n|0,a=a^a>>4,a=(a^3735928559)+(a<<5),a=a^a>>11,a}function zD(e){for(var t=0,r=0,n=e.length;r<n;r++)t=(t<<5)-t+e.charCodeAt(r++)|0;return t}function op(e,t){return(e+t)*(e+t+1)/2+t}function eo(e){for(var t=2166136261,r=0,n=e.length;r<n;++r)t^=e[r],t+=(t<<1)+(t<<4)+(t<<7)+(t<<8)+(t<<24);return t>>>0}function yC(e,t){var r=t&&typeof t.start<"u"?Math.max(Math.min(t.start,e-1),0):0,n=t&&typeof t.end<"u"?Math.min(t.end,e):e;return{start:r,end:n}}function db(e,t){var r=t&&typeof t.array<"u"?t.array:Array,n=yC(e,t),a=n.start,i=n.end;return{array:new r(i-a),start:a,end:i}}function zge(e,t,r){for(var n=0,a=t.length;n<a;n++)t[n]=e(r+n);return t}function hi(e,t,r){var n=db(e,r),a=n.array,i=n.start;return zge(t,a,i)}function UD(e){return!!e.buffer&&typeof e.byteLength=="number"&&typeof e.BYTES_PER_ELEMENT=="number"}function bC(e,t){var r=e.constructor,n=e.buffer,a=e.length,i=e.byteOffset,o=e.BYTES_PER_ELEMENT,s=yC(a,t),u=s.start,l=s.end;return u===0&&l===a?e:new r(n,i+o*u,Math.min(a,l-u))}function hh(e,t,r){for(;t<r&&e.charCodeAt(t)===32;)t++;return sp(e,t,r)}function sp(e,t,r){var n=t,a=0,i=1;for(e.charCodeAt(n)===45?(i=-1,++n):e.charCodeAt(n)===43&&++n;n<r;n++){var o=e.charCodeAt(n)-48;if(o>9||o<0)return i*a|0;a=10*a+o|0}return i*a}function qB(e,t,r,n){return t.charCodeAt(r)===43&&r++,e*Math.pow(10,sp(t,r,n))}function Uge(e,t,r){for(;t<r&&e.charCodeAt(t)===32;)t++;return td(e,t,r)}function td(e,t,r){var n=t,a=1,i=0,o=0,s=1;for(e.charCodeAt(n)===45?(a=-1,++n):e.charCodeAt(n)===43&&++n;n<r;){var u=e.charCodeAt(n)-48;if(u>=0&&u<10)i=i*10+u,++n;else if(u===-2){for(++n;n<r;)if(u=e.charCodeAt(n)-48,u>=0&&u<10)o=10*o+u,s=10*s,++n;else return u===53||u===21?qB(a*(i+o/s),e,n+1,r):a*(i+o/s);return a*(i+o/s)}else{if(u===53||u===21)return qB(a*i,e,n+1,r);break}}return a*i}var ye;(function(e){var t;(function(P){P.str={"@type":"str",T:"",valueType:"str"},P.int={"@type":"int",T:0,valueType:"int"},P.coord={"@type":"coord",T:0,valueType:"float"},P.float={"@type":"float",T:0,valueType:"float"};function D(W){return W===void 0&&(W=""),{"@type":"str",T:W,valueType:"str"}}P.Str=D;function k(W){return W===void 0&&(W=0),{"@type":"int",T:W,valueType:"int"}}P.Int=k;function F(W){return W===void 0&&(W=0),{"@type":"float",T:W,valueType:"float"}}P.Float=F;function X(W,V){return V===void 0&&(V=P.float),{"@type":"tensor",T:W.create(),space:W,valueType:"tensor",baseType:V}}P.Tensor=X;function U(W,V){return V===void 0&&(V=P.float),X(Rr.Vector(W,V["@type"]==="int"?Int32Array:Float64Array),V)}P.Vector=U;function j(W,V,ee){return ee===void 0&&(ee=P.float),X(Rr.ColumnMajorMatrix(W,V,ee["@type"]==="int"?Int32Array:Float64Array),ee)}P.Matrix=j;function te(W,V){return typeof V<"u"?T(T({},W),{T:V}):W}P.Aliased=te;function q(W,V,ee){return ee===void 0&&(ee=[]),{"@type":"list",T:ee,separator:W,itemParse:V,valueType:"list"}}P.List=q})(t=e.Schema||(e.Schema={}));function r(P){return!!P&&!!P.schema&&!!P.value}e.is=r;function n(P,D){return WB(D.T,P,D,1)}e.Undefined=n;function a(P,D,k){return WB(P,D,k,0)}e.ofConst=a;function i(P){return k2(P)}e.ofLambda=i;function o(P,D){return i({value:function(k){return k+P},rowCount:Math.max(D-P+1,0),schema:t.int})}e.range=o;function s(P){return Fc(P)}e.ofArray=s;function u(P){return Fc({array:P,schema:t.int})}e.ofIntArray=u;function l(P){return Fc({array:P,schema:t.float})}e.ofFloatArray=l;function c(P){return Fc({array:P,schema:t.str})}e.ofStringArray=c;function d(P){return Fc({array:P,schema:t.Aliased(t.str)})}e.ofStringAliasArray=d;function f(P,D){return D===void 0&&(D=","),Fc({array:P,schema:t.List(D,function(k){return k})})}e.ofStringListArray=f;function p(P){var D=P.count,k=P.data,F=P.indices;return k2({value:function(X){return sp(k,F[2*X],F[2*X+1])||0},rowCount:D,schema:t.int})}e.ofIntTokens=p;function h(P){var D=P.count,k=P.data,F=P.indices;return k2({value:function(X){return td(k,F[2*X],F[2*X+1])||0},rowCount:D,schema:t.float})}e.ofFloatTokens=h;function m(P){var D=P.count,k=P.data,F=P.indices;return k2({value:function(X){var U=k.substring(F[2*X],F[2*X+1]);return U==="."||U==="?"?"":U},rowCount:D,schema:t.str})}e.ofStringTokens=m;function v(P,D,k){return jge(P,D,k)}e.window=v;function g(P,D,k){return k===void 0&&(k=!0),Xge(P,D,k)}e.view=g;function y(P){return Vge(P)}e.createFirstIndexMap=y;function b(P){return Hge(P)}e.createIndexer=b;function S(P,D,k){return $ge(P,D,k||Array)}e.mapToArray=S;function x(P,D){return Qge(P,D)}e.areEqual=x;function C(P,D){return eye(P,D)}e.indicesOf=C;function w(P,D){return P.__array?P:P.isDefined?Fc({array:P.toArray({array:D}),schema:P.schema,valueKind:P.valueKind}):n(P.rowCount,P.schema)}e.asArrayColumn=w;function _(P,D,k){if(k===void 0&&(k=0),!!P.isDefined){var F=P.__array;if(F)for(var X=0,U=F.length;X<U;X++)D[k+X]=F[X];else for(var X=0,U=P.rowCount;X<U;X++)D[k+X]=P.value(X)}}e.copyToArray=_;function E(P){for(var D=0,k=P.rowCount;D<k;D++)if(D!==P.value(D))return!1;return!0}e.isIdentity=E})(ye||(ye={}));function Vge(e){for(var t=new Map,r=0,n=e.rowCount;r<n;r++){var a=e.value(r);t.has(a)||t.set(e.value(r),r)}return t}function Hge(e){for(var t=new Map,r=0,n=e.rowCount;r<n;r++){var a=e.value(r);t.has(a)||t.set(e.value(r),r)}return function(i){return t.has(i)?t.get(i):-1}}function WB(e,t,r,n){var a=function(i){return e};return{schema:r,__array:void 0,isDefined:n===0,rowCount:t,value:a,valueKind:function(i){return n},toArray:function(i){for(var o=db(t,i).array,s=0,u=o.length;s<u;s++)o[s]=e;return o},areValuesEqual:function(i,o){return!0}}}function k2(e){var t=e.value,r=e.valueKind,n=e.areValuesEqual,a=e.rowCount,i=e.schema;return{schema:i,__array:void 0,isDefined:!0,rowCount:a,value:t,valueKind:r||function(o){return 0},toArray:function(o){for(var s=db(a,o),u=s.array,l=s.start,c=0,d=u.length;c<d;c++)u[c]=t(c+l);return u},areValuesEqual:n||function(o,s){return t(o)===t(s)}}}function Fc(e){var t=e.array,r=e.schema,n=e.valueKind,a=t.length,i=r.valueType==="str"?function(s){var u=t[s];return typeof u=="string"?u:""+u}:function(s){return t[s]},o=UD(t);return{schema:r,__array:t,isDefined:!0,rowCount:a,value:i,valueKind:n||function(s){return 0},toArray:r.valueType==="str"?function(s){for(var u=yC(a,s),l=u.start,c=u.end,d=new(s&&typeof s.array<"u"?s.array:t.constructor)(c-l),f=0,p=c-l;f<p;f++){var h=t[l+f];d[f]=typeof h=="string"?h:""+h}return d}:o?function(s){return bC(t,s)}:function(s){var u=yC(a,s),l=u.start,c=u.end;if(l===0&&c===t.length)return t;for(var d=new(s&&typeof s.array<"u"?s.array:t.constructor)(c-l),f=0,p=c-l;f<p;f++)d[f]=t[l+f];return d},areValuesEqual:function(s,u){return t[s]===t[u]}}}function jge(e,t,r){return e.isDefined?t===0&&r===e.rowCount?e:!!e.__array&&UD(e.__array)?Gge(e,t,r):qge(e,t,r):ye.Undefined(r-t,e.schema)}function Gge(e,t,r){var n=bC(e.__array,{start:t,end:r}),a=e.valueKind;return Fc({array:n,schema:e.schema,valueKind:function(i){return a(t+i)}})}function qge(e,t,r){var n=e.value,a=e.valueKind,i=e.areValuesEqual,o=t===0?n:function(u){return n(u+t)},s=r-t;return{schema:e.schema,__array:void 0,isDefined:e.isDefined,rowCount:s,value:o,valueKind:t===0?a:function(u){return a(u+t)},toArray:function(u){for(var l=db(s,u).array,c=0,d=l.length;c<d;c++)l[c]=n(c+t);return l},areValuesEqual:t===0?i:function(u,l){return i(u+t,l+t)}}}function Wge(e,t){if(e.length!==t)return!1;for(var r=0,n=e.length;r<n;r++)if(e[r]!==r)return!1;return!0}function Xge(e,t,r){return e.rowCount===0||r&&Wge(t,e.rowCount)?e:!!e.__array&&typeof e.value(0)==typeof e.__array[0]?Yge(e,t):Kge(e,t)}function Yge(e,t){for(var r=e.__array,n=new r.constructor(t.length),a=0,i=t.length;a<i;a++)n[a]=r[t[a]];var o=e.valueKind;return Fc({array:n,schema:e.schema,valueKind:function(s){return o(t[s])}})}function Kge(e,t){var r=e.value,n=e.valueKind,a=e.areValuesEqual,i=function(s){return r(t[s])},o=t.length;return{schema:e.schema,__array:void 0,isDefined:e.isDefined,rowCount:o,value:i,valueKind:function(s){return n(t[s])},toArray:function(s){for(var u=db(o,s).array,l=0,c=u.length;l<c;l++)u[l]=r(t[l]);return u},areValuesEqual:function(s,u){return a(t[s],t[u])}}}function $ge(e,t,r){for(var n=new r(e.rowCount),a=0,i=e.rowCount;a<i;a++)n[a]=t(e.value(a));return n}function Qge(e,t){return e===t?!0:e.rowCount!==t.rowCount||e.isDefined!==t.isDefined||e.schema.valueType!==t.schema.valueType?!1:!!e.__array&&!!t.__array?Zge(e,t):Jge(e,t)}function Zge(e,t){for(var r=e.__array,n=t.__array,a=0,i=e.rowCount;a<i;a++)if(r[a]!==n[a])return!1;return!0}function Jge(e,t){for(var r=e.value,n=t.value,a=0,i=e.rowCount;a<i;a++)if(r(a)!==n(a))return!1;return!0}function eye(e,t){for(var r=[],n=e.value,a=0,i=e.rowCount;a<i;a++)t(n(a))&&(r[r.length]=a);return r}var nn;(function(e){function t(S){return S&&typeof S._rowCount=="number"&&!!S._columns&&!!S._schema}e.is=t;function r(S,x,C){C===void 0&&(C={});var w=Object.create(null),_=Object.keys(S);w._rowCount=x._rowCount,w._columns=_,w._schema=S;for(var E=0,P=_;E<P.length;E++){var D=P[E];if(x[D])w[D]=x[D];else if(C[D])w[D]=C[D];else throw Error("Cannot find column '"+D+"'.")}return w}e.pickColumns=r;function n(S,x){var C=Object.keys(x),w=x[C[0]].rowCount;return T({_rowCount:w,_columns:C,_schema:S},x)}e.ofColumns=n;function a(S,x,C){var w=Object.create(null),_=Object.keys(S);w._rowCount=C,w._columns=_,w._schema=S;for(var E=0,P=_;E<P.length;E++){var D=P[E];D in x?w[D]=x[D]:w[D]=ye.Undefined(C,S[D])}return w}e.ofPartialColumns=a;function i(S,x){var C=Object.create(null),w=Object.keys(S);C._rowCount=x,C._columns=w,C._schema=S;for(var _=0,E=w;_<E.length;_++){var P=E[_];C[P]=ye.Undefined(x,S[P])}return C}e.ofUndefinedColumns=i;function o(S,x){var C=Object.create(null),w=x.length,_=Object.keys(S);C._rowCount=w,C._columns=_,C._schema=S;for(var E=function(F){C[F]=ye.ofLambda({rowCount:w,schema:S[F],value:function(X){return x[X][F]},valueKind:function(X){return typeof x[X][F]>"u"?1:0}})},P=0,D=_;P<D.length;P++){var k=D[P];E(k)}return C}e.ofRows=o;function s(S,x){var C,w=Object.create(null),_=Object.keys(S);w._rowCount=0,w._columns=_,w._schema=S;for(var E=0,P=_;E<P.length;E++){var D=P[E];typeof x[D]<"u"?(w[D]=ye.ofArray({array:x[D],schema:S[D]}),w._rowCount=(C=x[D])===null||C===void 0?void 0:C.length):w[D]=ye.Undefined(w._rowCount,S[D])}return w}e.ofArrays=s;function u(S,x,C){var w=Object.create(null),_=Object.keys(x);w._rowCount=C.length,w._columns=_,w._schema=x;for(var E=0,P=_;E<P.length;E++){var D=P[E];w[D]=ye.view(S[D],C)}return w}e.view=u;function l(S,x,C){for(var w=[],_=0,E=S._rowCount;_<E;++_)C(_)&&w.push(_);return u(S,x,w)}e.pick=l;function c(S,x,C,w){if(C===0&&w===S._rowCount)return S;var _=Object.create(null),E=Object.keys(x);_._rowCount=w-C,_._columns=E,_._schema=x;for(var P=0,D=E;P<D.length;P++){var k=D[P];_[k]=ye.window(S[k],C,w)}return _}e.window=c;function d(S,x){var C=Object.create(null),w=Object.keys(x);C._rowCount=0;for(var _=0,E=S;_<E.length;_++){var P=E[_];C._rowCount+=P._rowCount}for(var D={},k=0,F=w;k<F.length;k++){var X=F[k];D[X]=new Array(C._rowCount)}C._columns=w,C._schema=x;for(var U=0,j=0,te=S;j<te.length;j++){for(var P=te[j],q=0,W=w;q<W.length;q++){var V=W[q];ye.copyToArray(P[V],D[V],U)}U+=P._rowCount}for(var ee=0,ue=w;ee<ue.length;ee++){var V=ue[ee];C[V]=ye.ofArray({array:D[V],schema:x[V]})}return C}e.concat=d;function f(S,x,C){S[x]=ye.asArrayColumn(S[x],C)}e.columnToArray=f;function p(S,x){for(var C=new Int32Array(S._rowCount),w=0,_=C.length;w<_;w++)C[w]=w;Wu(C,function(X,U,j){return x(U,j)});for(var E=!0,w=0,_=C.length;w<_;w++)if(C[w]!==w){E=!1;break}if(E)return S;var P=Object.create(null);P._rowCount=S._rowCount,P._columns=S._columns,P._schema=S._schema;for(var D=0,k=S._columns;D<k.length;D++){var F=k[D];P[F]=ye.view(S[F],C,!1)}return P}e.sort=p;function h(S,x){if(S._rowCount!==x._rowCount||S._columns.length!==x._columns.length)return!1;for(var C=0,w=S._columns;C<w.length;C++){var _=w[C];if(!x[_])return!1}for(var E=0,P=S._columns;E<P.length;E++){var _=P[E];if(!ye.areEqual(S[_],x[_]))return!1}return!0}e.areEqual=h;function m(S,x){for(var C=Object.create(null),w=S._columns,_=0;_<w.length;_++){var E=w[_];C[E]=S[E].value(x)}return C}e.getRow=m;function v(S,x){for(var C=0,w=S._rowCount;C<w;++C)if(x(C))return m(S,C)}e.pickRow=v;function g(S){for(var x=[],C=S._rowCount,w=0;w<C;w++)x[w]=m(S,w);return x}e.getRows=g;function y(S){for(var x={},C=S._columns,w=0;w<C.length;w++){var _=C[w];x[_]=S[_].toArray()}return x}e.toArrays=y;function b(S){var x=Lr.create(),C=S._columns,w=S._rowCount,_=1;Lr.write(x,"|");for(var E=0;E<C.length;E++)Lr.write(x,C[E]),Lr.write(x,"|"),_+=C[E].length+1;Lr.newline(x),Lr.write(x,new Array(_+1).join("-")),Lr.newline(x);for(var P=0;P<w;P++){Lr.write(x,"|");for(var E=0;E<C.length;E++){var D=S[C[E]];D.valueKind(P)===0?(Lr.write(x,D.value(P)),Lr.write(x,"|")):Lr.write(x,".|")}Lr.newline(x)}return Lr.getString(x)}e.formatToString=b})(nn||(nn={}));var FP;(function(e){function t(n,a,i){var o=Object.keys(i),s=Object.create(null),u=[];s._name=n,s._tableNames=u,s._schema=a;for(var l=0,c=o;l<c.length;l++){var d=c[l];!nn.is(i[d])||(s[d]=i[d],u[u.length]=d)}return s}e.ofTables=t;function r(n){for(var a={},i=0,o=n._tableNames;i<o.length;i++){var s=o[i];a[s]=nn.getRows(n[s])}return a}e.getTablesAsRows=r})(FP||(FP={}));function VD(e,t){for(var r=0,n=e.length;r<n;r++)if(t(e[r]))return e[r]}function HD(e){if(Array.from)return Array.from(e);for(var t=[];;){var r=e.next(),n=r.done,a=r.value;if(n)break;t[t.length]=a}return t}function LP(e,t,r){for(var n=t-e+1,a=r?new r(n):new Int32Array(n),i=0;i<n;i++)a[i]=i+e;return a}function tye(e,t){for(var r=new(rye(e))(t.length),n=0,a=t.length;n<a;n++)r[n]=e[t[n]];return r}function rye(e){var t=e.constructor;if(!t)throw new Error("data does not define a constructor and it should");return t}function nye(){var e=function(){var m=typeof window<"u"&&window,v=typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&self,g=typeof e<"u"&&e;return m||g||v}(),t={},r=typeof document<"u"?document:void 0,n=1,a;function i(m){for(var v=[],g=1;g<arguments.length;g++)v[g-1]=arguments[g];typeof m!="function"&&(m=new Function(""+m));var y={callback:m,args:v};return t[n]=y,a(n),n++}function o(m){delete t[m]}function s(m){var v=m.callback,g=m.args;switch(g.length){case 0:v();break;case 1:v(g[0]);break;case 2:v(g[0],g[1]);break;case 3:v(g[0],g[1],g[2]);break;default:v.apply(void 0,g);break}}function u(m){var v=t[m];o(m),s(v)}function l(){a=function(m){process.nextTick(function(){u(m)})}}function c(){if(e&&e.postMessage&&!e.importScripts){var m=!0,v=e.onmessage;return e.onmessage=function(){m=!1},e.postMessage("","*"),e.onmessage=v,m}}function d(){var m="setImmediate$"+Math.random()+"$",v=function(g){g.source===e&&typeof g.data=="string"&&g.data.indexOf(m)===0&&u(+g.data.slice(m.length))};window.addEventListener?window.addEventListener("message",v,!1):window.attachEvent("onmessage",v),a=function(g){window.postMessage(m+g,"*")}}function f(){var m=new MessageChannel;m.port1.onmessage=function(v){var g=v.data;u(g)},a=function(v){m.port2.postMessage(v)}}function p(){var m=r.documentElement;a=function(v){var g=r.createElement("script");g.onreadystatechange=function(){u(v),g.onreadystatechange=null,m.removeChild(g),g=null},m.appendChild(g)}}function h(){a=function(m){setTimeout(u,0,m)}}return typeof process<"u"&&{}.toString.call(process)==="[object process]"?l():c()?d():typeof MessageChannel<"u"?f():r&&"onreadystatechange"in r.createElement("script")?p():h(),{setImmediate:i,clearImmediate:o}}var NP=function(){return typeof setImmediate<"u"?typeof window<"u"?{setImmediate:function(e){for(var t,r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];return(t=window).setImmediate.apply(t,Gt([e],r))},clearImmediate:function(e){return window.clearImmediate(e)}}:{setImmediate,clearImmediate}:nye()}();function aye(e){NP.setImmediate(e)}var jD={setImmediate:NP.setImmediate,clearImmediate:NP.clearImmediate,immediatePromise:function(){return new Promise(aye)},delay:function(e,t){return t===void 0&&(t=void 0),new Promise(function(r){return setTimeout(r,e,t)})}},R0=function(){try{return!0}catch{return!1}}(),Fr=function(){try{var t=process.env.DEBUG;return t==="*"||t==="molstar"}catch{return!1}}(),iye=typeof performance<"u"&&performance.mark&&performance.measure,eA=iye&&!R0,Oy;(function(e){function t(o){return"startTask"+o.id}function r(o){return"endTask"+o.id}function n(o){eA&&performance.mark(t(o))}e.markStart=n;function a(o){eA&&performance.mark(r(o))}e.markEnd=a;function i(o){eA&&performance.measure("\u2733\uFE0F "+o.name,t(o),r(o))}e.measure=i})(Oy||(Oy={}));function oye(e,t,r){r===void 0&&(r=250);var n=xq(e,t,r),a=new Tq(n,n.root);return GD(e,a)}function sye(e,t,r){r===void 0&&(r=250);var n=xq(e,t,r);return new Tq(n,n.root)}function yq(e,t){return GD(t,e)}function uye(e,t,r){return e.runChild(t,r)}function bq(e){return{taskId:e.id,taskName:e.name,message:"",startedTime:0,canAbort:!0,isIndeterminate:!0,current:0,max:0}}function xq(e,t,r){var n={abortRequested:!1,treeAborted:!1,reason:""};return{updateRateMs:r,lastNotified:Gn(),observer:t,abortToken:n,taskId:e.id,root:{progress:bq(e),children:[]},tryAbort:lye(n)}}function lye(e){return function(t){e.abortRequested=!0,e.reason=t||e.reason}}function Sq(e){return{progress:T({},e.progress),children:e.children.map(Sq)}}function Cq(e){return e.progress.canAbort&&e.children.every(Cq)}function cye(e){return{root:Sq(e.root),canAbort:Cq(e.root),requestAbort:e.tryAbort}}function GD(e,t){return pe(this,void 0,void 0,function(){var r,n;return he(this,function(a){switch(a.label){case 0:Oy.markStart(e),t.node.progress.startedTime=Gn(),a.label=1;case 1:return a.trys.push([1,3,,7]),[4,e.f(t)];case 2:return r=a.sent(),Oy.markEnd(e),Oy.measure(e),t.info.abortToken.abortRequested&&wq(t.info),[2,r];case 3:return n=a.sent(),Qe.isAbort(n)?(t.isAborted=!0,t.node.children.length>0?[4,new Promise(function(i){t.onChildrenFinished=i})]:[3,5]):[3,6];case 4:a.sent(),a.label=5;case 5:e.onAbort&&e.onAbort(),a.label=6;case 6:throw Fr&&console.error(n),n;case 7:return[2]}})})}function wq(e){throw e.abortToken.treeAborted||(e.abortToken.treeAborted=!0,_q(e.root),Aq(e,Gn())),Qe.Aborted(e.abortToken.reason)}function _q(e){var t=e.progress;t.isIndeterminate=!0,t.canAbort=!1,t.message="Aborting...";for(var r=0,n=e.children;r<n.length;r++){var a=n[r];_q(a)}}function Aq(e,t){e.lastNotified=t;var r=cye(e);e.observer(r)}var Tq=function(){function e(t,r){this.isSynchronous=!1,this.isExecuting=!0,this.lastUpdatedTime=0,this.onChildrenFinished=void 0,this.node=r,this.info=t}return e.prototype.checkAborted=function(){this.info.abortToken.abortRequested&&(this.isAborted=!0,wq(this.info))},Object.defineProperty(e.prototype,"shouldUpdate",{get:function(){return this.checkAborted(),Gn()-this.lastUpdatedTime>this.info.updateRateMs},enumerable:!1,configurable:!0}),e.prototype.updateProgress=function(t){if(this.checkAborted(),!!t){var r=this.node.progress;typeof t=="string"?(r.message=t,r.isIndeterminate=!0):(typeof t.canAbort<"u"&&(r.canAbort=t.canAbort),typeof t.message<"u"&&(r.message=t.message),typeof t.current<"u"&&(r.current=t.current),typeof t.max<"u"&&(r.max=t.max),r.isIndeterminate=typeof r.current>"u"||typeof r.max>"u",typeof t.isIndeterminate<"u"&&(r.isIndeterminate=t.isIndeterminate))}},e.prototype.update=function(t,r){if(this.lastUpdatedTime=Gn(),this.updateProgress(t),!r)return Aq(this.info,this.lastUpdatedTime),this.checkAborted(),jD.immediatePromise()},e.prototype.runChild=function(t,r){return pe(this,void 0,void 0,function(){var n,a,i,o,s,u,l;return he(this,function(c){switch(c.label){case 0:this.updateProgress(r),n={progress:bq(t),children:[]},a=this.node.children,a.push(n),i=new e(this.info,n),c.label=1;case 1:return c.trys.push([1,3,4,5]),[4,GD(t,i)];case 2:return[2,c.sent()];case 3:if(o=c.sent(),Qe.isAbort(o)&&this.isAborted)return[2,void 0];throw o;case 4:if(s=a.indexOf(n),s>=0){for(u=s,l=a.length-1;u<l;u++)a[u]=a[u+1];a.pop()}return a.length===0&&this.onChildrenFinished&&this.onChildrenFinished(),[7];case 5:return[2]}})})},e}(),dye=function(){function e(){this.shouldUpdate=!1,this.isSynchronous=!0}return e.prototype.update=function(t,r){},e}(),sS=new dye,Qe;(function(e){var t=function(){function d(f,p,h){this.name=f,this.f=p,this.onAbort=h,this.id=c()}return d.prototype.run=function(f,p){return p===void 0&&(p=250),f?oye(this,f,p):this.f(sS)},d.prototype.runAsChild=function(f,p){return f.isSynchronous?this.f(sS):uye(f,this,p)},d.prototype.runInContext=function(f){return f.isSynchronous?this.f(sS):yq(f,this)},d}();function r(d){var f=d;return!!d&&typeof f.id=="number"&&typeof f.name=="string"&&!!f.run}e.is=r;function n(d){return!!d&&!!d.isAborted}e.isAbort=n;function a(d){return{isAborted:!0,reason:d,toString:function(){return"Aborted"+(d?": "+d:"")}}}e.Aborted=a;function i(d,f,p){return new t(d,f,p)}e.create=i;function o(d,f){var p=this;return i(d,function(h){return pe(p,void 0,void 0,function(){return he(this,function(m){return[2,f]})})})}e.constant=o;function s(){var d=this;return i("",function(f){return pe(d,void 0,void 0,function(){return he(this,function(p){return[2]})})})}e.empty=s;function u(d,f){var p=this;return i(d,function(h){return pe(p,void 0,void 0,function(){return he(this,function(m){throw new Error(f)})})})}e.fail=u;function l(d,f){return r(d)?f?d.runInContext(f):d.run():d}e.resolveInContext=l;var c=ro(0,1073741823)})(Qe||(Qe={}));var XB;(function(e){e.Synchronous=sS})(XB||(XB={}));var YB;(function(e){function t(n,a){a===void 0&&(a="");var i=n.progress;if(!n.children.length)return i.isIndeterminate?""+a+i.taskName+": "+i.message:""+a+i.taskName+": ["+i.current+"/"+i.max+"] "+i.message;var o=a+"  |_ ",s=n.children.map(function(u){return t(u,o)});return i.isIndeterminate?""+a+i.taskName+": "+i.message+`
`+s.join(`
`):""+a+i.taskName+": ["+i.current+"/"+i.max+"] "+i.message+`
`+s.join(`
`)}function r(n){return t(n.root)}e.format=r})(YB||(YB={}));function fd(e,t,r,n,a){return pe(this,void 0,void 0,function(){var i,o,s,u,l,c,d;return he(this,function(f){switch(f.label){case 0:if(i=Math.max(t,0),o=0,s=0,e.isSynchronous)return n(Number.MAX_SAFE_INTEGER,r),[2,r];u=Gn(),l=0,c=0,f.label=1;case 1:return(l=n(i,r))>0?(o+=l,d=Gn()-u,c+=d,s+=d,e.shouldUpdate?[4,a(e,r,o)]:[3,3]):[3,4];case 2:f.sent(),i=Math.round(c*o/s)+1,u=Gn(),c=0,f.label=3;case 3:return[3,1];case 4:return e.shouldUpdate?[4,a(e,r,o)]:[3,6];case 5:f.sent(),f.label=6;case 6:return[2,r]}})})}function fye(e){return e>>0}function Gf(e,t){return e[t]|e[t+1]<<8}function yh(e,t,r){e[t]=r&255,e[t+1]=r>>8&255}function bh(e,t){return e[t+3]*(256*256*256)+(e[t+2]<<16|e[t+1]<<8|e[t])}function Uc(e,t,r){e[t]=r&255,e[t+1]=r>>8&255,e[t+2]=r>>16&255,e[t+3]=r>>24&255}function pye(e,t,r){for(var n="",a=0;a<r;a++)n+=String.fromCharCode(e[t+a]);return n}function hye(e){return e.length<2?"0"+e:e}function mye(e,t,r){for(var n="",a,i=0;i<r;i++)n+="%"+hye(e[t+i].toString(16));try{a=decodeURIComponent(n)}catch{return pye(e,t,r)}return a}function vye(e,t,r){for(var n=r.length,a=0,i=0;i<n;i++){var o=r.charCodeAt(i);if((o&4294967295-(1<<7)+1)===0)e[t+a]=o,a++;else if((o&4294967295-(1<<11)+1)===0)e[t+a]=192|o>>6,e[t+a+1]=128|o>>0&63,a+=2;else if((o&4294967295-(1<<16)+1)===0)e[t+a]=224|o>>12,e[t+a+1]=128|o>>6&63,e[t+a+2]=128|o>>0&63,a+=3;else if((o&4294967295-(1<<21)+1)===0)e[t+a]=240|o>>18,e[t+a+1]=128|o>>12&63,e[t+a+2]=128|o>>6&63,e[t+a+3]=128|o>>0&63,a+=4;else throw"e"}return a}function Eq(e){for(var t=e.length,r=0,n=0;n<t;n++){var a=e.charCodeAt(n);if((a&4294967295-(1<<7)+1)===0)r++;else if((a&4294967295-(1<<11)+1)===0)r+=2;else if((a&4294967295-(1<<16)+1)===0)r+=3;else if((a&4294967295-(1<<21)+1)===0)r+=4;else throw"e"}return r}var gye=function(){for(var e=new Uint32Array(256),t=0;t<256;t++){for(var r=t,n=0;n<8;n++)r&1?r=3988292384^r>>>1:r=r>>>1;e[t]=r}return e}();function yye(e,t,r,n){for(var a=0;a<n;a++)e=gye[(e^t[r+a])&255]^e>>>8;return e}function Pq(e,t,r){return yye(4294967295,e,t,r)^4294967295}var _t=function(){var e=Uint16Array,t=Uint32Array;return{next_code:new e(16),bl_count:new e(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new e(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new t(32),flmap:new e(512),fltree:[],fdmap:new e(32),fdtree:[],lmap:new e(32768),ltree:[],ttree:[],dmap:new e(32768),dtree:[],imap:new e(512),itree:[],rev15:new e(1<<15),lhst:new t(286),dhst:new t(30),ihst:new t(19),lits:new t(15e3),strt:new e(1<<16),prev:new e(1<<15)}}();(function(){for(var e=32768,t=0;t<e;t++){var r=t;r=(r&2863311530)>>>1|(r&1431655765)<<1,r=(r&3435973836)>>>2|(r&858993459)<<2,r=(r&4042322160)>>>4|(r&252645135)<<4,r=(r&4278255360)>>>8|(r&16711935)<<8,_t.rev15[t]=(r>>>16|r<<16)>>>17}function n(a,i,o){for(;i--!==0;)a.push(0,o)}for(var t=0;t<32;t++)_t.ldef[t]=_t.of0[t]<<3|_t.exb[t],_t.ddef[t]=_t.df0[t]<<4|_t.dxb[t];n(_t.fltree,144,8),n(_t.fltree,255-143,9),n(_t.fltree,279-255,7),n(_t.fltree,287-279,8),up(_t.fltree,9),By(_t.fltree,9,_t.flmap),Fy(_t.fltree,9),n(_t.fdtree,32,5),up(_t.fdtree,5),By(_t.fdtree,5,_t.fdmap),Fy(_t.fdtree,5),n(_t.itree,19,0),n(_t.ltree,286,0),n(_t.dtree,30,0),n(_t.ttree,320,0)})();function By(e,t,r){for(var n=e.length,a=_t.rev15,i=0;i<n;i+=2)if(e[i+1]!==0)for(var o=i>>1,s=e[i+1],u=o<<4|s,l=t-s,c=e[i]<<l,d=c+(1<<l);c!==d;){var f=a[c]>>>15-t;r[f]=u,c++}}function up(e,t){for(var r=e.length,n=_t.bl_count,a=0;a<=t;a++)n[a]=0;for(var a=1;a<r;a+=2)n[e[a]]++;var i=_t.next_code,o=0;n[0]=0;for(var s=1;s<=t;s++)o=o+n[s-1]<<1,i[s]=o;for(var u=0;u<r;u+=2){var l=e[u+1];l!==0&&(e[u]=i[l],i[l]++)}}function Fy(e,t){for(var r=_t.rev15,n=15-t,a=0;a<e.length;a+=2){var i=e[a]<<t-e[a+1];e[a]=r[i]>>>n}}function bye(e,t){var r=t===void 0;return t===void 0&&(t=new Uint8Array(e.length>>>2<<3)),{data:e,buf:t,noBuf:r,BFINAL:0,off:0,pos:0}}function xye(e,t){for(var r=e.data,n=e.noBuf,a=e.buf,i=e.BFINAL,o=e.off,s=e.pos,u=0;i===0&&u<t;){var l=void 0,c=void 0,d=0,f=0;i=rA(r,s,1),u+=1;var p=rA(r,s+1,2);if(s+=3,p===0){(s&7)!==0&&(s+=8-(s&7));var h=(s>>>3)+4,m=r[h-4]|r[h-3]<<8;n&&(a=tA(a,o+m)),a.set(new Uint8Array(r.buffer,r.byteOffset+h,m),o),s=h+m<<3,o+=m;continue}if(n&&(a=tA(a,o+(1<<17))),p===1)l=_t.flmap,c=_t.fdmap,d=(1<<9)-1,f=(1<<5)-1;else if(p===2){var v=kf(r,s,5)+257,g=kf(r,s+5,5)+1,y=kf(r,s+10,4)+4;s+=14;for(var b=0;b<38;b+=2)_t.itree[b]=0,_t.itree[b+1]=0;for(var S=1,b=0;b<y;b++){var x=kf(r,s+b*3,3);_t.itree[(_t.ordr[b]<<1)+1]=x,x>S&&(S=x)}s+=3*y,up(_t.itree,S),By(_t.itree,S,_t.imap),l=_t.lmap,c=_t.dmap,s=Cye(_t.imap,(1<<S)-1,v+g,r,s,_t.ttree);var C=KB(_t.ttree,0,v,_t.ltree);d=(1<<C)-1;var w=KB(_t.ttree,v,g,_t.dtree);f=(1<<w)-1,up(_t.ltree,C),By(_t.ltree,C,l),up(_t.dtree,w),By(_t.dtree,w,c)}else throw new Error("unknown BTYPE "+p);for(;;){var _=l[zP(r,s)&d];s+=_&15;var E=_>>>4;if(E>>>8===0)a[o++]=E;else{if(E===256)break;var P=o+E-254;if(E>264){var D=_t.ldef[E-257];P=o+(D>>>3)+kf(r,s,D&7),s+=D&7}var k=c[zP(r,s)&f];s+=k&15;var F=k>>>4,X=_t.ddef[F],U=(X>>>4)+rA(r,s,X&15);for(s+=X&15,n&&(a=tA(a,o+(1<<17)));o<P;)a[o]=a[o++-U],a[o]=a[o++-U],a[o]=a[o++-U],a[o]=a[o++-U];o=P}}}e.buf=a,e.BFINAL=i,e.off=o,e.pos=s}function Sye(e,t,r){return pe(this,void 0,void 0,function(){var n;return he(this,function(a){switch(a.label){case 0:if(t[0]===3&&t[1]===0)return[2,r||new Uint8Array(0)];n=bye(t,r),a.label=1;case 1:return n.BFINAL!==0?[3,4]:e.shouldUpdate?[4,e.update({message:"Inflating blocks...",current:n.pos,max:t.length})]:[3,3];case 2:a.sent(),a.label=3;case 3:return xye(n,100),[3,1];case 4:return[2,n.buf.length===n.off?n.buf:n.buf.slice(0,n.off)]}})})}function tA(e,t){var r=e.length;if(t<=r)return e;var n=new Uint8Array(Math.max(r<<1,t));return n.set(e,0),n}function Cye(e,t,r,n,a,i){for(var o=0;o<r;){var s=e[zP(n,a)&t];a+=s&15;var u=s>>>4;if(u<=15)i[o]=u,o++;else{var l=0,c=0;u===16?(c=3+kf(n,a,2),a+=2,l=i[o-1]):u===17?(c=3+kf(n,a,3),a+=3):u===18&&(c=11+kf(n,a,7),a+=7);for(var d=o+c;o<d;)i[o]=l,o++}}return a}function KB(e,t,r,n){for(var a=0,i=0,o=n.length>>>1;i<r;){var s=e[i+t];n[i<<1]=0,n[(i<<1)+1]=s,s>a&&(a=s),i++}for(;i<o;)n[i<<1]=0,n[(i<<1)+1]=0,i++;return a}function kf(e,t,r){return(e[t>>>3]|e[(t>>>3)+1]<<8)>>>(t&7)&(1<<r)-1}function rA(e,t,r){return(e[t>>>3]|e[(t>>>3)+1]<<8|e[(t>>>3)+2]<<16)>>>(t&7)&(1<<r)-1}function zP(e,t){return(e[t>>>3]|e[(t>>>3)+1]<<8|e[(t>>>3)+2]<<16)>>>(t&7)}function nA(e,t,r){for(var n=[],a=e.length,i=t.length,o=0;o<i;o+=2)t[o]=0,t[o+1]=0;for(var o=0;o<a;o++)e[o]!==0&&n.push({lit:o,f:e[o],d:void 0});var s=n.length,u=n.slice(0);if(s===0)return 0;if(s===1){var l=n[0].lit,c=l===0?1:0;return t[(l<<1)+1]=1,t[(c<<1)+1]=1,1}n.sort(function(g,y){return g.f-y.f});var d=n[0],f=n[1],p=0,h=1,m=2;for(n[0]={lit:-1,f:d.f+f.f,l:d,r:f,d:0};h!==s-1;)p!==h&&(m===s||n[p].f<n[m].f)?d=n[p++]:d=n[m++],p!==h&&(m===s||n[p].f<n[m].f)?f=n[p++]:f=n[m++],n[h++]={lit:-1,f:d.f+f.f,l:d,r:f,d:void 0};var v=UP(n[h-1],0);v>r&&(wye(u,r,v),v=r);for(var o=0;o<s;o++)t[(u[o].lit<<1)+1]=u[o].d;return v}function UP(e,t){return e.lit!==-1?(e.d=t,t):Math.max(UP(e.l,t+1),UP(e.r,t+1))}function wye(e,t,r){var n=0,a=1<<r-t,i=0;for(e.sort(function(s,u){return u.d===s.d?s.f-u.f:u.d-s.d}),n=0;n<e.length&&e[n].d>t;n++){var o=e[n].d;e[n].d=t,i+=a-(1<<r-o)}for(i=i>>>r-t;i>0;){var o=e[n].d;o<t?(e[n].d++,i-=1<<t-o-1):n++}for(;n>=0;n--)e[n].d===t&&i<0&&(e[n].d--,i++);i!==0&&console.log("debt left")}function _ye(e,t,r,n){var a=_t.lits,i=_t.strt,o=_t.prev;return{data:e,out:t,opt:Tye[n],i:0,pos:r<<3,cvrd:0,dlen:e.length,li:0,lc:0,bs:0,ebits:0,c:0,nc:0,lits:a,strt:i,prev:o}}function Aye(e,t){for(var r=e.data,n=e.dlen,a=e.out,i=e.opt,o=e.i,s=e.pos,u=e.cvrd,l=e.li,c=e.lc,d=e.bs,f=e.ebits,p=e.c,h=e.nc,m=_t.lits,v=_t.strt,g=_t.prev,y=Math.min(o+t,n);o<y;o++){if(p=h,o+1<n-2){h=qD(r,o+1);var b=o+1&32767;g[b]=v[h],v[h]=b}if(u<=o){(l>14e3||c>26697)&&n-o>100&&(u<o&&(m[l]=o-u,l+=2,u=o),s=Iq(o===n-1||u===n?1:0,m,l,f,r,d,o-d,a,s),l=c=f=0,d=o);var S=0;if(o<n-2&&(S=Pye(r,o,g,p,Math.min(i[2],n-o),i[3])),S!==0){var x=S>>>16,C=S&65535,w=ZB(x,_t.of0);_t.lhst[257+w]++;var _=ZB(C,_t.df0);_t.dhst[_]++,f+=_t.exb[w]+_t.dxb[_],m[l]=x<<23|o-u,m[l+1]=C<<16|w<<8|_,l+=2,u=o+x}else _t.lhst[r[o]]++;c++}}e.i=o,e.pos=s,e.cvrd=u,e.li=l,e.lc=c,e.bs=d,e.ebits=f,e.c=p,e.nc=h}var Tye=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]];function Eye(e,t,r,n,a){return pe(this,void 0,void 0,function(){var i,o,s,u,l,c,d,f,p,h,m,v;return he(this,function(g){switch(g.label){case 0:if(i=_ye(t,r,n,a),o=i.dlen,a===0){for(s=i.i,u=i.pos;s<o;)l=Math.min(65535,o-s),xh(r,u,s+l===o?1:0),u=Mq(t,s,l,r,u+8),s+=l;return[2,u>>>3]}o>2&&(i.nc=qD(t,0),i.strt[i.nc]=0),g.label=1;case 1:return i.i<o?e.shouldUpdate?[4,e.update({message:"Deflating...",current:i.i,max:o})]:[3,3]:[3,4];case 2:g.sent(),g.label=3;case 3:return Aye(i,1024*1024),[3,1];case 4:for(c=i.li,d=i.cvrd,f=i.pos,p=i.i,h=i.lits,m=i.bs,v=i.ebits,(m!==p||t.length===0)&&(d<p&&(h[c]=p-d,c+=2,d=p),f=Iq(1,h,c,v,t,m,p-m,r,f));(f&7)!==0;)f++;return[2,f>>>3]}})})}function Pye(e,t,r,n,a,i){var o=t&32767,s=r[o],u=o-s+(1<<15)&32767;if(s===o||n!==qD(e,t-u))return 0;for(var l=0,c=0,d=Math.min(32767,t);u<=d&&--i!==0&&s!==o;){if(l===0||e[t+l]===e[t+l-u]){var f=Iye(e,t,u);if(f>l){if(l=f,c=u,l>=a)break;u+2<f&&(f=u+2);for(var p=0,h=0;h<f-2;h++){var m=t-u+h+32768&32767,v=r[m],g=m-v+(1<<15)&32767;g>p&&(p=g,s=m)}}}o=s,s=r[o],u+=o-s+(1<<15)&32767}return l<<16|c}function Iye(e,t,r){if(e[t]!==e[t-r]||e[t+1]!==e[t+1-r]||e[t+2]!==e[t+2-r])return 0;var n=t,a=Math.min(e.length,t+258);for(t+=3;t<a&&e[t]===e[t-r];)t++;return t-n}function qD(e,t){return(e[t]<<8|e[t+1])+(e[t+2]<<4)&65535}function Iq(e,t,r,n,a,i,o,s,u){_t.lhst[256]++;var l=Mye(),c=l[0],d=l[1],f=l[2],p=l[3],h=l[4],m=l[5],v=l[6],g=l[7],y=((u+3&7)===0?0:8-(u+3&7))+32+(o<<3),b=n+Cg(_t.fltree,_t.lhst)+Cg(_t.fdtree,_t.dhst),S=n+Cg(_t.ltree,_t.lhst)+Cg(_t.dtree,_t.dhst);S+=14+3*m+Cg(_t.itree,_t.ihst)+(_t.ihst[16]*2+_t.ihst[17]*3+_t.ihst[18]*7);for(var x=0;x<286;x++)_t.lhst[x]=0;for(var x=0;x<30;x++)_t.dhst[x]=0;for(var x=0;x<19;x++)_t.ihst[x]=0;var C=y<b&&y<S?0:b<S?1:2;if(uS(s,u,e),uS(s,u+1,C),u+=3,C===0){for(;(u&7)!==0;)u++;u=Mq(a,i,o,s,u)}else{var w=void 0,_=void 0;if(C===1)w=_t.fltree,_=_t.fdtree;else if(C===2){up(_t.ltree,c),Fy(_t.ltree,c),up(_t.dtree,d),Fy(_t.dtree,d),up(_t.itree,f),Fy(_t.itree,f),w=_t.ltree,_=_t.dtree,xh(s,u,p-257),u+=5,xh(s,u,h-1),u+=5,xh(s,u,m-4),u+=4;for(var E=0;E<m;E++)xh(s,u+E*3,_t.itree[(_t.ordr[E]<<1)+1]);u+=3*m,u=$B(v,_t.itree,s,u),u=$B(g,_t.itree,s,u)}else throw new Error("unknown BTYPE "+C);for(var P=i,D=0;D<r;D+=2){for(var k=t[D],F=k>>>23,X=P+(k&(1<<23)-1);P<X;)u=Zg(a[P++],w,s,u);if(F!==0){var U=t[D+1],j=U>>16,te=U>>8&255,q=U&255;u=Zg(257+te,w,s,u),xh(s,u,F-_t.of0[te]),u+=_t.exb[te],u=Zg(q,_,s,u),uS(s,u,j-_t.df0[q]),u+=_t.dxb[q],P+=F}}u=Zg(256,w,s,u)}return u}function Mq(e,t,r,n,a){var i=a>>>3;return n[i]=r,n[i+1]=r>>>8,n[i+2]=255-n[i],n[i+3]=255-n[i+1],i+=4,n.set(new Uint8Array(e.buffer,t,r),i),a+(r+4<<3)}function Mye(){for(var e=nA(_t.lhst,_t.ltree,15),t=nA(_t.dhst,_t.dtree,15),r=[],n=QB(_t.ltree,r),a=[],i=QB(_t.dtree,a),o=0;o<r.length;o+=2)_t.ihst[r[o]]++;for(var o=0;o<a.length;o+=2)_t.ihst[a[o]]++;for(var s=nA(_t.ihst,_t.itree,7),u=19;u>4&&_t.itree[(_t.ordr[u-1]<<1)+1]===0;)u--;return[e,t,s,n,i,u,r,a]}function Cg(e,t){for(var r=0,n=0;n<t.length;n++)r+=t[n]*e[(n<<1)+1];return r}function $B(e,t,r,n){for(var a=0;a<e.length;a+=2){var i=e[a],o=e[a+1];n=Zg(i,t,r,n);var s=i===16?2:i===17?3:7;i>15&&(xh(r,n,o),n+=s)}return n}function QB(e,t){for(var r=e.length;r!==2&&e[r-1]===0;)r-=2;for(var n=0;n<r;n+=2){var a=e[n+1],i=n+3<r?e[n+3]:-1,o=n+5<r?e[n+5]:-1,s=n===0?-1:e[n-1];if(a===0&&i===a&&o===a){for(var u=n+5;u+2<r&&e[u+2]===a;)u+=2;var l=Math.min(u+1-n>>>1,138);l<11?t.push(17,l-3):t.push(18,l-11),n+=l*2-2}else if(a===s&&i===a&&o===a){for(var u=n+5;u+2<r&&e[u+2]===a;)u+=2;var l=Math.min(u+1-n>>>1,6);t.push(16,l-3),n+=l*2-2}else t.push(a,0)}return r>>>1}function ZB(e,t){var r=0;return t[r|16]<=e&&(r|=16),t[r|8]<=e&&(r|=8),t[r|4]<=e&&(r|=4),t[r|2]<=e&&(r|=2),t[r|1]<=e&&(r|=1),r}function Zg(e,t,r,n){return uS(r,n,t[e<<1]),n+t[(e<<1)+1]}function xh(e,t,r){r=r<<(t&7);var n=t>>>3;e[n]|=r,e[n+1]|=r>>>8}function uS(e,t,r){r=r<<(t&7);var n=t>>>3;e[n]|=r,e[n+1]|=r>>>8,e[n+2]|=r>>>16}function Dq(e,t,r){return r===void 0&&(r=!1),pe(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d,f,p,h,m;return he(this,function(v){switch(v.label){case 0:for(n=Object.create(null),a=new Uint8Array(t),i=a.length-4;bh(a,i)!==101010256;)i--;o=i,o+=4,o+=4,s=Gf(a,o),o+=2,o+=2,o+=4,u=bh(a,o),o+=4,o=u,l=0,v.label=1;case 1:return l<s?(o+=4,o+=4,o+=4,o+=4,o+=4,c=bh(a,o),o+=4,d=bh(a,o),o+=4,f=Gf(a,o),p=Gf(a,o+2),h=Gf(a,o+4),o+=6,o+=8,m=bh(a,o),o+=4,o+=f+p+h,[4,Dye(e,a,m,n,c,d,r)]):[3,4];case 2:v.sent(),v.label=3;case 3:return l++,[3,1];case 4:return[2,n]}})})}function Dye(e,t,r,n,a,i,o){return pe(this,void 0,void 0,function(){var s,u,l,c,d,f;return he(this,function(p){switch(p.label){case 0:return r+=4,r+=2,r+=2,s=Gf(t,r),r+=2,r+=4,r+=4,r+=8,u=Gf(t,r),r+=2,l=Gf(t,r),r+=2,c=mye(t,r,u),r+=u,r+=l,o?(n[c]={size:i,csize:a},[2]):(d=new Uint8Array(t.buffer,r),s!==0?[3,1]:(n[c]=new Uint8Array(d.buffer.slice(r,r+a)),[3,4]));case 1:return s!==8?[3,3]:(f=new Uint8Array(i),[4,kq(e,d,f)]);case 2:return p.sent(),n[c]=f,[3,4];case 3:throw"unknown compression method: "+s;case 4:return[2]}})})}function kq(e,t,r){return pe(this,void 0,void 0,function(){return he(this,function(n){return[2,Sye(e,t,r)]})})}function kye(e,t,r){return pe(this,void 0,void 0,function(){var n,a,i,o,o,s,u,l,c,d;return he(this,function(f){switch(f.label){case 0:if(n=t[3],a=10,n&4&&(i=Gf(t,a),a+=i),n&8){for(o=a;t[o]!==0;)++o;a=o+1}if(n&16){for(o=a;t[o]!==0;)++o;a=o+1}return n&1&&(a+=2),s=fye(bh(t,t.length-8)),u=bh(t,t.length-4),r===void 0&&(r=new Uint8Array(u)),l=new Uint8Array(t.buffer,t.byteOffset+a,t.length-a-8),[4,kq(e,l,r)];case 1:return c=f.sent(),d=Pq(c,0,c.length),s!==d&&console.error("ungzip: checksums don't match"),[2,c]}})})}function Rye(e,t,r){return pe(this,void 0,void 0,function(){var n,a;return he(this,function(i){switch(i.label){case 0:return r===void 0&&(r={level:6}),n=new Uint8Array(50+Math.floor(t.length*1.1)),[4,Eye(e,t,n,0,r.level)];case 1:return a=i.sent(),[2,new Uint8Array(n.buffer,0,a)]}})})}function Oye(e,t){return t===void 0&&(t=!1),Qe.create("Zip",function(r){return Bye(r,e,t)})}function Bye(e,t,r){return r===void 0&&(r=!1),pe(this,void 0,void 0,function(){var n,a,i,o,s,b,u,l,c,d,f,p,b,h,m,v,b,S,g,y,b,S,x,C;return he(this,function(w){switch(w.label){case 0:n=0,a={},i=[];for(o in t)i.push(o);s=0,w.label=1;case 1:return s<i.length?(b=i[s],u=!Fye(b)&&!r,l=t[b],c=Pq(l,0,l.length),d=a,f=b,C={cpr:u,usize:l.length,crc:c},u?[4,Rye(e,l)]:[3,3]):[3,6];case 2:return p=w.sent(),[3,4];case 3:p=l,w.label=4;case 4:d[f]=(C.file=p,C),w.label=5;case 5:return s++,[3,1];case 6:for(b in a)n+=a[b].file.length+30+46+2*Eq(b);n+=22,h=new Uint8Array(n),m=0,v=[];for(b in a)S=a[b],v.push(m),m=JB(h,m,b,S,0);g=0,y=m;for(b in a)S=a[b],v.push(m),m=JB(h,m,b,S,1,v[g++]);return x=m-y,Uc(h,m,101010256),m+=4,m+=4,yh(h,m,g),m+=2,yh(h,m,g),m+=2,Uc(h,m,x),m+=4,Uc(h,m,y),m+=4,m+=2,[2,h.buffer]}})})}function Fye(e){var t=e.split(".").pop().toLowerCase();return"png,jpg,jpeg,zip".indexOf(t)!==-1}function JB(e,t,r,n,a,i){i===void 0&&(i=0);var o=n.file;Uc(e,t,a===0?67324752:33639248),t+=4,a===1&&(t+=2),yh(e,t,20),t+=2,yh(e,t,0),t+=2,yh(e,t,n.cpr?8:0),t+=2,Uc(e,t,0),t+=4,Uc(e,t,n.crc),t+=4,Uc(e,t,o.length),t+=4,Uc(e,t,n.usize),t+=4,yh(e,t,Eq(r)),t+=2,yh(e,t,0),t+=2,a===1&&(t+=2,t+=2,t+=6,Uc(e,t,i),t+=4);var s=vye(e,t,r);return t+=s,a===0&&(e.set(o,t),t+=o.length),t}function Mv(e,t,r){for(var n=0,a=r.length;n<a;n++){var i=r.charCodeAt(n);if(i<128){e[t++]=i>>>0&127|0;continue}if(i<2048){e[t++]=i>>>6&31|192,e[t++]=i>>>0&63|128;continue}if(i<65536){e[t++]=i>>>12&15|224,e[t++]=i>>>6&63|128,e[t++]=i>>>0&63|128;continue}if(i<1114112){e[t++]=i>>>18&7|240,e[t++]=i>>>12&63|128,e[t++]=i>>>6&63|128,e[t++]=i>>>0&63|128;continue}throw new Error("bad codepoint "+i)}}var Lye=function(){for(var e=[],t=0;t<1024;t++)e[t]=String.fromCharCode(t);return e}();function Rq(e){throw new Error(e)}function Nye(e,t,r){for(var n=Lye,a=void 0,i=[],o=512,s=0,u=t,l=t+r;u<l;u++){var c=e[u];(c&128)===0?i[s++]=n[c]:(c&224)===192?i[s++]=n[(c&15)<<6|e[++u]&63]:(c&240)===224?i[s++]=String.fromCharCode((c&15)<<12|(e[++u]&63)<<6|(e[++u]&63)<<0):(c&248)===240?i[s++]=String.fromCharCode((c&7)<<18|(e[++u]&63)<<12|(e[++u]&63)<<6|(e[++u]&63)<<0):Rq("Invalid byte "+c.toString(16)),s===o&&(a=a||[],a[a.length]=i.join(""),s=0)}return a?(s>0&&(a[a.length]=i.slice(0,s).join("")),a.join("")):i.slice(0,s).join("")}var eF=typeof TextDecoder<"u"?new TextDecoder:void 0;function WD(e,t,r){if(eF){var n=t||r!==e.length?e.subarray(t,t+r):e;return eF.decode(n)}else return Nye(e,t,r)}function xC(e){for(var t=0,r=0,n=e.length;r<n;r++){var a=e.charCodeAt(r);if(a<128){t+=1;continue}if(a<2048){t+=2;continue}if(a<65536){t+=3;continue}if(a<1114112){t+=4;continue}Rq("bad codepoint "+a)}return t}var zye=typeof document>"u"?require("xhr2"):XMLHttpRequest,Xu;(function(e){e[e.None=0]="None",e[e.Gzip=1]="Gzip",e[e.Zip=2]="Zip"})(Xu||(Xu={}));function qf(e,t){return Gye(e,t)}function VP(e){return typeof e=="string"?rF(e,e,"string"):rF(e.title,e.url,e.type||"string",e.body,e.headers)}function Uye(e){if(e instanceof FileReader)return e.readyState===FileReader.DONE;if(e instanceof XMLHttpRequest)return e.readyState===XMLHttpRequest.DONE;throw new Error("unknown data type")}function tF(e){return e?"Failed to download data. Possible reasons: Resource is not available, or CORS is not allowed on the server.":"Failed to open file."}function Oq(e,t,r){return new Promise(function(n,a){if(Uye(r)){var i=r.error;i!=null?a(i??tF(r instanceof XMLHttpRequest)):n(r);return}var o=!1;r.onerror=function(s){if(!o){var u=s.target.error;a(u??tF(r instanceof XMLHttpRequest))}},r.onprogress=function(s){if(!(!e.shouldUpdate||o))try{s.lengthComputable?e.update({message:t,isIndeterminate:!1,current:s.loaded,max:s.total}):e.update({message:t+" "+(s.loaded/1024/1024).toFixed(2)+" MB",isIndeterminate:!0})}catch(u){o=!0,a(u)}},r.onload=function(s){n(r)}})}function Vye(e){return/\.gz$/i.test(e)?Xu.Gzip:/\.zip$/i.test(e)?Xu.Zip:Xu.None}function Hye(e,t,r){return pe(this,void 0,void 0,function(){var n,a,i;return he(this,function(o){switch(o.label){case 0:switch(n=r,n){case Xu.None:return[3,1];case Xu.Gzip:return[3,2];case Xu.Zip:return[3,3]}return[3,5];case 1:return[2,t];case 2:return[2,kye(e,t)];case 3:return[4,Dq(e,t.buffer)];case 4:if(a=o.sent(),i=Object.keys(a),i.length!==1)throw new Error("can only decompress zip files with a single entry");return[2,a[i[0]]];case 5:return[2]}})})}function jye(e,t,r,n){return pe(this,void 0,void 0,function(){var a,i,o,s;return he(this,function(u){switch(u.label){case 0:if(a=t.result,i=a instanceof ArrayBuffer?new Uint8Array(a):a,i===null)throw new Error("no data given");if(n===Xu.None)return[3,4];if(!(i instanceof Uint8Array))throw new Error("need Uint8Array for decompression");return[4,Hye(e,i,n)];case 1:return o=u.sent(),r!=="string"?[3,3]:[4,e.update({message:"Decoding text..."})];case 2:return u.sent(),i=WD(o,0,o.length),[3,4];case 3:i=o,u.label=4;case 4:return r==="binary"&&i instanceof Uint8Array?[2,i]:[3,5];case 5:return r==="zip"&&i instanceof Uint8Array?[4,Dq(e,i.buffer)]:[3,7];case 6:return[2,u.sent()];case 7:if(r==="string"&&typeof i=="string")return[2,i];if(r==="xml"&&typeof i=="string")return s=new DOMParser,[2,s.parseFromString(i,"application/xml")];if(r==="json"&&typeof i=="string")return[2,JSON.parse(i)];u.label=8;case 8:throw new Error("could not get requested response data '"+r+"'")}})})}function Gye(e,t){var r=this,n=void 0;return Qe.create("Read File",function(a){return pe(r,void 0,void 0,function(){var i,o;return he(this,function(s){switch(s.label){case 0:return s.trys.push([0,,5,6]),n=new FileReader,i=t==="zip"?Xu.None:Vye(e.name),t==="binary"||t==="zip"||i!==Xu.None?n.readAsArrayBuffer(e):n.readAsText(e),[4,a.update({message:"Opening file...",canAbort:!0})];case 1:return s.sent(),[4,Oq(a,"Reading...",n)];case 2:return o=s.sent(),[4,a.update({message:"Processing file...",canAbort:!1})];case 3:return s.sent(),[4,jye(a,o,t,i)];case 4:return[2,s.sent()];case 5:return n=void 0,[7];case 6:return[2]}})})},function(){n&&n.abort()})}var HP=function(){function e(){}return e.get=function(){return this.pool.length?this.pool.pop():new zye},e.emptyFunc=function(){},e.deposit=function(t){this.pool.length<this.poolSize&&(t.onabort=e.emptyFunc,t.onerror=e.emptyFunc,t.onload=e.emptyFunc,t.onprogress=e.emptyFunc,this.pool.push(t))},e.pool=[],e.poolSize=15,e}();function qye(e,t){if(e.status>=200&&e.status<400){var r=e.response;if(HP.deposit(e),(t==="binary"||t==="zip")&&r instanceof ArrayBuffer)return new Uint8Array(r);if(t==="string"&&typeof r=="string")return r;if(t==="xml"&&r instanceof XMLDocument)return r;if(t==="json"&&typeof r=="object")return r;throw new Error("could not get requested response data '"+t+"'")}else throw HP.deposit(e),new Error("Download failed with status code "+e.status)}function Wye(e){switch(e){case"json":return"json";case"xml":return"document";case"string":return"text";case"binary":return"arraybuffer";case"zip":return"arraybuffer"}}function rF(e,t,r,n,a){var i=this,o=void 0;return Qe.create(e||"Download",function(s){return pe(i,void 0,void 0,function(){var u,l,c,d,f,p,h;return he(this,function(m){switch(m.label){case 0:if(o=HP.get(),o.open(n?"post":"get",t,!0),a)for(u=0,l=a;u<l.length;u++)c=l[u],d=c[0],f=c[1],o.setRequestHeader(d,f);return o.responseType=Wye(r),o.send(n),[4,s.update({message:"Waiting for server...",canAbort:!0})];case 1:return m.sent(),[4,Oq(s,"Downloading...",o)];case 2:return p=m.sent(),o=void 0,[4,s.update({message:"Parsing response...",canAbort:!1})];case 3:return m.sent(),h=qye(p,r),[2,h]}})})},function(){o&&(o.abort(),o=void 0)})}function Xye(e,t,r,n){return pe(this,void 0,void 0,function(){var a,i,o,s,u,l,h,c,d,f,p,h,m;return he(this,function(v){switch(v.label){case 0:return a=r.length,i=new Array(r.length),[4,e.update({message:"Downloading...",current:0,max:a})];case 1:for(v.sent(),o=[],s=[],u=0,l=Math.min(a,n);u<l;u++)h=r[u],o.push(aF(u,h.id,t.resolve(Fn.getUrlAsset(t,h.url),h.isBinary?"binary":"string").runAsChild(e))),s.push(u);c=0,v.label=2;case 2:return o.length>0?[4,Promise.race(o)]:[3,6];case 3:if(d=v.sent(),f=r[d.index],p=s.indexOf(d.index),c++,d.kind==="error"&&!f.canFail)throw new Error(f.url+": "+d.error);return e.shouldUpdate?[4,e.update({message:"Downloading...",current:c,max:a})]:[3,5];case 4:v.sent(),v.label=5;case 5:return i[d.index]=d,o=o.filter(nF,p),s=s.filter(nF,p),u<a&&(h=r[u],m=t.resolve(Fn.getUrlAsset(t,h.url),h.isBinary?"binary":"string").runAsChild(e),o.push(aF(u,h.id,m)),s.push(u),u++),[3,2];case 6:return[2,i]}})})}function nF(e,t){return this!==t}function aF(e,t,r){return pe(this,void 0,void 0,function(){var n,a;return he(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,r];case 1:return n=i.sent(),[2,{kind:"ok",result:n,index:e,id:t}];case 2:return a=i.sent(),[2,{kind:"error",error:a,index:e,id:t}];case 3:return[2]}})})}var Fn;(function(e){function t(u,l){return T({kind:"url",id:Cn.create22(),url:u},l)}e.Url=t;function r(u){return{kind:"file",id:Cn.create22(),name:u.name,file:u}}e.File=r;function n(u){return u?.kind==="url"}e.isUrl=n;function a(u){return u?.kind==="file"}e.isFile=a;function i(u,l,c){return{data:u,dispose:function(){c.release(l)}}}e.Wrapper=i;function o(u){return typeof u=="string"?u:u.url}e.getUrl=o;function s(u,l,c){if(typeof l=="string"){var d=u.tryFindUrl(l,c);return d||t(l,{body:c})}return l}e.getUrlAsset=s})(Fn||(Fn={}));var Yye=function(){function e(){this._assets=new Map}return Object.defineProperty(e.prototype,"assets",{get:function(){return HD(this._assets.values())},enumerable:!1,configurable:!0}),e.prototype.tryFindUrl=function(t,r){for(var n=this.assets.values();;){var a=n.next();if(a.done)return;var i=a.value.asset;if(Fn.isUrl(i)&&i.url===t&&(i.body||"")===(r||""))return i}},e.prototype.set=function(t,r){this._assets.set(t.id,{asset:t,file:r,refCount:0})},e.prototype.resolve=function(t,r,n){var a=this;return n===void 0&&(n=!0),Fn.isUrl(t)?Qe.create("Download "+(t.title||t.url),function(i){return pe(a,void 0,void 0,function(){var o,s,u,l,c,d,f,p,h;return he(this,function(m){switch(m.label){case 0:return this._assets.has(t.id)?(o=this._assets.get(t.id),o.refCount++,u=(s=Fn).Wrapper,[4,qf(o.file,r).runInContext(i)]):[3,2];case 1:return[2,u.apply(s,[m.sent(),t,this])];case 2:return n?[3,4]:(c=(l=Fn).Wrapper,[4,VP(T(T({},t),{type:r})).runInContext(i)]);case 3:return[2,c.apply(l,[m.sent(),t,this])];case 4:return[4,VP(T(T({},t),{type:"binary"})).runInContext(i)];case 5:return d=m.sent(),f=new File([d],"raw-data"),this._assets.set(t.id,{asset:t,file:f,refCount:1}),h=(p=Fn).Wrapper,[4,qf(f,r).runInContext(i)];case 6:return[2,h.apply(p,[m.sent(),t,this])]}})})}):Qe.create("Read "+t.name,function(i){return pe(a,void 0,void 0,function(){var o,s,u,l,c;return he(this,function(d){switch(d.label){case 0:return this._assets.has(t.id)?(o=this._assets.get(t.id),o.refCount++,u=(s=Fn).Wrapper,[4,qf(o.file,r).runInContext(i)]):[3,2];case 1:return[2,u.apply(s,[d.sent(),t,this])];case 2:if(!(t.file instanceof File))throw new Error("Cannot resolve file asset '"+t.name+"' ("+t.id+")");return n&&this._assets.set(t.id,{asset:t,file:t.file,refCount:1}),c=(l=Fn).Wrapper,[4,qf(t.file,r).runInContext(i)];case 3:return[2,c.apply(l,[d.sent(),t,this])]}})})})},e.prototype.release=function(t){var r=this._assets.get(t.id);!r||(r.refCount--,r.refCount<=0&&this._assets.delete(t.id))},e}(),M;(function(e){e.Essential={isEssential:!0};function t(ie,le){return le&&(le.label&&(ie.label=le.label),le.description&&(ie.description=le.description),le.legend&&(ie.legend=le.legend),le.fieldLabels&&(ie.fieldLabels=le.fieldLabels),le.isHidden&&(ie.isHidden=le.isHidden),le.shortLabel&&(ie.shortLabel=le.shortLabel),le.twoColumns&&(ie.twoColumns=le.twoColumns),le.isEssential&&(ie.isEssential=le.isEssential),le.category&&(ie.category=le.category),le.hideIf&&(ie.hideIf=le.hideIf),le.help&&(ie.help=le.help)),ie}function r(ie){var le=T({},ie);return le.isOptional=!0,le}e.Optional=r;function n(ie,le){return t({type:"value",defaultValue:ie},le)}e.Value=n;function a(ie,le,O){return t({type:"select",defaultValue:Se(ie,le),options:le,cycle:O?.cycle},O)}e.Select=a;function i(ie,le,O){var G=t({type:"multi-select",defaultValue:ie,options:le},O);return O?.emptyValue&&(G.emptyValue=O.emptyValue),G}e.MultiSelect=i;function o(ie,le){return t({type:"boolean",defaultValue:ie},le)}e.Boolean=o;function s(ie,le){return ie===void 0&&(ie=""),t({type:"text",defaultValue:ie},le)}e.Text=s;function u(ie,le){var O=t({type:"color",defaultValue:ie},le);return le?.isExpanded&&(O.isExpanded=le.isExpanded),O}e.Color=u;function l(ie,le){var O;if(typeof ie=="string"){var G=fu(ie);O={kind:G.type!=="qualitative"?"interpolate":"set",colors:G.list}}else O=ie;return t({type:"color-list",presetKind:le?.presetKind||"all",defaultValue:O,offsets:!!le?.offsets},le)}e.ColorList=l;function c(ie,le,O){return t(m({type:"vec3",defaultValue:ie},le),O)}e.Vec3=c;function d(ie,le){return t({type:"mat4",defaultValue:ie},le)}e.Mat4=d;function f(ie,le){var O=typeof ie=="string"?Fn.Url(ie):Fn.Url(ie.url,{body:ie.body}),G=t({type:"url",defaultValue:O},le);return G}e.Url=f;function p(ie){var le=t({type:"file",defaultValue:null},ie);return ie?.accept&&(le.accept=ie.accept),le}e.File=p;function h(ie){var le=t({type:"file-list",defaultValue:null},ie);return ie?.accept&&(le.accept=ie.accept),le}e.FileList=h;function m(ie,le){return le&&(typeof le.min<"u"&&(ie.min=le.min),typeof le.max<"u"&&(ie.max=le.max),typeof le.step<"u"&&(ie.step=le.step)),ie}function v(ie,le,O){var G=t(m({type:"number",defaultValue:ie},le),O);return O?.immediateUpdate&&(G.immediateUpdate=!0),G}e.Numeric=v;function g(ie,le,O){return t(m({type:"interval",defaultValue:ie},le),O)}e.Interval=g;function y(ie,le){return t({type:"line-graph",defaultValue:ie},le)}e.LineGraph=y;function b(ie,le){var O=t({type:"group",defaultValue:le?.customDefault||j(ie),params:ie},le);return le?.isExpanded&&(O.isExpanded=le.isExpanded),le?.isFlat&&(O.isFlat=le.isFlat),le?.pivot&&(O.pivot=le.pivot),O}e.Group=b;function S(ie){return b({},ie)}e.EmptyGroup=S;function x(ie,le,O,G){var ve=Se(ie,le);return t({type:"mapped",defaultValue:{name:ve,params:O(ve).defaultValue},select:a(ve,le,G),map:O},G)}e.Mapped=x;function C(ie,le,O){var G=O?.options?O.options:Object.keys(le).map(function(we){return[we,le[we].label||vs(we)]}),ve=Se(ie,G);return t({type:"mapped",defaultValue:{name:ve,params:le[ve].defaultValue},select:a(ve,G,O),map:function(we){return le[we]}},O)}e.MappedStatic=C;function w(ie,le,O){return t({type:"object-list",element:ie,getLabel:le,ctor:_,defaultValue:O?.defaultValue||[]},O)}e.ObjectList=w;function _(){return j(this.element)}function E(){throw new Error("getValue not set. Fix runtime.")}function P(ie,le,O){var G;return t({type:"value-ref",defaultValue:{ref:(G=O?.defaultRef)!==null&&G!==void 0?G:"",getValue:E},getOptions:ie,resolveRef:le},O)}e.ValueRef=P;function D(ie){var le;return t({type:"data-ref",defaultValue:{ref:(le=ie?.defaultRef)!==null&&le!==void 0?le:"",getValue:E}},ie)}e.DataRef=D;function k(ie,le,O){return{type:"converted",defaultValue:le(O.defaultValue),converted:O,fromValue:ie,toValue:le}}e.Converted=k;function F(ie,le,O,G,ve){var we=Object.keys(le).map(function(Te){return[Te,Te]});return t({type:"conditioned",select:a(O(ie),we,ve),defaultValue:ie,conditionParams:le,conditionForValue:O,conditionedValue:G},ve)}e.Conditioned=F;function X(ie,le){return t({type:"script",defaultValue:ie},le)}e.Script=X;function U(ie){return 0}e.For=U;function j(ie){for(var le={},O=0,G=Object.keys(ie);O<G.length;O++){var ve=G[O];ie[ve].isOptional||(le[ve]=ie[ve].defaultValue)}return le}e.getDefaultValues=j;function te(ie,le){return function(){return ie(le)}}function q(ie,le,O){if(!!le){if(ie.type==="value-ref"){var G=le;G.ref?G.getValue=te(ie.resolveRef,G.ref):G.getValue=function(){throw new Error("Unset ref in ValueRef value.")}}else if(ie.type==="data-ref"){var G=le;G.ref?G.getValue=te(O,G.ref):G.getValue=function(){throw new Error("Unset ref in ValueRef value.")}}else if(ie.type==="group")ee(ie.params,le,O);else if(ie.type==="mapped"){var G=le,ve=ie.map(G.name);q(ve,G.params,O)}else if(ie.type==="object-list"){if(!V(ie.element))return;for(var we=0,Te=le;we<Te.length;we++){var Ue=Te[we];ee(ie.element,Ue,O)}}}}function W(ie){if(ie.type==="value-ref"||ie.type==="data-ref")return!0;if(ie.type==="group"){if(V(ie.params))return!0}else if(ie.type==="mapped")for(var le=0,O=ie.select.options;le<O.length;le++){var G=O[le][0];if(W(ie.map(G)))return!0}else if(ie.type==="object-list")return V(ie.element);return!1}function V(ie){for(var le=0,O=Object.keys(ie);le<O.length;le++){var G=O[le];if(W(ie[G]))return!0}return!1}function ee(ie,le,O){for(var G=0,ve=Object.keys(ie);G<ve.length;G++){var we=ve[G];q(ie[we],le?.[we],O)}}e.resolveRefs=ee;function ue(ie,le){for(var O=0,G=Object.keys(ie);O<G.length;O++){var ve=G[O];ie[ve].isOptional||(ie[ve].defaultValue=le[ve])}}e.setDefaultValues=ue;function $(ie){return mp(ie)}e.clone=$;function Q(ie,le){}e.validate=Q;function R(ie,le,O){if(le===O)return!0;if(typeof le!="object"||typeof O!="object")return!1;for(var G=0,ve=Object.keys(ie);G<ve.length;G++){var we=ve[G];if(!Y(ie[we],le[we],O[we]))return!1}return!0}e.areEqual=R;function Y(ie,le,O){if(le===O)return!0;if(ie.type==="group")return R(ie.params,le,O);if(ie.type==="mapped"){var G=le,ve=O;if(G.name!==ve.name)return!1;var we=ie.map(G.name);return Y(we,G.params,ve.params)}else if(ie.type==="multi-select"){var G=le,ve=O;if(G.length!==ve.length)return!1;if(G.length<10){for(var Te=0,Ue=G.length;Te<Ue;Te++)if(G[Te]!==ve[Te]&&ve.indexOf(G[Te])<0)return!1}else for(var Ge=new Set(ve),Te=0,Ue=G.length;Te<Ue;Te++)if(G[Te]!==ve[Te]&&!Ge.has(G[Te]))return!1;return!0}else{if(ie.type==="interval")return le[0]===O[0]&&le[1]===O[1];if(ie.type==="line-graph"){var G=le,ve=O;if(G.length!==ve.length)return!1;for(var Te=0,Ue=G.length;Te<Ue;Te++)if(!Xe.areEqual(G[Te],ve[Te]))return!1;return!0}else{if(ie.type==="vec3")return A.equals(le,O);if(ie.type==="mat4")return de.areEqual(le,O,jn);if(ie.type==="script"){var G=le,ve=O;return G.language===ve.language&&G.expression===ve.expression}else if(ie.type==="object-list"){var G=le,ve=O,Je=G.length;if(Je!==ve.length)return!1;for(var Te=0;Te<Je;Te++)if(!R(ie.element,G[Te],ve[Te]))return!1;return!0}else if(typeof le=="object"&&typeof O=="object")return p0(le,O)}}return!1}e.isParamEqual=Y;function re(ie,le,O){if(le===void 0)return T({},O);if(O===void 0)return T({},le);for(var G=Object.create(null),ve=0,we=Object.keys(ie);ve<we.length;ve++){var Te=we[ve];G[Te]=K(ie[Te],le[Te],O[Te])}return G}e.merge=re;function K(ie,le,O){if(le===void 0)return typeof O=="object"&&!Array.isArray(O)?T({},O):O;if(O===void 0)return typeof le=="object"&&!Array.isArray(le)?T({},le):le;if(ie.type==="group")return re(ie.params,le,O);if(ie.type==="mapped"){var G=le,ve=O;if(G.name!==ve.name)return T({},ve);var we=ie.map(ve.name);return{name:ve.name,params:K(we,G.params,ve.params)}}else return ie.type==="value"?O:typeof le=="object"&&typeof O=="object"?Array.isArray(O)?O:T(T({},le),O):O}e.mergeParam=K;function L(ie,le){for(var O=0,G=ie.options;O<G.length;O++){var ve=G[O];if(ve[0]===le)return!0}return!1}function H(ie,le,O){if(le==null)return O?ie.defaultValue:void 0;if(ie.type==="value")return le;if(ie.type==="group"){for(var G=Object.create(null),ve=0,we=Object.keys(ie.params);ve<we.length;ve++){var Te=we[ve],Ue=ie.params[Te];le[Te]===void 0?O&&(G[Te]=Ue.defaultValue):G[Te]=H(Ue,le[Te],O)}return G}else if(ie.type==="mapped"){var Ge=le;if(typeof Ge.name!="string")return ie.defaultValue;if(typeof Ge.params>"u")return O?ie.defaultValue:void 0;if(!L(ie.select,Ge.name))return ie.defaultValue;var Ue=ie.map(Ge.name);return{name:Ge.name,params:H(Ue,Ge.params,O)}}else{if(ie.type==="select")return L(ie,le)?le:ie.defaultValue;if(ie.type==="multi-select"){if(!Array.isArray(le))return ie.defaultValue;var G=le.filter(function(st){return L(this,st)},ie);return le.length>0&&G.length===0?ie.defaultValue:G}else if(ie.type==="object-list")return Array.isArray(le)?le.map(function(Je){return Z(ie.element,Je,O?"all":"skip")}):ie.defaultValue}return le}function Z(ie,le,O){if(typeof le!="object"||le===null)return O?j(ie):le;for(var G=Object.create(null),ve=0,we=Object.keys(ie);ve<we.length;ve++){var Te=we[ve],Ue=ie[Te];le[Te]===void 0?O==="all"&&(G[Te]=Ue.defaultValue):G[Te]=H(Ue,le[Te],O!=="skip")}return G}e.normalizeParams=Z;function fe(ie,le){for(var O=[],G=0,ve=Object.keys(ie);G<ve.length;G++){var we=ve[G];if(!le)typeof ie[we]=="string"?O.push([we,ie[we]]):O.push([we,le===null?we:vs(we)]);else{var Te=le(we,ie[we]);O.push(typeof Te=="string"?[we,Te]:[we,Te[0],Te[1]])}}return O}e.objectToOptions=fe;function me(ie,le){for(var O=[],G=0,ve=ie;G<ve.length;G++){var we=ve[G];le?O.push([we,le(we)]):O.push([we,le===null?we:vs(we)])}return O}e.arrayToOptions=me;function xe(ie,le){for(var O=0,G=ie.options;O<G.length;O++){var ve=G[O];if(ve[0]===le)return ve[1]}return""}e.optionLabel=xe;function Se(ie,le){for(var O=0,G=le;O<G.length;O++){var ve=G[O];if(ve[0]===ie)return ie}return le.length>0?le[0][0]:void 0}})(M||(M={}));var jo;(function(e){function t(a){var i={create:function(o){return{action:i,params:o}},id:Cn.create22(),definition:a,createDefaultParams:function(o,s){return a.params?M.getDefaultValues(a.params(o,s)):{}}};return i}e.create=t;function r(a){var i=a.definition;return t({from:i.from,display:i.display,params:i.params,isApplicable:a.definition.isApplicable?function(o,s,u){return a.definition.isApplicable(o,u)}:void 0,run:function(o){var s=o.cell,u=o.state,l=o.params,c=u.build().to(s.transform.ref).apply(a,l);return u.updateTree(c)}})}e.fromTransformer=r;var n;(function(a){function i(o){return function(s){return t(T({from:o.from instanceof Array?o.from:o.from?[o.from]:[],display:typeof o.display=="string"?{name:o.display}:o.display?o.display:{name:"Unnamed State Action"},params:typeof o.params=="object"?function(){return o.params}:o.params?o.params:void 0,isApplicable:o.isApplicable},typeof s=="function"?{run:s}:s))}}a.build=function(o){return i(o)}})(n=e.Builder||(e.Builder={})),e.build=n.build})(jo||(jo={}));var gt;(function(e){function t(m,v,g){return m.definition.params?m.definition.params(v,g):{}}e.getParamDefinition=t;function r(m){return!!m&&typeof m.toAction=="function"&&typeof m.apply=="function"}e.is=r;var n;(function(m){m[m.Unchanged=0]="Unchanged",m[m.Updated=1]="Updated",m[m.Recreate=2]="Recreate",m[m.Null=3]="Null"})(n=e.UpdateResult||(e.UpdateResult={}));var a=new Map,i=new Map;function o(m){for(var v=0,g=m.definition.from;v<g.length;v++){var y=g[v];i.has(y.type)?i.get(y.type).push(m):i.set(y.type,[m])}}function s(){return Array.from(a.values())}e.getAll=s;function u(m){var v=a.get(m);if(!v)throw new Error("A transformer with signature '"+m+"' is not registered.");return v}e.get=u;function l(m){return i.get(m)||[]}e.fromType=l;function c(m,v){var g=v.name,y=m+"."+g;if(a.has(y))throw new Error("A transform with id '"+g+"' is already registered. Please pick a unique identifier for your transforms and/or register them only once. This is to ensure that transforms can be serialized and replayed.");var b={apply:function(S,x,C){return vr.create(S,b,x,C)},toAction:function(){return jo.fromTransformer(b)},namespace:m,id:y,definition:v,createDefaultParams:function(S,x){return v.params?M.getDefaultValues(v.params(S,x)):{}}};return a.set(y,b),o(b),b}e.create=c;function d(m){return function(v){return c(m,v)}}e.factory=d;function f(m){return p.build(m)}e.builderFactory=f;var p;(function(m){function v(y,b){return function(S){return c(y,T({name:b.name,from:b.from instanceof Array?b.from:[b.from],to:b.to instanceof Array?b.to:[b.to],display:typeof b.display=="string"?{name:b.display}:b.display?b.display:{name:k0(b.name.replace(/[-]/g," "))},params:typeof b.params=="object"?function(){return b.params}:b.params?b.params:void 0,isDecorator:b.isDecorator},S))}}function g(y){return function(b){return v(y,b)}}m.build=g})(p=e.Builder||(e.Builder={}));function h(m){return p.build(m)}e.build=h,e.ROOT=c("build-in",{name:"root",from:[],to:[],display:{name:"Root",description:"For internal use."},apply:function(){throw new Error("should never be applied")},update:function(){return n.Unchanged}})})(gt||(gt={}));var vr;(function(e){e.RootRef="-=root=-";function t(v,g){return!!v.isHidden!=!!g.isHidden||!!v.isCollapsed!=!!g.isCollapsed||!!v.isGhost!=!!g.isGhost||!!v.isLocked!=!!g.isLocked}e.areStatesEqual=t;function r(v,g){return g?typeof g.isCollapsed<"u"&&v.isCollapsed!==g.isCollapsed||typeof g.isHidden<"u"&&v.isHidden!==g.isHidden||typeof g.isGhost<"u"&&v.isGhost!==g.isGhost||typeof g.isLocked<"u"&&v.isLocked!==g.isLocked:!1}e.isStateChange=r;function n(v,g){if(!g)return!1;for(var y=!1,b=0,S=Object.keys(g);b<S.length;b++){var x=S[b],C=g[x],w=v[x];!!C!=!!w&&(y=!0,v[x]=C)}return y}e.assignState=n;function a(v,g){if(!g)return!1;for(var y=!1,b=0,S=Object.keys(g);b<S.length;b++){var x=S[b],C=g[x],w=v[x];!!C!=!!w&&(y=!0,v[x]=C)}for(var _=0,E=Object.keys(v);_<E.length;_++){var x=E[_],C=g[x],w=v[x];!!C!=!!w&&(y=!0,v[x]=C)}return y}e.syncState=a;function i(v,g,y,b){var S=b&&b.ref?b.ref:Cn.create22(),x=void 0;return b&&b.tags&&(x=typeof b.tags=="string"?[b.tags]:b.tags,x.length===0?x=void 0:x.sort()),{parent:v,transformer:g,state:b?.state||{},tags:x,ref:S,dependsOn:b&&b.dependsOn,params:y,version:Cn.create22()}}e.create=i;function o(v,g){return T(T({},v),{params:g,version:Cn.create22()})}e.withParams=o;function s(v,g){return g?T(T({},v),{state:T(T({},v.state),g)}):v}e.withState=s;function u(v,g){var y=void 0;return g&&(y=typeof g=="string"?[g]:g,y.length===0?y=void 0:y.sort()),T(T({},v),{tags:y,version:Cn.create22()})}e.withTags=u;function l(v,g){return T(T({},v),{parent:g,version:Cn.create22()})}e.withParent=l;function c(v){return i(e.RootRef,gt.ROOT,{},{ref:e.RootRef,state:v})}e.createRoot=c;function d(v,g){return v.tags?v.tags.indexOf(g)>=0:!1}e.hasTag=d;function f(v,g){if(!v.tags)return typeof g!="string"&&g.length===0;if(typeof g=="string")return d(v,g);for(var y=0,b=g;y<b.length;y++){var S=b[y];if(v.tags.indexOf(S)<0)return!1}return!0}e.hasTags=f;function p(v){return v}function h(v){for(var g=v.transformer.definition.customSerialization?v.transformer.definition.customSerialization.toJSON:p,y=void 0,b=0,S=Object.keys(v.state);b<S.length;b++){var x=S[b],C=v.state[x];!C||(y||(y={}),y[x]=!0)}return{parent:v.parent,transformer:v.transformer.id,params:v.params?g(v.params):void 0,state:y,tags:v.tags,ref:v.ref,dependsOn:v.dependsOn,version:v.version}}e.toJSON=h;function m(v){var g=gt.get(v.transformer),y=g.definition.customSerialization?g.definition.customSerialization.fromJSON:p;return{parent:v.parent,transformer:g,params:v.params?y(v.params):void 0,state:v.state||{},tags:v.tags,ref:v.ref,dependsOn:v.dependsOn,version:v.version}}e.fromJSON=m})(vr||(vr={}));function nc(e){for(var t=-1/0,r=0,n=e.length;r<n;++r)e[r]>t&&(t=e[r]);return t}function Uw(e){for(var t=1/0,r=0,n=e.length;r<n;++r)e[r]<t&&(t=e[r]);return t}function ss(e){for(var t=1/0,r=-1/0,n=0,a=e.length;n<a;++n)e[n]<t&&(t=e[n]),e[n]>r&&(r=e[n]);return[t,r]}function Ly(e,t,r){t===void 0&&(t=1),r===void 0&&(r=0);for(var n=e.length,a=0,i=r;i<n;i+=t)a+=e[i];return a}function Vw(e,t,r){return t===void 0&&(t=1),r===void 0&&(r=0),Ly(e,t,r)/(e.length/t)}function Hw(e){for(var t=e.length,r=0,n=0;n<t;++n){var a=e[n];r+=a*a}return Math.sqrt(r/t)}function pu(e,t){for(var r=0,n=t?Math.min(t,e.length):e.length;r<n;++r)e[r]=r;return e}function A1(e,t){for(var r=0,n=e.length,a=!1;r<n;r++)if(e[r]===t){a=!0;break}return a?(T1(e,r),!0):!1}function T1(e,t){for(var r=t,n=e.length-1;r<n;r++)e[r]=e[r+1];e.pop()}function ho(e,t){return e.indexOf(t)>=0?!1:(e.push(t),!0)}function Uh(e,t){var r=e.indexOf(t);if(r<0)return!1;for(var n=r,a=e.length-1;n<a;n++)e[n]=e[n+1];return e.pop(),!0}function XD(e,t){if(!e||e.length===0)return!t||t.length===0;if(!t)return!1;var r=e.length;if(r!==t.length)return!1;for(var n=0;n<r;n++)if(e[n]!==t[n])return!1;return!0}function Kye(e){for(var t=0,r=e.length;t<r;t++)if(e[t]!==t)return!1;return!0}function $ye(e,t,r){for(var n=0,a=e.length;n<a;++n)if(e[n][0]===t){e[n][1]=r;return}e.push([t,r])}var Qye=function(){function e(t){this.tree=t,this.transforms=this.tree.transforms,this.children=this.tree.children,this.dependencies=this.tree.dependencies,this.changedNodes=!1,this.changedChildren=!1,this.changedDependencies=!1,this._childMutations=void 0,this._dependencyMutations=void 0,this._stateUpdates=void 0}return Object.defineProperty(e.prototype,"childMutations",{get:function(){return this._childMutations?this._childMutations:(this._childMutations=new Map,this._childMutations)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dependencyMutations",{get:function(){return this._dependencyMutations?this._dependencyMutations:(this._dependencyMutations=new Map,this._dependencyMutations)},enumerable:!1,configurable:!0}),e.prototype.changeNodes=function(){this.changedNodes||(this.changedNodes=!0,this.transforms=this.transforms.asMutable())},e.prototype.changeChildren=function(){this.changedChildren||(this.changedChildren=!0,this.children=this.children.asMutable())},e.prototype.changeDependencies=function(){this.changedDependencies||(this.changedDependencies=!0,this.dependencies=this.dependencies.asMutable())},Object.defineProperty(e.prototype,"root",{get:function(){return this.transforms.get(vr.RootRef)},enumerable:!1,configurable:!0}),e.prototype.asTransient=function(){return this.asImmutable().asTransient()},e.prototype.addChild=function(t,r){if(this.changeChildren(),this.childMutations.has(t))this.childMutations.get(t).add(r);else{var n=this.children.get(t).asMutable();n.add(r),this.children.set(t,n),this.childMutations.set(t,n)}},e.prototype.removeChild=function(t,r){if(this.changeChildren(),this.childMutations.has(t))this.childMutations.get(t).remove(r);else{var n=this.children.get(t).asMutable();n.remove(r),this.children.set(t,n),this.childMutations.set(t,n)}},e.prototype.clearRoot=function(){var t=vr.RootRef;if(this.children.get(t).size!==0){this.changeChildren();var r=ma.exports.OrderedSet();this.children.set(t,r),this.childMutations.set(t,r)}},e.prototype.mutateDependency=function(t,r,n){var a=this.dependencyMutations.get(t);if(!a){var i=this.dependencies.get(t);if(!i&&n==="remove")return;this.changeDependencies(),a=i?i.asMutable():ma.exports.OrderedSet().asMutable(),this.dependencyMutations.set(t,a),this.dependencies.set(t,a)}n==="add"?a.add(r):a.remove(r)},e.prototype.changeParent=function(t,r){R2(this.transforms,t);var n=this.transforms.get(t);this.removeChild(n.parent,t),this.addChild(r,t),this.changeNodes(),this.transforms.set(t,vr.withParent(n,r))},e.prototype.add=function(t){var r=t.ref;if(this.transforms.has(t.ref)){var n=this.transforms.get(t.ref);n.parent!==t.parent&&e1e(t.ref)}var a=this.children.get(t.parent);if(a||t1e(t.parent),a.has(t.ref)||this.addChild(t.parent,t.ref),this.children.has(t.ref)||(this.changedChildren||(this.changedChildren=!0,this.children=this.children.asMutable()),this.children.set(t.ref,ma.exports.OrderedSet())),this.changeNodes(),this.transforms.set(r,t),t.dependsOn)for(var i=0,o=t.dependsOn;i<o.length;i++){var s=o[i];this.mutateDependency(s,r,"add")}return this},e.prototype.setParams=function(t,r){R2(this.transforms,t);var n=this.transforms.get(t);return LD(n.params,r)?!1:(this.changedNodes||(this.changedNodes=!0,this.transforms=this.transforms.asMutable()),this.transforms.set(n.ref,vr.withParams(n,r)),!0)},e.prototype.setTags=function(t,r){R2(this.transforms,t);var n=this.transforms.get(t),a=vr.withParams(n,r);return XD(n.tags,a.tags)?!1:(this.changedNodes||(this.changedNodes=!0,this.transforms=this.transforms.asMutable()),this.transforms.set(n.ref,a),!0)},e.prototype.assignState=function(t,r){R2(this.transforms,t);var n=this.transforms.get(t);if(this._stateUpdates&&this._stateUpdates.has(t))return vr.assignState(n.state,r),n;this._stateUpdates||(this._stateUpdates=new Set),this._stateUpdates.add(n.ref),this.changeNodes();var a=vr.withState(n,r);return this.transforms.set(t,a),a},e.prototype.remove=function(t){var r=this.transforms.get(t);if(!r)return[];var n=xa.subtreePostOrder(this,r);if(t===vr.RootRef){if(n.pop(),n.length===0)return n;this.clearRoot()}else{if(n.length===0)return n;this.removeChild(r.parent,r.ref)}this.changeNodes(),this.changeChildren();for(var a=0,i=n;a<i.length;a++){var o=i[a];this.transforms.delete(o.ref),this.children.delete(o.ref),this._childMutations&&this._childMutations.delete(o.ref)}for(var s=[],u=0,l=n;u<l.length;u++){var o=l[u];if(o.dependsOn)for(var c=0,d=o.dependsOn;c<d.length;c++){var f=d[c];!this.transforms.has(f)||this.mutateDependency(f,o.ref,"remove")}if(this.dependencies.has(o.ref)){var p=this.dependencies.get(o.ref).toArray();this.changeDependencies(),this.dependencies.delete(o.ref),this._dependencyMutations&&this._dependencyMutations.delete(o.ref);for(var h=0,m=p;h<m.length;h++){var v=m[h];if(!!this.transforms.has(v))for(var g=0,y=this.remove(v);g<y.length;g++){var b=y[g];s[s.length]=b}}}}for(var S=0,x=s;S<x.length;S++){var v=x[S];n[n.length]=v}return n},e.prototype.asImmutable=function(){return!this.changedNodes&&!this.changedChildren&&!this._childMutations?this.tree:(this._childMutations&&this._childMutations.forEach(Zye,this.children),this._dependencyMutations&&this._dependencyMutations.forEach(Jye,this.dependencies),xa.create(this.changedNodes?this.transforms.asImmutable():this.transforms,this.changedChildren?this.children.asImmutable():this.children,this.changedDependencies?this.dependencies.asImmutable():this.dependencies))},e}();function Zye(e,t){this.set(t,e.asImmutable())}function Jye(e,t){e.size===0?this.delete(t):this.set(t,e.asImmutable())}function e1e(e){throw new Error("Transform '"+e+"' is already present in the tree.")}function t1e(e){throw new Error("Parent '"+e+"' must be present in the tree.")}function R2(e,t){if(!e.has(t))throw new Error("Node '"+t+"' is not present in the tree.")}var xa;(function(e){var t=function(){function b(S,x,C){this.transforms=S,this.children=x,this.dependencies=C}return Object.defineProperty(b.prototype,"root",{get:function(){return this.transforms.get(vr.RootRef)},enumerable:!1,configurable:!0}),b.prototype.asTransient=function(){return new Qye(this)},b}();function r(b){var S=b||vr.createRoot();return n(ma.exports.Map([[S.ref,S]]),ma.exports.Map([[S.ref,ma.exports.OrderedSet()]]),ma.exports.Map())}e.createEmpty=r;function n(b,S,x){return new t(b,S,x)}e.create=n;function a(b){i(this,this.tree.transforms.get(b))}function i(b,S){var x=b.tree.children.get(S.ref);x&&x.size&&x.forEach(a,b),b.f(S,b.tree,b.state)}function o(b,S,x,C){var w={tree:b,state:x,f:C};return i(w,S),w.state}e.doPostOrder=o;function s(b){u(this,this.tree.transforms.get(b))}function u(b,S){var x=b.f(S,b.tree,b.state);if(!(typeof x=="boolean"&&!x)){var C=b.tree.children.get(S.ref);C&&C.size&&C.forEach(s,b)}}function l(b,S,x,C){var w={tree:b,state:x,f:C};return u(w,S),w.state}e.doPreOrder=l;function c(b,S,x){x.push(b)}function d(b,S){return o(b,S,[],c)}e.subtreePostOrder=d;function f(b,S,x){x.push(vr.toJSON(b))}function p(b){var S=[];return l(b,b.root,S,f),{transforms:S}}e.toJSON=p;function h(b){for(var S=ma.exports.Map().asMutable(),x=ma.exports.Map().asMutable(),C=ma.exports.Map().asMutable(),w=0,_=b.transforms;w<_.length;w++){var E=_[w],P=vr.fromJSON(E);S.set(P.ref,P),x.has(P.ref)||x.set(P.ref,ma.exports.OrderedSet().asMutable()),P.ref!==P.parent&&x.get(P.parent).add(P.ref)}for(var D=new Set,k=0,F=b.transforms;k<F.length;k++){var E=F[k],X=E.ref;if(x.set(X,x.get(X).asImmutable()),!!E.dependsOn)for(var U=0,j=E.dependsOn;U<j.length;U++){var te=j[U];D.add(te),C.has(te)?C.get(te).add(X):C.set(te,ma.exports.OrderedSet([X]).asMutable())}}return D.forEach(function(q){C.set(q,C.get(q).asImmutable())}),n(S.asImmutable(),x.asImmutable(),C.asImmutable())}e.fromJSON=h;function m(b){console.log({tr:b.transforms.keySeq().toArray(),tr1:b.transforms.valueSeq().toArray().map(function(S){return S.ref}),ch:b.children.keySeq().toArray()})}e.dump=m;function v(b,S,x){if(S===x)return!0;for(var C=b.children.get(S),w=C.values();;){var _=w.next();if(_.done)return!1;if(v(b,_.value,x))return!0}}function g(b,S,x){return!b.transforms.has(S)||!b.transforms.has(x)?!1:v(b,S,x)}e.subtreeHasRef=g;function y(b,S){var x=b.children.get(S);if(x.size!==1)return S;var C=b.transforms.get(x.first());return C.transformer.definition.isDecorator?y(b,C.ref):S}e.getDecoratorRoot=y})(xa||(xa={}));var lr;(function(e){function t(R,Y){return r(R)(Y)}e.select=t;function r(R){var Y=R||l.root,re;return a(Y)?re=Y.compile():n(Y)?re=l.byValue(Y).compile():i(Y)?re=Y:re=l.byRef(Y).compile(),re}e.compile=r;function n(R){return R.transform!==void 0&&R.status!==void 0}function a(R){return R.compile!==void 0}function i(R){return typeof R=="function"}var o={select:function(R){return t(this,R||this.state)}};function s(R,Y){o[R]=function(){for(var re=[],K=0;K<arguments.length;K++)re[K]=arguments[K];return Y.call.apply(Y,Gt([void 0,this],re))}}function u(R){return Object.create(o,{compile:{writable:!1,configurable:!1,value:R}})}var l;(function(R){R.root=u(function(){return function(ie){return[ie.cells.get(ie.tree.root.ref)]}});function Y(){for(var ie=[],le=0;le<arguments.length;le++)ie[le]=arguments[le];return u(function(){return function(O){for(var G=[],ve=0,we=ie;ve<we.length;ve++){var Te=we[ve],Ue=O.cells.get(Te);!Ue||G.push(Ue)}return G}})}R.byRef=Y;function re(){for(var ie=[],le=0;le<arguments.length;le++)ie[le]=arguments[le];return u(function(){return function(O){return ie}})}R.byValue=re;function K(ie,le){return le===void 0&&(le=vr.RootRef),u(function(){return function(O){var G={roots:[],cells:O.cells,type:ie.type};return xa.doPreOrder(O.tree,O.tree.transforms.get(le),G,fe),G.roots}})}R.rootsOfType=K;function L(ie,le){return le===void 0&&(le=vr.RootRef),u(function(){return function(O){var G={ret:[],cells:O.cells,type:ie.type};return xa.doPreOrder(O.tree,O.tree.transforms.get(le),G,me),G.ret}})}R.ofType=L;function H(ie,le){return le===void 0&&(le=vr.RootRef),u(function(){return function(O){var G={ret:[],cells:O.cells,t:ie};return xa.doPreOrder(O.tree,O.tree.transforms.get(le),G,xe),G.ret}})}R.ofTransformer=H;function Z(ie,le){return le===void 0&&(le=vr.RootRef),u(function(){return function(O){var G={ret:[],cells:O.cells,t:ie};return xa.doPreOrder(O.tree,O.tree.transforms.get(le),G,Se),G.ret}})}R.ofTransformerWithError=Z;function fe(ie,le,O){var G=O.cells.get(ie.ref);return G&&G.obj&&G.obj.type===O.type?(O.roots.push(G),!1):!0}function me(ie,le,O){var G=O.cells.get(ie.ref);return G&&G.obj&&G.obj.type===O.type&&O.ret.push(G),!0}function xe(ie,le,O){var G=O.cells.get(ie.ref);return G&&G.obj&&G.transform.transformer===O.t&&O.ret.push(G),!0}function Se(ie,le,O){var G=O.cells.get(ie.ref);return G&&G.status==="error"&&G.transform.transformer===O.t&&O.ret.push(G),!0}})(l=e.Generators||(e.Generators={})),s("flatMap",c);function c(R,Y){var re=r(R);return u(function(){return function(K){for(var L=[],H=0,Z=re(K);H<Z.length;H++)for(var fe=Z[H],me=0,xe=Y(fe,K);me<xe.length;me++){var Se=xe[me];L.push(Se)}return L}})}e.flatMap=c,s("mapObject",d);function d(R,Y){var re=r(R);return u(function(){return function(K){for(var L=[],H=0,Z=re(K);H<Z.length;H++){var fe=Z[H],me=Y(fe,K);me&&L.push(me)}return L}})}e.mapObject=d,s("unique",f);function f(R){var Y=r(R);return u(function(){return function(re){for(var K=new Set,L=[],H=0,Z=Y(re);H<Z.length;H++){var fe=Z[H];!fe||K.has(fe.transform.ref)||(K.add(fe.transform.ref),L.push(fe))}return L}})}e.unique=f,s("first",p);function p(R){var Y=r(R);return u(function(){return function(re){var K=Y(re);return K.length?[K[0]]:[]}})}e.first=p,s("filter",h);function h(R,Y){return c(R,function(re){return Y(re)?[re]:[]})}e.filter=h,s("withStatus",m);function m(R,Y){return h(R,function(re){return re.status===Y})}e.withStatus=m,s("withTag",v);function v(R,Y){return h(R,function(re){return!!re.transform.tags&&re.transform.tags.indexOf(Y)>=0})}e.withTag=v,s("subtree",g);function g(R){return c(R,function(Y,re){var K=[];return xa.doPreOrder(re.tree,re.tree.transforms.get(Y.transform.ref),K,function(L,H,Z){Z.push(L.ref)}),K.map(function(L){return re.cells.get(L)})})}e.subtree=g,s("children",y);function y(R){return c(R,function(Y,re){var K=[];return re.tree.children.get(Y.transform.ref).forEach(function(L){return K.push(re.cells.get(L))}),K})}e.children=y,s("ofType",b);function b(R,Y){return h(R,function(re){return re.obj?re.obj.type===Y.type:!1})}e.ofType=b,s("ancestor",S);function S(R,Y){return f(d(R,function(re,K){return k(K.tree,K.cells,re.transform.ref,Y)}))}e.ancestor=S,s("ancestorOfType",x);function x(R,Y){return f(d(R,function(re,K){return U(K.tree,K.cells,re.transform.ref,Y)}))}e.ancestorOfType=x,s("ancestorWithTransformer",C);function C(R,Y){return f(d(R,function(re,K){return X(K.tree,K.cells,re.transform.ref,Y)}))}e.ancestorWithTransformer=C,s("withTransformer",w);function w(R,Y){return h(R,function(re){return re.transform.transformer===Y})}e.withTransformer=w,s("root",_);function _(R,Y){return f(d(R,function(re,K){return F(K.tree,K.cells,re.transform.ref,Y)}))}e.root=_,s("rootOfType",E);function E(R,Y){return f(d(R,function(re,K){return j(K.tree,K.cells,re.transform.ref,Y)}))}e.rootOfType=E,s("parent",P);function P(R){return f(d(R,function(Y,re){return re.cells.get(re.tree.transforms.get(Y.transform.ref).parent)}))}e.parent=P;function D(R,Y,re,K,L){for(var H=R.transforms.get(re),Z=void 0;;){H=R.transforms.get(H.parent);var fe=Y.get(H.ref);if(fe.obj&&K(fe)&&(Z=fe,L)||H.ref===vr.RootRef)return Z}}function k(R,Y,re,K){return D(R,Y,re,K,!0)}e.findAncestor=k;function F(R,Y,re,K){return D(R,Y,re,K,!1)}e.findRoot=F;function X(R,Y,re,K){return k(R,Y,re,Array.isArray(K)?function(L){return K.indexOf(L.transform.transformer)>=0}:function(L){return L.transform.transformer===K})}e.findAncestorWithTransformer=X;function U(R,Y,re,K){return k(R,Y,re,te(K))}e.findAncestorOfType=U;function j(R,Y,re,K){return F(R,Y,re,te(K))}e.findRootOfType=j;function te(R){return Array.isArray(R)?function(Y){for(var re=0,K=R;re<K.length;re++){var L=K[re];if(L.type===Y.obj.type)return!0}}:function(Y){return Y.obj.type===R.type}}function q(R,Y,re){return xa.doPreOrder(R,R.transforms.get(Y),{refs:{},tags:re},W).refs}e.findUniqueTagsInSubtree=q;function W(R,Y,re){if(R.tags)for(var K=0,L=R.tags;K<L.length;K++){var H=L[K];if(!!re.tags.has(H)){re.refs[H]=R.ref;break}}return!0}function V(R,Y,re){return xa.doPreOrder(R,R.transforms.get(Y),{ref:void 0,tag:re},ee).ref}e.findTagInSubtree=V;function ee(R,Y,re){return R.tags&&R.tags.indexOf(re.tag)>=0?(re.ref=R.ref,!1):!0}function ue(R,Y,re){return xa.doPreOrder(R,R.transforms.get(Y),{refs:[],tags:re},$).refs}e.findWithAllTags=ue;function $(R,Y,re){if(R.tags)for(var K=re.tags.size,L=0,H=0,Z=R.tags;H<Z.length;H++){var fe=Z[H];if(!!re.tags.has(fe)&&(L++,L===K)){re.refs.push(R);break}}else re.tags.size===0&&re.refs.push(R)}function Q(R,Y,re){var K=R.transforms.get(Y);if(K.transformer===re)return R.cells.get(Y);var L=R.tree.children.get(Y);if(L.size===1){var H=L.first();if(R.transforms.get(H).transformer.definition.isDecorator)return Q(R,H,re)}}e.tryFindDecorator=Q})(lr||(lr={}));/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var jP=function(e,t){return jP=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)n.hasOwnProperty(a)&&(r[a]=n[a])},jP(e,t)};function Fi(e,t){jP(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}function GP(e){return typeof e=="function"}var iF=!1,Bl={Promise:void 0,set useDeprecatedSynchronousErrorHandling(e){if(e){var t=new Error;""+t.stack}iF=e},get useDeprecatedSynchronousErrorHandling(){return iF}};function Dv(e){setTimeout(function(){throw e},0)}var SC={closed:!0,next:function(e){},error:function(e){if(Bl.useDeprecatedSynchronousErrorHandling)throw e;Dv(e)},complete:function(){}},r1e=function(){return Array.isArray||function(e){return e&&typeof e.length=="number"}}();function Bq(e){return e!==null&&typeof e=="object"}var n1e=function(){function e(t){return Error.call(this),this.message=t?t.length+` errors occurred during unsubscription:
`+t.map(function(r,n){return n+1+") "+r.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=t,this}return e.prototype=Object.create(Error.prototype),e}(),lS=n1e,ac=function(){function e(t){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,t&&(this._ctorUnsubscribe=!0,this._unsubscribe=t)}return e.prototype.unsubscribe=function(){var t;if(!this.closed){var r=this,n=r._parentOrParents,a=r._ctorUnsubscribe,i=r._unsubscribe,o=r._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,n instanceof e)n.remove(this);else if(n!==null)for(var s=0;s<n.length;++s){var u=n[s];u.remove(this)}if(GP(i)){a&&(this._unsubscribe=void 0);try{i.call(this)}catch(d){t=d instanceof lS?oF(d.errors):[d]}}if(r1e(o))for(var s=-1,l=o.length;++s<l;){var c=o[s];if(Bq(c))try{c.unsubscribe()}catch(f){t=t||[],f instanceof lS?t=t.concat(oF(f.errors)):t.push(f)}}if(t)throw new lS(t)}},e.prototype.add=function(t){var r=t;if(!t)return e.EMPTY;switch(typeof t){case"function":r=new e(t);case"object":if(r===this||r.closed||typeof r.unsubscribe!="function")return r;if(this.closed)return r.unsubscribe(),r;if(!(r instanceof e)){var n=r;r=new e,r._subscriptions=[n]}break;default:throw new Error("unrecognized teardown "+t+" added to Subscription.")}var a=r._parentOrParents;if(a===null)r._parentOrParents=this;else if(a instanceof e){if(a===this)return r;r._parentOrParents=[a,this]}else if(a.indexOf(this)===-1)a.push(this);else return r;var i=this._subscriptions;return i===null?this._subscriptions=[r]:i.push(r),r},e.prototype.remove=function(t){var r=this._subscriptions;if(r){var n=r.indexOf(t);n!==-1&&r.splice(n,1)}},e.EMPTY=function(t){return t.closed=!0,t}(new e),e}();function oF(e){return e.reduce(function(t,r){return t.concat(r instanceof lS?r.errors:r)},[])}var CC=function(){return typeof Symbol=="function"?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random()}(),ou=function(e){Fi(t,e);function t(r,n,a){var i=e.call(this)||this;switch(i.syncErrorValue=null,i.syncErrorThrown=!1,i.syncErrorThrowable=!1,i.isStopped=!1,arguments.length){case 0:i.destination=SC;break;case 1:if(!r){i.destination=SC;break}if(typeof r=="object"){r instanceof t?(i.syncErrorThrowable=r.syncErrorThrowable,i.destination=r,r.add(i)):(i.syncErrorThrowable=!0,i.destination=new sF(i,r));break}default:i.syncErrorThrowable=!0,i.destination=new sF(i,r,n,a);break}return i}return t.prototype[CC]=function(){return this},t.create=function(r,n,a){var i=new t(r,n,a);return i.syncErrorThrowable=!1,i},t.prototype.next=function(r){this.isStopped||this._next(r)},t.prototype.error=function(r){this.isStopped||(this.isStopped=!0,this._error(r))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this))},t.prototype._next=function(r){this.destination.next(r)},t.prototype._error=function(r){this.destination.error(r),this.unsubscribe()},t.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},t.prototype._unsubscribeAndRecycle=function(){var r=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=r,this},t}(ac),sF=function(e){Fi(t,e);function t(r,n,a,i){var o=e.call(this)||this;o._parentSubscriber=r;var s,u=o;return GP(n)?s=n:n&&(s=n.next,a=n.error,i=n.complete,n!==SC&&(u=Object.create(n),GP(u.unsubscribe)&&o.add(u.unsubscribe.bind(u)),u.unsubscribe=o.unsubscribe.bind(o))),o._context=u,o._next=s,o._error=a,o._complete=i,o}return t.prototype.next=function(r){if(!this.isStopped&&this._next){var n=this._parentSubscriber;!Bl.useDeprecatedSynchronousErrorHandling||!n.syncErrorThrowable?this.__tryOrUnsub(this._next,r):this.__tryOrSetError(n,this._next,r)&&this.unsubscribe()}},t.prototype.error=function(r){if(!this.isStopped){var n=this._parentSubscriber,a=Bl.useDeprecatedSynchronousErrorHandling;if(this._error)!a||!n.syncErrorThrowable?(this.__tryOrUnsub(this._error,r),this.unsubscribe()):(this.__tryOrSetError(n,this._error,r),this.unsubscribe());else if(n.syncErrorThrowable)a?(n.syncErrorValue=r,n.syncErrorThrown=!0):Dv(r),this.unsubscribe();else{if(this.unsubscribe(),a)throw r;Dv(r)}}},t.prototype.complete=function(){var r=this;if(!this.isStopped){var n=this._parentSubscriber;if(this._complete){var a=function(){return r._complete.call(r._context)};!Bl.useDeprecatedSynchronousErrorHandling||!n.syncErrorThrowable?(this.__tryOrUnsub(a),this.unsubscribe()):(this.__tryOrSetError(n,a),this.unsubscribe())}else this.unsubscribe()}},t.prototype.__tryOrUnsub=function(r,n){try{r.call(this._context,n)}catch(a){if(this.unsubscribe(),Bl.useDeprecatedSynchronousErrorHandling)throw a;Dv(a)}},t.prototype.__tryOrSetError=function(r,n,a){if(!Bl.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{n.call(this._context,a)}catch(i){return Bl.useDeprecatedSynchronousErrorHandling?(r.syncErrorValue=i,r.syncErrorThrown=!0,!0):(Dv(i),!0)}return!1},t.prototype._unsubscribe=function(){var r=this._parentSubscriber;this._context=null,this._parentSubscriber=null,r.unsubscribe()},t}(ou);function a1e(e){for(;e;){var t=e,r=t.closed,n=t.destination,a=t.isStopped;if(r||a)return!1;n&&n instanceof ou?e=n:e=null}return!0}function i1e(e,t,r){if(e){if(e instanceof ou)return e;if(e[CC])return e[CC]()}return!e&&!t&&!r?new ou(SC):new ou(e,t,r)}var fb=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function Fq(e){return e}function o1e(e){return e.length===0?Fq:e.length===1?e[0]:function(r){return e.reduce(function(n,a){return a(n)},r)}}var xs=function(){function e(t){this._isScalar=!1,t&&(this._subscribe=t)}return e.prototype.lift=function(t){var r=new e;return r.source=this,r.operator=t,r},e.prototype.subscribe=function(t,r,n){var a=this.operator,i=i1e(t,r,n);if(a?i.add(a.call(i,this.source)):i.add(this.source||Bl.useDeprecatedSynchronousErrorHandling&&!i.syncErrorThrowable?this._subscribe(i):this._trySubscribe(i)),Bl.useDeprecatedSynchronousErrorHandling&&i.syncErrorThrowable&&(i.syncErrorThrowable=!1,i.syncErrorThrown))throw i.syncErrorValue;return i},e.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(r){Bl.useDeprecatedSynchronousErrorHandling&&(t.syncErrorThrown=!0,t.syncErrorValue=r),a1e(t)?t.error(r):console.warn(r)}},e.prototype.forEach=function(t,r){var n=this;return r=uF(r),new r(function(a,i){var o;o=n.subscribe(function(s){try{t(s)}catch(u){i(u),o&&o.unsubscribe()}},i,a)})},e.prototype._subscribe=function(t){var r=this.source;return r&&r.subscribe(t)},e.prototype[fb]=function(){return this},e.prototype.pipe=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return t.length===0?this:o1e(t)(this)},e.prototype.toPromise=function(t){var r=this;return t=uF(t),new t(function(n,a){var i;r.subscribe(function(o){return i=o},function(o){return a(o)},function(){return n(i)})})},e.create=function(t){return new e(t)},e}();function uF(e){if(e||(e=Promise),!e)throw new Error("no Promise impl found");return e}var s1e=function(){function e(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return e.prototype=Object.create(Error.prototype),e}(),fv=s1e,u1e=function(e){Fi(t,e);function t(r,n){var a=e.call(this)||this;return a.subject=r,a.subscriber=n,a.closed=!1,a}return t.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var r=this.subject,n=r.observers;if(this.subject=null,!(!n||n.length===0||r.isStopped||r.closed)){var a=n.indexOf(this.subscriber);a!==-1&&n.splice(a,1)}}},t}(ac),l1e=function(e){Fi(t,e);function t(r){var n=e.call(this,r)||this;return n.destination=r,n}return t}(ou),ha=function(e){Fi(t,e);function t(){var r=e.call(this)||this;return r.observers=[],r.closed=!1,r.isStopped=!1,r.hasError=!1,r.thrownError=null,r}return t.prototype[CC]=function(){return new l1e(this)},t.prototype.lift=function(r){var n=new lF(this,this);return n.operator=r,n},t.prototype.next=function(r){if(this.closed)throw new fv;if(!this.isStopped)for(var n=this.observers,a=n.length,i=n.slice(),o=0;o<a;o++)i[o].next(r)},t.prototype.error=function(r){if(this.closed)throw new fv;this.hasError=!0,this.thrownError=r,this.isStopped=!0;for(var n=this.observers,a=n.length,i=n.slice(),o=0;o<a;o++)i[o].error(r);this.observers.length=0},t.prototype.complete=function(){if(this.closed)throw new fv;this.isStopped=!0;for(var r=this.observers,n=r.length,a=r.slice(),i=0;i<n;i++)a[i].complete();this.observers.length=0},t.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},t.prototype._trySubscribe=function(r){if(this.closed)throw new fv;return e.prototype._trySubscribe.call(this,r)},t.prototype._subscribe=function(r){if(this.closed)throw new fv;return this.hasError?(r.error(this.thrownError),ac.EMPTY):this.isStopped?(r.complete(),ac.EMPTY):(this.observers.push(r),new u1e(this,r))},t.prototype.asObservable=function(){var r=new xs;return r.source=this,r},t.create=function(r,n){return new lF(r,n)},t}(xs),lF=function(e){Fi(t,e);function t(r,n){var a=e.call(this)||this;return a.destination=r,a.source=n,a}return t.prototype.next=function(r){var n=this.destination;n&&n.next&&n.next(r)},t.prototype.error=function(r){var n=this.destination;n&&n.error&&this.destination.error(r)},t.prototype.complete=function(){var r=this.destination;r&&r.complete&&this.destination.complete()},t.prototype._subscribe=function(r){var n=this.source;return n?this.source.subscribe(r):ac.EMPTY},t}(ha),Wf=function(e){Fi(t,e);function t(r){var n=e.call(this)||this;return n._value=r,n}return Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),t.prototype._subscribe=function(r){var n=e.prototype._subscribe.call(this,r);return n&&!n.closed&&r.next(this._value),n},t.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new fv;return this._value},t.prototype.next=function(r){e.prototype.next.call(this,this._value=r)},t}(ha),c1e=function(e){Fi(t,e);function t(r,n){return e.call(this)||this}return t.prototype.schedule=function(r,n){return this},t}(ac),d1e=function(e){Fi(t,e);function t(r,n){var a=e.call(this,r,n)||this;return a.scheduler=r,a.work=n,a.pending=!1,a}return t.prototype.schedule=function(r,n){if(n===void 0&&(n=0),this.closed)return this;this.state=r;var a=this.id,i=this.scheduler;return a!=null&&(this.id=this.recycleAsyncId(i,a,n)),this.pending=!0,this.delay=n,this.id=this.id||this.requestAsyncId(i,this.id,n),this},t.prototype.requestAsyncId=function(r,n,a){return a===void 0&&(a=0),setInterval(r.flush.bind(r,this),a)},t.prototype.recycleAsyncId=function(r,n,a){if(a===void 0&&(a=0),a!==null&&this.delay===a&&this.pending===!1)return n;clearInterval(n)},t.prototype.execute=function(r,n){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var a=this._execute(r,n);if(a)return a;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(r,n){var a=!1,i=void 0;try{this.work(r)}catch(o){a=!0,i=!!o&&o||new Error(o)}if(a)return this.unsubscribe(),i},t.prototype._unsubscribe=function(){var r=this.id,n=this.scheduler,a=n.actions,i=a.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,i!==-1&&a.splice(i,1),r!=null&&(this.id=this.recycleAsyncId(n,r,null)),this.delay=null},t}(c1e),cF=function(){function e(t,r){r===void 0&&(r=e.now),this.SchedulerAction=t,this.now=r}return e.prototype.schedule=function(t,r,n){return r===void 0&&(r=0),new this.SchedulerAction(this,t).schedule(n,r)},e.now=function(){return Date.now()},e}(),f1e=function(e){Fi(t,e);function t(r,n){n===void 0&&(n=cF.now);var a=e.call(this,r,function(){return t.delegate&&t.delegate!==a?t.delegate.now():n()})||this;return a.actions=[],a.active=!1,a.scheduled=void 0,a}return t.prototype.schedule=function(r,n,a){return n===void 0&&(n=0),t.delegate&&t.delegate!==this?t.delegate.schedule(r,n,a):e.prototype.schedule.call(this,r,n,a)},t.prototype.flush=function(r){var n=this.actions;if(this.active){n.push(r);return}var a;this.active=!0;do if(a=r.execute(r.state,r.delay))break;while(r=n.shift());if(this.active=!1,a){for(;r=n.shift();)r.unsubscribe();throw a}},t}(cF),p1e=new xs(function(e){return e.complete()});function h1e(e){return e?m1e(e):p1e}function m1e(e){return new xs(function(t){return e.schedule(function(){return t.complete()})})}function v1e(e){return e&&typeof e.schedule=="function"}var Lq=function(e){return function(t){for(var r=0,n=e.length;r<n&&!t.closed;r++)t.next(e[r]);t.complete()}};function Nq(e,t){return new xs(function(r){var n=new ac,a=0;return n.add(t.schedule(function(){if(a===e.length){r.complete();return}r.next(e[a++]),r.closed||n.add(this.schedule())})),n})}function g1e(e,t){return t?Nq(e,t):new xs(Lq(e))}var y1e=new f1e(d1e),b1e=y1e,x1e=function(){function e(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return e.prototype=Object.create(Error.prototype),e}(),S1e=x1e;function C1e(e,t){return function(n){if(typeof e!="function")throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return n.lift(new w1e(e,t))}}var w1e=function(){function e(t,r){this.project=t,this.thisArg=r}return e.prototype.call=function(t,r){return r.subscribe(new _1e(t,this.project,this.thisArg))},e}(),_1e=function(e){Fi(t,e);function t(r,n,a){var i=e.call(this,r)||this;return i.project=n,i.count=0,i.thisArg=a||i,i}return t.prototype._next=function(r){var n;try{n=this.project.call(this.thisArg,r,this.count++)}catch(a){this.destination.error(a);return}this.destination.next(n)},t}(ou),A1e=function(e){return function(t){return e.then(function(r){t.closed||(t.next(r),t.complete())},function(r){return t.error(r)}).then(null,Dv),t}};function T1e(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var jw=T1e(),E1e=function(e){return function(t){var r=e[jw]();do{var n=void 0;try{n=r.next()}catch(a){return t.error(a),t}if(n.done){t.complete();break}if(t.next(n.value),t.closed)break}while(!0);return typeof r.return=="function"&&t.add(function(){r.return&&r.return()}),t}},P1e=function(e){return function(t){var r=e[fb]();if(typeof r.subscribe!="function")throw new TypeError("Provided object does not correctly implement Symbol.observable");return r.subscribe(t)}},zq=function(e){return e&&typeof e.length=="number"&&typeof e!="function"};function Uq(e){return!!e&&typeof e.subscribe!="function"&&typeof e.then=="function"}var Vq=function(e){if(!!e&&typeof e[fb]=="function")return P1e(e);if(zq(e))return Lq(e);if(Uq(e))return A1e(e);if(!!e&&typeof e[jw]=="function")return E1e(e);var t=Bq(e)?"an invalid object":"'"+e+"'",r="You provided "+t+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.";throw new TypeError(r)};function I1e(e,t){return new xs(function(r){var n=new ac;return n.add(t.schedule(function(){var a=e[fb]();n.add(a.subscribe({next:function(i){n.add(t.schedule(function(){return r.next(i)}))},error:function(i){n.add(t.schedule(function(){return r.error(i)}))},complete:function(){n.add(t.schedule(function(){return r.complete()}))}}))})),n})}function M1e(e,t){return new xs(function(r){var n=new ac;return n.add(t.schedule(function(){return e.then(function(a){n.add(t.schedule(function(){r.next(a),n.add(t.schedule(function(){return r.complete()}))}))},function(a){n.add(t.schedule(function(){return r.error(a)}))})})),n})}function D1e(e,t){if(!e)throw new Error("Iterable cannot be null");return new xs(function(r){var n=new ac,a;return n.add(function(){a&&typeof a.return=="function"&&a.return()}),n.add(t.schedule(function(){a=e[jw](),n.add(t.schedule(function(){if(!r.closed){var i,o;try{var s=a.next();i=s.value,o=s.done}catch(u){r.error(u);return}o?r.complete():(r.next(i),this.schedule())}}))})),n})}function k1e(e){return e&&typeof e[fb]=="function"}function R1e(e){return e&&typeof e[jw]=="function"}function O1e(e,t){if(e!=null){if(k1e(e))return I1e(e,t);if(Uq(e))return M1e(e,t);if(zq(e))return Nq(e,t);if(R1e(e)||typeof e=="string")return D1e(e,t)}throw new TypeError((e!==null&&typeof e||e)+" is not observable")}function B1e(e,t){return t?O1e(e,t):e instanceof xs?e:new xs(Vq(e))}var F1e=function(e){Fi(t,e);function t(r){var n=e.call(this)||this;return n.parent=r,n}return t.prototype._next=function(r){this.parent.notifyNext(r)},t.prototype._error=function(r){this.parent.notifyError(r),this.unsubscribe()},t.prototype._complete=function(){this.parent.notifyComplete(),this.unsubscribe()},t}(ou),L1e=function(e){Fi(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.notifyNext=function(r){this.destination.next(r)},t.prototype.notifyError=function(r){this.destination.error(r)},t.prototype.notifyComplete=function(){this.destination.complete()},t}(ou);function N1e(e,t){if(!t.closed){if(e instanceof xs)return e.subscribe(t);var r;try{r=Vq(e)(t)}catch(n){t.error(n)}return r}}function Hq(e,t,r){return r===void 0&&(r=Number.POSITIVE_INFINITY),typeof t=="function"?function(n){return n.pipe(Hq(function(a,i){return B1e(e(a,i)).pipe(C1e(function(o,s){return t(a,o,i,s)}))},r))}:(typeof t=="number"&&(r=t),function(n){return n.lift(new z1e(e,r))})}var z1e=function(){function e(t,r){r===void 0&&(r=Number.POSITIVE_INFINITY),this.project=t,this.concurrent=r}return e.prototype.call=function(t,r){return r.subscribe(new U1e(t,this.project,this.concurrent))},e}(),U1e=function(e){Fi(t,e);function t(r,n,a){a===void 0&&(a=Number.POSITIVE_INFINITY);var i=e.call(this,r)||this;return i.project=n,i.concurrent=a,i.hasCompleted=!1,i.buffer=[],i.active=0,i.index=0,i}return t.prototype._next=function(r){this.active<this.concurrent?this._tryNext(r):this.buffer.push(r)},t.prototype._tryNext=function(r){var n,a=this.index++;try{n=this.project(r,a)}catch(i){this.destination.error(i);return}this.active++,this._innerSub(n)},t.prototype._innerSub=function(r){var n=new F1e(this),a=this.destination;a.add(n);var i=N1e(r,n);i!==n&&a.add(i)},t.prototype._complete=function(){this.hasCompleted=!0,this.active===0&&this.buffer.length===0&&this.destination.complete(),this.unsubscribe()},t.prototype.notifyNext=function(r){this.destination.next(r)},t.prototype.notifyComplete=function(){var r=this.buffer;this.active--,r.length>0?this._next(r.shift()):this.active===0&&this.hasCompleted&&this.destination.complete()},t}(L1e);function V1e(e){return e===void 0&&(e=Number.POSITIVE_INFINITY),Hq(Fq,e)}function Vc(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=Number.POSITIVE_INFINITY,n=null,a=e[e.length-1];return v1e(a)?(n=e.pop(),e.length>1&&typeof e[e.length-1]=="number"&&(r=e.pop())):typeof a=="number"&&(r=e.pop()),n===null&&e.length===1&&e[0]instanceof xs?e[0]:V1e(r)(g1e(e,n))}function Gw(e,t){return function(n){return n.lift(new H1e(e,t))}}var H1e=function(){function e(t,r){this.predicate=t,this.thisArg=r}return e.prototype.call=function(t,r){return r.subscribe(new j1e(t,this.predicate,this.thisArg))},e}(),j1e=function(e){Fi(t,e);function t(r,n,a){var i=e.call(this,r)||this;return i.predicate=n,i.thisArg=a,i.count=0,i}return t.prototype._next=function(r){var n;try{n=this.predicate.call(this.thisArg,r,this.count++)}catch(a){this.destination.error(a);return}n&&this.destination.next(r)},t}(ou),pd;(function(e){function t(){var r=new G1e,n=function(){return r.create()};return n.dispose=function(){return r.dispose()},n.behavior=function(a){return r.behavior(a)},n}e.create=t})(pd||(pd={}));var G1e=function(){function e(){this._eventList=[],this._disposed=!1}return e.prototype.create=function(){var t=new ha;return this._eventList.push(t),t},e.prototype.behavior=function(t){var r=new Wf(t);return this._eventList.push(r),r},e.prototype.dispose=function(){if(!this._disposed){for(var t=0,r=this._eventList;t<r.length;t++){var n=r[t];n.complete()}this._disposed=!0}},e}();function Vu(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];throw Error("[Immer] minified error nr: "+e+(r.length?" "+r.map(function(a){return"'"+a+"'"}).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function h0(e){return!!e&&!!e[Ss]}function rm(e){return!!e&&(function(t){if(!t||typeof t!="object")return!1;var r=Object.getPrototypeOf(t);if(r===null)return!0;var n=Object.hasOwnProperty.call(r,"constructor")&&r.constructor;return typeof n=="function"&&Function.toString.call(n)===Z1e}(e)||Array.isArray(e)||!!e[yF]||!!e.constructor[yF]||YD(e)||KD(e))}function E1(e,t,r){r===void 0&&(r=!1),O0(e)===0?(r?Object.keys:ek)(e).forEach(function(n){r&&typeof n=="symbol"||t(n,e[n],e)}):e.forEach(function(n,a){return t(a,n,e)})}function O0(e){var t=e[Ss];return t?t.i>3?t.i-4:t.i:Array.isArray(e)?1:YD(e)?2:KD(e)?3:0}function qP(e,t){return O0(e)===2?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function q1e(e,t){return O0(e)===2?e.get(t):e[t]}function jq(e,t,r){var n=O0(e);n===2?e.set(t,r):n===3?(e.delete(t),e.add(r)):e[t]=r}function W1e(e,t){return e===t?e!==0||1/e==1/t:e!=e&&t!=t}function YD(e){return $1e&&e instanceof Map}function KD(e){return Q1e&&e instanceof Set}function mh(e){return e.o||e.t}function $D(e){if(Array.isArray(e))return Array.prototype.slice.call(e);var t=J1e(e);delete t[Ss];for(var r=ek(t),n=0;n<r.length;n++){var a=r[n],i=t[a];i.writable===!1&&(i.writable=!0,i.configurable=!0),(i.get||i.set)&&(t[a]={configurable:!0,writable:!0,enumerable:i.enumerable,value:e[a]})}return Object.create(Object.getPrototypeOf(e),t)}function QD(e,t){return t===void 0&&(t=!1),ZD(e)||h0(e)||!rm(e)||(O0(e)>1&&(e.set=e.add=e.clear=e.delete=X1e),Object.freeze(e),t&&E1(e,function(r,n){return QD(n,!0)},!0)),e}function X1e(){Vu(2)}function ZD(e){return e==null||typeof e!="object"||Object.isFrozen(e)}function rd(e){var t=ebe[e];return t||Vu(18,e),t}function dF(){return P1}function aA(e,t){t&&(rd("Patches"),e.u=[],e.s=[],e.v=t)}function wC(e){WP(e),e.p.forEach(Y1e),e.p=null}function WP(e){e===P1&&(P1=e.l)}function fF(e){return P1={p:[],l:P1,h:e,m:!0,_:0}}function Y1e(e){var t=e[Ss];t.i===0||t.i===1?t.j():t.g=!0}function iA(e,t){t._=t.p.length;var r=t.p[0],n=e!==void 0&&e!==r;return t.h.O||rd("ES5").S(t,e,n),n?(r[Ss].P&&(wC(t),Vu(4)),rm(e)&&(e=_C(t,e),t.l||AC(t,e)),t.u&&rd("Patches").M(r[Ss],e,t.u,t.s)):e=_C(t,r,[]),wC(t),t.u&&t.v(t.u,t.s),e!==Gq?e:void 0}function _C(e,t,r){if(ZD(t))return t;var n=t[Ss];if(!n)return E1(t,function(i,o){return pF(e,n,t,i,o,r)},!0),t;if(n.A!==e)return t;if(!n.P)return AC(e,n.t,!0),n.t;if(!n.I){n.I=!0,n.A._--;var a=n.i===4||n.i===5?n.o=$D(n.k):n.o;E1(n.i===3?new Set(a):a,function(i,o){return pF(e,n,a,i,o,r)}),AC(e,a,!1),r&&e.u&&rd("Patches").R(n,r,e.u,e.s)}return n.o}function pF(e,t,r,n,a,i){if(h0(a)){var o=_C(e,a,i&&t&&t.i!==3&&!qP(t.D,n)?i.concat(n):void 0);if(jq(r,n,o),!h0(o))return;e.m=!1}if(rm(a)&&!ZD(a)){if(!e.h.F&&e._<1)return;_C(e,a),t&&t.A.l||AC(e,a)}}function AC(e,t,r){r===void 0&&(r=!1),e.h.F&&e.m&&QD(t,r)}function oA(e,t){var r=e[Ss];return(r?mh(r):e)[t]}function hF(e,t){if(t in e)for(var r=Object.getPrototypeOf(e);r;){var n=Object.getOwnPropertyDescriptor(r,t);if(n)return n;r=Object.getPrototypeOf(r)}}function XP(e){e.P||(e.P=!0,e.l&&XP(e.l))}function sA(e){e.o||(e.o=$D(e.t))}function YP(e,t,r){var n=YD(t)?rd("MapSet").N(t,r):KD(t)?rd("MapSet").T(t,r):e.O?function(a,i){var o=Array.isArray(a),s={i:o?1:0,A:i?i.A:dF(),P:!1,I:!1,D:{},l:i,t:a,k:null,o:null,j:null,C:!1},u=s,l=cS;o&&(u=[s],l=dS);var c=Proxy.revocable(u,l),d=c.revoke,f=c.proxy;return s.k=f,s.j=d,f}(t,r):rd("ES5").J(t,r);return(r?r.A:dF()).p.push(n),n}function K1e(e){return h0(e)||Vu(22,e),function t(r){if(!rm(r))return r;var n,a=r[Ss],i=O0(r);if(a){if(!a.P&&(a.i<4||!rd("ES5").K(a)))return a.t;a.I=!0,n=mF(r,i),a.I=!1}else n=mF(r,i);return E1(n,function(o,s){a&&q1e(a.t,o)===s||jq(n,o,t(s))}),i===3?new Set(n):n}(e)}function mF(e,t){switch(t){case 2:return new Map(e);case 3:return Array.from(e)}return $D(e)}var vF,P1,JD=typeof Symbol<"u"&&typeof Symbol("x")=="symbol",$1e=typeof Map<"u",Q1e=typeof Set<"u",gF=typeof Proxy<"u"&&Proxy.revocable!==void 0&&typeof Reflect<"u",Gq=JD?Symbol.for("immer-nothing"):((vF={})["immer-nothing"]=!0,vF),yF=JD?Symbol.for("immer-draftable"):"__$immer_draftable",Ss=JD?Symbol.for("immer-state"):"__$immer_state",Z1e=""+Object.prototype.constructor,ek=typeof Reflect<"u"&&Reflect.ownKeys?Reflect.ownKeys:Object.getOwnPropertySymbols!==void 0?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Object.getOwnPropertyNames,J1e=Object.getOwnPropertyDescriptors||function(e){var t={};return ek(e).forEach(function(r){t[r]=Object.getOwnPropertyDescriptor(e,r)}),t},ebe={},cS={get:function(e,t){if(t===Ss)return e;var r=mh(e);if(!qP(r,t))return function(a,i,o){var s,u=hF(i,o);return u?"value"in u?u.value:(s=u.get)===null||s===void 0?void 0:s.call(a.k):void 0}(e,r,t);var n=r[t];return e.I||!rm(n)?n:n===oA(e.t,t)?(sA(e),e.o[t]=YP(e.A.h,n,e)):n},has:function(e,t){return t in mh(e)},ownKeys:function(e){return Reflect.ownKeys(mh(e))},set:function(e,t,r){var n=hF(mh(e),t);if(n?.set)return n.set.call(e.k,r),!0;if(!e.P){var a=oA(mh(e),t),i=a?.[Ss];if(i&&i.t===r)return e.o[t]=r,e.D[t]=!1,!0;if(W1e(r,a)&&(r!==void 0||qP(e.t,t)))return!0;sA(e),XP(e)}return e.o[t]===r&&typeof r!="number"||(e.o[t]=r,e.D[t]=!0,!0)},deleteProperty:function(e,t){return oA(e.t,t)!==void 0||t in e.t?(e.D[t]=!1,sA(e),XP(e)):delete e.D[t],e.o&&delete e.o[t],!0},getOwnPropertyDescriptor:function(e,t){var r=mh(e),n=Reflect.getOwnPropertyDescriptor(r,t);return n&&{writable:!0,configurable:e.i!==1||t!=="length",enumerable:n.enumerable,value:r[t]}},defineProperty:function(){Vu(11)},getPrototypeOf:function(e){return Object.getPrototypeOf(e.t)},setPrototypeOf:function(){Vu(12)}},dS={};E1(cS,function(e,t){dS[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}}),dS.deleteProperty=function(e,t){return cS.deleteProperty.call(this,e[0],t)},dS.set=function(e,t,r){return cS.set.call(this,e[0],t,r,e[0])};var tbe=function(){function e(r){var n=this;this.O=gF,this.F=!0,this.produce=function(a,i,o){if(typeof a=="function"&&typeof i!="function"){var s=i;i=a;var u=n;return function(p){var h=this;p===void 0&&(p=s);for(var m=arguments.length,v=Array(m>1?m-1:0),g=1;g<m;g++)v[g-1]=arguments[g];return u.produce(p,function(y){var b;return(b=i).call.apply(b,[h,y].concat(v))})}}var l;if(typeof i!="function"&&Vu(6),o!==void 0&&typeof o!="function"&&Vu(7),rm(a)){var c=fF(n),d=YP(n,a,void 0),f=!0;try{l=i(d),f=!1}finally{f?wC(c):WP(c)}return typeof Promise<"u"&&l instanceof Promise?l.then(function(p){return aA(c,o),iA(p,c)},function(p){throw wC(c),p}):(aA(c,o),iA(l,c))}if(!a||typeof a!="object")return(l=i(a))===Gq?void 0:(l===void 0&&(l=a),n.F&&QD(l,!0),l);Vu(21,a)},this.produceWithPatches=function(a,i){return typeof a=="function"?function(u){for(var l=arguments.length,c=Array(l>1?l-1:0),d=1;d<l;d++)c[d-1]=arguments[d];return n.produceWithPatches(u,function(f){return a.apply(void 0,[f].concat(c))})}:[n.produce(a,i,function(u,l){o=u,s=l}),o,s];var o,s},typeof r?.useProxies=="boolean"&&this.setUseProxies(r.useProxies),typeof r?.autoFreeze=="boolean"&&this.setAutoFreeze(r.autoFreeze)}var t=e.prototype;return t.createDraft=function(r){rm(r)||Vu(8),h0(r)&&(r=K1e(r));var n=fF(this),a=YP(this,r,void 0);return a[Ss].C=!0,WP(n),a},t.finishDraft=function(r,n){var a=r&&r[Ss],i=a.A;return aA(i,n),iA(void 0,i)},t.setAutoFreeze=function(r){this.F=r},t.setUseProxies=function(r){r&&!gF&&Vu(20),this.O=r},t.applyPatches=function(r,n){var a;for(a=n.length-1;a>=0;a--){var i=n[a];if(i.path.length===0&&i.op==="replace"){r=i.value;break}}var o=rd("Patches").$;return h0(r)?o(r,n):this.produce(r,function(s){return o(s,n.slice(a+1))})},e}(),Cs=new tbe,hd=Cs.produce;Cs.produceWithPatches.bind(Cs);var rbe=Cs.setAutoFreeze.bind(Cs);Cs.setUseProxies.bind(Cs);Cs.applyPatches.bind(Cs);Cs.createDraft.bind(Cs);Cs.finishDraft.bind(Cs);var Sh;(function(e){function t(o){if(!o.state||o.state.tree===o.editInfo.sourceTree)return o.tree.asImmutable();for(var s=o.state.tree.asTransient(),u=0,l=o.actions;u<l.length;u++){var c=l[u];switch(c.kind){case"add":s.add(c.transform);break;case"update":s.setParams(c.ref,c.params);break;case"delete":s.remove(c.ref);break;case"insert":{var d=s.children.get(c.ref).toArray();s.add(c.transform);for(var f=0,p=d;f<p.length;f++){var h=p[f];s.changeParent(h,c.transform.ref)}break}}}return o.editInfo.sourceTree=o.tree,s.asImmutable()}function r(o){return!!o&&typeof o.getTree=="function"}e.is=r;function n(o){return!!o&&typeof o.getTree=="function"&&typeof o.ref=="string"}e.isTo=n;var a=function(){function o(s,u){this.state={state:u,tree:s.asTransient(),actions:[],editInfo:{applied:!1,sourceTree:s,count:0,lastUpdate:void 0}}}return Object.defineProperty(o.prototype,"editInfo",{get:function(){return this.state.editInfo},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"currentTree",{get:function(){return this.state.tree},enumerable:!1,configurable:!0}),o.prototype.to=function(s){var u=typeof s=="string"?s:_1.is(s)?s.transform.ref:s.ref;return new i(this.state,u,this)},o.prototype.toRoot=function(){return new i(this.state,this.state.tree.root.ref,this)},o.prototype.delete=function(s){var u=Ka.resolveRef(s);return!u||!this.state.tree.transforms.has(u)?this:(this.editInfo.count++,this.state.tree.remove(u),this.state.actions.push({kind:"delete",ref:u}),this)},o.prototype.getTree=function(){return t(this.state)},o.prototype.commit=function(s){if(!this.state.state)throw new Error("Cannot commit template tree");return this.state.state.runTask(this.state.state.updateTree(this,s))},o}();e.Root=a;var i=function(){function o(s,u,l){if(this.state=s,this.root=l,this.ref=u,!this.state.tree.transforms.has(u))throw new Error("Could not find node '"+u+"'.")}return Object.defineProperty(o.prototype,"editInfo",{get:function(){return this.state.editInfo},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"selector",{get:function(){return new dq(this.ref,this.state.state)},enumerable:!1,configurable:!0}),o.prototype.getApplyRoot=function(){return xa.getDecoratorRoot(this.state.tree,this.ref)},o.prototype.apply=function(s,u,l){if(s.definition.isDecorator)return this.insert(s,u,l);var c=this.getApplyRoot(),d=s.apply(c,u,l);return this.state.tree.add(d),this.editInfo.count++,this.editInfo.lastUpdate=d.ref,this.state.actions.push({kind:"add",transform:d}),new o(this.state,d.ref,this.root)},o.prototype.applyOrUpdate=function(s,u,l,c){if(this.state.tree.transforms.has(s)){var d=this.to(s);return l&&d.update(l),d}else return this.apply(u,l,T(T({},c),{ref:s}))},o.prototype.applyOrUpdateTagged=function(s,u,l,c){if(u.definition.isDecorator)throw new Error("Can't use applyOrUpdateTagged on decorator transformers.");for(var d=this.getApplyRoot(),f=this.state.tree.children.get(d).values();;){var p=f.next();if(p.done)break;var h=this.state.tree.transforms.get(p.value);if(h&&vr.hasTags(h,s)){var m=this.to(p.value);return m.updateTagged(l,bF(h.tags,s,c&&c.tags)),m}}var v=u.apply(d,l,T(T({},c),{tags:bF(s,c&&c.tags)}));return this.state.tree.add(v),this.editInfo.count++,this.editInfo.lastUpdate=v.ref,this.state.actions.push({kind:"add",transform:v}),new o(this.state,v.ref,this.root)},o.prototype.group=function(s,u,l){return this.apply(s,u,l)},o.prototype.insert=function(s,u,l){var c=this.state.tree.children.get(this.ref).toArray(),d=s.apply(this.ref,u,l);this.state.tree.add(d);for(var f=0,p=c;f<p.length;f++){var h=p[f];this.state.tree.changeParent(h,d.ref)}return this.editInfo.count++,this.editInfo.lastUpdate=d.ref,this.state.actions.push({kind:"insert",ref:this.ref,transform:d}),new o(this.state,d.ref,this.root)},o.prototype.updateTagged=function(s,u){(this.state.tree.setParams(this.ref,s)||this.state.tree.setTags(this.ref,u))&&(this.editInfo.count++,this.editInfo.lastUpdate=this.ref,this.state.actions.push({kind:"update",ref:this.ref,params:s}))},o.prototype.update=function(s,u){var l;if(u){var c=this.state.tree.transforms.get(this.ref);l=hd(c.params,u)}else l=typeof s=="function"?hd(this.state.tree.transforms.get(this.ref).params,s):s;return this.state.tree.setParams(this.ref,l)&&(this.editInfo.count++,this.editInfo.lastUpdate=this.ref,this.state.actions.push({kind:"update",ref:this.ref,params:l})),this.root},o.prototype.to=function(s){return this.root.to(s)},o.prototype.toRoot=function(){return this.root.toRoot()},o.prototype.delete=function(s){return this.root.delete(s)},o.prototype.getTree=function(){return t(this.state)},o.prototype.commit=function(s){if(!this.state.state)throw new Error("Cannot commit template tree");return this.state.state.runTask(this.state.state.updateTree(this,s))},o}();e.To=i})(Sh||(Sh={}));function bF(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r=void 0,n=[],a=0,i=e;a<i.length;a++){var o=i[a];if(!!o)if(r||(r=new Set),typeof o=="string"){if(r.has(o))continue;r.add(o),n.push(o)}else for(var s=0,u=o;s<u.length;s++){var l=u[s];r.has(l)||(r.add(l),n.push(l))}}return n}var nbe=function(){function e(){this.ev=pd.create(),this.actions=new Map,this.fromTypeIndex=new Map,this.events={added:this.ev(),removed:this.ev()}}return e.prototype.add=function(t){var r=gt.is(t)?t.toAction():t;if(this.actions.has(r.id))return this;this.actions.set(r.id,r);for(var n=0,a=r.definition.from;n<a.length;n++){var i=a[n];this.fromTypeIndex.has(i.type)?this.fromTypeIndex.get(i.type).push(r):this.fromTypeIndex.set(i.type,[r])}return this.events.added.next(),this},e.prototype.remove=function(t){var r=gt.is(t)?t.toAction().id:Cn.is(t)?t:t.id,n=this.actions.get(r);if(!n)return this;this.actions.delete(r);for(var a=0,i=n.definition.from;a<i.length;a++){var o=i[a],s=this.fromTypeIndex.get(o.type);!s||(Uh(s,n),s.length===0&&this.fromTypeIndex.delete(o.type))}return this.events.removed.next(),this},e.prototype.fromCell=function(t,r){var n=t.obj;if(!n)return[];var a=this.fromTypeIndex.get(n.type);if(!a)return[];for(var i=!1,o=0,s=a;o<s.length;o++){var u=s[o];if(u.definition.isApplicable){i=!0;break}}if(!i)return a;for(var l=[],c=0,d=a;c<d.length;c++){var u=d[c];u.definition.isApplicable?u.definition.isApplicable(n,t.transform,r)&&l.push(u):l.push(u)}return l},e.prototype.dispose=function(){this.ev.dispose()},e}(),jl;(function(e){function t(i){return{type:"message",timestamp:new Date,message:i}}e.message=t;function r(i){return{type:"error",timestamp:new Date,message:i}}e.error=r;function n(i){return{type:"warning",timestamp:new Date,message:i}}e.warning=n;function a(i){return{type:"info",timestamp:new Date,message:i}}e.info=a})(jl||(jl={}));var I1;(function(e){var t=function(){function a(i){this.cells=i,this._current=void 0}return Object.defineProperty(a.prototype,"current",{get:function(){return this._current},set:function(i){this._current=i},enumerable:!1,configurable:!0}),a.prototype.getAncestorOfType=function(i){if(!!this._current)for(var o=this._current;;){if(o=this.cells.get(o.transform.parent),!o.obj)return;if(o.obj.type===i.type)return o.obj;if(o.transform.ref===vr.RootRef)return}},a.prototype.getRootOfType=function(i){if(!!this._current)for(var o=this._current,s=void 0;;){if(!o.obj)return;if(o.obj.type===i.type&&(s=o),o.transform.ref===vr.RootRef)return s?s.obj:void 0;o=this.cells.get(o.transform.parent)}},a}();e.Impl=t;function r(a,i){for(var o=a.cells,s=o.get(i),u=[s];s?.transform.transformer.definition.isDecorator;)s=o.get(s.transform.parent),u.push(s);return u}e.getDecoratorChain=r;function n(a,i,o){var s=void 0,u=a.cells.get(o);if(!!u)for(;;){if(!u.obj)return;if(u.obj.type===i.type&&(s=u),u.transform.ref===vr.RootRef)return s?s.obj:void 0;u=a.cells.get(u.transform.parent)}}e.getRootOfType=n})(I1||(I1={}));var abe=function(){function e(){this.queue=[],this.signal=new ha}return Object.defineProperty(e.prototype,"length",{get:function(){return this.queue.length},enumerable:!1,configurable:!0}),e.prototype.enqueue=function(t){return this.queue.push(t),this.queue.length===1?!0:this.waitFor(t)},e.prototype.handled=function(t){A1(this.queue,t),this.queue.length>0&&this.signal.next({v:this.queue[0],stillPresent:!0})},e.prototype.remove=function(t){var r=A1(this.queue,t);return r&&this.signal.next({v:t,stillPresent:!1}),r},e.prototype.waitFor=function(t){var r=this;return new Promise(function(n){var a=r.signal.subscribe(function(i){var o=i.v,s=i.stillPresent;o===t&&(a.unsubscribe(),n(s))})})},e}(),ibe=function(){function e(t,r){this.getHash=t,this.areEqual=r,this.size=0,this.byHash=new Map}return e.prototype.add=function(t){var r=this.getHash(t);if(this.byHash.has(r)){for(var n=this.byHash.get(r),a=0,i=n.length;a<i;a++)if(this.areEqual(t,n[a]))return!1;return n[n.length]=t,this.size++,!0}else return this.byHash.set(r,[t]),this.size++,!0},e.prototype.has=function(t){var r=this.getHash(t);if(!this.byHash.has(r))return!1;for(var n=this.byHash.get(r),a=0,i=n.length;a<i;a++)if(this.areEqual(t,n[a]))return!0;return!1},e}();function tk(e,t){return new ibe(e,t)}function KP(){return new obe}function xF(e){return{previous:null,next:null,inList:!0,value:e}}var obe=function(){function e(){this.count=0,this.first=null,this.last=null}return e.prototype.addFirst=function(t){var r=xF(t);return r.inList=!0,this.first&&(this.first.previous=r),r.next=this.first,this.first=r,this.count++,this.last||(this.last=r),r},e.prototype.addLast=function(t){var r=xF(t);return this.last!==null&&(this.last.next=r),r.previous=this.last,this.last=r,this.first===null&&(this.first=r),r.inList=!0,this.count++,r},e.prototype.removeFirst=function(){var t=this.first;if(t)return this.remove(t),t.value},e.prototype.removeLast=function(){var t=this.last;if(t)return this.remove(t),t.value},e.prototype.remove=function(t){!t.inList||(t.inList=!1,t.previous!==null?t.previous.next=t.next:t.previous===null&&(this.first=t.next),t.next!==null?t.next.previous=t.previous:t.next===null&&(this.last=t.previous),t.next=null,t.previous=null,this.count--)},e.prototype.find=function(t){for(var r=this.first;r!==null;){if(r.value===t)return r;r=r.next}},e}(),on;(function(e){function t(){return{keys:new Set,array:[]}}e.create=t;function r(a,i,o){var s=a.keys,u=a.array;return s.has(i)?!1:(s.add(i),u[u.length]=o,!0)}e.add=r;function n(a,i){var o=a.keys;return o.has(i)}e.has=n})(on||(on={}));var vp=function(){function e(t,r){var n=this;this.errorFree=!0,this.ev=pd.create(),this.globalContext=void 0,this.events={cell:{stateUpdated:this.ev(),created:this.ev(),removed:this.ev()},object:{updated:this.ev(),created:this.ev(),removed:this.ev()},log:this.ev(),changed:this.ev(),historyUpdated:this.ev()},this.behaviors={currentObject:this.ev.behavior({state:this,ref:vr.RootRef}),isUpdating:this.ev.behavior(!1)},this.actions=new nbe,this.cells=new Map,this.spine=new I1.Impl(this.cells),this.tryGetCellData=function(o){var s,u,l=(u=(s=n.cells.get(o))===null||s===void 0?void 0:s.obj)===null||u===void 0?void 0:u.data;if(!o)throw new Error("Cell '"+o+"' data undefined.");return l},this.historyCapacity=5,this.history=[],this.undoingHistory=!1,this.inTransaction=!1,this.inTransactionError=!1,this._inUpdate=!1,this.reverted=!1,this.updateQueue=new abe,this._tree=xa.createEmpty(vr.createRoot(r&&r.rootState)).asTransient();var a=this._tree,i=a.root;this.runTask=r.runTask,r?.historyCapacity!==void 0&&(this.historyCapacity=r.historyCapacity),this.cells.set(i.ref,{parent:this,transform:i,sourceRef:void 0,obj:t,status:"ok",state:T({},i.state),errorText:void 0,params:{definition:{},values:{}},paramsNormalizedVersion:i.version,dependencies:{dependentBy:[],dependsOn:[]},cache:{}}),this.globalContext=r&&r.globalContext}return Object.defineProperty(e.prototype,"tree",{get:function(){return this._tree},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"transforms",{get:function(){return this._tree.transforms},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"current",{get:function(){return this.behaviors.currentObject.value.ref},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return this.cells.get(this._tree.root.ref)},enumerable:!1,configurable:!0}),e.prototype.build=function(){return new Sh.Root(this.tree,this)},e.prototype.addHistory=function(t,r){this.historyCapacity!==0&&(this.history.unshift([t,r||"Update"]),this.history.length>this.historyCapacity&&this.history.pop(),this.events.historyUpdated.next({state:this}))},e.prototype.clearHistory=function(){this.history.length!==0&&(this.history=[],this.events.historyUpdated.next({state:this}))},Object.defineProperty(e.prototype,"latestUndoLabel",{get:function(){return this.history.length>0?this.history[0][1]:void 0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canUndo",{get:function(){return this.history.length>0},enumerable:!1,configurable:!0}),e.prototype.undo=function(){var t=this;return Qe.create("Undo",function(r){return pe(t,void 0,void 0,function(){var n;return he(this,function(a){switch(a.label){case 0:if(n=this.history.shift(),!n)return[2];this.events.historyUpdated.next({state:this}),this.undoingHistory=!0,a.label=1;case 1:return a.trys.push([1,,3,4]),[4,this.updateTree(n[0],{canUndo:!1}).runInContext(r)];case 2:return a.sent(),[3,4];case 3:return this.undoingHistory=!1,[7];case 4:return[2]}})})})},e.prototype.getSnapshot=function(){return{tree:xa.toJSON(this._tree)}},e.prototype.setSnapshot=function(t){var r=xa.fromJSON(t.tree);return this.updateTree(r)},e.prototype.setCurrent=function(t){this.behaviors.currentObject.next({state:this,ref:t})},e.prototype.updateCellState=function(t,r){var n=this.cells.get(t);if(!!n){var a=typeof r=="function"?r(n.state):r;vr.assignState(n.state,a)&&(n.transform=this._tree.assignState(n.transform.ref,a),this.events.cell.stateUpdated.next({state:this,ref:t,cell:n}))}},e.prototype.dispose=function(){this.ev.dispose(),this.actions.dispose()},e.prototype.select=function(t){return lr.select(t,this)},e.prototype.selectQ=function(t){return typeof t=="string"?lr.select(t,this):lr.select(t(lr.Generators),this)},e.prototype.applyAction=function(t,r,n){var a=this;return n===void 0&&(n=vr.RootRef),Qe.create("Apply Action",function(i){var o=a.cells.get(n);if(!o)throw new Error("'"+n+"' does not exist.");if(o.status!=="ok")throw new Error("Action cannot be applied to a cell with status '"+o.status+"'");return rk(t.definition.run({ref:n,cell:o,a:o.obj,params:r,state:a},a.globalContext),i)})},e.prototype.transaction=function(t,r){var n=this;return Qe.create("State Transaction",function(a){return pe(n,void 0,void 0,function(){var i,o,s,u;return he(this,function(l){switch(l.label){case 0:i=this.inTransaction,o=this._tree.asImmutable(),s=!1,l.label=1;case 1:return l.trys.push([1,5,8,9]),i||this.behaviors.isUpdating.next(!0),this.inTransaction=!0,this.inTransactionError=!1,[4,t(a)];case 2:return l.sent(),this.inTransactionError?(s=!0,[4,this.updateTree(o).runInContext(a)]):[3,4];case 3:l.sent(),l.label=4;case 4:return[3,9];case 5:return u=l.sent(),s?[3,7]:(s=!0,[4,this.updateTree(o).runInContext(a)]);case 6:l.sent(),this.events.log.next(jl.error(""+u)),l.label=7;case 7:if(i)throw this.inTransactionError=!0,u;if(r?.rethrowErrors)throw u;return[3,9];case 8:return i||(this.inTransaction=!1,this.events.changed.next({state:this,inTransaction:!1}),this.behaviors.isUpdating.next(!1),s||(r?.canUndo?this.addHistory(o,typeof r.canUndo=="string"?r.canUndo:void 0):this.clearHistory())),[7];case 9:return[2]}})})})},Object.defineProperty(e.prototype,"inUpdate",{get:function(){return this._inUpdate},enumerable:!1,configurable:!0}),e.prototype.updateTree=function(t,r){var n=this,a={tree:t,options:r};return Qe.create("Update Tree",function(i){return pe(n,void 0,void 0,function(){var o,s,u,l,c;return he(this,function(d){switch(d.label){case 0:return[4,this.updateQueue.enqueue(a)];case 1:if(o=d.sent(),!o)return[2];this._inUpdate=!0,s=r?.canUndo?this._tree.asImmutable():void 0,u=!1,this.inTransaction||this.behaviors.isUpdating.next(!0),d.label=2;case 2:if(d.trys.push([2,,7,8]),Sh.is(t)){if(t.editInfo.applied)throw new Error("This builder has already been applied. Create a new builder for further state updates");t.editInfo.applied=!0}return this.reverted=!1,r&&(r.revertIfAborted||r.revertOnError)?[4,this._revertibleTreeUpdate(i,a,r)]:[3,4];case 3:return c=d.sent(),[3,6];case 4:return[4,this._updateTree(i,a)];case 5:c=d.sent(),d.label=6;case 6:return l=c,u=this.reverted,l.ctx.hadError&&(this.inTransactionError=!0),l.cell?[2,new dq(l.cell.transform.ref,this)]:[2];case 7:return this._inUpdate=!1,this.updateQueue.handled(a),this.inTransaction||(this.behaviors.isUpdating.next(!1),r?.canUndo?u||this.addHistory(s,typeof r.canUndo=="string"?r.canUndo:void 0):this.undoingHistory||this.clearHistory()),[7];case 8:return[2]}})})},function(){n.updateQueue.remove(a)})},e.prototype._revertibleTreeUpdate=function(t,r,n){return pe(this,void 0,void 0,function(){var a,i,o;return he(this,function(s){switch(s.label){case 0:return a=this.tree,[4,this._updateTree(t,r)];case 1:return i=s.sent(),o=(i.ctx.hadError||i.ctx.wasAborted)&&n.revertOnError||i.ctx.wasAborted&&n.revertIfAborted,o?(this.reverted=!0,[4,this._updateTree(t,{tree:a,options:r.options})]):[3,3];case 2:return[2,s.sent()];case 3:return[2,i]}})})},e.prototype._updateTree=function(t,r){return pe(this,void 0,void 0,function(){var n,a,i;return he(this,function(o){switch(o.label){case 0:n=!1,a=this.updateTreeAndCreateCtx(r.tree,t,r.options),o.label=1;case 1:return o.trys.push([1,,3,4]),[4,ube(a)];case 2:return n=o.sent(),Sh.isTo(r.tree)?(i=this.select(r.tree.ref)[0],[2,{ctx:a,cell:i}]):[2,{ctx:a}];case 3:return this.spine.current=void 0,n&&this.events.changed.next({state:this,inTransaction:this.inTransaction}),[7];case 4:return[2]}})})},e.prototype.updateTreeAndCreateCtx=function(t,r,n){var a=(Sh.is(t)?t.getTree():t).asTransient(),i=this._tree;this._tree=a;var o=this.cells,s={parent:this,editInfo:Sh.is(t)?t.editInfo:void 0,errorFree:this.errorFree,taskCtx:r,oldTree:i,tree:a,cells:this.cells,spine:this.spine,results:[],options:T(T({},sbe),n),changed:!1,hadError:!1,wasAborted:!1,newCurrent:void 0,getCellData:function(u){var l;return(l=o.get(u).obj)===null||l===void 0?void 0:l.data}};return this.errorFree=!0,s},e}();(function(e){function t(r,n){return new e(r,n)}e.create=t,function(r){function n(a,i){return!!i&&a.ref===i.transform.ref&&a.state===i.parent}r.isCell=n}(e.ObjectEvent||(e.ObjectEvent={}))})(vp||(vp={}));var sbe={doNotLogTiming:!1,doNotUpdateCurrent:!0,revertIfAborted:!1,revertOnError:!1,canUndo:!1};function ube(e){return pe(this,void 0,void 0,function(){var t,r,n,a,F,i,o,s,v,u,m,S,l,c,v,S,d,f,p,h,S,m,v,g,y,b,S,x,C,w,_,E,P,D,k,F,X;return he(this,function(U){switch(U.label){case 0:if(t=!!(e.editInfo&&e.editInfo.count===1&&e.editInfo.lastUpdate&&e.editInfo.sourceTree===e.oldTree),n=[],t)r=[],a=[e.editInfo.lastUpdate];else{for(r=fbe(e),F=e.parent.current,i=!1,o=0,s=r;o<s.length;o++)if(v=s[o],v===F){i=!0;break}for(i&&(u=SF(e.oldTree,F,r,e.cells),e.parent.setCurrent(u)),m=r.length-1;m>=0;m--)S=e.cells.get(r[m]),S&&QP(S.transform,S.obj,S?.transform.params,S.cache,e.parent.globalContext);for(l=0,c=r;l<c.length;l++)v=c[l],S=e.cells.get(v),S&&(S.parent=void 0,gbe(S)),d=S&&S.obj,e.cells.delete(v),n.push(d);a=lbe(e.cells,e.tree)}for(f=xbe(e,a),p=0,h=f.added;p<h.length;p++)S=h[p],e.parent.events.cell.created.next({state:e.parent,ref:S.transform.ref,cell:S});for(m=0;m<r.length;m++)v=r[m],g=e.oldTree.transforms.get(v).parent,e.parent.events.object.removed.next({state:e.parent,ref:v,obj:n[m]}),e.parent.events.cell.removed.next({state:e.parent,ref:v,parent:g});if(n.length&&(n=[]),f.dependent)for(y=0,b=f.dependent;y<b.length;y++)S=b[y],a.push(S.transform.ref);vbe(e,a),x=0,C=a,U.label=1;case 1:return x<C.length?(w=C[x],[4,Wq(e,w)]):[3,4];case 2:U.sent(),U.label=3;case 3:return x++,[3,1];case 4:for(e.editInfo||hbe(e),_=e.newCurrent,E=0,P=e.results;E<P.length;E++)D=P[E],D.action==="created"?(e.parent.events.object.created.next({state:e.parent,ref:D.ref,obj:D.obj}),e.newCurrent||(k=e.tree.transforms.get(D.ref),!k.state.isGhost&&D.obj!==qn.Null&&(_=D.ref))):D.action==="updated"?e.parent.events.object.updated.next({state:e.parent,ref:D.ref,action:"in-place",obj:D.obj,oldData:D.oldData}):D.action==="replaced"&&e.parent.events.object.updated.next({state:e.parent,ref:D.ref,action:"recreate",obj:D.obj,oldObj:D.oldObj});return _?e.options.doNotUpdateCurrent||e.parent.setCurrent(_):(F=e.parent.current,X=e.cells.get(F),X&&(X.obj===qn.Null||X.status==="error"&&X.errorText===Sbe)&&(_=SF(e.oldTree,F,[],e.cells),e.parent.setCurrent(_))),[2,r.length>0||a.length>0||e.changed]}})})}function lbe(e,t){var r={roots:[],cells:e};return xa.doPreOrder(t,t.root,r,cbe),r.roots}function cbe(e,t,r){var n=r.cells.get(e.ref);return!n||n.transform.version!==e.version?(r.roots.push(e.ref),!1):!(n.status==="error"||n&&n.obj===qn.Null)}function dbe(e,t,r){!r.newTree.transforms.has(e.ref)&&r.cells.has(e.ref)&&r.deletes.push(e.ref)}function fbe(e){var t={newTree:e.tree,cells:e.cells,deletes:[]};return xa.doPostOrder(e.oldTree,e.oldTree.root,t,dbe),t.deletes}function pbe(e,t,r){var n=r.cells.get(e.ref);!n||!vr.syncState(n.state,e.state)||r.parent.events.cell.stateUpdated.next({state:r.parent,ref:e.ref,cell:n})}function hbe(e){xa.doPreOrder(e.tree,e.tree.root,e,pbe)}function TC(e,t,r,n){var a=e.cells.get(t),i=a.status!==r;a.status=r,a.errorText=n,i&&e.parent.events.cell.stateUpdated.next({state:e.parent,ref:t,cell:a})}function mbe(e,t,r){r.cells.get(e.ref).transform=e,TC(r,e.ref,"pending")}function vbe(e,t){for(var r=0,n=t;r<n.length;r++){var a=n[r];xa.doPreOrder(e.tree,e.tree.transforms.get(a),e,mbe)}}function gbe(e){for(var t=0,r=e.dependencies.dependsOn;t<r.length;t++){var n=r[t];Uh(n.dependencies.dependentBy,e)}}function ybe(e,t,r){var n=r.ctx,a=r.added,i=r.visited;if(i.add(e.ref),!n.cells.has(e.ref)){var o={parent:n.parent,transform:e,sourceRef:void 0,status:"pending",state:T({},e.state),errorText:void 0,params:void 0,paramsNormalizedVersion:"",dependencies:{dependentBy:[],dependsOn:[]},cache:void 0};n.cells.set(e.ref,o),a.push(o)}}function bbe(e,t){if(!!e.transform.dependsOn)for(var r=0,n=e.transform.dependsOn;r<n.length;r++){var a=n[r],i=t.tree.transforms.get(a);if(!i)throw new Error("Cannot depend on a non-existent transform.");var o=t.cells.get(a);ho(e.dependencies.dependsOn,o),ho(o.dependencies.dependentBy,e)}}function xbe(e,t){for(var r={ctx:e,visited:new Set,added:[]},n=0,a=t;n<a.length;n++){var i=a[n];xa.doPreOrder(e.tree,e.tree.transforms.get(i),r,ybe)}for(var o=0,s=r.added;o<s.length;o++){var u=s[o];bbe(u,e)}var l;return r.visited.forEach(function(c){for(var d=e.cells.get(c),f=0,p=d.dependencies.dependentBy;f<p.length;f++){var h=p[f];r.visited.has(h.transform.ref)||(l||(l=on.create()),on.add(l,h.transform.ref,h))}}),{added:r.added,dependent:l?l.array:void 0}}function SF(e,t,r,n){var a=new Set(r);return qq(e,t,a,n)}function qq(e,t,r,n){if(t===vr.RootRef)return t;for(var a=e.transforms.get(t),i=e.children.get(a.parent).values(),o=void 0,s=!1;;){var u=i.next();if(u.done)break;if(!r.has(u.value)){var l=n.get(u.value);if(!(!l||l.status==="error"||l.obj===qn.Null)){var c=e.transforms.get(u.value);if(!c.state.isGhost){if(u.value===t){s=!0,r.has(t)||(o=t);continue}if(s)return c.ref;o=c.ref}}}}return o||qq(e,a.parent,r,n)}function $P(e,t,r,n){n||(e.hadError=!0,e.parent.errorFree=!1);var a=e.cells.get(t);if(r){e.wasAborted=e.wasAborted||Qe.isAbort(r);var i=""+r;TC(e,t,"error",i),n||e.parent.events.log.next({type:"error",timestamp:new Date,message:i})}else a.params=void 0;if(a.obj){var o=a.obj;a.obj=void 0,a.cache=void 0,e.parent.events.object.removed.next({state:e.parent,ref:t,obj:o})}for(var s=e.tree.children.get(t).values();;){var u=s.next();if(u.done)return;$P(e,u.value,void 0,n)}}var Sbe="Parent is null";function Wq(e,t){return pe(this,void 0,void 0,function(){var r,n,a,i,o,s,u;return he(this,function(l){switch(l.label){case 0:TC(e,t,"processing"),r=!1,l.label=1;case 1:return l.trys.push([1,3,,4]),n=Gn(),[4,wbe(e,t)];case 2:return a=l.sent(),i=Gn()-n,a.action!=="none"&&(e.changed=!0),TC(e,t,"ok"),e.results.push(a),a.action==="created"?(r=a.obj===qn.Null,!r&&!e.options.doNotLogTiming&&e.parent.events.log.next(jl.info("Created "+a.obj.label+" in "+iS(i)+"."))):(a.action==="updated"||a.action==="replaced")&&(r=a.obj===qn.Null,!r&&!e.options.doNotLogTiming&&e.parent.events.log.next(jl.info("Updated "+a.obj.label+" in "+iS(i)+"."))),[3,4];case 3:return o=l.sent(),e.changed=!0,e.hadError||(e.newCurrent=t),$P(e,t,o,!1),R0||console.error(o),[2];case 4:s=e.tree.children.get(t).values(),l.label=5;case 5:return u=s.next(),u.done?[2]:r?($P(e,u.value,void 0,!0),[3,8]):[3,6];case 6:return[4,Wq(e,u.value)];case 7:l.sent(),l.label=8;case 8:return[3,5];case 9:return[2]}})})}function Cbe(e,t,r,n){var a=t.transformer.definition.params,i=a?a(r,e.parent.globalContext):{};if(n.paramsNormalizedVersion!==t.version)t.params=M.normalizeParams(i,t.params,"all"),n.paramsNormalizedVersion=t.version;else{var o=M.getDefaultValues(i);t.params=t.params?gge(t.params,o):o}return M.resolveRefs(i,t.params,e.getCellData),{definition:i,values:t.params}}function wbe(e,t){var r;return pe(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d,f,p,h,m,v,g,y,b;return he(this,function(S){switch(S.label){case 0:if(n=e.oldTree,a=e.tree,i=e.cells.get(t),o=i.transform,i.transform.ref===vr.RootRef)return[2,{action:"none"}];if(s=o.transformer.definition.from.length===0?e.cells.get(i.transform.parent):lr.findAncestorOfType(a,e.cells,t,o.transformer.definition.from),!s)throw new Error("No suitable parent found for '"+t+"'");return e.spine.current=i,u=s.obj,i.sourceRef=s.transform.ref,l=Cbe(e,o,u,i),!n.transforms.has(t)||!i.params?(i.params=l,[4,CF(e,i,o.transformer,u,l.values)]):[3,2];case 1:return c=S.sent(),uA(c,o),i.obj=c,[2,{ref:t,action:"created",obj:c}];case 2:return d=i.params.values,f=i.cache,p=(r=i.obj)===null||r===void 0?void 0:r.data,h=l.values,i.params=l,!!i.obj&&i.obj!==qn.Null?[4,_be(e,i,o.transformer,u,i.obj,d,h)]:[3,4];case 3:return v=S.sent(),[3,5];case 4:v=gt.UpdateResult.Recreate,S.label=5;case 5:switch(m=v,g=m,g){case gt.UpdateResult.Recreate:return[3,6];case gt.UpdateResult.Updated:return[3,8];case gt.UpdateResult.Null:return[3,9]}return[3,10];case 6:return y=i.obj,QP(o,y,d,f,e.parent.globalContext),[4,CF(e,i,o.transformer,u,h)];case 7:return b=S.sent(),uA(b,o),i.obj=b,[2,{ref:t,action:"replaced",oldObj:y,obj:b}];case 8:return uA(i.obj,o),[2,{ref:t,action:"updated",oldData:p,obj:i.obj}];case 9:return QP(o,i.obj,d,f,e.parent.globalContext),i.obj=qn.Null,[2,{ref:t,action:"updated",obj:i.obj}];case 10:return[2,{action:"none"}]}})})}function QP(e,t,r,n,a){var i,o;(o=(i=e.transformer.definition).dispose)===null||o===void 0||o.call(i,{b:t!==qn.Null?t:void 0,params:r,cache:n},a)}function uA(e,t){!e||e===qn.Null||(e.tags=t.tags)}function rk(e,t){return typeof e.runInContext=="function"?e.runInContext(t):e}function Xq(e){if(e.dependencies.dependsOn.length!==0){for(var t=Object.create(null),r=0,n=e.dependencies.dependsOn;r<n.length;r++){var a=n[r];if(!a.obj)throw new Error("Unresolved dependency.");t[a.transform.ref]=a.obj}return t}}function CF(e,t,r,n,a){return t.cache||(t.cache=Object.create(null)),rk(r.definition.apply({a:n,params:a,cache:t.cache,spine:e.spine,dependencies:Xq(t)},e.parent.globalContext),e.taskCtx)}function _be(e,t,r,n,a,i,o){return pe(this,void 0,void 0,function(){return he(this,function(s){return r.definition.update?(t.cache||(t.cache=Object.create(null)),[2,rk(r.definition.update({a:n,oldParams:i,b:a,newParams:o,cache:t.cache,spine:e.spine,dependencies:Xq(t)},e.parent.globalContext),e.taskCtx)]):[2,gt.UpdateResult.Recreate]})})}var be;(function(e){e.Create=qn.factory();function t(s){return!!s&&s.type.typeClass==="Representation3D"}e.isRepresentation3D=t;function r(s){return!!s&&s.type.typeClass==="Behavior"}e.isBehavior=r;function n(s){return e.Create(T(T({},s),{typeClass:"Representation3D"}))}e.CreateRepresentation3D=n;function a(s){return e.Create(T(T({},s),{typeClass:"Behavior"}))}e.CreateBehavior=a;var i=function(s){Le(u,s);function u(){return s!==null&&s.apply(this,arguments)||this}return u}(e.Create({name:"Root",typeClass:"Root"}));e.Root=i;var o=function(s){Le(u,s);function u(){return s!==null&&s.apply(this,arguments)||this}return u}(e.Create({name:"Group",typeClass:"Group"}));e.Group=o,function(s){var u=function(d){Le(f,d);function f(){return d!==null&&d.apply(this,arguments)||this}return f}(e.Create({name:"String Data",typeClass:"Data"}));s.String=u;var l=function(d){Le(f,d);function f(){return d!==null&&d.apply(this,arguments)||this}return f}(e.Create({name:"Binary Data",typeClass:"Data"}));s.Binary=l;var c=function(d){Le(f,d);function f(){return d!==null&&d.apply(this,arguments)||this}return f}(e.Create({name:"Data Blob",typeClass:"Data"}));s.Blob=c}(e.Data||(e.Data={})),function(s){var u=function(g){Le(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(e.Create({name:"JSON Data",typeClass:"Data"}));s.Json=u;var l=function(g){Le(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(e.Create({name:"CIF File",typeClass:"Data"}));s.Cif=l;var c=function(g){Le(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(e.Create({name:"Cube File",typeClass:"Data"}));s.Cube=c;var d=function(g){Le(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(e.Create({name:"PSF File",typeClass:"Data"}));s.Psf=d;var f=function(g){Le(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(e.Create({name:"PLY File",typeClass:"Data"}));s.Ply=f;var p=function(g){Le(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(e.Create({name:"CCP4/MRC/MAP File",typeClass:"Data"}));s.Ccp4=p;var h=function(g){Le(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(e.Create({name:"DSN6/BRIX File",typeClass:"Data"}));s.Dsn6=h;var m=function(g){Le(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(e.Create({name:"DX File",typeClass:"Data"}));s.Dx=m;var v=function(g){Le(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(e.Create({name:"Format Blob",typeClass:"Data"}));s.Blob=v}(e.Format||(e.Format={})),function(s){var u=function(p){Le(h,p);function h(){return p!==null&&p.apply(this,arguments)||this}return h}(e.Create({name:"Coordinates",typeClass:"Object"}));s.Coordinates=u;var l=function(p){Le(h,p);function h(){return p!==null&&p.apply(this,arguments)||this}return h}(e.Create({name:"Topology",typeClass:"Object"}));s.Topology=l;var c=function(p){Le(h,p);function h(){return p!==null&&p.apply(this,arguments)||this}return h}(e.Create({name:"Model",typeClass:"Object"}));s.Model=c;var d=function(p){Le(h,p);function h(){return p!==null&&p.apply(this,arguments)||this}return h}(e.Create({name:"Trajectory",typeClass:"Object"}));s.Trajectory=d;var f=function(p){Le(h,p);function h(){return p!==null&&p.apply(this,arguments)||this}return h}(e.Create({name:"Structure",typeClass:"Object"}));s.Structure=f,function(p){var h=function(g){Le(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(n({name:"Structure 3D"}));p.Representation3D=h;var m=function(g){Le(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(e.Create({name:"Structure 3D State",typeClass:"Object"}));p.Representation3DState=m;var v=function(g){Le(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(e.Create({name:"Selections",typeClass:"Object"}));p.Selections=v}(f=s.Structure||(s.Structure={}))}(e.Molecule||(e.Molecule={})),function(s){var u=function(d){Le(f,d);function f(){return d!==null&&d.apply(this,arguments)||this}return f}(e.Create({name:"Volume",typeClass:"Object"}));s.Data=u;var l=function(d){Le(f,d);function f(){return d!==null&&d.apply(this,arguments)||this}return f}(e.Create({name:"Lazy Volume",typeClass:"Object"}));s.Lazy=l;var c=function(d){Le(f,d);function f(){return d!==null&&d.apply(this,arguments)||this}return f}(n({name:"Volume 3D"}));s.Representation3D=c}(e.Volume||(e.Volume={})),function(s){var u=function(c){Le(d,c);function d(){return c!==null&&c.apply(this,arguments)||this}return d}(e.Create({name:"Shape Provider",typeClass:"Object"}));s.Provider=u;var l=function(c){Le(d,c);function d(){return c!==null&&c.apply(this,arguments)||this}return d}(n({name:"Shape 3D"}));s.Representation3D=l}(e.Shape||(e.Shape={}))})(be||(be={}));var Ut;(function(e){e.CreateBuiltIn=gt.factory("ms-plugin"),e.BuiltIn=gt.builderFactory("ms-plugin")})(Ut||(Ut={}));var Nn;(function(e){function t(i,o){return o===void 0&&(o=-1),new n(i,o)}e.error=t;function r(i,o){return o===void 0&&(o=[]),new a(i,o)}e.success=r;var n=function(){function i(o,s){this.message=o,this.line=s,this.isError=!0}return i.prototype.toString=function(){return this.line>=0?"[Line "+this.line+"] "+this.message:this.message},i}();e.Error=n;var a=function(){function i(o,s){this.result=o,this.warnings=s,this.isError=!1}return i}();e.Success=a})(Nn||(Nn={}));var Yu;(function(e){function t(s){var u=new DataView(s.buffer);return Object.assign(s.subarray(0),{readInt8:function(l){return u.getInt8(l)},readUInt8:function(l){return u.getUint8(l)},writeInt8:function(l,c){return u.setInt8(c,l)},writeUInt8:function(l,c){return u.setUint8(c,l)},readInt16LE:function(l){return u.getInt16(l,!0)},readInt32LE:function(l){return u.getInt32(l,!0)},readUInt16LE:function(l){return u.getUint16(l,!0)},readUInt32LE:function(l){return u.getUint32(l,!0)},readFloatLE:function(l){return u.getFloat32(l,!0)},readDoubleLE:function(l){return u.getFloat64(l,!0)},writeInt16LE:function(l,c){return u.setInt16(c,l,!0)},writeInt32LE:function(l,c){return u.setInt32(c,l,!0)},writeUInt16LE:function(l,c){return u.setUint16(c,l,!0)},writeUInt32LE:function(l,c){return u.setUint32(c,l,!0)},writeFloatLE:function(l,c){return u.setFloat32(c,l,!0)},writeDoubleLE:function(l,c){return u.setFloat64(c,l,!0)},readInt16BE:function(l){return u.getInt16(l,!1)},readInt32BE:function(l){return u.getInt32(l,!1)},readUInt16BE:function(l){return u.getUint16(l,!1)},readUInt32BE:function(l){return u.getUint32(l,!1)},readFloatBE:function(l){return u.getFloat32(l,!1)},readDoubleBE:function(l){return u.getFloat64(l,!1)},writeInt16BE:function(l,c){return u.setInt16(c,l,!1)},writeInt32BE:function(l,c){return u.setInt32(c,l,!1)},writeUInt16BE:function(l,c){return u.setUint16(c,l,!1)},writeUInt32BE:function(l,c){return u.setUint32(c,l,!1)},writeFloatBE:function(l,c){return u.setFloat32(c,l,!1)},writeDoubleBE:function(l,c){return u.setFloat64(c,l,!1)},copy:function(l,c,d,f){return c=ja(c,0),d=ja(d,0),f=ja(f,s.length),l.set(s.subarray(d,f),c),f-d}})}e.fromUint8Array=t;function r(s){return t(new Uint8Array(s))}e.fromArrayBuffer=r;function n(s){return s}e.fromBuffer=n,e.IsNativeEndianLittle=new Uint16Array(new Uint8Array([18,52]).buffer)[0]===13330;function a(s,u,l,c,d){for(var f=0,p=l;f<p;f+=c)for(var h=0;h<c;h++)u[d+f+c-h-1]=s[d+f+h]}e.flipByteOrder=a;function i(s,u,l){u===void 0&&(u=0);for(var c=new Int16Array(s,u,l),d=0,f=c.length;d<f;++d){var p=c[d];c[d]=(p&255)<<8|p>>8&255}}e.flipByteOrderInPlace2=i;function o(s,u,l,c,d){e.IsNativeEndianLittle||!l||c<=1||a(s,u,l,c,d)}e.ensureLittleEndian=o})(Yu||(Yu={}));var EC;(function(e){function t(r,n){return{name:n,readBuffer:function(a,i,o,s){var u,l;if(typeof i=="number"){o=ja(o,i);var c=a,d=Math.min(r.length,c+o);u=d-c,l=Yu.fromUint8Array(new Uint8Array(r.buffer,c,d-c))}else{o=ja(o,i.length);var c=a,d=Math.min(r.length,c+o);i.set(r.subarray(c,d),s),u=d-c,l=i}return o!==u&&console.warn("byteCount "+o+" and bytesRead "+u+" differ"),Promise.resolve({bytesRead:u,buffer:l})},writeBuffer:function(a,i,o){return o=ja(o,i.length),console.error(".writeBuffer not implemented for FileHandle.fromBuffer"),Promise.resolve(0)},writeBufferSync:function(a,i,o){return o=ja(o,i.length),console.error(".writeSync not implemented for FileHandle.fromBuffer"),0},close:Df}}e.fromBuffer=t})(EC||(EC={}));var Ii;(function(e){e.Float32="float32",e.Int8="int8",e.Int16="int16",e.Uint16="uint16"})(Ii||(Ii={}));function Yq(e){return e===Ii.Float32?4:e===Ii.Int16||e===Ii.Uint16?2:1}function Abe(e,t,r,n){return r===void 0&&(r=0),e===Ii.Float32?new Float32Array(t,r,n):e===Ii.Int16?new Int16Array(t,r,n):e===Ii.Uint16?new Uint16Array(t,r,n):new Int8Array(t,r,n)}function Tbe(e,t){var r=Yq(t),n=new ArrayBuffer(r*e),a=Yu.fromArrayBuffer(n),i=Yu.IsNativeEndianLittle?n:new ArrayBuffer(r*e);return{type:t,elementByteSize:r,readBuffer:a,valuesBuffer:new Uint8Array(i),values:Abe(t,i)}}function Ebe(e,t,r,n,a,i){return pe(this,void 0,void 0,function(){return he(this,function(o){switch(o.label){case 0:return[4,t.readBuffer(r,e.readBuffer,n,a)];case 1:return o.sent(),e.elementByteSize>1&&(i!==void 0&&i!==Yu.IsNativeEndianLittle||!Yu.IsNativeEndianLittle)&&Yu.flipByteOrder(e.readBuffer,e.valuesBuffer,n,e.elementByteSize,a),[2,e.values]}})})}function Pbe(e){return pe(this,void 0,void 0,function(){var t,r,n,a,i,o,s,u,l;return he(this,function(c){switch(c.label){case 0:return t=1024,[4,e.readBuffer(0,t)];case 1:if(r=c.sent().buffer,n=String.fromCharCode(r.readUInt8(52*4),r.readUInt8(52*4+1),r.readUInt8(52*4+2),r.readUInt8(52*4+3)),n!=="MAP ")throw new Error('ccp4 format error, missing "MAP " string');return a=[r.readUInt8(53*4),r.readUInt8(53*4+1)],i=!1,a[0]===68&&a[1]===65?i=!0:a[0]===17&&a[1]===17?i=!1:(o=r.readInt32LE(3*4),o<=16&&(i=!0)),s=i?function(d){return r.readInt32LE(d*4)}:function(d){return r.readInt32BE(d*4)},u=i?function(d){return r.readFloatLE(d*4)}:function(d){return r.readFloatBE(d*4)},l={NC:s(0),NR:s(1),NS:s(2),MODE:s(3),NCSTART:s(4),NRSTART:s(5),NSSTART:s(6),NX:s(7),NY:s(8),NZ:s(9),xLength:u(10),yLength:u(11),zLength:u(12),alpha:u(13),beta:u(14),gamma:u(15),MAPC:s(16),MAPR:s(17),MAPS:s(18),AMIN:u(19),AMAX:u(20),AMEAN:u(21),ISPG:s(22),NSYMBT:s(23),LSKFLG:s(24),SKWMAT:[],SKWTRN:[],userFlag1:s(39),userFlag2:s(40),originX:u(49),originY:u(50),originZ:u(51),MAP:n,MACHST:a,ARMS:u(54)},[2,{header:l,littleEndian:i}]}})})}function Ibe(e,t,r,n,a,i){return pe(this,void 0,void 0,function(){var o,s,u,l,c,d;return he(this,function(f){switch(f.label){case 0:return $q(e)?(o=3*a,[4,r.readBuffer(n,t.readBuffer,a,o)]):[3,2];case 1:for(f.sent(),s=new Int8Array(t.valuesBuffer.buffer,o),u=(e.AMAX-e.AMIN)/255,l=.5*(e.AMIN+e.AMAX+u),c=0,d=a;c<d;++c)t.values[c]=u*s[c]+l;return[3,4];case 2:return[4,Ebe(t,r,n,a,0,i)];case 3:f.sent(),f.label=4;case 4:return[2]}})})}function Kq(e){switch(e){case 0:return Ii.Int8;case 1:return Ii.Int16;case 2:return Ii.Float32;case 3:throw new Error("mode 3 unsupported, complex 16-bit integers");case 4:throw new Error("mode 4 unsupported, complex 32-bit reals");case 6:Ii.Uint16;case 16:throw new Error("mode 16 unsupported, unsigned char * 3 (for rgb data, non-standard)")}throw new Error("unknown mode '"+e+"'")}function $q(e){return e.userFlag1===-128&&e.userFlag2===127}function Qq(e){return $q(e)?Ii.Float32:Kq(e.MODE)}function Mbe(e){return 256*4+e.NSYMBT}function Dbe(e,t,r){return pe(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d,f,p;return he(this,function(h){switch(h.label){case 0:return[4,r.update({message:"Parsing CCP4/MRC/MAP file..."})];case 1:return h.sent(),[4,Pbe(e)];case 2:return n=h.sent(),a=n.header,i=n.littleEndian,o=Mbe(a),s=Kq(a.MODE),u=Qq(a),l=a.NC*a.NR*a.NS,c=Yq(s),d=l*c,f=Tbe(l,u),Ibe(a,f,e,o,d,i),p={header:a,values:f.values,name:e.name},[2,p]}})})}function kbe(e,t){var r=this;return Qe.create("Parse CCP4/MRC/MAP",function(n){return pe(r,void 0,void 0,function(){var a,i,o;return he(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),i=(a=Nn).success,[4,Dbe(e,t,n)];case 1:return[2,i.apply(a,[s.sent()])];case 2:return o=s.sent(),[2,Nn.error(o)];case 3:return[2]}})})})}function Rbe(e,t){return kbe(EC.fromBuffer(Yu.fromUint8Array(e),t),e.length)}function tn(e){return function(t){return nk(e,t)}}function nk(e,t){var r=e.data,n=e.indices,a=e.count,i=t.valueType,o=i==="str"?function(s){return r.substring(n[2*s],n[2*s+1])}:i==="int"?function(s){return sp(r,n[2*s],n[2*s+1])||0}:function(s){return td(r,n[2*s],n[2*s+1])||0};return{schema:t,__array:void 0,isDefined:!0,rowCount:a,value:o,valueKind:function(s){return 0},toArray:function(s){return hi(a,o,s)},areValuesEqual:Zq(e)}}function Zq(e){var t=e.data,r=e.indices;return function(n,a){var i=r[2*n],o=r[2*a],s=r[2*n+1]-i;if(s!==r[2*a+1]-o)return!1;for(var u=0;u<s;u++)if(t.charCodeAt(u+i)!==t.charCodeAt(u+o))return!1;return!0}}function Jq(e,t){return{name:t,blocks:e}}function ak(e,t,r,n){return n===void 0&&(n=[]),{categoryNames:e,header:r,categories:t,saveFrames:n,getField:function(a){var i=a.split("."),o=i[0],s=i[1];return t[o].getField(s||"")}}}function Obe(e,t,r){return{categoryNames:e,header:r,categories:t}}function Mi(e,t,r,n){return{rowCount:t,name:e,fieldNames:Gt([],r),getField:function(a){return n[a]}}}(function(e){function t(a){return{rowCount:0,name:a,fieldNames:[],getField:function(i){}}}e.empty=t;function r(a,i){var o=Object.keys(i);return{rowCount:o.length>0?i[o[0]].rowCount:0,name:a,fieldNames:o,getField:function(s){return i[s]}}}e.ofFields=r;function n(a,i){for(var o={},s=0,u=i._columns;s<u.length;s++){var l=u[s];o[l]=Pt.ofColumn(i[l])}return r(a,o)}e.ofTable=n})(Mi||(Mi={}));var Pt;(function(e){function t(s){return r([s])}e.ofString=t;function r(s){var u=s.length,l=function(p){var h=s[p];return!h||h==="."||h==="?"?"":h},c=function(p){var h=s[p];return sp(h,0,h.length)||0},d=function(p){var h=s[p];return td(h,0,h.length)||0},f=function(p){var h=s[p],m=h.length;if(m>1)return 0;if(m===0)return 1;var v=h.charCodeAt(0);return v===46?1:v===63?2:0};return{__array:void 0,binaryEncoding:void 0,isDefined:!0,rowCount:u,str:l,int:c,float:d,valueKind:f,areValuesEqual:function(p,h){return s[p]===s[h]},toStringArray:function(p){return p?hi(u,l,p):s},toIntArray:function(p){return hi(u,c,p)},toFloatArray:function(p){return hi(u,d,p)}}}e.ofStrings=r;function n(s){var u=s.length,l=function(p){return""+s[p]},c=function(p){return s[p]},d=function(p){return 0},f=function(p){return!p||p.array&&s instanceof p.array?s:hi(u,c,p)};return{__array:void 0,binaryEncoding:void 0,isDefined:!0,rowCount:u,str:l,int:c,float:c,valueKind:d,areValuesEqual:function(p,h){return s[p]===s[h]},toStringArray:function(p){return hi(u,l,p)},toIntArray:f,toFloatArray:f}}e.ofNumbers=n;function a(s){var u=s.data,l=s.indices,c=s.count,d=function(m){var v=u.substring(l[2*m],l[2*m+1]);return v==="."||v==="?"?"":v},f=function(m){return sp(u,l[2*m],l[2*m+1])||0},p=function(m){return td(u,l[2*m],l[2*m+1])||0},h=function(m){var v=l[2*m],g=l[2*m+1]-v;if(g>1)return 0;if(g===0)return 1;var y=u.charCodeAt(v);return y===46?1:y===63?2:0};return{__array:void 0,binaryEncoding:void 0,isDefined:!0,rowCount:c,str:d,int:f,float:p,valueKind:h,areValuesEqual:Zq(s),toStringArray:function(m){return hi(c,d,m)},toIntArray:function(m){return hi(c,f,m)},toFloatArray:function(m){return hi(c,p,m)}}}e.ofTokens=a;function i(s){var u=s.rowCount,l=s.valueKind,c=s.areValuesEqual,d=s.isDefined,f,p,h;switch(s.schema.valueType){case"float":case"int":f=function(v){return""+s.value(v)},p=s.value,h=s.value;break;case"str":f=s.value,p=function(v){var g=s.value(v);return sp(g,0,g.length)||0},h=function(v){var g=s.value(v);return td(g,0,g.length)||0};break;case"list":var m=s.schema.separator;f=function(v){return s.value(v).join(m)},p=function(v){return NaN},h=function(v){return NaN};break;default:throw new Error("unsupported valueType '"+s.schema.valueType+"'")}return{__array:void 0,binaryEncoding:void 0,isDefined:d,rowCount:u,str:f,int:p,float:h,valueKind:l,areValuesEqual:c,toStringArray:function(v){return hi(u,f,v)},toIntArray:function(v){return hi(u,p,v)},toFloatArray:function(v){return hi(u,h,v)}}}e.ofColumn=i;function o(s,u){return i(ye.Undefined(s,u))}e.ofUndefined=o})(Pt||(Pt={}));function Bbe(e,t,r,n){var a=r?0:1;switch(t){case 1:return n==="brackets"?function(i){return e+"["+(i+a)+"]"}:function(i){return e+"_"+(i+a)};case 2:return n==="brackets"?function(i,o){return e+"["+(i+a)+"]["+(o+a)+"]"}:function(i,o){return e+"_"+(i+a)+(o+a)};case 3:return n==="brackets"?function(i,o,s){return e+"["+(i+a)+"]["+(o+a)+"]["+(s+a)+"]"}:function(i,o,s){return e+"_"+(i+a)+(o+a)+(s+a)};default:throw new Error("Tensors with rank > 3 or rank 0 are currently not supported.")}}function Fbe(e,t,r,n){var a=t.create();if(t.rank===1)for(var i=t.dimensions[0],o=0;o<i;o++){var s=e.getField(n(o));t.set(a,o,s?s.float(r):0)}else if(t.rank===2)for(var i=t.dimensions[0],u=t.dimensions[1],o=0;o<i;o++)for(var l=0;l<u;l++){var s=e.getField(n(o,l));t.set(a,o,l,s?s.float(r):0)}else if(t.rank===3)for(var c=t.dimensions[0],d=t.dimensions[1],f=t.dimensions[2],o=0;o<c;o++)for(var l=0;l<d;l++)for(var p=0;p<f;p++){var s=e.getField(n(o,l,p));t.set(a,o,l,p,s?s.float(r):0)}else throw new Error("Tensors with rank > 3 or rank 0 are currently not supported.");return a}function Bt(e){return{data:e,position:0,length:e.length,lineNumber:1,tokenStart:0,tokenEnd:0}}(function(e){function t(y){return y.data.substring(y.tokenStart,y.tokenEnd)}e.getTokenString=t;function r(y){y.position=0,y.lineNumber=1,y.tokenStart=0,y.tokenEnd=0}e.reset=r;function n(y){for(var b=y.data;y.position<y.length;)switch(b.charCodeAt(y.position)){case 10:return y.tokenEnd=y.position,++y.position,++y.lineNumber,!0;case 13:return y.tokenEnd=y.position,++y.position,++y.lineNumber,b.charCodeAt(y.position)===10&&++y.position,!0;default:++y.position;break}return y.tokenEnd=y.position,y.tokenStart!==y.tokenEnd}e.eatLine=n;function a(y){y.tokenStart=y.position}e.markStart=a;function i(y){return y.tokenStart=y.position,n(y)}e.markLine=i;function o(y){return i(y),t(y)}e.readLine=o;function s(y){i(y);var b=y.position;return g(y,y.tokenStart,y.tokenEnd),y.position=b,t(y)}e.readLineTrim=s;function u(y,b,S){for(var x=0,C=0;C<b;C++){if(!i(y))return x;yt.addUnchecked(S,y.tokenStart,y.tokenEnd),x++}return x}function l(y,b){var S=yt.create(y.data,b*2);return u(y,b,S),S}e.markLines=l;function c(y,b){for(var S=[],x=0;x<b;x++)S.push(e.readLine(y));return S}e.readLines=c;function d(y,b,S,x){return x===void 0&&(x=1e5),pe(this,void 0,void 0,function(){var C,w,_;return he(this,function(E){switch(E.label){case 0:return C=y.length,w=yt.create(y.data,b*2),_=0,[4,fd(S,x,y,function(P,D){var k=Math.min(b-_,P);return u(D,k,w),_+=k,k},function(P,D){return P.update({message:"Parsing...",current:D.position,max:C})})];case 1:return E.sent(),[2,w]}})})}e.readLinesAsync=d;function f(y){for(var b=e(y),S=yt.create(b.data,Math.max(y.length/80,2));i(b);)yt.add(S,b.tokenStart,b.tokenEnd);return S}e.readAllLines=f;function p(y,b,S){for(var x=0,C=0;C<b;C++){if(!i(y))return x;yt.add(S,y.tokenStart,y.tokenEnd),x++}return x}function h(y,b,S){return S===void 0&&(S=1e5),pe(this,void 0,void 0,function(){var x,C;return he(this,function(w){switch(w.label){case 0:return x=e(y),C=yt.create(x.data,Math.max(y.length/80,2)),[4,fd(b,S,x,function(_,E){return p(E,_,C),E.position<E.length?_:0},function(_,E){return _.update({message:"Parsing...",current:E.position,max:length})})];case 1:return w.sent(),[2,C]}})})}e.readAllLinesAsync=h;function m(y){for(;y.position<y.length;)switch(y.data.charCodeAt(y.position)){case 9:case 10:case 13:case 32:y.tokenEnd=y.position;return;default:++y.position;break}y.tokenEnd=y.position}e.eatValue=m;function v(y){for(var b=-1;y.position<y.length;){var S=y.data.charCodeAt(y.position);switch(S){case 9:case 32:b=S,++y.position;break;case 10:b!==13&&++y.lineNumber,b=S,++y.position;break;case 13:b=S,++y.position,++y.lineNumber;break;default:return b}}return b}e.skipWhitespace=v;function g(y,b,S){for(var x=y.data,C=b,w=S-1,_=x.charCodeAt(C);(_===9||_===32)&&C<=w;)_=x.charCodeAt(++C);for(_=x.charCodeAt(w);(_===9||_===32)&&w>=C;)_=x.charCodeAt(--w);return y.tokenStart=C,y.tokenEnd=w+1,y.position=S,y}e.trim=g})(Bt||(Bt={}));function Lbe(e,t,r){for(var n=t,a=r-1,i=e.charCodeAt(n);(i===9||i===32)&&n<=a;)i=e.charCodeAt(++n);for(i=e.charCodeAt(a);(i===9||i===32)&&a>=n;)i=e.charCodeAt(--a);return e.substring(n,a+1)}var yt;(function(e){function t(o){var s=new Uint32Array(1.61*o.indices.length|0);s.set(o.indices),o.indices=s,o.indicesLenMinus2=s.length-2|0}function r(o,s,u){var l=o;l.offset>l.indicesLenMinus2&&t(l),l.indices[l.offset++]=s,l.indices[l.offset++]=u,o.count++}e.add=r;function n(o,s){r(o,s.tokenStart,s.tokenEnd)}e.addToken=n;function a(o,s,u){o.indices[o.offset++]=s,o.indices[o.offset++]=u,o.count++}e.addUnchecked=a;function i(o,s){return s=Math.max(10,s),{data:o,indicesLenMinus2:s-2|0,count:0,offset:0,indices:new Uint32Array(s)}}e.create=i})(yt||(yt={}));function wF(e){for(;e.position<e.length;)switch(e.data.charCodeAt(e.position)){case 9:case 10:case 13:case 32:e.tokenEnd=e.position;return;default:++e.position;break}e.tokenEnd=e.position}function Nbe(e,t){var r,n;for(++e.position;e.position<e.length;)if(n=e.data.charCodeAt(e.position),n===t)switch(r=e.data.charCodeAt(e.position+1),r){case 9:case 10:case 13:case 32:e.tokenStart++,e.tokenEnd=e.position,e.isEscaped=!0,++e.position;return;default:if(r===void 0){e.tokenStart++,e.tokenEnd=e.position,e.isEscaped=!0,++e.position;return}++e.position;break}else{if(n===10||n===13){e.tokenEnd=e.position;return}++e.position}e.tokenEnd=e.position}function zbe(e){for(e.position+=3;e.position<e.length;){if(e.data.charCodeAt(e.position)===39&&eW(e)){e.tokenStart+=3,e.tokenEnd=e.position,e.isEscaped=!0,e.position+=3;return}++e.position}e.tokenEnd=e.position}function Ube(e){for(var t=59,r=e.position+1,n;r<e.length;)if(n=e.data.charCodeAt(r),n===59&&(t===10||t===13)){for(e.position=r+1,e.tokenStart++,r--,n=e.data.charCodeAt(r);n===10||n===13;)r--,n=e.data.charCodeAt(r);e.tokenEnd=r+1,e.isEscaped=!0;return}else(n===13||n===10&&t!==13)&&e.lineNumber++,t=n,++r;return e.position=r,t}function Vbe(e){for(;e.position<e.length;)switch(e.data.charCodeAt(e.position)){case 93:++e.position,e.tokenEnd=e.position,e.isImportGet=!1;return;default:++e.position;break}}function Hbe(e){for(;e.position<e.length;){var t=e.data.charCodeAt(e.position);if(t===10||t===13)return;++e.position}}function jbe(e){for(var t=10;e.position<e.length;){var r=e.data.charCodeAt(e.position);switch(r){case 9:case 32:t=r,++e.position;break;case 10:t!==13&&++e.lineNumber,t=r,++e.position;break;case 13:t=r,++e.position,++e.lineNumber;break;default:return t}}return t}function eW(e){return!(e.length-e.position<2||e.data.charCodeAt(e.position+1)!==39||e.data.charCodeAt(e.position+2)!==39)}function Gbe(e){var t=e.data.charCodeAt(e.tokenStart);return!(t!==68&&t!==100||(t=e.data.charCodeAt(e.tokenStart+1),t!==65&&t!==97)||(t=e.data.charCodeAt(e.tokenStart+2),t!==84&&t!==116)||(t=e.data.charCodeAt(e.tokenStart+3),t!==65&&t!==97))}function qbe(e){var t=e.data.charCodeAt(e.tokenStart);return!(t!==83&&t!==115||(t=e.data.charCodeAt(e.tokenStart+1),t!==65&&t!==97)||(t=e.data.charCodeAt(e.tokenStart+2),t!==86&&t!==118)||(t=e.data.charCodeAt(e.tokenStart+3),t!==69&&t!==101))}function Wbe(e){if(e.tokenEnd-e.tokenStart!==5)return!1;var t=e.data.charCodeAt(e.tokenStart);return!(t!==76&&t!==108||(t=e.data.charCodeAt(e.tokenStart+1),t!==79&&t!==111)||(t=e.data.charCodeAt(e.tokenStart+2),t!==79&&t!==111)||(t=e.data.charCodeAt(e.tokenStart+3),t!==80&&t!==112))}function Xbe(e){return!(e.tokenEnd-e.tokenStart!==11||e.data.charCodeAt(e.tokenStart+1)!==105||e.data.charCodeAt(e.tokenStart+2)!==109||e.data.charCodeAt(e.tokenStart+3)!==112||e.data.charCodeAt(e.tokenStart+4)!==111||e.data.charCodeAt(e.tokenStart+5)!==114||e.data.charCodeAt(e.tokenStart+6)!==116||e.data.charCodeAt(e.tokenStart+7)!==46||e.data.charCodeAt(e.tokenStart+8)!==103||e.data.charCodeAt(e.tokenStart+9)!==101||e.data.charCodeAt(e.tokenStart+10)!==116)}function Ybe(e,t,r){var n,a=r-t,i=e.tokenStart-t,o=e.tokenEnd-e.tokenStart;if(o<a)return!1;for(n=t;n<r;++n)if(e.data.charCodeAt(n)!==e.data.charCodeAt(n+i))return!1;return a===o||e.data.charCodeAt(n+i)===46}function tW(e){var t;for(t=e.tokenStart;t<e.tokenEnd;++t)if(e.data.charCodeAt(t)===46)return t;return t}function rW(e,t){return e.data.substring(e.tokenStart,t)}function Kbe(e){var t;for(t=e.tokenStart;t<e.tokenEnd;++t)if(e.data.charCodeAt(t)===46)return!1;return!0}function ZP(e){return e.data.substring(e.tokenStart,e.tokenEnd)}function _F(e){var t=jbe(e);if(e.position>=e.length){e.tokenType=6;return}e.tokenStart=e.position,e.tokenEnd=e.position,e.isEscaped=!1;var r=e.data.charCodeAt(e.position);switch(r){case 35:Hbe(e),e.tokenType=5;break;case 39:if(eW(e)){zbe(e),e.tokenType=3;break}case 34:Nbe(e,r),e.tokenType=3;break;case 59:t===10||t===13?Ube(e):wF(e),e.tokenType=3;break;default:e.isImportGet?Vbe(e):wF(e),e.isEscaped?e.tokenType=3:e.data.charCodeAt(e.tokenStart)===95?(e.inSaveFrame&&Xbe(e)&&(e.isImportGet=!0),e.tokenType=4):e.tokenEnd-e.tokenStart>=5&&e.data.charCodeAt(e.tokenStart+4)===95?Gbe(e)?e.tokenType=0:qbe(e)?e.tokenType=1:Wbe(e)?e.tokenType=2:e.tokenType=3:e.tokenType=3;break}}function lp(e){for(_F(e);e.tokenType===5;)_F(e)}function $be(e,t){return{data:e,length:e.length,position:0,tokenStart:0,tokenEnd:0,tokenType:6,lineNumber:1,isEscaped:!1,isImportGet:!1,inSaveFrame:!1,runtimeCtx:t}}function O2(){return{categoryNames:[],categoryData:Object.create(null)}}function ik(e,t){for(var r=Object.create(null),n=0,a=e;n<a.length;n++){var i=a[n],o=t[i];r[i]=Mi(o.name,o.rowCount,o.fieldNames,o.fields)}return r}function AF(e,t,r){return ak(e.categoryNames,ik(e.categoryNames,e.categoryData),t,r)}function Qbe(e,t){return ak(e.categoryNames,ik(e.categoryNames,e.categoryData),t)}function JP(e,t,r,n,a){var i;if(t in e.categoryData){var o=e.categoryData[t];(i=o.fieldNames).push.apply(i,n),Object.assign(o.fields,a)}else e.categoryData[t]={name:t,rowCount:r,fieldNames:n,fields:a},e.categoryNames.push(t)}function Zbe(e,t){for(var r=e.tokenStart,n=tW(e),a=rW(e,n),i=Object.create(null),o=[],s=!0;s;){if(e.tokenType!==4||!Ybe(e,r,n)){s=!1;break}var u=ZP(e).substring(a.length+1);if(lp(e),e.tokenType!==3)return{hasError:!0,errorLine:e.lineNumber,errorMessage:"Expected value."};i[u]=Pt.ofTokens({data:e.data,indices:[e.tokenStart,e.tokenEnd],count:1}),o[o.length]=u,lp(e)}return JP(t,a.substr(1),1,o,i),{hasError:!1,errorLine:0,errorMessage:""}}function Jbe(e,t){for(var r=t.tokenizer,n=t.tokens,a=t.fieldCount,i=t.tokenCount,o=0;r.tokenType===3&&o<e;)yt.add(n[i++%a],r.tokenStart,r.tokenEnd),lp(r),o++;return t.tokenCount=i,o}function e2e(e,t){return e.update({message:"Parsing...",current:t.tokenizer.position,max:t.tokenizer.data.length})}function t2e(e,t){return pe(this,void 0,void 0,function(){var r,n,a,i,o,s,u,f,l,c,f,d,d,f;return he(this,function(p){switch(p.label){case 0:for(r=e.lineNumber,lp(e),n=rW(e,tW(e)),a=Kbe(e),i=[];e.tokenType===4;)i[i.length]=a?ZP(e):ZP(e).substring(n.length+1),lp(e);for(o=n==="_atom_site"?e.data.length/100|0:32,s=[],u=i.length,f=0;f<u;f++)s[f]=yt.create(e.data,o);return l={fieldCount:u,tokenCount:0,tokenizer:e,tokens:s},[4,fd(e.runtimeCtx,1e6,l,Jbe,e2e)];case 1:if(p.sent(),l.tokenCount%u!==0)return[2,{hasError:!0,errorLine:e.lineNumber,errorMessage:"The number of values for loop starting at line "+r+" is not a multiple of the number of columns."}];if(c=l.tokenCount/u|0,a)for(f=0;f<u;f++)d={"":Pt.ofTokens(s[f])},JP(t,i[f].substr(1),c,[""],d);else{for(d=Object.create(null),f=0;f<u;f++)d[i[f]]=Pt.ofTokens(s[f]);JP(t,n.substr(1),c,i,d)}return[2,{hasError:!1,errorLine:0,errorMessage:""}]}})})}function Ym(e,t){return Nn.error(t,e)}function r2e(e){return Nn.success(e)}function n2e(e,t){return pe(this,void 0,void 0,function(){var r,n,a,i,o,s,u,l,c,d,d;return he(this,function(f){switch(f.label){case 0:r=[],n=$be(e,t),a="",i=O2(),o=[],s=O2(),u=Obe(s.categoryNames,ik(s.categoryNames,s.categoryData),""),l="",t.update({message:"Parsing...",current:0,max:e.length}),lp(n),f.label=1;case 1:return n.tokenType===6?[3,7]:(c=n.tokenType,c!==0?[3,2]:n.inSaveFrame?[2,Ym(n.lineNumber,"Unexpected data block inside a save frame.")]:(i.categoryNames.length>0&&r.push(AF(i,a,o)),a=e.substring(n.tokenStart+5,n.tokenEnd),i=O2(),o=[],lp(n),[3,6]));case 2:if(c!==1)return[3,3];if(n.tokenEnd-n.tokenStart===5)s.categoryNames.length>0&&(o[o.length]=Qbe(s,l)),n.inSaveFrame=!1;else{if(n.inSaveFrame)return[2,Ym(n.lineNumber,"Save frames cannot be nested.")];n.inSaveFrame=!0,l=e.substring(n.tokenStart+5,n.tokenEnd),s=O2()}return lp(n),[3,6];case 3:return c!==2?[3,5]:[4,t2e(n,n.inSaveFrame?s:i)];case 4:return d=f.sent(),d.hasError?[2,Ym(d.errorLine,d.errorMessage)]:[3,6];case 5:if(c===4){if(d=Zbe(n,n.inSaveFrame?s:i),d.hasError)return[2,Ym(d.errorLine,d.errorMessage)]}else return console.log(n.tokenType,Bt.getTokenString(n)),[2,Ym(n.lineNumber,"Unexpected token. Expected data_, loop_, or data name.")];f.label=6;case 6:return[3,1];case 7:return n.inSaveFrame?[2,Ym(n.lineNumber,"Unfinished save frame ("+u.header+").")]:((i.categoryNames.length>0||o.length>0)&&r.push(AF(i,a,o)),[2,r2e(Jq(r))])}})})}function TF(e){var t=this;return Qe.create("Parse CIF",function(r){return pe(t,void 0,void 0,function(){return he(this,function(n){switch(n.label){case 0:return[4,n2e(e,r)];case 1:return[2,n.sent()]}})})})}var a2e=new Uint16Array(new Uint8Array([18,52]).buffer)[0]===13330;function i2e(e,t){for(var r=new ArrayBuffer(e.length),n=new Uint8Array(r),a=0,i=e.length;a<i;a+=t)for(var o=0;o<t;o++)n[a+t-o-1]=e[a+o];return r}var lA=28672;function o2e(e){if(e.length>lA){for(var t=[],r=0;r<e.length;r+=lA)t.push(String.fromCharCode.apply(null,e.subarray(r,r+lA)));return t.join("")}else return String.fromCharCode.apply(null,e)}function PC(e){for(var t=e.data,r=e.encoding.length-1;r>=0;r--)t=s2e(t,e.encoding[r]);return t}function s2e(e,t){switch(t.kind){case"ByteArray":switch(t.type){case 4:return e;case 1:return u2e(e);case 2:return l2e(e);case 5:return c2e(e);case 3:return d2e(e);case 6:return f2e(e);case 32:return p2e(e);case 33:return h2e(e);default:throw new Error("Unsupported ByteArray type.")}case"FixedPoint":return m2e(e,t);case"IntervalQuantization":return v2e(e,t);case"RunLength":return g2e(e,t);case"Delta":return y2e(e,t);case"IntegerPacking":return S2e(e,t);case"StringArray":return C2e(e,t)}}function nW(e,t){switch(e){case 1:return new Int8Array(t);case 2:return new Int16Array(t);case 3:return new Int32Array(t);case 4:return new Uint8Array(t);case 5:return new Uint16Array(t);case 6:return new Uint32Array(t);default:throw new Error("Unsupported integer data type.")}}function aW(e,t){switch(e){case 32:return new Float32Array(t);case 33:return new Float64Array(t);default:throw new Error("Unsupported floating data type.")}}function u2e(e){return new Int8Array(e.buffer,e.byteOffset)}function B0(e,t,r){return a2e?new r(e.buffer):new r(i2e(e,t))}function l2e(e){return B0(e,2,Int16Array)}function c2e(e){return B0(e,2,Uint16Array)}function d2e(e){return B0(e,4,Int32Array)}function f2e(e){return B0(e,4,Uint32Array)}function p2e(e){return B0(e,4,Float32Array)}function h2e(e){return B0(e,8,Float64Array)}function m2e(e,t){for(var r=e.length,n=aW(t.srcType,r),a=1/t.factor,i=0;i<r;i++)n[i]=a*e[i];return n}function v2e(e,t){for(var r=e.length,n=aW(t.srcType,r),a=(t.max-t.min)/(t.numSteps-1),i=t.min,o=0;o<r;o++)n[o]=i+a*e[o];return n}function g2e(e,t){for(var r=nW(t.srcType,t.srcSize),n=0,a=0,i=e.length;a<i;a+=2)for(var o=e[a],s=e[a+1],u=0;u<s;++u)r[n++]=o;return r}function y2e(e,t){var r=e.length,n=nW(t.srcType,r);if(!r)return e;n[0]=e[0]+(t.origin|0);for(var a=1;a<r;++a)n[a]=e[a]+n[a-1];return n}function b2e(e,t){for(var r=t.byteCount===1?127:32767,n=-r-1,a=e.length,i=new Int32Array(t.srcSize),o=0,s=0;o<a;){for(var u=0,l=e[o];l===r||l===n;)u+=l,o++,l=e[o];u+=l,i[s]=u,o++,s++}return i}function x2e(e,t){for(var r=t.byteCount===1?255:65535,n=e.length,a=new Int32Array(t.srcSize),i=0,o=0;i<n;){for(var s=0,u=e[i];u===r;)s+=u,i++,u=e[i];s+=u,a[o]=s,i++,o++}return a}function S2e(e,t){return e.length===t.srcSize?e:t.isUnsigned?x2e(e,t):b2e(e,t)}function C2e(e,t){var r=PC({encoding:t.offsetEncoding,data:t.offsets}),n=PC({encoding:t.dataEncoding,data:e}),a=t.stringData,i=new Array(r.length);i[0]="";for(var o=1,s=r.length;o<s;o++)i[o]=a.substring(r[o-1],r[o]);for(var u=0,l=new Array(n.length),o=0,s=n.length;o<s;o++)l[u++]=i[n[o]+1];return l}var w2e="0.3.0",Ef;(function(e){function t(n){var a;return n instanceof Int8Array?a=1:n instanceof Int16Array?a=2:n instanceof Int32Array?a=3:n instanceof Uint8Array?a=4:n instanceof Uint16Array?a=5:n instanceof Uint32Array?a=6:n instanceof Float32Array?a=32:n instanceof Float64Array?a=33:a=3,a}e.getDataType=t;function r(n){if(n instanceof Int8Array||n instanceof Int16Array||n instanceof Int32Array)return!0;for(var a=0,i=n.length;a<i;a++)if(a<0)return!1;return!0}e.isSignedIntegerDataType=r})(Ef||(Ef={}));function _2e(e,t,r){var n=1,a;for(a=0;a<t;a++){var i=n*e;if(Math.abs(Math.round(i)-i)<=r)return a;n*=10}return-1}function A2e(e,t){var r=Math.abs(e);return r<t?0:Math.floor(Math.log10(Math.abs(e)))+1}function T2e(e,t,r){for(var n=1,a=0,i=0,o=e.length;i<o;i++){if(n>=0){var s=_2e(e[i],t,r);s<0?n=-1:s>n&&(n=s)}var u=Math.abs(e[i]);if(u>r){var l=Math.floor(Math.log10(Math.abs(u)))+1;l>a&&(a=l)}}return{mantissaDigits:n,integerDigits:a}}function E2e(e){e=e.trim();var t=parseInt(e,10);return isNaN(t)?!1:t.toString()===e}function IC(e){if(!isFinite(e))return 0;for(var t=1,r=0;Math.round(e*t)/t!==e;)t*=10,++r;return r}function e5(e,t){return parseFloat(e.toPrecision(t))}function t5(e){return M1.classify(e)}function P2e(e){return r5.classify(e)}var M1;(function(e){function t(p,h){return p>=0?Math.ceil((p+1)/h):Math.ceil((p+1)/(-h-1))}function r(p){for(var h=!1,m=0,v=p.length;m<v;m++)if(p[m]<0){h=!0;break}return h?{signed:h,limit8:127,limit16:32767}:{signed:h,limit8:255,limit16:65535}}function n(){return{pack8:0,pack16:0,count:0}}function a(p,h,m){var v=p.limit8,g=p.limit16;h.pack8+=t(m,v),h.pack16+=t(m,g),h.count+=1}function i(p,h){p.pack8+=t(h,127),p.pack16+=t(h,32767),p.count+=1}function o(p){return p.count*4<p.pack16*2?{length:p.count*4,elem:4}:p.pack16*2<p.pack8?{length:p.pack16*2,elem:2}:{length:p.pack8,elem:1}}function s(p,h){for(var m=n(),v=0,g=p.length;v<g;v++)a(h,m,p[v]);return T(T({},o(m)),{kind:"pack"})}function u(p,h){for(var m=n(),v=p[0],g=1,y=p.length;g<y;g++)i(m,p[g]-v),v=p[g];return T(T({},o(m)),{kind:"delta"})}function l(p,h){for(var m=n(),v=1,g=1,y=p.length;g<y;g++)p[g-1]!==p[g]?(a(h,m,p[g-1]),a(h,m,v),v=1):v++;return a(h,m,p[p.length-1]),a(h,m,v),T(T({},o(m)),{kind:"rle"})}function c(p,h){for(var m=n(),v=1,g=0,y=0,b=1,S=p.length;b<S;b++){var x=p[b]-g;y!==x?(i(m,y),i(m,v),v=1):v++,y=x,g=p[b]}return i(m,y),i(m,v),T(T({},o(m)),{kind:"delta-rle"})}function d(p){var h=r(p),m=[s(p,h),l(p,h),u(p),c(p)];return m.sort(function(v,g){return v.length-g.length}),m}e.getSize=d;function f(p){if(p.length<2)return wr.by(wr.byteArray);var h=d(p),m=h[0];switch(m.kind){case"pack":return wr.by(wr.integerPacking);case"rle":return wr.by(wr.runLength).and(wr.integerPacking);case"delta":return wr.by(wr.delta).and(wr.integerPacking);case"delta-rle":return wr.by(wr.delta).and(wr.runLength).and(wr.integerPacking)}throw new Error("should not happen :)")}e.classify=f})(M1||(M1={}));var r5;(function(e){var t=1e-6;function r(a){var i=4,o=T2e(a,i,t),s=o.mantissaDigits,u=o.integerDigits;if(s<0||s+u>10)return wr.by(wr.byteArray);if(s===0)return M1.classify(a);for(var l=n(s),c=new Int32Array(a.length),d=0,f=a.length;d<f;d++)c[d]=Math.round(l*a[d]);var p=M1.getSize(c),h=p[0],m=wr.by(wr.fixedPoint(l));switch(h.kind){case"pack":return m.and(wr.integerPacking);case"rle":return m.and(wr.runLength).and(wr.integerPacking);case"delta":return m.and(wr.delta).and(wr.integerPacking);case"delta-rle":return m.and(wr.delta).and(wr.runLength).and(wr.integerPacking)}throw new Error("should not happen :)")}e.classify=r;function n(a){for(var i=1,o=0;o<a;o++)i*=10;return i}})(r5||(r5={}));var iW=function(){function e(t){this.providers=t}return e.prototype.and=function(t){return new e(this.providers.concat([t]))},e.prototype.encode=function(t){for(var r=[],n=0,a=this.providers;n<a.length;n++){var i=a[n],o=i(t);if(!o.encodings.length)throw new Error("Encodings must be non-empty.");t=o.data;for(var s=0,u=o.encodings;s<u.length;s++){var l=u[s];r.push(l)}}if(!(t instanceof Uint8Array))throw new Error("The encoding must result in a Uint8Array. Fix your encoding chain.");return{encoding:r,data:t}},e}(),gp;(function(e){function t(a){return new iW([a])}e.by=t;function r(a){for(var i=t(n(a[0])),o=1;o<a.length;o++)i=i.and(n(a[o]));return i}e.fromEncoding=r;function n(a){switch(a.kind){case"ByteArray":return wr.byteArray;case"FixedPoint":return wr.fixedPoint(a.factor);case"IntervalQuantization":return wr.intervalQuantizaiton(a.min,a.max,a.numSteps);case"RunLength":return wr.runLength;case"Delta":return wr.delta;case"IntegerPacking":return wr.integerPacking;case"StringArray":return wr.stringArray}}})(gp||(gp={}));var wr;(function(e){var t,r;function n(x){return new iW([x])}e.by=n;function a(x){return{encodings:[{kind:"ByteArray",type:4}],data:x}}function i(x){return{encodings:[{kind:"ByteArray",type:1}],data:new Uint8Array(x.buffer,x.byteOffset)}}var o=(t={},t[2]=function(x,C,w){x.setInt16(2*C,w,!0)},t[5]=function(x,C,w){x.setUint16(2*C,w,!0)},t[3]=function(x,C,w){x.setInt32(4*C,w,!0)},t[6]=function(x,C,w){x.setUint32(4*C,w,!0)},t[32]=function(x,C,w){x.setFloat32(4*C,w,!0)},t[33]=function(x,C,w){x.setFloat64(8*C,w,!0)},t),s=(r={},r[2]=2,r[5]=2,r[3]=4,r[6]=4,r[32]=4,r[33]=8,r);function u(x){var C=Ef.getDataType(x);if(C===1)return i(x);if(C===4)return a(x);for(var w=new Uint8Array(x.length*s[C]),_=o[C],E=new DataView(w.buffer),P=0,D=x.length;P<D;P++)_(E,P,x[P]);return{encodings:[{kind:"ByteArray",type:C}],data:w}}e.byteArray=u;function l(x,C){for(var w=Ef.getDataType(x),_=new Int32Array(x.length),E=0,P=x.length;E<P;E++)_[E]=Math.round(x[E]*C);return{encodings:[{kind:"FixedPoint",factor:C,srcType:w}],data:_}}function c(x){return function(C){return l(C,x)}}e.fixedPoint=c;function d(x,C,w,_,E){var P=Ef.getDataType(x);if(!x.length)return{encodings:[{kind:"IntervalQuantization",min:C,max:w,numSteps:_,srcType:P}],data:new Int32Array(0)};if(w<C){var D=C;C=w,w=D}for(var k=(w-C)/(_-1),F=new E(x.length),X=0,U=x.length;X<U;X++){var j=x[X];j<=C?F[X]=0:j>=w?F[X]=_-1:F[X]=Math.round((j-C)/k)|0}return{encodings:[{kind:"IntervalQuantization",min:C,max:w,numSteps:_,srcType:P}],data:F}}function f(x,C,w,_){return _===void 0&&(_=Int32Array),function(E){return d(E,x,C,w,_)}}e.intervalQuantizaiton=f;function p(x){var C=Ef.getDataType(x);if(C===void 0&&(x=new Int32Array(x),C=3),!x.length)return{encodings:[{kind:"RunLength",srcType:C,srcSize:0}],data:new Int32Array(0)};for(var w=2,_=1,E=x.length;_<E;_++)x[_-1]!==x[_]&&(w+=2);for(var P=new Int32Array(w),D=0,k=1,_=1,E=x.length;_<E;_++)x[_-1]!==x[_]?(P[D]=x[_-1],P[D+1]=k,k=1,D+=2):++k;return P[D]=x[x.length-1],P[D+1]=k,{encodings:[{kind:"RunLength",srcType:C,srcSize:x.length}],data:P}}e.runLength=p;function h(x){if(!Ef.isSignedIntegerDataType(x))throw new Error("Only signed integer types can be encoded using delta encoding.");var C=Ef.getDataType(x);if(C===void 0&&(x=new Int32Array(x),C=3),!x.length)return{encodings:[{kind:"Delta",origin:0,srcType:C}],data:new x.constructor(0)};var w=new x.constructor(x.length),_=x[0];w[0]=x[0];for(var E=1,P=x.length;E<P;E++)w[E]=x[E]-x[E-1];return w[0]=0,{encodings:[{kind:"Delta",origin:_,srcType:C}],data:w}}e.delta=h;function m(x){for(var C=0,w=x.length;C<w;C++)if(x[C]<0)return!0;return!1}function v(x,C){for(var w=-C-1,_=0,E=0,P=x.length;E<P;E++){var D=x[E];D===0?_+=1:D>0?(_+=Math.ceil(D/C),D%C===0&&(_+=1)):(_+=Math.ceil(D/w),D%w===0&&(_+=1))}return _}function g(x){var C=m(x),w=C?v(x,127):v(x,255),_=C?v(x,32767):v(x,65535);return x.length*4<_*2?{isSigned:C,size:x.length,bytesPerElement:4}:_*2<w?{isSigned:C,size:_,bytesPerElement:2}:{isSigned:C,size:w,bytesPerElement:1}}function y(x,C){for(var w=C.isSigned?C.bytesPerElement===1?127:32767:C.bytesPerElement===1?255:65535,_=-w-1,E=x.length,P=C.isSigned?C.bytesPerElement===1?new Int8Array(C.size):new Int16Array(C.size):C.bytesPerElement===1?new Uint8Array(C.size):new Uint16Array(C.size),D=0,k=0;k<E;k++){var F=x[k];if(F>=0)for(;F>=w;)P[D]=w,++D,F-=w;else for(;F<=_;)P[D]=_,++D,F-=_;P[D]=F,++D}var X=u(P);return{encodings:[{kind:"IntegerPacking",byteCount:C.bytesPerElement,isUnsigned:!C.isSigned,srcSize:E},X.encodings[0]],data:X.data}}function b(x){var C=g(x);return C.bytesPerElement===4?u(x):y(x,C)}e.integerPacking=b;function S(x){var C=Object.create(null),w=[],_=new Int32Array(x.length),E=Ke.create(Int32Array,1,Math.min(1024,x.length<32?x.length+1:Math.round(x.length/8)+1));Ke.add(E,0);for(var P=0,D=0,k=0,F=x;k<F.length;k++){var X=F[k];if(X==null){_[D++]=-1;continue}var U=C[X];U===void 0&&(P+=X.length,U=w.length,w[U]=X,C[X]=U,Ke.add(E,P)),_[D++]=U}var j=Ke.compact(E),te=t5(j),q=te.encode(j),W=t5(_),V=W.encode(_);return{encodings:[{kind:"StringArray",dataEncoding:V.encoding,stringData:w.join(""),offsetEncoding:q.encoding,offsets:q.data}],data:V.data}}e.stringArray=S})(wr||(wr={}));function I2e(e){var t=e.mask?PC(e.mask):void 0,r=PC(e.data),n=UD(r),a=n?t?function(l){return t[l]===0?""+r[l]:""}:function(l){return""+r[l]}:t?function(l){return t[l]===0?r[l]:""}:function(l){return r[l]},i=n?function(l){return r[l]}:function(l){var c=r[l];return sp(c,0,c.length)},o=n?function(l){return r[l]}:function(l){var c=r[l];return td(c,0,c.length)},s=t?function(l){return t[l]}:function(l){return 0},u=r.length;return{__array:r,binaryEncoding:e.data.encoding,isDefined:!0,rowCount:u,str:a,int:i,float:o,valueKind:s,areValuesEqual:function(l,c){return r[l]===r[c]},toStringArray:function(l){return hi(u,a,l)},toIntArray:n?function(l){return bC(r,l)}:function(l){return hi(u,i,l)},toFloatArray:n?function(l){return bC(r,l)}:function(l){return hi(u,o,l)}}}function oW(e){return MC({buffer:e,offset:0,dataView:new DataView(e.buffer)})}function cA(e,t){for(var r={},n=0;n<t;n++){var a=MC(e);r[a]=MC(e)}return r}function dA(e,t){for(var r=new Uint8Array(t),n=e.offset,a=0;a<t;a++)r[a]=e.buffer[a+n];return e.offset+=t,r}function B2(e,t){var r=WD(e.buffer,e.offset,t);return e.offset+=t,r}function fA(e,t){for(var r=new Array(t),n=0;n<t;n++)r[n]=MC(e);return r}function MC(e){var t=e.buffer[e.offset],r,n;if((t&128)===0)return e.offset++,t;if((t&240)===128)return n=t&15,e.offset++,cA(e,n);if((t&240)===144)return n=t&15,e.offset++,fA(e,n);if((t&224)===160)return n=t&31,e.offset++,B2(e,n);if((t&224)===224)return r=e.dataView.getInt8(e.offset),e.offset++,r;switch(t){case 192:return e.offset++,null;case 194:return e.offset++,!1;case 195:return e.offset++,!0;case 196:return n=e.dataView.getUint8(e.offset+1),e.offset+=2,dA(e,n);case 197:return n=e.dataView.getUint16(e.offset+1),e.offset+=3,dA(e,n);case 198:return n=e.dataView.getUint32(e.offset+1),e.offset+=5,dA(e,n);case 202:return r=e.dataView.getFloat32(e.offset+1),e.offset+=5,r;case 203:return r=e.dataView.getFloat64(e.offset+1),e.offset+=9,r;case 204:return r=e.buffer[e.offset+1],e.offset+=2,r;case 205:return r=e.dataView.getUint16(e.offset+1),e.offset+=3,r;case 206:return r=e.dataView.getUint32(e.offset+1),e.offset+=5,r;case 208:return r=e.dataView.getInt8(e.offset+1),e.offset+=2,r;case 209:return r=e.dataView.getInt16(e.offset+1),e.offset+=3,r;case 210:return r=e.dataView.getInt32(e.offset+1),e.offset+=5,r;case 217:return n=e.dataView.getUint8(e.offset+1),e.offset+=2,B2(e,n);case 218:return n=e.dataView.getUint16(e.offset+1),e.offset+=3,B2(e,n);case 219:return n=e.dataView.getUint32(e.offset+1),e.offset+=5,B2(e,n);case 220:return n=e.dataView.getUint16(e.offset+1),e.offset+=3,fA(e,n);case 221:return n=e.dataView.getUint32(e.offset+1),e.offset+=5,fA(e,n);case 222:return n=e.dataView.getUint16(e.offset+1),e.offset+=3,cA(e,n);case 223:return n=e.dataView.getUint32(e.offset+1),e.offset+=5,cA(e,n)}throw new Error("Unknown type 0x"+t.toString(16))}function M2e(e,t){for(var r=0;r<2;r++)if(e[r]>t[r])return!1;return!0}function D2e(e){for(var t=Object.create(null),r=Object.create(null),n=0,a=e.columns;n<a.length;n++){var i=a[n];t[i.name]=i}return{rowCount:e.rowCount,name:e.name.substr(1),fieldNames:e.columns.map(function(o){return o.name}),getField:function(o){var s=t[o];if(!!s)return r[o]||(r[o]=I2e(s)),r[o]}}}function EF(e){var t=this;return Qe.create("Parse BinaryCIF",function(r){return pe(t,void 0,void 0,function(){var n,a,i;return he(this,function(o){n=[0,3];try{return a=oW(e),M2e(n,a.version.match(/(\d)\.(\d)\.\d/).slice(1).map(function(s){return+s}))?(i=Jq(a.dataBlocks.map(function(s){for(var u=Object.create(null),l=0,c=s.categories;l<c.length;l++){var d=c[l];u[d.name.substr(1)]=D2e(d)}return ak(s.categories.map(function(f){return f.name.substr(1)}),u,s.header)})),[2,Nn.success(i)]):[2,Nn.error("Unsupported format version. Current "+a.version+", required "+n.join(".")+".")]}catch(s){return[2,Nn.error(""+s)]}return[2]})})})}var Yv;(function(e){function t(a){return a.replace(".","_").replace(/\[/,"_").replace(/(\[|\])/g,"")}e.canonical=t;function r(a,i){return t(a)===t(i)}e.equal=r;function n(a,i,o){o===void 0&&(o=!1);var s=""+a+(i?"."+i:"");return o?t(s):s}e.create=n})(Yv||(Yv={}));function k2e(e,t,r){for(var n={},a=0,i=t.blocks;a<i.length;a++){var o=i[a];n[o.header]=Lc(e,o,r)}return n}function Lc(e,t,r){return L2e(e,t,r)}function R2e(e,t){return new sW(t,e,!0)}function O2e(e){switch(e.valueType){case"str":return function(t,r,n){return pA(e,t,t.str,t.toStringArray)};case"int":return function(t,r,n){return pA(e,t,t.int,t.toIntArray)};case"float":return function(t,r,n){return pA(e,t,t.float,t.toFloatArray)};case"list":throw new Error("Use createListColumn instead.");case"tensor":throw new Error("Use createTensorColumn instead.")}}function pA(e,t,r,n){return{schema:e,__array:t.__array,isDefined:t.isDefined,rowCount:t.rowCount,value:r,valueKind:t.valueKind,areValuesEqual:t.areValuesEqual,toArray:n}}function B2e(e,t,r){var n=e.separator,a=e.itemParse,i=t.getField(r),o=i?function(u){return i.str(u).split(n).map(function(l){return a(l.trim())}).filter(function(l){return!!l})}:function(u){return[]},s=function(u){return hi(t.rowCount,o,u)};return{schema:e,__array:void 0,isDefined:!!i,rowCount:t.rowCount,value:o,valueKind:i?i.valueKind:function(){return 1},areValuesEqual:function(u,l){return yo(o(u),o(l))},toArray:s}}function F2e(e,t,r){var n=e.space,a=t.fieldNames.includes(r+"[0]")||t.fieldNames.includes(r+"[0][0]")||t.fieldNames.includes(r+"[0][0][0]"),i=a?0:1,o=t.fieldNames.includes(r+"_1")||t.fieldNames.includes(r+"_11")||t.fieldNames.includes(r+"_111")?"underscore":"brackets",s=Bbe(r,n.rank,a,o),u=t.getField(s(i,i,i))||ye.Undefined(t.rowCount,e),l=function(d){return Fbe(t,n,d,s)},c=function(d){return hi(t.rowCount,l,d)};return{schema:e,__array:void 0,isDefined:u.isDefined,rowCount:t.rowCount,value:l,valueKind:u.valueKind,areValuesEqual:function(d,f){return Rr.areEqualExact(l(d),l(f))},toArray:c}}var sW=function(){function e(t,r,n){this._isDefined=n;var a=Object.keys(r);this._rowCount=t.rowCount,this._columns=a,this._schema=r;for(var i=Object.create(null),o=function(d){Object.defineProperty(s,d,{get:function(){if(i[d])return i[d];var f=r[d];if(f.valueType==="list")i[d]=B2e(f,t,d);else if(f.valueType==="tensor")i[d]=F2e(f,t,d);else{var p=O2e(f),h=t.getField(d);i[d]=h?p(h,t,d):ye.Undefined(t.rowCount,f)}return i[d]},enumerable:!0,configurable:!1})},s=this,u=0,l=a;u<l.length;u++){var c=l[u];o(c)}}return e}();function L2e(e,t,r){for(var n=Object.create(null),a=0,i=Object.keys(e);a<i.length;a++){var o=i[a];n[o]=U2e(o,e[o],t,r)}return FP.ofTables(t.header,e,n)}function N2e(e){for(var t=Object.create(null),r=0,n=Object.keys(e.categories);r<n.length;r++)for(var a=n[r],i=0,o=e.categories[a].fieldNames;i<o.length;i++){var s=o[i],u=Yv.create(a,s,!0);t[u]=e.categories[a].getField(s)}return t}function z2e(e,t,r,n){var a=Yv.create(t,e),i=Yv.canonical(a);if(i in r)return r[i];if(n&&a in n)for(var o=0,s=n[a];o<s.length;o++){var u=s[o],l=Yv.canonical(u);if(l in r)return r[l]}}function U2e(e,t,r,n){var a=r.categories[e];if(n){for(var i=N2e(r),o=Object.create(null),s=[],u=0,l=0,c=Object.keys(t);l<c.length;l++){var d=c[l],f=z2e(d,e,i,n);f&&(o[d]=f,s.push(d),u=f.rowCount)}a={rowCount:u,name:e,fieldNames:Gt([],s),getField:function(p){return o[p]}}}return new sW(a||Mi.empty(e),t,!!a)}var Mp=ye.Schema,ae=Mp.str,Be=Mp.int,fr=Mp.float,hA=Mp.coord,Ft=Mp.Aliased,rf=Mp.Matrix,F2=Mp.Vector,Xp=Mp.List,Cr={atom_site:{auth_asym_id:ae,auth_atom_id:ae,auth_comp_id:ae,auth_seq_id:Be,B_iso_or_equiv:fr,Cartn_x:hA,Cartn_y:hA,Cartn_z:hA,group_PDB:Ft(ae),id:Be,label_alt_id:ae,label_asym_id:ae,label_atom_id:ae,label_comp_id:ae,label_entity_id:ae,label_seq_id:Be,occupancy:fr,type_symbol:ae,pdbx_PDB_ins_code:ae,pdbx_PDB_model_num:Be,pdbx_formal_charge:Be,ihm_model_id:Be},atom_site_anisotrop:{id:Be,type_symbol:ae,U:rf(3,3),U_esd:rf(3,3),pdbx_auth_seq_id:ae,pdbx_auth_asym_id:ae,pdbx_auth_atom_id:ae,pdbx_auth_comp_id:ae,pdbx_label_seq_id:Be,pdbx_label_alt_id:ae,pdbx_label_asym_id:ae,pdbx_label_atom_id:ae,pdbx_label_comp_id:ae,pdbx_PDB_ins_code:ae},atom_sites:{entry_id:ae,fract_transf_matrix:rf(3,3),fract_transf_vector:F2(3)},audit_author:{name:ae,pdbx_ordinal:Be,identifier_ORCID:ae},audit_conform:{dict_location:ae,dict_name:ae,dict_version:ae},cell:{angle_alpha:fr,angle_beta:fr,angle_gamma:fr,entry_id:ae,length_a:fr,length_b:fr,length_c:fr,Z_PDB:Be,pdbx_unique_axis:ae},chem_comp:{formula:ae,formula_weight:fr,id:ae,mon_nstd_flag:Ft(ae),name:ae,type:Ft(ae),pdbx_synonyms:Xp(";",function(e){return e})},chem_comp_bond:{atom_id_1:ae,atom_id_2:ae,comp_id:ae,value_order:Ft(ae),pdbx_ordinal:Be,pdbx_stereo_config:Ft(ae),pdbx_aromatic_flag:Ft(ae)},citation:{book_publisher:ae,country:ae,id:ae,journal_abbrev:ae,journal_id_ASTM:ae,journal_id_CSD:ae,journal_id_ISSN:ae,journal_volume:ae,page_first:ae,page_last:ae,title:ae,year:Be,pdbx_database_id_DOI:ae,pdbx_database_id_PubMed:Be},citation_author:{citation_id:ae,name:ae,ordinal:Be},database_2:{database_id:Ft(ae),database_code:ae},entity:{details:ae,formula_weight:fr,id:ae,src_method:Ft(ae),type:Ft(ae),pdbx_description:Xp(",",function(e){return e}),pdbx_number_of_molecules:Be,pdbx_mutation:ae,pdbx_fragment:ae,pdbx_ec:Xp(",",function(e){return e})},entity_poly:{entity_id:ae,nstd_linkage:Ft(ae),nstd_monomer:Ft(ae),type:Ft(ae),pdbx_strand_id:Xp(",",function(e){return e}),pdbx_seq_one_letter_code:ae,pdbx_seq_one_letter_code_can:ae,pdbx_target_identifier:ae},entity_poly_seq:{entity_id:ae,hetero:Ft(ae),mon_id:ae,num:Be},entry:{id:ae},exptl:{entry_id:ae,method:Ft(ae)},struct:{entry_id:ae,title:ae,pdbx_descriptor:ae},struct_asym:{details:ae,entity_id:ae,id:ae,pdbx_modified:ae,pdbx_blank_PDB_chainid_flag:Ft(ae)},struct_conf:{beg_label_asym_id:ae,beg_label_comp_id:ae,beg_label_seq_id:Be,beg_auth_asym_id:ae,beg_auth_comp_id:ae,beg_auth_seq_id:Be,conf_type_id:Ft(ae),details:ae,end_label_asym_id:ae,end_label_comp_id:ae,end_label_seq_id:Be,end_auth_asym_id:ae,end_auth_comp_id:ae,end_auth_seq_id:Be,id:ae,pdbx_beg_PDB_ins_code:ae,pdbx_end_PDB_ins_code:ae,pdbx_PDB_helix_class:ae,pdbx_PDB_helix_length:Be,pdbx_PDB_helix_id:ae},struct_conn:{conn_type_id:Ft(ae),details:ae,id:ae,ptnr1_label_asym_id:ae,ptnr1_label_atom_id:ae,ptnr1_label_comp_id:ae,ptnr1_label_seq_id:Be,ptnr1_auth_asym_id:ae,ptnr1_auth_comp_id:ae,ptnr1_auth_seq_id:Be,ptnr1_symmetry:ae,ptnr2_label_asym_id:ae,ptnr2_label_atom_id:ae,ptnr2_label_comp_id:ae,ptnr2_label_seq_id:Be,ptnr2_auth_asym_id:ae,ptnr2_auth_comp_id:ae,ptnr2_auth_seq_id:Be,ptnr2_symmetry:ae,pdbx_ptnr1_PDB_ins_code:ae,pdbx_ptnr1_label_alt_id:ae,pdbx_ptnr1_standard_comp_id:ae,pdbx_ptnr2_PDB_ins_code:ae,pdbx_ptnr2_label_alt_id:ae,pdbx_ptnr3_PDB_ins_code:ae,pdbx_ptnr3_label_alt_id:ae,pdbx_ptnr3_label_asym_id:ae,pdbx_ptnr3_label_atom_id:ae,pdbx_ptnr3_label_comp_id:ae,pdbx_ptnr3_label_seq_id:Be,pdbx_PDB_id:ae,pdbx_dist_value:fr,pdbx_value_order:Ft(ae)},struct_conn_type:{criteria:ae,id:Ft(ae),reference:ae},struct_keywords:{entry_id:ae,text:Xp(",",function(e){return e}),pdbx_keywords:ae},struct_ncs_oper:{code:Ft(ae),details:ae,id:Be,matrix:rf(3,3),vector:F2(3)},struct_sheet_range:{beg_label_asym_id:ae,beg_label_comp_id:ae,beg_label_seq_id:Be,end_label_asym_id:ae,end_label_comp_id:ae,end_label_seq_id:Be,beg_auth_asym_id:ae,beg_auth_comp_id:ae,beg_auth_seq_id:Be,end_auth_asym_id:ae,end_auth_comp_id:ae,end_auth_seq_id:Be,id:ae,sheet_id:ae,pdbx_beg_PDB_ins_code:ae,pdbx_end_PDB_ins_code:ae},struct_site:{details:ae,id:ae,pdbx_num_residues:Be,pdbx_evidence_code:ae,pdbx_auth_asym_id:ae,pdbx_auth_comp_id:ae,pdbx_auth_seq_id:ae,pdbx_auth_ins_code:ae},struct_site_gen:{details:ae,id:ae,label_alt_id:ae,label_asym_id:ae,label_atom_id:ae,label_comp_id:ae,label_seq_id:Be,auth_asym_id:ae,auth_comp_id:ae,auth_seq_id:ae,site_id:ae,symmetry:ae,pdbx_auth_ins_code:ae,pdbx_num_res:Be},symmetry:{entry_id:ae,cell_setting:Ft(ae),Int_Tables_number:Be,space_group_name_Hall:ae,"space_group_name_H-M":ae},pdbx_database_status:{status_code:Ft(ae),status_code_sf:Ft(ae),status_code_mr:Ft(ae),entry_id:ae,recvd_initial_deposition_date:ae,SG_entry:Ft(ae),deposit_site:Ft(ae),process_site:Ft(ae),status_code_cs:Ft(ae),methods_development_category:Ft(ae),pdb_format_compatible:Ft(ae)},pdbx_nonpoly_scheme:{asym_id:ae,entity_id:ae,mon_id:ae,pdb_strand_id:ae,ndb_seq_num:ae,pdb_seq_num:ae,auth_seq_num:ae,pdb_mon_id:ae,auth_mon_id:ae,pdb_ins_code:ae},pdbx_database_related:{db_name:ae,details:ae,db_id:ae,content_type:Ft(ae)},pdbx_entity_nonpoly:{entity_id:ae,comp_id:ae,name:ae},pdbx_chem_comp_synonyms:{name:ae,comp_id:ae,provenance:Ft(ae)},pdbx_chem_comp_identifier:{comp_id:ae,identifier:ae,type:Ft(ae),program:ae,program_version:ae},pdbx_unobs_or_zero_occ_residues:{id:Be,polymer_flag:Ft(ae),occupancy_flag:Ft(Be),PDB_model_num:Be,auth_asym_id:ae,auth_comp_id:ae,auth_seq_id:ae,PDB_ins_code:ae,label_asym_id:ae,label_comp_id:ae,label_seq_id:Be},pdbx_struct_mod_residue:{id:Be,auth_asym_id:ae,auth_comp_id:ae,auth_seq_id:Be,PDB_ins_code:ae,label_asym_id:ae,label_comp_id:ae,label_seq_id:Be,parent_comp_id:ae,details:ae},pdbx_struct_oper_list:{id:ae,type:Ft(ae),name:ae,symmetry_operation:ae,matrix:rf(3,3),vector:F2(3)},pdbx_struct_assembly:{method_details:ae,oligomeric_details:ae,oligomeric_count:Be,details:ae,id:ae},pdbx_struct_assembly_gen:{asym_id_list:Xp(",",function(e){return e}),assembly_id:ae,oper_expression:ae},pdbx_reference_entity_list:{prd_id:ae,ref_entity_id:ae,type:Ft(ae),details:ae,component_id:Be},pdbx_reference_entity_link:{link_id:Be,prd_id:ae,details:ae,ref_entity_id_1:ae,ref_entity_id_2:ae,entity_seq_num_1:Be,entity_seq_num_2:Be,comp_id_1:ae,comp_id_2:ae,atom_id_1:ae,atom_id_2:ae,value_order:Ft(ae),component_1:Be,component_2:Be,link_class:Ft(ae)},pdbx_reference_entity_poly_link:{link_id:Be,prd_id:ae,ref_entity_id:ae,component_id:Be,entity_seq_num_1:Be,entity_seq_num_2:Be,comp_id_1:ae,comp_id_2:ae,atom_id_1:ae,atom_id_2:ae,value_order:Ft(ae)},pdbx_molecule:{prd_id:ae,instance_id:Be,asym_id:ae},pdbx_molecule_features:{prd_id:ae,class:Ft(ae),type:Ft(ae),name:ae,details:ae},entity_src_nat:{entity_id:ae,pdbx_organism_scientific:ae,pdbx_plasmid_name:ae,pdbx_src_id:Be,pdbx_beg_seq_num:Be,pdbx_end_seq_num:Be},entity_src_gen:{entity_id:ae,pdbx_gene_src_gene:Xp(",",function(e){return e}),pdbx_gene_src_scientific_name:ae,plasmid_name:ae,pdbx_src_id:Be,pdbx_beg_seq_num:Be,pdbx_end_seq_num:Be},pdbx_entity_src_syn:{organism_scientific:ae,entity_id:ae,pdbx_src_id:Be,pdbx_beg_seq_num:Be,pdbx_end_seq_num:Be},pdbx_entity_branch_descriptor:{entity_id:ae,descriptor:ae,type:Ft(ae),program:ae,program_version:ae,ordinal:Be},pdbx_entity_instance_feature:{details:ae,feature_type:Ft(ae),auth_asym_id:ae,asym_id:ae,auth_seq_num:ae,seq_num:Be,comp_id:ae,auth_comp_id:ae,ordinal:Be},pdbx_entity_branch_list:{entity_id:ae,hetero:Ft(ae),comp_id:ae,num:Be},pdbx_entity_branch_link:{link_id:Be,details:ae,entity_id:ae,entity_branch_list_num_1:Be,entity_branch_list_num_2:Be,comp_id_1:ae,comp_id_2:ae,atom_id_1:ae,leaving_atom_id_1:ae,atom_stereo_config_1:Ft(ae),atom_id_2:ae,leaving_atom_id_2:ae,atom_stereo_config_2:Ft(ae),value_order:Ft(ae)},pdbx_entity_branch:{entity_id:ae,type:Ft(ae)},pdbx_branch_scheme:{entity_id:ae,hetero:Ft(ae),asym_id:ae,mon_id:ae,num:Be,pdb_asym_id:ae,pdb_seq_num:ae,pdb_mon_id:ae,auth_asym_id:ae,auth_seq_num:ae,auth_mon_id:ae},pdbx_chem_comp_related:{comp_id:ae,related_comp_id:ae,relationship_type:Ft(ae),details:ae},ihm_starting_model_details:{starting_model_id:ae,entity_id:ae,entity_description:ae,asym_id:ae,entity_poly_segment_id:Be,starting_model_source:Ft(ae),starting_model_auth_asym_id:ae,starting_model_sequence_offset:Be,dataset_list_id:Be},ihm_starting_comparative_models:{id:Be,starting_model_id:ae,starting_model_auth_asym_id:ae,starting_model_seq_id_begin:Be,starting_model_seq_id_end:Be,template_auth_asym_id:ae,template_seq_id_begin:Be,template_seq_id_end:Be,template_sequence_identity:fr,template_sequence_identity_denominator:Ft(Be),template_dataset_list_id:Be,alignment_file_id:Be},ihm_starting_model_seq_dif:{id:Be,entity_id:ae,asym_id:ae,seq_id:Be,comp_id:ae,starting_model_id:ae,db_asym_id:ae,db_seq_id:Be,db_comp_id:ae,details:ae},ihm_model_representation:{id:Be,name:ae,details:ae},ihm_model_representation_details:{id:Be,representation_id:Be,entity_poly_segment_id:Be,entity_id:ae,entity_description:ae,entity_asym_id:ae,model_object_primitive:Ft(ae),starting_model_id:ae,model_mode:Ft(ae),model_granularity:Ft(ae),model_object_count:Be},ihm_struct_assembly_details:{id:Be,assembly_id:Be,parent_assembly_id:Be,entity_description:ae,entity_id:ae,asym_id:ae,entity_poly_segment_id:Be},ihm_struct_assembly:{id:Be,name:ae,description:ae},ihm_modeling_protocol:{id:Be,num_steps:Be,protocol_name:ae},ihm_modeling_protocol_details:{id:Be,protocol_id:Be,step_id:Be,struct_assembly_id:Be,dataset_group_id:Be,struct_assembly_description:ae,step_name:ae,step_method:ae,num_models_begin:Be,num_models_end:Be,multi_scale_flag:Ft(ae),multi_state_flag:Ft(ae),ordered_flag:Ft(ae),script_file_id:Be,software_id:Be},ihm_multi_state_modeling:{state_id:Be,state_group_id:Be,population_fraction:fr,population_fraction_sd:fr,state_type:ae,state_name:ae,experiment_type:Ft(ae),details:ae},ihm_modeling_post_process:{id:Be,protocol_id:Be,analysis_id:Be,step_id:Be,type:Ft(ae),feature:Ft(ae),num_models_begin:Be,num_models_end:Be},ihm_ensemble_info:{ensemble_id:Be,ensemble_name:ae,post_process_id:Be,model_group_id:Be,ensemble_clustering_method:Ft(ae),ensemble_clustering_feature:Ft(ae),num_ensemble_models:Be,num_ensemble_models_deposited:Be,ensemble_precision_value:fr,ensemble_file_id:Be},ihm_model_list:{model_id:Be,model_name:ae,assembly_id:Be,protocol_id:Be,representation_id:Be},ihm_model_group:{id:Be,name:ae,details:ae},ihm_model_group_link:{model_id:Be,group_id:Be},ihm_model_representative:{id:Be,model_group_id:Be,model_id:Be,selection_criteria:Ft(ae)},ihm_dataset_list:{id:Be,data_type:Ft(ae),database_hosted:Ft(ae)},ihm_dataset_group:{id:Be,name:ae,application:Ft(ae),details:ae},ihm_dataset_group_link:{dataset_list_id:Be,group_id:Be},ihm_related_datasets:{dataset_list_id_derived:Be,dataset_list_id_primary:Be},ihm_dataset_related_db_reference:{id:Be,dataset_list_id:Be,db_name:Ft(ae),accession_code:ae,version:ae,details:ae},ihm_external_reference_info:{reference_id:Be,reference_provider:ae,reference_type:Ft(ae),reference:ae,refers_to:Ft(ae),associated_url:ae},ihm_external_files:{id:Be,reference_id:Be,file_path:ae,content_type:Ft(ae),file_size_bytes:fr,details:ae},ihm_dataset_external_reference:{id:Be,dataset_list_id:Be,file_id:Be},ihm_localization_density_files:{id:Be,file_id:Be,ensemble_id:Be,entity_id:ae,entity_poly_segment_id:Be,asym_id:ae},ihm_predicted_contact_restraint:{id:Be,group_id:Be,entity_id_1:ae,entity_id_2:ae,asym_id_1:ae,asym_id_2:ae,comp_id_1:ae,comp_id_2:ae,seq_id_1:Be,seq_id_2:Be,rep_atom_1:Ft(ae),rep_atom_2:Ft(ae),distance_lower_limit:fr,distance_upper_limit:fr,probability:fr,restraint_type:Ft(ae),model_granularity:Ft(ae),dataset_list_id:Be,software_id:Be},ihm_cross_link_list:{id:Be,group_id:Be,entity_description_1:ae,entity_description_2:ae,entity_id_1:ae,entity_id_2:ae,comp_id_1:ae,comp_id_2:ae,seq_id_1:Be,seq_id_2:Be,linker_type:Ft(ae),dataset_list_id:Be},ihm_cross_link_restraint:{id:Be,group_id:Be,entity_id_1:ae,entity_id_2:ae,asym_id_1:ae,asym_id_2:ae,comp_id_1:ae,comp_id_2:ae,seq_id_1:Be,seq_id_2:Be,atom_id_1:ae,atom_id_2:ae,restraint_type:Ft(ae),conditional_crosslink_flag:Ft(ae),model_granularity:Ft(ae),distance_threshold:fr,psi:fr,sigma_1:fr,sigma_2:fr},ihm_cross_link_result_parameters:{id:Be,restraint_id:Be,model_id:Be,psi:fr,sigma_1:fr,sigma_2:fr},ihm_2dem_class_average_restraint:{id:Be,dataset_list_id:Be,number_raw_micrographs:Be,pixel_size_width:fr,pixel_size_height:fr,image_resolution:fr,image_segment_flag:Ft(ae),number_of_projections:Be,struct_assembly_id:Be,details:ae},ihm_2dem_class_average_fitting:{id:Be,restraint_id:Be,model_id:Be,cross_correlation_coefficient:fr,rot_matrix:rf(3,3),tr_vector:F2(3)},ihm_3dem_restraint:{id:Be,dataset_list_id:Be,model_id:Be,struct_assembly_id:Be,fitting_method:ae,number_of_gaussians:Be,cross_correlation_coefficient:fr},ihm_sas_restraint:{id:Be,dataset_list_id:Be,model_id:Be,struct_assembly_id:Be,profile_segment_flag:Ft(ae),fitting_atom_type:ae,fitting_method:ae,fitting_state:Ft(ae),radius_of_gyration:fr,chi_value:fr,details:ae},ihm_starting_model_coord:{ordinal_id:Be,starting_model_id:ae,group_PDB:Ft(ae),id:Be,type_symbol:ae,entity_id:ae,atom_id:ae,comp_id:ae,seq_id:Be,asym_id:ae,Cartn_x:fr,Cartn_y:fr,Cartn_z:fr,B_iso_or_equiv:fr},ihm_sphere_obj_site:{id:Be,entity_id:ae,seq_id_begin:Be,seq_id_end:Be,asym_id:ae,Cartn_x:fr,Cartn_y:fr,Cartn_z:fr,object_radius:fr,rmsf:fr,model_id:Be},ihm_gaussian_obj_site:{id:Be,entity_id:ae,seq_id_begin:Be,seq_id_end:Be,asym_id:ae,mean_Cartn_x:fr,mean_Cartn_y:fr,mean_Cartn_z:fr,weight:fr,covariance_matrix:rf(3,3),model_id:Be},ihm_gaussian_obj_ensemble:{id:Be,entity_id:ae,seq_id_begin:Be,seq_id_end:Be,asym_id:ae,mean_Cartn_x:fr,mean_Cartn_y:fr,mean_Cartn_z:fr,weight:fr,covariance_matrix:rf(3,3),ensemble_id:Be},ihm_feature_list:{feature_id:Be,feature_type:Ft(ae),entity_type:Ft(ae)},ihm_poly_residue_feature:{ordinal_id:Be,feature_id:Be,entity_id:ae,asym_id:ae,comp_id_begin:ae,comp_id_end:ae,seq_id_begin:Be,seq_id_end:Be},ihm_derived_distance_restraint:{id:Be,group_id:Be,feature_id_1:Be,feature_id_2:Be,group_conditionality:Ft(ae),random_exclusion_fraction:fr,distance_upper_limit:fr,restraint_type:Ft(ae),dataset_list_id:Be}},F0=ye.Schema,Or=F0.str,V2e=F0.float,PF=F0.List,rs=F0.Aliased,wg=F0.int,Km=F0.coord,H2e={chem_comp:{formula:Or,formula_weight:V2e,id:Or,mon_nstd_parent_comp_id:PF(",",function(e){return e}),name:Or,one_letter_code:Or,three_letter_code:Or,type:rs(Or),pdbx_synonyms:PF(";",function(e){return e}),pdbx_type:Or,pdbx_ambiguous_flag:Or,pdbx_replaced_by:Or,pdbx_replaces:Or,pdbx_formal_charge:wg,pdbx_model_coordinates_details:Or,pdbx_model_coordinates_db_code:Or,pdbx_ideal_coordinates_details:Or,pdbx_ideal_coordinates_missing_flag:rs(Or),pdbx_model_coordinates_missing_flag:rs(Or),pdbx_initial_date:Or,pdbx_modified_date:Or,pdbx_release_status:rs(Or),pdbx_processing_site:rs(Or)},chem_comp_atom:{alt_atom_id:Or,atom_id:Or,charge:wg,model_Cartn_x:Km,model_Cartn_y:Km,model_Cartn_z:Km,comp_id:Or,type_symbol:Or,pdbx_align:wg,pdbx_ordinal:wg,pdbx_model_Cartn_x_ideal:Km,pdbx_model_Cartn_y_ideal:Km,pdbx_model_Cartn_z_ideal:Km,pdbx_stereo_config:rs(Or),pdbx_aromatic_flag:rs(Or),pdbx_leaving_atom_flag:rs(Or)},chem_comp_bond:{atom_id_1:Or,atom_id_2:Or,comp_id:Or,value_order:rs(Or),pdbx_ordinal:wg,pdbx_stereo_config:rs(Or),pdbx_aromatic_flag:rs(Or)},pdbx_chem_comp_descriptor:{comp_id:Or,descriptor:Or,type:rs(Or),program:Or,program_version:Or},pdbx_chem_comp_identifier:{comp_id:Or,identifier:Or,type:rs(Or),program:Or,program_version:Or}},qw=ye.Schema,Yt=qw.str,j2e=qw.float,so=qw.Aliased,Ls=qw.int,G2e={pdbx_reference_molecule:{prd_id:Yt,formula_weight:j2e,formula:Yt,type:so(Yt),type_evidence_code:Yt,class:so(Yt),class_evidence_code:Yt,name:Yt,represent_as:so(Yt),chem_comp_id:Yt,compound_details:Yt,description:Yt,representative_PDB_id_code:Yt,release_status:so(Yt),replaces:Yt,replaced_by:Yt},pdbx_reference_entity_list:{prd_id:Yt,ref_entity_id:Yt,type:so(Yt),details:Yt,component_id:Ls},pdbx_reference_entity_nonpoly:{prd_id:Yt,ref_entity_id:Yt,name:Yt,chem_comp_id:Yt},pdbx_reference_entity_link:{link_id:Ls,prd_id:Yt,details:Yt,ref_entity_id_1:Yt,ref_entity_id_2:Yt,entity_seq_num_1:Ls,entity_seq_num_2:Ls,comp_id_1:Yt,comp_id_2:Yt,atom_id_1:Yt,atom_id_2:Yt,value_order:so(Yt),component_1:Ls,component_2:Ls,link_class:so(Yt)},pdbx_reference_entity_poly_link:{link_id:Ls,prd_id:Yt,ref_entity_id:Yt,component_id:Ls,entity_seq_num_1:Ls,entity_seq_num_2:Ls,comp_id_1:Yt,comp_id_2:Yt,atom_id_1:Yt,atom_id_2:Yt,value_order:so(Yt)},pdbx_reference_entity_poly:{prd_id:Yt,ref_entity_id:Yt,type:so(Yt),db_code:Yt,db_name:Yt},pdbx_reference_entity_poly_seq:{prd_id:Yt,ref_entity_id:Yt,mon_id:Yt,parent_mon_id:Yt,num:Ls,observed:so(Yt),hetero:so(Yt)},pdbx_reference_entity_sequence:{prd_id:Yt,ref_entity_id:Yt,type:so(Yt),NRP_flag:so(Yt),one_letter_codes:Yt},pdbx_reference_entity_src_nat:{prd_id:Yt,ref_entity_id:Yt,ordinal:Ls,organism_scientific:Yt,taxid:Yt,db_code:Yt,db_name:Yt},pdbx_prd_audit:{prd_id:Yt,date:Yt,processing_site:so(Yt),action_type:so(Yt)}},uW=ye.Schema,Da=uW.str,q2e=uW.float,W2e={id:Da,description:Da},X2e={title:Da,datablock_id:Da,version:Da},Y2e={version:Da,update:Da,revision:Da},K2e={id:Da,description:Da},$2e={id:Da,parent_id:Da,description:Da},Q2e={code:Da,primitive_code:Da,construct:Da,detail:Da},Z2e={code:Da,detail:Da},J2e={from_code:Da,to_code:Da,operator:Da,factor:q2e},exe={datablock:W2e,dictionary:X2e,dictionary_history:Y2e,sub_category:K2e,category_group_list:$2e,item_type_list:Q2e,item_units_list:Z2e,item_units_conversion:J2e},pb=ye.Schema,Al=pb.str,L2=pb.int,Cc=pb.float,N2=pb.Aliased,Pf=pb.Vector;N2(Al),N2(Al),N2(Al),N2(Al),Pf(3),Pf(3);var txe={volume_data_3d_info:{name:Al,axis_order:Pf(3,L2),origin:Pf(3),dimensions:Pf(3),sample_rate:L2,sample_count:Pf(3,L2),spacegroup_number:L2,spacegroup_cell_size:Pf(3),spacegroup_cell_angles:Pf(3),mean_source:Cc,mean_sampled:Cc,sigma_source:Cc,sigma_sampled:Cc,min_source:Cc,min_sampled:Cc,max_source:Cc,max_sampled:Cc},volume_data_3d:{values:Cc}},Ww=ye.Schema,mA=Ww.int,wn=Ww.float,vn=Ww.str,IF=Ww.Matrix,rxe={cell:{formula_units_Z:mA,volume:wn,angle_alpha:wn,angle_beta:wn,angle_gamma:wn,length_a:wn,length_b:wn,length_c:wn},chemical:{melting_point:wn,name_common:vn,name_systematic:vn},chemical_formula:{moiety:vn,sum:vn,weight:wn},space_group:{crystal_system:vn,IT_number:mA,"name_H-M_full":vn},space_group_symop:{operation_xyz:vn},geom_bond:{atom_site_label_1:vn,atom_site_label_2:vn,distance:wn,publ_flag:vn,site_symmetry_1:vn,site_symmetry_2:vn,valence:wn},audit:{block_doi:vn},database_code:{COD:vn,CSD:vn,depnum_ccdc_archive:vn,depnum_ccdc_fiz:vn,ICSD:vn,MDF:vn,NBS:vn},atom_site:{adp_type:vn,calc_flag:vn,disorder_assembly:vn,disorder_group:vn,fract_x:wn,fract_y:wn,fract_z:wn,label:vn,occupancy:wn,refinement_flags:vn,site_symmetry_multiplicity:mA,type_symbol:vn,U_iso_or_equiv:wn},atom_site_aniso:{label:vn,U_11:wn,U:IF(3,3),U_11_su:wn,U_su:IF(3,3),U_12:wn,U_12_su:wn,U_13:wn,U_13_su:wn,U_22:wn,U_22_su:wn,U_23:wn,U_23_su:wn,U_33:wn,U_33_su:wn},atom_type:{description:vn,symbol:vn},atom_type_scat:{dispersion_imag:wn,dispersion_real:wn,source:vn}},nxe={"atom_site_aniso.U":["atom_site_anisotrop_U"],"atom_site_aniso.U_su":["atom_site_aniso_U_esd","atom_site_anisotrop_U_esd"],"space_group.IT_number":["symmetry_Int_Tables_number"],"space_group.name_H-M_full":["symmetry_space_group_name_H-M"],"space_group_symop.operation_xyz":["symmetry_equiv_pos_as_xyz"],"geom_bond.atom_site_label_1":["geom_bond_atom_site_id_1"],"geom_bond.atom_site_label_2":["geom_bond_atom_site_id_2"],"geom_bond.distance":["geom_bond_dist"],"atom_site.adp_type":["atom_site_thermal_displace_type"],"atom_site.label":["atom_site_id"],"atom_site.site_symmetry_multiplicity":["atom_site_symmetry_multiplicity"],"atom_site_aniso.label":["atom_site_anisotrop_id"],"atom_site_aniso.U_11":["atom_site_anisotrop_U_11"],"atom_site_aniso.U_11_su":["atom_site_aniso_U_11_esd","atom_site_anisotrop_U_11_esd"],"atom_site_aniso.U_12":["atom_site_anisotrop_U_12"],"atom_site_aniso.U_12_su":["atom_site_aniso_U_12_esd","atom_site_anisotrop_U_12_esd"],"atom_site_aniso.U_13":["atom_site_anisotrop_U_13"],"atom_site_aniso.U_13_su":["atom_site_aniso_U_13_esd","atom_site_anisotrop_U_13_esd"],"atom_site_aniso.U_22":["atom_site_anisotrop_U_22"],"atom_site_aniso.U_22_su":["atom_site_aniso_U_22_esd","atom_site_anisotrop_U_22_esd"],"atom_site_aniso.U_23":["atom_site_anisotrop_U_23"],"atom_site_aniso.U_23_su":["atom_site_aniso_U_23_esd","atom_site_anisotrop_U_23_esd"],"atom_site_aniso.U_33":["atom_site_anisotrop_U_33"],"atom_site_aniso.U_33_su":["atom_site_aniso_U_33_esd","atom_site_anisotrop_U_33_esd"]},md={parse:function(e){return typeof e=="string"?TF(e):EF(e)},parseText:TF,parseBinary:EF,toDatabaseCollection:k2e,toDatabase:Lc,schema:{mmCIF:function(e){return Lc(Cr,e)},CCD:function(e){return Lc(H2e,e)},BIRD:function(e){return Lc(G2e,e)},dic:function(e){return Lc(exe,e)},cifCore:function(e){return Lc(rxe,e,nxe)},densityServer:function(e){return Lc(txe,e)}}},n5=512;function axe(e){return{xStart:parseInt(e.substr(10,5)),yStart:parseInt(e.substr(15,5)),zStart:parseInt(e.substr(20,5)),xExtent:parseInt(e.substr(32,5)),yExtent:parseInt(e.substr(38,5)),zExtent:parseInt(e.substr(42,5)),xRate:parseInt(e.substr(52,5)),yRate:parseInt(e.substr(58,5)),zRate:parseInt(e.substr(62,5)),xlen:parseFloat(e.substr(73,10)),ylen:parseFloat(e.substr(83,10)),zlen:parseFloat(e.substr(93,10)),alpha:parseFloat(e.substr(103,10)),beta:parseFloat(e.substr(113,10)),gamma:parseFloat(e.substr(123,10)),divisor:parseFloat(e.substr(138,12)),summand:parseInt(e.substr(155,8)),sigma:parseFloat(e.substr(170,12))}}function ixe(e,t){var r=t?function(a){return e.readInt16LE(a*2)}:function(a){return e.readInt16BE(a*2)},n=1/r(17);return{xStart:r(0),yStart:r(1),zStart:r(2),xExtent:r(3),yExtent:r(4),zExtent:r(5),xRate:r(6),yRate:r(7),zRate:r(8),xlen:r(9)*n,ylen:r(10)*n,zlen:r(11)*n,alpha:r(12)*n,beta:r(13)*n,gamma:r(14)*n,divisor:r(15)/100,summand:r(16),sigma:void 0}}function lW(e){var t=e.xExtent,r=e.yExtent,n=e.zExtent,a=Math.ceil(t/8),i=Math.ceil(r/8),o=Math.ceil(n/8);return{xBlocks:a,yBlocks:i,zBlocks:o}}function oxe(e){return pe(this,void 0,void 0,function(){var t,r,n,a,i;return he(this,function(o){switch(o.label){case 0:return[4,e.readBuffer(0,n5)];case 1:return t=o.sent().buffer,r=String.fromCharCode.apply(null,t),n=r.startsWith(":-)"),a=n||t.readInt16LE(18*2)===100,i=n?axe(r):ixe(t,a),[2,{header:i,littleEndian:a}]}})})}function sxe(e,t,r,n){return pe(this,void 0,void 0,function(){var a,i,o,s,u,l,c,d,f,p,h,m,v,g,y,b,S,x,C,w;return he(this,function(_){for(n||Yu.flipByteOrderInPlace2(t.buffer),a=e.divisor,i=e.summand,o=e.xExtent,s=e.yExtent,u=e.zExtent,l=lW(e),c=l.xBlocks,d=l.yBlocks,f=l.zBlocks,p=0,h=0;h<f;++h)for(m=0;m<d;++m)for(v=0;v<c;++v)for(g=0;g<8;++g)for(y=8*h+g,b=0;b<8;++b)for(S=8*m+b,x=0;x<8;++x)if(C=8*v+x,C<o&&S<s&&y<u)w=(C*s+S)*u+y,r[w]=(t[p]-i)/a,++p;else{p+=8-x;break}return[2]})})}function uxe(e){var t=e.xExtent,r=e.yExtent,n=e.zExtent,a=lW(e),i=a.xBlocks,o=a.yBlocks,s=a.zBlocks,u=t*r*n,l=i*8*o*8*s*8,c=1,d=l*c;return{count:l,byteCount:d,valueCount:u}}function lxe(e,t,r){return pe(this,void 0,void 0,function(){var n,a,i,o,s,u,l;return he(this,function(c){switch(c.label){case 0:return[4,r.update({message:"Parsing DSN6/BRIX file..."})];case 1:return c.sent(),[4,oxe(e)];case 2:return n=c.sent(),a=n.header,i=n.littleEndian,[4,e.readBuffer(n5,t-n5)];case 3:return o=c.sent().buffer,s=uxe(a).valueCount,u=new Float32Array(s),[4,sxe(a,o,u,i)];case 4:return c.sent(),l={header:a,values:u,name:e.name},[2,l]}})})}function cxe(e,t){var r=this;return Qe.create("Parse DSN6/BRIX",function(n){return pe(r,void 0,void 0,function(){var a,i,o;return he(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),i=(a=Nn).success,[4,lxe(e,t,n)];case 1:return[2,i.apply(a,[s.sent()])];case 2:return o=s.sent(),[2,Nn.error(o)];case 3:return[2]}})})})}function dxe(e,t){return cxe(EC.fromBuffer(Yu.fromUint8Array(e),t),e.length)}var fxe={char:1,uchar:1,short:2,ushort:2,int:4,uint:4,float:4,double:8,int8:1,uint8:1,int16:2,uint16:2,int32:4,uint32:4,float32:4,float64:8},pxe=new Set(Object.keys(fxe));function vA(e){if(!pxe.has(e))throw new Error("unknown ply type '"+e+"'");return e}function hxe(e,t,r){for(var n=new Map,a=0,i=t.length;a<i;++a)n.set(t[a],e[a]);return{comments:r,elementNames:t,getElement:function(o){return n.get(o)}}}function mxe(e,t){var r=Bt(e);return{data:e,tokenizer:r,runtimeCtx:t,comments:[],elementSpecs:[],elements:[]}}function vxe(e){var t=e.data.indexOf("end_header",e.position);if(t===-1)throw new Error("no 'end_header' record found");e.tokenStart=e.position,e.tokenEnd=t,e.position=t,Bt.eatLine(e)}function gxe(e){var t=e.tokenizer,r=e.comments,n=e.elementSpecs;vxe(t);var a=Bt.getTokenString(t).split(/\r?\n/);if(a[0]!=="ply")throw new Error("data not starting with 'ply'");if(a[1]!=="format ascii 1.0")throw new Error("format not 'ascii 1.0'");var i,o,s;function u(){if(i!==void 0&&o!==void 0&&s!==void 0){for(var p=!1,h=0,m=s.length;h<m;++h){var v=s[h];if(v.kind==="list"){p=!0;break}}p&&s.length,p?n.push({kind:"list",name:i,count:o,property:s[0]}):n.push({kind:"table",name:i,count:o,properties:s})}}for(var l=2,c=a.length;l<c;++l){var d=a[l],f=d.split(" ");if(d.startsWith("comment"))r.push(d.substr(8));else if(d.startsWith("element"))u(),s=[],i=f[1],o=parseInt(f[2]);else if(d.startsWith("property")){if(s===void 0)throw new Error("properties outside of element");f[1]==="list"?s.push({kind:"list",countType:vA(f[2]),dataType:vA(f[3]),name:f[4]}):s.push({kind:"column",type:vA(f[1]),name:f[2]})}else d.startsWith("end_header")?u():console.warn("unknown header line")}}function yxe(e){for(var t=e.elementSpecs,r=0,n=t.length;r<n;++r){var a=t[r];a.kind==="table"?bxe(e,a):a.kind==="list"&&xxe(e,a)}}function cW(e){switch(e){case"char":case"uchar":case"int8":case"uint8":case"short":case"ushort":case"int16":case"uint16":case"int":case"uint":case"int32":case"uint32":return ye.Schema.int;case"float":case"double":case"float32":case"float64":return ye.Schema.float}}function bxe(e,t){for(var r=e.elements,n=e.tokenizer,a=t.count,i=t.properties,o=i.length,s=[],u=[],l=[],c=new Map,d=0,f=o;d<f;++d){var p=yt.create(n.data,a*2);l.push(p)}for(var d=0,f=a;d<f;++d)for(var h=0,m=o;h<m;++h)Bt.skipWhitespace(n),Bt.markStart(n),Bt.eatValue(n),yt.addUnchecked(l[h],n.tokenStart,n.tokenEnd);for(var d=0,f=o;d<f;++d){var v=i[d],g=v.type,y=v.name,b=nk(l[d],cW(g));s.push(y),u.push(g),c.set(y,b)}r.push({kind:"table",rowCount:a,propertyNames:s,propertyTypes:u,getProperty:function(S){return c.get(S)}})}function xxe(e,t){for(var r=e.elements,n=e.tokenizer,a=t.count,i=t.property,o=yt.create(n.data,a*2*3),s=new Uint32Array(a+1),u=0,l=0,c=a;l<c;++l){for(Bt.skipWhitespace(n),Bt.markStart(n);Bt.skipWhitespace(n)!==10;)++u,Bt.markStart(n),Bt.eatValue(n),yt.addToken(o,n);s[l+1]=u}var d={entries:[],count:0},f=nk(o,cW(i.dataType));r.push({kind:"list",rowCount:a,name:i.name,type:i.dataType,value:function(p){for(var h=s[p]+1,m=f.value(h-1),v=h,g=h+m;v<g;++v)d.entries[v-h]=f.value(v);return d.count=m,d}})}function Sxe(e,t){return pe(this,void 0,void 0,function(){var r,n,a,i,o,s;return he(this,function(u){return r=mxe(e,t),t.update({message:"Parsing...",current:0,max:e.length}),gxe(r),yxe(r),n=r.elements,a=r.elementSpecs,i=r.comments,o=a.map(function(l){return l.name}),s=hxe(n,o,i),[2,Nn.success(s)]})})}function Cxe(e){var t=this;return Qe.create("Parse PLY",function(r){return pe(t,void 0,void 0,function(){return he(this,function(n){switch(n.label){case 0:return[4,Sxe(e,r)];case 1:return[2,n.sent()]}})})})}var DC=Bt.readLine,dW=Bt.skipWhitespace,fW=Bt.eatValue,wxe=Bt.eatLine,a5=Bt.markStart,fS=/\s+/,_xe=/(^\*|REMARK)*/;function Axe(e,t){return{tokenizer:e,runtimeCtx:t}}function Txe(e,t){return pe(this,void 0,void 0,function(){var r,n,a,i,o,s,u,l,c,d,f,p,h,m,v;return he(this,function(g){switch(g.label){case 0:return r=e.tokenizer,n=yt.create(r.data,t*2),a=yt.create(r.data,t*2),i=yt.create(r.data,t*2),o=yt.create(r.data,t*2),s=yt.create(r.data,t*2),u=yt.create(r.data,t*2),l=yt.create(r.data,t*2),c=yt.create(r.data,t*2),d=r.position,f=DC(r).trim(),r.position=d,p=f.split(fS).length===7,h=p?6:8,m=r.length,v=0,[4,fd(e.runtimeCtx,1e5,void 0,function(y){for(var b=Math.min(t-v,y),S=0;S<b;++S){for(var x=0;x<h;++x)if(dW(r),a5(r),fW(r),p)switch(x){case 0:yt.addUnchecked(n,r.tokenStart,r.tokenEnd);break;case 1:yt.addUnchecked(i,r.tokenStart,r.tokenEnd);break;case 2:yt.addUnchecked(s,r.tokenStart,r.tokenEnd);break;case 3:yt.addUnchecked(u,r.tokenStart,r.tokenEnd);break;case 4:yt.addUnchecked(l,r.tokenStart,r.tokenEnd);break;case 5:yt.addUnchecked(c,r.tokenStart,r.tokenEnd);break}else switch(x){case 0:yt.addUnchecked(n,r.tokenStart,r.tokenEnd);break;case 1:yt.addUnchecked(a,r.tokenStart,r.tokenEnd);break;case 2:yt.addUnchecked(i,r.tokenStart,r.tokenEnd);break;case 3:yt.addUnchecked(o,r.tokenStart,r.tokenEnd);break;case 4:yt.addUnchecked(s,r.tokenStart,r.tokenEnd);break;case 5:yt.addUnchecked(u,r.tokenStart,r.tokenEnd);break;case 6:yt.addUnchecked(l,r.tokenStart,r.tokenEnd);break;case 7:yt.addUnchecked(c,r.tokenStart,r.tokenEnd);break}wxe(r),a5(r)}return v+=b,b},function(y){return y.update({message:"Parsing...",current:r.position,max:m})})];case 1:return g.sent(),[2,{count:t,atomId:tn(n)(ye.Schema.int),segmentName:p?tn(i)(ye.Schema.str):tn(a)(ye.Schema.str),residueId:tn(i)(ye.Schema.int),residueName:p?tn(i)(ye.Schema.str):tn(o)(ye.Schema.str),atomName:tn(s)(ye.Schema.str),atomType:tn(u)(ye.Schema.str),charge:tn(l)(ye.Schema.float),mass:tn(c)(ye.Schema.float)}]}})})}function Exe(e,t){return pe(this,void 0,void 0,function(){var r,n,a,i,o;return he(this,function(s){switch(s.label){case 0:return r=e.tokenizer,n=yt.create(r.data,t*2),a=yt.create(r.data,t*2),i=r.length,o=0,[4,fd(e.runtimeCtx,10,void 0,function(u){for(var l=Math.min(t-o,u),c=0;c<l;++c)for(var d=0;d<2;++d)switch(dW(r),a5(r),fW(r),d){case 0:yt.addUnchecked(n,r.tokenStart,r.tokenEnd);break;case 1:yt.addUnchecked(a,r.tokenStart,r.tokenEnd);break}return o+=l,l},function(u){return u.update({message:"Parsing...",current:r.position,max:i})})];case 1:return s.sent(),[2,{count:t,atomIdA:tn(n)(ye.Schema.int),atomIdB:tn(a)(ye.Schema.int)}]}})})}function Pxe(e,t){for(var r=[],n=0;n<t;++n){var a=DC(e.tokenizer);r.push(a.replace(_xe,"").trim())}return r}function Ixe(e,t){return pe(this,void 0,void 0,function(){var r,n,a,i,o,s,u,l,c,d,f;return he(this,function(p){switch(p.label){case 0:r=Bt(e),n=Axe(r,t),a=void 0,i=void 0,o=void 0,s=DC(n.tokenizer).trim(),p.label=1;case 1:return r.tokenEnd<r.length?(u=DC(n.tokenizer).trim(),u.includes("!NTITLE")?(l=parseInt(u.split(fS)[0]),a=Pxe(n,l),[3,7]):[3,2]):[3,8];case 2:return u.includes("!NATOM")?(c=parseInt(u.split(fS)[0]),[4,Txe(n,c)]):[3,4];case 3:return i=p.sent(),[3,7];case 4:return u.includes("!NBOND")?(d=parseInt(u.split(fS)[0]),[4,Exe(n,d)]):[3,6];case 5:return o=p.sent(),[3,8];case 6:u.includes("!NTHETA")||u.includes("!NPHI")||u.includes("!NIMPHI")||u.includes("!NDON")||u.includes("!NACC")||u.includes("!NNB")||u.includes("!NGRP NST2")||u.includes("!MOLNT")||u.includes("!NUMLP NUMLPH")||u.includes("!NCRTERM"),p.label=7;case 7:return[3,1];case 8:return a===void 0&&(a=[]),i===void 0?[2,Nn.error("no atoms data")]:o===void 0?[2,Nn.error("no bonds data")]:(f={id:s,title:a,atoms:i,bonds:o},[2,Nn.success(f)])}})})}function Mxe(e){var t=this;return Qe.create("Parse PSF",function(r){return pe(t,void 0,void 0,function(){return he(this,function(n){switch(n.label){case 0:return[4,Ixe(e,r)];case 1:return[2,n.sent()]}})})})}var MF=.529177210859;function Dxe(e){var t=Bt.readLines(e,6),r=function(P,D){var k=+t[P].trim().split(/\s+/g)[D];return Number.isNaN(k)?0:k},n=function(P){var D=r(P+2,0),k=MF;return[Math.abs(D),A.create(r(P+2,1)*k,r(P+2,2)*k,r(P+2,3)*k),D]},a=t[0].trim(),i=t[1].trim(),o=n(0),s=o[0],u=o[1],l=o[2],c=n(1),d=c[0],f=c[1],p=n(2),h=p[0],m=p[1],v=n(3),g=v[0],y=v[1],b=kxe(e,s,MF),S=[];if(l>=0){var x=r(2,4);x===0&&(x=1);for(var C=0;C<x;C++)S.push(C)}else for(var w=Bt.readLine(e).trim().split(/\s+/g),C=0,_=+w[0];C<_;C++)S.push(+w[C+1]);var E={orbitals:l<0,comment1:a,comment2:i,atomCount:s,origin:u,dim:A.create(d,h,g),basisX:f,basisY:m,basisZ:y,dataSetIds:S};return{header:E,atoms:b}}function kxe(e,t,r){for(var n=new Int32Array(t),a=new Float64Array(t),i=new Float32Array(t),o=new Float32Array(t),s=new Float32Array(t),u=0;u<t;u++){var l=Bt.readLine(e).trim().split(/\s+/g);n[u]=+l[0],a[u]=+l[1],i[u]=+l[2]*r,o[u]=+l[3]*r,s[u]=+l[4]*r}return{count:t,number:ye.ofArray({array:n,schema:ye.Schema.int}),nuclearCharge:ye.ofArray({array:a,schema:ye.Schema.float}),x:ye.ofArray({array:i,schema:ye.Schema.float}),y:ye.ofArray({array:o,schema:ye.Schema.float}),z:ye.ofArray({array:s,schema:ye.Schema.float})}}function Rxe(e,t,r){var n=r.dim[0]*r.dim[1]*r.dim[2]*r.dataSetIds.length,a=100*100*100,i=new Float64Array(n),o=0;return fd(e,a,i,function(s,u){for(var l=Math.min(n,o+s),c=o;c<l;c++)Bt.skipWhitespace(t),t.tokenStart=t.position,Bt.eatValue(t),u[c]=td(t.data,t.tokenStart,t.tokenEnd);return o=l,l===n?0:a},function(s,u,l){return s.update({current:Math.min(l,n),max:n})})}function Oxe(e,t){var r=this;return Qe.create("Parse Cube",function(n){return pe(r,void 0,void 0,function(){var a,i,o,s,u;return he(this,function(l){switch(l.label){case 0:return[4,n.update("Reading header...")];case 1:return l.sent(),a=Bt(e),i=Dxe(a),o=i.header,s=i.atoms,[4,Rxe(n,a,o)];case 2:return u=l.sent(),[2,Nn.success({header:o,atoms:s,values:u,name:t})]}})})})}function pW(e){for(var t={h:A()},r=0,n=0,a=/\s+/g;;){var i=Bt.readLine(e),o=void 0;if(i.startsWith("object 1"))o=i.split(a),t.dim=A.create(parseInt(o[5]),parseInt(o[6]),parseInt(o[7]));else if(i.startsWith("origin"))o=i.split(a),t.min=A.create(parseFloat(o[1]),parseFloat(o[2]),parseFloat(o[3]));else if(i.startsWith("delta"))o=i.split(a),n===0?t.h[0]=parseFloat(o[1]):n===1?t.h[1]=parseFloat(o[2]):n===2&&(t.h[2]=parseFloat(o[3])),n+=1;else if(i.startsWith("object 3")){r+=i.length+1;break}r+=i.length+1}return{header:t,headerByteCount:r}}function Bxe(e,t,r){var n=r.dim[0]*r.dim[1]*r.dim[2],a=100*100*100,i=new Float64Array(n),o=0;return fd(e,a,i,function(s,u){for(var l=Math.min(n,o+s),c=o;c<l;c++)Bt.skipWhitespace(t),t.tokenStart=t.position,Bt.eatValue(t),u[c]=td(t.data,t.tokenStart,t.tokenEnd);return o=l,l===n?0:a},function(s,u,l){return s.update({current:Math.min(l,n),max:n})})}function Fxe(e,t,r){return pe(this,void 0,void 0,function(){var n,a,i;return he(this,function(o){switch(o.label){case 0:return[4,e.update("Reading header...")];case 1:return o.sent(),n=Bt(t),a=pW(n).header,[4,e.update("Reading values...")];case 2:return o.sent(),[4,Bxe(e,n,a)];case 3:return i=o.sent(),[2,Nn.success({header:a,values:i,name:r})]}})})}function Lxe(e,t,r){return pe(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d;return he(this,function(f){switch(f.label){case 0:return[4,e.update("Reading header...")];case 1:return f.sent(),n=WD(t,0,1e3),a=Bt(n),i=pW(a),o=i.header,s=i.headerByteCount,[4,e.update("Reading values...")];case 2:for(f.sent(),u=o.dim[0]*o.dim[1]*o.dim[2],l=new DataView(t.buffer,t.byteOffset+s),c=new Float64Array(u),d=0;d<u;d++)c[d]=l.getFloat64(d*8,!0);return[2,Nn.success({header:o,values:c,name:r})]}})})}function Nxe(e,t){return Qe.create("Parse Cube",function(r){return typeof e=="string"?Fxe(r,e,t):Lxe(r,e,t)})}var gr={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflower:6591981,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,laserlemon:16777044,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrod:16448210,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,maroon2:8323072,maroon3:11546720,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,purple2:8323199,purple3:10494192,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};(function(){var e=new Map;return Object.keys(gr).forEach(function(t){e.set(gr[t],t)}),e})();var hW=Ut.BuiltIn({name:"download",display:{name:"Download",description:"Download string or binary data from the specified URL"},from:[be.Root],to:[be.Data.String,be.Data.Binary],params:{url:M.Url("https://www.ebi.ac.uk/pdbe/static/entry/1cbs_updated.cif",{description:"Resource URL. Must be the same domain or support CORS."}),label:M.Optional(M.Text("")),isBinary:M.Optional(M.Boolean(!1,{description:"If true, download data as binary (string otherwise)"}))}})({apply:function(e,t){var r=this,n=e.params,a=e.cache;return Qe.create("Download",function(i){return pe(r,void 0,void 0,function(){var o,s;return he(this,function(u){switch(u.label){case 0:return o=Fn.getUrlAsset(t.managers.asset,n.url),[4,t.managers.asset.resolve(o,n.isBinary?"binary":"string").runInContext(i)];case 1:return s=u.sent(),a.asset=s,[2,n.isBinary?new be.Data.Binary(s.data,{label:n.label?n.label:o.url}):new be.Data.String(s.data,{label:n.label?n.label:o.url})]}})})})},dispose:function(e){var t,r,n=e.cache;(r=(t=n)===null||t===void 0?void 0:t.asset)===null||r===void 0||r.dispose()},update:function(e){var t=e.oldParams,r=e.newParams,n=e.b;return t.url!==r.url||t.isBinary!==r.isBinary?gt.UpdateResult.Recreate:t.label!==r.label?(n.label=r.label||(typeof r.url=="string"?r.url:r.url.url),gt.UpdateResult.Updated):gt.UpdateResult.Unchanged}}),mW=Ut.BuiltIn({name:"download-blob",display:{name:"Download Blob",description:"Download multiple string or binary data from the specified URLs."},from:be.Root,to:be.Data.Blob,params:{sources:M.ObjectList({id:M.Text("",{label:"Unique ID"}),url:M.Url("https://www.ebi.ac.uk/pdbe/static/entry/1cbs_updated.cif",{description:"Resource URL. Must be the same domain or support CORS."}),isBinary:M.Optional(M.Boolean(!1,{description:"If true, download data as binary (string otherwise)"})),canFail:M.Optional(M.Boolean(!1,{description:"Indicate whether the download can fail and not be included in the blob as a result."}))},function(e){return e.id+": "+e.url}),maxConcurrency:M.Optional(M.Numeric(4,{min:1,max:12,step:1},{description:"The maximum number of concurrent downloads."}))}})({apply:function(e,t){var r=this,n=e.params,a=e.cache;return Qe.create("Download Blob",function(i){return pe(r,void 0,void 0,function(){var o,s,u,l,c,d;return he(this,function(f){switch(f.label){case 0:return o=[],[4,Xye(i,t.managers.asset,n.sources,n.maxConcurrency||4)];case 1:for(s=f.sent(),u=[],l=0;l<s.length;l++)c=s[l],d=n.sources[l],c.kind==="error"?t.log.warn("Download "+c.id+" ("+d.url+") failed: "+c.error):(u.push(c.result),o.push(d.isBinary?{id:c.id,kind:"binary",data:c.result.data}:{id:c.id,kind:"string",data:c.result.data}));return a.assets=u,[2,new be.Data.Blob(o,{label:"Data Blob",description:o.length+" "+(o.length===1?"entry":"entries")})]}})})})},dispose:function(e,t){var r,n=e.cache,a=(r=n)===null||r===void 0?void 0:r.assets;if(!!a)for(var i=0,o=a;i<o.length;i++){var s=o[i];s.dispose()}}}),vW=Ut.BuiltIn({name:"raw-data",display:{name:"Raw Data",description:"Raw data supplied by value."},from:[be.Root],to:[be.Data.String,be.Data.Binary],params:{data:M.Value("",{isHidden:!0}),label:M.Optional(M.Text(""))}})({apply:function(e){var t=this,r=e.params;return Qe.create("Raw Data",function(){return pe(t,void 0,void 0,function(){return he(this,function(n){if(typeof r.data=="string")return[2,new be.Data.String(r.data,{label:r.label?r.label:"String"})];if(Array.isArray(r.data))return[2,new be.Data.Binary(new Uint8Array(r.data),{label:r.label?r.label:"Binary"})];if(r.data instanceof ArrayBuffer)return[2,new be.Data.Binary(new Uint8Array(r.data),{label:r.label?r.label:"Binary"})];if(r.data instanceof Uint8Array)return[2,new be.Data.Binary(r.data,{label:r.label?r.label:"Binary"})];throw new Error("Supplied binary data must be a plain array, ArrayBuffer, or Uint8Array.")})})})},update:function(e){var t=e.oldParams,r=e.newParams,n=e.b;return t.data!==r.data?gt.UpdateResult.Recreate:t.label!==r.label?(n.label=r.label||n.label,gt.UpdateResult.Updated):gt.UpdateResult.Unchanged},customSerialization:{toJSON:function(e){if(typeof e.data=="string"||Array.isArray(e.data))return e;if(e.data instanceof ArrayBuffer){for(var t=new Uint8Array(e.data),r=new Array(t.length),n=0,a=t.length;n<a;n++)r[n]=t[n];return{data:r,label:e.label}}else if(e.data instanceof Uint8Array){for(var r=new Array(e.data.length),n=0,a=e.data.length;n<a;n++)r[n]=e.data[n];return{data:r,label:e.label}}},fromJSON:function(e){return e}}}),gW=Ut.BuiltIn({name:"read-file",display:{name:"Read File",description:"Read string or binary data from the specified file"},from:be.Root,to:[be.Data.String,be.Data.Binary],params:{file:M.File(),label:M.Optional(M.Text("")),isBinary:M.Optional(M.Boolean(!1,{description:"If true, open file as as binary (string otherwise)"}))}})({apply:function(e,t){var r=this,n=e.params,a=e.cache;return Qe.create("Open File",function(i){return pe(r,void 0,void 0,function(){var o,s;return he(this,function(u){switch(u.label){case 0:return n.file===null?(t.log.error("No file(s) selected"),[2,qn.Null]):[4,t.managers.asset.resolve(n.file,n.isBinary?"binary":"string").runInContext(i)];case 1:return o=u.sent(),a.asset=o,s=n.isBinary?new be.Data.Binary(o.data,{label:n.label?n.label:n.file.name}):new be.Data.String(o.data,{label:n.label?n.label:n.file.name}),[2,s]}})})})},dispose:function(e){var t,r,n=e.cache;(r=(t=n)===null||t===void 0?void 0:t.asset)===null||r===void 0||r.dispose()},update:function(e){var t,r=e.oldParams,n=e.newParams,a=e.b;return r.label!==n.label?(a.label=n.label||((t=r.file)===null||t===void 0?void 0:t.name)||"",gt.UpdateResult.Updated):gt.UpdateResult.Unchanged},isSerializable:function(){return{isSerializable:!1,reason:"Cannot serialize user loaded files."}}}),zxe=Ut.BuiltIn({name:"parse-blob",display:{name:"Parse Blob",description:"Parse multiple data enties"},from:be.Data.Blob,to:be.Format.Blob,params:{formats:M.ObjectList({id:M.Text("",{label:"Unique ID"}),format:M.Select("cif",[["cif","cif"]])},function(e){return e.id+": "+e.format})}})({apply:function(e,t){var r=this,n=e.a,a=e.params;return Qe.create("Parse Blob",function(i){return pe(r,void 0,void 0,function(){var o,s,u,l,c,d,f,p,h;return he(this,function(m){switch(m.label){case 0:for(o=new Map,s=0,u=a.formats;s<u.length;s++)l=u[s],o.set(l.id,l.format);c=[],d=0,f=n.data,m.label=1;case 1:return d<f.length?(p=f[d],o.has(p.id)?[4,(p.kind==="string"?md.parse(p.data):md.parseBinary(p.data)).runInContext(i)]:[3,3]):[3,4];case 2:if(h=m.sent(),h.isError)throw new Error(p.id+": "+h.message);c.push({id:p.id,kind:"cif",data:h.result}),m.label=3;case 3:return d++,[3,1];case 4:return[2,new be.Format.Blob(c,{label:"Format Blob",description:c.length+" "+(c.length===1?"entry":"entries")})]}})})})}}),Uxe=Ut.BuiltIn({name:"parse-cif",display:{name:"Parse CIF",description:"Parse CIF from String or Binary data"},from:[be.Data.String,be.Data.Binary],to:be.Format.Cif})({apply:function(e){var t=this,r=e.a;return Qe.create("Parse CIF",function(n){return pe(t,void 0,void 0,function(){var a;return he(this,function(i){switch(i.label){case 0:return[4,(be.Data.String.is(r)?md.parse(r.data):md.parseBinary(r.data)).runInContext(n)];case 1:if(a=i.sent(),a.isError)throw new Error(a.message);return[2,new be.Format.Cif(a.result)]}})})})}}),Vxe=Ut.BuiltIn({name:"parse-cube",display:{name:"Parse Cube",description:"Parse Cube from String data"},from:be.Data.String,to:be.Format.Cube})({apply:function(e){var t=this,r=e.a;return Qe.create("Parse Cube",function(n){return pe(t,void 0,void 0,function(){var a;return he(this,function(i){switch(i.label){case 0:return[4,Oxe(r.data,r.label).runInContext(n)];case 1:if(a=i.sent(),a.isError)throw new Error(a.message);return[2,new be.Format.Cube(a.result)]}})})})}}),Hxe=Ut.BuiltIn({name:"parse-psf",display:{name:"Parse PSF",description:"Parse PSF from String data"},from:[be.Data.String],to:be.Format.Psf})({apply:function(e){var t=this,r=e.a;return Qe.create("Parse PSF",function(n){return pe(t,void 0,void 0,function(){var a;return he(this,function(i){switch(i.label){case 0:return[4,Mxe(r.data).runInContext(n)];case 1:if(a=i.sent(),a.isError)throw new Error(a.message);return[2,new be.Format.Psf(a.result)]}})})})}}),jxe=Ut.BuiltIn({name:"parse-ply",display:{name:"Parse PLY",description:"Parse PLY from String data"},from:[be.Data.String],to:be.Format.Ply})({apply:function(e){var t=this,r=e.a;return Qe.create("Parse PLY",function(n){return pe(t,void 0,void 0,function(){var a;return he(this,function(i){switch(i.label){case 0:return[4,Cxe(r.data).runInContext(n)];case 1:if(a=i.sent(),a.isError)throw new Error(a.message);return[2,new be.Format.Ply(a.result,{label:a.result.comments[0]||"PLY Data"})]}})})})}}),Gxe=Ut.BuiltIn({name:"parse-ccp4",display:{name:"Parse CCP4/MRC/MAP",description:"Parse CCP4/MRC/MAP from Binary data"},from:[be.Data.Binary],to:be.Format.Ccp4})({apply:function(e){var t=this,r=e.a;return Qe.create("Parse CCP4/MRC/MAP",function(n){return pe(t,void 0,void 0,function(){var a;return he(this,function(i){switch(i.label){case 0:return[4,Rbe(r.data,r.label).runInContext(n)];case 1:if(a=i.sent(),a.isError)throw new Error(a.message);return[2,new be.Format.Ccp4(a.result)]}})})})}}),qxe=Ut.BuiltIn({name:"parse-dsn6",display:{name:"Parse DSN6/BRIX",description:"Parse CCP4/BRIX from Binary data"},from:[be.Data.Binary],to:be.Format.Dsn6})({apply:function(e){var t=this,r=e.a;return Qe.create("Parse DSN6/BRIX",function(n){return pe(t,void 0,void 0,function(){var a;return he(this,function(i){switch(i.label){case 0:return[4,dxe(r.data,r.label).runInContext(n)];case 1:if(a=i.sent(),a.isError)throw new Error(a.message);return[2,new be.Format.Dsn6(a.result)]}})})})}}),Wxe=Ut.BuiltIn({name:"parse-dx",display:{name:"Parse DX",description:"Parse DX from Binary/String data"},from:[be.Data.Binary,be.Data.String],to:be.Format.Dx})({apply:function(e){var t=this,r=e.a;return Qe.create("Parse DX",function(n){return pe(t,void 0,void 0,function(){var a;return he(this,function(i){switch(i.label){case 0:return[4,Nxe(r.data,r.label).runInContext(n)];case 1:if(a=i.sent(),a.isError)throw new Error(a.message);return[2,new be.Format.Dx(a.result)]}})})})}}),Xxe=Ut.BuiltIn({name:"import-string",display:{name:"Import String",description:"Import given data as a string"},from:be.Root,to:be.Data.String,params:{data:M.Value(""),label:M.Optional(M.Text(""))}})({apply:function(e){var t=e.params,r=t.data,n=t.label;return new be.Data.String(r,{label:n||""})},update:function(e){var t=e.oldParams,r=e.newParams,n=e.b;return t.data!==r.data?gt.UpdateResult.Recreate:t.label!==r.label?(n.label=r.label||"",gt.UpdateResult.Updated):gt.UpdateResult.Unchanged},isSerializable:function(){return{isSerializable:!1,reason:"Cannot serialize user imported strings."}}}),Yxe=Ut.BuiltIn({name:"import-json",display:{name:"Import JSON",description:"Import given data as a JSON"},from:be.Root,to:be.Format.Json,params:{data:M.Value({}),label:M.Optional(M.Text(""))}})({apply:function(e){var t=e.params,r=t.data,n=t.label;return new be.Format.Json(r,{label:n||""})},update:function(e){var t=e.oldParams,r=e.newParams,n=e.b;return t.data!==r.data?gt.UpdateResult.Recreate:t.label!==r.label?(n.label=r.label||"",gt.UpdateResult.Updated):gt.UpdateResult.Unchanged},isSerializable:function(){return{isSerializable:!1,reason:"Cannot serialize user imported JSON."}}}),Kxe=Ut.BuiltIn({name:"parse-json",display:{name:"Parse JSON",description:"Parse JSON from String data"},from:[be.Data.String],to:be.Format.Json})({apply:function(e){var t=this,r=e.a;return Qe.create("Parse JSON",function(n){return pe(t,void 0,void 0,function(){var a;return he(this,function(i){switch(i.label){case 0:return[4,new Response(r.data).json()];case 1:return a=i.sent(),[2,new be.Format.Json(a)]}})})})}}),$xe=Ut.BuiltIn({name:"lazy-volume",display:{name:"Lazy Volume",description:"A placeholder for lazy loaded volume representation"},from:be.Root,to:be.Volume.Lazy,params:{url:M.Url(""),isBinary:M.Boolean(!1),format:M.Text("ccp4"),entryId:M.Value("",{isHidden:!0}),isovalues:M.ObjectList({type:M.Text("relative"),value:M.Numeric(0),color:M.Color(gr.black),alpha:M.Numeric(1,{min:0,max:1,step:.01}),volumeIndex:M.Numeric(0)},function(e){return e.type+" "+e.value})}})({apply:function(e){var t=this;e.a;var r=e.params;return Qe.create("Lazy Volume",function(n){return pe(t,void 0,void 0,function(){var a;return he(this,function(i){return a=Array.isArray(r.entryId)?r.entryId.join(", "):r.entryId,[2,new be.Volume.Lazy(r,{label:""+(a||r.url),description:"Lazy Volume"})]})})})}}),Qxe=Object.freeze({__proto__:null,Download:hW,DownloadBlob:mW,RawData:vW,ReadFile:gW,ParseBlob:zxe,ParseCif:Uxe,ParseCube:Vxe,ParsePsf:Hxe,ParsePly:jxe,ParseCcp4:Gxe,ParseDsn6:qxe,ParseDx:Wxe,ImportString:Xxe,ImportJson:Yxe,ParseJson:Kxe,LazyVolume:$xe}),Zxe=Ut.BuiltIn({name:"create-group",display:{name:"Group"},from:[],to:be.Group,params:{label:M.Text("Group"),description:M.Optional(M.Text(""))}})({apply:function(e){var t=e.params;return new be.Group({},t)},update:function(e){var t=e.oldParams,r=e.newParams,n=e.b;return p0(t,r)?gt.UpdateResult.Unchanged:(n.label=r.label,n.description=r.description,gt.UpdateResult.Updated)}}),Jxe=Object.freeze({__proto__:null,CreateGroup:Zxe});function eSe(e){var t=new DataView(e.buffer),r=Object.create(null),n=[],a=0,i=new Int32Array(e.buffer,0,23),o=i[0]!==t.getInt32(0);if(i[0]!==84)for(var s=e.byteLength,u=0;u<s;u+=4)t.setFloat32(u,t.getFloat32(u),!0);if(i[0]!==84)throw new Error("dcd bad format, header block start");var l=String.fromCharCode(t.getUint8(4),t.getUint8(5),t.getUint8(6),t.getUint8(7));if(l!=="CORD")throw new Error("dcd bad format, format string");var c=!1,d=!1,f=!1;if(i[22]!==0&&(c=!0,i[12]!==0&&(d=!0),i[13]===1&&(f=!0)),r.NSET=i[2],r.ISTART=i[3],r.NSAVC=i[4],r.NAMNF=i[10],c?r.DELTA=t.getFloat32(44,o):r.DELTA=t.getFloat64(44,o),i[22]!==84)throw new Error("dcd bad format, header block end");a=a+21*4+8;var p=t.getInt32(a,o),h=a+1;if((p-4)%80!==0)throw new Error("dcd bad format, title block start");if(r.TITLE=o2e(e.subarray(h,p)),t.getInt32(h+p+4-1,o)!==p)throw new Error("dcd bad format, title block end");if(a=a+p+8,t.getInt32(a,o)!==4)throw new Error("dcd bad format, natom block start");if(r.NATOM=t.getInt32(a+4,o),t.getInt32(a+8,o)!==4)throw new Error("dcd bad format, natom block end");if(a=a+4+8,r.NAMNF>0)throw new Error("dcd format with fixed atoms unsupported, aborting");for(var m=r.NATOM,v=m*4,u=0,s=r.NSET;u<s;++u){var g=Object.create(null);g.elementCount=m,d&&(a+=4,g.cell=[t.getFloat64(a,o),t.getFloat64(a+1,o),t.getFloat64(a+2*8,o),t.getFloat64(a+3*8,o),t.getFloat64(a+4*8,o),t.getFloat64(a+5*8,o)],a+=48,a+=4);for(var y=0;y<3;++y){if(t.getInt32(a,o)!==v)throw new Error("dcd bad format, coord block start: "+u+", "+y);a+=4;var b=new Float32Array(e.buffer,a,m);if(y===0?g.x=b:y===1?g.y=b:g.z=b,a+=v,t.getInt32(a,o)!==v)throw new Error("dcd bad format, coord block end: "+u+", "+y);a+=4}if(f){var S=t.getInt32(a,o);a+=4+S+4}n.push(g)}return{header:r,frames:n}}function tSe(e){var t=this;return Qe.create("Parse DCD",function(r){return pe(t,void 0,void 0,function(){var n;return he(this,function(a){try{return n=eSe(e),[2,Nn.success(n)]}catch(i){return[2,Nn.error(i)]}return[2]})})})}function rSe(e){return function(t,r,n){return nSe(e,t,r,n)}}function nSe(e,t,r,n){var a=e.data,i=e.indices,o=e.count,s=n.valueType,u=s==="str"?function(l){var c=i[2*l]+t,d=i[2*l+1];if(c>=d)return"";var f=c+r;return f>d&&(f=d),Lbe(a,c,f)}:s==="int"?function(l){var c=i[2*l]+t;return c>i[2*l+1]?0:hh(a,c,c+r)}:function(l){var c=i[2*l]+t;return c>i[2*l+1]?0:Uge(a,c,c+r)};return{schema:n,__array:void 0,isDefined:!0,rowCount:o,value:u,valueKind:function(l){return 0},toArray:function(l){return hi(o,u,l)},areValuesEqual:function(l,c){return u(l)===u(c)}}}function aSe(){return{title:"",timeInPs:0,hasVelocities:!1,precision:{position:0,velocity:0},box:[0,0,0]}}function iSe(e,t){return{tokenizer:e,header:aSe(),numberOfAtoms:0,runtimeCtx:t}}function oSe(e){var t=e.tokenizer,r=e.header,n=Bt.readLine(t);n.trim().length===0&&(n=Bt.readLine(t));var a=n.lastIndexOf("t=");a>=0?(r.timeInPs=parseFloat(n.substring(a+2)),r.title=n.substring(0,a).trim(),r.title&&r.title[r.title.length-1]===","&&(r.title=r.title.substring(0,r.title.length-1))):r.title=n}function sSe(e){var t=e.tokenizer;Bt.markLine(t);var r=Bt.getTokenString(t);e.numberOfAtoms=parseInt(r)}function uSe(e){return pe(this,void 0,void 0,function(){var t,r,n,a,i,o,s,u,l,c,d,f,p;return he(this,function(h){switch(h.label){case 0:return t=e.tokenizer,r=e.numberOfAtoms,[4,Bt.readLinesAsync(t,r,e.runtimeCtx,1e5)];case 1:return n=h.sent(),a=t.data.substring(n.indices[0],n.indices[1]).substring(20),i=a.match(/\.\d+/g),o=i.length===6,e.header.hasVelocities=o,e.header.precision.position=i[0].length-1,e.header.precision.velocity=o?i[3].length-1:0,s=20,u=e.header.precision.position+5,l=s+3*u,c=e.header.precision.velocity+4,d=rSe(n),f=ye.Undefined(e.numberOfAtoms,ye.Schema.float),p={count:e.numberOfAtoms,residueNumber:d(0,5,ye.Schema.int),residueName:d(5,5,ye.Schema.str),atomName:d(10,5,ye.Schema.str),atomNumber:d(15,5,ye.Schema.int),x:d(s,u,ye.Schema.float),y:d(s+u,u,ye.Schema.float),z:d(s+2*u,u,ye.Schema.float),vx:o?d(l,c,ye.Schema.float):f,vy:o?d(l+c,c,ye.Schema.float):f,vz:o?d(l+2*c,c,ye.Schema.float):f},[2,p]}})})}function lSe(e){var t=e.tokenizer,r=Bt.readLine(t).trim().split(/\s+/g);e.header.box=[+r[0],+r[1],+r[2]]}function cSe(e,t){return pe(this,void 0,void 0,function(){var r,n,a,i,o;return he(this,function(s){switch(s.label){case 0:return r=Bt(e),[4,t.update({message:"Parsing...",current:0,max:e.length})];case 1:s.sent(),n=[],s.label=2;case 2:return r.position<e.length?(a=iSe(r,t),oSe(a),sSe(a),[4,uSe(a)]):[3,4];case 3:return i=s.sent(),lSe(a),n.push({header:a.header,atoms:i}),[3,2];case 4:return o={structures:n},[2,Nn.success(o)]}})})}function dSe(e){var t=this;return Qe.create("Parse GRO",function(r){return pe(t,void 0,void 0,function(){return he(this,function(n){switch(n.label){case 0:return[4,cSe(e,r)];case 1:return[2,n.sent()]}})})})}function fSe(e,t,r){var n=this;return r===void 0&&(r=!1),Qe.create("Parse PDB",function(a){return pe(n,void 0,void 0,function(){var i,o,s;return he(this,function(u){switch(u.label){case 0:return o=(i=Nn).success,s={},[4,Bt.readAllLinesAsync(e,a)];case 1:return[2,o.apply(i,[(s.lines=u.sent(),s.id=t,s.isPdbqt=r,s)])]}})})})}function Dp(e){return{kind:"table-legend",table:e}}function pSe(e,t,r){return{kind:"scale-legend",minLabel:e,maxLabel:t,colors:r}}var ka;(function(e){e.Zero=0;var t=function(){var m=new ArrayBuffer(8),v=new ArrayBuffer(8);return{_int32:new Int32Array(m),_float64:new Float64Array(m),_int32_1:new Int32Array(v),_float64_1:new Float64Array(v)}}(),r=t._int32,n=t._float64,a=t._int32_1,i=t._float64_1;function o(m){return typeof m=="number"}e.is=o;function s(m,v){return r[0]=m,r[1]=v,n[0]}e.create=s;function u(m){return n[0]=m,r[0]}e.fst=u;function l(m){return n[0]=m,r[1]}e.snd=l;function c(m,v){return n[0]=m,i[0]=v,r[0]===a[0]&&r[1]===a[1]}e.areEqual=c;function d(m,v){n[0]=m,i[0]=v;var g=r[0]-a[0];return g!==0?g:r[1]-a[1]}e.compare=d;function f(m,v,g){n[0]=m[v],i[0]=m[g];var y=r[0]-a[0];return y!==0?y:r[1]-a[1]}e.compareInArray=f;function p(m){return n[0]=m,wm(r[0],r[1])}e.hashCode=p;function h(m){return n[0]=m,"("+r[0]+", "+r[1]+")"}e.toString=h})(ka||(ka={}));var yW=ka.Zero;function DF(e,t){return t<e?ka.create(e,e):ka.create(e,t+1)}function ok(e,t){return t<=e?ka.create(e,e):ka.create(e,t)}function hSe(e){return e<0?ka.create(0,0):ka.create(0,e)}var mSe=ka.is,vd=ka.fst,yp=ka.snd,kC=ka.fst;function RC(e){return ka.snd(e)-1}function Vh(e){return ka.snd(e)-ka.fst(e)}var vSe=ka.hashCode,gSe=ka.toString;function ySe(e,t){return ka.fst(e)<=t&&t<ka.snd(e)}function bSe(e,t){var r=vd(e);return t>=r&&t<yp(e)?t-r:-1}function xSe(e,t){return ka.fst(e)+t}var SSe=ka.areEqual;function bW(e,t){var r=Vh(e),n=Vh(t);return r===0&&n===0?!0:r>0&&n>0&&RC(e)>=kC(t)&&kC(e)<=RC(t)}function CSe(e,t){return Vh(e)?Vh(t)?vd(e)<=vd(t)&&yp(e)>=yp(t):!0:Vh(t)===0}function i5(e,t){var r=vd(e);if(t<=r)return 0;var n=yp(e);return t>=n?n-r:t-r}function wSe(e,t,r){var n=vd(r),a=vd(e);if(t<=n+a)return n;var i=yp(r);return t>=i+a?i:t-a}function xW(e,t,r){return ok(i5(e,t),i5(e,r+1))}function _Se(e,t){return bW(e,t)?ok(Math.max(vd(e),vd(t)),Math.min(yp(e),yp(t))):yW}function ASe(e,t){return Vh(xW(e,kC(t),RC(t)))}var Me;(function(e){e.Empty=yW,e.ofSingleton=function(t){return DF(t,t)},e.ofRange=DF,e.ofBounds=ok,e.ofLength=hSe,e.is=mSe,e.has=ySe,e.indexOf=bSe,e.getAt=xSe,e.start=vd,e.end=yp,e.min=kC,e.max=RC,e.size=Vh,e.hashCode=vSe,e.toString=gSe,e.areEqual=SSe,e.areIntersecting=bW,e.isSubInterval=CSe,e.findPredecessorIndex=i5,e.findPredecessorIndexInInterval=wSe,e.findRange=xW,e.intersectionSize=ASe,e.intersect=_Se})(Me||(Me={}));var D1=[];function TSe(e){return[e]}function ESe(e){return e}function PSe(e){return Wu(e),e}function kF(e,t){if(t<e)return[];for(var r=new Int32Array(t-e+1),n=e;n<=t;n++)r[n-e]=n;return r}function ISe(e){return e&&(Array.isArray(e)||!!e.buffer)}function o5(e){return e[0]}function s5(e){return e[e.length-1]+1}function MSe(e){return e[0]}function DSe(e){return e[e.length-1]}function SW(e){return e.length}function kSe(e){var t=e.length;return t?t>2?Nge(t,e[0],e[t-1],e[t>>1]):Lge(t,e[0],e[t-1]):0}function RSe(e){var t=e.length;return t>5?"["+e[0]+", "+e[1]+", ..., "+e[t-1]+"], length "+t:"["+e.join(", ")+"]"}function CW(e,t){var r=e.length;return r===0?-1:e[0]<=t&&t<=e[r-1]?_W(e,t,0,r):-1}function OSe(e,t,r){return wW(e,t,Me.start(r),Me.end(r))}function wW(e,t,r,n){var a=e.length;return a===0||n<=r?-1:e[r]<=t&&t<=e[n-1]?_W(e,t,r,n):-1}function BSe(e,t){return CW(e,t)>=0}function FSe(e,t){if(e===t)return!0;var r=e.length;if(r!==t.length||e[0]!==t[0]||e[r-1]!==t[r-1])return!1;for(var n=0;n<r;n++)if(e[n]!==t[n])return!1;return!0}function Mh(e,t){var r=e.length;return t<=e[0]?0:t>e[r-1]?r:AW(e,t,0,r)}function LSe(e,t,r){var n=Me.start(r),a=Me.end(r),i=e[n];return t<=i?n:a>n&&t>e[a-1]?a:t-i<=11?zSe(e,t,n+1,a):AW(e,t,n,a)}function NSe(e,t,r){return Me.ofBounds(Mh(e,t),Mh(e,r+1))}function _W(e,t,r,n){for(var a=r,i=n-1;a<=i;){if(a+11>i){for(var o=a;o<=i;o++)if(t===e[o])return o;return-1}var s=a+i>>1,u=e[s];if(t<u)i=s-1;else if(t>u)a=s+1;else return s}return-1}function AW(e,t,r,n){for(var a=r,i=n-1;a<i;){if(a+11>i){for(var o=a;o<=i;o++)if(t<=e[o])return o;return i+1}var s=a+i>>1,u=e[s];if(t<u)i=s-1;else if(t>u)a=s+1;else return s}return a>i?i+1:e[a]>=t?a:a+1}function zSe(e,t,r,n){for(var a=r;a<n;a++)if(t<=e[a])return a;return n}function USe(e,t){if(e===t)return!0;for(var r=_m(e,t),n=r.startI,a=r.startJ,i=r.endI,o=r.endJ;n<i&&a<o;){var s=e[n],u=t[a];if(s<u)n++;else if(s>u)a++;else return!0}return!1}function VSe(e,t){if(e===t)return!0;var r=t.length,n=_m(e,t),a=n.startI,i=n.startJ,o=n.endI,s=n.endJ;if(s-i<r||o-a<r)return!1;for(var u=0;a<o&&i<s;){var l=e[a],c=t[i];l<c?a++:l>c?i++:(a++,i++,u++)}return u===r}function TW(e,t){if(e===t)return e;var r=e.length,n=t.length;if(r===0)return t;if(n===0)return e;if(e[0]>t[0])return TW(t,e);var a=_m(e,t),i=a.startI,o=a.startJ,s=a.endI,u=a.endJ,l=sk(e,t,i,o,s,u);if(l===r&&l===n||l===n)return e;if(l===r)return t;var c=new Int32Array(r+n-l),d=0,f=0,p=0;for(d=0;d<i;d++)c[p++]=e[d];for(;f<u&&e[i]>t[f];)c[p++]=t[f++];for(;d<s&&f<u;){var h=e[d],m=t[f];h<m?(c[p++]=h,d++):h>m?(c[p++]=m,f++):(c[p++]=h,d++,f++)}for(;d<s;d++)c[p++]=e[d];for(;f<u;f++)c[p++]=t[f];for(;d<r;d++)c[p++]=e[d];for(;f<n;f++)c[p++]=t[f];return c}function HSe(e,t){if(e===t)return SW(e);var r=_m(e,t),n=r.startI,a=r.startJ,i=r.endI,o=r.endJ;return sk(e,t,n,a,i,o)}function sk(e,t,r,n,a,i){for(var o=r,s=n,u=0;o<a&&s<i;){var l=e[o],c=t[s];l<c?o++:l>c?s++:(o++,s++,u++)}return u}function jSe(e,t){if(e===t)return e;var r=_m(e,t),n=r.startI,a=r.startJ,i=r.endI,o=r.endJ,s=sk(e,t,n,a,i,o),u=e.length,l=t.length;if(!s)return D1;if(s===u&&s===l||s===l)return t;if(s===u)return e;for(var c=new Int32Array(s),d=0,f=n,p=a;f<i&&p<o;){var h=e[f],m=t[p];h<m?f++:(h>m||(c[d++]=h,f++),p++)}return c}function GSe(e,t){if(e===t)return D1;for(var r=e.length,n=_m(e,t),a=n.startI,i=n.startJ,o=n.endI,s=n.endJ,u=a,l=i,c=0;u<o&&l<s;){var d=e[u],f=t[l];d<f?u++:d>f?l++:(u++,l++,c++)}if(!c)return e;if(c>=r)return D1;for(var p=new Int32Array(r-c),h=0,m=0;m<a;m++)p[h++]=e[m];for(u=a,l=i;u<o&&l<s;){var d=e[u],f=t[l];d<f?(p[h++]=d,u++):(d>f||u++,l++)}for(;u<r;u++)p[h++]=e[u];return p}function qSe(e){if(e.length<2)return e;for(var t=1,r=0,n=e.length-1;r<n;r++)e[r]!==e[r+1]&&t++;if(t===e.length)return e;for(var a=new Int32Array(t),i=0,r=0,n=e.length-1;r<n;r++)e[r]!==e[r+1]&&(a[i++]=e[r]);return a[i]=e[e.length-1],a}function WSe(e,t){if(e===t)return LP(0,e.length-1);for(var r=_m(e,t),n=r.startI,a=r.startJ,i=r.endI,o=r.endJ,s=n,u=a,l=0;s<i&&u<o;){var c=e[s],d=t[u];c<d?s++:c>d?u++:(s++,u++,l++)}var f=e.length;if(!l)return D1;if(l===f)return LP(0,e.length-1);var p=new Int32Array(l),h=0;for(s=n,u=a;s<i&&u<o;){var c=e[s],d=t[u];c<d?s++:(c>d||(p[h++]=s,s++),u++)}return p}var wc={startI:0,startJ:0,endI:0,endJ:0};function _m(e,t){var r=e.length,n=t.length,a=r/n;return r>=128||n>=128||a<=.34||a>=2.99?(wc.startI=Mh(e,o5(t)),wc.startJ=Mh(t,o5(e)),wc.endI=Mh(e,s5(t)),wc.endJ=Mh(t,s5(e))):(wc.startI=0,wc.startJ=0,wc.endI=r,wc.endJ=n),wc}var nt;(function(e){e.Empty=D1,e.ofUnsortedArray=PSe,e.ofSingleton=TSe,e.ofSortedArray=ESe,e.ofRange=kF,e.ofBounds=function(t,r){return kF(t,r-1)},e.is=ISe,e.has=BSe,e.indexOf=CW,e.indexOfInInterval=OSe,e.indexOfInRange=wW,e.start=o5,e.end=s5,e.min=MSe,e.max=DSe,e.size=SW,e.hashCode=kSe,e.toString=RSe,e.areEqual=FSe,e.areIntersecting=USe,e.isSubset=VSe,e.union=TW,e.intersect=jSe,e.subtract=GSe,e.findPredecessorIndex=Mh,e.findPredecessorIndexInInterval=LSe,e.findRange=NSe,e.intersectionSize=HSe,e.deduplicate=qSe,e.indicesOf=WSe})(nt||(nt={}));var ic=Me.Empty,XSe=Me.ofSingleton,YSe=Me.ofRange,KSe=Me.ofBounds;function ll(e){return e.length?e[e.length-1]-e[0]+1===e.length?Me.ofRange(e[0],e[e.length-1]):e:ic}function Hh(e){return Me.is(e)?Me.size(e):nt.size(e)}function $Se(e,t){return Me.is(e)?Me.has(e,t):nt.has(e,t)}function QSe(e,t){return Me.is(e)?Me.indexOf(e,t):nt.indexOf(e,t)}function u5(e,t){return Me.is(e)?Me.getAt(e,t):e[t]}function m0(e){return Me.is(e)?Me.min(e):nt.min(e)}function v0(e){return Me.is(e)?Me.max(e):nt.max(e)}function ZSe(e){return Me.is(e)?Me.start(e):nt.start(e)}function JSe(e){return Me.is(e)?Me.end(e):nt.end(e)}function eCe(e){return Me.is(e)?Me.hashCode(e):nt.hashCode(e)}function tCe(e){return Me.is(e)?Me.toString(e):nt.toString(e)}function rCe(e,t){return Me.is(e)?Me.is(t)?Me.areEqual(e,t):RF(e,t):Me.is(t)?RF(t,e):nt.areEqual(e,t)}function nCe(e,t){return Me.is(e)?Me.is(t)?Me.areIntersecting(e,t):OF(t,e):Me.is(t)?OF(e,t):nt.areIntersecting(e,t)}function aCe(e,t){return Me.is(e)?Me.is(t)?Me.isSubInterval(e,t):pCe(e,t):Me.is(t)?fCe(e,t):nt.isSubset(e,t)}function iCe(e,t){return Me.is(e)?Me.findPredecessorIndex(e,t):nt.findPredecessorIndex(e,t)}function oCe(e,t,r){return Me.is(e)?Me.findPredecessorIndexInInterval(e,t,r):nt.findPredecessorIndexInInterval(e,t,r)}function sCe(e,t,r){return Me.is(e)?Me.findRange(e,t,r):nt.findRange(e,t,r)}function uCe(e,t){return Me.is(e)?Me.is(t)?Me.intersectionSize(e,t):FF(t,e):Me.is(t)?FF(e,t):nt.intersectionSize(e,t)}function lCe(e,t){return Me.is(e)?Me.is(t)?vCe(e,t):BF(t,e):Me.is(t)?BF(e,t):ll(nt.union(e,t))}function cCe(e,t){return Me.is(e)?Me.is(t)?Me.intersect(e,t):LF(t,e):Me.is(t)?LF(e,t):ll(nt.intersect(e,t))}function dCe(e,t){return Me.is(e)?Me.is(t)?gCe(e,t):bCe(e,t):Me.is(t)?yCe(e,t):ll(nt.subtract(e,t))}function RF(e,t){return Me.size(e)===nt.size(t)&&Me.start(e)===nt.start(t)&&Me.end(e)===nt.end(t)}function OF(e,t){return e.length!==0&&Me.size(nt.findRange(e,Me.min(t),Me.max(t)))!==0}function fCe(e,t){var r=Me.min(t),n=Me.max(t);if(n-r+1===0)return!0;var a=nt.min(e),i=nt.max(e);if(r<a||n>i)return!1;var o=nt.findRange(e,r,n);return Me.size(o)===Me.size(t)}function pCe(e,t){var r=Me.min(e),n=Me.max(e);if(n-r+1===0)return!1;var a=nt.min(t),i=nt.max(t);return a>=r&&i<=n}function hCe(e,t){var r=Hh(e),n=Hh(t);return r===0&&n===0?!0:r>0&&n>0&&v0(e)>=m0(t)&&m0(e)<=v0(t)}function mCe(e,t){return Hh(e)?Hh(t)?m0(e)<=m0(t)&&v0(e)>=v0(t):!0:Hh(t)===0}function vCe(e,t){if(Me.areEqual(e,t))return e;var r=Me.size(e),n=Me.size(t);if(!n)return e;if(!r)return t;var a=Me.min(e),i=Me.min(t);if(hCe(e,t))return Me.ofRange(Math.min(a,i),Math.max(Me.max(e),Me.max(t)));var o,s,u,l;a<i?(o=r,s=a,u=n,l=i):(o=n,s=i,u=r,l=a);for(var c=new Int32Array(r+n),d=0;d<o;d++)c[d]=d+s;for(var d=0;d<u;d++)c[d+o]=d+l;return ll(c)}function BF(e,t){var r=Me.size(t);if(!r)return e;if(mCe(t,e))return t;for(var n=Me.min(t),a=Me.max(t),i=nt.findRange(e,n,a),o=Me.start(i),s=Me.end(i),u=new Int32Array(o+(e.length-s)+r),l=0,c=0;c<o;c++)u[l++]=e[c];for(var c=n;c<=a;c++)u[l++]=c;for(var c=s,d=e.length;c<d;c++)u[l++]=e[c];return ll(u)}function FF(e,t){if(!Me.size(t))return 0;var r=nt.findRange(e,Me.min(t),Me.max(t));return Me.end(r)-Me.start(r)}function LF(e,t){if(!Me.size(t))return ic;var r=nt.findRange(e,Me.min(t),Me.max(t)),n=Me.start(r),a=Me.end(r),i=a-n;if(!i)return ic;if(i===e.length)return e;for(var o=new Int32Array(i),s=0,u=n;u<a;u++)o[s++]=e[u];return ll(o)}function gCe(e,t){if(Me.areEqual(e,t))return ic;if(!Me.areIntersecting(e,t))return e;var r=Me.min(e),n=Me.max(e),a=Me.min(t),i=Me.max(t);if(n<r||i<a)return e;if(Me.isSubInterval(t,e))return ic;if(Me.isSubInterval(e,t)){var o=a-r,s=n-i;if(o<=0)return Me.ofRange(i+1,i+s);if(s<=0)return Me.ofRange(r,r+o-1);for(var u=new Int32Array(o+s),l=0,c=0;c<o;c++)u[l++]=r+c;for(var c=1;c<=s;c++)u[l++]=i+c;return ll(u)}return r<a?Me.ofRange(r,a-1):Me.ofRange(i+1,n)}function yCe(e,t){var r=Me.min(t),n=Me.max(t);if(n<r)return e;var a=nt.findRange(e,r,n),i=Me.start(a),o=Me.end(a),s=e.length-(o-i);if(s<=0)return ic;if(s===e.length)return e;for(var u=new Int32Array(s),l=0,c=0;c<i;c++)u[l++]=e[c];for(var c=o,d=e.length;c<d;c++)u[l++]=e[c];return ll(u)}function bCe(e,t){var r=Me.min(e),n=Me.max(e);if(n<r)return e;var a=n-r+1,i=nt.findRange(t,r,n),o=Me.start(i),s=Me.end(i),u=s-o;if(u===0)return e;var l=a-u;if(l<=0)return ic;for(var c=new Int32Array(l),d=t.length-1,f=t[Math.min(o,d)],p=t[Math.min(s,d)],h=0,m=r;m<f;m++)c[h++]=m;for(var m=f;m<=p;m++)nt.indexOfInInterval(t,m,i)<0&&(c[h++]=m);for(var m=p+1;m<=n;m++)c[h++]=m;return ll(c)}function xCe(e,t,r){if(Me.is(e))for(var n=Me.min(e),a=n,i=Me.max(e);a<=i;a++)t(a,a-n,r);else for(var a=0,i=e.length;a<i;a++)t(e[a],a,r);return r}function SCe(e,t,r,n){if(Me.is(e))for(var a=0,i=Me.min(e),o=Me.max(e);i<=o;i++){for(var s=t(i),u=i+1;u<o&&t(u)===s;)u++;i=u-1,r(s,a,n),a++}else for(var a=0,i=0,o=e.length;i<o;i++){for(var s=t(e[i]),u=i+1;u<o&&t(e[u])===s;)u++;i=u-1,r(s,a,n),a++}return n}function CCe(e,t,r){if(t===r)return e;var n=Hh(e),a=t.length,i=r.length;if(n===0||a===0||i===0)return ic;for(var o=nt.findPredecessorIndex(r,t[m0(e)]),s=nt.findPredecessorIndex(r,t[v0(e)]+1),u=0,l=0,c=0,d=o;c<n&&d<s;){var f=t[u5(e,c)],p=r[d];f<p?c++:(f>p||(u++,c++),d++)}if(u===0)return ic;if(u===a&&u===i)return e;var h=new Int32Array(u);for(l=0,c=0,d=o;c<n&&d<s;){var f=t[u5(e,c)],p=r[d];f<p?c++:(f>p||(h[l++]=d,c++),d++)}return ll(h)}var Ne;(function(e){e.Empty=ic,e.ofSingleton=XSe,e.ofRange=YSe,e.ofBounds=KSe,e.ofSortedArray=ll,e.has=$Se,e.indexOf=QSe,e.getAt=u5,e.min=m0,e.max=v0,e.start=ZSe,e.end=JSe,e.size=Hh,e.hashCode=eCe,e.areEqual=rCe,e.areIntersecting=nCe,e.isSubset=aCe,e.union=lCe,e.intersect=cCe,e.indexedIntersect=CCe,e.subtract=dCe,e.findPredecessorIndex=iCe,e.findPredecessorIndexInInterval=oCe,e.findRange=sCe,e.intersectionSize=uCe;function t(s,u,l){return xCe(s,u,l)}e.forEach=t;function r(s,u,l,c){return SCe(s,u,l,c)}e.forEachSegment=r;function n(s){return Me.is(s)}e.isInterval=n;function a(s){return!Me.is(s)}e.isSortedArray=a;function i(s){var u=[];return e.forEach(s,function(l){return u.push(l)}),u}e.toArray=i;function o(s){return tCe(s)}e.toString=o})(Ne||(Ne={}));function EW(e){for(var t=nt.ofSortedArray(e),r=nt.max(t),n=new Int32Array(r),a=0,i=e.length-1;a<i;a++)for(var o=e[a],s=e[a+1];o<s;o++)n[o]=a;return{offsets:t,index:n,count:e.length-1}}function wCe(e,t){for(var r=Me.start(t),n=new Int32Array(e.length+1),a=0,i=e.length;a<i;a++)n[a]=e[a]-r;return n[e.length]=Me.end(t)-r,EW(n)}function _Ce(e){var t=e.count;return t}function ACe(e,t){var r=e.index;return r[t]}function TCe(e,t,r){var n=e.offsets,a=Ne.max(n),i=r>=a?-1:Ne.findPredecessorIndex(n,r-1);return Ne.findRange(t,Ne.getAt(n,i),Ne.getAt(n,i+1)-1)}var ECe=function(){function e(t,r,n,a){this.segments=t,this.segmentMap=r,this.set=n,this.segmentMin=0,this.segmentMax=0,this.setRange=Me.Empty,this.value={index:0,start:0,end:0},this.hasNext=!1,this.setRange=a,this.updateSegmentRange()}return e.prototype.move=function(){for(;this.hasNext;)if(this.updateValue()){this.value.index=this.segmentMin++,this.hasNext=this.segmentMax>=this.segmentMin&&Me.size(this.setRange)>0;break}else this.updateSegmentRange();return this.value},e.prototype.updateValue=function(){var t=this.segments[this.segmentMin+1],r=Ne.findPredecessorIndexInInterval(this.set,t,this.setRange);return this.value.start=Me.start(this.setRange),this.value.end=r,this.setRange=Me.ofBounds(r,Me.end(this.setRange)),r>this.value.start},e.prototype.updateSegmentRange=function(){var t=Me.min(this.setRange),r=Me.max(this.setRange);if(r<t){this.hasNext=!1;return}this.segmentMin=this.segmentMap[Ne.getAt(this.set,t)],this.segmentMax=this.segmentMap[Ne.getAt(this.set,r)],this.hasNext=this.segmentMax>=this.segmentMin},e.prototype.setSegment=function(t){this.setRange=Me.ofBounds(t.start,t.end),this.updateSegmentRange()},e}();function PCe(e,t,r){var n=typeof r<"u"?Me.ofBounds(r.start,r.end):Me.ofBounds(0,Ne.size(t));return new ECe(e.offsets,e.index,t,n)}var pr;(function(e){e.create=EW,e.ofOffsets=wCe,e.count=_Ce,e.getSegment=ACe,e.projectValue=TCe,e.transientSegments=PCe})(pr||(pr={}));function ICe(e){return new MCe(e)}var MCe=function(){function e(t){this.head=t>0?0:-1,this.prev=new Int32Array(t),this.next=new Int32Array(t);for(var r=0;r<t;r++)this.next[r]=r+1,this.prev[r]=r-1;this.prev[0]=-1,this.next[t-1]=-1}return e.prototype.remove=function(t){var r=this,n=r.prev,a=r.next,i=n[t],o=a[t];i>=0&&(a[i]=o,n[t]=-1),o>=0&&(n[o]=i,a[t]=-1),t===this.head&&(i<0?this.head=o:this.head=i)},e.prototype.has=function(t){return this.prev[t]>=0||this.next[t]>=0||this.head===t},e}(),hu;(function(e){e.Empty=new Map;function t(o){return HD(o.keys())}e.keyArray=t;function r(){return new Map}e.Mutable=r;function n(o){return o}e.asImmutable=n;function a(o){for(var s=r(),u=o.keys();;){var l=u.next(),c=l.done,d=l.value;if(c)break;s.set(d,o.get(d))}return s}e.copy=a;function i(o,s){for(var u=s.keys();;){var l=u.next(),c=l.done,d=l.value;if(c)break;o.set(d,s.get(d))}return o}e.addFrom=i})(hu||(hu={}));var DCe=function(){function e(t){this.xs=[],this.index=-1,this.length=0,this.hasNext=!1,this.length=t.length,this.hasNext=t.length>0,this.xs=t,this.index=-1,this.lastValue=t.length>0?t[0]:void 0}return e.prototype.move=function(){return++this.index,this.lastValue=this.xs[this.index],this.hasNext=this.index<this.length-1,this.lastValue},e}(),NF=function(){function e(t,r){this.max=r,this.value=0,this.hasNext=!1,this.value=t-1,this.hasNext=r>=t}return e.prototype.move=function(){return++this.value,this.hasNext=this.value<this.max,this.value},e}(),kCe=function(){function e(t){this.value=t,this.hasNext=!0}return e.prototype.move=function(){return this.hasNext=!1,this.value},e}(),RCe=function(){function e(t,r){this.base=t,this.f=r,this.hasNext=!1,this.hasNext=t.hasNext}return e.prototype.move=function(){var t=this.f(this.base.move());return this.hasNext=this.base.hasNext,t},e}(),OCe=function(){function e(t,r){this.base=t,this.p=r,this.hasNext=this.findNext()}return e.prototype.move=function(){var t=this.next;return this.hasNext=this.findNext(),t},e.prototype.findNext=function(){for(;this.base.hasNext;)if(this.next=this.base.move(),this.p(this.next))return!0;return!1},e}(),OC;(function(e){e.Empty=new NF(0,-1);function t(s){return new DCe(s)}e.Array=t;function r(s){return new kCe(s)}e.Value=r;function n(s,u){return new NF(s,u)}e.Range=n;function a(s,u){return new RCe(s,u)}e.map=a;function i(s,u){return new OCe(s,u)}e.filter=i;function o(s,u,l){for(;s.hasNext;){var c=u(s.move(),l);if(c)return l}return l}e.forEach=o})(OC||(OC={}));var BCe={domain:[0,1],reverse:!1,listOrName:"red-yellow-blue",minLabel:"",maxLabel:""},nl;(function(e){function t(r){var n=T(T({},BCe),r),a=n.domain,i=n.reverse,o=n.listOrName,s=typeof o=="string"?fu(o).list:o,u=i?s.slice().reverse():s,l=u.length-1,c=0,d=0,f=0;function p(C,w){d=C,f=w,c=f-d||1}p(a[0],a[1]);var h=ja(r.minLabel,d.toString()),m=ja(r.maxLabel,f.toString()),v,g=u.every(function(C){return Array.isArray(C)});if(g){var y=Gt([],u);y.sort(function(C,w){return C[1]-w[1]});var b=y.map(function(C){return C[0]}),S=nt.ofSortedArray(y.map(function(C){return C[1]})),x=b.length-1;v=function(C){var w=$i((C-d)/c,0,1),_=nt.findPredecessorIndex(S,w);if(_===0)return b[d];if(_>x)return b[x];var E=S[_-1],P=S[_],D=$i((w-E)/(P-E),0,1);return vt.interpolate(b[_-1],b[_],D)}}else v=function(C){var w=Math.min(u.length-1,Math.max(0,(C-d)/c*l)),_=Math.floor(w),E=u[_],P=u[Math.ceil(w)];return vt.interpolate(E,P,w-_)};return{color:v,colorToArray:function(C,w,_){vt.toArray(v(C),w,_)},normalizedColorToArray:function(C,w,_){vt.toArrayNormalized(v(C),w,_)},setDomain:p,get legend(){return pSe(h,m,u)}}}e.create=t})(nl||(nl={}));function Kv(e,t,r){for(var n=new Float32Array(e),a=0;a<n.length;a++)n[a]=t+r*a;return n}var An;(function(e){e.DefaultName="1_555",e.Default=t(e.DefaultName,de.identity()),e.RotationTranslationEpsilon=.005;function t(h,m,v){var g=v||{},y=g.assembly,b=g.ncsId,S=g.hkl,x=g.spgrOp,C=S?A.clone(S):A();x=ja(x,-1),b=b||-1;var w=r(v);if(de.isIdentity(m))return{name:h,assembly:y,matrix:m,inverse:de.identity(),isIdentity:!0,hkl:C,spgrOp:x,ncsId:b,suffix:w};if(!de.isRotationAndTranslation(m,e.RotationTranslationEpsilon))throw new Error("Symmetry operator ("+h+") must be a composition of rotation and translation.");return{name:h,assembly:y,matrix:m,inverse:de.invert(de(),m),isIdentity:!1,hkl:C,spgrOp:x,ncsId:b,suffix:w}}e.create=t;function r(h){if(!h)return"";if(h.assembly)return"_"+h.assembly.operId;if(typeof h.spgrOp<"u"&&typeof h.hkl<"u"&&h.spgrOp!==-1){var m=h.hkl,v=m[0],g=m[1],y=m[2];return"-"+(h.spgrOp+1)+"_"+(5+v)+(5+g)+(5+y)}return h.ncsId!==-1?"_"+h.ncsId:""}function n(h,m){for(var v=de.identity(),g=0;g<3;g++)for(var y=0;y<3;y++)de.setValue(v,g,y,ia.getValue(h,g,y));return de.setTranslation(v,m),de.isRotationAndTranslation(v,e.RotationTranslationEpsilon)}e.checkIfRotationAndTranslation=n;function a(h,m,v,g){for(var y=de.identity(),b=0;b<3;b++)for(var S=0;S<3;S++)de.setValue(y,b,S,ia.getValue(m,b,S));return de.setTranslation(y,v),t(h,y,{ncsId:g})}e.ofRotationAndOffset=a;var i=aa.identity(),o=aa(),s=aa(),u=A();function l(h,m,v){var g=m.inverse;if(m.isIdentity)return de.copy(h,g);var y=1-v;de.getRotation(o,g),aa.slerp(o,i,o,y);var b=aa.getAxisAngle(u,o);return de.fromRotation(h,b,u),de.setValue(h,0,3,y*de.getValue(g,0,3)),de.setValue(h,1,3,y*de.getValue(g,1,3)),de.setValue(h,2,3,y*de.getValue(g,2,3)),h}e.lerpFromIdentity=l;function c(h,m,v,g){if(Math.abs(g)<=1e-5)return de.copy(h,m);if(Math.abs(g-1)<=1e-5)return de.copy(h,v);de.getRotation(o,m),de.getRotation(s,v),aa.slerp(s,o,s,g);var y=aa.getAxisAngle(u,s);return de.fromRotation(h,y,u),de.setValue(h,0,3,fs(de.getValue(m,0,3),de.getValue(v,0,3),g)),de.setValue(h,1,3,fs(de.getValue(m,1,3),de.getValue(v,1,3),g)),de.setValue(h,2,3,fs(de.getValue(m,2,3),de.getValue(v,2,3),g)),h}e.slerp=c;function d(h,m){var v=de.mul(de(),m.matrix,h.matrix);return t(m.name,v,m)}e.compose=d;function f(h,m,v){var g=e.createCoordinateMapper(e.Default,m),y=h.isIdentity?g:e.createCoordinateMapper(h,m),b=LCe(h,m),S=b.x,x=b.y,C=b.z;return{operator:h,coordinates:m,invariantPosition:g,position:y,x:S,y:x,z:C,r:v||FCe}}e.createMapping=f;function p(h,m){return h.isIdentity?VCe(m):HCe(h,m)}e.createCoordinateMapper=p})(An||(An={}));function FCe(e){return 0}function LCe(e,t){return e.isIdentity?{x:gA(t.x),y:gA(t.y),z:gA(t.z)}:{x:NCe(e,t),y:zCe(e,t),z:UCe(e,t)}}function gA(e){return function(r){return e[r]}}function Xw(e){return e[3]===0&&e[7]===0&&e[11]===0&&e[15]===1}function NCe(e,t){var r=e.matrix,n=t.x,a=t.y,i=t.z,o=r[0],s=r[4],u=r[8],l=r[12];return Xw(r)?function(d){return o*n[d]+s*a[d]+u*i[d]+l}:function(d){var f=n[d],p=a[d],h=i[d],m=r[3]*f+r[7]*p+r[11]*h+r[15]||1;return(o*f+s*p+u*h+l)/m}}function zCe(e,t){var r=e.matrix,n=t.x,a=t.y,i=t.z,o=r[1],s=r[5],u=r[9],l=r[13];return Xw(r)?function(d){return o*n[d]+s*a[d]+u*i[d]+l}:function(d){var f=n[d],p=a[d],h=i[d],m=r[3]*f+r[7]*p+r[11]*h+r[15]||1;return(o*f+s*p+u*h+l)/m}}function UCe(e,t){var r=e.matrix,n=t.x,a=t.y,i=t.z,o=r[2],s=r[6],u=r[10],l=r[14];return Xw(r)?function(d){return o*n[d]+s*a[d]+u*i[d]+l}:function(d){var f=n[d],p=a[d],h=i[d],m=r[3]*f+r[7]*p+r[11]*h+r[15]||1;return(o*f+s*p+u*h+l)/m}}function VCe(e){var t=e.x,r=e.y,n=e.z;return function(i,o){return o[0]=t[i],o[1]=r[i],o[2]=n[i],o}}function HCe(e,t){var r=e.matrix,n=t.x,a=t.y,i=t.z;return Xw(r)?function(s,u){var l=n[s],c=a[s],d=i[s];return u[0]=r[0]*l+r[4]*c+r[8]*d+r[12],u[1]=r[1]*l+r[5]*c+r[9]*d+r[13],u[2]=r[2]*l+r[6]*c+r[10]*d+r[14],u}:function(s,u){return u[0]=n[s],u[1]=a[s],u[2]=i[s],A.transformMat4(u,u,r),u}}var yA=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[-1,0,0,0],[0,-1,0,0],[0,0,-1,0],[0,1,0,.5],[1,0,0,.5],[-1,0,0,.5],[0,0,1,.5],[0,-1,0,.5],[0,0,-1,.5],[1,0,0,.25],[0,-1,0,.25],[0,0,1,.25],[-1,0,0,.25],[0,1,0,.25],[0,-1,0,.75],[0,0,1,.75],[0,1,0,.75],[1,0,0,.75],[-1,0,0,.75],[0,0,-1,.25],[0,0,-1,.75],[1,-1,0,0],[-1,1,0,0],[0,0,1,1/3],[0,0,1,2/3],[1,0,0,2/3],[0,1,0,1/3],[0,-1,0,2/3],[1,-1,0,1/3],[-1,1,0,2/3],[-1,0,0,1/3],[1,0,0,1/3],[0,1,0,2/3],[0,-1,0,1/3],[1,-1,0,2/3],[-1,1,0,1/3],[-1,0,0,2/3],[0,0,-1,1/3],[0,0,-1,2/3],[0,0,1,5/6],[0,0,1,1/6],[0,0,-1,5/6],[0,0,-1,1/6]],jCe=[[0,1,2],[3,4,5],[3,1,5],[3,6,5],[7,6,2],[8,6,5],[0,4,2],[0,4,9],[7,10,2],[7,10,9],[0,10,2],[8,10,5],[3,1,11],[3,6,11],[0,10,9],[8,6,11],[3,4,2],[0,4,5],[3,4,9],[7,10,5],[8,4,9],[8,10,9],[8,10,2],[0,6,9],[3,10,9],[0,10,11],[7,1,9],[8,1,11],[7,4,11],[7,6,9],[7,10,11],[3,10,2],[8,1,5],[0,4,11],[3,1,2],[3,1,9],[7,4,2],[8,1,2],[8,1,9],[3,6,9],[7,4,9],[8,6,2],[8,6,9],[3,6,2],[12,13,14],[15,16,14],[12,17,18],[15,19,18],[20,13,18],[21,16,18],[20,17,14],[21,19,14],[0,1,5],[8,10,11],[7,6,11],[7,6,5],[8,4,2],[7,4,5],[7,1,5],[7,1,11],[0,10,5],[0,1,11],[0,6,11],[0,6,5],[3,10,11],[8,4,11],[15,13,22],[12,16,22],[15,17,23],[12,19,23],[21,13,23],[20,16,23],[21,17,22],[20,19,22],[4,0,2],[1,3,2],[4,0,14],[1,3,18],[4,0,9],[1,3,9],[4,0,18],[1,3,14],[10,7,9],[6,8,9],[4,7,14],[6,3,18],[10,0,18],[1,8,14],[1,3,5],[4,0,5],[6,8,11],[10,7,11],[1,3,11],[4,0,11],[10,7,2],[6,8,2],[3,10,22],[7,1,23],[8,4,23],[0,6,22],[1,0,5],[4,3,5],[1,0,23],[4,3,22],[10,7,14],[6,8,18],[8,6,22],[7,10,23],[4,3,11],[1,0,11],[1,0,22],[4,3,23],[10,7,18],[6,8,14],[8,6,23],[7,10,22],[6,7,11],[10,8,11],[8,1,23],[0,10,22],[3,6,22],[7,4,23],[4,3,2],[1,0,2],[10,8,2],[6,7,2],[4,3,9],[1,0,9],[10,8,9],[6,7,9],[4,8,14],[6,0,18],[10,3,18],[1,7,14],[4,8,18],[6,0,14],[10,3,14],[1,7,18],[6,7,5],[10,8,5],[6,8,5],[10,7,5],[8,1,22],[0,10,23],[3,6,23],[7,4,22],[4,24,2],[25,3,2],[4,24,26],[25,3,27],[4,24,27],[25,3,26],[28,29,26],[30,31,26],[32,33,26],[34,35,27],[36,37,27],[38,39,27],[2,0,1],[1,2,0],[1,25,5],[24,0,5],[39,36,40],[35,38,40],[37,34,40],[33,30,41],[29,32,41],[31,28,41],[5,3,4],[4,5,3],[25,1,5],[0,24,5],[24,4,5],[3,25,5],[4,3,41],[25,1,40],[24,4,41],[3,25,40],[4,3,40],[25,1,41],[24,4,40],[3,25,41],[35,34,40],[37,36,40],[39,38,40],[29,28,41],[31,30,41],[33,32,41],[3,5,4],[5,4,3],[25,1,2],[0,24,2],[24,4,2],[3,25,2],[25,1,9],[0,24,9],[24,4,9],[3,25,9],[30,33,26],[32,29,26],[28,31,26],[36,39,27],[38,35,27],[34,37,27],[0,2,1],[2,1,0],[30,33,42],[32,29,42],[28,31,42],[36,39,43],[38,35,43],[34,37,43],[7,9,6],[9,6,7],[25,1,11],[0,24,11],[24,4,11],[3,25,11],[35,34,44],[37,36,44],[39,38,44],[29,28,45],[31,30,45],[33,32,45],[8,11,10],[11,10,8],[1,25,2],[24,0,2],[1,25,42],[24,0,43],[1,25,43],[24,0,42],[1,25,27],[24,0,26],[1,25,26],[24,0,27],[1,25,9],[24,0,9],[4,24,5],[25,3,5],[4,24,11],[25,3,11],[1,0,40],[4,3,44],[0,24,45],[1,0,41],[4,3,45],[0,24,44],[0,24,40],[0,24,41],[2,3,4],[5,3,1],[5,0,4],[4,2,3],[1,5,3],[4,5,0],[2,7,6],[2,8,10],[5,8,6],[5,7,10],[1,9,7],[4,9,8],[1,11,8],[4,11,7],[9,0,6],[9,3,10],[11,3,6],[11,0,10],[6,2,7],[10,2,8],[6,5,8],[10,5,7],[9,7,1],[9,8,4],[11,8,1],[11,7,4],[6,9,0],[10,9,3],[6,11,3],[10,11,0],[9,7,6],[9,8,10],[11,8,6],[11,7,10],[6,9,7],[10,9,8],[6,11,8],[10,11,7],[2,3,10],[5,8,1],[11,0,4],[10,2,3],[1,5,8],[4,11,0],[5,0,1],[2,0,4],[2,3,1],[1,5,0],[4,2,0],[1,2,3],[11,8,10],[11,7,6],[9,7,10],[9,8,6],[10,11,8],[6,11,7],[10,9,7],[6,9,8],[5,8,10],[5,7,6],[2,7,10],[2,8,6],[4,11,8],[1,11,7],[4,9,7],[1,9,8],[11,3,10],[11,0,6],[9,0,10],[9,3,6],[10,5,8],[6,5,7],[10,2,7],[6,2,8],[11,8,4],[11,7,1],[9,7,4],[9,8,1],[10,11,3],[6,11,0],[10,9,0],[6,9,3],[22,15,13],[22,12,16],[14,12,13],[14,15,16],[13,22,15],[16,22,12],[13,14,12],[16,14,15],[22,21,17],[22,20,19],[14,20,17],[14,21,19],[13,23,21],[16,23,20],[13,18,20],[16,18,21],[23,15,17],[23,12,19],[18,12,17],[18,15,19],[17,22,21],[19,22,20],[17,14,20],[19,14,21],[23,21,13],[23,20,16],[18,20,13],[18,21,16],[17,23,15],[19,23,12],[17,18,12],[19,18,15],[5,0,6],[2,7,4],[9,3,1],[6,5,0],[4,2,7],[1,9,3],[0,2,4],[3,2,1],[0,5,1],[2,1,3],[2,4,0],[5,1,0],[7,9,10],[8,9,6],[7,11,6],[9,6,8],[9,10,7],[11,6,7],[1,7,11],[4,8,11],[1,8,9],[4,7,9],[0,9,10],[3,9,6],[3,11,10],[0,11,6],[2,6,8],[2,10,7],[5,6,7],[5,10,8],[6,0,11],[10,3,11],[6,3,9],[10,0,9],[7,2,10],[8,2,6],[8,5,10],[7,5,6],[9,1,8],[9,4,7],[11,1,7],[11,4,8],[7,9,4],[8,9,1],[8,11,4],[7,11,1],[9,6,3],[9,10,0],[11,6,0],[11,10,3],[19,12,23],[13,15,22],[16,21,18],[17,20,14],[20,14,17],[21,18,16],[15,22,13],[12,23,19],[18,16,21],[14,17,20],[23,19,12],[22,13,15],[19,20,22],[13,21,23],[16,15,14],[17,12,18],[20,18,13],[21,14,19],[15,23,17],[12,22,16],[18,19,15],[14,13,12],[23,16,20],[22,17,21],[16,12,22],[17,15,23],[19,21,14],[13,20,18],[12,14,13],[15,18,19],[21,22,17],[20,23,16],[14,16,15],[18,17,12],[22,19,20],[23,13,21],[16,20,23],[17,21,22],[19,15,18],[13,12,14],[12,18,17],[15,14,16],[21,23,13],[20,22,19],[14,19,21],[18,13,20],[22,16,12],[23,17,15],[19,12,22],[17,21,23],[16,15,18],[13,20,14],[20,14,13],[15,18,16],[21,23,17],[12,22,19],[18,16,15],[14,13,20],[22,19,12],[23,17,21],[3,2,4],[3,5,1],[0,5,4],[2,4,3],[5,1,3],[5,4,0],[1,7,9],[4,8,9],[1,8,11],[4,7,11],[0,9,6],[3,9,10],[3,11,6],[0,11,10],[2,6,7],[2,10,8],[5,6,8],[5,10,7],[6,0,9],[10,3,9],[6,3,11],[10,0,11],[7,2,6],[8,2,10],[8,5,6],[7,5,10],[9,1,7],[9,4,8],[11,1,8],[11,4,7],[7,9,1],[8,9,4],[8,11,1],[7,11,4],[9,6,0],[9,10,3],[11,6,3],[11,10,0],[8,9,10],[8,11,6],[7,11,10],[9,10,8],[11,6,8],[11,10,7],[6,0,2],[10,3,2],[6,3,5],[10,0,5],[7,2,1],[8,2,4],[8,5,1],[7,5,4],[9,1,0],[9,4,3],[11,1,3],[11,4,0],[1,7,2],[4,8,2],[1,8,5],[4,7,5],[0,9,1],[3,9,4],[3,11,1],[0,11,4],[2,6,0],[2,10,3],[5,6,3],[5,10,0],[0,2,6],[3,2,10],[3,5,6],[0,5,10],[2,1,7],[2,4,8],[5,1,8],[5,4,7],[16,12,14],[13,21,18],[19,15,23],[17,20,22],[12,14,16],[21,18,13],[15,23,19],[20,22,17],[14,16,12],[18,13,21],[23,19,15],[22,17,20],[19,20,18],[17,15,14],[16,21,22],[13,12,23],[20,18,19],[15,14,17],[21,22,16],[12,23,13],[18,19,20],[14,17,15],[22,16,21],[23,13,12],[6,0,5],[10,3,5],[6,3,2],[10,0,2],[7,2,4],[8,2,1],[8,5,4],[7,5,1],[9,1,3],[9,4,0],[11,1,0],[11,4,3],[1,7,5],[4,8,5],[1,8,2],[4,7,2],[0,9,4],[3,9,1],[3,11,4],[0,11,1],[2,6,3],[2,10,0],[5,6,0],[5,10,3],[0,2,10],[3,2,6],[3,5,10],[0,5,6],[2,1,8],[2,4,7],[5,1,7],[5,4,8],[21,17,23],[20,16,22],[12,13,18],[15,19,14],[23,21,17],[22,20,16],[18,12,13],[14,15,19],[17,23,21],[16,22,20],[13,18,12],[19,14,15],[21,13,22],[20,19,23],[12,17,14],[15,16,18],[23,15,13],[22,12,19],[18,20,17],[14,21,16],[17,22,15],[16,23,12],[13,14,20],[19,18,21],[15,17,22],[12,16,23],[20,13,14],[21,19,18],[22,21,13],[23,20,19],[14,12,17],[18,15,16],[13,23,15],[19,22,12],[17,18,20],[16,14,21],[15,13,23],[12,19,22],[20,17,18],[21,16,14],[22,15,17],[23,12,16],[14,20,13],[18,21,19],[13,22,21],[19,23,20],[17,14,12],[16,18,15],[6,5,3],[4,9,3],[9,3,4],[5,7,4],[4,5,7],[5,3,6]],GCe=[[0],[0,1],[0,2],[0,3],[0,2,4,5],[0,6],[0,7],[0,6,4,8],[0,7,4,9],[0,6,2,1],[0,3,1,10],[0,6,2,1,4,8,5,11],[0,12,1,7],[0,1,13,14],[0,12,1,7,4,15,11,9],[0,16,2,17],[0,18,12,17],[0,16,5,19],[0,20,13,19],[0,18,12,17,4,21,15,19],[0,16,2,17,4,22,5,19],[0,16,2,17,23,24,13,25,26,20,27,28,4,22,5,19],[0,16,17,2,29,21,30,15],[0,20,13,19,29,31,32,33],[0,16,6,34],[0,18,7,34],[0,16,7,35],[0,16,36,37],[0,18,36,38],[0,16,14,39],[0,20,40,34],[0,16,8,41],[0,18,8,42],[0,16,9,42],[0,16,6,34,4,22,8,41],[0,18,7,34,4,21,9,41],[0,16,7,35,4,22,9,42],[0,16,6,34,23,24,14,39],[0,16,10,43,23,24,7,35],[0,16,36,37,23,24,9,42],[0,16,8,41,23,24,40,38],[0,16,6,34,23,24,14,39,26,20,40,38,4,22,8,41],[0,16,44,45,23,24,46,47,26,20,48,49,4,22,50,51],[0,16,6,34,29,21,9,42],[0,16,8,41,29,21,7,35],[0,16,36,37,29,21,14,39],[0,16,2,17,1,52,6,34],[0,16,2,17,53,54,9,42],[0,16,12,33,1,52,7,35],[0,16,2,17,11,55,8,41],[0,56,2,57,1,58,6,37],[0,56,15,25,1,58,9,39],[0,20,27,17,1,59,40,34],[0,56,12,28,1,58,7,38],[0,16,5,19,1,52,8,41],[0,22,13,28,1,55,14,38],[0,18,13,60,1,61,14,43],[0,16,15,30,1,52,9,42],[0,16,5,19,11,55,6,34],[0,21,12,19,1,54,7,41],[0,20,13,19,1,59,14,41],[0,20,3,30,1,59,10,42],[0,18,12,17,1,61,7,34,4,21,15,19,11,54,9,41],[0,24,13,17,1,62,14,34,4,20,27,19,11,59,40,41],[0,16,2,17,1,52,6,34,4,22,5,19,11,55,8,41],[0,16,12,33,1,52,7,35,4,22,15,30,11,55,9,42],[0,31,3,17,1,63,10,34,4,56,32,19,11,58,36,41],[0,22,2,19,64,59,14,38,4,16,5,17,65,62,40,39],[0,16,2,17,1,52,6,34,23,24,13,25,64,62,14,39,26,20,27,28,65,59,40,38,4,22,5,19,11,55,8,41],[0,16,2,17,66,67,44,45,23,24,13,25,68,69,46,47,26,20,27,28,70,71,48,49,4,22,5,19,72,73,50,51],[0,16,2,17,1,52,6,34,29,21,15,30,53,54,9,42],[0,16,5,19,1,52,8,41,29,21,12,33,53,54,7,35],[0,20,13,19,1,59,14,41,29,31,32,33,53,63,36,35],[0,31,3,17,1,63,10,34,29,20,27,30,53,59,40,42],[0,16,74,75],[0,18,76,77],[0,16,78,79],[0,18,80,81],[0,16,74,75,29,21,82,83],[0,21,84,85,29,16,86,87],[0,16,88,89],[0,16,88,89,29,21,90,91],[0,16,74,75,1,52,88,89],[0,16,78,79,1,52,92,93],[0,16,94,95,11,55,88,89],[0,16,82,83,53,54,88,89],[0,16,74,75,1,52,88,89,29,21,82,83,53,54,90,91],[0,21,84,85,96,97,88,91,29,16,86,87,98,99,90,89],[0,16,74,75,2,17,100,101],[0,16,94,95,5,19,100,101],[0,18,76,77,2,33,102,103],[0,18,104,105,106,107,100,108],[0,16,78,79,2,17,109,108],[0,16,82,83,15,30,100,101],[0,18,80,81,2,33,110,111],[0,18,112,113,114,115,100,108],[0,16,74,75,2,17,100,101,29,21,82,83,15,30,116,117],[0,21,84,85,118,119,116,101,29,16,86,87,120,121,100,117],[0,16,74,75,6,34,122,123],[0,16,74,75,8,41,124,125],[0,16,78,79,7,35,122,123],[0,16,82,83,9,42,122,123],[0,16,74,75,7,35,126,127],[0,16,74,75,9,42,128,129],[0,16,78,79,6,34,126,127],[0,16,78,79,8,41,128,129],[0,16,74,75,6,34,122,123,29,21,82,83,9,42,128,129],[0,16,74,75,7,35,126,127,29,21,82,83,8,41,124,125],[0,21,84,85,6,42,130,131,29,16,86,87,9,34,132,133],[0,21,84,85,7,41,134,135,29,16,86,87,8,35,136,137],[0,16,89,88,2,17,122,123],[0,16,89,88,12,33,126,127],[0,16,89,88,5,19,124,125],[0,16,89,88,15,30,128,129],[0,16,88,89,6,34,100,101],[0,16,89,88,7,35,109,108],[0,16,89,88,8,41,138,139],[0,16,89,88,9,42,116,117],[0,16,89,88,6,34,100,101,29,21,91,90,9,42,116,117],[0,16,89,88,7,35,109,108,29,21,91,90,8,41,138,139],[0,16,89,88,2,17,122,123,29,21,91,90,15,30,128,129],[0,16,89,88,118,121,132,131,29,21,91,90,120,119,130,133],[0,16,74,75,2,17,100,101,1,52,88,89,6,34,122,123],[0,16,74,75,12,33,109,108,1,52,88,89,7,35,126,127],[0,16,74,75,2,17,100,101,11,55,140,141,8,41,124,125],[0,16,74,75,2,17,100,101,53,54,90,91,9,42,128,129],[0,16,74,75,5,19,138,139,1,52,88,89,8,41,124,125],[0,16,74,75,15,30,116,117,1,52,88,89,9,42,128,129],[0,16,94,95,5,19,100,101,11,55,88,89,6,34,124,125],[0,16,94,95,15,30,109,108,11,55,88,89,7,35,128,129],[0,16,78,79,2,17,109,108,1,52,92,93,6,34,126,127],[0,16,78,79,12,33,100,101,1,52,92,93,7,35,122,123],[0,16,82,83,12,33,138,139,53,54,88,89,8,41,126,127],[0,16,82,83,2,17,116,117,53,54,88,89,9,42,122,123],[0,16,78,79,5,19,116,117,1,52,92,93,8,41,128,129],[0,16,82,83,15,30,100,101,1,52,90,91,9,42,122,123],[0,16,82,83,15,30,100,101,53,54,88,89,6,34,128,129],[0,16,82,83,5,19,109,108,53,54,88,89,7,35,124,125],[0,16,74,75,2,17,100,101,1,52,88,89,6,34,122,123,29,21,82,83,15,30,116,117,53,54,90,91,9,42,128,129],[0,16,74,75,12,33,109,108,1,52,88,89,7,35,126,127,29,21,82,83,5,19,138,139,53,54,90,91,8,41,124,125],[0,21,84,85,118,119,116,101,96,97,88,91,9,34,132,133,29,16,86,87,120,121,100,117,98,99,90,89,6,42,130,131],[0,21,84,85,142,143,138,108,96,97,88,91,8,35,136,137,29,16,86,87,144,145,109,139,98,99,90,89,7,41,134,135],[0,146,147],[0,148,149],[0,150,151],[0,146,147,152,153,154,155,156,157],[0,158,159],[0,146,147,1,160,161],[0,146,147,1,160,161,152,153,154,162,163,164,155,156,157,165,166,167],[0,158,159,1,168,169],[0,146,147,101,170,171],[0,146,147,100,172,173],[0,148,149,174,175,171],[0,148,149,100,176,177],[0,150,151,178,179,171],[0,150,151,100,180,181],[0,146,147,100,172,173,152,153,154,182,183,184,155,156,157,185,186,187],[0,158,159,101,188,189],[0,146,147,122,190,191],[0,146,147,123,192,193],[0,146,147,126,194,195],[0,146,147,127,196,197],[0,146,147,122,190,191,152,153,154,198,199,200,155,156,157,201,202,203],[0,158,159,123,204,205],[0,146,147,126,194,195,152,153,154,206,207,208,155,156,157,209,210,211],[0,158,159,129,212,213],[0,146,147,101,170,171,1,160,161,123,192,193],[0,146,147,108,214,215,1,160,161,127,196,197],[0,146,147,100,172,173,1,160,161,122,190,191],[0,146,147,109,216,217,1,160,161,126,194,195],[0,146,147,100,172,173,1,160,161,122,190,191,152,153,154,182,183,184,162,163,164,198,199,200,155,156,157,185,186,187,165,166,167,201,202,203],[0,158,159,101,188,189,1,168,169,123,204,205],[0,146,147,109,216,217,1,160,161,126,194,195,152,153,154,218,219,220,162,163,164,206,207,208,155,156,157,221,222,223,165,166,167,209,210,211],[0,158,159,117,224,225,1,168,169,129,212,213],[0,146,147,16,226,227],[0,148,149,18,228,229],[0,150,151,18,230,231],[0,150,151,16,232,233],[0,148,149,16,234,235],[0,146,147,18,236,237],[0,146,147,52,238,239],[0,146,147,16,226,227,1,160,161,52,238,239],[0,146,147,18,236,237,1,160,161,61,240,241],[0,146,147,16,226,227,100,172,173,101,170,171],[0,148,149,18,228,229,242,172,181,243,214,244],[0,150,151,18,230,231,245,172,177,246,214,247],[0,150,151,16,232,233,245,172,177,174,170,248],[0,148,149,16,234,235,242,172,181,178,170,249],[0,146,147,18,236,237,100,172,173,108,214,215],[0,146,147,16,226,227,122,190,191,123,192,193],[0,146,147,16,226,227,126,194,195,127,196,197],[0,146,147,18,236,237,126,194,195,123,192,193],[0,146,147,18,236,237,122,190,191,127,196,197],[0,146,147,52,238,239,122,190,191,101,170,171],[0,146,147,61,240,241,126,194,195,101,170,171],[0,146,147,52,238,239,100,172,173,123,192,193],[0,146,147,61,240,241,100,172,173,127,196,197],[0,146,147,16,226,227,100,172,173,101,170,171,1,160,161,52,239,238,122,190,191,123,192,193],[0,146,147,16,226,227,109,216,217,108,214,215,1,160,161,52,239,238,126,194,195,127,196,197],[0,146,147,18,236,237,109,216,217,101,170,171,1,160,161,61,241,240,126,194,195,123,192,193],[0,146,147,18,236,237,100,172,173,108,214,215,1,160,161,61,241,240,122,190,191,127,196,197],[0,16,2,17,158,250,251,252,159,253,254,255],[0,16,2,17,158,250,251,252,159,253,254,255,23,24,13,25,256,257,258,259,260,261,262,263,26,20,27,28,264,265,266,267,268,269,270,271,4,22,5,19,272,273,274,275,276,277,278,279],[0,16,2,17,158,250,251,252,159,253,254,255,29,21,15,30,280,281,282,283,284,285,286,287],[0,20,13,19,158,273,266,259,159,261,278,271],[0,20,13,19,158,273,266,259,159,261,278,271,29,31,32,33,280,288,289,290,284,291,292,293],[0,16,2,17,158,250,251,252,159,253,254,255,1,52,6,34,168,294,295,296,169,297,298,299],[0,16,2,17,158,250,251,252,159,253,254,255,53,54,9,42,300,301,302,303,304,305,306,307],[0,16,2,17,158,250,251,252,159,253,254,255,1,52,6,34,168,294,295,296,169,297,298,299,23,24,13,25,256,257,258,259,260,261,262,263,64,62,14,39,308,309,310,311,312,313,314,315,26,20,27,28,264,265,266,267,268,269,270,271,65,59,40,38,316,317,318,319,320,321,322,323,4,22,5,19,272,273,274,275,276,277,278,279,11,55,8,41,324,325,326,327,328,329,330,331],[0,16,2,17,158,250,251,252,159,253,254,255,66,67,44,45,332,333,334,335,336,337,338,339,23,24,13,25,256,257,258,259,260,261,262,263,68,69,46,47,340,341,342,343,344,345,346,347,26,20,27,28,264,265,266,267,268,269,270,271,70,71,48,49,348,349,350,351,352,353,354,355,4,22,5,19,272,273,274,275,276,277,278,279,72,73,50,51,356,357,358,359,360,361,362,363],[0,16,2,17,158,250,251,252,159,253,254,255,1,52,6,34,168,294,295,296,169,297,298,299,29,21,15,30,280,281,282,283,284,285,286,287,53,54,9,42,300,301,302,303,304,305,306,307],[0,20,13,19,158,273,266,259,159,261,278,271,1,59,14,41,168,325,318,311,169,313,330,323],[0,20,13,19,158,273,266,259,159,261,278,271,1,59,14,41,168,325,318,311,169,313,330,323,29,31,32,33,280,288,289,290,284,291,292,293,53,63,36,35,300,364,365,366,304,367,368,369],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,23,24,13,25,256,257,258,259,260,261,262,263,382,383,384,385,386,387,388,389,390,391,392,393,26,20,27,28,264,265,266,267,268,269,270,271,394,395,396,397,398,399,400,401,402,403,404,405,4,22,5,19,272,273,274,275,276,277,278,279,138,139,95,94,406,407,408,409,410,411,412,413],[0,24,5,28,158,265,258,275,159,277,270,263,414,415,416,417,418,419,420,421,422,423,424,425,23,16,27,19,256,273,251,267,260,269,278,255,426,427,428,429,430,431,432,433,434,435,436,437,26,22,13,17,264,250,274,259,268,261,254,279,438,439,440,441,442,443,444,445,446,447,448,449,4,20,2,25,272,257,266,252,276,253,262,271,450,451,452,453,454,455,456,457,458,459,460,461],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,29,21,15,30,280,281,282,283,284,285,286,287,116,117,83,82,376,377,224,378,379,380,381,225],[0,20,13,19,158,273,266,259,159,261,278,271,450,415,440,429,454,431,420,445,458,447,436,425],[0,20,13,19,158,273,266,259,159,261,278,271,462,463,464,465,466,467,468,469,470,471,472,473],[0,20,13,19,158,273,266,259,159,261,278,271,462,463,464,465,466,467,468,469,470,471,472,473,29,31,32,33,280,288,289,290,284,291,292,293,450,415,440,429,454,431,420,445,458,447,436,425],[0,16,2,17,158,250,251,252,159,253,254,255,123,122,88,89,204,474,475,476,205,477,478,479],[0,16,2,17,158,250,251,252,159,253,254,255,123,122,88,89,204,474,475,476,205,477,478,479,23,24,13,25,256,257,258,259,260,261,262,263,480,481,482,483,484,485,486,487,488,489,490,491,26,20,27,28,264,265,266,267,268,269,270,271,492,493,494,495,496,497,498,499,500,501,502,503,4,22,5,19,272,273,274,275,276,277,278,279,125,124,140,141,504,505,506,507,508,509,510,511],[0,16,2,17,158,250,251,252,159,253,254,255,123,122,88,89,204,474,475,476,205,477,478,479,29,21,15,30,280,281,282,283,284,285,286,287,129,128,90,91,212,512,513,514,213,515,516,517],[0,16,2,17,158,250,251,252,159,253,254,255,129,128,90,91,212,512,513,514,213,515,516,517],[0,16,2,17,158,250,251,252,159,253,254,255,129,128,90,91,212,512,513,514,213,515,516,517,23,24,13,25,256,257,258,259,260,261,262,263,518,519,520,521,522,523,524,525,526,527,528,529,26,20,27,28,264,265,266,267,268,269,270,271,530,531,532,533,534,535,536,537,538,539,540,541,4,22,5,19,272,273,274,275,276,277,278,279,127,126,92,93,542,543,544,545,546,547,548,549],[0,20,13,19,158,273,266,259,159,261,278,271,550,551,552,553,554,555,556,557,558,559,560,561,29,31,32,33,280,288,289,290,284,291,292,293,562,563,564,565,566,567,568,569,570,571,572,573],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,1,52,6,34,168,294,295,296,169,297,298,299,122,123,89,88,475,476,204,474,479,478,477,205],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,53,54,9,42,300,301,302,303,304,305,306,307,128,129,91,90,513,514,212,512,517,516,515,213],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225,1,52,6,34,168,294,295,296,169,297,298,299,128,129,91,90,513,514,212,512,517,516,515,213],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225,53,54,9,42,300,301,302,303,304,305,306,307,122,123,89,88,475,476,204,474,479,478,477,205],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,1,52,6,34,168,294,295,296,169,297,298,299,122,123,89,88,475,476,204,474,479,478,477,205,23,24,13,25,256,257,258,259,260,261,262,263,382,383,384,385,386,387,388,389,390,391,392,393,64,62,14,39,308,309,310,311,312,313,314,315,481,480,483,482,486,487,484,485,491,490,489,488,26,20,27,28,264,265,266,267,268,269,270,271,394,395,396,397,398,399,400,401,402,403,404,405,65,59,40,38,316,317,318,319,320,321,322,323,493,492,495,494,498,499,496,497,503,502,501,500,4,22,5,19,272,273,274,275,276,277,278,279,138,139,95,94,406,407,408,409,410,411,412,413,11,55,8,41,324,325,326,327,328,329,330,331,124,125,141,140,506,507,504,505,511,510,509,508],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225,1,52,6,34,168,294,295,296,169,297,298,299,128,129,91,90,513,514,212,512,517,516,515,213,23,24,13,25,256,257,258,259,260,261,262,263,574,575,576,577,578,579,580,581,582,583,584,585,64,62,14,39,308,309,310,311,312,313,314,315,519,518,521,520,524,525,522,523,529,528,527,526,26,20,27,28,264,265,266,267,268,269,270,271,586,587,588,589,590,591,592,593,594,595,596,597,65,59,40,38,316,317,318,319,320,321,322,323,531,530,533,532,536,537,534,535,541,540,539,538,4,22,5,19,272,273,274,275,276,277,278,279,109,108,79,78,598,599,600,601,602,603,604,605,11,55,8,41,324,325,326,327,328,329,330,331,126,127,93,92,544,545,542,543,549,548,547,546],[0,24,5,28,158,265,258,275,159,277,270,263,414,415,416,417,418,419,420,421,422,423,424,425,66,69,50,49,332,349,342,359,336,361,354,347,493,123,483,140,498,507,204,485,503,490,509,205,23,16,27,19,256,273,251,267,260,269,278,255,426,427,428,429,430,431,432,433,434,435,436,437,68,67,48,51,340,357,334,351,344,353,362,339,124,480,89,494,506,499,484,474,511,478,501,488,26,22,13,17,264,250,274,259,268,261,254,279,438,439,440,441,442,443,444,445,446,447,448,449,70,73,46,45,348,333,358,343,352,345,338,363,122,492,141,482,475,487,496,505,479,510,489,500,4,20,2,25,272,257,266,252,276,253,262,271,450,451,452,453,454,455,456,457,458,459,460,461,72,71,44,47,356,341,350,335,360,337,346,355,481,125,495,88,486,476,504,497,491,502,477,508],[0,24,5,28,158,265,258,275,159,277,270,263,414,415,416,417,418,419,420,421,422,423,424,425,606,607,608,609,610,611,612,613,614,615,616,617,531,129,521,92,536,545,212,523,541,528,547,213,23,16,27,19,256,273,251,267,260,269,278,255,426,427,428,429,430,431,432,433,434,435,436,437,618,619,620,621,622,623,624,625,626,627,628,629,126,518,91,532,544,537,522,512,549,516,539,526,26,22,13,17,264,250,274,259,268,261,254,279,438,439,440,441,442,443,444,445,446,447,448,449,630,631,632,633,634,635,636,637,638,639,640,641,128,530,93,520,513,525,534,543,517,548,527,538,4,20,2,25,272,257,266,252,276,253,262,271,450,451,452,453,454,455,456,457,458,459,460,461,642,643,644,645,646,647,648,649,650,651,652,653,519,127,533,90,524,514,542,535,529,540,515,546],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,1,52,6,34,168,294,295,296,169,297,298,299,122,123,89,88,475,476,204,474,479,478,477,205,29,21,15,30,280,281,282,283,284,285,286,287,116,117,83,82,376,377,224,378,379,380,381,225,53,54,9,42,300,301,302,303,304,305,306,307,128,129,91,90,513,514,212,512,517,516,515,213],[0,20,13,19,158,273,266,259,159,261,278,271,462,463,464,465,466,467,468,469,470,471,472,473,1,59,14,41,168,325,318,311,169,313,330,323,551,550,553,552,556,557,554,555,561,560,559,558,29,31,32,33,280,288,289,290,284,291,292,293,450,415,440,429,454,431,420,445,458,447,436,425,53,63,36,35,300,364,365,366,304,367,368,369,563,562,565,564,568,569,566,567,573,572,571,570],[0,16],[0,18],[0,16,26,20],[0,2,23,13],[0,3,4,32],[0,2,29,15],[0,3,29,27],[0,52],[0,63],[0,52,26,59],[0,63,26,54],[0,52,16,1],[0,18,1,61],[0,52,16,1,26,59,20,65],[0,31,1,63],[0,1,24,62],[0,15,1,9],[0,5,1,8],[0,31,1,63,26,21,65,54],[0,2,57,56],[0,60,3,16],[0,22,57,3],[0,2,28,20],[0,17,13,24],[0,20,19,13,4,24,17,27],[0,22,57,3,4,16,60,32],[0,22,57,3,23,20,30,12,26,24,33,15,4,16,60,32],[0,22,57,3,29,18,27,25],[0,22,3,57,1,55,10,37],[0,22,385,396,3,57,109,117],[0,22,57,3,159,279,654,655,158,274,656,657,29,18,25,27,284,658,262,269,280,659,257,267]],k1={"P 1":0,"P -1":1,"P 1 2 1":2,"P 1 21 1":3,"C 1 2 1":4,"P 1 m 1":5,"P 1 c 1":6,"C 1 m 1":7,"C 1 c 1":8,"P 1 2/m 1":9,"P 1 21/m 1":10,"C 1 2/m 1":11,"P 1 2/c 1":12,"P 1 21/c 1":13,"C 1 2/c 1":14,"P 2 2 2":15,"P 2 2 21":16,"P 21 21 2":17,"P 21 21 21":18,"C 2 2 21":19,"C 2 2 2":20,"F 2 2 2":21,"I 2 2 2":22,"I 21 21 21":23,"P m m 2":24,"P m c 21":25,"P c c 2":26,"P m a 2":27,"P c a 21":28,"P n c 2":29,"P m n 21":30,"P b a 2":31,"P n a 21":32,"P n n 2":33,"C m m 2":34,"C m c 21":35,"C c c 2":36,"A m m 2":37,"A b m 2":38,"A m a 2":39,"A b a 2":40,"F m m 2":41,"F d d 2":42,"I m m 2":43,"I b a 2":44,"I m a 2":45,"P 2/m 2/m 2/m":46,"P m m m":46,"P 2/n 2/n 2/n":47,"P n n n":47,"P 2/c 2/c 2/m":48,"P c c m":48,"P 2/b 2/a 2/n":49,"P b a n":49,"P 21/m 2/m 2/a":50,"P m m a":50,"P 2/n 21/n 2/a":51,"P n n a":51,"P 2/m 2/n 21/a":52,"P m n a":52,"P 21/c 2/c 2/a":53,"P c c a":53,"P 21/b 21/a 2/m":54,"P b a m":54,"P 21/c 21/c 2/n":55,"P c c n":55,"P 2/b 21/c 21/m":56,"P b c m":56,"P 21/n 21/n 2/m":57,"P n n m":57,"P 21/m 21/m 2/n":58,"P m m n":58,"P 21/b 2/c 21/n":59,"P b c n":59,"P 21/b 21/c 21/a":60,"P b c a":60,"P 21/n 21/m 21/a":61,"P n m a":61,"C 2/m 2/c 21/m":62,"C m c m":62,"C 2/m 2/c 21/a":63,"C m c a":63,"C 2/m 2/m 2/m":64,"C m m m":64,"C 2/c 2/c 2/m":65,"C c c m":65,"C 2/m 2/m 2/a":66,"C m m a":66,"C 2/c 2/c 2/a":67,"C c c a":67,"F 2/m 2/m 2/m":68,"F m m m":68,"F 2/d 2/d 2/d":69,"F d d d":69,"I 2/m 2/m 2/m":70,"I m m m":70,"I 2/b 2/a 2/m":71,"I b a m":71,"I 21/b 21/c 21/a":72,"I b c a":72,"I 21/m 21/m 21/a":73,"I m m a":73,"P 4":74,"P 41":75,"P 42":76,"P 43":77,"I 4":78,"I 41":79,"P -4":80,"I -4":81,"P 4/m":82,"P 42/m":83,"P 4/n":84,"P 42/n":85,"I 4/m":86,"I 41/a":87,"P 4 2 2":88,"P 4 21 2":89,"P 41 2 2":90,"P 41 21 2":91,"P 42 2 2":92,"P 42 21 2":93,"P 43 2 2":94,"P 43 21 2":95,"I 4 2 2":96,"I 41 2 2":97,"P 4 m m":98,"P 4 b m":99,"P 42 c m":100,"P 42 n m":101,"P 4 c c":102,"P 4 n c":103,"P 42 m c":104,"P 42 b c":105,"I 4 m m":106,"I 4 c m":107,"I 41 m d":108,"I 41 c d":109,"P -4 2 m":110,"P -4 2 c":111,"P -4 21 m":112,"P -4 21 c":113,"P -4 m 2":114,"P -4 c 2":115,"P -4 b 2":116,"P -4 n 2":117,"I -4 m 2":118,"I -4 c 2":119,"I -4 2 m":120,"I -4 2 d":121,"P 4/m 2/m 2/m":122,"P4/m m m":122,"P 4/m 2/c 2/c":123,"P4/m c c":123,"P 4/n 2/b 2/m":124,"P4/n b m":124,"P 4/n 2/n 2/c":125,"P4/n n c":125,"P 4/m 21/b 2/m":126,"P4/m b m":126,"P 4/m 21/n 2/c":127,"P4/m n c":127,"P 4/n 21/m 2/m":128,"P4/n m m":128,"P 4/n 2/c 2/c":129,"P4/n c c":129,"P 42/m 2/m 2/c":130,"P42/m m c":130,"P 42/m 2/c 2/m":131,"P42/m c m":131,"P 42/n 2/b 2/c":132,"P42/n b c":132,"P 42/n 2/n 2/m":133,"P42/n n m":133,"P 42/m 21/b 2/c":134,"P42/m b c":134,"P 42/m 21/n 2/m":135,"P42/m n m":135,"P 42/n 21/m 2/c":136,"P42/n m c":136,"P 42/n 21/c 2/m":137,"P42/n c m":137,"I 4/m 2/m 2/m":138,"I4/m m m":138,"I 4/m 2/c 2/m":139,"I4/m c m":139,"I 41/a 2/m 2/d":140,"I41/a m d":140,"I 41/a 2/c 2/d":141,"I41/a c d":141,"P 3":142,"P 31":143,"P 32":144,"H 3":145,"R 3":146,"P -3":147,"H -3":148,"R -3":149,"P 3 1 2":150,"P 3 2 1":151,"P 31 1 2":152,"P 31 2 1":153,"P 32 1 2":154,"P 32 2 1":155,"H 3 2":156,"R 3 2":157,"P 3 m 1":158,"P 3 1 m":159,"P 3 c 1":160,"P 3 1 c":161,"H 3 m":162,"R 3 m":163,"H 3 c":164,"R 3 c":165,"P -3 1 2/m":166,"P -3 1 m":166,"P -3 1 2/c":167,"P -3 1 c":167,"P -3 2/m 1":168,"P -3 m 1":168,"P -3 2/c 1":169,"P -3 c 1":169,"H -3 2/m":170,"H -3 m":170,"R -3 2/m":171,"R -3 m":171,"H -3 2/c":172,"H -3 c":172,"R -3 2/c":173,"R -3 c":173,"P 6":174,"P 61":175,"P 65":176,"P 62":177,"P 64":178,"P 63":179,"P -6":180,"P 6/m":181,"P 63/m":182,"P 6 2 2":183,"P 61 2 2":184,"P 65 2 2":185,"P 62 2 2":186,"P 64 2 2":187,"P 63 2 2":188,"P 6 m m":189,"P 6 c c":190,"P 63 c m":191,"P 63 m c":192,"P -6 m 2":193,"P -6 c 2":194,"P -6 2 m":195,"P -6 2 c":196,"P 6/m 2/m 2/m":197,"P 6/m m m":197,"P 6/m 2/c 2/c":198,"P 6/m c c":198,"P 63/m 2/c 2/m":199,"P 63/m c m":199,"P 63/m 2/m 2/c":200,"P 63/m m c":200,"P 2 3":201,"F 2 3":202,"I 2 3":203,"P 21 3":204,"I 21 3":205,"P 2/m -3":206,"P m -3":206,"P 2/n -3":207,"P n -3":207,"F 2/m -3":208,"F m -3":208,"F 2/d -3":209,"F d -3":209,"I 2/m -3":210,"I m -3":210,"P 21/a -3":211,"P a -3":211,"I 21/a -3":212,"I a -3":212,"P 4 3 2":213,"P 42 3 2":214,"F 4 3 2":215,"F 41 3 2":216,"I 4 3 2":217,"P 43 3 2":218,"P 41 3 2":219,"I 41 3 2":220,"P -4 3 m":221,"F -4 3 m":222,"I -4 3 m":223,"P -4 3 n":224,"F -4 3 c":225,"I -4 3 d":226,"P 4/m -3 2/m":227,"P m -3 m":227,"P 4/n -3 2/n":228,"P n -3 n":228,"P 42/m -3 2/n":229,"P m -3 n":229,"P 42/n -3 2/m":230,"P n -3 m":230,"F 4/m -3 2/m":231,"F m -3 m":231,"F 4/m -3 2/c":232,"F m -3 c":232,"F 41/d -3 2/m":233,"F d -3 m":233,"F 41/d -3 2/c":234,"F d -3 c":234,"I 4/m -3 2/m":235,"I m -3 m":235,"I 41/a -3 2/d":236,"I a -3 d":236,"P 1 1 2":237,"P 1 1 21":238,"B 1 1 2":239,"B 2":239,"A 1 2 1":240,"C 1 21 1":241,"I 1 2 1":242,"I 2":242,"I 1 21 1":243,"P 1 1 m":244,"P 1 1 b":245,"B 1 1 m":246,"B 1 1 b":247,"P 1 1 2/m":248,"P 1 1 21/m":249,"B 1 1 2/m":250,"P 1 1 2/b":251,"P 1 1 21/b":252,"P 1 21/n 1":253,"P 1 21/a 1":254,"B 1 1 2/b":255,"P 21 2 2":256,"P 2 21 2":257,"P 21 21 2 (a)":258,"P 21 2 21":259,"P 2 21 21":260,"C 2 2 21a)":261,"C 2 2 2a":262,"F 2 2 2a":263,"I 2 2 2a":264,"P 21/m 21/m 2/n a":265,"P 42 21 2a":266,"I 2 3a":267};function qCe(e){switch(e){case 1146:return 146;case 1148:return 149;case 1155:return 157;case 1160:return 163;case 1161:return 165;case 1166:return 171;case 1167:return 173;case 1003:return 237;case 1004:return 238;case 1005:return 239;case 2005:return 240;case 3005:return 241;case 4005:return 242;case 5005:return 243;case 1006:return 244;case 1007:return 245;case 1008:return 246;case 1009:return 247;case 1010:return 248;case 1011:return 249;case 1012:return 250;case 1013:return 251;case 1014:return 252;case 2014:return 253;case 3014:return 254;case 1015:return 255;case 1017:return 256;case 2017:return 257;case 1018:return 258;case 2018:return 259;case 3018:return 260;case 1020:return 261;case 1021:return 262;case 1022:return 263;case 1023:return 264;case 1059:return 265;case 1094:return 266;case 1197:return 267}var t=0;return e>146&&++t,e>148&&++t,e>155&&++t,e>160&&++t,e>161&&++t,e>166&&++t,e>167&&++t,e-1+t}function WCe(e){if(e<146)return e+1;if(e===146)return 1146;if(e<149)return e+1-1;if(e===149)return 1148;if(e<157)return e+1-2;if(e===157)return 1155;if(e<163)return e+1-3;if(e===163)return 1160;if(e<165)return e+1-4;if(e===165)return 1161;if(e<171)return e+1-5;if(e===171)return 1166;if(e<173)return e+1-6;if(e===173)return 1167;if(e<237)return e+1-7;if(e===237)return 1003;if(e===238)return 1004;if(e===239)return 1005;if(e===240)return 2005;if(e===241)return 3005;if(e===242)return 4005;if(e===243)return 5005;if(e===244)return 1006;if(e===245)return 1007;if(e===246)return 1008;if(e===247)return 1009;if(e===248)return 1010;if(e===249)return 1011;if(e===250)return 1012;if(e===251)return 1013;if(e===252)return 1014;if(e===253)return 2014;if(e===254)return 3014;if(e===255)return 1015;if(e===256)return 1017;if(e===257)return 2017;if(e===258)return 1018;if(e===259)return 2018;if(e===260)return 3018;if(e===261)return 1020;if(e===262)return 1021;if(e===263)return 1022;if(e===264)return 1023;if(e===265)return 1059;if(e===266)return 1094;if(e===267)return 1197;throw new Error("unknown spacegroup index '"+e+"'")}var PW=function(){for(var e=Object.create(null),t=0,r=Object.keys(k1);t<r.length;t++){var n=r[t];e[k1[n]]=n}return e}(),XCe=function(){for(var e=Object.create(null),t=0,r=Object.keys(k1);t<r.length;t++){var n=r[t],a=k1[n];e[a]=WCe(a)}return e}();function YCe(e){var t=typeof e=="number"?qCe(e):k1[e];return typeof t>"u"||typeof PW[t]>"u"?-1:t}var Go;(function(e){e.Zero=r("P 1",A.create(1,1,1),A.create(Math.PI/2,Math.PI/2,Math.PI/2));function t(n){return n?n.index===0&&n.size[0]===1&&n.size[1]===1&&n.size[1]===1:!0}e.isZero=t;function r(n,a,i){var o=YCe(n);if(o<0)return console.warn("Unknown spacegroup '"+n+"', returning a 'P 1' with cellsize [1, 1, 1]"),e.Zero;var s=a[0]*a[1]*a[2],u=i[0],l=i[1],c=i[2],d=a[0],f=a[1],p=a[2],h=Math.cos(l),m=(Math.cos(u)-Math.cos(l)*Math.cos(c))/Math.sin(c),v=Math.sqrt(1-h*h-m*m),g=[d,0,0],y=[Math.cos(c)*f,Math.sin(c)*f,0],b=[h*p,m*p,v*p],S=de.ofRows([[g[0],y[0],b[0],0],[0,y[1],b[1],0],[0,0,b[2],0],[0,0,0,1]]),x=de.invert(de.zero(),S);return{index:o,size:a,volume:s,anglesInRadians:i,toFractional:x,fromFractional:S}}e.create=r})(Go||(Go={}));var al;(function(e){e.ZeroP1=t(Go.Zero);function t(v){var g=GCe[v.index].map(function(S){return d(jCe[S])}),y=PW[v.index],b=XCe[v.index];return{name:y,num:b,cell:v,operators:g}}e.create=t;var r=A(),n=de();function a(v,g,y,b,S,x){return A.set(r,y,b,S),de.fromTranslation(n,r),de.mul(x,de.mul(x,de.mul(x,v.cell.fromFractional,n),v.operators[g]),v.cell.toFractional)}e.setOperatorMatrix=a;function i(v,g,y,b,S){var x=a(v,g,y,b,S,de.zero());return An.create(g+1+"_"+(5+y)+(5+b)+(5+S),x,{hkl:A.create(y,b,S),spgrOp:g})}e.getSymmetryOperator=i;var o=A(),s=A(),u=A(),l=A();function c(v,g,y,b,S,x){var C=de.zero();A.set(r,y,b,S),A.floor(o,x),de.copy(C,v.operators[g]),A.floor(s,A.transformMat4(s,x,C)),de.getTranslation(l,C),A.sub(l,l,s),A.add(l,l,o),A.add(l,l,r),de.setTranslation(C,l),de.mul(C,v.cell.fromFractional,C),de.mul(C,C,v.cell.toFractional),A.sub(u,s,o);var w=y-u[0],_=b-u[1],E=S-u[2];return An.create(g+1+"_"+(5+w)+(5+_)+(5+E),C,{hkl:A.create(w,_,E),spgrOp:g})}e.getSymmetryOperatorRef=c;function d(v){var g=yA[v[0]],y=yA[v[1]],b=yA[v[2]];return de.ofRows([g,y,b,[0,0,0,1]])}function f(v){return[m(p(v[0],v[4],v[8]),h(v[12])),m(p(v[1],v[5],v[9]),h(v[13])),m(p(v[2],v[6],v[10]),h(v[14]))].join(",")}e.getOperatorXyz=f;function p(v,g,y){var b=[];if(v>0?b.push("+X"):v<0&&b.push("-X"),g>0?b.push("+Y"):g<0&&b.push("-Y"),y>0?b.push("+Z"):y<0&&b.push("-Z"),b.length===1)return b[0].charAt(0)==="+"?b[0].substr(1):b[0];if(b.length===2){var S=b[0].charAt(0),x=b[1].charAt(0);if(S==="+")return""+b[0].substr(1)+b[1];if(x==="+")return""+b[1].substr(1)+b[0]}throw new Error("unknown rotation '"+b+"', "+v+" "+g+" "+y)}function h(v){switch(v){case 1/2:return"1/2";case 1/4:return"1/4";case 3/4:return"3/4";case 1/3:return"1/3";case 2/3:return"2/3";case 1/6:return"1/6";case 5/6:return"5/6"}return""}function m(v,g){return g===""?v:v.length>2?v+"+"+g:v.charAt(0)==="-"?""+g+v:g+"+"+v}})(al||(al={}));var bp;(function(e){function t(i,o,s){i.squaredDistances[i.count]=s,i.indices[i.count++]=o}e.add=t;function r(i){i.count=0}e.reset=r;function n(){return{count:0,indices:[],squaredDistances:[]}}e.create=n;function a(i,o){for(var s=0;s<o.count;++s)i.indices[s]=o.indices[s],i.squaredDistances[s]=o.squaredDistances[s];return i.count=o.count,i}e.copy=a})(bp||(bp={}));function He(){return He.zero()}(function(e){function t(D){return D.extrema!==void 0}e.hasExtrema=t;function r(D,k){return{center:D,radius:k}}e.create=r;function n(){return{center:A(),radius:0}}e.zero=n;function a(D){var k=r(A.clone(D.center),D.radius);return t(D)&&(k.extrema=D.extrema.map(function(F){return A.clone(F)})),k}e.clone=a;function i(D,k,F){return A.copy(D.center,k),D.radius=F,D}e.set=i;function o(D,k){return A.copy(D.center,k.center),D.radius=k.radius,t(k)&&s(D,k.extrema.map(function(F){return A.clone(F)})),D}e.copy=o;function s(D,k){var F;return D.extrema!==void 0?(D.extrema.length=0,(F=D.extrema).push.apply(F,k)):D.extrema=k,D}e.setExtrema=s;function u(D){for(var k=D.x,F=D.y,X=D.z,U=D.indices,j=0,te=0,q=0,W=0,V=Ne.size(U),ee=0;ee<V;ee++){var ue=Ne.getAt(U,ee);j+=k[ue],te+=F[ue],q+=X[ue]}V>0&&(j/=V,te/=V,q/=V);for(var ee=0;ee<V;ee++){var ue=Ne.getAt(U,ee),$=k[ue]-j,Q=F[ue]-te,R=X[ue]-q,Y=$*$+Q*Q+R*R;Y>W&&(W=Y)}return{center:A.create(j,te,q),radius:Math.sqrt(W)}}e.computeBounding=u;function l(D,k,F){return A.transformMat4(D.center,k.center,F),D.radius=k.radius*de.getMaxScaleOnAxis(F),t(k)&&s(D,k.extrema.map(function(X){return A.transformMat4(A(),X,F)})),D}e.transform=l;function c(D,k,F){return A.add(D.center,k.center,F),t(k)&&s(D,k.extrema.map(function(X){return A.add(A(),X,F)})),D}e.translate=c;function d(D,k,F){A.toArray(D.center,k,F),k[F+3]=D.radius}e.toArray=d;function f(D,k,F){return A.fromArray(D.center,k,F),D.radius=k[F+3],D}e.fromArray=f;function p(D,k){return A.scale(D.center,A.add(D.center,k.max,k.min),.5),D.radius=A.distance(D.center,k.max),e.setExtrema(D,[A.create(k.min[0],k.min[1],k.min[2]),A.create(k.max[0],k.max[1],k.max[2]),A.create(k.max[0],k.min[1],k.min[2]),A.create(k.min[0],k.max[1],k.max[2]),A.create(k.min[0],k.min[1],k.max[2]),A.create(k.max[0],k.min[1],k.max[2]),A.create(k.max[0],k.max[1],k.min[2]),A.create(k.min[0],k.max[1],k.min[2])]),D}e.fromBox3D=p;function h(D,k){return A.copy(D.center,k.origin),D.radius=Math.max(A.magnitude(k.dirA),A.magnitude(k.dirB),A.magnitude(k.dirC)),D}e.fromAxes3D=h;var m=A();function v(D,k,F){var X=k[0],U=k[1],j=k[2],te=A.create(0,0,0);A.transformMat4(te,te,F);var q=A.create(X,U,j);A.transformMat4(q,q,F);var W=A.create(X,0,0);A.transformMat4(W,W,F);var V=A.create(0,U,j);A.transformMat4(V,V,F);var ee=A.create(0,0,j);A.transformMat4(ee,ee,F);var ue=A.create(X,0,j);A.transformMat4(ue,ue,F);var $=A.create(X,U,0);A.transformMat4($,$,F);var Q=A.create(0,U,0);A.transformMat4(Q,Q,F),A.add(m,te,q),A.scale(m,m,.5);var R=Math.max(A.distance(te,q),A.distance(W,V));return e.set(D,m,R/2),e.setExtrema(D,[te,q,W,V,ee,ue,$,Q]),D}e.fromDimensionsAndTransform=v;var g=A();function y(D,k,F){var X=A.distance(k.center,F);return X<k.radius?e.copy(D,k):(A.sub(g,k.center,F),A.sub(g,k.center,g),A.setMagnitude(g,g,k.radius),A.scale(D.center,A.add(g,g,F),.5),D.radius=A.distance(D.center,F),D)}e.addVec3=y;function b(D,k,F){return A.copy(D.center,k.center),D.radius=Math.max(k.radius,A.distance(k.center,F.center)+F.radius),t(k)&&t(F)&&s(D,Gt(Gt([],k.extrema.map(function(X){return A.clone(X)})),F.extrema.map(function(X){return A.clone(X)}))),D}e.expandBySphere=b;var S=A();function x(D,k,F){var X,U;return A.copy(D.center,k.center),D.radius=k.radius+F,k.radius<1e-12||((U=(X=k.extrema)===null||X===void 0?void 0:X.length)!==null&&U!==void 0?U:0)<=1?(D.extrema=void 0,D):(t(k)&&s(D,k.extrema.map(function(j){A.sub(S,j,k.center);var te=A.distance(k.center,j);return A.normalize(S,S),A.scaleAndAdd(A(),k.center,S,te+F)})),D)}e.expand=x;function C(D,k){return D.radius===k.radius&&A.exactEquals(D.center,k.center)}e.exactEquals=C;function w(D,k){var F=D.radius,X=k.radius;return Math.abs(F-X)<=jn*Math.max(1,Math.abs(F),Math.abs(X))&&A.equals(D.center,k.center)}e.equals=w;function _(D,k){if(t(k)){for(var F=0,X=k.extrema;F<X.length;F++){var U=X[F];if(A.distance(D.center,U)>D.radius)return!1}return!0}else return A.distance(D.center,k.center)+k.radius<=D.radius}e.includes=_;function E(D,k){return A.distance(D.center,k.center)<=D.radius+k.radius}e.overlaps=E;function P(D,k){return A.distance(D.center,k.center)-D.radius+k.radius}e.distance=P})(He||(He={}));function tr(){return tr.zero()}(function(e){function t(y,b){return{min:y,max:b}}e.create=t;function r(){return{min:A(),max:A()}}e.zero=r;function n(y,b){return A.copy(y.min,b.min),A.copy(y.max,b.max),y}e.copy=n;function a(y){return n(r(),y)}e.clone=a;function i(y,b){if(He.hasExtrema(b))return o(y,b.extrema);var S=A.create(b.radius,b.radius,b.radius);return A.sub(y.min,b.center,S),A.add(y.max,b.center,S),y}e.fromSphere3D=i;function o(y,b){e.setEmpty(y);for(var S=0,x=b.length;S<x;S++)e.add(y,b[S]);return y}e.fromVec3Array=o;function s(y){for(var b=A.create(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),S=A.create(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),x=y.x,C=y.y,w=y.z,_=y.indices,E=0,P=Ne.size(_);E<P;E++){var D=Ne.getAt(_,E);b[0]=Math.min(x[D],b[0]),b[1]=Math.min(C[D],b[1]),b[2]=Math.min(w[D],b[2]),S[0]=Math.max(x[D],S[0]),S[1]=Math.max(C[D],S[1]),S[2]=Math.max(w[D],S[2])}return{min:b,max:S}}e.computeBounding=s;function u(y,b){return A.sub(y,b.max,b.min)}e.size=u;var l=A();function c(y){return u(l,y),l[0]*l[1]*l[2]}e.volume=c;function d(y){return A.set(y.min,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),A.set(y.max,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),y}e.setEmpty=d;function f(y,b){return A.min(y.min,y.min,b),A.max(y.max,y.max,b),y}e.add=f;function p(y,b,S){return A.sub(y.min,b.min,S),A.add(y.max,b.max,S),y}e.expand=p;function h(y,b,S){return A.scale(y.min,b.min,S),A.scale(y.max,b.max,S),y}e.scale=h;var m=A();function v(y,b,S){var x=b.min,C=x[0],w=x[1],_=x[2],E=b.max,P=E[0],D=E[1],k=E[2];return d(y),f(y,A.transformMat4(m,A.set(m,C,w,_),S)),f(y,A.transformMat4(m,A.set(m,C,w,k),S)),f(y,A.transformMat4(m,A.set(m,C,D,_),S)),f(y,A.transformMat4(m,A.set(m,C,D,k),S)),f(y,A.transformMat4(m,A.set(m,P,w,_),S)),f(y,A.transformMat4(m,A.set(m,P,w,k),S)),f(y,A.transformMat4(m,A.set(m,P,D,_),S)),f(y,A.transformMat4(m,A.set(m,P,D,k),S)),y}e.transform=v;function g(y,b){return!(b[0]<y.min[0]||b[0]>y.max[0]||b[1]<y.min[1]||b[1]>y.max[1]||b[2]<y.min[2]||b[2]>y.max[2])}e.containsVec3=g})(tr||(tr={}));function nm(e,t,r){return new KCe(e,t,r)}var KCe=function(){function e(t,r,n){var a=QCe(t,r,n);this.ctx=ZCe(a),this.boundary={box:a.boundingBox,sphere:a.boundingSphere},this.buckets={offset:a.bucketOffset,count:a.bucketCounts,array:a.bucketArray},this.result=bp.create()}return e.prototype.find=function(t,r,n,a,i){this.ctx.x=t,this.ctx.y=r,this.ctx.z=n,this.ctx.radius=a,this.ctx.isCheck=!1;var o=i??this.result;return zF(this.ctx,o),o},e.prototype.check=function(t,r,n,a){return this.ctx.x=t,this.ctx.y=r,this.ctx.z=n,this.ctx.radius=a,this.ctx.isCheck=!0,zF(this.ctx,this.result)},e}();function $Ce(e){for(var t=e.expandedBox,r=e.size,n=r[0],a=r[1],i=r[2],o=e.data,s=o.x,u=o.y,l=o.z,c=o.radius,d=o.indices,f=e.elementCount,p=e.delta,h=n*a*i,m=t.min,v=m[0],g=m[1],y=m[2],b=0,S=0,x=new Uint32Array(h),C=new Int32Array(f),w=0;w<f;w++){var _=Ne.getAt(d,w),E=Math.floor((s[_]-v)/p[0]),P=Math.floor((u[_]-g)/p[1]),D=Math.floor((l[_]-y)/p[2]),k=(E*a+P)*i+D;(x[k]+=1)===1&&(S+=1),C[w]=k}if(c)for(var w=0;w<f;w++){var _=Ne.getAt(d,w);c[_]>b&&(b=c[_])}for(var F=new Int32Array(S),_=0,X=0;_<h;_++){var U=x[_];U>0&&(x[_]=X+1,F[X]=U,X+=1)}for(var j=new Uint32Array(S),_=1;_<S;++_)j[_]+=j[_-1]+F[_-1];for(var te=new Int32Array(S),q=new Int32Array(f),_=0;_<f;_++){var W=x[C[_]];if(W>0){var V=W-1;q[j[V]+te[V]]=_,te[V]+=1}}return{size:e.size,bucketArray:q,bucketCounts:F,bucketOffset:j,grid:x,delta:p,min:e.expandedBox.min,data:e.data,maxRadius:b,expandedBox:e.expandedBox,boundingBox:e.boundingBox,boundingSphere:e.boundingSphere}}function QCe(e,t,r){var n=tr.expand(tr(),t.box,A.create(.5,.5,.5)),a=e.indices,i=tr.size(A.zero(),n),o,s,u=Ne.size(a),l=typeof r=="number"?r:32,c=Array.isArray(r)&&r;if(c)s=[Math.ceil(i[0]/c[0]),Math.ceil(i[1]/c[1]),Math.ceil(i[2]/c[2])],o=c;else if(u>0){var d=Math.ceil(u/l),f=Math.pow(d/(i[0]*i[1]*i[2]),1/3);s=[Math.ceil(i[0]*f),Math.ceil(i[1]*f),Math.ceil(i[2]*f)],o=[i[0]/s[0],i[1]/s[1],i[2]/s[2]]}else o=i,s=[1,1,1];var p={x:e.x,y:e.y,z:e.z,indices:a,radius:e.radius},h={size:s,data:p,expandedBox:n,boundingBox:t.box,boundingSphere:t.sphere,elementCount:u,delta:o};return $Ce(h)}function ZCe(e){return{grid:e,x:.1,y:.1,z:.1,radius:.1,isCheck:!1}}function zF(e,t){var r=e.grid,n=r.min,a=r.size,i=a[0],o=a[1],s=a[2],u=r.bucketOffset,l=r.bucketCounts,c=r.bucketArray,d=r.grid,f=r.data,p=f.x,h=f.y,m=f.z,v=f.indices,g=f.radius,y=r.delta,b=r.maxRadius,S=e.radius,x=e.isCheck,C=e.x,w=e.y,_=e.z,E=S+b,P=E*E;bp.reset(t);var D=Math.max(0,Math.floor((C-E-n[0])/y[0])),k=Math.max(0,Math.floor((w-E-n[1])/y[1])),F=Math.max(0,Math.floor((_-E-n[2])/y[2])),X=Math.min(i-1,Math.floor((C+E-n[0])/y[0])),U=Math.min(o-1,Math.floor((w+E-n[1])/y[1])),j=Math.min(s-1,Math.floor((_+E-n[2])/y[2]));if(D>X||k>U||F>j)return!1;for(var te=D;te<=X;te++)for(var q=k;q<=U;q++)for(var W=F;W<=j;W++){var V=d[(te*o+q)*s+W];if(V!==0)for(var ee=V-1,ue=u[ee],$=l[ee],Q=ue+$,R=ue;R<Q;R++){var Y=Ne.getAt(v,c[R]),re=p[Y]-C,K=h[Y]-w,L=m[Y]-_,H=re*re+K*K+L*L;if(H<=P){if(b>0&&Math.sqrt(H)-g[Y]>S)continue;if(x)return!0;bp.add(t,c[R],H)}}}return t.count>0}function Hu(){return Hu.empty()}(function(e){function t(d,f,p,h){return{origin:d,dirA:f,dirB:p,dirC:h}}e.create=t;function r(){return{origin:A(),dirA:A(),dirB:A(),dirC:A()}}e.empty=r;function n(d,f){return A.copy(d.origin,f.origin),A.copy(d.dirA,f.dirA),A.copy(d.dirB,f.dirB),A.copy(d.dirC,f.dirC),d}e.copy=n;function a(d){return n(r(),d)}e.clone=a;function i(d,f){return A.set(d,A.magnitude(f.dirA)*2,A.magnitude(f.dirB)*2,A.magnitude(f.dirC)*2)}e.size=i;var o=A();function s(d){return i(o,d),o[0]*o[1]*o[2]}e.volume=s;function u(d,f){return A.copy(d.origin,f.origin),A.normalize(d.dirA,f.dirA),A.normalize(d.dirB,f.dirB),A.normalize(d.dirC,f.dirC),d}e.normalize=u;var l=ia.zero();function c(d,f,p){A.transformMat4(d.origin,f.origin,p);var h=ia.directionTransform(l,p);return A.transformMat3(d.dirA,f.dirA,h),A.transformMat3(d.dirB,f.dirB,h),A.transformMat3(d.dirC,f.dirC,h),d}e.transform=c})(Hu||(Hu={}));function JCe(e,t){for(var r=0,n=t*3;r<n;r+=3){var a=e[r],i=e[r+1],o=e[r+2],s=1/Math.sqrt(a*a+i*i+o*o);e[r]=a*s,e[r+1]=i*s,e[r+2]=o*s}return e}var Fo=A();function am(e,t,r,n){for(var a=0,i=n*3;a<i;a+=3)A.fromArray(Fo,t,r+a),A.transformMat4(Fo,Fo,e),A.toArray(Fo,t,r+a)}function e3e(e,t,r,n){for(var a=0,i=n*3;a<i;a+=3)A.fromArray(Fo,t,r+a),A.transformMat3(Fo,Fo,e),A.toArray(Fo,t,r+a)}function t3e(e,t){for(var r=0,n=e.length;r<n;r+=3)A.fromArray(Fo,e,r),A.normalize(Fo,Fo),A.scale(Fo,Fo,t),A.toArray(Fo,e,r)}var UF=A(),bA=A(),VF=A(),Ns=A(),HF=A();function IW(e,t,r,n,a){for(var i=0,o=a*3;i<o;i+=3){var s=t[i]*3,u=t[i+1]*3,l=t[i+2]*3;A.fromArray(UF,e,s),A.fromArray(bA,e,u),A.fromArray(VF,e,l),A.sub(Ns,VF,bA),A.sub(HF,UF,bA),A.cross(Ns,Ns,HF),r[s]+=Ns[0],r[s+1]+=Ns[1],r[s+2]+=Ns[2],r[u]+=Ns[0],r[u+1]+=Ns[1],r[u+2]+=Ns[2],r[l]+=Ns[0],r[l+1]+=Ns[1],r[l+2]+=Ns[2]}return JCe(r,n)}function L0(e,t,r){r===void 0&&(r=1);for(var n=nc(e),a=new Int32Array(n+2),i=new Int32Array(t),o=new Int32Array(t),s=0,u=t*r;s<u;s+=r)++o[e[s]];for(var l=0,s=0;s<t;s++)a[s]=l,l+=o[s];a[t]=l;for(var c=new Int32Array(l),s=0,u=t*r;s<u;s+=r){var d=e[s],f=a[d]+i[d];c[f]=s,++i[d]}return{indices:c,offsets:a}}var gd=function(){function e(){this.count=0,this.center=A(),this.radiusSq=0}return e.prototype.reset=function(){A.set(this.center,0,0,0),this.radiusSq=0,this.count=0},e.prototype.includeStep=function(t){A.add(this.center,this.center,t),this.count++},e.prototype.finishedIncludeStep=function(){this.count!==0&&A.scale(this.center,this.center,1/this.count)},e.prototype.radiusStep=function(t){var r=A.squaredDistance(t,this.center);r>this.radiusSq&&(this.radiusSq=r)},e.prototype.radiusSphereStep=function(t,r){var n=A.distance(t,this.center)+r,a=n*n;a>this.radiusSq&&(this.radiusSq=a)},e.prototype.getSphere=function(t){return t||(t=He()),A.copy(t.center,this.center),t.radius=Math.sqrt(this.radiusSq),t},e.prototype.getCount=function(){return this.count},e}();(function(e){var t=new e,r=A(),n=A();function a(s,u){var l=s.x,c=s.y,d=s.z;t.reset();for(var f=l.length,p=0;p<f;p++)A.set(r,l[p],c[p],d[p]),t.includeStep(r);t.finishedIncludeStep();for(var p=0;p<f;p++)A.set(r,l[p],c[p],d[p]),t.radiusStep(r);return A.copy(u.center,t.center),u.radius=Math.sqrt(t.radiusSq),u}e.fromArrays=a;function i(s,u,l){t.reset();for(var c=0;c<s;c++)u(c,r),t.includeStep(r);t.finishedIncludeStep();for(var c=0;c<s;c++)u(c,r),t.radiusStep(r);return A.copy(l.center,t.center),l.radius=Math.sqrt(t.radiusSq),l}e.fromProvider=i;function o(s,u,l){t.reset();for(var c=0;c<s;c++)u(c,r,n),t.includeStep(r),t.includeStep(n);t.finishedIncludeStep();for(var c=0;c<s;c++)u(c,r,n),t.radiusStep(r),t.radiusStep(n);return A.copy(l.center,t.center),l.radius=Math.sqrt(t.radiusSq),l}e.fromPairProvider=o})(gd||(gd={}));var Ms=function(){function e(t){this.minDist=[],this.maxDist=[],this.extrema=[],this.centroidHelper=new gd,this.dir=r3e(t),this.reset()}return e.prototype.computeExtrema=function(t,r){var n=A.dot(this.dir[t],r);n<this.minDist[t]&&(this.minDist[t]=n,A.copy(this.extrema[t*2],r)),n>this.maxDist[t]&&(this.maxDist[t]=n,A.copy(this.extrema[t*2+1],r))},e.prototype.computeSphereExtrema=function(t,r,n){var a=A.dot(this.dir[t],r);a-n<this.minDist[t]&&(this.minDist[t]=a-n,A.scaleAndSub(this.extrema[t*2],r,this.dir[t],n)),a+n>this.maxDist[t]&&(this.maxDist[t]=a+n,A.scaleAndAdd(this.extrema[t*2+1],r,this.dir[t],n))},e.prototype.includeSphere=function(t){if(He.hasExtrema(t)&&t.extrema.length>1)for(var r=0,n=t.extrema;r<n.length;r++){var a=n[r];this.includePosition(a)}else this.includePositionRadius(t.center,t.radius)},e.prototype.includePosition=function(t){for(var r=0,n=this.dir.length;r<n;++r)this.computeExtrema(r,t)},e.prototype.includePositionRadius=function(t,r){for(var n=0,a=this.dir.length;n<a;++n)this.computeSphereExtrema(n,t,r)},e.prototype.finishedIncludeStep=function(){for(var t=0;t<this.extrema.length;t++)this.centroidHelper.includeStep(this.extrema[t]);this.centroidHelper.finishedIncludeStep()},e.prototype.radiusSphere=function(t){if(He.hasExtrema(t)&&t.extrema.length>1)for(var r=0,n=t.extrema;r<n.length;r++){var a=n[r];this.radiusPosition(a)}else this.radiusPositionRadius(t.center,t.radius)},e.prototype.radiusPosition=function(t){this.centroidHelper.radiusStep(t)},e.prototype.radiusPositionRadius=function(t,r){this.centroidHelper.radiusSphereStep(t,r)},e.prototype.getSphere=function(t){return He.setExtrema(this.centroidHelper.getSphere(t),Gt([],this.extrema))},e.prototype.getBox=function(t){return tr.fromVec3Array(t||tr(),this.extrema)},e.prototype.reset=function(){for(var t=0,r=this.dir.length;t<r;++t)this.minDist[t]=1/0,this.maxDist[t]=-1/0,this.extrema[t*2]=A(),this.extrema[t*2+1]=A();this.centroidHelper.reset()},e}();function r3e(e){var t;switch(e){case"6":t=Gt([],z2);break;case"14":t=Gt(Gt([],z2),xA);break;case"26":t=Gt(Gt(Gt([],z2),xA),jF);break;case"98":t=Gt(Gt(Gt(Gt(Gt(Gt([],z2),xA),jF),n3e),a3e),i3e);break}return t.map(function(r){var n=A.create(r[0],r[1],r[2]);return A.normalize(n,n)})}var z2=[[1,0,0],[0,1,0],[0,0,1]],xA=[[1,1,1],[-1,1,1],[-1,-1,1],[1,-1,1]],jF=[[1,1,0],[1,-1,0],[1,0,1],[1,0,-1],[0,1,1],[0,1,-1]],n3e=[[0,1,2],[0,2,1],[1,0,2],[2,0,1],[1,2,0],[2,1,0],[0,1,-2],[0,2,-1],[1,0,-2],[2,0,-1],[1,-2,0],[2,-1,0]],a3e=[[1,1,2],[2,1,1],[1,2,1],[1,-1,2],[1,1,-2],[1,-1,-2],[2,-1,1],[2,1,-1],[2,-1,-1],[1,-2,1],[1,2,-1],[1,-2,-1]],i3e=[[2,2,1],[1,2,2],[2,1,2],[2,-2,1],[2,2,-1],[2,-2,-1],[1,-2,2],[1,2,-2],[1,-2,-2],[2,-1,2],[2,1,-2],[2,-1,-2]];function o3e(e,t){e=Math.max(e,2);var r=Math.sqrt(e),n=Math.ceil(r);n=n+(t-n%t)%t;var a=n>0?Math.ceil(e/n):0;return{width:n,height:a,length:n*a*t}}function Li(e,t,r,n){var a=o3e(e,t),i=a.length,o=a.width,s=a.height;return n=n&&n.length>=i?n:new r(i),{array:n,width:o,height:s}}var Ks=A(),s3e=new Ms("14"),u3e=new Ms("98");function MW(e){return e>1e5?s3e:u3e}function xp(e,t,r){var n=r*3,a=MW(t);a.reset();for(var i=0,o=t*3;i<o;i+=n)A.fromArray(Ks,e,i),a.includePosition(Ks);a.finishedIncludeStep();for(var i=0,o=t*3;i<o;i+=n)A.fromArray(Ks,e,i),a.radiusPosition(Ks);var s=a.getSphere();if(t<=98){for(var u=[],i=0,o=t*3;i<o;i+=n)u.push(A.fromArray(A(),e,i));He.setExtrema(s,u)}return s}var SA=de();function ii(e,t,r){if(r===1){de.fromArray(SA,t,0);var n=He.clone(e);return de.isIdentity(SA)?n:He.transform(n,n,SA)}var a=MW(r);a.reset();var i=e.center,o=e.radius,s=e.extrema;if(s&&r<50){for(var u=0,l=r;u<l;++u)for(var c=0,d=s;c<d.length;c++){var f=d[c];A.transformMat4Offset(Ks,f,t,0,0,u*16),a.includePosition(Ks)}a.finishedIncludeStep();for(var u=0,l=r;u<l;++u)for(var p=0,h=s;p<h.length;p++){var f=h[p];A.transformMat4Offset(Ks,f,t,0,0,u*16),a.radiusPosition(Ks)}}else{for(var u=0,l=r;u<l;++u)A.transformMat4Offset(Ks,i,t,0,0,u*16),a.includePositionRadius(Ks,o);a.finishedIncludeStep();for(var u=0,l=r;u<l;++u)A.transformMat4Offset(Ks,i,t,0,0,u*16),a.radiusPositionRadius(Ks,o)}return a.getSphere()}function xu(e,t){var r=Li(Math.max(1,e),1,Uint8Array,t&&t.tMarker.ref.value.array);return t?(N.update(t.tMarker,r),N.update(t.uMarkerTexDim,Xe.create(r.width,r.height)),t):{tMarker:N.create(r),uMarkerTexDim:N.create(Xe.create(r.width,r.height))}}var ws={kind:"null-location"};function DW(e,t,r){return{kind:"data-location",tag:e,data:t,element:r}}function Tn(e,t,r,n,a,i){if(a===void 0&&(a=!1),i===void 0&&(i=function(){return!1}),e%r!==0)throw new Error("incompatible groupCount and stride");var o={location:ws,index:0,groupIndex:0,instanceIndex:0,isSecondary:!1},s=o.groupIndex<e,u=!1,l=0,c=0,d=!1;return{get hasNext(){return s},get isNextNewInstance(){return u},groupCount:e,instanceCount:t,count:e*t,stride:r,nonInstanceable:a,move:function(){return s&&(o.groupIndex=l,o.instanceIndex=c,o.index=c*e+l,o.location=n(l,d?-1:c),o.isSecondary=i(l,d?-1:c),l+=r,l===e?(++c,u=!0,c<t&&(l=0)):u=!1,s=l<e),o},reset:function(){o.location=ws,o.index=0,o.groupIndex=0,o.instanceIndex=0,o.isSecondary=!1,s=o.groupIndex<e,u=!1,l=0,c=0,d=!1},skipInstance:function(){s&&o.instanceIndex===c&&(++c,l=0,s=c<t)},voidInstances:function(){d=!0}}}function Am(e){return{kind:"position-location",position:e?A.clone(e):A()}}var kW=new ArrayBuffer(4),l3e=new Int32Array(kW),c3e=new Float32Array(kW);function d3e(e){var t=e<-126?-126:e;return l3e[0]=(1<<23)*(t+126.94269504),c3e[0]}function f3e(e){return d3e(1.44269504*e)}var RW=new ArrayBuffer(4),p3e=new Int32Array(RW),h3e=new Float32Array(RW);function m3e(e){h3e[0]=e;var t=p3e[0]*11920928955078125e-23;return t-126.94269504}function v3e(e){return .6931471805599453*m3e(e)}var g3e=1e4;v3e(g3e+1);function hb(e,t,r){return e=$i(e,0,16777216-1)+1,t[r+2]=e%256,e=Math.floor(e/256),t[r+1]=e%256,e=Math.floor(e/256),t[r]=e%256,t}function uk(e,t,r){return Math.floor(e)*256*256+Math.floor(t)*256+Math.floor(r)-1}var U2=255/256,CA=A.create(256*256*256,256*256,256),y3e=Mr.create(U2/CA[0],U2/CA[1],U2/CA[2],U2/1),GF=Mr();function b3e(e,t,r,n){return Mr.set(GF,e/255,t/255,r/255,n/255),Mr.dot(GF,y3e)}function Dd(e,t,r){switch(xi.getGranularity(e,t.granularity)){case"uniform":return w3e(e,t.size,r);case"group":return A3e(e,t.size,r);case"groupInstance":return T3e(e,t.size,r);case"instance":return _3e(e,t.size,r)}}var Yw=100;function R1(e){var t=e.dSizeType.ref.value;switch(t){case"uniform":return e.uSize.ref.value;case"instance":case"group":case"groupInstance":for(var r=0,n=e.tSize.ref.value.array,a=0,i=n.length;a<i;a+=3){var o=uk(n[a],n[a+1],n[a+2]);r<o&&(r=o)}return r/Yw}}var x3e={array:new Uint8Array(3),width:1,height:1};function S3e(){return{tSize:N.create(x3e),uSizeTexDim:N.create(Xe.create(1,1))}}function C3e(e,t){return t?(N.update(t.uSize,e),N.updateIfChanged(t.dSizeType,"uniform"),t):T(T({uSize:N.create(e)},S3e()),{dSizeType:N.create("uniform")})}function w3e(e,t,r){return C3e(t(ws),r)}function lk(e,t,r){return r?(N.update(r.tSize,e),N.update(r.uSizeTexDim,Xe.create(e.width,e.height)),N.updateIfChanged(r.dSizeType,t),r):{uSize:N.create(0),tSize:N.create(e),uSizeTexDim:N.create(Xe.create(e.width,e.height)),dSizeType:N.create(t)}}function _3e(e,t,r){var n=e.instanceCount,a=Li(Math.max(1,n),3,Uint8Array,r&&r.tSize.ref.value.array);for(e.reset();e.hasNext&&!e.isNextNewInstance;){var i=e.move();hb(t(i.location)*Yw,a.array,i.instanceIndex*3),e.skipInstance()}return lk(a,"instance",r)}function A3e(e,t,r){var n=e.groupCount,a=Li(Math.max(1,n),3,Uint8Array,r&&r.tSize.ref.value.array);for(e.reset();e.hasNext&&!e.isNextNewInstance;){var i=e.move();hb(t(i.location)*Yw,a.array,i.groupIndex*3)}return lk(a,"group",r)}function T3e(e,t,r){var n=e.groupCount,a=e.instanceCount,i=a*n,o=Li(Math.max(1,i),3,Uint8Array,r&&r.tSize.ref.value.array);for(e.reset();e.hasNext;){var s=e.move();hb(t(s.location)*Yw,o.array,s.index*3)}return lk(o,"groupInstance",r)}var qF=ia(),E3e=de();function P3e(e,t){for(var r=0;r<t;r++)if(ia.fromMat4(qF,de.fromArray(E3e,e,r*16)),ia.determinant(qF)<0)return!0;return!1}function ck(e,t,r){var n=P3e(e,t);if(r){N.update(r.matrix,r.matrix.ref.value),N.update(r.transform,e),N.updateIfChanged(r.uInstanceCount,t),N.updateIfChanged(r.instanceCount,t);var a=r.aTransform.ref.value.length>=t*16?r.aTransform.ref.value:new Float32Array(t*16);a.set(e),N.update(r.aTransform,a);var i=r.extraTransform.ref.value.length>=t*16?r.extraTransform.ref.value:new Float32Array(t*16);N.update(r.extraTransform,BC(i,t));var o=r.aInstance.ref.value.length>=t?r.aInstance.ref.value:new Float32Array(t);return N.update(r.aInstance,pu(o,t)),N.update(r.hasReflection,n),OW(r),r}else return{aTransform:N.create(new Float32Array(e)),matrix:N.create(de.identity()),transform:N.create(e),extraTransform:N.create(BC(new Float32Array(t*16),t)),uInstanceCount:N.create(t),instanceCount:N.create(t),aInstance:N.create(pu(new Float32Array(t))),hasReflection:N.create(n)}}var dk=new Float32Array(16);de.toArray(de.identity(),dk,0);function fk(e){return ck(new Float32Array(dk),1,e)}function BC(e,t){for(var r=0;r<t;r++)e.set(dk,r*16);return e}function OW(e){for(var t=e.aTransform.ref.value,r=e.instanceCount.ref.value,n=e.matrix.ref.value,a=e.transform.ref.value,i=e.extraTransform.ref.value,o=0;o<r;o++){var s=o*16;de.mulOffset(t,i,a,s,s,s),de.mulOffset(t,n,t,s,0,s)}N.update(e.aTransform,t)}var BW=vt(13421772),I3e="Gives everything the same, uniform color.",FW={value:M.Color(BW)};function M3e(e){return FW}function pk(e,t){var r=ja(t.value,BW);return{factory:pk,granularity:"uniform",color:function(){return r},props:t,description:I3e,legend:Dp([["uniform",r]])}}var D3e={name:"uniform",label:"Uniform",category:"Miscellaneous",factory:pk,getParams:M3e,defaultValues:M.getDefaultValues(FW),isApplicable:function(e){return!0}},k3e="Gives everything the same, uniform size.",LW={value:M.Numeric(1,{min:0,max:20,step:.1})};function R3e(e){return LW}function hk(e,t){var r=t.value;return{factory:hk,granularity:"uniform",size:function(){return r},props:t,description:k3e}}var O3e={name:"uniform",label:"Uniform",category:"",factory:hk,getParams:R3e,defaultValues:M.getDefaultValues(LW),isApplicable:function(e){return!0}},B3e={custom:{},auto:{},highest:{},higher:{},high:{},medium:{},low:{},lower:{},lowest:{}},F3e=Object.keys(B3e),mk=M.arrayToOptions(F3e),Dt;(function(e){e.Params={alpha:M.Numeric(1,{min:0,max:1,step:.01},{label:"Opacity",isEssential:!0,description:"How opaque/transparent the representation is rendered."}),quality:M.Select("auto",mk,{isEssential:!0,description:"Visual/rendering quality of the representation."})},e.ShadingCategory={category:"Shading"},e.CustomQualityParamInfo={category:"Custom Quality",hideIf:function(o){return typeof o.quality<"u"&&o.quality!=="custom"}};function t(o,s,u){o===void 0&&(o=gr.grey),s===void 0&&(s=1),u||(u=fk());var l=Tn(1,u.instanceCount.ref.value,1,function(){return ws},!1,function(){return!1}),c={color:pk({},{value:o}),size:hk({},{value:s})};return{transform:u,locationIterator:l,theme:c}}e.createSimple=t;function r(o,s){return{alpha:N.create(o.alpha),uAlpha:N.create(o.alpha),uVertexCount:N.create(s.vertexCount),uGroupCount:N.create(s.groupCount),drawCount:N.create(s.drawCount)}}e.createValues=r;function n(o,s){N.updateIfChanged(o.alpha,s.alpha)}e.updateValues=n;function a(o){o===void 0&&(o={});var s=o.alpha===void 0?!0:o.alpha===1;return{disposed:!1,visible:!0,alphaFactor:1,pickable:!0,colorOnly:!1,opaque:s,writeDepth:s,noClip:!1}}e.createRenderableState=a;function i(o,s){o.opaque=s.alpha*o.alphaFactor>=1,o.writeDepth=o.opaque}e.updateRenderableState=i})(Dt||(Dt={}));function L3e(e,t,r,n){for(var a=t;a<r;++a)vt.toArray(n,e,a*4),e[a*4+3]=255;return!0}function WF(e,t,r){return e.fill(0,t*4,r*4),!0}function N3e(e,t){var r=Li(Math.max(1,e),4,Uint8Array,t&&t.tOverpaint.ref.value.array);return t?(N.update(t.tOverpaint,r),N.update(t.uOverpaintTexDim,Xe.create(r.width,r.height)),N.updateIfChanged(t.dOverpaint,e>0),t):{tOverpaint:N.create(r),uOverpaintTexDim:N.create(Xe.create(r.width,r.height)),dOverpaint:N.create(e>0)}}var XF={array:new Uint8Array(4),width:1,height:1};function kd(e){return e?(N.update(e.tOverpaint,XF),N.update(e.uOverpaintTexDim,Xe.create(1,1)),e):{tOverpaint:N.create(XF),uOverpaintTexDim:N.create(Xe.create(1,1)),dOverpaint:N.create(!1)}}function z3e(e,t,r,n){for(var a=t;a<r;++a)e[a]=n*255;return!0}function NW(e,t){for(var r=0,n=0;n<t;++n)r+=e[n];return r/(255*t)}function U3e(e,t,r){e.fill(0,t,r)}function V3e(e,t){var r=Li(Math.max(1,e),1,Uint8Array,t&&t.tTransparency.ref.value.array);return t?(N.update(t.tTransparency,r),N.update(t.uTransparencyTexDim,Xe.create(r.width,r.height)),N.updateIfChanged(t.dTransparency,e>0),N.updateIfChanged(t.transparencyAverage,NW(r.array,e)),t):{tTransparency:N.create(r),uTransparencyTexDim:N.create(Xe.create(r.width,r.height)),dTransparency:N.create(e>0),transparencyAverage:N.create(0)}}var YF={array:new Uint8Array(1),width:1,height:1};function Rd(e){return e?(N.update(e.tTransparency,YF),N.update(e.uTransparencyTexDim,Xe.create(1,1)),e):{tTransparency:N.create(YF),uTransparencyTexDim:N.create(Xe.create(1,1)),dTransparency:N.create(!1),transparencyAverage:N.create(0)}}function H3e(e,t,r,n){for(var a=t;a<r;++a)e[a]=n;return!0}function j3e(e,t,r){e.fill(0,t,r)}function G3e(e,t){var r=Li(Math.max(1,e),1,Uint8Array,t&&t.tClipping.ref.value.array);return t?(N.update(t.tClipping,r),N.update(t.uClippingTexDim,Xe.create(r.width,r.height)),N.updateIfChanged(t.dClipping,e>0),t):{dClipObjectCount:N.create(0),dClipVariant:N.create("instance"),tClipping:N.create(r),uClippingTexDim:N.create(Xe.create(r.width,r.height)),dClipping:N.create(e>0)}}var KF={array:new Uint8Array(1),width:1,height:1};function Od(e){return e?(N.update(e.tClipping,KF),N.update(e.uClippingTexDim,Xe.create(1,1)),e):{dClipObjectCount:N.create(0),dClipVariant:N.create("instance"),tClipping:N.create(KF),uClippingTexDim:N.create(Xe.create(1,1)),dClipping:N.create(!1)}}var im;(function(e){function t(h,m,v,g){return g?i(h,m,v,g):a(h,m,v)}e.create=t;function r(h){var m=h?h.centerBuffer.ref.value:new Float32Array(0),v=h?h.groupBuffer.ref.value:new Float32Array(0);return t(m,v,0,h)}e.createEmpty=r;function n(h){return eo([h.pointCount,h.centerBuffer.ref.version,h.groupBuffer.ref.version])}function a(h,m,v){var g=He(),y,b=-1,S=-1,x={kind:"points",pointCount:v,centerBuffer:N.create(h),groupBuffer:N.create(m),get boundingSphere(){var C=n(x);if(C!==b){var w=xp(x.centerBuffer.ref.value,x.pointCount,1);He.copy(g,w),b=C}return g},get groupMapping(){return x.groupBuffer.ref.version!==S&&(y=L0(x.groupBuffer.ref.value,x.pointCount),S=x.groupBuffer.ref.version),y},setBoundingSphere:function(C){He.copy(g,C),b=n(x)}};return x}function i(h,m,v,g){return g.pointCount=v,N.update(g.centerBuffer,h),N.update(g.groupBuffer,m),g}function o(h,m){var v=h.centerBuffer.ref.value;am(m,v,0,h.pointCount),N.update(h.centerBuffer,v)}e.transform=o,e.Params=T(T({},Dt.Params),{sizeFactor:M.Numeric(1.5,{min:0,max:10,step:.1}),pointSizeAttenuation:M.Boolean(!1),pointFilledCircle:M.Boolean(!1),pointEdgeBleach:M.Numeric(.2,{min:0,max:1,step:.05})}),e.Utils={Params:e.Params,createEmpty:r,createValues:u,createValuesSimple:l,updateValues:c,updateBoundingSphere:d,createRenderableState:f,updateRenderableState:p,createPositionIterator:s};function s(h,m){var v=h.pointCount,g=m.instanceCount.ref.value,y=Am(),b=y.position,S=h.centerBuffer.ref.value,x=m.aTransform.ref.value,C=function(w,_){return _<0?A.fromArray(b,S,w*3):A.transformMat4Offset(b,S,x,0,w*3,_*16),y};return Tn(v,g,1,C)}function u(h,m,v,g,y){var b=v.instanceCount,S=v.groupCount,x=s(h,m),C=Ds(v,x,g.color),w=Dd(v,g.size),_=xu(b*S),E=kd(),P=Rd(),D=Od(),k={drawCount:h.pointCount,vertexCount:h.pointCount,groupCount:S,instanceCount:b},F=He.clone(h.boundingSphere),X=ii(F,m.aTransform.ref.value,b);return T(T(T(T(T(T(T(T(T({aPosition:h.centerBuffer,aGroup:h.groupBuffer,boundingSphere:N.create(X),invariantBoundingSphere:N.create(F),uInvariantBoundingSphere:N.create(Mr.ofSphere(F))},C),w),_),E),P),D),m),Dt.createValues(y,k)),{uSizeFactor:N.create(y.sizeFactor),dPointSizeAttenuation:N.create(y.pointSizeAttenuation),dPointFilledCircle:N.create(y.pointFilledCircle),uPointEdgeBleach:N.create(y.pointEdgeBleach)})}function l(h,m,v,g,y){var b=Dt.createSimple(v,g,y),S=T(T({},M.getDefaultValues(e.Params)),m);return u(h,b.transform,b.locationIterator,b.theme,S)}function c(h,m){Dt.updateValues(h,m),N.updateIfChanged(h.uSizeFactor,m.sizeFactor),N.updateIfChanged(h.dPointSizeAttenuation,m.pointSizeAttenuation),N.updateIfChanged(h.dPointFilledCircle,m.pointFilledCircle),N.updateIfChanged(h.uPointEdgeBleach,m.pointEdgeBleach)}function d(h,m){var v=He.clone(m.boundingSphere),g=ii(v,h.aTransform.ref.value,h.instanceCount.ref.value);He.equals(g,h.boundingSphere.ref.value)||N.update(h.boundingSphere,g),He.equals(v,h.invariantBoundingSphere.ref.value)||(N.update(h.invariantBoundingSphere,v),N.update(h.uInvariantBoundingSphere,Mr.fromSphere(h.uInvariantBoundingSphere.ref.value,v)))}function f(h){var m=Dt.createRenderableState(h);return p(m,h),m}function p(h,m){Dt.updateRenderableState(h,m),h.opaque=h.opaque&&(!m.pointFilledCircle||m.pointFilledCircle&&m.pointEdgeBleach===0),h.writeDepth=h.opaque}})(im||(im={}));function $F(e,t,r,n,a,i,o){for(var s=0;s<t;s++){for(var u=0;u<r;u++)n[u]=e[u*t+s];QF(n,a,i,o,r);for(var u=0;u<r;u++)e[u*t+s]=a[u]}for(var u=0;u<r;u++){for(var s=0;s<t;s++)n[s]=e[u*t+s];QF(n,a,i,o,t);for(var s=0;s<t;s++)e[u*t+s]=Math.sqrt(a[s])}}function QF(e,t,r,n,a){r[0]=0,n[0]=Number.MIN_SAFE_INTEGER,n[1]=Number.MAX_SAFE_INTEGER;for(var i=1,o=0;i<a;i++){for(var s=(e[i]+i*i-(e[r[o]]+r[o]*r[o]))/(2*i-2*r[o]);s<=n[o];)o--,s=(e[i]+i*i-(e[r[o]]+r[o]*r[o]))/(2*i-2*r[o]);o++,r[o]=i,n[o]=s,n[o+1]=Number.MAX_SAFE_INTEGER}for(var i=0,o=0;i<a;i++){for(;n[o+1]<i;)o++;t[i]=(i-r[o])*(i-r[o])+e[r[o]]}}var wA={};function q3e(e){var t=JSON.stringify(e);return wA[t]===void 0&&(wA[t]=new W3e(e)),wA[t]}var zW={fontFamily:M.Select("sans-serif",[["sans-serif","Sans Serif"],["monospace","Monospace"],["serif","Serif"],["cursive","Cursive"]]),fontQuality:M.Select(3,[[0,"lower"],[1,"low"],[2,"medium"],[3,"high"],[4,"higher"]]),fontStyle:M.Select("normal",[["normal","Normal"],["italic","Italic"],["oblique","Oblique"]]),fontVariant:M.Select("normal",[["normal","Normal"],["small-caps","Small Caps"]]),fontWeight:M.Select("normal",[["normal","Normal"],["bold","Bold"]])},W3e=function(){function e(t){t===void 0&&(t={}),this.mapped={},this.scratchW=0,this.scratchH=0,this.currentX=0,this.currentY=0,this.cutoff=.5;var r=T(T({},M.getDefaultValues(zW)),t);this.props=r;var n=32*(r.fontQuality+1);this.buffer=n/8,this.radius=n/3,this.lineHeight=Math.round(n+2*this.buffer+this.radius),this.maxWidth=Math.round(this.lineHeight*.75),this.texture=Li(350*this.lineHeight*this.maxWidth,1,Uint8Array),this.scratchCanvas=document.createElement("canvas"),this.scratchCanvas.width=this.maxWidth,this.scratchCanvas.height=this.lineHeight,this.scratchContext=this.scratchCanvas.getContext("2d"),this.scratchContext.font=r.fontStyle+" "+r.fontVariant+" "+r.fontWeight+" "+n+"px "+r.fontFamily,this.scratchContext.fillStyle="black",this.scratchContext.textBaseline="middle",this.scratchData=new Uint8Array(this.lineHeight*this.maxWidth),this.gridOuter=new Float64Array(this.lineHeight*this.maxWidth),this.gridInner=new Float64Array(this.lineHeight*this.maxWidth),this.f=new Float64Array(Math.max(this.lineHeight,this.maxWidth)),this.d=new Float64Array(Math.max(this.lineHeight,this.maxWidth)),this.z=new Float64Array(Math.max(this.lineHeight,this.maxWidth)+1),this.v=new Int16Array(Math.max(this.lineHeight,this.maxWidth)),this.middle=Math.ceil(this.lineHeight/2),this.placeholder=this.get(String.fromCharCode(65533))}return e.prototype.get=function(t){if(this.mapped[t]===void 0){this.draw(t);var r=this.texture,n=r.array,a=r.width,i=r.height,o=this.scratchData;if(this.currentX+this.scratchW>a&&(this.currentX=0,this.currentY+=this.scratchH),this.currentY+this.scratchH>i)return console.warn("canvas to small"),this.placeholder;this.mapped[t]={x:this.currentX,y:this.currentY,w:this.scratchW,h:this.scratchH,nw:this.scratchW/this.lineHeight,nh:this.scratchH/this.lineHeight};for(var s=0;s<this.scratchH;++s)for(var u=0;u<this.scratchW;++u)n[a*(this.currentY+s)+this.currentX+u]=o[s*this.scratchW+u];this.currentX+=this.scratchW}return this.mapped[t]},e.prototype.draw=function(t){var r=this.lineHeight,n=this.scratchContext,a=this.scratchData,i=n.measureText(t),o=Math.min(this.maxWidth,Math.ceil(i.width+2*this.buffer)),s=o*r;n.clearRect(0,0,o,r),n.fillText(t,this.buffer,this.middle);for(var u=n.getImageData(0,0,o,r),l=0;l<s;l++){var c=u.data[l*4+3]/255;this.gridOuter[l]=c===1?0:c===0?Number.MAX_SAFE_INTEGER:Math.pow(Math.max(0,.5-c),2),this.gridInner[l]=c===1?Number.MAX_SAFE_INTEGER:c===0?0:Math.pow(Math.max(0,c-.5),2)}$F(this.gridOuter,o,r,this.f,this.d,this.v,this.z),$F(this.gridInner,o,r,this.f,this.d,this.v,this.z);for(var l=0;l<s;l++){var d=this.gridOuter[l]-this.gridInner[l];a[l]=Math.max(0,Math.min(255,Math.round(255-255*(d/this.radius+this.cutoff))))}this.scratchW=o,this.scratchH=r},e}(),mu;(function(e){function t(p,h,m,v,g,y,b,S,x){return x?i(p,h,m,v,g,y,b,S,x):a(p,h,m,v,g,y,b,S)}e.create=t;function r(p){var h=p?p.fontTexture.ref.value:Li(0,1,Uint8Array),m=p?p.centerBuffer.ref.value:new Float32Array(0),v=p?p.mappingBuffer.ref.value:new Float32Array(0),g=p?p.depthBuffer.ref.value:new Float32Array(0),y=p?p.indexBuffer.ref.value:new Uint32Array(0),b=p?p.groupBuffer.ref.value:new Float32Array(0),S=p?p.tcoordBuffer.ref.value:new Float32Array(0);return t(h,m,v,g,y,b,S,0,p)}e.createEmpty=r;function n(p){return eo([p.charCount,p.fontTexture.ref.version,p.centerBuffer.ref.version,p.mappingBuffer.ref.version,p.depthBuffer.ref.version,p.indexBuffer.ref.version,p.groupBuffer.ref.version,p.tcoordBuffer.ref.version])}function a(p,h,m,v,g,y,b,S){var x=He(),C,w=-1,_=-1,E={kind:"text",charCount:S,fontTexture:N.create(p),centerBuffer:N.create(h),mappingBuffer:N.create(m),depthBuffer:N.create(v),indexBuffer:N.create(g),groupBuffer:N.create(y),tcoordBuffer:N.create(b),get boundingSphere(){var P=n(E);if(P!==w){var D=xp(E.centerBuffer.ref.value,E.charCount*4,4);He.copy(x,D),w=P}return x},get groupMapping(){return E.groupBuffer.ref.version!==_&&(C=L0(E.groupBuffer.ref.value,E.charCount,4),_=E.groupBuffer.ref.version),C},setBoundingSphere:function(P){He.copy(x,P),w=n(E)}};return E}function i(p,h,m,v,g,y,b,S,x){return x.charCount=S,N.update(x.fontTexture,p),N.update(x.centerBuffer,h),N.update(x.mappingBuffer,m),N.update(x.depthBuffer,v),N.update(x.indexBuffer,g),N.update(x.groupBuffer,y),N.update(x.tcoordBuffer,b),x}e.Params=T(T(T({},Dt.Params),zW),{sizeFactor:M.Numeric(1,{min:0,max:10,step:.1}),borderWidth:M.Numeric(0,{min:0,max:.5,step:.01}),borderColor:M.Color(gr.grey),offsetX:M.Numeric(0,{min:0,max:10,step:.1}),offsetY:M.Numeric(0,{min:0,max:10,step:.1}),offsetZ:M.Numeric(0,{min:0,max:10,step:.1}),background:M.Boolean(!1),backgroundMargin:M.Numeric(.2,{min:0,max:1,step:.01}),backgroundColor:M.Color(gr.grey),backgroundOpacity:M.Numeric(1,{min:0,max:1,step:.01}),tether:M.Boolean(!1),tetherLength:M.Numeric(1,{min:0,max:5,step:.1}),tetherBaseWidth:M.Numeric(.3,{min:0,max:1,step:.01}),attachment:M.Select("middle-center",[["bottom-left","bottom-left"],["bottom-center","bottom-center"],["bottom-right","bottom-right"],["middle-left","middle-left"],["middle-center","middle-center"],["middle-right","middle-right"],["top-left","top-left"],["top-center","top-center"],["top-right","top-right"]])}),e.Utils={Params:e.Params,createEmpty:r,createValues:s,createValuesSimple:u,updateValues:l,updateBoundingSphere:c,createRenderableState:d,updateRenderableState:f,createPositionIterator:o};function o(p,h){var m=p.charCount*4,v=h.instanceCount.ref.value,g=Am(),y=g.position,b=p.centerBuffer.ref.value,S=h.aTransform.ref.value,x=function(C,w){return w<0?A.fromArray(y,b,C*3):A.transformMat4Offset(y,b,S,0,C*3,w*16),g};return Tn(m,v,4,x)}function s(p,h,m,v,g){var y=m.instanceCount,b=m.groupCount;if(y!==h.instanceCount.ref.value)throw new Error("instanceCount values in TransformData and LocationIterator differ");var S=o(p,h),x=Ds(m,S,v.color),C=Dd(m,v.size),w=xu(y*b),_=kd(),E=Rd(),P=Od(),D={drawCount:p.charCount*2*3,vertexCount:p.charCount*4,groupCount:b,instanceCount:y},k=ZF(p.mappingBuffer.ref.value,p.depthBuffer.ref.value,p.charCount,R1(C)),F=He.expand(He(),p.boundingSphere,k),X=ii(F,h.aTransform.ref.value,y);return T(T(T(T(T(T(T(T(T(T({aPosition:p.centerBuffer,aMapping:p.mappingBuffer,aDepth:p.depthBuffer,aGroup:p.groupBuffer,elements:p.indexBuffer,boundingSphere:N.create(X),invariantBoundingSphere:N.create(F),uInvariantBoundingSphere:N.create(Mr.ofSphere(F))},x),C),w),_),E),P),h),{aTexCoord:p.tcoordBuffer,tFont:p.fontTexture,padding:N.create(k)}),Dt.createValues(g,D)),{uSizeFactor:N.create(g.sizeFactor),uBorderWidth:N.create($i(g.borderWidth/2,0,.5)),uBorderColor:N.create(vt.toArrayNormalized(g.borderColor,A.zero(),0)),uOffsetX:N.create(g.offsetX),uOffsetY:N.create(g.offsetY),uOffsetZ:N.create(g.offsetZ),uBackgroundColor:N.create(vt.toArrayNormalized(g.backgroundColor,A.zero(),0)),uBackgroundOpacity:N.create(g.backgroundOpacity)})}function u(p,h,m,v,g){var y=Dt.createSimple(m,v,g),b=T(T({},M.getDefaultValues(e.Params)),h);return s(p,y.transform,y.locationIterator,y.theme,b)}function l(p,h){Dt.updateValues(p,h),N.updateIfChanged(p.uSizeFactor,h.sizeFactor),N.updateIfChanged(p.uBorderWidth,h.borderWidth),vt.fromNormalizedArray(p.uBorderColor.ref.value,0)!==h.borderColor&&(vt.toArrayNormalized(h.borderColor,p.uBorderColor.ref.value,0),N.update(p.uBorderColor,p.uBorderColor.ref.value)),N.updateIfChanged(p.uOffsetX,h.offsetX),N.updateIfChanged(p.uOffsetY,h.offsetY),N.updateIfChanged(p.uOffsetZ,h.offsetZ),vt.fromNormalizedArray(p.uBackgroundColor.ref.value,0)!==h.backgroundColor&&(vt.toArrayNormalized(h.backgroundColor,p.uBackgroundColor.ref.value,0),N.update(p.uBackgroundColor,p.uBackgroundColor.ref.value)),N.updateIfChanged(p.uBackgroundOpacity,h.backgroundOpacity)}function c(p,h){var m=ZF(p.aMapping.ref.value,p.aDepth.ref.value,h.charCount,R1(p)),v=He.expand(He(),h.boundingSphere,m),g=ii(v,p.aTransform.ref.value,p.instanceCount.ref.value);He.equals(g,p.boundingSphere.ref.value)||N.update(p.boundingSphere,g),He.equals(v,p.invariantBoundingSphere.ref.value)||(N.update(p.invariantBoundingSphere,v),N.update(p.uInvariantBoundingSphere,Mr.fromSphere(p.uInvariantBoundingSphere.ref.value,v))),N.update(p.padding,m)}function d(p){var h=Dt.createRenderableState(p);return f(h,p),h}function f(p,h){Dt.updateRenderableState(p,h),p.pickable=!1,p.opaque=!1,p.writeDepth=!0}})(mu||(mu={}));function ZF(e,t,r,n){for(var a=0,i=0,o=0,s=r*4;o<s;++o){var u=2*o,l=Math.abs(e[u]);l>a&&(a=l);var c=Math.abs(e[u+1]);c>a&&(a=c);var d=Math.abs(t[o]);d>i&&(i=d)}return Math.max(i,n+n*a)}var yl=A(),bl=A(),Yp=A(),JF=Ke.add,V2=Ke.add3,_s;(function(e){function t(r,n,a){r===void 0&&(r=2048),n===void 0&&(n=1024);var i=Ke.create(Float32Array,1,n,a?a.groupBuffer.ref.value:r),o=Ke.create(Float32Array,3,n,a?a.startBuffer.ref.value:r),s=Ke.create(Float32Array,3,n,a?a.endBuffer.ref.value:r),u=function(d,f,p,h,m,v,g){for(var y=0;y<4;++y)V2(o,d,f,p),V2(s,h,m,v),JF(i,g)},l=function(d,f,p){for(var h=0;h<4;++h)V2(o,d[0],d[1],d[2]),V2(s,f[0],f[1],f[2]),JF(i,p)},c=function(d,f,p,h){var m=A.distance(d,f),v=Math.floor(p/2),g=1/p;A.sub(Yp,f,d);for(var y=0;y<v;++y){var b=g*(y*2+1);A.setMagnitude(Yp,Yp,m*b),A.add(yl,d,Yp),A.setMagnitude(Yp,Yp,m*g*((y+1)*2)),A.add(bl,d,Yp),u(yl[0],yl[1],yl[2],bl[0],bl[1],bl[2],h)}};return{add:u,addVec:l,addFixedCountDashes:c,addFixedLengthDashes:function(d,f,p,h){var m=A.distance(d,f);c(d,f,m/p,h)},addCage:function(d,f,p){for(var h=f.vertices,m=f.edges,v=0,g=m.length;v<g;v+=2)A.fromArray(yl,h,m[v]*3),A.fromArray(bl,h,m[v+1]*3),A.transformMat4(yl,yl,d),A.transformMat4(bl,bl,d),u(yl[0],yl[1],yl[2],bl[0],bl[1],bl[2],p)},getLines:function(){var d=i.elementCount/4,f=Ke.compact(i,!0),p=Ke.compact(o,!0),h=Ke.compact(s,!0),m=a&&d<=a.lineCount?a.mappingBuffer.ref.value:new Float32Array(d*8),v=a&&d<=a.lineCount?a.indexBuffer.ref.value:new Uint32Array(d*6);return(!a||d>a.lineCount)&&X3e(d,m,v),Mn.create(m,v,f,p,h,d,a)}}}e.create=t})(_s||(_s={}));function X3e(e,t,r){for(var n=0;n<e;++n){var a=n*8;t[a]=-1,t[a+1]=-1,t[a+2]=1,t[a+3]=-1,t[a+4]=-1,t[a+5]=1,t[a+6]=1,t[a+7]=1}for(var n=0;n<e;++n){var i=n*4,o=n*6;r[o]=i,r[o+1]=i+1,r[o+2]=i+2,r[o+3]=i+1,r[o+4]=i+3,r[o+5]=i+2}}var Mn;(function(e){function t(p,h,m,v,g,y,b){return b?o(p,h,m,v,g,y,b):i(p,h,m,v,g,y)}e.create=t;function r(p){var h=p?p.mappingBuffer.ref.value:new Float32Array(0),m=p?p.indexBuffer.ref.value:new Uint32Array(0),v=p?p.groupBuffer.ref.value:new Float32Array(0),g=p?p.startBuffer.ref.value:new Float32Array(0),y=p?p.endBuffer.ref.value:new Float32Array(0);return t(h,m,v,g,y,0,p)}e.createEmpty=r;function n(p,h){for(var m=p.vertexBuffer.ref.value,v=p.indexBuffer.ref.value,g=p.groupBuffer.ref.value,y=_s.create(p.triangleCount*3,p.triangleCount/10,h),b=0,S=p.triangleCount*3;b<S;b+=3){var x=v[b],C=v[b+1],w=v[b+2],_=m[x*3],E=m[x*3+1],P=m[x*3+2],D=m[C*3],k=m[C*3+1],F=m[C*3+2],X=m[w*3],U=m[w*3+1],j=m[w*3+2];y.add(_,E,P,D,k,F,g[x]),y.add(_,E,P,X,U,j,g[x]),y.add(D,k,F,X,U,j,g[C])}return y.getLines()}e.fromMesh=n;function a(p){return eo([p.lineCount,p.mappingBuffer.ref.version,p.indexBuffer.ref.version,p.groupBuffer.ref.version,p.startBuffer.ref.version,p.endBuffer.ref.version])}function i(p,h,m,v,g,y){var b=He(),S,x=-1,C=-1,w={kind:"lines",lineCount:y,mappingBuffer:N.create(p),indexBuffer:N.create(h),groupBuffer:N.create(m),startBuffer:N.create(v),endBuffer:N.create(g),get boundingSphere(){var _=a(w);if(_!==x){var E=xp(w.startBuffer.ref.value,w.lineCount*4,4),P=xp(w.endBuffer.ref.value,w.lineCount*4,4);He.expandBySphere(b,E,P),x=_}return b},get groupMapping(){return w.groupBuffer.ref.version!==C&&(S=L0(w.groupBuffer.ref.value,w.lineCount,4),C=w.groupBuffer.ref.version),S},setBoundingSphere:function(_){He.copy(b,_),x=a(w)}};return w}function o(p,h,m,v,g,y,b){return y>b.lineCount&&(N.update(b.mappingBuffer,p),N.update(b.indexBuffer,h)),b.lineCount=y,N.update(b.groupBuffer,m),N.update(b.startBuffer,v),N.update(b.endBuffer,g),b}function s(p,h){var m=p.startBuffer.ref.value;am(h,m,0,p.lineCount*4),N.update(p.startBuffer,m);var v=p.endBuffer.ref.value;am(h,v,0,p.lineCount*4),N.update(p.endBuffer,v)}e.transform=s,e.Params=T(T({},Dt.Params),{sizeFactor:M.Numeric(1.5,{min:0,max:10,step:.1}),lineSizeAttenuation:M.Boolean(!1)}),e.Utils={Params:e.Params,createEmpty:r,createValues:l,createValuesSimple:c,updateValues:d,updateBoundingSphere:f,createRenderableState:Dt.createRenderableState,updateRenderableState:Dt.updateRenderableState,createPositionIterator:u};function u(p,h){var m=p.lineCount*4,v=h.instanceCount.ref.value,g=Am(),y=g.position,b=p.startBuffer.ref.value,S=p.endBuffer.ref.value,x=h.aTransform.ref.value,C=function(w,_){var E=w%4===0?b:S;return _<0?A.fromArray(y,E,w*3):A.transformMat4Offset(y,E,x,0,w*3,_*16),g};return Tn(m,v,2,C)}function l(p,h,m,v,g){var y=m.instanceCount,b=m.groupCount,S=u(p,h),x=Ds(m,S,v.color),C=Dd(m,v.size),w=xu(y*b),_=kd(),E=Rd(),P=Od(),D={drawCount:p.lineCount*2*3,vertexCount:p.lineCount*4,groupCount:b,instanceCount:y},k=He.clone(p.boundingSphere),F=ii(k,h.aTransform.ref.value,y);return T(T(T(T(T(T(T(T(T({aMapping:p.mappingBuffer,aGroup:p.groupBuffer,aStart:p.startBuffer,aEnd:p.endBuffer,elements:p.indexBuffer,boundingSphere:N.create(F),invariantBoundingSphere:N.create(k),uInvariantBoundingSphere:N.create(Mr.ofSphere(k))},x),C),w),_),E),P),h),Dt.createValues(g,D)),{uSizeFactor:N.create(g.sizeFactor),dLineSizeAttenuation:N.create(g.lineSizeAttenuation),dDoubleSided:N.create(!0),dFlipSided:N.create(!1)})}function c(p,h,m,v,g){var y=Dt.createSimple(m,v,g),b=T(T({},M.getDefaultValues(e.Params)),h);return l(p,y.transform,y.locationIterator,y.theme,b)}function d(p,h){Dt.updateValues(p,h),N.updateIfChanged(p.uSizeFactor,h.sizeFactor),N.updateIfChanged(p.dLineSizeAttenuation,h.lineSizeAttenuation)}function f(p,h){var m=He.clone(h.boundingSphere),v=ii(m,p.aTransform.ref.value,p.instanceCount.ref.value);He.equals(v,p.boundingSphere.ref.value)||N.update(p.boundingSphere,v),He.equals(m,p.invariantBoundingSphere.ref.value)||(N.update(p.invariantBoundingSphere,m),N.update(p.uInvariantBoundingSphere,Mr.fromSphere(p.uInvariantBoundingSphere.ref.value,m)))}})(Mn||(Mn={}));var eL=A(),tL=A(),rL=A();function Kw(e,t){for(var r=t.length,n=N0(r/3),a=0;a<r;a+=3)A.fromArray(eL,e,t[a]*3),A.fromArray(tL,e,t[a+1]*3),A.fromArray(rL,e,t[a+2]*3),n.add(eL,tL,rL);return n.getPrimitive()}var H2=A();function N0(e,t){t===void 0&&(t=e*3);var r=new Float32Array(t*3),n=new Float32Array(t*3),a=new Uint32Array(e*3),i=0,o=0;return{add:function(s,u,l){A.toArray(s,r,i),A.toArray(u,r,i+3),A.toArray(l,r,i+6),A.triangleNormal(H2,s,u,l);for(var c=0;c<3;++c)A.toArray(H2,n,i+3*c),a[o+c]=i/3+c;i+=9,o+=3},addQuad:function(s,u,l,c){A.toArray(s,r,i),A.toArray(u,r,i+3),A.toArray(l,r,i+6),A.toArray(c,r,i+9),A.triangleNormal(H2,s,u,l);for(var d=0;d<4;++d)A.toArray(H2,n,i+3*d);var f=i/3;a[o]=f,a[o+1]=f+1,a[o+2]=f+2,a[o+3]=f+2,a[o+4]=f+3,a[o+5]=f,i+=12,o+=6},getPrimitive:function(){return{vertices:r,normals:n,indices:a}}}}var $m=A(),Y3e=ia();function vk(e,t){for(var r=e.vertices,n=e.normals,a=ia.directionTransform(Y3e,t),i=0,o=r.length;i<o;i+=3)A.transformMat4($m,A.fromArray($m,r,i),t),A.toArray($m,r,i),A.transformMat3($m,A.fromArray($m,n,i),a),A.toArray($m,n,i);return e}function dc(e,t,r){r===void 0&&(r=-1);for(var n=new Float32Array(e*3),a=r===-1?e<=4?Math.sqrt(2)/2:.6:r,i=t?1:0,o=0,s=e;o<s;++o){var u=(o*2+i)/e*Math.PI;n[o*3]=Math.cos(u)*a,n[o*3+1]=Math.sin(u)*a,n[o*3+2]=0}return n}function gk(e,t){return{vertices:e,edges:t}}function UW(e){return{vertices:new Float32Array(e.vertices),edges:new Uint32Array(e.edges)}}var _A=A.zero();function VW(e,t){for(var r=e.vertices,n=0,a=r.length;n<a;n+=3)A.transformMat4(_A,A.fromArray(_A,r,n),t),A.toArray(_A,r,n);return e}var _c=A(),Ac=A(),Tc=A(),Qm=A(),da=dc(4,!0);function HW(e){for(var t=12,r=e?12*3:6*4,n=N0(t,r),a=0;a<4;++a){var i=(a+1)%4;A.set(_c,da[a*3],da[a*3+1],-.5),A.set(Ac,da[i*3],da[i*3+1],-.5),A.set(Tc,da[i*3],da[i*3+1],.5),A.set(Qm,da[a*3],da[a*3+1],.5),e?n.add(_c,Ac,Tc):n.addQuad(_c,Ac,Tc,Qm)}return A.set(_c,da[0],da[1],-.5),A.set(Ac,da[3],da[4],-.5),A.set(Tc,da[6],da[7],-.5),A.set(Qm,da[9],da[10],-.5),e?n.add(Tc,Ac,_c):n.addQuad(Qm,Tc,Ac,_c),A.set(_c,da[0],da[1],.5),A.set(Ac,da[3],da[4],.5),A.set(Tc,da[6],da[7],.5),A.set(Qm,da[9],da[10],.5),e?n.add(_c,Ac,Tc):n.addQuad(_c,Ac,Tc,Qm),n.getPrimitive()}var AA;function yk(){return AA||(AA=HW(!1)),AA}var TA;function K3e(){return TA||(TA=HW(!0)),TA}var EA;function jW(){return EA||(EA=gk([.5,.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5],[0,4,1,5,2,6,3,7,0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4])),EA}function nL(e){return e.map(function(t){return{x:t[0],alpha:t[1]}})}function aL(e,t,r){for(var n=Gt(Gt([{x:0,alpha:0},{x:0,alpha:0}],e),[{x:1,alpha:0},{x:1,alpha:0}]),a=nl.create({domain:[0,1],listOrName:t}),i=256,o=r?r.ref.value.array:new Uint8Array(i*4),s=0,u,l,c,d,f,p,h=e.length+1,m=0;m<h;++m){u=n[m+1].x,l=n[m+2].x,c=n[m].alpha,d=n[m+1].alpha,f=n[m+2].alpha,p=n[m+3].alpha;for(var v=Math.round((l-u)*i),g=0;g<v;++g){var y=g/v;o[s*4+3]=Math.max(0,oS(c,d,f,p,y,.5)*255),a.colorToArray(s/255,o,s*4),++s}}var b={array:o,width:256,height:1};return r?(N.update(r,b),r):N.create(b)}function $3e(e,t,r){if(r)return iL(e,t,r.min,r.max);var n=ss(e),a=n[0],i=n[1];return iL(e,t,a,i)}function iL(e,t,r,n){var a=(n-r)/t;a===0&&(a=1);for(var i=new Int32Array(t),o=0,s=e.length;o<s;o++){var u=Math.floor((e[o]-r)/a);u>=t?u=t-1:u<0&&(u=0),i[u]++}return{min:r,max:n,binWidth:a,counts:i}}var qi;(function(e){e.One={transform:{kind:"matrix",matrix:de.identity()},cells:Rr.create(Rr.Space([1,1,1],[0,1,2]),Rr.Data1([0])),stats:{min:0,max:0,mean:0,sigma:0}};var t=de.zero(),r=de.zero();function n(u){if(u.transform.kind==="matrix")return de.copy(de(),u.transform.matrix);if(u.transform.kind==="spacegroup"){var l=u.cells.space,c=de.fromScaling(t,A.div(A.zero(),tr.size(A.zero(),u.transform.fractionalBox),A.ofArray(l.dimensions))),d=de.fromTranslation(r,u.transform.fractionalBox.min);return de.mul3(de.zero(),u.transform.cell.fromFractional,d,c)}return de.identity()}e.getGridToCartesianTransform=n;function a(u,l){return u===l}e.areEquivalent=a;function i(u){return u.cells.data.length===0}e.isEmpty=i;function o(u,l){l||(l=He());var c=u.cells.space.dimensions,d=e.getGridToCartesianTransform(u);return He.fromDimensionsAndTransform(l,c,d)}e.getBoundingSphere=o;function s(u,l){var c=u._historams;return c||(c=u._historams={}),c[l]||(c[l]=$3e(u.cells.data,l,{min:u.stats.min,max:u.stats.max})),c[l]}e.getHistogram=s})(qi||(qi={}));function vu(e){return e}(function(e){function t(r){return r.__key||(r.__key=Cn.create22()),r.__key}e.getUUID=t})(vu||(vu={}));var fc=function(){function e(){this._list=[],this._set=new Set,this._refs=new Map,this._assets=new Map}return Object.defineProperty(e.prototype,"all",{get:function(){return this._list},enumerable:!1,configurable:!0}),e.prototype.add=function(t){this._set.has(t)||(this._list.push(t),this._set.add(t))},e.prototype.reference=function(t,r){var n=this._refs.get(t)||0;n+=r?1:-1,this._refs.set(t,Math.max(n,0))},e.prototype.hasReference=function(t){return(this._refs.get(t)||0)>0},e.prototype.has=function(t){return this._set.has(t)},e.prototype.assets=function(t,r){var n=this._assets.get(t);if(n)for(var a=0,i=n;a<i.length;a++){var o=i[a];o.dispose()}r?this._assets.set(t,r):this._assets.delete(t)},e.prototype.dispose=function(){this._assets.forEach(function(t){for(var r=0,n=t;r<n.length;r++){var a=n[r];a.dispose()}})},e}();function Q3e(e,t){var r=this;return Qe.create("Create Volume",function(){return pe(r,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d,f,p,h,m,v,g,y,b;return he(this,function(S){if(n=e.header,a=e.values,i=Rr.Space(n.dim,[0,1,2],Float64Array),n.dataSetIds.length===0)o=a;else for(s=n.dim,u=s[0],l=s[1],c=s[2],d=(t?.dataIndex||0)+1,f=0,p=0,o=new Float64Array(u*l*c),h=0;h<u;h++)for(m=0;m<l;m++)for(v=0;v<c;v++)o[f++]=a[p],p+=d;return g=Rr.create(i,Rr.Data1(o)),y=de.fromTranslation(de(),n.origin),b=de.fromBasis(de(),n.basisX,n.basisY,n.basisZ),de.mul(y,y,b),[2,{label:t?.label,entryId:t?.entryId,grid:{transform:{kind:"matrix",matrix:y},cells:g,stats:{min:Uw(o),max:nc(o),mean:Vw(o),sigma:Hw(o)}},sourceData:FC.create(e),customProperties:new fc,_propertyData:Object.create(null)}]})})})}var FC;(function(e){function t(n){return n?.kind==="cube"}e.is=t;function r(n){return{kind:"cube",name:n.name,data:n}}e.create=r})(FC||(FC={}));var It;(function(e){function t(f){var p,h,m,v;return((v=(m=(h=(p=f?.grid)===null||p===void 0?void 0:p.cells)===null||h===void 0?void 0:h.space)===null||m===void 0?void 0:m.dimensions)===null||v===void 0?void 0:v.length)&&f?.sourceData&&f?.customProperties&&f?._propertyData}e.is=t,function(f){function p(x,C,w){return Hn(y(x,w).absoluteValue,y(C,w).absoluteValue,w.sigma/100)}f.areSame=p;function h(x){return{kind:"absolute",absoluteValue:x}}f.absolute=h;function m(x){return{kind:"relative",relativeValue:x}}f.relative=m;function v(x,C){return C*x.sigma+x.mean}f.calcAbsolute=v;function g(x,C){return x.sigma===0?0:(C-x.mean)/x.sigma}f.calcRelative=g;function y(x,C){return x.kind==="absolute"?x:{kind:"absolute",absoluteValue:f.calcAbsolute(C,x.relativeValue)}}f.toAbsolute=y;function b(x,C){return x.kind==="relative"?x:{kind:"relative",relativeValue:f.calcRelative(C,x.absoluteValue)}}f.toRelative=b;function S(x){return x.kind==="relative"?x.relativeValue.toFixed(2)+" \u03C3":""+x.absoluteValue.toPrecision(4)}f.toString=S}(e.IsoValue||(e.IsoValue={}));var r={min:-1,max:1,mean:0,sigma:.1};function n(f,p){var h=p||r,m=h.min,v=h.max,g=h.mean,y=h.sigma,b=(m-g)/y,S=(v-g)/y,x=f;return f.kind==="absolute"?f.absoluteValue<m?x=e.IsoValue.absolute(m):f.absoluteValue>v&&(x=e.IsoValue.absolute(v)):f.relativeValue<b?x=e.IsoValue.relative(b):f.relativeValue>S&&(x=e.IsoValue.relative(S)),M.Conditioned(x,{absolute:M.Converted(function(C){return e.IsoValue.toAbsolute(C,qi.One.stats).absoluteValue},function(C){return e.IsoValue.absolute(C)},M.Numeric(g,{min:m,max:v,step:e5(y/100,2)})),relative:M.Converted(function(C){return e.IsoValue.toRelative(C,qi.One.stats).relativeValue},function(C){return e.IsoValue.relative(C)},M.Numeric(Math.min(1,S),{min:b,max:S,step:e5(Math.round((v-m)/y)/100,2)}))},function(C){return C.kind==="absolute"?"absolute":"relative"},function(C,w){return w==="absolute"?e.IsoValue.toAbsolute(C,h):e.IsoValue.toRelative(C,h)},{isEssential:!0})}e.createIsoValueParam=n,e.IsoValueParam=n(e.IsoValue.relative(2)),e.One={label:"",grid:qi.One,sourceData:{kind:"",name:"",data:{}},customProperties:new fc,_propertyData:Object.create(null)};function a(f,p){return qi.areEquivalent(f.grid,p.grid)}e.areEquivalent=a;function i(f){return qi.isEmpty(f.grid)}e.isEmpty=i;function o(f){return FC.is(f.sourceData)?f.sourceData.data.header.orbitals:!1}e.isOrbitals=o;function s(f){return{kind:"volume-loci",volume:f}}e.Loci=s;function u(f){return!!f&&f.kind==="volume-loci"}e.isLoci=u;function l(f,p){return f.volume===p.volume}e.areLociEqual=l;function c(f){return qi.isEmpty(f.volume.grid)}e.isLociEmpty=c;function d(f,p){return qi.getBoundingSphere(f.grid,p)}e.getBoundingSphere=d,function(f){function p(y,b){return{kind:"isosurface-loci",volume:y,isoValue:b}}f.Loci=p;function h(y){return!!y&&y.kind==="isosurface-loci"}f.isLoci=h;function m(y,b){return y.volume===b.volume&&e.IsoValue.areSame(y.isoValue,b.isoValue,y.volume.grid.stats)}f.areLociEqual=m;function v(y){return y.volume.grid.cells.data.length===0}f.isLociEmpty=v;function g(y,b,S){return e.getBoundingSphere(y,S)}f.getBoundingSphere=g}(e.Isosurface||(e.Isosurface={})),function(f){function p(S,x){return{kind:"cell-loci",volume:S,indices:x}}f.Loci=p;function h(S){return!!S&&S.kind==="cell-loci"}f.isLoci=h;function m(S,x){return S.volume===x.volume&&Ne.areEqual(S.indices,x.indices)}f.areLociEqual=m;function v(S){return Ne.size(S.indices)===0}f.isLociEmpty=v;var g=new Ms("98"),y=A();function b(S,x,C){g.reset();for(var w=qi.getGridToCartesianTransform(S.grid),_=S.grid.cells.space.getCoords,E=0,P=Ne.size(x);E<P;E++){var D=Ne.getAt(x,E);_(D,y),A.transformMat4(y,y,w),g.includePosition(y)}g.finishedIncludeStep();for(var E=0,P=Ne.size(x);E<P;E++){var D=Ne.getAt(x,E);_(D,y),A.transformMat4(y,y,w),g.radiusPosition(y)}var k=g.getSphere(C);return He.expand(k,k,de.getMaxScaleOnAxis(w)*10)}f.getBoundingSphere=b}(e.Cell||(e.Cell={}))})(It||(It={}));var PA=yk(),bo;(function(e){function t(y,b,S,x,C,w,_,E,P){return P?a(y,b,S,x,C,w,_,E,P):n(y,b,S,x,C,w,_,E)}e.create=t;function r(y){return eo([y.bboxSize.ref.version,y.gridDimension.ref.version,y.gridTexture.ref.version,y.transform.ref.version,y.gridStats.ref.version])}function n(y,b,S,x,C,w,_,E){var P=He(),D=-1,k=w.getWidth(),F=w.getHeight(),X=w.getDepth(),U={kind:"direct-volume",gridDimension:N.create(b),gridTexture:N.create(w),gridTextureDim:N.create(A.create(k,F,X)),gridStats:N.create(Mr.create(_.min,_.max,_.mean,_.sigma)),bboxMin:N.create(y.min),bboxMax:N.create(y.max),bboxSize:N.create(A.sub(A(),y.max,y.min)),transform:N.create(S),cellDim:N.create(C),unitToCartn:N.create(x),cartnToUnit:N.create(de.invert(de(),x)),get boundingSphere(){var j=r(U);if(j!==D){var te=Z3e(U.gridDimension.ref.value,U.transform.ref.value);He.copy(P,te),D=j}return P},packedGroup:N.create(E),setBoundingSphere:function(j){He.copy(P,j),D=r(U)}};return U}function a(y,b,S,x,C,w,_,E,P){var D=w.getWidth(),k=w.getHeight(),F=w.getDepth();return N.update(P.gridDimension,b),N.update(P.gridTexture,w),N.update(P.gridTextureDim,A.set(P.gridTextureDim.ref.value,D,k,F)),N.update(P.gridStats,Mr.set(P.gridStats.ref.value,_.min,_.max,_.mean,_.sigma)),N.update(P.bboxMin,y.min),N.update(P.bboxMax,y.max),N.update(P.bboxSize,A.sub(P.bboxSize.ref.value,y.max,y.min)),N.update(P.transform,S),N.update(P.cellDim,C),N.update(P.unitToCartn,x),N.update(P.cartnToUnit,de.invert(de(),x)),N.updateIfChanged(P.packedGroup,E),P}function i(y){return{}}e.createEmpty=i;function o(y){var b=y?It.createIsoValueParam(It.IsoValue.relative(2),y):It.IsoValueParam;return M.MappedStatic("volume",{isosurface:M.Group({isoValue:b,singleLayer:M.Boolean(!1,{isEssential:!0})},{isFlat:!0}),volume:M.Group({controlPoints:M.LineGraph([Xe.create(.19,0),Xe.create(.2,.05),Xe.create(.25,.05),Xe.create(.26,0),Xe.create(.79,0),Xe.create(.8,.05),Xe.create(.85,.05),Xe.create(.86,0)]),list:M.ColorList({kind:"interpolate",colors:[[gr.white,0],[gr.red,.25],[gr.white,.5],[gr.blue,.75],[gr.white,1]]},{offsets:!0})},{isFlat:!0})},{isEssential:!0})}e.createRenderModeParam=o,e.Params=T(T({},Dt.Params),{doubleSided:M.Boolean(!1,Dt.CustomQualityParamInfo),flipSided:M.Boolean(!1,Dt.ShadingCategory),flatShaded:M.Boolean(!1,Dt.ShadingCategory),ignoreLight:M.Boolean(!1,Dt.ShadingCategory),xrayShaded:M.Boolean(!1,Dt.ShadingCategory),renderMode:o(),stepsPerCell:M.Numeric(5,{min:1,max:20,step:1}),jumpLength:M.Numeric(0,{min:0,max:20,step:.1})}),e.Utils={Params:e.Params,createEmpty:i,createValues:f,createValuesSimple:p,updateValues:h,updateBoundingSphere:m,createRenderableState:v,updateRenderableState:g,createPositionIterator:s};function s(y,b){var S=y.transform.ref.value,x=y.gridDimension.ref.value,C=x[0],w=x[1],_=x[2],E=C*w*_,P=b.instanceCount.ref.value,D=Am(),k=D.position,F=b.aTransform.ref.value,X=function(U,j){var te=Math.floor(U/_);return k[0]=Math.floor(te/w),k[1]=te%w,k[2]=U%_,A.transformMat4(k,k,S),j>=0&&A.transformMat4Offset(k,k,F,0,0,j*16),D};return Tn(E,P,1,X)}function u(y,b,S){var x=S[0],C=S[1],w=S[2],_=S[3],E=It.IsoValue.toAbsolute(b,{min:x,max:C,mean:w,sigma:_}).absoluteValue;return Xe.set(y,(E-x)/(C-x),(0-x)/(C-x)),y}function l(y,b){return Math.ceil(A.magnitude(y)*b)}function c(y,b){return Math.min.apply(Math,y)*(1/b)}function d(y){return 1/y}function f(y,b,S,x,C){var w=y.gridTexture,_=y.gridTextureDim,E=y.gridStats,P=y.bboxSize,D=y.bboxMin,k=y.bboxMax,F=y.gridDimension,X=y.transform,U=S.instanceCount,j=S.groupCount,te=e.Utils.createPositionIterator(y,b),q=Ds(S,te,x.color),W=xu(U*j),V=kd(),ee=Rd(),ue=Od(),$=F.ref.value,Q=$[0],R=$[1],Y=$[2],re={drawCount:PA.indices.length,vertexCount:Q*R*Y,groupCount:j,instanceCount:U},K=He.clone(y.boundingSphere),L=ii(K,b.aTransform.ref.value,U),H=C.renderMode.name==="volume"?nL(C.renderMode.params.controlPoints):[],Z=aL(H,C.renderMode.name==="volume"?C.renderMode.params.list.colors:[]),fe=C.renderMode.name==="isosurface"?C.renderMode.params.isoValue:It.IsoValue.relative(2),me=C.renderMode.name==="isosurface"?C.renderMode.params.singleLayer:!1;return T(T(T(T(T(T(T(T({},q),W),V),ee),ue),b),Dt.createValues(C,re)),{aPosition:N.create(PA.vertices),elements:N.create(PA.indices),boundingSphere:N.create(L),invariantBoundingSphere:N.create(K),uInvariantBoundingSphere:N.create(Mr.ofSphere(K)),uIsoValue:N.create(u(Xe(),fe,y.gridStats.ref.value)),uBboxMin:D,uBboxMax:k,uBboxSize:P,uMaxSteps:N.create(l(F.ref.value,C.stepsPerCell)),uStepScale:N.create(c(y.cellDim.ref.value,C.stepsPerCell)),uJumpLength:N.create(C.jumpLength),uTransform:X,uGridDim:F,dRenderMode:N.create(C.renderMode.name),tTransferTex:Z,uTransferScale:N.create(d(C.stepsPerCell)),dGridTexType:N.create(w.ref.value.getDepth()>0?"3d":"2d"),uGridTexDim:_,tGridTex:w,uGridStats:E,uCellDim:y.cellDim,uCartnToUnit:y.cartnToUnit,uUnitToCartn:y.unitToCartn,dPackedGroup:y.packedGroup,dSingleLayer:N.create(me),dDoubleSided:N.create(C.doubleSided),dFlatShaded:N.create(C.flatShaded),dFlipSided:N.create(C.flipSided),dIgnoreLight:N.create(C.ignoreLight),dXrayShaded:N.create(C.xrayShaded)})}function p(y,b,S,x,C){var w=Dt.createSimple(S,x,C),_=T(T({},M.getDefaultValues(e.Params)),b);return f(y,w.transform,w.locationIterator,w.theme,_)}function h(y,b){if(N.updateIfChanged(y.alpha,b.alpha),N.updateIfChanged(y.uAlpha,b.alpha),N.updateIfChanged(y.dDoubleSided,b.doubleSided),N.updateIfChanged(y.dFlatShaded,b.flatShaded),N.updateIfChanged(y.dFlipSided,b.flipSided),N.updateIfChanged(y.dIgnoreLight,b.ignoreLight),N.updateIfChanged(y.dXrayShaded,b.xrayShaded),N.updateIfChanged(y.dRenderMode,b.renderMode.name),b.renderMode.name==="isosurface")N.updateIfChanged(y.uIsoValue,u(y.uIsoValue.ref.value,b.renderMode.params.isoValue,y.uGridStats.ref.value)),N.updateIfChanged(y.dSingleLayer,b.renderMode.params.singleLayer);else if(b.renderMode.name==="volume"){var S=nL(b.renderMode.params.controlPoints);aL(S,b.renderMode.params.list.colors,y.tTransferTex)}N.updateIfChanged(y.uMaxSteps,l(y.uGridDim.ref.value,b.stepsPerCell)),N.updateIfChanged(y.uStepScale,c(y.uCellDim.ref.value,b.stepsPerCell)),N.updateIfChanged(y.uTransferScale,d(b.stepsPerCell)),N.updateIfChanged(y.uJumpLength,b.jumpLength)}function m(y,b){var S=He.clone(b.boundingSphere),x=ii(S,y.aTransform.ref.value,y.instanceCount.ref.value);He.equals(x,y.boundingSphere.ref.value)||N.update(y.boundingSphere,x),He.equals(S,y.invariantBoundingSphere.ref.value)||(N.update(y.invariantBoundingSphere,S),N.update(y.uInvariantBoundingSphere,Mr.fromSphere(y.uInvariantBoundingSphere.ref.value,S)))}function v(y){var b=Dt.createRenderableState(y);return b.opaque=!1,b.writeDepth=y.renderMode.name==="isosurface",b}function g(y,b){Dt.updateRenderableState(y,b),y.opaque=!1,y.writeDepth=b.renderMode.name==="isosurface"}})(bo||(bo={}));function Z3e(e,t){return He.fromDimensionsAndTransform(He(),e,t)}var om;(function(e){function t(p,h,m,v,g,y){return y?i(p,h,m,v,g,y):a(p,h,m,v,g)}e.create=t;function r(p){var h=p?p.centerBuffer.ref.value:new Float32Array(0),m=p?p.mappingBuffer.ref.value:new Float32Array(0),v=p?p.indexBuffer.ref.value:new Uint32Array(0),g=p?p.groupBuffer.ref.value:new Float32Array(0);return t(h,m,v,g,0,p)}e.createEmpty=r;function n(p){return eo([p.sphereCount,p.centerBuffer.ref.version,p.mappingBuffer.ref.version,p.indexBuffer.ref.version,p.groupBuffer.ref.version])}function a(p,h,m,v,g){var y=He(),b,S=-1,x=-1,C={kind:"spheres",sphereCount:g,centerBuffer:N.create(p),mappingBuffer:N.create(h),indexBuffer:N.create(m),groupBuffer:N.create(v),get boundingSphere(){var w=n(C);if(w!==S){var _=xp(C.centerBuffer.ref.value,C.sphereCount*4,4);He.copy(y,_),S=w}return y},get groupMapping(){return C.groupBuffer.ref.version!==x&&(b=L0(C.groupBuffer.ref.value,C.sphereCount,4),x=C.groupBuffer.ref.version),b},setBoundingSphere:function(w){He.copy(y,w),S=n(C)}};return C}function i(p,h,m,v,g,y){return g>y.sphereCount&&(N.update(y.mappingBuffer,h),N.update(y.indexBuffer,m)),y.sphereCount=g,N.update(y.centerBuffer,p),N.update(y.groupBuffer,v),y}e.Params=T(T({},Dt.Params),{sizeFactor:M.Numeric(1,{min:0,max:10,step:.1}),doubleSided:M.Boolean(!1,Dt.CustomQualityParamInfo),ignoreLight:M.Boolean(!1,Dt.ShadingCategory),xrayShaded:M.Boolean(!1,Dt.ShadingCategory)}),e.Utils={Params:e.Params,createEmpty:r,createValues:s,createValuesSimple:u,updateValues:l,updateBoundingSphere:c,createRenderableState:d,updateRenderableState:f,createPositionIterator:o};function o(p,h){var m=p.sphereCount*4,v=h.instanceCount.ref.value,g=Am(),y=g.position,b=p.centerBuffer.ref.value,S=h.aTransform.ref.value,x=function(C,w){return w<0?A.fromArray(y,b,C*3):A.transformMat4Offset(y,b,S,0,C*3,w*16),g};return Tn(m,v,4,x)}function s(p,h,m,v,g){var y=m.instanceCount,b=m.groupCount;if(y!==h.instanceCount.ref.value)throw new Error("instanceCount values in TransformData and LocationIterator differ");var S=o(p,h),x=Ds(m,S,v.color),C=Dd(m,v.size),w=xu(y*b),_=kd(),E=Rd(),P=Od(),D={drawCount:p.sphereCount*2*3,vertexCount:p.sphereCount*4,groupCount:b,instanceCount:y},k=p.boundingSphere.radius?R1(C)*g.sizeFactor:0,F=He.expand(He(),p.boundingSphere,k),X=ii(F,h.aTransform.ref.value,y);return T(T(T(T(T(T(T(T(T(T({aPosition:p.centerBuffer,aMapping:p.mappingBuffer,aGroup:p.groupBuffer,elements:p.indexBuffer,boundingSphere:N.create(X),invariantBoundingSphere:N.create(F),uInvariantBoundingSphere:N.create(Mr.ofSphere(F))},x),C),w),_),E),P),h),{padding:N.create(k)}),Dt.createValues(g,D)),{uSizeFactor:N.create(g.sizeFactor),dDoubleSided:N.create(g.doubleSided),dIgnoreLight:N.create(g.ignoreLight),dXrayShaded:N.create(g.xrayShaded)})}function u(p,h,m,v,g){var y=Dt.createSimple(m,v,g),b=T(T({},M.getDefaultValues(e.Params)),h);return s(p,y.transform,y.locationIterator,y.theme,b)}function l(p,h){Dt.updateValues(p,h),N.updateIfChanged(p.uSizeFactor,h.sizeFactor),N.updateIfChanged(p.dDoubleSided,h.doubleSided),N.updateIfChanged(p.dIgnoreLight,h.ignoreLight),N.updateIfChanged(p.dXrayShaded,h.xrayShaded)}function c(p,h){var m=h.boundingSphere.radius?R1(p)*p.uSizeFactor.ref.value:0,v=He.expand(He(),h.boundingSphere,m),g=ii(v,p.aTransform.ref.value,p.instanceCount.ref.value);He.equals(g,p.boundingSphere.ref.value)||N.update(p.boundingSphere,g),He.equals(v,p.invariantBoundingSphere.ref.value)||(N.update(p.invariantBoundingSphere,v),N.update(p.uInvariantBoundingSphere,Mr.fromSphere(p.uInvariantBoundingSphere.ref.value,v))),N.update(p.padding,m)}function d(p){var h=Dt.createRenderableState(p);return f(h,p),h}function f(p,h){Dt.updateRenderableState(p,h),p.opaque=p.opaque&&!h.xrayShaded,p.writeDepth=p.opaque}})(om||(om={}));var il;(function(e){var t=function(){function u(){this.index=0,this.textures=[]}return u.prototype.get=function(){return this.textures[this.index]},u.prototype.set=function(l,c,d){this.textures[this.index]=Object.assign(this.textures[this.index]||{},{vertex:l,group:c,normal:d}),this.index=(this.index+1)%2},u.prototype.destroy=function(){for(var l=0,c=this.textures;l<c.length;l++){var d=c[l];d.vertex.destroy(),d.group.destroy(),d.normal.destroy()}},u}();e.DoubleBuffer=t;function r(u,l,c,d,f,p,h){var m=c.getWidth(),v=c.getHeight();return h?(h.vertexCount=u,h.groupCount=l,N.update(h.geoTextureDim,Xe.set(h.geoTextureDim.ref.value,m,v)),N.update(h.vertexTexture,c),N.update(h.groupTexture,d),N.update(h.normalTexture,f),h.doubleBuffer.set(c,d,f),He.copy(h.boundingSphere,p),h):{kind:"texture-mesh",vertexCount:u,groupCount:l,geoTextureDim:N.create(Xe.create(m,v)),vertexTexture:N.create(c),groupTexture:N.create(d),normalTexture:N.create(f),doubleBuffer:new t,boundingSphere:He.clone(p)}}e.create=r;function n(u){return{}}e.createEmpty=n,e.Params=T(T({},Dt.Params),{doubleSided:M.Boolean(!1,Dt.CustomQualityParamInfo),flipSided:M.Boolean(!1,Dt.ShadingCategory),flatShaded:M.Boolean(!1,Dt.ShadingCategory),ignoreLight:M.Boolean(!1,Dt.ShadingCategory),xrayShaded:M.Boolean(!1,Dt.ShadingCategory)}),e.Utils={Params:e.Params,createEmpty:n,createValues:a,createValuesSimple:i,updateValues:o,updateBoundingSphere:s,createRenderableState:Dt.createRenderableState,updateRenderableState:Dt.updateRenderableState,createPositionIterator:function(){return Tn(1,1,1,function(){return ws})}};function a(u,l,c,d,f){var p=c.instanceCount,h=c.groupCount,m=e.Utils.createPositionIterator(u,l),v=Ds(c,m,d.color),g=xu(p*h),y=kd(),b=Rd(),S=Od(),x={drawCount:u.vertexCount,vertexCount:u.vertexCount,groupCount:h,instanceCount:p},C=He.clone(u.boundingSphere),w=ii(C,l.aTransform.ref.value,p);return T(T(T(T(T(T(T(T({uGeoTexDim:u.geoTextureDim,tPosition:u.vertexTexture,tGroup:u.groupTexture,tNormal:u.normalTexture,boundingSphere:N.create(w),invariantBoundingSphere:N.create(C),uInvariantBoundingSphere:N.create(Mr.ofSphere(C))},v),g),y),b),S),l),Dt.createValues(f,x)),{dDoubleSided:N.create(f.doubleSided),dFlatShaded:N.create(f.flatShaded),dFlipSided:N.create(f.flipSided),dIgnoreLight:N.create(f.ignoreLight),dXrayShaded:N.create(f.xrayShaded),dGeoTexture:N.create(!0)})}function i(u,l,c,d,f){var p=Dt.createSimple(c,d,f),h=T(T({},M.getDefaultValues(e.Params)),l);return a(u,p.transform,p.locationIterator,p.theme,h)}function o(u,l){Dt.updateValues(u,l),N.updateIfChanged(u.dDoubleSided,l.doubleSided),N.updateIfChanged(u.dFlatShaded,l.flatShaded),N.updateIfChanged(u.dFlipSided,l.flipSided),N.updateIfChanged(u.dIgnoreLight,l.ignoreLight),N.updateIfChanged(u.dXrayShaded,l.xrayShaded)}function s(u,l){var c=He.clone(l.boundingSphere),d=ii(c,u.aTransform.ref.value,u.instanceCount.ref.value);He.equals(d,u.boundingSphere.ref.value)||N.update(u.boundingSphere,d),He.equals(c,u.invariantBoundingSphere.ref.value)||(N.update(u.invariantBoundingSphere,c),N.update(u.uInvariantBoundingSphere,Mr.fromSphere(u.uInvariantBoundingSphere.ref.value,c)))}})(il||(il={}));function J3e(e,t){var r={},n={},a={},i={},o={},s={};return Object.keys(e).forEach(function(u){var l=e[u];l.type==="attribute"&&(r[u]=t[u]),l.type==="define"&&(n[u]=t[u]),l.type==="texture"&&t[u]!==void 0&&(a[u]=t[u]),l.type==="uniform"&&t[u]!==void 0&&(l.variant==="material"?o[u]=t[u]:l.variant==="buffered"?s[u]=t[u]:i[u]=t[u])}),{attributeValues:r,defineValues:n,textureValues:a,uniformValues:i,materialUniformValues:o,bufferedUniformValues:s}}function ewe(e){var t={};return Object.keys(e).forEach(function(r){t[r]=e[r].ref.version}),t}function Zr(e,t,r){return{type:"attribute",kind:e,itemSize:t,divisor:r}}function Ye(e,t){return{type:"uniform",kind:e,variant:t}}function hr(e,t,r,n){return{type:"texture",kind:e,format:t,dataType:r,filter:n}}function Tm(e){return{type:"elements",kind:e}}function nr(e,t){return{type:"define",kind:e,options:t}}function Ra(e){return{type:"value",kind:e}}var Bd={uModel:Ye("m4"),uView:Ye("m4"),uInvView:Ye("m4"),uModelView:Ye("m4"),uInvModelView:Ye("m4"),uProjection:Ye("m4"),uInvProjection:Ye("m4"),uModelViewProjection:Ye("m4"),uInvModelViewProjection:Ye("m4"),uIsOrtho:Ye("f"),uPixelRatio:Ye("f"),uViewportHeight:Ye("f"),uViewport:Ye("v4"),uViewOffset:Ye("v2"),uDrawingBufferSize:Ye("v2"),uCameraPosition:Ye("v3"),uCameraDir:Ye("v3"),uNear:Ye("f"),uFar:Ye("f"),uFogNear:Ye("f"),uFogFar:Ye("f"),uFogColor:Ye("v3"),uTransparentBackground:Ye("b"),uClipObjectType:Ye("i[]"),uClipObjectInvert:Ye("b[]"),uClipObjectPosition:Ye("v3[]"),uClipObjectRotation:Ye("v4[]"),uClipObjectScale:Ye("v3[]"),uLightIntensity:Ye("f"),uAmbientIntensity:Ye("f"),uMetalness:Ye("f"),uRoughness:Ye("f"),uReflectivity:Ye("f"),uPickingAlphaThreshold:Ye("f"),uInteriorDarkening:Ye("f"),uInteriorColorFlag:Ye("b"),uInteriorColor:Ye("v3"),uHighlightColor:Ye("v3"),uSelectColor:Ye("v3"),uXrayEdgeFalloff:Ye("f"),uRenderWboit:Ye("b")},Fd={tDepth:hr("texture","depth","ushort","nearest")},Ld={uObjectId:Ye("i")},twe={uColor:Ye("v3","material"),uColorTexDim:Ye("v2"),uColorGridDim:Ye("v3"),uColorGridTransform:Ye("v4"),tColor:hr("image-uint8","rgb","ubyte","nearest"),tPalette:hr("image-uint8","rgb","ubyte","nearest"),tColorGrid:hr("texture","rgb","ubyte","linear"),dColorType:nr("string",["uniform","attribute","instance","group","groupInstance","vertex","vertexInstance","volume","volumeInstance"]),dUsePalette:nr("boolean")},mb={uSize:Ye("f","material"),uSizeTexDim:Ye("v2"),tSize:hr("image-uint8","rgb","ubyte","nearest"),dSizeType:nr("string",["uniform","attribute","instance","group","groupInstance"]),uSizeFactor:Ye("f")},rwe={uMarkerTexDim:Ye("v2"),tMarker:hr("image-uint8","alpha","ubyte","nearest")},nwe={uOverpaintTexDim:Ye("v2"),tOverpaint:hr("image-uint8","rgba","ubyte","nearest"),dOverpaint:nr("boolean")},awe={uTransparencyTexDim:Ye("v2"),tTransparency:hr("image-uint8","alpha","ubyte","nearest"),dTransparency:nr("boolean"),transparencyAverage:Ra("number")},iwe={dClipObjectCount:nr("number"),dClipVariant:nr("string",["instance","pixel"]),uClippingTexDim:Ye("v2"),tClipping:hr("image-uint8","alpha","ubyte","nearest"),dClipping:nr("boolean")},Nd=T(T(T(T(T(T({},twe),rwe),nwe),awe),iwe),{aInstance:Zr("float32",1,1),aTransform:Zr("float32",16,1),uAlpha:Ye("f","material"),uVertexCount:Ye("i"),uInstanceCount:Ye("i"),uGroupCount:Ye("i"),uInvariantBoundingSphere:Ye("v4"),drawCount:Ra("number"),instanceCount:Ra("number"),alpha:Ra("number"),matrix:Ra("m4"),transform:Ra("float32"),extraTransform:Ra("float32"),hasReflection:Ra("boolean"),boundingSphere:Ra("sphere"),invariantBoundingSphere:Ra("sphere")}),GW=new Float32Array([1,1,-1,1,-1,-1,-1,-1,1,-1,1,1]),Ni={drawCount:Ra("number"),instanceCount:Ra("number"),aPosition:Zr("float32",2,0),uQuadScale:Ye("v2")},zi={drawCount:N.create(6),instanceCount:N.create(1),aPosition:N.create(GW),uQuadScale:N.create(Xe.create(1,1))},oL=new Uint32Array([0,1,2,1,3,2]),owe=new Float32Array([0,1,0,0,1,1,1,0]),qW={nearest:"Nearest",catmulrom:"Catmulrom (Cubic)",mitchell:"Mitchell (Cubic)",bspline:"B-Spline (Cubic)"},swe=Object.keys(qW),yd;(function(e){function t(f,p,h,m){return m?a(f,p,h,m):n(f,p,h)}e.create=t;function r(f){return eo([f.cornerBuffer.ref.version])}function n(f,p,h){var m=He(),v=-1,g=f.width,y=f.height,b={kind:"image",imageTexture:N.create(f),imageTextureDim:N.create(Xe.create(g,y)),cornerBuffer:N.create(p),groupTexture:N.create(h),get boundingSphere(){var S=r(b);if(S!==v){var x=uwe(b.cornerBuffer.ref.value);He.copy(m,x),v=S}return m}};return b}function a(f,p,h,m){var v=f.width,g=f.height;return N.update(m.imageTexture,f),N.update(m.imageTextureDim,Xe.set(m.imageTextureDim.ref.value,v,g)),N.update(m.cornerBuffer,p),N.update(m.groupTexture,h),m}function i(f){return{}}e.createEmpty=i,e.Params=T(T({},Dt.Params),{interpolation:M.Select("bspline",M.objectToOptions(qW))}),e.Utils={Params:e.Params,createEmpty:i,createValues:o,createValuesSimple:s,updateValues:u,updateBoundingSphere:l,createRenderableState:c,updateRenderableState:d,createPositionIterator:function(){return Tn(1,1,1,function(){return ws})}};function o(f,p,h,m,v){var g=h.instanceCount,y=h.groupCount,b=e.Utils.createPositionIterator(f,p),S=Ds(h,b,m.color),x=xu(g*y),C=kd(),w=Rd(),_=Od(),E={drawCount:oL.length,vertexCount:GW.length/3,groupCount:y,instanceCount:g},P=He.clone(f.boundingSphere),D=ii(P,p.aTransform.ref.value,g);return T(T(T(T(T(T(T(T({},S),x),C),w),_),p),Dt.createValues(v,E)),{aPosition:f.cornerBuffer,aUv:N.create(owe),elements:N.create(oL),aGroup:N.create(pu(new Float32Array(4))),boundingSphere:N.create(D),invariantBoundingSphere:N.create(P),uInvariantBoundingSphere:N.create(Mr.ofSphere(P)),dInterpolation:N.create(v.interpolation),uImageTexDim:f.imageTextureDim,tImageTex:f.imageTexture,tGroupTex:f.groupTexture})}function s(f,p,h,m,v){var g=Dt.createSimple(h,m,v),y=T(T({},M.getDefaultValues(e.Params)),p);return o(f,g.transform,g.locationIterator,g.theme,y)}function u(f,p){Dt.updateValues(f,p),N.updateIfChanged(f.dInterpolation,p.interpolation)}function l(f,p){var h=He.clone(p.boundingSphere),m=ii(h,f.aTransform.ref.value,f.instanceCount.ref.value);He.equals(m,f.boundingSphere.ref.value)||N.update(f.boundingSphere,m),He.equals(h,f.invariantBoundingSphere.ref.value)||(N.update(f.invariantBoundingSphere,h),N.update(f.uInvariantBoundingSphere,Mr.fromSphere(f.uInvariantBoundingSphere.ref.value,h)))}function c(f){var p=Dt.createRenderableState(f);return p.opaque=!1,p}function d(f,p){Dt.updateRenderableState(f,p),f.opaque=!1}})(yd||(yd={}));function uwe(e){for(var t=A(),r=[],n=0,a=e.length;n<a;n+=3){var i=A.fromArray(A(),e,n);r.push(i),A.add(t,t,i)}A.scale(t,t,1/(e.length/3));for(var o=0,s=0,u=r;s<u.length;s++){var i=u[s],l=A.distance(t,i);l>o&&(o=l)}var c=He.create(t,o);return He.setExtrema(c,r),c}var su;(function(e){function t(h,m,v,g,y,b,S,x,C){return C?i(h,m,v,g,y,b,S,x,C):a(h,m,v,g,y,b,S,x)}e.create=t;function r(h){var m=h?h.mappingBuffer.ref.value:new Float32Array(0),v=h?h.indexBuffer.ref.value:new Uint32Array(0),g=h?h.groupBuffer.ref.value:new Float32Array(0),y=h?h.startBuffer.ref.value:new Float32Array(0),b=h?h.endBuffer.ref.value:new Float32Array(0),S=h?h.scaleBuffer.ref.value:new Float32Array(0),x=h?h.capBuffer.ref.value:new Float32Array(0);return t(m,v,g,y,b,S,x,0,h)}e.createEmpty=r;function n(h){return eo([h.cylinderCount,h.mappingBuffer.ref.version,h.indexBuffer.ref.version,h.groupBuffer.ref.version,h.startBuffer.ref.version,h.endBuffer.ref.version,h.scaleBuffer.ref.version,h.capBuffer.ref.version])}function a(h,m,v,g,y,b,S,x){var C=He(),w,_=-1,E=-1,P={kind:"cylinders",cylinderCount:x,mappingBuffer:N.create(h),indexBuffer:N.create(m),groupBuffer:N.create(v),startBuffer:N.create(g),endBuffer:N.create(y),scaleBuffer:N.create(b),capBuffer:N.create(S),get boundingSphere(){var D=n(P);if(D!==_){var k=xp(P.startBuffer.ref.value,P.cylinderCount*6,6),F=xp(P.endBuffer.ref.value,P.cylinderCount*6,6);He.expandBySphere(C,k,F),_=D}return C},get groupMapping(){return P.groupBuffer.ref.version!==E&&(w=L0(P.groupBuffer.ref.value,P.cylinderCount,6),E=P.groupBuffer.ref.version),w},setBoundingSphere:function(D){He.copy(C,D),_=n(P)}};return P}function i(h,m,v,g,y,b,S,x,C){return x>C.cylinderCount&&(N.update(C.mappingBuffer,h),N.update(C.indexBuffer,m)),C.cylinderCount=x,N.update(C.groupBuffer,v),N.update(C.startBuffer,g),N.update(C.endBuffer,y),N.update(C.scaleBuffer,b),N.update(C.capBuffer,S),C}function o(h,m){var v=h.startBuffer.ref.value;am(m,v,0,h.cylinderCount*6),N.update(h.startBuffer,v);var g=h.endBuffer.ref.value;am(m,g,0,h.cylinderCount*6),N.update(h.endBuffer,g)}e.transform=o,e.Params=T(T({},Dt.Params),{sizeFactor:M.Numeric(1,{min:0,max:10,step:.1}),sizeAspectRatio:M.Numeric(1,{min:0,max:3,step:.01}),doubleSided:M.Boolean(!1,Dt.CustomQualityParamInfo),ignoreLight:M.Boolean(!1,Dt.ShadingCategory),xrayShaded:M.Boolean(!1,Dt.ShadingCategory)}),e.Utils={Params:e.Params,createEmpty:r,createValues:u,createValuesSimple:l,updateValues:c,updateBoundingSphere:d,createRenderableState:f,updateRenderableState:p,createPositionIterator:s};function s(h,m){var v=h.cylinderCount*6,g=m.instanceCount.ref.value,y=Am(),b=y.position,S=h.startBuffer.ref.value,x=h.endBuffer.ref.value,C=m.aTransform.ref.value,w=function(_,E){var P=_%6===0?S:x;return E<0?A.fromArray(b,P,_*3):A.transformMat4Offset(b,P,C,0,_*3,E*16),y};return Tn(v,g,2,w)}function u(h,m,v,g,y){var b=v.instanceCount,S=v.groupCount,x=s(h,m),C=Ds(v,x,g.color),w=Dd(v,g.size),_=xu(b*S),E=kd(),P=Rd(),D=Od(),k={drawCount:h.cylinderCount*4*3,vertexCount:h.cylinderCount*6,groupCount:S,instanceCount:b},F=R1(w)*y.sizeFactor,X=He.clone(h.boundingSphere),U=ii(X,m.aTransform.ref.value,b);return T(T(T(T(T(T(T(T(T(T({aMapping:h.mappingBuffer,aGroup:h.groupBuffer,aStart:h.startBuffer,aEnd:h.endBuffer,aScale:h.scaleBuffer,aCap:h.capBuffer,elements:h.indexBuffer,boundingSphere:N.create(U),invariantBoundingSphere:N.create(X),uInvariantBoundingSphere:N.create(Mr.ofSphere(X))},C),w),_),E),P),D),m),{padding:N.create(F)}),Dt.createValues(y,k)),{uSizeFactor:N.create(y.sizeFactor*y.sizeAspectRatio),dDoubleSided:N.create(y.doubleSided),dIgnoreLight:N.create(y.ignoreLight),dXrayShaded:N.create(y.xrayShaded)})}function l(h,m,v,g,y){var b=Dt.createSimple(v,g,y),S=T(T({},M.getDefaultValues(e.Params)),m);return u(h,b.transform,b.locationIterator,b.theme,S)}function c(h,m){Dt.updateValues(h,m),N.updateIfChanged(h.uSizeFactor,m.sizeFactor*m.sizeAspectRatio),N.updateIfChanged(h.dDoubleSided,m.doubleSided),N.updateIfChanged(h.dIgnoreLight,m.ignoreLight),N.updateIfChanged(h.dXrayShaded,m.xrayShaded)}function d(h,m){var v=He.clone(m.boundingSphere),g=ii(v,h.aTransform.ref.value,h.instanceCount.ref.value);He.equals(g,h.boundingSphere.ref.value)||N.update(h.boundingSphere,g),He.equals(v,h.invariantBoundingSphere.ref.value)||(N.update(h.invariantBoundingSphere,v),N.update(h.uInvariantBoundingSphere,Mr.fromSphere(h.uInvariantBoundingSphere.ref.value,v)))}function f(h){var m=Dt.createRenderableState(h);return p(m,h),m}function p(h,m){Dt.updateRenderableState(h,m),h.opaque=h.opaque&&!m.xrayShaded,h.writeDepth=h.opaque}})(su||(su={}));var xi;(function(e){function t(o){switch(o.kind){case"mesh":return o.triangleCount*3;case"points":return o.pointCount;case"spheres":return o.sphereCount*2*3;case"cylinders":return o.cylinderCount*4*3;case"text":return o.charCount*2*3;case"lines":return o.lineCount*2*3;case"direct-volume":return 12*3;case"image":return 2*3;case"texture-mesh":return o.vertexCount}}e.getDrawCount=t;function r(o){switch(o.kind){case"mesh":return o.vertexCount;case"points":return o.pointCount;case"spheres":return o.sphereCount*4;case"cylinders":return o.cylinderCount*6;case"text":return o.charCount*4;case"lines":return o.lineCount*4;case"direct-volume":var s=o.gridDimension.ref.value,u=s[0],l=s[1],c=s[2];return u*l*c;case"image":return 4;case"texture-mesh":return o.vertexCount}}e.getVertexCount=r;function n(o){switch(o.kind){case"mesh":case"points":case"spheres":case"cylinders":case"text":case"lines":return t(o)===0?0:nc(o.groupBuffer.ref.value)+1;case"direct-volume":return 1;case"image":return nc(o.groupTexture.ref.value.array)+1;case"texture-mesh":return o.groupCount}}e.getGroupCount=n;function a(o){switch(o.kind){case"mesh":return Wt.Utils;case"points":return im.Utils;case"spheres":return om.Utils;case"cylinders":return su.Utils;case"text":return mu.Utils;case"lines":return Mn.Utils;case"direct-volume":return bo.Utils;case"image":return yd.Utils;case"texture-mesh":return il.Utils}}e.getUtils=a;function i(o,s){return s==="instance"&&o.nonInstanceable?"group":s}e.getGranularity=i})(xi||(xi={}));var WW=ro();function lwe(e,t){switch(t){case e.FRAMEBUFFER_COMPLETE:return"complete";case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"incomplete attachment";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"incomplete missing attachment";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"incomplete dimensions";case e.FRAMEBUFFER_UNSUPPORTED:return"unsupported"}if(Dr(e))switch(t){case e.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:return"incomplete multisample";case e.RENDERBUFFER_SAMPLES:return"renderbuffer samples"}return"unknown error"}function bk(e){var t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE){var r=lwe(e,t);throw new Error("Framebuffer status: "+r)}}function sL(e){var t=e.createFramebuffer();if(t===null)throw new Error("Could not create WebGL framebuffer");return t}function cwe(e){var t=sL(e),r=!1;return{id:WW(),bind:function(){return e.bindFramebuffer(e.FRAMEBUFFER,t)},reset:function(){t=sL(e)},destroy:function(){r||(e.deleteFramebuffer(t),r=!0)}}}function dwe(){return{id:WW(),bind:function(){},reset:function(){},destroy:function(){}}}function uL(e){var t=b4e(e);if(t===null)throw new Error('Could not find support for "instanced_arrays"');var r=S4e(e);if(r===null)throw new Error('Could not find support for "element_index_uint"');var n=x4e(e);Fr&&n===null&&console.log('Could not find support for "standard_derivatives"');var a=w4e(e);Fr&&a===null&&console.log('Could not find support for "texture_float"');var i=_4e(e);Fr&&i===null&&console.log('Could not find support for "texture_float_linear"');var o=A4e(e);Fr&&o===null&&console.log('Could not find support for "texture_half_float"');var s=T4e(e);Fr&&s===null&&console.log('Could not find support for "texture_half_float_linear"');var u=R4e(e);Fr&&u===null&&console.log('Could not find support for "depth_texture"');var l=E4e(e);Fr&&l===null&&console.log('Could not find support for "blend_minmax"');var c=C4e(e);Fr&&c===null&&console.log('Could not find support for "vertex_array_object"');var d=P4e(e);Fr&&d===null&&console.log('Could not find support for "frag_depth"');var f=I4e(e);Fr&&f===null&&console.log('Could not find support for "color_buffer_float"');var p=M4e(e);Fr&&p===null&&console.log('Could not find support for "color_buffer_half_float"');var h=D4e(e);Fr&&h===null&&console.log('Could not find support for "draw_buffers"');var m=k4e(e);Fr&&m===null&&console.log('Could not find support for "shader_texture_lod"');var v=O4e(e);return Fr&&v===null&&console.log('Could not find support for "sRGB"'),{instancedArrays:t,standardDerivatives:n,textureFloat:a,textureFloatLinear:i,textureHalfFloat:o,textureHalfFloatLinear:s,elementIndexUint:r,depthTexture:u,blendMinMax:l,vertexArrayObject:c,fragDepth:d,colorBufferFloat:f,colorBufferHalfFloat:p,drawBuffers:h,shaderTextureLod:m,sRGB:v}}function fwe(e){var t={},r=e.getParameter(e.FRONT_FACE),n=e.getParameter(e.CULL_FACE_MODE),a=e.getParameter(e.DEPTH_WRITEMASK),i=e.getParameter(e.COLOR_WRITEMASK),o=e.getParameter(e.COLOR_CLEAR_VALUE),s=e.getParameter(e.BLEND_SRC_RGB),u=e.getParameter(e.BLEND_DST_RGB),l=e.getParameter(e.BLEND_SRC_ALPHA),c=e.getParameter(e.BLEND_DST_ALPHA),d=e.getParameter(e.BLEND_EQUATION_RGB),f=e.getParameter(e.BLEND_EQUATION_ALPHA);return{currentProgramId:-1,currentMaterialId:-1,currentRenderItemId:-1,enable:function(p){t[p]!==!0&&(e.enable(p),t[p]=!0)},disable:function(p){t[p]!==!1&&(e.disable(p),t[p]=!1)},frontFace:function(p){p!==r&&(e.frontFace(p),r=p)},cullFace:function(p){p!==n&&(e.cullFace(p),n=p)},depthMask:function(p){p!==a&&(e.depthMask(p),a=p)},colorMask:function(p,h,m,v){(p!==i[0]||h!==i[1]||m!==i[2]||v!==i[3])&&(e.colorMask(p,h,m,v),i[0]=p,i[1]=h,i[2]=m,i[3]=v)},clearColor:function(p,h,m,v){(p!==o[0]||h!==o[1]||m!==o[2]||v!==o[3])&&(e.clearColor(p,h,m,v),o[0]=p,o[1]=h,o[2]=m,o[3]=v)},blendFunc:function(p,h){(p!==s||h!==u||p!==l||h!==c)&&(e.blendFunc(p,h),s=p,u=h,l=p,c=h)},blendFuncSeparate:function(p,h,m,v){(p!==s||h!==u||m!==l||v!==c)&&(e.blendFuncSeparate(p,h,m,v),s=p,u=h,l=m,c=v)},blendEquation:function(p){(p!==d||p!==f)&&(e.blendEquation(p),d=p,f=p)},blendEquationSeparate:function(p,h){(p!==d||h!==f)&&(e.blendEquationSeparate(p,h),d=p,f=h)},reset:function(){t={},r=e.getParameter(e.FRONT_FACE),n=e.getParameter(e.CULL_FACE_MODE),a=e.getParameter(e.DEPTH_WRITEMASK),i=e.getParameter(e.COLOR_WRITEMASK),o=e.getParameter(e.COLOR_CLEAR_VALUE),s=e.getParameter(e.BLEND_SRC_RGB),u=e.getParameter(e.BLEND_DST_RGB),l=e.getParameter(e.BLEND_SRC_ALPHA),c=e.getParameter(e.BLEND_DST_ALPHA),d=e.getParameter(e.BLEND_EQUATION_RGB),f=e.getParameter(e.BLEND_EQUATION_ALPHA)}}}var jh;(function(e){function t(a,i,o){return{array:a,width:i,height:o}}e.create=t;function r(a){for(var i=a.array,o=a.width,s=a.height,u=o*4,l=0,c=s/2;l<c;++l)for(var d=0,f=u;d<f;++d){var p=l*u+d,h=(s-l-1)*u+d,m=i[p];i[p]=i[h],i[h]=m}return a}e.flipY=r;function n(a){for(var i=a.array,o=0,s=i.length;o<s;o+=4){var u=i[o+3]/255;i[o]/=u,i[o+1]/=u,i[o+2]/=u}return a}e.divideByAlpha=n})(jh||(jh={}));var pwe=`
float viewZ = depthToViewZ(uIsOrtho, fragmentDepth, uNear, uFar);
float fogFactor = smoothstep(uFogNear, uFogFar, abs(viewZ));
float fogAlpha = (1.0 - fogFactor) * gl_FragColor.a;
float preFogAlpha = gl_FragColor.a;
if (!uTransparentBackground) {
    if (gl_FragColor.a < 1.0) {
        // transparent objects are blended with background color
        gl_FragColor.a = fogAlpha;
    } else {
        // mix opaque objects with background color
        gl_FragColor.rgb = mix(gl_FragColor.rgb, uFogColor, fogFactor);
    }
} else {
    // pre-multiplied alpha expected for transparent background
    gl_FragColor.rgb *= fogAlpha;
    gl_FragColor.a = fogAlpha;
}
`,hwe=`
if (interior) {
    if (uInteriorColorFlag) {
        gl_FragColor.rgb = uInteriorColor;
    } else {
        gl_FragColor.rgb *= 1.0 - uInteriorDarkening;
    }
}
`,mwe=`
// inputs
// - vec4 material
// - vec3 vViewPosition
// - vec3 normal
// - float uMetalness
// - float uRoughness
// - float uReflectivity
// - float uLightIntensity
// - float uAmbientIntensity

// outputs
// - sets gl_FragColor

vec4 color = material;

ReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0));

PhysicalMaterial physicalMaterial;
physicalMaterial.diffuseColor = color.rgb * (1.0 - uMetalness);
physicalMaterial.specularRoughness = clamp(uRoughness, 0.04, 1.0);
physicalMaterial.specularColor = mix(vec3(0.16 * pow2(uReflectivity)), color.rgb, uMetalness);

GeometricContext geometry;
geometry.position = -vViewPosition;
geometry.normal = normal;
geometry.viewDir = normalize(vViewPosition);

IncidentLight directLight;
directLight.direction = vec3(0.0, 0.0, -1.0);
directLight.color = vec3(uLightIntensity);

RE_Direct_Physical(directLight, geometry, physicalMaterial, reflectedLight);

vec3 irradiance = vec3(uAmbientIntensity) * PI;
RE_IndirectDiffuse_Physical(irradiance, geometry, physicalMaterial, reflectedLight);

vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular;

gl_FragColor = vec4(outgoingLight, color.a);

#ifdef dXrayShaded
    gl_FragColor.a *= 1.0 - pow(abs(dot(normal, vec3(0, 0, 1))), uXrayEdgeFalloff);
#endif
`,vwe=`
float marker = floor(vMarker * 255.0 + 0.5); // rounding required to work on some cards on win
if (marker > 0.1) {
    if (intMod(marker, 2.0) > 0.1) {
        gl_FragColor.rgb = mix(uHighlightColor, gl_FragColor.rgb, 0.3);
        gl_FragColor.a = max(0.02, gl_FragColor.a); // for direct-volume rendering
    } else {
        gl_FragColor.rgb = mix(uSelectColor, gl_FragColor.rgb, 0.3);
    }
}
`,gwe=`
#if dClipObjectCount != 0 && defined(dClipping)
    vClipping = readFromTexture(tClipping, aInstance * float(uGroupCount) + group, uClippingTexDim).a;
#endif
`,ywe=`
#if defined(dRenderVariant_color)
    #if defined(dColorType_attribute)
        vColor.rgb = aColor;
    #elif defined(dColorType_instance)
        vColor.rgb = readFromTexture(tColor, aInstance, uColorTexDim).rgb;
    #elif defined(dColorType_group)
        vColor.rgb = readFromTexture(tColor, group, uColorTexDim).rgb;
    #elif defined(dColorType_groupInstance)
        vColor.rgb = readFromTexture(tColor, aInstance * float(uGroupCount) + group, uColorTexDim).rgb;
    #elif defined(dColorType_vertex)
        vColor.rgb = readFromTexture(tColor, VertexID, uColorTexDim).rgb;
    #elif defined(dColorType_vertexInstance)
        vColor.rgb = readFromTexture(tColor, int(aInstance) * uVertexCount + VertexID, uColorTexDim).rgb;
    #elif defined(dColorType_volume)
        vec3 gridPos = (uColorGridTransform.w * (position - uColorGridTransform.xyz)) / uColorGridDim;
        vColor.rgb = texture3dFrom2dLinear(tColorGrid, gridPos, uColorGridDim, uColorTexDim).rgb;
    #elif defined(dColorType_volumeInstance)
        vec3 gridPos = (uColorGridTransform.w * (vModelPosition - uColorGridTransform.xyz)) / uColorGridDim;
        vColor.rgb = texture3dFrom2dLinear(tColorGrid, gridPos, uColorGridDim, uColorTexDim).rgb;
    #endif

    #ifdef dUsePalette
        vPaletteV = ((vColor.r * 256.0 * 256.0 * 255.0 + vColor.g * 256.0 * 255.0 + vColor.b * 255.0) - 1.0) / 16777215.0;
    #endif

    #ifdef dOverpaint
        vOverpaint = readFromTexture(tOverpaint, aInstance * float(uGroupCount) + group, uOverpaintTexDim);
    #endif
#elif defined(dRenderVariant_pick)
    #if defined(dRenderVariant_pickObject)
        vColor = vec4(encodeFloatRGB(float(uObjectId)), 1.0);
    #elif defined(dRenderVariant_pickInstance)
        vColor = vec4(encodeFloatRGB(aInstance), 1.0);
    #elif defined(dRenderVariant_pickGroup)
        vColor = vec4(encodeFloatRGB(group), 1.0);
    #endif
#endif

#ifdef dTransparency
    vGroup = group;
    vTransparency = readFromTexture(tTransparency, aInstance * float(uGroupCount) + group, uTransparencyTexDim).a;
#endif
`,bwe=`
#ifdef dGeoTexture
    float group = decodeFloatRGB(readFromTexture(tGroup, VertexID, uGeoTexDim).rgb);
#else
    float group = aGroup;
#endif
`,xwe=`
vMarker = readFromTexture(tMarker, aInstance * float(uGroupCount) + group, uMarkerTexDim).a;
`,Swe=`
#if defined(dRenderVariant_color)
    #if defined(dUsePalette)
        vec4 material = vec4(texture2D(tPalette, vec2(vPaletteV, 0.5)).rgb, uAlpha);
    #elif defined(dColorType_uniform)
        vec4 material = vec4(uColor, uAlpha);
    #elif defined(dColorType_varying)
        vec4 material = vec4(vColor.rgb, uAlpha);
    #endif

    // mix material with overpaint
    #if defined(dOverpaint)
        material.rgb = mix(material.rgb, vOverpaint.rgb, vOverpaint.a);
    #endif
#elif defined(dRenderVariant_pick)
    vec4 material = vColor;
#elif defined(dRenderVariant_depth)
    #ifdef enabledFragDepth
        vec4 material = packDepthToRGBA(gl_FragDepthEXT);
    #else
        vec4 material = packDepthToRGBA(gl_FragCoord.z);
    #endif
#endif

// apply screendoor transparency
#if defined(dTransparency)
    float ta = 1.0 - vTransparency;

    #if defined(dRenderVariant_pick)
        if (ta < uPickingAlphaThreshold)
            discard; // ignore so the element below can be picked
    #else
        #if defined(dRenderVariant_colorBlended)
            float at = 0.0;

            // shift by view-offset during multi-sample rendering to allow for blending
            vec2 coord = gl_FragCoord.xy + uViewOffset * 0.25;

            const mat4 thresholdMatrix = mat4(
                1.0 / 17.0,  9.0 / 17.0,  3.0 / 17.0, 11.0 / 17.0,
                13.0 / 17.0,  5.0 / 17.0, 15.0 / 17.0,  7.0 / 17.0,
                4.0 / 17.0, 12.0 / 17.0,  2.0 / 17.0, 10.0 / 17.0,
                16.0 / 17.0,  8.0 / 17.0, 14.0 / 17.0,  6.0 / 17.0
            );
            int ci = int(intMod(coord.x, 4.0));
            int ri = int(intMod(coord.y, 4.0));
            #if __VERSION__ == 100
                vec4 i = vec4(float(ci * 4 + ri));
                vec4 v = thresholdMatrix[0] * vec4(equal(i, vec4(0.0, 1.0, 2.0, 3.0))) +
                    thresholdMatrix[1] * vec4(equal(i, vec4(4.0, 5.0, 6.0, 7.0))) +
                    thresholdMatrix[2] * vec4(equal(i, vec4(8.0, 9.0, 10.0, 11.0))) +
                    thresholdMatrix[3] * vec4(equal(i, vec4(12.0, 13.0, 14.0, 15.0)));
                at = v.x + v.y + v.z + v.w;
            #else
                at = thresholdMatrix[ci][ri];
            #endif

            if (ta < 0.99 && (ta < 0.01 || ta < at)) {
                discard;
            }
        #elif defined(dRenderVariant_colorWboit)
            material.a *= ta;
        #endif
    #endif
#endif
`,Cwe=`
mat4 model = uModel * aTransform;
mat4 modelView = uView * model;
#ifdef dGeoTexture
    vec3 position = readFromTexture(tPosition, VertexID, uGeoTexDim).xyz;
#else
    vec3 position = aPosition;
#endif
vec4 position4 = vec4(position, 1.0);
// for accessing tColorGrid in vert shader and for clipping in frag shader
vModelPosition = (model * position4).xyz;
vec4 mvPosition = modelView * position4;
vViewPosition = mvPosition.xyz;
gl_Position = uProjection * mvPosition;
`,wwe=`
#if defined(dSizeType_uniform)
    float size = uSize;
#elif defined(dSizeType_attribute)
    float size = aSize;
#elif defined(dSizeType_instance)
    float size = decodeFloatRGB(readFromTexture(tSize, aInstance, uSizeTexDim).rgb);
#elif defined(dSizeType_group)
    float size = decodeFloatRGB(readFromTexture(tSize, group, uSizeTexDim).rgb);
#elif defined(dSizeType_groupInstance)
    float size = decodeFloatRGB(readFromTexture(tSize, aInstance * float(uGroupCount) + group, uSizeTexDim).rgb);
#endif

#if defined(dSizeType_instance) || defined(dSizeType_group) || defined(dSizeType_groupInstance)
    size /= 100.0; // NOTE factor also set in TypeScript
#endif

size *= uSizeFactor;
`,_we=`
float viewZ = depthToViewZ(uIsOrtho, fragmentDepth, uNear, uFar);
float fogFactor = smoothstep(uFogNear, uFogFar, abs(viewZ));
float alpha = (1.0 - fogFactor) * uAlpha;
if (uAlpha < uPickingAlphaThreshold || alpha < 0.1)
    discard; // ignore so the element below can be picked
`,Awe=`
#if defined(dClipVariant_instance) && dClipObjectCount != 0
    int flag = 0;
    #if defined(dClipping)
        flag = int(floor(vClipping * 255.0 + 0.5));
    #endif

    vec4 mCenter = uModel * aTransform * vec4(uInvariantBoundingSphere.xyz, 1.0);
    if (clipTest(vec4(mCenter.xyz, uInvariantBoundingSphere.w), flag))
        // move out of [ -w, +w ] to 'discard' in vert shader
        gl_Position.z = 2.0 * gl_Position.w;
#endif
`,Twe=`
#if defined(dClipVariant_pixel) && dClipObjectCount != 0
    #if defined(dClipping)
        int clippingFlag = int(floor(vClipping * 255.0 + 0.5));
    #else
        int clippingFlag = 0;
    #endif

    if (clipTest(vec4(vModelPosition, 0.0), clippingFlag))
        discard;
#endif
`,Ewe=`
#if defined(dRenderVariant_color)
    #if defined(dColorType_uniform)
        uniform vec3 uColor;
    #elif defined(dColorType_varying)
        varying vec4 vColor;
    #endif

    #ifdef dOverpaint
        varying vec4 vOverpaint;
    #endif
#elif defined(dRenderVariant_pick)
    #if __VERSION__ == 100
        varying vec4 vColor;
    #else
        flat in vec4 vColor;
    #endif
#endif

#ifdef dTransparency
    varying float vGroup;
    varying float vTransparency;
#endif

#ifdef dUsePalette
    uniform sampler2D tPalette;
    varying float vPaletteV;
#endif
`,Pwe=`
#if defined(dRenderVariant_color)
    #if defined(dColorType_uniform)
        uniform vec3 uColor;
    #elif defined(dColorType_attribute)
        varying vec4 vColor;
        attribute vec3 aColor;
    #elif defined(dColorType_texture)
        varying vec4 vColor;
        uniform vec2 uColorTexDim;
        uniform sampler2D tColor;
    #elif defined(dColorType_grid)
        varying vec4 vColor;
        uniform vec2 uColorTexDim;
        uniform vec3 uColorGridDim;
        uniform vec4 uColorGridTransform;
        uniform sampler2D tColorGrid;
    #endif

    #ifdef dOverpaint
        varying vec4 vOverpaint;
        uniform vec2 uOverpaintTexDim;
        uniform sampler2D tOverpaint;
    #endif
#elif defined(dRenderVariant_pick)
    #if __VERSION__ == 100
        varying vec4 vColor;
    #else
        flat out vec4 vColor;
    #endif
#endif

#ifdef dTransparency
    varying float vGroup;
    varying float vTransparency;
    uniform vec2 uTransparencyTexDim;
    uniform sampler2D tTransparency;
#endif

#ifdef dUsePalette
    varying float vPaletteV;
#endif
`,Iwe=`
#if dClipObjectCount != 0
    vec3 quaternionTransform(vec4 q, vec3 v) {
        vec3 t = 2.0 * cross(q.xyz, v);
        return v + q.w * t + cross(q.xyz, t);
    }

    vec4 computePlane(vec3 normal, vec3 inPoint) {
        return vec4(normalize(normal), -dot(normal, inPoint));
    }

    float planeSD(vec4 plane, vec3 center) {
        return -dot(plane.xyz, center - plane.xyz * -plane.w);
    }

    float sphereSD(vec3 position, vec4 rotation, vec3 size, vec3 center) {
        return (
            length(quaternionTransform(vec4(-rotation.x, -rotation.y, -rotation.z, rotation.w), center - position) / size) - 1.0
        ) * min(min(size.x, size.y), size.z);
    }

    float cubeSD(vec3 position, vec4 rotation, vec3 size, vec3 center) {
        vec3 d = abs(quaternionTransform(vec4(-rotation.x, -rotation.y, -rotation.z, rotation.w), center - position)) - size;
        return min(max(d.x, max(d.y, d.z)), 0.0) + length(max(d, 0.0));
    }

    float cylinderSD(vec3 position, vec4 rotation, vec3 size, vec3 center) {
        vec3 t = quaternionTransform(vec4(-rotation.x, -rotation.y, -rotation.z, rotation.w), center - position);

        vec2 d = abs(vec2(length(t.xz), t.y)) - size.xy;
        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));
    }

    float infiniteConeSD(vec3 position, vec4 rotation, vec3 size, vec3 center) {
        vec3 t = quaternionTransform(vec4(-rotation.x, -rotation.y, -rotation.z, rotation.w), center - position);

        float q = length(t.xy);
        return dot(size.xy, vec2(q, t.z));
    }

    float getSignedDistance(vec3 center, int type, vec3 position, vec4 rotation, vec3 scale) {
        if (type == 1) {
            vec3 normal = quaternionTransform(rotation, vec3(0.0, 1.0, 0.0));
            vec4 plane = computePlane(normal, position);
            return planeSD(plane, center);
        } else if (type == 2) {
            return sphereSD(position, rotation, scale * 0.5, center);
        } else if (type == 3) {
            return cubeSD(position, rotation, scale * 0.5, center);
        } else if (type == 4) {
            return cylinderSD(position, rotation, scale * 0.5, center);
        } else if (type == 5) {
            return infiniteConeSD(position, rotation, scale * 0.5, center);
        } else {
            return 0.1;
        }
    }

    #if __VERSION__ == 100
        // 8-bit
        int bitwiseAnd(int a, int b) {
            int d = 128;
            int result = 0;
            for (int i = 0; i < 8; ++i) {
                if (d <= 0) break;
                if (a >= d && b >= d) result += d;
                if (a >= d) a -= d;
                if (b >= d) b -= d;
                d /= 2;
            }
            return result;
        }

        bool hasBit(int mask, int bit) {
            return bitwiseAnd(mask, bit) == 0;
        }
    #else
        bool hasBit(int mask, int bit) {
            return (mask & bit) == 0;
        }
    #endif

    // flag is a bit-flag for clip-objects to ignore (note, object ids start at 1 not 0)
    bool clipTest(vec4 sphere, int flag) {
        for (int i = 0; i < dClipObjectCount; ++i) {
            if (flag == 0 || hasBit(flag, i + 1)) {
                // TODO take sphere radius into account?
                bool test = getSignedDistance(sphere.xyz, uClipObjectType[i], uClipObjectPosition[i], uClipObjectRotation[i], uClipObjectScale[i]) <= 0.0;
                if ((!uClipObjectInvert[i] && test) || (uClipObjectInvert[i] && !test)) {
                    return true;
                }
            }
        }
        return false;
    }
#endif
`,Mwe=`
uniform int uObjectId;
uniform int uInstanceCount;
uniform int uGroupCount;

#if dClipObjectCount != 0
    uniform int uClipObjectType[dClipObjectCount];
    uniform bool uClipObjectInvert[dClipObjectCount];
    uniform vec3 uClipObjectPosition[dClipObjectCount];
    uniform vec4 uClipObjectRotation[dClipObjectCount];
    uniform vec3 uClipObjectScale[dClipObjectCount];

    #if defined(dClipping)
        #if __VERSION__ == 100
            varying float vClipping;
        #else
            flat in float vClipping;
        #endif
    #endif
#endif

uniform vec3 uHighlightColor;
uniform vec3 uSelectColor;
#if __VERSION__ == 100
    varying float vMarker;
#else
    flat in float vMarker;
#endif

varying vec3 vModelPosition;
varying vec3 vViewPosition;

uniform vec2 uViewOffset;

uniform float uNear;
uniform float uFar;
uniform float uIsOrtho;

uniform float uFogNear;
uniform float uFogFar;
uniform vec3 uFogColor;

uniform float uAlpha;
uniform float uPickingAlphaThreshold;
uniform bool uTransparentBackground;

uniform float uInteriorDarkening;
uniform bool uInteriorColorFlag;
uniform vec3 uInteriorColor;
bool interior;

uniform float uXrayEdgeFalloff;

uniform mat4 uProjection;
`,Dwe=`
uniform mat4 uProjection, uModel, uView;
uniform vec3 uCameraPosition;

uniform int uObjectId;
uniform int uVertexCount;
uniform int uInstanceCount;
uniform int uGroupCount;
uniform vec4 uInvariantBoundingSphere;

#if dClipObjectCount != 0
    uniform int uClipObjectType[dClipObjectCount];
    uniform bool uClipObjectInvert[dClipObjectCount];
    uniform vec3 uClipObjectPosition[dClipObjectCount];
    uniform vec4 uClipObjectRotation[dClipObjectCount];
    uniform vec3 uClipObjectScale[dClipObjectCount];

    #if defined(dClipping)
        uniform vec2 uClippingTexDim;
        uniform sampler2D tClipping;
        #if __VERSION__ == 100
            varying float vClipping;
        #else
            flat out float vClipping;
        #endif
    #endif
#endif

uniform vec2 uMarkerTexDim;
uniform sampler2D tMarker;
#if __VERSION__ == 100
    varying float vMarker;
#else
    flat out float vMarker;
#endif

varying vec3 vModelPosition;
varying vec3 vViewPosition;

#if __VERSION__ == 100
    attribute float aVertex;
    #define VertexID int(aVertex)
#else
    // not using gl_VertexID but aVertex to ensure there is an active attribute with divisor 0
    // since FF 85 this is not needed anymore but lets keep it for backwards compatibility
    // https://bugzilla.mozilla.org/show_bug.cgi?id=1679693
    // see also note in src/mol-gl/webgl/render-item.ts
    attribute float aVertex;
    #define VertexID int(aVertex)
    // #define VertexID gl_VertexID
#endif
`,kwe=`
// TODO find a better place for these convenience defines

#if defined(dRenderVariant_colorBlended) || defined(dRenderVariant_colorWboit)
    #define dRenderVariant_color
#endif

#if defined(dRenderVariant_pickObject) || defined(dRenderVariant_pickInstance) || defined(dRenderVariant_pickGroup)
    #define dRenderVariant_pick
#endif

#if defined(dColorType_instance) || defined(dColorType_group) || defined(dColorType_groupInstance) || defined(dColorType_vertex) || defined(dColorType_vertexInstance)
    #define dColorType_texture
#endif

#if defined(dColorType_volume) || defined(dColorType_volumeInstance)
    #define dColorType_grid
#endif

#if defined(dColorType_attribute) || defined(dColorType_texture) || defined(dColorType_grid)
    #define dColorType_varying
#endif

//

#define PI 3.14159265
#define RECIPROCAL_PI 0.31830988618
#define EPSILON 1e-6

#define saturate(a) clamp(a, 0.0, 1.0)

float intDiv(const in float a, const in float b) { return float(int(a) / int(b)); }
vec2 ivec2Div(const in vec2 a, const in vec2 b) { return vec2(ivec2(a) / ivec2(b)); }
float intMod(const in float a, const in float b) { return a - b * float(int(a) / int(b)); }
int imod(const in int a, const in int b) { return a - b * (a / b); }

float pow2(const in float x) { return x * x; }

const float maxFloat = 10000.0; // NOTE constant also set in TypeScript
const float floatLogFactor = 9.210440366976517; // log(maxFloat + 1.0);
float encodeFloatLog(const in float value) { return log(value + 1.0) / floatLogFactor; }
float decodeFloatLog(const in float value) { return exp(value * floatLogFactor) - 1.0; }

vec3 encodeFloatRGB(in float value) {
    value = clamp(value, 0.0, 16777216.0 - 1.0) + 1.0;
    vec3 c = vec3(0.0);
    c.b = mod(value, 256.0);
    value = floor(value / 256.0);
    c.g = mod(value, 256.0);
    value = floor(value / 256.0);
    c.r = mod(value, 256.0);
    return c / 255.0;
}
float decodeFloatRGB(const in vec3 rgb) {
    return (rgb.r * 256.0 * 256.0 * 255.0 + rgb.g * 256.0 * 255.0 + rgb.b * 255.0) - 1.0;
}

vec2 packUnitIntervalToRG(const in float v) {
    vec2 enc;
    enc.xy = vec2(fract(v * 256.0), v);
    enc.y -= enc.x * (1.0 / 256.0);
    enc.xy *=  256.0 / 255.0;

    return enc;
}

float unpackRGToUnitInterval(const in vec2 enc) {
    return dot(enc, vec2(255.0 / (256.0 * 256.0), 255.0 / 256.0));
}

vec3 screenSpaceToViewSpace(const in vec3 ssPos, const in mat4 invProjection) {
    vec4 p = vec4(ssPos * 2.0 - 1.0, 1.0);
    p = invProjection * p;
    return p.xyz / p.w;
}

const float PackUpscale = 256.0 / 255.0; // fraction -> 0..1 (including 1)
const float UnpackDownscale = 255.0 / 256.0; // 0..1 -> fraction (excluding 1)
const vec3 PackFactors = vec3(256.0 * 256.0 * 256.0, 256.0 * 256.0,  256.0);
const vec4 UnpackFactors = UnpackDownscale / vec4(PackFactors, 1.0);
const float ShiftRight8 = 1.0 / 256.0;

vec4 packDepthToRGBA(const in float v) {
    vec4 r = vec4(fract(v * PackFactors), v);
    r.yzw -= r.xyz * ShiftRight8; // tidy overflow
    return r * PackUpscale;
}
float unpackRGBAToDepth(const in vec4 v) {
    return dot(v, UnpackFactors);
}

vec4 sRGBToLinear(const in vec4 c) {
    return vec4(mix(pow(c.rgb * 0.9478672986 + vec3(0.0521327014), vec3(2.4)), c.rgb * 0.0773993808, vec3(lessThanEqual(c.rgb, vec3(0.04045)))), c.a);
}
vec4 linearTosRGB(const in vec4 c) {
    return vec4(mix(pow(c.rgb, vec3(0.41666)) * 1.055 - vec3(0.055), c.rgb * 12.92, vec3(lessThanEqual(c.rgb, vec3(0.0031308)))), c.a);
}

float linearizeDepth(const in float depth, const in float near, const in float far) {
    return (2.0 * near) / (far + near - depth * (far - near));
}

float perspectiveDepthToViewZ(const in float invClipZ, const in float near, const in float far) {
    return (near * far) / ((far - near) * invClipZ - far);
}

float orthographicDepthToViewZ(const in float linearClipZ, const in float near, const in float far) {
    return linearClipZ * (near - far) - near;
}

float depthToViewZ(const in float isOrtho, const in float linearClipZ, const in float near, const in float far) {
    return isOrtho == 1.0 ? orthographicDepthToViewZ(linearClipZ, near, far) : perspectiveDepthToViewZ(linearClipZ, near, far);
}

#if __VERSION__ == 100
    // transpose

    float transpose(const in float m) {
        return m;
    }

    mat2 transpose2(const in mat2 m) {
        return mat2(
            m[0][0], m[1][0],
            m[0][1], m[1][1]
        );
    }

    mat3 transpose3(const in mat3 m) {
        return mat3(
            m[0][0], m[1][0], m[2][0],
            m[0][1], m[1][1], m[2][1],
            m[0][2], m[1][2], m[2][2]
        );
    }

    mat4 transpose4(const in mat4 m) {
        return mat4(
            m[0][0], m[1][0], m[2][0], m[3][0],
            m[0][1], m[1][1], m[2][1], m[3][1],
            m[0][2], m[1][2], m[2][2], m[3][2],
            m[0][3], m[1][3], m[2][3], m[3][3]
        );
    }

    // inverse

    float inverse(const in float m) {
        return 1.0 / m;
    }

    mat2 inverse2(const in mat2 m) {
        return mat2(m[1][1],-m[0][1],
                -m[1][0], m[0][0]) / (m[0][0]*m[1][1] - m[0][1]*m[1][0]);
    }

    mat3 inverse3(const in mat3 m) {
        float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2];
        float a10 = m[1][0], a11 = m[1][1], a12 = m[1][2];
        float a20 = m[2][0], a21 = m[2][1], a22 = m[2][2];

        float b01 = a22 * a11 - a12 * a21;
        float b11 = -a22 * a10 + a12 * a20;
        float b21 = a21 * a10 - a11 * a20;

        float det = a00 * b01 + a01 * b11 + a02 * b21;

        return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),
                    b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),
                    b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;
    }

    mat4 inverse4(const in mat4 m) {
        float
            a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],
            a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],
            a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],
            a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],

            b00 = a00 * a11 - a01 * a10,
            b01 = a00 * a12 - a02 * a10,
            b02 = a00 * a13 - a03 * a10,
            b03 = a01 * a12 - a02 * a11,
            b04 = a01 * a13 - a03 * a11,
            b05 = a02 * a13 - a03 * a12,
            b06 = a20 * a31 - a21 * a30,
            b07 = a20 * a32 - a22 * a30,
            b08 = a20 * a33 - a23 * a30,
            b09 = a21 * a32 - a22 * a31,
            b10 = a21 * a33 - a23 * a31,
            b11 = a22 * a33 - a23 * a32,

            det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;

        return mat4(
            a11 * b11 - a12 * b10 + a13 * b09,
            a02 * b10 - a01 * b11 - a03 * b09,
            a31 * b05 - a32 * b04 + a33 * b03,
            a22 * b04 - a21 * b05 - a23 * b03,
            a12 * b08 - a10 * b11 - a13 * b07,
            a00 * b11 - a02 * b08 + a03 * b07,
            a32 * b02 - a30 * b05 - a33 * b01,
            a20 * b05 - a22 * b02 + a23 * b01,
            a10 * b10 - a11 * b08 + a13 * b06,
            a01 * b08 - a00 * b10 - a03 * b06,
            a30 * b04 - a31 * b02 + a33 * b00,
            a21 * b02 - a20 * b04 - a23 * b00,
            a11 * b07 - a10 * b09 - a12 * b06,
            a00 * b09 - a01 * b07 + a02 * b06,
            a31 * b01 - a30 * b03 - a32 * b00,
            a20 * b03 - a21 * b01 + a22 * b00) / det;
    }
#else
    #define transpose2(m) transpose(m)
    #define transpose3(m) transpose(m)
    #define transpose4(m) transpose(m)

    #define inverse2(m) inverse(m)
    #define inverse3(m) inverse(m)
    #define inverse4(m) inverse(m)
#endif
`,Rwe=`
    // floatToRgba adapted from https://github.com/equinor/glsl-float-to-rgba
    // MIT License, Copyright (c) 2020 Equinor

    float shiftRight (float v, float amt) {
    v = floor(v) + 0.5;
    return floor(v / exp2(amt));
    }
    float shiftLeft (float v, float amt) {
        return floor(v * exp2(amt) + 0.5);
    }
    float maskLast (float v, float bits) {
        return mod(v, shiftLeft(1.0, bits));
    }
    float extractBits (float num, float from, float to) {
        from = floor(from + 0.5); to = floor(to + 0.5);
        return maskLast(shiftRight(num, from), to - from);
    }

    vec4 floatToRgba(float texelFloat, bool littleEndian) {
        if (texelFloat == 0.0) return vec4(0.0, 0.0, 0.0, 0.0);
        float sign = texelFloat > 0.0 ? 0.0 : 1.0;
        texelFloat = abs(texelFloat);
        float exponent = floor(log2(texelFloat));
        float biased_exponent = exponent + 127.0;
        float fraction = ((texelFloat / exp2(exponent)) - 1.0) * 8388608.0;
        float t = biased_exponent / 2.0;
        float last_bit_of_biased_exponent = fract(t) * 2.0;
        float remaining_bits_of_biased_exponent = floor(t);
        float byte4 = extractBits(fraction, 0.0, 8.0) / 255.0;
        float byte3 = extractBits(fraction, 8.0, 16.0) / 255.0;
        float byte2 = (last_bit_of_biased_exponent * 128.0 + extractBits(fraction, 16.0, 23.0)) / 255.0;
        float byte1 = (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0;
        return (
            littleEndian
                ? vec4(byte4, byte3, byte2, byte1)
                : vec4(byte1, byte2, byte3, byte4)
        );
    }
`,Owe=`
uniform float uLightIntensity;
uniform float uAmbientIntensity;
uniform float uReflectivity;
uniform float uMetalness;
uniform float uRoughness;

struct PhysicalMaterial {
    vec3 diffuseColor;
    float specularRoughness;
    vec3 specularColor;
};

struct IncidentLight {
    vec3 color;
    vec3 direction;
};

struct ReflectedLight {
    vec3 directDiffuse;
    vec3 directSpecular;
    vec3 indirectDiffuse;
};

struct GeometricContext {
    vec3 position;
    vec3 normal;
    vec3 viewDir;
};

vec3 F_Schlick(const in vec3 specularColor, const in float dotLH) {
    // Original approximation by Christophe Schlick '94
    // float fresnel = pow( 1.0 - dotLH, 5.0 );
    // Optimized variant (presented by Epic at SIGGRAPH '13)
    // https://cdn2.unrealengine.com/Resources/files/2013SiggraphPresentationsNotes-26915738.pdf
    float fresnel = exp2((-5.55473 * dotLH - 6.98316) * dotLH);
    return (1.0 - specularColor) * fresnel + specularColor;
}

// Moving Frostbite to Physically Based Rendering 3.0 - page 12, listing 2
// https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf
float G_GGX_SmithCorrelated(const in float alpha, const in float dotNL, const in float dotNV) {
    float a2 = pow2(alpha);
    // dotNL and dotNV are explicitly swapped. This is not a mistake.
    float gv = dotNL * sqrt(a2 + (1.0 - a2) * pow2(dotNV));
    float gl = dotNV * sqrt(a2 + (1.0 - a2) * pow2(dotNL));
    return 0.5 / max(gv + gl, EPSILON);
}

// Microfacet Models for Refraction through Rough Surfaces - equation (33)
// http://graphicrants.blogspot.com/2013/08/specular-brdf-reference.html
// alpha is "roughness squared" in Disney\u2019s reparameterization
float D_GGX(const in float alpha, const in float dotNH) {
    float a2 = pow2(alpha);
    float denom = pow2(dotNH) * (a2 - 1.0) + 1.0; // avoid alpha = 0 with dotNH = 1
    return RECIPROCAL_PI * a2 / pow2(denom);
}

vec3 BRDF_Diffuse_Lambert(const in vec3 diffuseColor) {
    return RECIPROCAL_PI * diffuseColor;
}

// GGX Distribution, Schlick Fresnel, GGX-Smith Visibility
vec3 BRDF_Specular_GGX(const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness) {
    float alpha = pow2(roughness); // UE4's roughness
    vec3 halfDir = normalize(incidentLight.direction + geometry.viewDir);

    float dotNL = saturate(dot(geometry.normal, incidentLight.direction));
    float dotNV = saturate(dot(geometry.normal, geometry.viewDir));
    float dotNH = saturate(dot(geometry.normal, halfDir));
    float dotLH = saturate(dot(incidentLight.direction, halfDir));

    vec3 F = F_Schlick(specularColor, dotLH);
    float G = G_GGX_SmithCorrelated(alpha, dotNL, dotNV);
    float D = D_GGX(alpha, dotNH);
    return F * (G * D);
}

// ref: https://www.unrealengine.com/blog/physically-based-shading-on-mobile - environmentBRDF for GGX on mobile
vec3 BRDF_Specular_GGX_Environment(const in GeometricContext geometry, const in vec3 specularColor, const in float roughness) {
    float dotNV = saturate(dot(geometry.normal, geometry.viewDir));
    const vec4 c0 = vec4(-1, -0.0275, -0.572, 0.022);
    const vec4 c1 = vec4(1, 0.0425, 1.04, -0.04);
    vec4 r = roughness * c0 + c1;
    float a004 = min(r.x * r.x, exp2(-9.28 * dotNV)) * r.x + r.y;
    vec2 AB = vec2(-1.04, 1.04) * a004 + r.zw;
    return specularColor * AB.x + AB.y;
}

void RE_Direct_Physical(const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
    float dotNL = saturate(dot(geometry.normal, directLight.direction));
    vec3 irradiance = dotNL * directLight.color;
    irradiance *= PI; // punctual light

    reflectedLight.directSpecular += irradiance * BRDF_Specular_GGX(directLight, geometry, material.specularColor, material.specularRoughness);
    reflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert(material.diffuseColor);
}

void RE_IndirectDiffuse_Physical(const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
    reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert(material.diffuseColor);
}
`,Bwe=`
float matrixScale(in mat4 m){
    vec4 r = m[0];
    return sqrt(r[0] * r[0] + r[1] * r[1] + r[2] * r[2]);
}
`,Fwe=`
varying vec3 vNormal;
`,Lwe=`
vec4 readFromTexture(const in sampler2D tex, const in float i, const in vec2 dim) {
    float x = intMod(i, dim.x);
    float y = floor(intDiv(i, dim.x));
    vec2 uv = (vec2(x, y) + 0.5) / dim;
    return texture2D(tex, uv);
}

vec4 readFromTexture(const in sampler2D tex, const in int i, const in vec2 dim) {
    int x = imod(i, int(dim.x));
    int y = i / int(dim.x);
    vec2 uv = (vec2(x, y) + 0.5) / dim;
    return texture2D(tex, uv);
}
`,Nwe=`
    // rgbaToFloat adapted from https://github.com/ihmeuw/glsl-rgba-to-float
    // BSD 3-Clause License
    //
    // Copyright (c) 2019, Institute for Health Metrics and Evaluation All rights reserved.
    // Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:
    //  - Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
    //  - Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.
    //  - Neither the name of the copyright holder nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.
    //
    // THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES,
    // INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
    // IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY,
    // OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA,
    // OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
    // OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED
    // OF THE POSSIBILITY OF SUCH DAMAGE.

    ivec4 floatsToBytes(vec4 inputFloats, bool littleEndian) {
        ivec4 bytes = ivec4(inputFloats * 255.0);
        return (
            littleEndian
                ? bytes.abgr
                : bytes
        );
    }

    // Break the four bytes down into an array of 32 bits.
    void bytesToBits(const in ivec4 bytes, out bool bits[32]) {
        for (int channelIndex = 0; channelIndex < 4; ++channelIndex) {
            float acc = float(bytes[channelIndex]);
            for (int indexInByte = 7; indexInByte >= 0; --indexInByte) {
                float powerOfTwo = exp2(float(indexInByte));
                bool bit = acc >= powerOfTwo;
                bits[channelIndex * 8 + (7 - indexInByte)] = bit;
                acc = mod(acc, powerOfTwo);
            }
        }
    }

    // Compute the exponent of the 32-bit float.
    float getExponent(bool bits[32]) {
        const int startIndex = 1;
        const int bitStringLength = 8;
        const int endBeforeIndex = startIndex + bitStringLength;
        float acc = 0.0;
        int pow2 = bitStringLength - 1;
        for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {
            acc += float(bits[bitIndex]) * exp2(float(pow2--));
        }
        return acc;
    }

    // Compute the mantissa of the 32-bit float.
    float getMantissa(bool bits[32], bool subnormal) {
        const int startIndex = 9;
        const int bitStringLength = 23;
        const int endBeforeIndex = startIndex + bitStringLength;
        // Leading/implicit/hidden bit convention:
        // If the number is not subnormal (with exponent 0), we add a leading 1 digit.
        float acc = float(!subnormal) * exp2(float(bitStringLength));
        int pow2 = bitStringLength - 1;
        for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {
            acc += float(bits[bitIndex]) * exp2(float(pow2--));
        }
        return acc;
    }

    // Parse the float from its 32 bits.
    float bitsToFloat(bool bits[32]) {
        float signBit = float(bits[0]) * -2.0 + 1.0;
        float exponent = getExponent(bits);
        bool subnormal = abs(exponent - 0.0) < 0.01;
        float mantissa = getMantissa(bits, subnormal);
        float exponentBias = 127.0;
        return signBit * mantissa * exp2(exponent - exponentBias - 23.0);
    }

    float rgbaToFloat(vec4 texelRGBA, bool littleEndian) {
        ivec4 rgbaBytes = floatsToBytes(texelRGBA, littleEndian);
        bool bits[32];
        bytesToBits(rgbaBytes, bits);
        return bitsToFloat(bits);
    }
`,zwe=`
#if defined(dSizeType_uniform)
    uniform float uSize;
#elif defined(dSizeType_attribute)
    attribute float aSize;
#elif defined(dSizeType_instance) || defined(dSizeType_group) || defined(dSizeType_groupInstance)
    uniform vec2 uSizeTexDim;
    uniform sampler2D tSize;
#endif

uniform float uSizeFactor;
`,Uwe=`
vec4 texture3dFrom1dTrilinear(const in sampler2D tex, const in vec3 pos, const in vec3 gridDim, const in vec2 texDim, const in float offset) {
    float gdYZ = gridDim.z * gridDim.y;
    float gdZ = gridDim.z;
    vec3 p0 = floor(pos * gridDim);
    vec3 p1 = ceil(pos * gridDim);
    vec3 pd = (pos * gridDim - p0) / (p1 - p0);
    vec4 s000 = readFromTexture(tex, offset + p0.z + p0.y * gdZ + p0.x * gdYZ, texDim);
    vec4 s100 = readFromTexture(tex, offset + p0.z + p0.y * gdZ + p1.x * gdYZ, texDim);
    vec4 s001 = readFromTexture(tex, offset + p1.z + p0.y * gdZ + p0.x * gdYZ, texDim);
    vec4 s101 = readFromTexture(tex, offset + p1.z + p0.y * gdZ + p1.x * gdYZ, texDim);
    vec4 s010 = readFromTexture(tex, offset + p0.z + p1.y * gdZ + p0.x * gdYZ, texDim);
    vec4 s110 = readFromTexture(tex, offset + p0.z + p1.y * gdZ + p1.x * gdYZ, texDim);
    vec4 s011 = readFromTexture(tex, offset + p1.z + p1.y * gdZ + p0.x * gdYZ, texDim);
    vec4 s111 = readFromTexture(tex, offset + p1.z + p1.y * gdZ + p1.x * gdYZ, texDim);
    vec4 s00 = mix(s000, s100, pd.x);
    vec4 s01 = mix(s001, s101, pd.x);
    vec4 s10 = mix(s010, s110, pd.x);
    vec4 s11 = mix(s011, s111, pd.x);
    vec4 s0 = mix(s00, s10, pd.y);
    vec4 s1 = mix(s01, s11, pd.y);
    return mix(s0, s1, pd.z);
}
`,Vwe=`
vec4 texture3dFrom2dLinear(sampler2D tex, vec3 pos, vec3 gridDim, vec2 texDim) {
    float zSlice0 = floor(pos.z * gridDim.z);
    float column0 = intMod(zSlice0 * gridDim.x, texDim.x) / gridDim.x;
    float row0 = floor(intDiv(zSlice0 * gridDim.x, texDim.x));
    vec2 coord0 = (vec2(column0 * gridDim.x, row0 * gridDim.y) + (pos.xy * gridDim.xy)) / texDim;
    vec4 color0 = texture2D(tex, coord0);

    float zSlice1 = zSlice0 + 1.0;
    float column1 = intMod(zSlice1 * gridDim.x, texDim.x) / gridDim.x;
    float row1 = floor(intDiv(zSlice1 * gridDim.x, texDim.x));
    vec2 coord1 = (vec2(column1 * gridDim.x, row1 * gridDim.y) + (pos.xy * gridDim.xy)) / texDim;
    vec4 color1 = texture2D(tex, coord1);

    float delta0 = abs((pos.z * gridDim.z) - zSlice0);
    return mix(color0, color1, delta0);
}
`,Hwe=`
vec4 texture3dFrom2dNearest(sampler2D tex, vec3 pos, vec3 gridDim, vec2 texDim) {
    float zSlice = floor(pos.z * gridDim.z + 0.5); // round to nearest z-slice
    float column = intMod(zSlice * gridDim.x, texDim.x) / gridDim.x;
    float row = floor(intDiv(zSlice * gridDim.x, texDim.x));
    vec2 coord = (vec2(column * gridDim.x, row * gridDim.y) + (pos.xy * gridDim.xy)) / texDim;
    return texture2D(tex, coord);
}
`,jwe=`
#if defined(dRenderVariant_colorWboit)
    #if !defined(dRenderMode_volume) && !defined(dRenderMode_isosurface)
        uniform sampler2D tDepth;
        uniform vec2 uDrawingBufferSize;

        float getDepth(const in vec2 coords) {
            // always packed due to merged depth from primitives and volumes
            return unpackRGBAToDepth(texture2D(tDepth, coords));
        }
    #endif
#endif

uniform bool uRenderWboit;

float calcDepth(const in vec3 pos) {
    vec2 clipZW = pos.z * uProjection[2].zw + uProjection[3].zw;
    return 0.5 + 0.5 * clipZW.x / clipZW.y;
}
`,Gwe=`
#if defined(dRenderVariant_colorWboit)
    if (!uRenderWboit) {
        if (preFogAlpha < 1.0) {
            discard;
        }
    } else if (uRenderWboit) {
        // the 'fragmentDepth > 0.99' check is to handle precision issues with packed depth
        if (preFogAlpha != 1.0 && !interior && (fragmentDepth < getDepth(gl_FragCoord.xy / uDrawingBufferSize) || fragmentDepth > 0.99)) {
            float alpha = gl_FragColor.a;
            float wboitWeight = alpha * clamp(pow(1.0 - fragmentDepth, 2.0), 0.01, 1.0);
            gl_FragColor = vec4(gl_FragColor.rgb * alpha * wboitWeight, alpha);
            // extra alpha is to handle pre-multiplied alpha
            #if !defined(dRenderMode_volume) && !defined(dRenderMode_isosurface)
                gl_FragData[1] = vec4((uTransparentBackground ? alpha : 1.0) * alpha * wboitWeight);
            #else
                gl_FragData[1] = vec4(alpha * alpha * wboitWeight);
            #endif
        } else {
            discard;
        }
    }
#endif
`,qwe=`
precision highp float;
precision highp int;

#include common
#include read_from_texture
#include common_vert_params
#include color_vert_params
#include size_vert_params
#include common_clip

uniform float uPixelRatio;
uniform float uViewportHeight;

attribute vec3 aPosition;
attribute mat4 aTransform;
attribute float aInstance;
attribute float aGroup;

void main(){
    #include assign_group
    #include assign_color_varying
    #include assign_marker_varying
    #include assign_clipping_varying
    #include assign_position
    #include assign_size

    #ifdef dPointSizeAttenuation
        gl_PointSize = size * uPixelRatio * ((uViewportHeight / 2.0) / -mvPosition.z) * 5.0;
    #else
        gl_PointSize = size * uPixelRatio;
    #endif

    gl_Position = uProjection * mvPosition;

    #include clip_instance
}
`,Wwe=`
precision highp float;
precision highp int;

#include common
#include common_frag_params
#include color_frag_params
#include common_clip
#include wboit_params

#ifdef dPointFilledCircle
    uniform float uPointEdgeBleach;
#endif

const vec2 center = vec2(0.5);
const float radius = 0.5;

void main(){
    #include clip_pixel

    float fragmentDepth = gl_FragCoord.z;
    bool interior = false;
    #include assign_material_color

    #if defined(dRenderVariant_pick)
        #include check_picking_alpha
        gl_FragColor = material;
    #elif defined(dRenderVariant_depth)
        gl_FragColor = material;
    #elif defined(dRenderVariant_color)
        gl_FragColor = material;

        #ifdef dPointFilledCircle
            float dist = distance(gl_PointCoord, center);
            float alpha = 1.0 - smoothstep(radius - uPointEdgeBleach, radius, dist);
            if (alpha < 0.0001) discard;
            gl_FragColor.a *= alpha;
        #endif

        #include apply_marker_color
        #include apply_fog
        #include wboit_write
    #endif
}
`,Xwe=`
precision highp float;
precision highp int;

#include common
#include read_from_texture
#include common_vert_params
#include color_vert_params
#include size_vert_params
#include common_clip

uniform mat4 uModelView;
uniform mat4 uInvProjection;

attribute vec3 aPosition;
attribute vec2 aMapping;
attribute mat4 aTransform;
attribute float aInstance;
attribute float aGroup;

varying float vRadius;
varying float vRadiusSq;
varying vec3 vPoint;
varying vec3 vPointViewPosition;

#include matrix_scale

const mat4 D = mat4(
    1.0, 0.0, 0.0, 0.0,
    0.0, 1.0, 0.0, 0.0,
    0.0, 0.0, 1.0, 0.0,
    0.0, 0.0, 0.0, -1.0
);

/**
 * Compute point size and center using the technique described in:
 * "GPU-Based Ray-Casting of Quadratic Surfaces" http://dl.acm.org/citation.cfm?id=2386396
 * by Christian Sigg, Tim Weyrich, Mario Botsch, Markus Gross.
 */
void quadraticProjection(const in float radius, const in vec3 position){
    vec2 xbc, ybc;

    mat4 T = mat4(
        radius, 0.0, 0.0, 0.0,
        0.0, radius, 0.0, 0.0,
        0.0, 0.0, radius, 0.0,
        position.x, position.y, position.z, 1.0
    );

    mat4 R = transpose4(uProjection * uModelView * aTransform * T);
    float A = dot(R[3], D * R[3]);
    float B = -2.0 * dot(R[0], D * R[3]);
    float C = dot(R[0], D * R[0]);
    xbc[0] = (-B - sqrt(B * B - 4.0 * A * C)) / (2.0 * A);
    xbc[1] = (-B + sqrt(B * B - 4.0 * A * C)) / (2.0 * A);
    float sx = abs(xbc[0] - xbc[1]) * 0.5;

    A = dot(R[3], D * R[3]);
    B = -2.0 * dot(R[1], D * R[3]);
    C = dot(R[1], D * R[1]);
    ybc[0] = (-B - sqrt(B * B - 4.0 * A * C)) / (2.0 * A);
    ybc[1] = (-B + sqrt(B * B - 4.0 * A * C)) / (2.0 * A);
    float sy = abs(ybc[0] - ybc[1]) * 0.5;

    gl_Position.xy = vec2(0.5 * (xbc.x + xbc.y), 0.5 * (ybc.x + ybc.y));
    gl_Position.xy -= aMapping * vec2(sx, sy);
    gl_Position.xy *= gl_Position.w;
}


void main(void){
    #include assign_group
    #include assign_color_varying
    #include assign_marker_varying
    #include assign_clipping_varying
    #include assign_size

    vRadius = size * matrixScale(uModelView);

    vec4 position4 = vec4(aPosition, 1.0);
    vec4 mvPosition = uModelView * aTransform * position4;
    mvPosition.z -= vRadius; // avoid clipping, added again in fragment shader

    gl_Position = uProjection * vec4(mvPosition.xyz, 1.0);
    quadraticProjection(size, aPosition);

    vRadiusSq = vRadius * vRadius;
    vec4 vPoint4 = uInvProjection * gl_Position;
    vPoint = vPoint4.xyz / vPoint4.w;
    vPointViewPosition = -mvPosition.xyz / mvPosition.w;

    vModelPosition = (uModel * aTransform * position4).xyz; // for clipping in frag shader

    #include clip_instance
}
`,Ywe=`
precision highp float;
precision highp int;

#include common
#include common_frag_params
#include color_frag_params
#include light_frag_params
#include common_clip
#include wboit_params

varying float vRadius;
varying float vRadiusSq;
varying vec3 vPoint;
varying vec3 vPointViewPosition;

vec3 cameraPos;
vec3 cameraNormal;

bool Impostor(out vec3 cameraPos, out vec3 cameraNormal){
    vec3 cameraSpherePos = -vPointViewPosition;
    cameraSpherePos.z += vRadius;

    vec3 rayOrigin = mix(vec3(0.0, 0.0, 0.0), vPoint, uIsOrtho);
    vec3 rayDirection = mix(normalize(vPoint), vec3(0.0, 0.0, 1.0), uIsOrtho);
    vec3 cameraSphereDir = mix(cameraSpherePos, rayOrigin - cameraSpherePos, uIsOrtho);

    float B = dot(rayDirection, cameraSphereDir);
    float det = B * B + vRadiusSq - dot(cameraSphereDir, cameraSphereDir);

    if (det < 0.0){
        discard;
        return false;
    }

    float sqrtDet = sqrt(det);
    float posT = mix(B + sqrtDet, B + sqrtDet, uIsOrtho);
    float negT = mix(B - sqrtDet, sqrtDet - B, uIsOrtho);

    cameraPos = rayDirection * negT + rayOrigin;


    if (calcDepth(cameraPos) <= 0.0) {
        cameraPos = rayDirection * posT + rayOrigin;
        interior = true;
    } else {
        interior = false;
    }

    cameraNormal = normalize(cameraPos - cameraSpherePos);
    cameraNormal *= float(!interior) * 2.0 - 1.0;

    return !interior;
}

void main(void){
    #include clip_pixel

    bool flag = Impostor(cameraPos, cameraNormal);
    #ifndef dDoubleSided
        if (interior)
            discard;
    #endif

    vec3 vViewPosition = cameraPos;
    gl_FragDepthEXT = calcDepth(vViewPosition);
    if (!flag && gl_FragDepthEXT >= 0.0) {
        gl_FragDepthEXT = 0.0 + (0.0000001 / vRadius);
    }

    // bugfix (mac only?)
    if (gl_FragDepthEXT < 0.0) discard;
    if (gl_FragDepthEXT > 1.0) discard;

    float fragmentDepth = gl_FragDepthEXT;
    #include assign_material_color

    #if defined(dRenderVariant_pick)
        #include check_picking_alpha
        gl_FragColor = material;
    #elif defined(dRenderVariant_depth)
        gl_FragColor = material;
    #elif defined(dRenderVariant_color)
        #ifdef dIgnoreLight
            gl_FragColor = material;
        #else
            vec3 normal = -cameraNormal;
            #include apply_light_color
        #endif

        #include apply_interior_color
        #include apply_marker_color
        #include apply_fog
        #include wboit_write
    #endif
}
`,Kwe=`
precision highp float;
precision highp int;

#include common
#include read_from_texture
#include common_vert_params
#include color_vert_params
#include size_vert_params
#include common_clip

uniform mat4 uModelView;

attribute mat4 aTransform;
attribute float aInstance;
attribute float aGroup;

attribute vec3 aMapping;
attribute vec3 aStart;
attribute vec3 aEnd;
attribute float aScale;
attribute float aCap;

varying mat4 vTransform;
varying vec3 vStart;
varying vec3 vEnd;
varying float vSize;
varying float vCap;

uniform float uIsOrtho;
uniform vec3 uCameraDir;

void main() {
    #include assign_group
    #include assign_color_varying
    #include assign_marker_varying
    #include assign_clipping_varying
    #include assign_size

    mat4 modelTransform = uModel * aTransform;

    vTransform = aTransform;
    vStart = (modelTransform * vec4(aStart, 1.0)).xyz;
    vEnd = (modelTransform * vec4(aEnd, 1.0)).xyz;
    vSize = size * aScale;
    vCap = aCap;

    vModelPosition = (vStart + vEnd) * 0.5;
    vec3 camDir = -mix(normalize(vModelPosition - uCameraPosition), uCameraDir, uIsOrtho);
    vec3 dir = vEnd - vStart;
    // ensure cylinder 'dir' is pointing towards the camera
    if(dot(camDir, dir) < 0.0) dir = -dir;

    vec3 left = cross(camDir, dir);
    vec3 up = cross(left, dir);
    left = vSize * normalize(left);
    up = vSize * normalize(up);

    // move vertex in object-space from center to corner
    vModelPosition += aMapping.x * dir + aMapping.y * left + aMapping.z * up;

    vec4 mvPosition = uView * vec4(vModelPosition, 1.0);
    vViewPosition = mvPosition.xyz;
    gl_Position = uProjection * mvPosition;

    #include clip_instance
}
`,$we=`
precision highp float;
precision highp int;

uniform mat4 uView;

varying mat4 vTransform;
varying vec3 vStart;
varying vec3 vEnd;
varying float vSize;
varying float vCap;

uniform vec3 uCameraDir;
uniform vec3 uCameraPosition;

#include common
#include common_frag_params
#include color_frag_params
#include light_frag_params
#include common_clip
#include wboit_params

// adapted from https://www.shadertoy.com/view/4lcSRn
// The MIT License, Copyright 2016 Inigo Quilez
bool CylinderImpostor(
    in vec3 rayOrigin, in vec3 rayDir,
    in vec3 start, in vec3 end, in float radius,
    out vec4 intersection, out bool interior
){
    vec3 ba = end - start;
    vec3 oc = rayOrigin - start;

    float baba = dot(ba, ba);
    float bard = dot(ba, rayDir);
    float baoc = dot(ba, oc);

    float k2 = baba - bard*bard;
    float k1 = baba * dot(oc, rayDir) - baoc * bard;
    float k0 = baba * dot(oc, oc) - baoc * baoc - radius * radius * baba;

    float h = k1 * k1 - k2 * k0;
    if (h < 0.0) return false;

    bool topCap = (vCap > 0.9 && vCap < 1.1) || vCap >= 2.9;
    bool bottomCap = (vCap > 1.9 && vCap < 2.1) || vCap >= 2.9;

    // body outside
    h = sqrt(h);
    float t = (-k1 - h) / k2;
    float y = baoc + t * bard;
    if (y > 0.0 && y < baba) {
        interior = false;
        intersection = vec4(t, (oc + t * rayDir - ba * y / baba) / radius);
        return true;
    }

    if (topCap && y < 0.0) {
        // top cap
        t = -baoc / bard;
        if (abs(k1 + k2 * t) < h) {
            interior = false;
            intersection = vec4(t, ba * sign(y) / baba);
            return true;
        }
    } else if(bottomCap && y >= 0.0) {
        // bottom cap
        t = (baba - baoc) / bard;
        if (abs(k1 + k2 * t) < h) {
            interior = false;
            intersection = vec4(t, ba * sign(y) / baba);
            return true;
        }
    }

    #ifdef dDoubleSided
        // body inside
        h = -h;
        t = (-k1 - h) / k2;
        y = baoc + t * bard;
        if (y > 0.0 && y < baba) {
            interior = true;
            intersection = vec4(t, (oc + t * rayDir - ba * y / baba) / radius);
            return true;
        }

        // TODO: handle inside caps???
    #endif

    return false;
}

void main() {
    #include clip_pixel

    vec3 rayDir = mix(normalize(vModelPosition - uCameraPosition), uCameraDir, uIsOrtho);

    vec4 intersection;
    bool interior;
    bool hit = CylinderImpostor(vModelPosition, rayDir, vStart, vEnd, vSize, intersection, interior);
    if (!hit) discard;

    vec3 vViewPosition = vModelPosition + intersection.x * rayDir;
    vViewPosition = (uView * vec4(vViewPosition, 1.0)).xyz;
    gl_FragDepthEXT = calcDepth(vViewPosition);

    // bugfix (mac only?)
    if (gl_FragDepthEXT < 0.0) discard;
    if (gl_FragDepthEXT > 1.0) discard;

    float fragmentDepth = gl_FragDepthEXT;
    #include assign_material_color

    #if defined(dRenderVariant_pick)
        #include check_picking_alpha
        gl_FragColor = material;
    #elif defined(dRenderVariant_depth)
        gl_FragColor = material;
    #elif defined(dRenderVariant_color)
        #ifdef dIgnoreLight
            gl_FragColor = material;
        #else
            mat3 normalMatrix = transpose3(inverse3(mat3(uView)));
            vec3 normal = normalize(normalMatrix * -normalize(intersection.yzw));
            #include apply_light_color
        #endif

        #include apply_interior_color
        #include apply_marker_color
        #include apply_fog
        #include wboit_write
    #endif
}
`,Qwe=`
precision highp float;
precision highp int;

#include common
#include read_from_texture
#include common_vert_params
#include color_vert_params
#include size_vert_params
#include common_clip

uniform mat4 uModelView;

attribute vec3 aPosition;
attribute vec2 aMapping;
attribute float aDepth;
attribute vec2 aTexCoord;
attribute mat4 aTransform;
attribute float aInstance;
attribute float aGroup;

uniform float uOffsetX;
uniform float uOffsetY;
uniform float uOffsetZ;

// uniform bool ortho;
uniform float uPixelRatio;
uniform float uViewportHeight;

varying vec2 vTexCoord;

#include matrix_scale

void main(void){
    #include assign_group
    #include assign_color_varying
    #include assign_marker_varying
    #include assign_clipping_varying
    #include assign_size

    vTexCoord = aTexCoord;

    float scale = matrixScale(uModelView);

    float offsetX = uOffsetX * scale;
    float offsetY = uOffsetY * scale;
    float offsetZ = (uOffsetZ + aDepth * 0.95) * scale;

    vec4 position4 = vec4(aPosition, 1.0);
    vec4 mvPosition = uModelView * aTransform * position4;

    vModelPosition = (uModel * aTransform * position4).xyz; // for clipping in frag shader

    // TODO
    // #ifdef FIXED_SIZE
    //     if (ortho) {
    //         scale /= pixelRatio * ((uViewportHeight / 2.0) / -uCameraPosition.z) * 0.1;
    //     } else {
    //         scale /= pixelRatio * ((uViewportHeight / 2.0) / -mvPosition.z) * 0.1;
    //     }
    // #endif

    vec4 mvCorner = vec4(mvPosition.xyz, 1.0);

    if (vTexCoord.x == 10.0) { // indicates background plane
        // move a bit to the back, taking distance to camera into account to avoid z-fighting
        offsetZ -= 0.001 * distance(uCameraPosition, (uProjection * mvCorner).xyz);
    }

    mvCorner.xy += aMapping * size * scale;
    mvCorner.x += offsetX;
    mvCorner.y += offsetY;

    // TODO
    // if(ortho){
    //     mvCorner.xyz += normalize(-uCameraPosition) * offsetZ;
    // } else {
    //     mvCorner.xyz += normalize(-mvCorner.xyz) * offsetZ;
    // }
    mvCorner.xyz += normalize(-mvCorner.xyz) * offsetZ;

    gl_Position = uProjection * mvCorner;

    vViewPosition = -mvCorner.xyz;

    #include clip_instance
}
`,Zwe=`
precision highp float;
precision highp int;

#include common
#include common_frag_params
#include color_frag_params
#include common_clip
#include wboit_params

uniform sampler2D tFont;

uniform vec3 uBorderColor;
uniform float uBorderWidth;
uniform vec3 uBackgroundColor;
uniform float uBackgroundOpacity;

varying vec2 vTexCoord;

const float smoothness = 32.0;
const float gamma = 2.2;

void main2(){
    gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);
}

void main(){
    #include clip_pixel

    float fragmentDepth = gl_FragCoord.z;
    bool interior = false;
    #include assign_material_color

    if (vTexCoord.x > 1.0) {
        gl_FragColor = vec4(uBackgroundColor, uBackgroundOpacity * material.a);
    } else {
        // retrieve signed distance
        float sdf = texture2D(tFont, vTexCoord).a + uBorderWidth;

        // perform adaptive anti-aliasing of the edges
        float w = clamp(smoothness * (abs(dFdx(vTexCoord.x)) + abs(dFdy(vTexCoord.y))), 0.0, 0.5);
        float a = smoothstep(0.5 - w, 0.5 + w, sdf);

        // gamma correction for linear attenuation
        a = pow(a, 1.0 / gamma);

        if (a < 0.5) discard;
        material.a *= a;

        // add border
        float t = 0.5 + uBorderWidth;
        if (uBorderWidth > 0.0 && sdf < t) {
            material.xyz = mix(uBorderColor, material.xyz, smoothstep(t - w, t, sdf));
        }

        gl_FragColor = material;
    }

    #if defined(dRenderVariant_pick)
        #include check_picking_alpha
    #elif defined(dRenderVariant_depth)
        gl_FragColor = material;
    #elif defined(dRenderVariant_color)
        #include apply_marker_color
        #include apply_fog
        #include wboit_write
    #endif
}
`,Jwe=`
precision highp float;
precision highp int;

#include common
#include read_from_texture
#include common_vert_params
#include color_vert_params
#include size_vert_params
#include common_clip

uniform float uPixelRatio;
uniform float uViewportHeight;

attribute mat4 aTransform;
attribute float aInstance;
attribute float aGroup;

attribute vec2 aMapping;
attribute vec3 aStart;
attribute vec3 aEnd;

void trimSegment(const in vec4 start, inout vec4 end) {
    // trim end segment so it terminates between the camera plane and the near plane
    // conservative estimate of the near plane
    float a = uProjection[2][2];  // 3rd entry in 3rd column
    float b = uProjection[3][2];  // 3rd entry in 4th column
    float nearEstimate = -0.5 * b / a;
    float alpha = (nearEstimate - start.z) / (end.z - start.z);
    end.xyz = mix(start.xyz, end.xyz, alpha);
}

void main(){
    #include assign_group
    #include assign_color_varying
    #include assign_marker_varying
    #include assign_clipping_varying
    #include assign_size

    mat4 modelView = uView * uModel * aTransform;

    // camera space
    vec4 start = modelView * vec4(aStart, 1.0);
    vec4 end = modelView * vec4(aEnd, 1.0);

    // assign position
    vec4 position4 = vec4((aMapping.y < 0.5) ? aStart : aEnd, 1.0);
    vec4 mvPosition = modelView * position4;
    vViewPosition = mvPosition.xyz;

    vModelPosition = (uModel * aTransform * position4).xyz; // for clipping in frag shader

    // special case for perspective projection, and segments that terminate either in, or behind, the camera plane
    // clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
    // but we need to perform ndc-space calculations in the shader, so we must address this issue directly
    // perhaps there is a more elegant solution -- WestLangley
    bool perspective = (uProjection[2][3] == -1.0); // 4th entry in the 3rd column
    if (perspective) {
        if (start.z < 0.0 && end.z >= 0.0) {
            trimSegment(start, end);
        } else if (end.z < 0.0 && start.z >= 0.0) {
            trimSegment(end, start);
        }
    }

    // clip space
    vec4 clipStart = uProjection * start;
    vec4 clipEnd = uProjection * end;

    // ndc space
    vec2 ndcStart = clipStart.xy / clipStart.w;
    vec2 ndcEnd = clipEnd.xy / clipEnd.w;

    // direction
    vec2 dir = ndcEnd - ndcStart;

    // account for clip-space aspect ratio
    dir.x *= uPixelRatio;
    dir = normalize(dir);

    // perpendicular to dir
    vec2 offset = vec2(dir.y, - dir.x);

    // undo aspect ratio adjustment
    dir.x /= uPixelRatio;
    offset.x /= uPixelRatio;

    // sign flip
    if (aMapping.x < 0.0) offset *= -1.0;

    // calculate linewidth
    float linewidth;
    #ifdef dLineSizeAttenuation
        linewidth = size * uPixelRatio * ((uViewportHeight / 2.0) / -start.z) * 5.0;
    #else
        linewidth = size * uPixelRatio;
    #endif

    // adjust for linewidth
    offset *= linewidth;

    // adjust for clip-space to screen-space conversion
    offset /= uViewportHeight;

    // select end
    vec4 clip = (aMapping.y < 0.5) ? clipStart : clipEnd;

    // back to clip space
    offset *= clip.w;
    clip.xy += offset;
    gl_Position = clip;

    #include clip_instance
}
`,e_e=`
precision highp float;
precision highp int;

#include common
#include common_frag_params
#include color_frag_params
#include common_clip
#include wboit_params

void main(){
    #include clip_pixel

    bool interior = false;
    float fragmentDepth = gl_FragCoord.z;
    #include assign_material_color

    #if defined(dRenderVariant_pick)
        #include check_picking_alpha
        gl_FragColor = material;
    #elif defined(dRenderVariant_depth)
        gl_FragColor = material;
    #elif defined(dRenderVariant_color)
        gl_FragColor = material;

        #include apply_marker_color
        #include apply_fog
        #include wboit_write
    #endif
}
`,t_e=`
precision highp float;
precision highp int;
precision highp sampler2D;

#include common
#include read_from_texture
#include common_vert_params
#include color_vert_params
#include common_clip

#if defined(dColorType_grid)
    #include texture3d_from_2d_linear
#endif

#ifdef dGeoTexture
    uniform vec2 uGeoTexDim;
    uniform sampler2D tPosition;
    uniform sampler2D tGroup;
    uniform sampler2D tNormal;
#else
    attribute vec3 aPosition;
    attribute float aGroup;
    attribute vec3 aNormal;
#endif
attribute mat4 aTransform;
attribute float aInstance;

varying vec3 vNormal;

void main(){
    #include assign_group
    #include assign_marker_varying
    #include assign_clipping_varying
    #include assign_position
    #include assign_color_varying
    #include clip_instance

    #ifdef dGeoTexture
        vec3 normal = readFromTexture(tNormal, VertexID, uGeoTexDim).xyz;
    #else
        vec3 normal = aNormal;
    #endif
    mat3 normalMatrix = transpose3(inverse3(mat3(modelView)));
    vec3 transformedNormal = normalize(normalMatrix * normalize(normal));
    #if defined(dFlipSided) && !defined(dDoubleSided) // TODO checking dDoubleSided should not be required, ASR
        transformedNormal = -transformedNormal;
    #endif
    vNormal = transformedNormal;
}
`,r_e=`
precision highp float;
precision highp int;

#include common
#include common_frag_params
#include color_frag_params
#include light_frag_params
#include normal_frag_params
#include common_clip
#include wboit_params

void main() {
    #include clip_pixel

    // Workaround for buggy gl_FrontFacing (e.g. on some integrated Intel GPUs)
    #if defined(enabledStandardDerivatives)
        vec3 fdx = dFdx(vViewPosition);
        vec3 fdy = dFdy(vViewPosition);
        vec3 faceNormal = normalize(cross(fdx,fdy));
        bool frontFacing = dot(vNormal, faceNormal) > 0.0;
    #else
        bool frontFacing = dot(vNormal, vViewPosition) < 0.0;
    #endif

    #if defined(dFlipSided)
        interior = frontFacing;
    #else
        interior = !frontFacing;
    #endif

    float fragmentDepth = gl_FragCoord.z;
    #include assign_material_color

    #if defined(dRenderVariant_pick)
        #include check_picking_alpha
        gl_FragColor = material;
    #elif defined(dRenderVariant_depth)
        gl_FragColor = material;
    #elif defined(dRenderVariant_color)
        #ifdef dIgnoreLight
            gl_FragColor = material;
        #else
            #if defined(dFlatShaded) && defined(enabledStandardDerivatives)
                vec3 normal = -faceNormal;
            #else
                vec3 normal = -normalize(vNormal);
                #ifdef dDoubleSided
                    normal = normal * (float(frontFacing) * 2.0 - 1.0);
                #endif
            #endif
            #include apply_light_color
        #endif

        #include apply_interior_color
        #include apply_marker_color
        #include apply_fog
        #include wboit_write
    #endif
}
`,n_e=`
precision highp float;

attribute vec3 aPosition;
attribute mat4 aTransform;
attribute float aInstance;

uniform mat4 uModelView;
uniform mat4 uProjection;
uniform vec4 uInvariantBoundingSphere;

varying vec3 vOrigPos;
varying float vInstance;
varying vec4 vBoundingSphere;
varying mat4 vTransform;

uniform vec3 uBboxSize;
uniform vec3 uBboxMin;
uniform vec3 uBboxMax;
uniform vec3 uGridDim;
uniform mat4 uTransform;

uniform mat4 uUnitToCartn;

void main() {
    vec4 unitCoord = vec4(aPosition + vec3(0.5), 1.0);
    vec4 mvPosition = uModelView * aTransform * uUnitToCartn * unitCoord;

    vOrigPos = (aTransform * uUnitToCartn * unitCoord).xyz;
    vInstance = aInstance;
    vBoundingSphere = vec4(
        (aTransform * vec4(uInvariantBoundingSphere.xyz, 1.0)).xyz,
        uInvariantBoundingSphere.w
    );
    vTransform = aTransform;

    gl_Position = uProjection * mvPosition;

    // move z position to near clip plane (but not too close to get precision issues)
    gl_Position.z = gl_Position.w - 0.01;
}
`,a_e=`
precision highp float;
precision highp int;

#include common
#include light_frag_params

#if dClipObjectCount != 0
    uniform int uClipObjectType[dClipObjectCount];
    uniform bool uClipObjectInvert[dClipObjectCount];
    uniform vec3 uClipObjectPosition[dClipObjectCount];
    uniform vec4 uClipObjectRotation[dClipObjectCount];
    uniform vec3 uClipObjectScale[dClipObjectCount];
#endif
#include common_clip

#include read_from_texture
#include texture3d_from_1d_trilinear
#include texture3d_from_2d_nearest
#include texture3d_from_2d_linear

uniform mat4 uProjection, uTransform, uModelView, uModel, uView;
uniform vec3 uCameraDir;

uniform sampler2D tDepth;
uniform vec2 uDrawingBufferSize;

varying vec3 vOrigPos;
varying float vInstance;
varying vec4 vBoundingSphere;
varying mat4 vTransform;

uniform mat4 uInvView;
uniform vec2 uIsoValue;
uniform vec3 uGridDim;
uniform vec3 uBboxSize;
uniform sampler2D tTransferTex;
uniform float uTransferScale;
uniform float uStepScale;
uniform float uJumpLength;

uniform int uObjectId;
uniform int uVertexCount;
uniform int uInstanceCount;
uniform int uGroupCount;

uniform vec3 uHighlightColor;
uniform vec3 uSelectColor;
uniform vec2 uMarkerTexDim;
uniform sampler2D tMarker;

uniform float uFogNear;
uniform float uFogFar;
uniform vec3 uFogColor;

uniform float uAlpha;
uniform float uPickingAlphaThreshold;
uniform bool uTransparentBackground;

uniform float uInteriorDarkening;
uniform bool uInteriorColorFlag;
uniform vec3 uInteriorColor;
bool interior;

uniform float uNear;
uniform float uFar;
uniform float uIsOrtho;

uniform vec3 uCellDim;
uniform vec3 uCameraPosition;
uniform mat4 uCartnToUnit;

#if __VERSION__ != 100
    // for webgl1 this is given as a 'define'
    uniform int uMaxSteps;
#endif

#if defined(dGridTexType_2d)
    precision highp sampler2D;
    uniform sampler2D tGridTex;
    uniform vec3 uGridTexDim;
#elif defined(dGridTexType_3d)
    precision highp sampler3D;
    uniform sampler3D tGridTex;
#endif

#if defined(dRenderVariant_color)
    #if defined(dColorType_uniform)
        uniform vec3 uColor;
    #elif defined(dColorType_texture)
        uniform vec2 uColorTexDim;
        uniform sampler2D tColor;
    #endif

    #ifdef dOverpaint
        varying vec4 vOverpaint;
        uniform vec2 uOverpaintTexDim;
        uniform sampler2D tOverpaint;
    #endif
#endif

#if defined(dGridTexType_2d)
    vec4 textureVal(vec3 pos) {
        return texture3dFrom2dLinear(tGridTex, pos + (vec3(0.5, 0.5, 0.0) / uGridDim), uGridDim, uGridTexDim.xy);
    }
    vec4 textureGroup(vec3 pos) {
        return texture3dFrom2dNearest(tGridTex, pos + (vec3(0.5, 0.5, 0.0) / uGridDim), uGridDim, uGridTexDim.xy);
    }
#elif defined(dGridTexType_3d)
    vec4 textureVal(vec3 pos) {
        return texture(tGridTex, pos + (vec3(0.5) / uGridDim));
    }
    vec4 textureGroup(vec3 pos) {
        return texelFetch(tGridTex, ivec3(pos * uGridDim), 0);
    }
#endif

#include wboit_params

vec4 transferFunction(float value) {
    return texture2D(tTransferTex, vec2(value, 0.0));
}

float getDepth(const in vec2 coords) {
    #ifdef depthTextureSupport
        if (!uRenderWboit) {
            // in case of opaque volumes (and depth texture support)
            return texture2D(tDepth, coords).r;
        } else {
            return unpackRGBAToDepth(texture2D(tDepth, coords));
        }
    #else
        return unpackRGBAToDepth(texture2D(tDepth, coords));
    #endif
}

const float gradOffset = 0.5;

vec3 v3m4(vec3 p, mat4 m) {
    return (m * vec4(p, 1.0)).xyz;
}

float preFogAlphaBlended = 0.0;

vec4 raymarch(vec3 startLoc, vec3 step, vec3 rayDir) {
    #if defined(dRenderVariant_color) && !defined(dIgnoreLight)
        mat3 normalMatrix = transpose3(inverse3(mat3(uModelView * vTransform)));
    #endif
    mat4 cartnToUnit = uCartnToUnit * inverse4(vTransform);
    #if defined(dClipVariant_pixel) && dClipObjectCount != 0
        mat4 modelTransform = uModel * vTransform * uTransform;
    #endif
    mat4 modelViewTransform = uModelView * vTransform * uTransform;

    vec3 scaleVol = vec3(1.0) / uGridDim;
    vec3 pos = startLoc;
    vec4 cell;
    float prevValue = -1.0;
    float value = 0.0;
    vec4 src = vec4(0.0);
    vec4 dst = vec4(0.0);
    bool hit = false;
    float fragmentDepth;

    vec3 posMin = vec3(0.0);
    vec3 posMax = vec3(1.0) - vec3(1.0) / uGridDim;

    vec3 unitPos;
    vec3 isoPos;

    vec3 nextPos;
    float nextValue;

    vec3 color = vec3(0.45, 0.55, 0.8);
    vec3 gradient = vec3(1.0);
    vec3 dx = vec3(gradOffset * scaleVol.x, 0.0, 0.0);
    vec3 dy = vec3(0.0, gradOffset * scaleVol.y, 0.0);
    vec3 dz = vec3(0.0, 0.0, gradOffset * scaleVol.z);

    float maxDist = min(vBoundingSphere.w * 2.0, uFar - uNear);
    float maxDistSq = maxDist * maxDist;

    for (int i = 0; i < uMaxSteps; ++i) {
        // break when beyond bounding-sphere or far-plane
        vec3 distVec = startLoc - pos;
        if (dot(distVec, distVec) > maxDistSq) break;

        unitPos = v3m4(pos, cartnToUnit);

        // continue when outside of grid
        if (unitPos.x > posMax.x || unitPos.y > posMax.y || unitPos.z > posMax.z ||
            unitPos.x < posMin.x || unitPos.y < posMin.y || unitPos.z < posMin.z
        ) {
            if (hit) break;
            prevValue = value;
            pos += step;
            continue;
        }

        cell = textureVal(unitPos);
        value = cell.a; // current voxel value

        if (uJumpLength > 0.0 && value < 0.01) {
            nextPos = pos + rayDir * uJumpLength;
            nextValue = textureVal(v3m4(nextPos, cartnToUnit)).a;
            if (nextValue < 0.01) {
                prevValue = nextValue;
                pos = nextPos;
                continue;
            }
        }

        #if defined(dRenderMode_isosurface)
            if (prevValue > 0.0 && ( // there was a prev Value
                (prevValue < uIsoValue.x && value > uIsoValue.x) || // entering isosurface
                (prevValue > uIsoValue.x && value < uIsoValue.x) // leaving isosurface
            )) {
                isoPos = v3m4(mix(pos - step, pos, ((prevValue - uIsoValue.x) / ((prevValue - uIsoValue.x) - (value - uIsoValue.x)))), cartnToUnit);

                vec4 mvPosition = modelViewTransform * vec4(isoPos * uGridDim, 1.0);

                #if defined(dClipVariant_pixel) && dClipObjectCount != 0
                    vec3 vModelPosition = v3m4(isoPos * uGridDim, modelTransform);
                    if (clipTest(vec4(vModelPosition, 0.0), 0)) {
                        prevValue = value;
                        pos += step;
                        continue;
                    }
                #endif

                float depth = calcDepth(mvPosition.xyz);
                if (depth > getDepth(gl_FragCoord.xy / uDrawingBufferSize))
                    break;

                #ifdef enabledFragDepth
                    if (!hit) {
                        gl_FragDepthEXT = depth;
                    }
                #endif

                #if defined(dRenderVariant_pickObject)
                    return vec4(encodeFloatRGB(float(uObjectId)), 1.0);
                #elif defined(dRenderVariant_pickInstance)
                    return vec4(encodeFloatRGB(vInstance), 1.0);
                #elif defined(dRenderVariant_pickGroup)
                    #ifdef dPackedGroup
                        return vec4(textureGroup(floor(isoPos * uGridDim + 0.5) / uGridDim).rgb, 1.0);
                    #else
                        vec3 g = floor(isoPos * uGridDim + 0.5);
                        return vec4(encodeFloatRGB(g.z + g.y * uGridDim.z + g.x * uGridDim.z * uGridDim.y), 1.0);
                    #endif
                #elif defined(dRenderVariant_depth)
                    #ifdef enabledFragDepth
                        return packDepthToRGBA(gl_FragDepthEXT);
                    #else
                        return packDepthToRGBA(depth);
                    #endif
                #elif defined(dRenderVariant_color)
                    #ifdef dPackedGroup
                        float group = decodeFloatRGB(textureGroup(floor(isoPos * uGridDim + 0.5) / uGridDim).rgb);
                    #else
                        vec3 g = floor(isoPos * uGridDim + 0.5);
                        float group = g.z + g.y * uGridDim.z + g.x * uGridDim.z * uGridDim.y;
                    #endif

                    #if defined(dColorType_uniform)
                        color = uColor;
                    #elif defined(dColorType_instance)
                        color = readFromTexture(tColor, vInstance, uColorTexDim).rgb;
                    #elif defined(dColorType_group)
                        color = readFromTexture(tColor, group, uColorTexDim).rgb;
                    #elif defined(dColorType_groupInstance)
                        color = readFromTexture(tColor, vInstance * float(uGroupCount) + group, uColorTexDim).rgb;
                    #elif defined(dColorType_vertex)
                        color = texture3dFrom1dTrilinear(tColor, isoPos, uGridDim, uColorTexDim, 0.0).rgb;
                    #elif defined(dColorType_vertexInstance)
                        color = texture3dFrom1dTrilinear(tColor, isoPos, uGridDim, uColorTexDim, vInstance * float(uVertexCount)).rgb;
                    #endif

                    // handle flipping and negative isosurfaces
                    #ifdef dFlipSided
                        bool flipped = value < uIsoValue.y; // flipped
                    #else
                        bool flipped = value > uIsoValue.y;
                    #endif
                    interior = value < uIsoValue.x && flipped;
                    #ifndef dDoubleSided
                        if (interior) {
                            prevValue = value;
                            pos += step;
                            continue;
                        }
                    #endif
                    vec3 vViewPosition = mvPosition.xyz;
                    vec4 material = vec4(color, uAlpha);

                    #ifdef dIgnoreLight
                        gl_FragColor = material;
                    #else
                        #if defined(dFlatShaded)
                            // nearest grid point
                            isoPos = floor(isoPos * uGridDim + 0.5) / uGridDim;
                        #endif
                        #ifdef dPackedGroup
                            // compute gradient by central differences
                            gradient.x = textureVal(isoPos - dx).a - textureVal(isoPos + dx).a;
                            gradient.y = textureVal(isoPos - dy).a - textureVal(isoPos + dy).a;
                            gradient.z = textureVal(isoPos - dz).a - textureVal(isoPos + dz).a;
                        #else
                            gradient = textureVal(isoPos).xyz * 2.0 - 1.0;
                        #endif
                        vec3 normal = -normalize(normalMatrix * normalize(gradient));
                        normal = normal * (float(flipped) * 2.0 - 1.0);
                        normal = normal * -(float(interior) * 2.0 - 1.0);
                        #include apply_light_color
                    #endif

                    float vMarker = readFromTexture(tMarker, vInstance * float(uGroupCount) + group, uMarkerTexDim).a;
                    #include apply_interior_color
                    #include apply_marker_color

                    preFogAlphaBlended = (1.0 - preFogAlphaBlended) * gl_FragColor.a + preFogAlphaBlended;
                    fragmentDepth = depth;
                    #include apply_fog

                    src = gl_FragColor;

                    if (!uTransparentBackground) {
                        // done in 'apply_fog' otherwise
                        src.rgb *= src.a;
                    }
                    dst = (1.0 - dst.a) * src + dst; // standard blending
                #endif

                #ifdef dSingleLayer
                    break;
                #endif

                hit = true;
            }
            prevValue = value;
        #elif defined(dRenderMode_volume)
            vec4 mvPosition = modelViewTransform * vec4(unitPos * uGridDim, 1.0);
            if (calcDepth(mvPosition.xyz) > getDepth(gl_FragCoord.xy / uDrawingBufferSize))
                break;

            #if defined(dClipVariant_pixel) && dClipObjectCount != 0
                vec3 vModelPosition = v3m4(unitPos * uGridDim, modelTransform);
                if (clipTest(vec4(vModelPosition, 0.0), 0)) {
                    prevValue = value;
                    pos += step;
                    continue;
                }
            #endif

            #if defined(dRenderVariant_color)
                vec3 vViewPosition = mvPosition.xyz;
                vec4 material = transferFunction(value);

                #ifdef dIgnoreLight
                    gl_FragColor.rgb = material.rgb;
                #else
                    if (material.a >= 0.01) {
                        #ifdef dPackedGroup
                            // compute gradient by central differences
                            gradient.x = textureVal(unitPos - dx).a - textureVal(unitPos + dx).a;
                            gradient.y = textureVal(unitPos - dy).a - textureVal(unitPos + dy).a;
                            gradient.z = textureVal(unitPos - dz).a - textureVal(unitPos + dz).a;
                        #else
                            gradient = cell.xyz * 2.0 - 1.0;
                        #endif
                        vec3 normal = -normalize(normalMatrix * normalize(gradient));
                        #include apply_light_color
                    } else {
                        gl_FragColor.rgb = material.rgb;
                    }
                #endif

                gl_FragColor.a = material.a * uAlpha * uTransferScale;

                #ifdef dPackedGroup
                    float group = decodeFloatRGB(textureGroup(floor(unitPos * uGridDim + 0.5) / uGridDim).rgb);
                #else
                    vec3 g = floor(unitPos * uGridDim + 0.5);
                    float group = g.z + g.y * uGridDim.z + g.x * uGridDim.z * uGridDim.y;
                #endif

                float vMarker = readFromTexture(tMarker, vInstance * float(uGroupCount) + group, uMarkerTexDim).a;
                #include apply_marker_color

                preFogAlphaBlended = (1.0 - preFogAlphaBlended) * gl_FragColor.a + preFogAlphaBlended;
                fragmentDepth = calcDepth(mvPosition.xyz);
                #include apply_fog

                src = gl_FragColor;

                if (!uTransparentBackground) {
                    // done in 'apply_fog' otherwise
                    src.rgb *= src.a;
                }
                dst = (1.0 - dst.a) * src + dst; // standard blending
            #endif
        #endif

        // break if the color is opaque enough
        if (dst.a > 0.95)
            break;

        pos += step;
    }

    #if defined(dRenderMode_isosurface) && defined(enabledFragDepth)
        // ensure depth is written everywhere
        if (!hit)
            gl_FragDepthEXT = 1.0;
    #endif

    return dst;
}

// TODO: support float texture for higher precision values???
// TODO: support clipping exclusion texture support

void main() {
    if (gl_FrontFacing)
        discard;

    #if defined(dRenderVariant_pick) || defined(dRenderVariant_depth)
        #if defined(dRenderMode_volume)
            // always ignore pick & depth for volume
            discard;
        #elif defined(dRenderMode_isosurface)
            if (uAlpha < uPickingAlphaThreshold)
                discard; // ignore so the element below can be picked
        #endif
    #endif

    vec3 rayDir = mix(normalize(vOrigPos - uCameraPosition), uCameraDir, uIsOrtho);
    vec3 step = rayDir * uStepScale;

    float boundingSphereNear = distance(vBoundingSphere.xyz, uCameraPosition) - vBoundingSphere.w;
    float d = max(uNear, boundingSphereNear) - mix(0.0, distance(vOrigPos, uCameraPosition), uIsOrtho);
    vec3 start = mix(uCameraPosition, vOrigPos, uIsOrtho) + (d * rayDir);
    gl_FragColor = raymarch(start, step, rayDir);

    #if defined(dRenderVariant_pick) || defined(dRenderVariant_depth)
        // discard when nothing was hit
        if (gl_FragColor == vec4(0.0))
            discard;
    #endif

    #if defined(dRenderVariant_color)
        #if defined(dRenderMode_isosurface) && defined(enabledFragDepth)
            float fragmentDepth = gl_FragDepthEXT;
        #else
            float fragmentDepth = calcDepth((uModelView * vec4(start, 1.0)).xyz);
        #endif
        float preFogAlpha = clamp(preFogAlphaBlended, 0.0, 1.0);
        interior = false;
        #include wboit_write
    #endif
}
`,i_e=`
precision highp float;
precision highp int;

#include common
#include common_vert_params

attribute vec3 aPosition;
attribute vec2 aUv;
attribute mat4 aTransform;
attribute float aInstance;

varying vec2 vUv;
varying float vInstance;

void main() {
    #include assign_position

    vUv = aUv;
    vInstance = aInstance;
}
`,o_e=`
precision highp float;
precision highp int;

#include common
#include read_from_texture
#include common_frag_params
#include common_clip
#include wboit_params

uniform vec2 uImageTexDim;
uniform sampler2D tImageTex;
uniform sampler2D tGroupTex;

uniform vec2 uMarkerTexDim;
uniform sampler2D tMarker;

varying vec2 vUv;
varying float vInstance;

#if defined(dInterpolation_catmulrom) || defined(dInterpolation_mitchell) || defined(dInterpolation_bspline)
    #define dInterpolation_cubic
#endif

#if defined(dInterpolation_cubic)
    #if defined(dInterpolation_catmulrom) || defined(dInterpolation_mitchell)
        #if defined(dInterpolation_catmulrom)
            const float B = 0.0;
            const float C = 0.5;
        #elif defined(dInterpolation_mitchell)
            const float B = 0.333;
            const float C = 0.333;
        #endif

        float cubicFilter(float x){
            float f = x;
            if (f < 0.0) {
                f = -f;
            }
            if (f < 1.0) {
                return ((12.0 - 9.0 * B - 6.0 * C) * (f * f * f) +
                    (-18.0 + 12.0 * B + 6.0 * C) * (f * f) +
                    (6.0 - 2.0 * B)) / 6.0;
            }else if (f >= 1.0 && f < 2.0){
                return ((-B - 6.0 * C) * ( f * f * f)
                    + (6.0 * B + 30.0 * C) * (f * f) +
                    (-(12.0 * B) - 48.0 * C) * f +
                    8.0 * B + 24.0 * C) / 6.0;
            }else{
                return 0.0;
            }
        }
    #elif defined(dInterpolation_bspline)
        float cubicFilter(float x) {
            float f = x;
            if (f < 0.0) {
                f = -f;
            }
            if (f >= 0.0 && f <= 1.0){
                return (2.0 / 3.0) + (0.5) * (f * f * f) - (f * f);
            } else if (f > 1.0 && f <= 2.0) {
                return 1.0 / 6.0 * pow((2.0 - f), 3.0);
            }
            return 1.0;
        }
    #endif

    vec4 biCubic(sampler2D tex, vec2 texCoord) {
        vec2 texelSize = 1.0 / uImageTexDim;
        texCoord -= texelSize / 2.0;
        vec4 nSum = vec4(0.0);
        float nDenom = 0.0;
        vec2 cell = fract(texCoord * uImageTexDim);
        for (float m = -1.0; m <= 2.0; ++m) {
            for (float n = -1.0; n <= 2.0; ++n) {
                vec4 vecData = texture2D(tex, texCoord + texelSize * vec2(m, n));
                float c = cubicFilter(m - cell.x) * cubicFilter(-n + cell.y);
                nSum += vecData * c;
                nDenom += c;
            }
        }
        return nSum / nDenom;
    }
#endif

void main() {
    #include clip_pixel

    #if defined(dInterpolation_cubic)
        vec4 imageData = biCubic(tImageTex, vUv);
    #else
        vec4 imageData = texture2D(tImageTex, vUv);
    #endif
    imageData.a = clamp(imageData.a, 0.0, 1.0);
    if (imageData.a > 0.9) imageData.a = 1.0;

    float fragmentDepth = gl_FragCoord.z;
    bool interior = false;

    #if defined(dRenderVariant_pick)
        if (imageData.a < 0.3)
            discard;

        #if defined(dRenderVariant_pickObject)
            gl_FragColor = vec4(encodeFloatRGB(float(uObjectId)), 1.0);
        #elif defined(dRenderVariant_pickInstance)
            gl_FragColor = vec4(encodeFloatRGB(vInstance), 1.0);
        #elif defined(dRenderVariant_pickGroup)
            gl_FragColor = vec4(texture2D(tGroupTex, vUv).rgb, 1.0);
        #endif
    #elif defined(dRenderVariant_depth)
        if (imageData.a < 0.05)
            discard;

        gl_FragColor = packDepthToRGBA(gl_FragCoord.z);
    #elif defined(dRenderVariant_color)
        if (imageData.a < 0.05)
            discard;

        gl_FragColor = imageData;
        gl_FragColor.a *= uAlpha;

        float group = decodeFloatRGB(texture2D(tGroupTex, vUv).rgb);
        float vMarker = readFromTexture(tMarker, vInstance * float(uGroupCount) + group, uMarkerTexDim).a;

        #include apply_marker_color
        #include apply_fog
        #include wboit_write
    #endif
}
`,XW=ro(),s_e={apply_fog:pwe,apply_interior_color:hwe,apply_light_color:mwe,apply_marker_color:vwe,assign_clipping_varying:gwe,assign_color_varying:ywe,assign_group:bwe,assign_marker_varying:xwe,assign_material_color:Swe,assign_position:Cwe,assign_size:wwe,check_picking_alpha:_we,clip_instance:Awe,clip_pixel:Twe,color_frag_params:Ewe,color_vert_params:Pwe,common_clip:Iwe,common_frag_params:Mwe,common_vert_params:Dwe,common:kwe,float_to_rgba:Rwe,light_frag_params:Owe,matrix_scale:Bwe,normal_frag_params:Fwe,read_from_texture:Lwe,rgba_to_float:Nwe,size_vert_params:zwe,texture3d_from_1d_trilinear:Uwe,texture3d_from_2d_linear:Vwe,texture3d_from_2d_nearest:Hwe,wboit_params:jwe,wboit_write:Gwe},u_e=/^(?!\/\/)\s*#include\s+(\S+)/gmi,l_e=/[ \t]*\/\/.*\n/g,c_e=/[ \t]*\/\*[\s\S]*?\*\//g,d_e=/\n{2,}/g;function lL(e){return e.replace(u_e,function(t,r){var n=s_e[r];if(!n)throw new Error("empty chunk, '"+r+"'");return n}).trim().replace(l_e,`
`).replace(c_e,`
`).replace(d_e,`
`)}function Wn(e,t,r,n,a){return n===void 0&&(n={}),a===void 0&&(a={}),{id:XW(),name:e,vert:lL(t),frag:lL(r),extensions:n,outTypes:a}}var f_e=Wn("points",qwe,Wwe,{drawBuffers:"optional"}),p_e=Wn("spheres",Xwe,Ywe,{fragDepth:"required",drawBuffers:"optional"}),h_e=Wn("cylinders",Kwe,$we,{fragDepth:"required",drawBuffers:"optional"}),m_e=Wn("text",Qwe,Zwe,{standardDerivatives:"required",drawBuffers:"optional"}),v_e=Wn("lines",Jwe,e_e,{drawBuffers:"optional"}),YW=Wn("mesh",t_e,r_e,{standardDerivatives:"optional",drawBuffers:"optional"}),g_e=Wn("direct-volume",n_e,a_e,{fragDepth:"optional",drawBuffers:"optional"}),y_e=Wn("image",i_e,o_e,{drawBuffers:"optional"});function b_e(e){if(e===void 0)return"";var t=[];for(var r in e){var n=e[r],a=n.ref.value;if(a!==void 0)if(typeof a=="string")t.push("#define "+r+"_"+a);else if(typeof a=="number")t.push("#define "+r+" "+a);else if(typeof a=="boolean")a&&t.push("#define "+r);else throw new Error("unknown define type")}return t.join(`
`)+`
`}function x_e(e,t){var r=[];if(t.standardDerivatives&&(r.push("#extension GL_OES_standard_derivatives : enable"),r.push("#define enabledStandardDerivatives")),t.fragDepth){if(e.fragDepth)r.push("#extension GL_EXT_frag_depth : enable"),r.push("#define enabledFragDepth");else if(t.fragDepth==="required")throw new Error("required 'GL_EXT_frag_depth' extension not available")}if(t.drawBuffers){if(e.drawBuffers)r.push("#extension GL_EXT_draw_buffers : require"),r.push("#define requiredDrawBuffers"),r.push("#define gl_FragColor gl_FragData[0]");else if(t.drawBuffers==="required")throw new Error("required 'GL_EXT_draw_buffers' extension not available")}if(t.shaderTextureLod){if(e.shaderTextureLod)r.push("#extension GL_EXT_shader_texture_lod : enable"),r.push("#define enabledShaderTextureLod");else if(t.shaderTextureLod==="required")throw new Error("required 'GL_EXT_shader_texture_lod' extension not available")}return e.depthTexture&&r.push("#define depthTextureSupport"),r.join(`
`)+`
`}var S_e=`#version 300 es
#define attribute in
#define varying out
#define texture2D texture
`,C_e=`
#define varying in
#define texture2D texture
#define texture2DLodEXT textureLod

#define gl_FragColor out_FragData0
#define gl_FragDepthEXT gl_FragDepth

#define depthTextureSupport
`;function w_e(e,t,r,n){var a=["#version 300 es","layout(location = 0) out highp "+(n[0]||"vec4")+" out_FragData0;"];if(r.standardDerivatives&&a.push("#define enabledStandardDerivatives"),r.fragDepth&&a.push("#define enabledFragDepth"),r.drawBuffers){a.push("#define requiredDrawBuffers");for(var i=e.getParameter(e.MAX_DRAW_BUFFERS),o=1,s=i;o<s;++o)a.push("layout(location = "+o+") out highp "+(n[o]||"vec4")+" out_FragData"+o+";")}return r.shaderTextureLod&&a.push("#define enabledShaderTextureLod"),a.push(C_e),a.join(`
`)+`
`}function __e(e){return e.replace(/gl_FragData\[([0-9]+)\]/g,"out_FragData$1")}function A_e(e,t,r,n){var a=b_e(r),i=Dr(e)?S_e:"",o=Dr(e)?w_e(e,t,n.extensions,n.outTypes):x_e(t,n.extensions),s=Dr(e)?__e(n.frag):n.frag;return{id:XW(),name:n.name,vert:""+i+a+n.vert,frag:""+o+a+s,extensions:n.extensions,outTypes:n.outTypes}}function T_e(e,t){switch(t){case"b":case"b[]":return e.BOOL;case"f":case"f[]":return e.FLOAT;case"i":case"i[]":return e.INT;case"v2":case"v2[]":return e.FLOAT_VEC2;case"v3":case"v3[]":return e.FLOAT_VEC3;case"v4":case"v4[]":return e.FLOAT_VEC4;case"m3":case"m3[]":return e.FLOAT_MAT3;case"m4":case"m4[]":return e.FLOAT_MAT4;default:console.error("unknown uniform kind '"+t+"'")}}function E_e(e,t,r){e.uniform1f(t,r)}function P_e(e,t,r){e.uniform1fv(t,r)}function I_e(e,t,r){e.uniform1i(t,r)}function M_e(e,t,r){e.uniform1iv(t,r)}function D_e(e,t,r){e.uniform2fv(t,r)}function k_e(e,t,r){e.uniform3fv(t,r)}function R_e(e,t,r){e.uniform4fv(t,r)}function O_e(e,t,r){e.uniformMatrix3fv(t,!1,r)}function B_e(e,t,r){e.uniformMatrix4fv(t,!1,r)}function cL(e){switch(e){case"f":return E_e;case"f[]":return P_e;case"i":case"t":case"b":return I_e;case"i[]":case"t[]":case"b[]":return M_e;case"v2":case"v2[]":return D_e;case"v3":case"v3[]":return k_e;case"v4":case"v4[]":return R_e;case"m3":case"m3[]":return O_e;case"m4":case"m4[]":return B_e}}function F_e(e){var t={};return Object.keys(e).forEach(function(r){var n=e[r];n.type==="uniform"?t[r]=cL(n.kind):n.type==="texture"&&(t[r]=cL("t"))}),t}function L_e(e){var t={};return Object.keys(e).forEach(function(r){t[r]=N.create(mp(e[r].ref.value))}),t}var N_e=ro();function z_e(e,t){switch(t){case"static":return e.STATIC_DRAW;case"dynamic":return e.DYNAMIC_DRAW;case"stream":return e.STREAM_DRAW}}function U_e(e,t){if(t instanceof Uint8Array)return e.UNSIGNED_BYTE;if(t instanceof Int8Array)return e.BYTE;if(t instanceof Uint16Array)return e.UNSIGNED_SHORT;if(t instanceof Int16Array)return e.SHORT;if(t instanceof Uint32Array)return e.UNSIGNED_INT;if(t instanceof Int32Array)return e.INT;if(t instanceof Float32Array)return e.FLOAT;throw new Error("Should nevver happen")}function V_e(e,t){switch(t){case"attribute":return e.ARRAY_BUFFER;case"elements":return e.ELEMENT_ARRAY_BUFFER;case"uniform":return e.UNIFORM_BUFFER}}function dL(e){var t=e.createBuffer();if(t===null)throw new Error("Could not create WebGL buffer");return t}function KW(e,t,r,n){var a=dL(e),i=z_e(e,r),o=V_e(e,n),s=U_e(e,t),u=t.BYTES_PER_ELEMENT,l=t.length;function c(f){e.bindBuffer(o,a),e.bufferData(o,f,i)}c(t);var d=!1;return{id:N_e(),_usageHint:i,_bufferType:o,_dataType:s,_bpe:u,length:l,getBuffer:function(){return a},updateData:c,updateSubData:function(f,p,h){e.bindBuffer(o,a),h-p===f.length?e.bufferSubData(o,0,f):e.bufferSubData(o,p*u,f.subarray(p,p+h))},reset:function(){a=dL(e),c(t)},destroy:function(){d||(e.deleteBuffer(a),d=!0)}}}function H_e(e,t,r){switch(t){case"int32":switch(r){case 1:return e.INT;case 2:return e.INT_VEC2;case 3:return e.INT_VEC3;case 4:return e.INT_VEC4}break;case"float32":switch(r){case 1:return e.FLOAT;case 2:return e.FLOAT_VEC2;case 3:return e.FLOAT_VEC3;case 4:return e.FLOAT_VEC4;case 16:return e.FLOAT_MAT4}break}throw new Error("unknown attribute type for kind '"+t+"' and itemSize '"+r+"'")}function j_e(e,t,r,n,a,i){i===void 0&&(i="dynamic");var o=t.instancedArrays,s=KW(e,r,i,"attribute"),u=s._bufferType,l=s._dataType,c=s._bpe;return T(T({},s),{bind:function(d){if(e.bindBuffer(u,s.getBuffer()),n===16)for(var f=0;f<4;++f)e.enableVertexAttribArray(d+f),e.vertexAttribPointer(d+f,4,l,!1,4*4*c,f*4*c),o.vertexAttribDivisor(d+f,a);else e.enableVertexAttribArray(d),e.vertexAttribPointer(d,n,l,!1,0,0),o.vertexAttribDivisor(d,a)}})}function G_e(e,t,r){var n=[];return Object.keys(t).forEach(function(a){var i=t[a];i.type==="attribute"&&(n[n.length]=[a,e.resources.attribute(r[a].ref.value,i.itemSize,i.divisor)])}),n}function q_e(e,t,r){r===void 0&&(r="static");var n=KW(e,t,r,"elements");return T(T({},n),{bind:function(){e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n.getBuffer())}})}var W_e=ro();function X_e(e,t,r){var n={};return Object.keys(r).forEach(function(a){var i=r[a];if(i.type==="attribute"){var o=e.getAttribLocation(t,a);n[a]=o}else if(i.type==="uniform"||i.type==="texture"){var o=e.getUniformLocation(t,a);n[a]=o}}),n}function Y_e(e,t,r){for(var n=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),a=0;a<n;++a){var i=e.getActiveAttrib(t,a);if(i){var o=i.name,s=i.type;if(o.startsWith("__activeAttribute")||o==="gl_InstanceID"||o==="gl_VertexID")continue;var u=r[o];if(u===void 0)throw new Error("missing 'uniform' or 'texture' with name '"+o+"' in schema");if(u.type!=="attribute")throw new Error("'"+o+"' must be of type 'attribute' but is '"+u.type+"'");var l=H_e(e,u.kind,u.itemSize);if(l!==s)throw new Error("unexpected attribute type for "+o)}}}function K_e(e,t,r){for(var n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),a=0;a<n;++a){var i=e.getActiveUniform(t,a);if(i){var o=i.name,s=i.type;if(o.startsWith("__activeUniform"))continue;var u=o.replace(/[[0-9]+\]$/,""),l=r[u];if(l===void 0)throw new Error("missing 'uniform' or 'texture' with name '"+o+"' in schema");if(l.type==="uniform"){var c=T_e(e,l.kind);if(c!==s)throw new Error("unexpected uniform type for "+o)}else if(l.type==="texture"){if(l.kind==="image-float32"||l.kind==="image-uint8"){if(s!==e.SAMPLER_2D)throw new Error("unexpected sampler type for '"+o+"'")}else if((l.kind==="volume-float32"||l.kind==="volume-uint8")&&s!==e.SAMPLER_3D)throw new Error("unexpected sampler type for '"+o+"'")}else throw new Error("'"+o+"' must be of type 'uniform' or 'texture' but is '"+l.type+"'")}}}function $_e(e,t){if(!e.getProgramParameter(t,e.LINK_STATUS))throw new Error(`Could not compile WebGL program. 

`+e.getProgramInfoLog(t))}function l5(e){var t=e.createProgram();if(t===null)throw new Error("Could not create WebGL program");return t}function Q_e(e,t,r,n,a){var i=a.defineValues,o=a.shaderCode,s=a.schema,u=l5(e),l=W_e(),c=A_e(e,r,i,o),d=n("vert",c.vert),f=n("frag",c.frag),p,h;function m(){d.attach(u),f.attach(u),e.linkProgram(u),Fr&&$_e(e,u),p=X_e(e,u,s),h=F_e(s),Fr&&(Y_e(e,u,s),K_e(e,u,s))}m();var v=!1;return{id:l,use:function(){t.currentProgramId=l,e.useProgram(u)},setUniforms:function(g){for(var y=0,b=g.length;y<b;++y){var S=g[y],x=S[0],C=S[1];if(C){var w=p[x];w!==null&&h[x](e,w,C.ref.value)}}},bindAttributes:function(g){for(var y=0,b=g.length;y<b;++y){var S=g[y],x=S[0],C=S[1],w=p[x];w!==-1&&C.bind(w)}},bindTextures:function(g,y){for(var b=0,S=g.length;b<S;++b){var x=g[b],C=x[0],w=x[1],_=p[C];_!=null&&(w.bind(b+y),h[C](e,_,b+y))}},reset:function(){u=l5(e),m()},destroy:function(){v||(d.destroy(),f.destroy(),e.deleteProgram(u),v=!0)}}}var Z_e=ro();function J_e(e){for(var t=e.split(`
`),r=0;r<t.length;++r)t[r]=r+1+": "+t[r];return t.join(`
`)}function LC(e,t){var r=t.type,n=t.source,a=e.createShader(r==="vert"?e.VERTEX_SHADER:e.FRAGMENT_SHADER);if(a===null)throw new Error("Error creating "+r+" shader");if(e.shaderSource(a,n),e.compileShader(a),Fr&&e.getShaderParameter(a,e.COMPILE_STATUS)===!1)throw console.warn("'"+r+"' shader info log '"+e.getShaderInfoLog(a)+`'
`+J_e(n)),new Error("Error compiling "+r+" shader");return a}function e4e(e,t){var r=LC(e,t);return{id:Z_e(),attach:function(n){e.attachShader(n,r)},reset:function(){r=LC(e,t)},destroy:function(){e.deleteShader(r)}}}function t4e(e,t){return t===void 0&&(t=0),{value:e,usageCount:t}}function r4e(e){return{free:function(){e.usageCount-=1},value:e.value}}function fL(e,t,r){var n=new Map;return{get:function(a){var i=e(a),o=n.get(i);return o||(o=t4e(t(a)),n.set(i,o)),o.usageCount+=1,r4e(o)},clear:function(){n.forEach(function(a,i){a.usageCount<=0&&(a.usageCount<0&&console.warn("Reference usageCount below zero."),r(a.value),n.delete(i))})},get count(){return n.size},dispose:function(){n.forEach(function(a){return r(a.value)}),n.clear()}}}var n4e=ro();function a4e(e,t){switch(t){case"depth16":return e.DEPTH_COMPONENT16;case"stencil8":return e.STENCIL_INDEX8;case"rgba4":return e.RGBA4;case"depth-stencil":return e.DEPTH_STENCIL;case"depth32f":if(Dr(e))return e.DEPTH_COMPONENT32F;throw new Error("WebGL2 needed for `depth32f` renderbuffer format")}}function i4e(e,t){switch(t){case"depth":return e.DEPTH_ATTACHMENT;case"stencil":return e.STENCIL_ATTACHMENT;case"depth-stencil":return e.DEPTH_STENCIL_ATTACHMENT;case"color0":return e.COLOR_ATTACHMENT0}}function pL(e){var t=e.createRenderbuffer();if(t===null)throw new Error("Could not create WebGL renderbuffer");return t}function o4e(e,t,r,n,a){var i=pL(e),o=function(){return e.bindRenderbuffer(e.RENDERBUFFER,i)},s=a4e(e,t),u=i4e(e,r);function l(){o(),e.renderbufferStorage(e.RENDERBUFFER,s,n,a)}l();var c=!1;return{id:n4e(),bind:o,attachFramebuffer:function(d){d.bind(),o(),e.framebufferRenderbuffer(e.FRAMEBUFFER,u,e.RENDERBUFFER,i),Fr&&bk(e)},setSize:function(d,f){n=d,a=f,l()},reset:function(){i=pL(e),l()},destroy:function(){c||(e.deleteRenderbuffer(i),c=!0)}}}var s4e=ro();function hL(e){var t=e.vertexArrayObject;if(!t)throw new Error("VertexArrayObject not supported");var r=t.createVertexArray();if(!r)throw new Error("Could not create WebGL vertex array");return r}function mL(e){var t=e.vertexArrayObject;if(t===null)throw new Error("VertexArrayObject not supported");return t}function u4e(e,t,r,n){var a=s4e(),i=hL(e),o=mL(e);function s(){o.bindVertexArray(i),n&&n.bind(),t.bindAttributes(r),o.bindVertexArray(null)}s();var u=!1;return{id:a,bind:function(){o.bindVertexArray(i)},update:s,reset:function(){i=hL(e),o=mL(e),s()},destroy:function(){u||(o.deleteVertexArray(i),u=!0)}}}function l4e(e){return typeof e=="boolean"?e?1:0:typeof e=="number"?e*1e4:zD(e)}function vL(e){var t=T(T({},e.value),{destroy:function(){e.free()}});return t}function c4e(e,t,r,n){var a={attribute:new Set,elements:new Set,framebuffer:new Set,program:new Set,renderbuffer:new Set,shader:new Set,texture:new Set,vertexArray:new Set};function i(l,c){return a[l].add(c),r.resourceCounts[l]+=1,T(T({},c),{destroy:function(){c.destroy(),a[l].delete(c),r.resourceCounts[l]-=1}})}var o=fL(function(l){return JSON.stringify(l)},function(l){return i("shader",e4e(e,l))},function(l){l.destroy()});function s(l,c){return vL(o.get({type:l,source:c}))}var u=fL(function(l){var c=[l.shaderCode.id];return Object.keys(l.defineValues).forEach(function(d){return c.push(zD(d),l4e(l.defineValues[d].ref.value))}),eo(c).toString()},function(l){return i("program",Q_e(e,t,n,s,l))},function(l){l.destroy()});return{attribute:function(l,c,d,f){return i("attribute",j_e(e,n,l,c,d,f))},elements:function(l,c){return i("elements",q_e(e,l,c))},framebuffer:function(){return i("framebuffer",cwe(e))},program:function(l,c,d){return vL(u.get({defineValues:l,shaderCode:c,schema:d}))},renderbuffer:function(l,c,d,f){return i("renderbuffer",o4e(e,l,c,d,f))},shader:s,texture:function(l,c,d,f){return i("texture",d5(e,n,l,c,d,f))},vertexArray:function(l,c,d){return i("vertexArray",u4e(n,l,c,d))},getByteCounts:function(){var l=0;a.texture.forEach(function(f){l+=f.getByteCount()});var c=0;a.attribute.forEach(function(f){c+=f.length*4});var d=0;return a.elements.forEach(function(f){d+=f.length*4}),{texture:l,attribute:c,elements:d}},reset:function(){a.attribute.forEach(function(l){return l.reset()}),a.elements.forEach(function(l){return l.reset()}),a.framebuffer.forEach(function(l){return l.reset()}),a.renderbuffer.forEach(function(l){return l.reset()}),a.shader.forEach(function(l){return l.reset()}),a.program.forEach(function(l){return l.reset()}),a.vertexArray.forEach(function(l){return l.reset()}),a.texture.forEach(function(l){return l.reset()})},destroy:function(){a.attribute.forEach(function(l){return l.destroy()}),a.elements.forEach(function(l){return l.destroy()}),a.framebuffer.forEach(function(l){return l.destroy()}),a.renderbuffer.forEach(function(l){return l.destroy()}),a.shader.forEach(function(l){return l.destroy()}),a.program.forEach(function(l){return l.destroy()}),a.vertexArray.forEach(function(l){return l.destroy()}),a.texture.forEach(function(l){return l.destroy()}),o.clear(),u.clear()}}}var $W=ro();function d4e(e,t,r,n,a,i,o){a===void 0&&(a=!0),i===void 0&&(i="uint8"),o===void 0&&(o="nearest");var s=t.framebuffer(),u=i==="fp16"?t.texture("image-float16","rgba","fp16",o):i==="float32"?t.texture("image-float32","rgba","float",o):t.texture("image-uint8","rgba","ubyte",o),l=a?Dr(e)?t.renderbuffer("depth32f","depth",r,n):t.renderbuffer("depth16","depth",r,n):null;function c(){u.define(r,n),u.attachFramebuffer(s,"color0"),l&&l.attachFramebuffer(s)}c();var d=!1;return{id:$W(),texture:u,framebuffer:s,getWidth:function(){return r},getHeight:function(){return n},bind:function(){s.bind()},setSize:function(f,p){r===f&&n===p||(r=f,n=p,u.define(r,n),l&&l.setSize(r,n))},reset:function(){c()},destroy:function(){d||(u.destroy(),s.destroy(),l&&l.destroy(),d=!0)}}}function f4e(e){return{id:$W(),texture:$w(e),framebuffer:dwe(),getWidth:function(){return 0},getHeight:function(){return 0},bind:function(){e.bindFramebuffer(e.FRAMEBUFFER,null)},setSize:function(){},reset:function(){},destroy:function(){}}}function p4e(e,t){function r(a){try{return e.getContext(a,t)}catch{return null}}var n=r("webgl2")||r("webgl")||r("experimental-webgl");return Fr&&console.log("isWebgl2: "+Dr(n)),n}function QW(e,t){switch(t){case e.NO_ERROR:return"no error";case e.INVALID_ENUM:return"invalid enum";case e.INVALID_VALUE:return"invalid value";case e.INVALID_OPERATION:return"invalid operation";case e.INVALID_FRAMEBUFFER_OPERATION:return"invalid framebuffer operation";case e.OUT_OF_MEMORY:return"out of memory";case e.CONTEXT_LOST_WEBGL:return"context lost"}return"unknown error"}function ZW(e){var t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL error: '"+QW(e,t)+"'")}function h4e(e){for(var t=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),r=0;r<t;++r)e.activeTexture(e.TEXTURE0+r),e.bindTexture(e.TEXTURE_2D,null),e.bindTexture(e.TEXTURE_CUBE_MAP,null),Dr(e)&&(e.bindTexture(e.TEXTURE_2D_ARRAY,null),e.bindTexture(e.TEXTURE_3D,null));var n=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,n);for(var a=e.getParameter(e.MAX_VERTEX_ATTRIBS),r=0;r<a;++r)e.vertexAttribPointer(r,1,e.FLOAT,!1,0,0);e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),e.bindRenderbuffer(e.RENDERBUFFER,null),NC(e)}function NC(e){e.bindFramebuffer(e.FRAMEBUFFER,null)}var JW=new Uint8Array(1*4);function eX(e,t,r){e.getSyncParameter(t,e.SYNC_STATUS)===e.SIGNALED?(e.deleteSync(t),r()):jD.setImmediate(eX,e,t,r)}function tX(e,t){var r=e.fenceSync(e.SYNC_GPU_COMMANDS_COMPLETE,0);r?jD.setImmediate(eX,e,r,t):(console.warn("Could not create a WebGLSync object"),e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,JW),t())}var gL=!1;function m4e(e){return new Promise(function(t){Dr(e)?tX(e,t):(gL||(console.info("Sync object not supported in WebGL"),gL=!0),rX(e),t())})}function rX(e){e.bindFramebuffer(e.FRAMEBUFFER,null),e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,JW)}function c5(e,t,r,n,a,i){if(Fr&&bk(e),i instanceof Uint8Array)e.readPixels(t,r,n,a,e.RGBA,e.UNSIGNED_BYTE,i);else if(i instanceof Float32Array)e.readPixels(t,r,n,a,e.RGBA,e.FLOAT,i);else if(i instanceof Int32Array&&Dr(e))e.readPixels(t,r,n,a,e.RGBA_INTEGER,e.INT,i);else throw new Error("unsupported readPixels buffer type");Fr&&ZW(e)}function v4e(e){var t=e.drawingBufferWidth,r=e.drawingBufferHeight,n=new Uint8Array(t*r*4);return NC(e),e.viewport(0,0,t,r),c5(e,0,0,t,r,n),jh.flipY(jh.create(n,t,r))}function g4e(){return{resourceCounts:{attribute:0,elements:0,framebuffer:0,program:0,renderbuffer:0,shader:0,texture:0,vertexArray:0},drawCount:0,instanceCount:0,instancedDrawCount:0}}function y4e(e,t){var r=this;t===void 0&&(t={});var n=uL(e),a=fwe(e),i=g4e(),o=c4e(e,a,i,n),s={maxTextureSize:e.getParameter(e.MAX_TEXTURE_SIZE),max3dTextureSize:Dr(e)?e.getParameter(e.MAX_3D_TEXTURE_SIZE):0,maxRenderbufferSize:e.getParameter(e.MAX_RENDERBUFFER_SIZE),maxDrawBuffers:n.drawBuffers?e.getParameter(n.drawBuffers.MAX_DRAW_BUFFERS):0,maxTextureImageUnits:e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS)};if(s.maxVertexTextureImageUnits<8)throw new Error('Need "MAX_VERTEX_TEXTURE_IMAGE_UNITS" >= 8');var u=!1,l=new Wf(0),c;if(Dr(e)){var d=e.createBuffer(),f=void 0,p=void 0,h=!1,m=function(){e.bindBuffer(e.PIXEL_PACK_BUFFER,d),e.getBufferSubData(e.PIXEL_PACK_BUFFER,0,f),e.bindBuffer(e.PIXEL_PACK_BUFFER,null),h=!1,p(),p=void 0,f=void 0};c=function(g,y,b,S,x){return new Promise(function(C,w){if(h){w("Can not call multiple readPixelsAsync at the same time");return}h=!0,e.bindBuffer(e.PIXEL_PACK_BUFFER,d),e.bufferData(e.PIXEL_PACK_BUFFER,b*S*4,e.STREAM_READ),e.readPixels(g,y,b,S,e.RGBA,e.UNSIGNED_BYTE,0),e.bindBuffer(e.PIXEL_PACK_BUFFER,null),p=C,f=x,tX(e,m)})}}else c=function(g,y,b,S,x){return pe(r,void 0,void 0,function(){return he(this,function(C){return c5(e,g,y,b,S,x),[2]})})};var v=new Set;return{gl:e,isWebGL2:Dr(e),get pixelRatio(){var g=typeof window<"u"?window.devicePixelRatio:1;return g*(t.pixelScale||1)},extensions:n,state:a,stats:i,resources:o,get maxTextureSize(){return s.maxTextureSize},get max3dTextureSize(){return s.max3dTextureSize},get maxRenderbufferSize(){return s.maxRenderbufferSize},get maxDrawBuffers(){return s.maxDrawBuffers},get maxTextureImageUnits(){return s.maxTextureImageUnits},namedComputeRenderables:Object.create(null),namedFramebuffers:Object.create(null),namedTextures:Object.create(null),get isContextLost(){return u||e.isContextLost()},contextRestored:l,setContextLost:function(){u=!0},handleContextRestored:function(g){Object.assign(n,uL(e)),a.reset(),a.currentMaterialId=-1,a.currentProgramId=-1,a.currentRenderItemId=-1,o.reset(),v.forEach(function(y){return y.reset()}),g?.(),u=!1,l.next(Gn())},createRenderTarget:function(g,y,b,S,x){var C=d4e(e,o,g,y,b,S,x);return v.add(C),T(T({},C),{destroy:function(){C.destroy(),v.delete(C)}})},unbindFramebuffer:function(){return NC(e)},readPixels:function(g,y,b,S,x){c5(e,g,y,b,S,x)},readPixelsAsync:c,waitForGpuCommandsComplete:function(){return m4e(e)},waitForGpuCommandsCompleteSync:function(){return rX(e)},getDrawingBufferPixelData:function(){return v4e(e)},clear:function(g,y,b,S){NC(e),a.enable(e.SCISSOR_TEST),a.depthMask(!0),a.colorMask(!0,!0,!0,!0),a.clearColor(g,y,b,S),e.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight),e.scissor(0,0,e.drawingBufferWidth,e.drawingBufferHeight),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)},destroy:function(g){var y;o.destroy(),h4e(e),g?.doNotForceWebGLContextLoss||(y=e.getExtension("WEBGL_lose_context"))===null||y===void 0||y.loseContext()}}}function Dr(e){return typeof WebGL2RenderingContext<"u"&&e instanceof WebGL2RenderingContext}function b4e(e){if(Dr(e))return{drawArraysInstanced:e.drawArraysInstanced.bind(e),drawElementsInstanced:e.drawElementsInstanced.bind(e),vertexAttribDivisor:e.vertexAttribDivisor.bind(e),VERTEX_ATTRIB_ARRAY_DIVISOR:e.VERTEX_ATTRIB_ARRAY_DIVISOR};var t=e.getExtension("ANGLE_instanced_arrays");return t===null?null:{drawArraysInstanced:t.drawArraysInstancedANGLE.bind(t),drawElementsInstanced:t.drawElementsInstancedANGLE.bind(t),vertexAttribDivisor:t.vertexAttribDivisorANGLE.bind(t),VERTEX_ATTRIB_ARRAY_DIVISOR:t.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE}}function x4e(e){if(Dr(e))return{FRAGMENT_SHADER_DERIVATIVE_HINT:e.FRAGMENT_SHADER_DERIVATIVE_HINT};var t=e.getExtension("OES_standard_derivatives");return t===null?null:{FRAGMENT_SHADER_DERIVATIVE_HINT:t.FRAGMENT_SHADER_DERIVATIVE_HINT_OES}}function S4e(e){return Dr(e)?{}:e.getExtension("OES_element_index_uint")}function C4e(e){if(Dr(e))return{VERTEX_ARRAY_BINDING:e.VERTEX_ARRAY_BINDING,bindVertexArray:e.bindVertexArray.bind(e),createVertexArray:e.createVertexArray.bind(e),deleteVertexArray:e.deleteVertexArray.bind(e),isVertexArray:e.isVertexArray.bind(e)};var t=e.getExtension("OES_vertex_array_object");return t===null?null:{VERTEX_ARRAY_BINDING:t.VERTEX_ARRAY_BINDING_OES,bindVertexArray:t.bindVertexArrayOES.bind(t),createVertexArray:t.createVertexArrayOES.bind(t),deleteVertexArray:t.deleteVertexArrayOES.bind(t),isVertexArray:t.isVertexArrayOES.bind(t)}}function w4e(e){return Dr(e)?{}:e.getExtension("OES_texture_float")}function _4e(e){return e.getExtension("OES_texture_float_linear")}function A4e(e){if(Dr(e))return{HALF_FLOAT:e.HALF_FLOAT};var t=e.getExtension("OES_texture_half_float");return t===null?null:{HALF_FLOAT:t.HALF_FLOAT_OES}}function T4e(e){return e.getExtension("OES_texture_half_float_linear")}function E4e(e){if(Dr(e))return{MIN:e.MIN,MAX:e.MAX};var t=e.getExtension("EXT_blend_minmax");return t===null?null:{MIN:t.MIN_EXT,MAX:t.MAX_EXT}}function P4e(e){return Dr(e)?{}:e.getExtension("EXT_frag_depth")}function I4e(e){if(Dr(e))return e.getExtension("EXT_color_buffer_float")===null?null:(e.getExtension("EXT_float_blend"),{RGBA32F:e.RGBA32F});var t=e.getExtension("WEBGL_color_buffer_float");return t===null?(e.getExtension("OES_texture_float"),nX(e,e.FLOAT)?{RGBA32F:34836}:null):(e.getExtension("EXT_float_blend"),{RGBA32F:t.RGBA32F_EXT})}function M4e(e){if(Dr(e))return e.getExtension("EXT_color_buffer_half_float")===null?null:(e.getExtension("EXT_float_blend"),{RGBA16F:e.RGBA16F});var t=e.getExtension("EXT_color_buffer_half_float");return t===null?(e.getExtension("OES_texture_half_float"),nX(e,36193)?{RGBA16F:34842}:null):(e.getExtension("EXT_float_blend"),{RGBA16F:t.RGBA16F_EXT})}function D4e(e){if(Dr(e))return{drawBuffers:e.drawBuffers.bind(e),COLOR_ATTACHMENT0:e.COLOR_ATTACHMENT0,COLOR_ATTACHMENT1:e.COLOR_ATTACHMENT1,COLOR_ATTACHMENT2:e.COLOR_ATTACHMENT2,COLOR_ATTACHMENT3:e.COLOR_ATTACHMENT3,COLOR_ATTACHMENT4:e.COLOR_ATTACHMENT4,COLOR_ATTACHMENT5:e.COLOR_ATTACHMENT5,COLOR_ATTACHMENT6:e.COLOR_ATTACHMENT6,COLOR_ATTACHMENT7:e.COLOR_ATTACHMENT7,DRAW_BUFFER0:e.DRAW_BUFFER0,DRAW_BUFFER1:e.DRAW_BUFFER1,DRAW_BUFFER2:e.DRAW_BUFFER2,DRAW_BUFFER3:e.DRAW_BUFFER3,DRAW_BUFFER4:e.DRAW_BUFFER4,DRAW_BUFFER5:e.DRAW_BUFFER5,DRAW_BUFFER6:e.DRAW_BUFFER6,DRAW_BUFFER7:e.DRAW_BUFFER7,MAX_COLOR_ATTACHMENTS:e.MAX_COLOR_ATTACHMENTS,MAX_DRAW_BUFFERS:e.MAX_DRAW_BUFFERS};var t=e.getExtension("WEBGL_draw_buffers");return t===null?null:{drawBuffers:t.drawBuffersWEBGL.bind(t),COLOR_ATTACHMENT0:t.COLOR_ATTACHMENT0_WEBGL,COLOR_ATTACHMENT1:t.COLOR_ATTACHMENT1_WEBGL,COLOR_ATTACHMENT2:t.COLOR_ATTACHMENT2_WEBGL,COLOR_ATTACHMENT3:t.COLOR_ATTACHMENT3_WEBGL,COLOR_ATTACHMENT4:t.COLOR_ATTACHMENT4_WEBGL,COLOR_ATTACHMENT5:t.COLOR_ATTACHMENT5_WEBGL,COLOR_ATTACHMENT6:t.COLOR_ATTACHMENT6_WEBGL,COLOR_ATTACHMENT7:t.COLOR_ATTACHMENT7_WEBGL,DRAW_BUFFER0:t.DRAW_BUFFER0_WEBGL,DRAW_BUFFER1:t.DRAW_BUFFER1_WEBGL,DRAW_BUFFER2:t.DRAW_BUFFER2_WEBGL,DRAW_BUFFER3:t.DRAW_BUFFER3_WEBGL,DRAW_BUFFER4:t.DRAW_BUFFER4_WEBGL,DRAW_BUFFER5:t.DRAW_BUFFER5_WEBGL,DRAW_BUFFER6:t.DRAW_BUFFER6_WEBGL,DRAW_BUFFER7:t.DRAW_BUFFER7_WEBGL,MAX_COLOR_ATTACHMENTS:t.MAX_COLOR_ATTACHMENTS_WEBGL,MAX_DRAW_BUFFERS:t.MAX_DRAW_BUFFERS_WEBGL}}function k4e(e){return Dr(e)?{}:e.getExtension("EXT_shader_texture_lod")}function R4e(e){if(Dr(e))return{UNSIGNED_INT_24_8:e.UNSIGNED_INT_24_8};var t=e.getExtension("WEBGL_depth_texture");return t===null?null:{UNSIGNED_INT_24_8:t.UNSIGNED_INT_24_8_WEBGL}}function O4e(e){if(Dr(e))return{FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING,SRGB8_ALPHA8:e.SRGB8_ALPHA8,SRGB8:e.SRGB8,SRGB:e.SRGB};var t=e.getExtension("EXT_sRGB");return t===null?null:{FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:t.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT,SRGB8_ALPHA8:t.SRGB8_ALPHA8_EXT,SRGB8:t.SRGB_ALPHA_EXT,SRGB:t.SRGB_EXT}}var B4e=`
attribute vec4 aPosition;

void main() {
    gl_Position = aPosition;
}`,F4e=`
precision mediump float;
uniform vec4 uColor;
uniform sampler2D uTexture;

void main() {
    gl_FragColor = texture2D(uTexture, vec2(0.5, 0.5)) * uColor;
}`,L4e=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]);function nX(e,t){var r=LC(e,{type:"vert",source:B4e}),n=LC(e,{type:"frag",source:F4e});if(!r||!n)return!1;var a=l5(e);e.attachShader(a,r),e.attachShader(a,n),e.linkProgram(a),e.useProgram(a);var i=e.getAttribLocation(a,"aPosition"),o=e.getUniformLocation(a,"uColor");if(!o)return Fr&&console.log("error getting 'uColor' uniform location"),!1;var s=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,s),e.bufferData(e.ARRAY_BUFFER,L4e,e.STATIC_DRAW),e.enableVertexAttribArray(i),e.vertexAttribPointer(i,2,e.FLOAT,!1,0,0);var u=e.createTexture(),l=new Uint8Array([255,255,255,255]);e.bindTexture(e.TEXTURE_2D,u),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,l);var c=e.createTexture();e.bindTexture(e.TEXTURE_2D,c),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,t,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST);var d=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,d),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,c,0);var f=e.checkFramebufferStatus(e.FRAMEBUFFER);if(f!==e.FRAMEBUFFER_COMPLETE)return Fr&&console.log("error creating framebuffer for '"+t+"'"),!1;e.bindTexture(e.TEXTURE_2D,u),e.uniform4fv(o,[0,10,20,1]),e.drawArrays(e.TRIANGLES,0,6),e.bindTexture(e.TEXTURE_2D,c),e.bindFramebuffer(e.FRAMEBUFFER,null),e.clearColor(1,0,0,1),e.clear(e.COLOR_BUFFER_BIT),e.uniform4fv(o,[0,1/10,1/20,1]),e.drawArrays(e.TRIANGLES,0,6);var p=new Uint8Array(4);if(e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,p),p[0]!==0||p[1]<248||p[2]<248||p[3]<254)return Fr&&console.log("not able to actually render to '"+t+"' texture"),!1;if(t===e.FLOAT){e.bindFramebuffer(e.FRAMEBUFFER,d);var h=new Float32Array(4);e.readPixels(0,0,1,1,e.RGBA,e.FLOAT,h);var m=e.getError();if(m)return Fr&&console.log("error reading float pixels: '"+QW(e,m)+"'"),!1}return!0}var aX=ro();function N4e(e,t){switch(t){case"image-uint8":return e.TEXTURE_2D;case"image-float32":return e.TEXTURE_2D;case"image-float16":return e.TEXTURE_2D;case"image-depth":return e.TEXTURE_2D}if(Dr(e))switch(t){case"image-int32":return e.TEXTURE_2D;case"volume-uint8":return e.TEXTURE_3D;case"volume-float32":return e.TEXTURE_3D;case"volume-float16":return e.TEXTURE_3D}throw new Error("unknown texture kind '"+t+"'")}function iX(e,t,r){switch(t){case"alpha":return Dr(e)&&r==="float"?e.RED:Dr(e)&&r==="int"?e.RED_INTEGER:e.ALPHA;case"rgb":return Dr(e)&&r==="int"?e.RGB_INTEGER:e.RGB;case"rgba":return Dr(e)&&r==="int"?e.RGBA_INTEGER:e.RGBA;case"depth":return e.DEPTH_COMPONENT}}function z4e(e,t,r){if(Dr(e))switch(t){case"alpha":switch(r){case"ubyte":return e.ALPHA;case"float":return e.R32F;case"fp16":return e.R16F;case"int":return e.R32I}case"rgb":switch(r){case"ubyte":return e.RGB;case"float":return e.RGB32F;case"fp16":return e.RGB16F;case"int":return e.RGB32I}case"rgba":switch(r){case"ubyte":return e.RGBA;case"float":return e.RGBA32F;case"fp16":return e.RGBA16F;case"int":return e.RGBA32I}case"depth":switch(r){case"ushort":return e.DEPTH_COMPONENT16;case"float":return e.DEPTH_COMPONENT32F}}return iX(e,t,r)}function U4e(e,t,r,n,a){var i=V4e(e)*H4e(t);return i*r*n*(a||1)}function V4e(e){switch(e){case"alpha":return 1;case"rgb":return 3;case"rgba":return 4;case"depth":return 4}}function H4e(e){switch(e){case"ubyte":return 1;case"ushort":return 2;case"float":return 4;case"fp16":return 2;case"int":return 4}}function j4e(e,t,r){switch(r){case"ubyte":return e.UNSIGNED_BYTE;case"ushort":return e.UNSIGNED_SHORT;case"float":return e.FLOAT;case"fp16":if(t.textureHalfFloat)return t.textureHalfFloat.HALF_FLOAT;throw new Error('extension "texture_half_float" unavailable');case"int":if(Dr(e))return e.INT;throw new Error('texture type "int" requires webgl2')}}function yL(e,t){switch(t){case"nearest":return e.NEAREST;case"linear":return e.LINEAR}}function j2(e,t,r){switch(r){case"depth":return e.DEPTH_ATTACHMENT;case"stencil":return e.STENCIL_ATTACHMENT;case"color0":case 0:return e.COLOR_ATTACHMENT0}if(t.drawBuffers)switch(r){case"color1":case 1:return t.drawBuffers.COLOR_ATTACHMENT1;case"color2":case 2:return t.drawBuffers.COLOR_ATTACHMENT2;case"color3":case 3:return t.drawBuffers.COLOR_ATTACHMENT3;case"color4":case 4:return t.drawBuffers.COLOR_ATTACHMENT4;case"color5":case 5:return t.drawBuffers.COLOR_ATTACHMENT5;case"color6":case 6:return t.drawBuffers.COLOR_ATTACHMENT6;case"color7":case 7:return t.drawBuffers.COLOR_ATTACHMENT7}throw new Error("unknown texture attachment")}function G4e(e){return typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement}function q4e(e,t,r){return t===r.TEXTURE_2D}function W4e(e,t,r){return t===r.TEXTURE_3D}function bL(e){var t=e.createTexture();if(t===null)throw new Error("Could not create WebGL texture");return t}function d5(e,t,r,n,a,i){var o=aX(),s=bL(e);if(r.endsWith("float32")&&a!=="float"||r.endsWith("float16")&&a!=="fp16"||r.endsWith("uint8")&&a!=="ubyte"||r.endsWith("int32")&&a!=="int"||r.endsWith("depth")&&a!=="ushort"&&a!=="float")throw new Error("texture kind '"+r+"' and type '"+a+"' are incompatible");var u=N4e(e,r),l=yL(e,i),c=iX(e,n,a),d=z4e(e,n,a),f=j4e(e,t,a);function p(){e.bindTexture(u,s),e.texParameteri(u,e.TEXTURE_MAG_FILTER,l),e.texParameteri(u,e.TEXTURE_MIN_FILTER,l),e.texParameteri(u,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(u,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(u,null)}p();var h=0,m=0,v=0,g,y=!1;function b(C,w,_){if(!(h===C&&m===w&&v===(_||0)))if(h=C,m=w,v=_||0,e.bindTexture(u,s),u===e.TEXTURE_2D)e.texImage2D(u,0,d,h,m,0,c,f,null);else if(Dr(e)&&u===e.TEXTURE_3D&&v!==void 0)e.texImage3D(u,0,d,h,m,v,0,c,f,null);else throw new Error("unknown texture target")}function S(C,w){if(w===void 0&&(w=!1),e.bindTexture(u,s),e.pixelStorei(e.UNPACK_ALIGNMENT,1),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),G4e(C))e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.bindTexture(e.TEXTURE_2D,s),e.texImage2D(e.TEXTURE_2D,0,d,c,f,C);else if(q4e(C,u,e)){var _=C.filter?yL(e,C.filter):l;e.texParameteri(u,e.TEXTURE_MAG_FILTER,_),e.texParameteri(u,e.TEXTURE_MIN_FILTER,_),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!!C.flipY),w?e.texSubImage2D(u,0,0,0,C.width,C.height,c,f,C.array):(h=C.width,m=C.height,e.texImage2D(u,0,d,h,m,0,c,f,C.array))}else if(Dr(e)&&W4e(C,u,e))e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),w?e.texSubImage3D(u,0,0,0,0,C.width,C.height,C.depth,c,f,C.array):(h=C.width,m=C.height,v=C.depth,e.texImage3D(u,0,d,h,m,v,0,c,f,C.array));else throw new Error("unknown texture target");e.bindTexture(u,null),g=C}function x(C,w,_){if(C.bind(),u===e.TEXTURE_2D)e.framebufferTexture2D(e.FRAMEBUFFER,j2(e,t,w),e.TEXTURE_2D,s,0);else if(Dr(e)&&u===e.TEXTURE_3D){if(_===void 0)throw new Error("need `layer` to attach 3D texture");e.framebufferTextureLayer(e.FRAMEBUFFER,j2(e,t,w),s,0,_)}else throw new Error("unknown/unsupported texture target")}return{id:o,target:u,format:c,internalFormat:d,type:f,getWidth:function(){return h},getHeight:function(){return m},getDepth:function(){return v},getByteCount:function(){return U4e(n,a,h,m,v)},define:b,load:S,bind:function(C){e.activeTexture(e.TEXTURE0+C),e.bindTexture(u,s)},unbind:function(C){e.activeTexture(e.TEXTURE0+C),e.bindTexture(u,null)},attachFramebuffer:x,detachFramebuffer:function(C,w){if(C.bind(),u===e.TEXTURE_2D)e.framebufferTexture2D(e.FRAMEBUFFER,j2(e,t,w),e.TEXTURE_2D,null,0);else if(Dr(e)&&u===e.TEXTURE_3D)e.framebufferTextureLayer(e.FRAMEBUFFER,j2(e,t,w),null,0,0);else throw new Error("unknown texture target")},reset:function(){s=bL(e),p();var C=[h,m,v],w=C[0],_=C[1],E=C[2];h=0,m=0,v=0,b(w,_,E),g&&S(g)},destroy:function(){y||(e.deleteTexture(s),y=!0)}}}function X4e(e,t,r){var n=e.resources,a=[];return Object.keys(t).forEach(function(i){var o=t[i];if(o.type==="texture"){var s=r[i];if(s)if(o.kind==="texture")a[a.length]=[i,s.ref.value];else{var u=n.texture(o.kind,o.format,o.dataType,o.filter);u.load(s.ref.value),a[a.length]=[i,u]}}}),a}function xL(e,t,r){var n=new Image;n.onload=function(){r.load(n),N.update(t,r)},n.src=e}function $w(e){var t,r=(t=e?.TEXTURE_2D)!==null&&t!==void 0?t:3553;return{id:aX(),target:r,format:0,internalFormat:0,type:0,getWidth:function(){return 0},getHeight:function(){return 0},getDepth:function(){return 0},getByteCount:function(){return 0},define:function(){},load:function(){},bind:function(n){e&&(e.activeTexture(e.TEXTURE0+n),e.bindTexture(r,null))},unbind:function(n){e&&(e.activeTexture(e.TEXTURE0+n),e.bindTexture(r,null))},attachFramebuffer:function(){},detachFramebuffer:function(){},reset:function(){},destroy:function(){}}}function Ds(e,t,r,n){var a=Y4e(e,t,r,n);return r.palette?(N.updateIfChanged(a.dUsePalette,!0),K4e(r.palette,a.tPalette)):N.updateIfChanged(a.dUsePalette,!1),a}function Y4e(e,t,r,n){switch(xi.getGranularity(e,r.granularity)){case"uniform":return Q4e(e,r.color,n);case"instance":return Z4e(e,r.color,n);case"group":return J4e(e,r.color,n);case"groupInstance":return eAe(e,r.color,n);case"vertex":return tAe(t,r.color,n);case"vertexInstance":return rAe(t,r.color,n);case"volume":return SL(r.grid,"volume",n);case"volumeInstance":return SL(r.grid,"volumeInstance",n)}}function K4e(e,t){var r=!0,n=t.ref.value;if(e.colors.length!==n.width||n.filter!==e.filter)r=!1;else for(var a=n.array,i=0,o=0,s=e.colors;o<s.length;o++){var u=s[o],l=vt.toRgb(u),c=l[0],d=l[1],f=l[2];if(a[i++]!==c||a[i++]!==d||a[i++]!==f){r=!1;break}}if(!r){for(var p=new Uint8Array(e.colors.length*3),h=0,m=0,v=e.colors;m<v.length;m++){var u=v[m],g=vt.toRgb(u),c=g[0],d=g[1],f=g[2];p[h++]=c,p[h++]=d,p[h++]=f}N.update(t,{array:p,height:1,width:e.colors.length,filter:e.filter})}}function $4e(e,t){return t?(N.update(t.uColor,vt.toVec3Normalized(t.uColor.ref.value,e)),N.updateIfChanged(t.dColorType,"uniform"),t):{uColor:N.create(vt.toVec3Normalized(A(),e)),tColor:N.create({array:new Uint8Array(3),width:1,height:1}),tColorGrid:N.create($w()),tPalette:N.create({array:new Uint8Array(3),width:1,height:1}),uColorTexDim:N.create(Xe.create(1,1)),uColorGridDim:N.create(A.create(1,1,1)),uColorGridTransform:N.create(Mr.create(0,0,0,1)),dColorType:N.create("uniform"),dUsePalette:N.create(!1)}}function Q4e(e,t,r){return $4e(t(ws,!1),r)}function vb(e,t,r){return r?(N.update(r.tColor,e),N.update(r.uColorTexDim,Xe.create(e.width,e.height)),N.updateIfChanged(r.dColorType,t),r):{uColor:N.create(A()),tColor:N.create(e),tColorGrid:N.create($w()),tPalette:N.create({array:new Uint8Array(3),width:1,height:1}),uColorTexDim:N.create(Xe.create(e.width,e.height)),uColorGridDim:N.create(A.create(1,1,1)),uColorGridTransform:N.create(Mr.create(0,0,0,1)),dColorType:N.create(t),dUsePalette:N.create(!1)}}function Z4e(e,t,r){var n=e.instanceCount,a=Li(Math.max(1,n),3,Uint8Array,r&&r.tColor.ref.value.array);for(e.reset();e.hasNext;){var i=e.move(),o=i.location,s=i.isSecondary,u=i.instanceIndex;vt.toArray(t(o,s),a.array,u*3),e.skipInstance()}return vb(a,"instance",r)}function J4e(e,t,r){var n=e.groupCount,a=Li(Math.max(1,n),3,Uint8Array,r&&r.tColor.ref.value.array);for(e.reset();e.hasNext&&!e.isNextNewInstance;){var i=e.move(),o=i.location,s=i.isSecondary,u=i.groupIndex;vt.toArray(t(o,s),a.array,u*3)}return vb(a,"group",r)}function eAe(e,t,r){var n=e.groupCount,a=e.instanceCount,i=a*n,o=Li(Math.max(1,i),3,Uint8Array,r&&r.tColor.ref.value.array);for(e.reset();e.hasNext;){var s=e.move(),u=s.location,l=s.isSecondary,c=s.index;vt.toArray(t(u,l),o.array,c*3)}return vb(o,"groupInstance",r)}function tAe(e,t,r){var n=e.groupCount,a=e.stride,i=Li(Math.max(1,n),3,Uint8Array,r&&r.tColor.ref.value.array);for(e.reset(),e.voidInstances();e.hasNext&&!e.isNextNewInstance;)for(var o=e.move(),s=o.location,u=o.isSecondary,l=o.groupIndex,c=t(s,u),d=0;d<a;++d)vt.toArray(c,i.array,(l+d)*3);return vb(i,"vertex",r)}function rAe(e,t,r){var n=e.groupCount,a=e.instanceCount,i=e.stride,o=a*n,s=Li(Math.max(1,o),3,Uint8Array,r&&r.tColor.ref.value.array);for(e.reset();e.hasNext;)for(var u=e.move(),l=u.location,c=u.isSecondary,d=u.index,f=t(l,c),p=0;p<i;++p)vt.toArray(f,s.array,(d+p)*3);return vb(s,"vertexInstance",r)}function SL(e,t,r){var n=e.colors,a=e.dimension,i=e.transform,o=n.getWidth(),s=n.getHeight();return r?(N.update(r.tColorGrid,n),N.update(r.uColorTexDim,Xe.create(o,s)),N.update(r.uColorGridDim,A.clone(a)),N.update(r.uColorGridTransform,Mr.clone(i)),N.updateIfChanged(r.dColorType,t),r):{uColor:N.create(A()),tColor:N.create({array:new Uint8Array(3),width:1,height:1}),tColorGrid:N.create(n),tPalette:N.create({array:new Uint8Array(3),width:1,height:1}),uColorTexDim:N.create(Xe.create(o,s)),uColorGridDim:N.create(A.clone(a)),uColorGridTransform:N.create(Mr.clone(i)),dColorType:N.create(t),dUsePalette:N.create(!1)}}var Wt;(function(e){function t(b,S,x,C,w,_,E){return E?i(b,S,x,C,w,_,E):a(b,S,x,C,w,_)}e.create=t;function r(b){var S=b?b.vertexBuffer.ref.value:new Float32Array(0),x=b?b.indexBuffer.ref.value:new Uint32Array(0),C=b?b.normalBuffer.ref.value:new Float32Array(0),w=b?b.groupBuffer.ref.value:new Float32Array(0);return t(S,x,C,w,0,0,b)}e.createEmpty=r;function n(b){return eo([b.vertexCount,b.triangleCount,b.vertexBuffer.ref.version,b.indexBuffer.ref.version,b.normalBuffer.ref.version,b.groupBuffer.ref.version])}function a(b,S,x,C,w,_){var E=He(),P,D=-1,k=-1,F={kind:"mesh",vertexCount:w,triangleCount:_,vertexBuffer:N.create(b),indexBuffer:N.create(S),normalBuffer:N.create(x),groupBuffer:N.create(C),get boundingSphere(){var X=n(F);if(X!==D){var U=xp(F.vertexBuffer.ref.value,F.vertexCount,1);He.copy(E,U),D=X}return E},get groupMapping(){return F.groupBuffer.ref.version!==k&&(P=L0(F.groupBuffer.ref.value,F.vertexCount),k=F.groupBuffer.ref.version),P},setBoundingSphere:function(X){He.copy(E,X),D=n(F)},meta:{}};return F}function i(b,S,x,C,w,_,E){return E.vertexCount=w,E.triangleCount=_,N.update(E.vertexBuffer,b),N.update(E.indexBuffer,S),N.update(E.normalBuffer,x),N.update(E.groupBuffer,C),E}function o(b){var S=b.vertexCount,x=b.triangleCount,C=b.vertexBuffer.ref.value,w=b.indexBuffer.ref.value,_=b.normalBuffer.ref.value.length>=S*3?b.normalBuffer.ref.value:new Float32Array(S*3);_===b.normalBuffer.ref.value&&_.fill(0,0,S*3),IW(C,w,_,S,x),N.update(b.normalBuffer,_)}e.computeNormals=o;function s(b,S){S===void 0&&(S=3);for(var x=b.vertexBuffer.ref.value,C=new Map,w=function(X,U){return X[0].toFixed(U)+"|"+X[1].toFixed(U)+"|"+X[2].toFixed(U)},_=0,E=A(),P=0,D=b.vertexCount;P<D;++P){A.fromArray(E,x,P*3);var k=w(E,S),F=C.get(k);F!==void 0?(_+=1,C.set(k,F+1)):C.set(k,1)}return _}e.checkForDuplicateVertices=s;var u=ia();function l(b,S){var x=b.vertexBuffer.ref.value;if(am(S,x,0,b.vertexCount),!de.isTranslationAndUniformScaling(S)){var C=ia.directionTransform(u,S);e3e(C,b.normalBuffer.ref.value,0,b.vertexCount)}N.update(b.vertexBuffer,x)}e.transform=l;function c(b){var S=("kind"in b?b.meta:b.meta.ref.value).originalData;return S}e.getOriginalData=c;function d(b,S){S===void 0&&(S=!0);var x=b.indexBuffer,C=b.vertexBuffer,w=b.groupBuffer,_=b.normalBuffer,E=b.triangleCount,P=b.vertexCount,D=x.ref.value,k=C.ref.value,F=w.ref.value,X=_.ref.value,U=Ke.create(Uint32Array,3,1024,E),j=Ke.create(Float32Array,3,1024,k);j.currentIndex=P*3,j.elementCount=P;var te=Ke.create(Float32Array,3,1024,X);te.currentIndex=P*3,te.elementCount=P;var q=Ke.create(Float32Array,1,1024,F);q.currentIndex=P,q.elementCount=P;var W=A(),V=A(),ee=A(),ue=A(),$=A(),Q=A();function R(Je){A.fromArray(W,k,Je*3),A.fromArray(ue,X,Je*3),Ke.add3(j,W[0],W[1],W[2]),Ke.add3(te,ue[0],ue[1],ue[2])}function Y(Je,st){A.fromArray(W,k,Je*3),A.fromArray(V,k,st*3),A.scale(W,A.add(W,W,V),.5),A.fromArray(ue,X,Je*3),A.fromArray($,X,st*3),A.scale(ue,A.add(ue,ue,$),.5),Ke.add3(j,W[0],W[1],W[2]),Ke.add3(te,ue[0],ue[1],ue[2])}function re(Je,st,ze){A.fromArray(W,k,Je*3),A.fromArray(V,k,st*3),A.fromArray(ee,k,ze*3),A.scale(W,A.add(W,A.add(W,W,V),ee),1/3),A.fromArray(ue,X,Je*3),A.fromArray($,X,st*3),A.fromArray(Q,X,ze*3),A.scale(ue,A.add(ue,A.add(ue,ue,$),Q),1/3),Ke.add3(j,W[0],W[1],W[2]),Ke.add3(te,ue[0],ue[1],ue[2])}function K(Je,st,ze,et,ut){++H,R(Je),Y(Je,st),Y(Je,ze),Ke.add3(U,L,L+1,L+2);for(var pt=0;pt<3;++pt)Ke.add(q,et);L+=3,H+=2,R(st),R(ze),Y(Je,st),Y(Je,ze),Ke.add3(U,L,L+1,L+3),Ke.add3(U,L,L+3,L+2);for(var pt=0;pt<4;++pt)Ke.add(q,ut);L+=4}var L=P,H=0;if(S)for(var Z=0,fe=E;Z<fe;++Z){var me=D[Z*3],xe=D[Z*3+1],Se=D[Z*3+2],ie=F[me],le=F[xe],O=F[Se];if(ie===le&&ie===O)++H,Ke.add3(U,me,xe,Se);else if(ie===le)K(Se,me,xe,O,ie);else if(ie===O)K(xe,Se,me,le,O);else if(le===O)K(me,xe,Se,ie,le);else{H+=2,R(me),Y(me,xe),Y(me,Se),re(me,xe,Se),Ke.add3(U,L,L+1,L+3),Ke.add3(U,L,L+3,L+2);for(var G=0;G<4;++G)Ke.add(q,ie);L+=4,H+=2,R(xe),Y(xe,Se),Y(xe,me),re(me,xe,Se),Ke.add3(U,L,L+1,L+3),Ke.add3(U,L,L+3,L+2);for(var G=0;G<4;++G)Ke.add(q,le);L+=4,H+=2,R(Se),Y(Se,xe),Y(Se,me),re(me,xe,Se),Ke.add3(U,L+3,L+1,L),Ke.add3(U,L+2,L+3,L);for(var G=0;G<4;++G)Ke.add(q,O);L+=4}}else for(var Z=0,fe=E;Z<fe;++Z){var me=D[Z*3],xe=D[Z*3+1],Se=D[Z*3+2],ie=F[me],le=F[xe],O=F[Se];if(ie!==le||ie!==O){++H,R(me),R(xe),R(Se),Ke.add3(U,L,L+1,L+2);for(var ve=le===O?le:ie,G=0;G<3;++G)Ke.add(q,ve);L+=3}else++H,Ke.add3(U,me,xe,Se)}var we=Ke.compact(U),Te=Ke.compact(j),Ue=Ke.compact(te),Ge=Ke.compact(q);return b.vertexCount=L,b.triangleCount=H,N.update(C,Te),N.update(w,Ge),N.update(x,we),N.update(_,Ue),b.meta.originalData={indexBuffer:D,vertexCount:P,triangleCount:E},b}e.uniformTriangleGroup=d,e.Params=T(T({},Dt.Params),{doubleSided:M.Boolean(!1,Dt.CustomQualityParamInfo),flipSided:M.Boolean(!1,Dt.ShadingCategory),flatShaded:M.Boolean(!1,Dt.ShadingCategory),ignoreLight:M.Boolean(!1,Dt.ShadingCategory),xrayShaded:M.Boolean(!1,Dt.ShadingCategory)}),e.Utils={Params:e.Params,createEmpty:r,createValues:p,createValuesSimple:h,updateValues:m,updateBoundingSphere:v,createRenderableState:g,updateRenderableState:y,createPositionIterator:f};function f(b,S){var x=b.vertexCount,C=S.instanceCount.ref.value,w=Am(),_=w.position,E=b.vertexBuffer.ref.value,P=S.aTransform.ref.value,D=function(k,F){return F<0?A.fromArray(_,E,k*3):A.transformMat4Offset(_,E,P,0,k*3,F*16),w};return Tn(x,C,1,D)}function p(b,S,x,C,w){var _=x.instanceCount,E=x.groupCount;if(_!==S.instanceCount.ref.value)throw new Error("instanceCount values in TransformData and LocationIterator differ");var P=f(b,S),D=Ds(x,P,C.color),k=xu(_*E),F=kd(),X=Rd(),U=Od(),j={drawCount:b.triangleCount*3,vertexCount:b.vertexCount,groupCount:E,instanceCount:_},te=He.clone(b.boundingSphere),q=ii(te,S.aTransform.ref.value,_);return T(T(T(T(T(T(T(T({aPosition:b.vertexBuffer,aNormal:b.normalBuffer,aGroup:b.groupBuffer,elements:b.indexBuffer,boundingSphere:N.create(q),invariantBoundingSphere:N.create(te),uInvariantBoundingSphere:N.create(Mr.ofSphere(te))},D),k),F),X),U),S),Dt.createValues(w,j)),{dDoubleSided:N.create(w.doubleSided),dFlatShaded:N.create(w.flatShaded),dFlipSided:N.create(w.flipSided),dIgnoreLight:N.create(w.ignoreLight),dXrayShaded:N.create(w.xrayShaded),meta:N.create(b.meta)})}function h(b,S,x,C,w){var _=Dt.createSimple(x,C,w),E=T(T({},M.getDefaultValues(e.Params)),S);return p(b,_.transform,_.locationIterator,_.theme,E)}function m(b,S){Dt.updateValues(b,S),N.updateIfChanged(b.dDoubleSided,S.doubleSided),N.updateIfChanged(b.dFlatShaded,S.flatShaded),N.updateIfChanged(b.dFlipSided,S.flipSided),N.updateIfChanged(b.dIgnoreLight,S.ignoreLight),N.updateIfChanged(b.dXrayShaded,S.xrayShaded)}function v(b,S){var x=He.clone(S.boundingSphere),C=ii(x,b.aTransform.ref.value,b.instanceCount.ref.value);He.equals(C,b.boundingSphere.ref.value)||N.update(b.boundingSphere,C),He.equals(x,b.invariantBoundingSphere.ref.value)||(N.update(b.invariantBoundingSphere,x),N.update(b.uInvariantBoundingSphere,Mr.fromSphere(b.uInvariantBoundingSphere.ref.value,x)))}function g(b){var S=Dt.createRenderableState(b);return y(S,b),S}function y(b,S){Dt.updateRenderableState(b,S),b.opaque=b.opaque&&!S.xrayShaded,b.writeDepth=b.opaque}})(Wt||(Wt={}));var nAe={radius:1,detail:0};function aAe(e,t,r){var n=T(T({},nAe),r),a=n.radius,i=n.detail,o=iAe(),s=o.vertices,u=o.indices;c(i),t3e(s,a);var l=new Float32Array(s.length);return IW(s,u,l,s.length/3,u.length/3),{vertices:new Float32Array(s),normals:new Float32Array(l),indices:new Uint32Array(u)};function c(f){for(var p=A(),h=A(),m=A(),v=0;v<t.length;v+=3)A.fromArray(p,e,t[v+0]*3),A.fromArray(h,e,t[v+1]*3),A.fromArray(m,e,t[v+2]*3),d(p,h,m,f)}function d(f,p,h,m){for(var v=Math.pow(2,m),g=[],y=0;y<=v;++y){g[y]=[];var b=A();A.lerp(b,f,h,y/v);var S=A();A.lerp(S,p,h,y/v);for(var x=v-y,C=0;C<=x;++C)if(C===0&&y===v)g[y][C]=b;else{var w=A();A.lerp(w,b,S,C/x),g[y][C]=w}}for(var y=0;y<v;++y)for(var C=0;C<2*(v-y)-1;++C){var _=Math.floor(C/2);C%2===0?o.add(g[y][_+1],g[y+1][_],g[y][_]):o.add(g[y][_+1],g[y+1][_+1],g[y+1][_])}}}function iAe(){var e=[],t=[],r=new Map;function n(a){var i=a[0].toFixed(5)+"|"+a[1].toFixed(5)+"|"+a[2].toFixed(5),o=r.get(i);return o===void 0&&(o=e.length/3,r.set(i,o),e.push.apply(e,a)),o}return{vertices:e,indices:t,add:function(a,i,o){t.push(n(a),n(i),n(o))}}}var zs=(1+Math.sqrt(5))/2,oAe=[-1,zs,0,1,zs,0,-1,-zs,0,1,-zs,0,0,-1,zs,0,1,zs,0,-1,-zs,0,1,-zs,zs,0,-1,zs,0,1,-zs,0,-1,-zs,0,1],sAe=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],IA;function uAe(){return IA||(IA=Kw(oAe,sAe)),IA}var oX=uAe(),lAe=oX.vertices,cAe=oX.indices;function xk(e){return 10*Math.pow(Math.pow(2,e),2)+2}function dAe(e){return aAe(lAe,cAe,{detail:e,radius:1})}var CL=new Map,fAe=de.identity();function pAe(e,t,r){return de.scaleUniformly(e,de.fromTranslation(e,t),r)}function sX(e){var t=CL.get(e);return t===void 0&&(t=dAe(e),CL.set(e,t)),t}function ti(e,t,r,n){kt.addPrimitive(e,pAe(fAe,t,r),sX(n))}var Tl={radiusTop:1,radiusBottom:1,height:1,radialSegments:8,heightSegments:1,topCap:!1,bottomCap:!1,thetaStart:0,thetaLength:Math.PI*2};function hAe(e){var t=T(T({},Tl),e),r=t.radiusTop,n=t.radiusBottom,a=t.height,i=t.radialSegments,o=t.heightSegments,s=t.topCap,u=t.bottomCap,l=t.thetaStart,c=t.thetaLength,d=[],f=[],p=[],h=0,m=[],v=a/2;return g(),s&&r>0&&y(!0),u&&n>0&&y(!1),{vertices:new Float32Array(f),normals:new Float32Array(p),indices:new Uint32Array(d)};function g(){for(var b=A.zero(),S=(n-r)/a,x=0;x<=o;++x){for(var C=[],w=x/o,_=w*(n-r)+r,E=0;E<=i;++E){var P=E/i,D=P*c+l,k=Math.sin(D),F=Math.cos(D);f.push(_*k,-w*a+v,_*F),A.normalize(b,A.set(b,k,S,F)),p.push.apply(p,b),C.push(h++)}m.push(C)}for(var E=0;E<i;++E)for(var x=0;x<o;++x){var X=m[x][E],U=m[x+1][E],j=m[x+1][E+1],te=m[x][E+1];d.push(X,U,te),d.push(U,j,te)}}function y(b){for(var S=b===!0?r:n,x=b===!0?1:-1,C=h,w=1;w<=i;++w)f.push(0,v*x,0),p.push(0,x,0),++h;for(var _=h,w=0;w<=i;++w){var E=w/i,P=E*c+l,D=Math.cos(P),k=Math.sin(P);f.push(S*k,v*x,S*D),p.push(0,x,0),++h}for(var w=0;w<i;++w){var F=C+w,X=_+w;b===!0?d.push(X,X+1,F):d.push(X+1,X,F)}}}var wL=A(),_L=A(),Eo=A(),Po=A(),xl=A(),Zm=A(),mAe={height:1,topCap:!0,bottomCap:!0};function z0(e,t){var r=e.length/3;if(r<3)throw new Error("need at least 3 points to build a prism");var n=T(T({},mAe),t),a=n.height,i=n.topCap,o=n.bottomCap,s=r*2,u=r*4,l=(i?1:0)+(o?1:0);r===3?(s+=l,u+=l*3):r===4?(s+=l*2,u+=l*4):(s+=l*r,u+=l*r*3);var c=N0(s,u),d=a*.5;A.set(wL,0,0,-d),A.set(_L,0,0,d);for(var f=0;f<r;++f){var p=(f+1)%r;A.set(Eo,e[f*3],e[f*3+1],-d),A.set(Po,e[p*3],e[p*3+1],-d),A.set(xl,e[p*3],e[p*3+1],d),A.set(Zm,e[f*3],e[f*3+1],d),c.addQuad(Eo,Po,xl,Zm)}if(r===3)i&&(A.set(Eo,e[0],e[1],-d),A.set(Po,e[3],e[4],-d),A.set(xl,e[6],e[7],-d),c.add(xl,Po,Eo)),o&&(A.set(Eo,e[0],e[1],d),A.set(Po,e[3],e[4],d),A.set(xl,e[6],e[7],d),c.add(Eo,Po,xl));else if(r===4)i&&(A.set(Eo,e[0],e[1],-d),A.set(Po,e[3],e[4],-d),A.set(xl,e[6],e[7],-d),A.set(Zm,e[9],e[10],-d),c.addQuad(Zm,xl,Po,Eo)),o&&(A.set(Eo,e[0],e[1],d),A.set(Po,e[3],e[4],d),A.set(xl,e[6],e[7],d),A.set(Zm,e[9],e[10],d),c.addQuad(Eo,Po,xl,Zm));else for(var f=0;f<r;++f){var p=(f+1)%r;i&&(A.set(Eo,e[f*3],e[f*3+1],-d),A.set(Po,e[p*3],e[p*3+1],-d),c.add(wL,Po,Eo)),o&&(A.set(Eo,e[f*3],e[f*3+1],d),A.set(Po,e[p*3],e[p*3+1],d),c.add(Eo,Po,_L))}return c.getPrimitive()}var MA;function vAe(){return MA||(MA=z0(dc(4,!1))),MA}var DA;function gAe(){return DA||(DA=z0(dc(5,!1))),DA}var kA;function yAe(){return kA||(kA=z0(dc(6,!1))),kA}var RA;function bAe(){return RA||(RA=z0(dc(6,!0))),RA}var OA;function xAe(){return OA||(OA=z0(dc(7,!1))),OA}var AL=new Map,SAe=A.create(0,1,0),zl=A(),G2=A(),TL=A(),Xf=de(),EL=de(),CAe=A(),PL=de(),kv=A(),IL=A();function zC(e,t,r,n,a){return A.setMagnitude(G2,r,n/2),A.add(TL,t,G2),a&&A.matchDirection(IL,SAe,G2),de.fromScaling(PL,A.set(CAe,1,n,1)),A.makeRotation(EL,IL,G2),de.mul(e,EL,PL),de.setTranslation(e,TL)}var Sl=new Int32Array(9);function wAe(e){var t,r,n,a,i,o,s,u,l;return Sl[0]=Math.round(1e3*((t=e.radiusTop)!==null&&t!==void 0?t:Tl.radiusTop)),Sl[1]=Math.round(1e3*((r=e.radiusBottom)!==null&&r!==void 0?r:Tl.radiusBottom)),Sl[2]=Math.round(1e3*((n=e.height)!==null&&n!==void 0?n:Tl.height)),Sl[3]=(a=e.radialSegments)!==null&&a!==void 0?a:Tl.radialSegments,Sl[4]=(i=e.heightSegments)!==null&&i!==void 0?i:Tl.heightSegments,Sl[5]=((o=e.topCap)!==null&&o!==void 0?o:Tl.topCap)?1:0,Sl[6]=((s=e.bottomCap)!==null&&s!==void 0?s:Tl.bottomCap)?1:0,Sl[7]=Math.round(1e3*((u=e.thetaStart)!==null&&u!==void 0?u:Tl.thetaStart)),Sl[8]=Math.round(1e3*((l=e.thetaLength)!==null&&l!==void 0?l:Tl.thetaLength)),eo(Sl)}function Sk(e){var t=wAe(e),r=AL.get(t);if(r===void 0){if(e.radialSegments&&e.radialSegments<=4){var n=Math.max(3,e.radialSegments),a=z0(dc(n,!0,e.radiusTop),e);r=vk(a,de.rotX90)}else r=hAe(e);AL.set(t,r)}return r}function gs(e,t,r,n,a){var i=A.distance(t,r)*n;A.sub(zl,r,t),zC(Xf,t,zl,i,!0),kt.addPrimitive(e,Xf,Sk(a))}function _Ae(e,t,r,n,a,i){var o=A.distance(t,r)*n,s=Sk(i);A.sub(zl,r,t),A.add(kv,t,a),zC(Xf,kv,zl,o,!0),kt.addPrimitive(e,Xf,s),A.sub(kv,t,a),zC(Xf,kv,zl,o,!0),kt.addPrimitive(e,Xf,s)}function f5(e,t,r,n,a,i){var o=Math.floor(a/2),s=1/a;if(n<1){var u=n/2/a;n+=a%2===1?u:-u}var l=A.distance(t,r)*n,c=Sk(i);A.sub(zl,r,t);for(var d=0;d<o;++d){var f=s*(d*2+1);A.setMagnitude(zl,zl,l*f),A.add(kv,t,zl),zC(Xf,kv,zl,l*s,!1),kt.addPrimitive(e,Xf,c)}}var fa=A(),ML=ia(),Ec=A(),Cl=A(),Kp=A(),q2=A(),ns=A.fromArray,AAe=A.triangleNormal,DL=A.copy,W2=A.transformMat4,kL=A.transformMat3,RL=ia.directionTransform,Mu=Ke.add3,BA=Ke.add,kt;(function(e){function t(c,d,f){return c===void 0&&(c=2048),d===void 0&&(d=1024),{currentGroup:-1,vertices:Ke.create(Float32Array,3,d,f?f.vertexBuffer.ref.value:c),normals:Ke.create(Float32Array,3,d,f?f.normalBuffer.ref.value:c),indices:Ke.create(Uint32Array,3,d*3,f?f.indexBuffer.ref.value:c*3),groups:Ke.create(Float32Array,1,d,f?f.groupBuffer.ref.value:c),mesh:f}}e.createState=t;function r(c,d,f,p){var h=c.vertices,m=c.normals,v=c.indices,g=c.groups,y=c.currentGroup,b=h.elementCount;Mu(h,d[0],d[1],d[2]),Mu(h,f[0],f[1],f[2]),Mu(h,p[0],p[1],p[2]),AAe(fa,d,f,p);for(var S=0;S<3;++S)Mu(m,fa[0],fa[1],fa[2]),BA(g,y);Mu(v,b,b+1,b+2)}e.addTriangle=r;function n(c,d,f){ns(Kp,d,f[0]*3),ns(q2,d,f[1]*3);for(var p=2,h=f.length;p<h;p+=2)DL(Ec,Kp),DL(Cl,q2),ns(Kp,d,f[p]*3),ns(q2,d,f[p+1]*3),r(c,Ec,Cl,Kp),r(c,Cl,q2,Kp)}e.addTriangleStrip=n;function a(c,d,f){ns(Ec,d,f[0]*3);for(var p=2,h=f.length;p<h;++p)ns(Cl,d,f[p-1]*3),ns(Kp,d,f[p]*3),r(c,Ec,Kp,Cl)}e.addTriangleFan=a;function i(c,d,f){for(var p=f.vertices,h=f.normals,m=f.indices,v=c.vertices,g=c.normals,y=c.indices,b=c.groups,S=c.currentGroup,x=v.elementCount,C=RL(ML,d),w=0,_=p.length;w<_;w+=3)W2(fa,ns(fa,p,w),d),Mu(v,fa[0],fa[1],fa[2]),kL(fa,ns(fa,h,w),C),Mu(g,fa[0],fa[1],fa[2]),BA(b,S);for(var w=0,_=m.length;w<_;w+=3)Mu(y,m[w]+x,m[w+1]+x,m[w+2]+x)}e.addPrimitive=i;function o(c,d,f){for(var p=f.vertices,h=f.normals,m=f.indices,v=c.vertices,g=c.normals,y=c.indices,b=c.groups,S=c.currentGroup,x=v.elementCount,C=RL(ML,d),w=0,_=p.length;w<_;w+=3)W2(fa,ns(fa,p,w),d),Mu(v,fa[0],fa[1],fa[2]),kL(fa,ns(fa,h,w),C),Mu(g,-fa[0],-fa[1],-fa[2]),BA(b,S);for(var w=0,_=m.length;w<_;w+=3)Mu(y,m[w+2]+x,m[w+1]+x,m[w]+x)}e.addPrimitiveFlipped=o;function s(c,d,f,p,h,m){for(var v=f.vertices,g=f.edges,y={radiusTop:p,radiusBottom:p,radialSegments:m},b=0,S=g.length;b<S;b+=2)ns(Ec,v,g[b]*3),ns(Cl,v,g[b+1]*3),W2(Ec,Ec,d),W2(Cl,Cl,d),ti(c,Ec,p,h),ti(c,Cl,p,h),gs(c,Ec,Cl,1,y)}e.addCage=s;function u(c,d,f){i(c,d,{vertices:f.vertexBuffer.ref.value.subarray(0,f.vertexCount*3),normals:f.normalBuffer.ref.value.subarray(0,f.vertexCount*3),indices:f.indexBuffer.ref.value.subarray(0,f.triangleCount*3)})}e.addMesh=u;function l(c){var d=c.vertices,f=c.normals,p=c.indices,h=c.groups,m=c.mesh,v=Ke.compact(d,!0),g=Ke.compact(p,!0),y=Ke.compact(f,!0),b=Ke.compact(h,!0);return Wt.create(v,g,y,b,c.vertices.elementCount,c.indices.elementCount,m)}e.getMesh=l})(kt||(kt={}));var TAe=1,EAe="Assigns sizes as defined by the shape object.",uX={};function PAe(e){return uX}function Ck(e,t){return{factory:Ck,granularity:"groupInstance",size:function(r){return po.isLocation(r)?r.shape.getSize(r.group,r.instance):TAe},props:t,description:EAe}}var IAe={name:"shape-group",label:"Shape Group",category:"",factory:Ck,getParams:PAe,defaultValues:M.getDefaultValues(uX),isApplicable:function(e){return!!e.shape}},MAe=vt(13421772),DAe="Assigns colors as defined by the shape object.",lX={};function kAe(e){return lX}function wk(e,t){return{factory:wk,granularity:"groupInstance",color:function(r){return po.isLocation(r)?r.shape.getColor(r.group,r.instance):MAe},props:t,description:DAe}}var RAe={name:"shape-group",label:"Shape Group",category:"Miscellaneous",factory:wk,getParams:kAe,defaultValues:M.getDefaultValues(lX),isApplicable:function(e){return!!e.shape}},cX=ro();function zd(e,t,r){return{id:cX(),materialId:e.materialId,values:t,state:r,render:function(n,a){t.uAlpha&&t.alpha&&N.updateIfChanged(t.uAlpha,$i(t.alpha.ref.value*r.alphaFactor,0,1)),e.render(n,a)},getProgram:function(n){return e.getProgram(n)},update:function(){return e.update()},dispose:function(){return e.destroy()}}}function ui(e,t){return{id:cX(),values:t,render:function(){return e.render("compute")},update:function(){return e.update()},dispose:function(){return e.destroy()}}}var OAe=ro();function BAe(e,t){var r=e.gl;switch(t){case"points":return r.POINTS;case"lines":return r.LINES;case"line-strip":return r.LINE_STRIP;case"line-loop":return r.LINE_LOOP;case"triangles":return r.TRIANGLES;case"triangle-strip":return r.TRIANGLE_STRIP;case"triangle-fan":return r.TRIANGLE_FAN}}var FAe={colorBlended:"",colorWboit:"",pickObject:"",pickInstance:"",pickGroup:"",depth:""},LAe=Object.keys(FAe),NAe={compute:""},zAe=Object.keys(NAe);function OL(e,t,r,n,a){return r=T(T({},r),{dRenderVariant:N.create(t)}),a.dRenderVariant===void 0&&Object.defineProperty(a,"dRenderVariant",{value:nr("string")}),e.resources.program(r,n,a)}function UAe(){return{attributes:!1,defines:!1,elements:!1,textures:!1}}function VAe(e){e.attributes=!1,e.defines=!1,e.elements=!1,e.textures=!1}function Ud(e,t,r,n,a,i){return dX(e,t,r,n,a,i,LAe)}function li(e,t,r,n,a,i){return i===void 0&&(i=-1),dX(e,t,r,n,a,i,zAe)}function dX(e,t,r,n,a,i,o){var s=OAe(),u=e.stats,l=e.state,c=e.resources,d=e.extensions,f=d.instancedArrays,p=d.vertexArrayObject;if(a.uVertexCount){var h=a.uVertexCount.ref.value;a.aVertex=N.create(pu(new Float32Array(h))),n.aVertex=Zr("float32",1,0)}for(var m=J3e(n,a),v=m.attributeValues,g=m.defineValues,y=m.textureValues,b=m.uniformValues,S=m.materialUniformValues,x=m.bufferedUniformValues,C=Object.entries(b),w=Object.entries(S),_=Object.entries(x),E=Object.entries(L_e(x)),P=Object.entries(g),D=ewe(a),k=BAe(e,t),F={},X=0,U=o;X<U.length;X++){var j=U[X];F[j]=OL(e,j,g,r,n)}var te=X4e(e,n,y),q=G_e(e,n,v),W,V=a.elements;V&&V.ref.value&&(W=c.elements(V.ref.value));for(var ee={},ue=0,$=o;ue<$.length;ue++){var j=$[ue];ee[j]=p?c.vertexArray(F[j],q,W):null}var Q=a.drawCount.ref.value,R=a.instanceCount.ref.value;u.drawCount+=Q,u.instanceCount+=R,u.instancedDrawCount+=R*Q;var Y=UAe(),re=!1,K=-1;return{id:s,materialId:i,getProgram:function(L){return F[L]},render:function(L,H){if(!(Q===0||R===0||e.isContextLost)){var Z=F[L];if(Z.id===K&&l.currentRenderItemId===s)Z.setUniforms(C),H&&H.length>0?(Z.bindTextures(H,0),Z.bindTextures(te,H.length)):Z.bindTextures(te,0);else{var fe=ee[L];(Z.id!==l.currentProgramId||Z.id!==K||i===-1||i!==l.currentMaterialId)&&(Z.id!==l.currentProgramId&&Z.use(),Z.setUniforms(w),l.currentMaterialId=i,K=Z.id),Z.setUniforms(C),Z.setUniforms(E),H&&H.length>0?(Z.bindTextures(H,0),Z.bindTextures(te,H.length)):Z.bindTextures(te,0),fe?(fe.bind(),W&&W.bind()):(W&&W.bind(),Z.bindAttributes(q)),l.currentRenderItemId=s}if(Fr)try{bk(e.gl)}catch(me){throw new Error("Framebuffer error rendering item id "+s+": '"+me+"'")}if(W?f.drawElementsInstanced(k,Q,W._dataType,0,R):f.drawArraysInstanced(k,0,Q,R),Fr)try{ZW(e.gl)}catch(me){throw new Error("Draw error rendering item id "+s+": '"+me+"'")}}},update:function(){if(VAe(Y),a.aVertex){var L=a.uVertexCount.ref.value;a.aVertex.ref.value.length<L&&N.update(a.aVertex,pu(new Float32Array(L)))}for(var H=0,Z=P.length;H<Z;++H){var fe=P[H],me=fe[0],xe=fe[1];xe.ref.version!==D[me]&&(Y.defines=!0,D[me]=xe.ref.version)}if(Y.defines)for(var Se=0,ie=o;Se<ie.length;Se++){var me=ie[Se];F[me].destroy(),F[me]=OL(e,me,g,r,n)}a.drawCount.ref.version!==D.drawCount&&(u.drawCount+=a.drawCount.ref.value-Q,u.instancedDrawCount+=R*a.drawCount.ref.value-R*Q,Q=a.drawCount.ref.value,D.drawCount=a.drawCount.ref.version),a.instanceCount.ref.version!==D.instanceCount&&(u.instanceCount+=a.instanceCount.ref.value-R,u.instancedDrawCount+=a.instanceCount.ref.value*Q-R*Q,R=a.instanceCount.ref.value,D.instanceCount=a.instanceCount.ref.version);for(var H=0,Z=q.length;H<Z;++H){var le=q[H],me=le[0],O=le[1],xe=v[me];if(xe.ref.version!==D[me]){if(O.length>=xe.ref.value.length)O.updateSubData(xe.ref.value,0,O.length);else{O.destroy();var G=n[me],ve=G.itemSize,we=G.divisor;q[H][1]=c.attribute(xe.ref.value,ve,we),Y.attributes=!0}D[me]=xe.ref.version}}if(W&&a.elements.ref.version!==D.elements&&(W.length>=a.elements.ref.value.length?W.updateSubData(a.elements.ref.value,0,W.length):(W.destroy(),W=c.elements(a.elements.ref.value),Y.elements=!0),D.elements=a.elements.ref.version),Y.attributes||Y.defines||Y.elements)for(var Te=0,Ue=o;Te<Ue.length;Te++){var me=Ue[Te],Ge=ee[me];Ge&&Ge.destroy(),ee[me]=p?c.vertexArray(F[me],q,W):null}for(var H=0,Z=te.length;H<Z;++H){var Je=te[H],me=Je[0],st=Je[1],xe=y[me];xe.ref.version!==D[me]&&(n[me].kind!=="texture"?(st.load(xe.ref.value),Y.textures=!0):te[H][1]=xe.ref.value,D[me]=xe.ref.version)}for(var H=0,Z=_.length;H<Z;++H){var ze=_[H],me=ze[0],et=ze[1];et.ref.version!==D[me]&&(N.update(E[H][1],mp(et.ref.value)),D[me]=et.ref.version)}return Y},destroy:function(){if(!re){for(var L=0,H=o;L<H.length;L++){var Z=H[L];F[Z].destroy();var fe=ee[Z];fe&&fe.destroy()}te.forEach(function(me){var xe=me[0],Se=me[1];n[xe].kind!=="texture"&&Se.destroy()}),q.forEach(function(me){me[0];var xe=me[1];return xe.destroy()}),W&&W.destroy(),u.drawCount-=Q,u.instanceCount-=R,u.instancedDrawCount-=R*Q,re=!0}}}}var HAe=T(T({},Nd),{aPosition:Zr("float32",3,0),elements:Tm("uint32"),uColor:Ye("v3"),uColorTexDim:Ye("v2"),tColor:hr("image-uint8","rgb","ubyte","nearest"),dColorType:nr("string",["uniform","attribute","instance","group","groupInstance","vertex","vertexInstance"]),uIsoValue:Ye("v2"),uBboxMin:Ye("v3"),uBboxMax:Ye("v3"),uBboxSize:Ye("v3"),uMaxSteps:Ye("i"),uStepScale:Ye("f"),uJumpLength:Ye("f"),uTransform:Ye("m4"),uGridDim:Ye("v3"),dRenderMode:nr("string",["isosurface","volume"]),dSingleLayer:nr("boolean"),tTransferTex:hr("image-uint8","rgba","ubyte","linear"),uTransferScale:Ye("f"),dGridTexType:nr("string",["2d","3d"]),uGridTexDim:Ye("v3"),tGridTex:hr("texture","rgba","ubyte","linear"),uGridStats:Ye("v4"),uCellDim:Ye("v3"),uCartnToUnit:Ye("m4"),uUnitToCartn:Ye("m4"),dPackedGroup:nr("boolean"),dDoubleSided:nr("boolean"),dFlipSided:nr("boolean"),dFlatShaded:nr("boolean"),dIgnoreLight:nr("boolean"),dXrayShaded:nr("boolean")});function jAe(e,t,r,n,a){var i=T(T(T(T({},Bd),Fd),Ld),HAe);e.isWebGL2||(i.uMaxSteps=nr("number"));var o={uObjectId:N.create(t)},s=g_e,u=Ud(e,"triangles",s,i,T(T({},r),o),a);return zd(u,r,n)}var GAe=T(T({},Nd),{aGroup:Zr("float32",1,0),aPosition:Zr("float32",3,0),aNormal:Zr("float32",3,0),elements:Tm("uint32"),dFlatShaded:nr("boolean"),dDoubleSided:nr("boolean"),dFlipSided:nr("boolean"),dIgnoreLight:nr("boolean"),dXrayShaded:nr("boolean"),meta:Ra("unknown")});function qAe(e,t,r,n,a){var i=T(T(T(T({},Bd),Fd),Ld),GAe),o={uObjectId:N.create(t)},s=YW,u=Ud(e,"triangles",s,i,T(T({},r),o),a);return zd(u,r,n)}var WAe=T(T(T({},Nd),mb),{aGroup:Zr("float32",1,0),aPosition:Zr("float32",3,0),dPointSizeAttenuation:nr("boolean"),dPointFilledCircle:nr("boolean"),uPointEdgeBleach:Ye("f")});function XAe(e,t,r,n,a){var i=T(T(T(T({},Bd),Fd),Ld),WAe),o={uObjectId:N.create(t)},s=f_e,u=Ud(e,"points",s,i,T(T({},r),o),a);return zd(u,r,n)}var YAe=T(T(T({},Nd),mb),{aGroup:Zr("float32",1,0),aMapping:Zr("float32",2,0),aStart:Zr("float32",3,0),aEnd:Zr("float32",3,0),elements:Tm("uint32"),dLineSizeAttenuation:nr("boolean"),dDoubleSided:nr("boolean"),dFlipSided:nr("boolean")});function KAe(e,t,r,n,a){var i=T(T(T(T({},Bd),Fd),Ld),YAe),o={uObjectId:N.create(t)},s=v_e,u=Ud(e,"triangles",s,i,T(T({},r),o),a);return zd(u,r,n)}var $Ae=T(T(T({},Nd),mb),{aGroup:Zr("float32",1,0),aPosition:Zr("float32",3,0),aMapping:Zr("float32",2,0),elements:Tm("uint32"),padding:Ra("number"),dDoubleSided:nr("boolean"),dIgnoreLight:nr("boolean"),dXrayShaded:nr("boolean")});function QAe(e,t,r,n,a){var i=T(T(T(T({},Bd),Fd),Ld),$Ae),o={uObjectId:N.create(t)},s=p_e,u=Ud(e,"triangles",s,i,T(T({},r),o),a);return zd(u,r,n)}var ZAe=T(T(T({},Nd),mb),{aGroup:Zr("float32",1,0),aPosition:Zr("float32",3,0),aMapping:Zr("float32",2,0),aDepth:Zr("float32",1,0),elements:Tm("uint32"),aTexCoord:Zr("float32",2,0),tFont:hr("image-uint8","alpha","ubyte","linear"),padding:Ra("number"),uBorderWidth:Ye("f"),uBorderColor:Ye("v3"),uOffsetX:Ye("f"),uOffsetY:Ye("f"),uOffsetZ:Ye("f"),uBackgroundColor:Ye("v3"),uBackgroundOpacity:Ye("f")});function JAe(e,t,r,n,a){var i=T(T(T(T({},Bd),Fd),Ld),ZAe),o={uObjectId:N.create(t)},s=m_e,u=Ud(e,"triangles",s,i,T(T({},r),o),a);return zd(u,r,n)}var eTe=T(T({},Nd),{uGeoTexDim:Ye("v2","buffered"),tPosition:hr("texture","rgb","float","nearest"),tGroup:hr("texture","alpha","float","nearest"),tNormal:hr("texture","rgb","float","nearest"),dFlatShaded:nr("boolean"),dDoubleSided:nr("boolean"),dFlipSided:nr("boolean"),dIgnoreLight:nr("boolean"),dXrayShaded:nr("boolean"),dGeoTexture:nr("boolean")});function tTe(e,t,r,n,a){var i=T(T(T(T({},Bd),Fd),Ld),eTe),o={uObjectId:N.create(t)},s=YW,u=Ud(e,"triangles",s,i,T(T({},r),o),a);return zd(u,r,n)}var rTe=T(T({},Nd),{aGroup:Zr("float32",1,0),aPosition:Zr("float32",3,0),aUv:Zr("float32",2,0),elements:Tm("uint32"),uImageTexDim:Ye("v2"),tImageTex:hr("image-uint8","rgba","ubyte","nearest"),tGroupTex:hr("image-uint8","rgba","ubyte","nearest"),dInterpolation:nr("string",swe)});function nTe(e,t,r,n,a){var i=T(T(T(T({},Bd),Fd),Ld),rTe),o={uObjectId:N.create(t)},s=y_e,u=Ud(e,"triangles",s,i,T(T({},r),o),a);return zd(u,r,n)}var aTe=T(T(T({},Nd),mb),{aGroup:Zr("float32",1,0),aStart:Zr("float32",3,0),aEnd:Zr("float32",3,0),aMapping:Zr("float32",3,0),aScale:Zr("float32",1,0),aCap:Zr("float32",1,0),elements:Tm("uint32"),padding:Ra("number"),dDoubleSided:nr("boolean"),dIgnoreLight:nr("boolean"),dXrayShaded:nr("boolean")});function iTe(e,t,r,n,a){var i=T(T(T(T({},Bd),Fd),Ld),aTe),o={uObjectId:N.create(t)},s=h_e,u=Ud(e,"triangles",s,i,T(T({},r),o),a);return zd(u,r,n)}var oTe=ro(0,2147483647),Vd=ro(0,2147483647);function U0(e,t,r,n){return{id:oTe(),type:e,values:t,state:r,materialId:n}}function sTe(e,t){switch(t.type){case"mesh":return qAe(e,t.id,t.values,t.state,t.materialId);case"points":return XAe(e,t.id,t.values,t.state,t.materialId);case"spheres":return QAe(e,t.id,t.values,t.state,t.materialId);case"cylinders":return iTe(e,t.id,t.values,t.state,t.materialId);case"text":return JAe(e,t.id,t.values,t.state,t.materialId);case"lines":return KAe(e,t.id,t.values,t.state,t.materialId);case"direct-volume":return jAe(e,t.id,t.values,t.state,t.materialId);case"image":return nTe(e,t.id,t.values,t.state,t.materialId);case"texture-mesh":return tTe(e,t.id,t.values,t.state,t.materialId)}throw new Error("unsupported type")}var Nr;(function(e){function t(c,d,f,p,h,m,v){return{id:Cn.create22(),name:c,sourceData:d,geometry:f,transforms:v||[de.identity()],get groupCount(){return xi.getGroupCount(f)},getColor:p,getSize:h,getLabel:m}}e.create=t;function r(c){return{color:wk({shape:c},{}),size:Ck({shape:c},{})}}e.getTheme=r;function n(c){var d=c.transforms.length,f=po.Location(c),p=function(h,m){return f.group=h,f.instance=m,f};return Tn(c.groupCount,d,1,p)}e.groupIterator=n;function a(c,d){for(var f=d&&d.aTransform.ref.value.length>=c.length*16?d.aTransform.ref.value:new Float32Array(c.length*16),p=0,h=c.length;p<h;++p)de.toArray(c[p],f,p*16);return ck(f,c.length,d)}e.createTransform=a;function i(c,d){var f=e.getTheme(c),p=xi.getUtils(c.geometry),h=Vd(),m=n(c),v=e.createTransform(c.transforms),g=p.createValues(c.geometry,v,m,f,d),y=p.createRenderableState(d);return U0(c.geometry.kind,g,y,h)}e.createRenderObject=i;function o(c){return{kind:"shape-loci",shape:c}}e.Loci=o;function s(c){return!!c&&c.kind==="shape-loci"}e.isLoci=s;function u(c,d){return c.shape===d.shape}e.areLociEqual=u;function l(c){return c.shape.groupCount===0}e.isLociEmpty=l})(Nr||(Nr={}));var po;(function(e){function t(p,h,m){return h===void 0&&(h=0),m===void 0&&(m=0),{kind:"group-location",shape:p,group:h,instance:m}}e.Location=t;function r(p){return!!p&&p.kind==="group-location"}e.isLocation=r;function n(p,h){return{kind:"group-loci",shape:p,groups:h}}e.Loci=n;function a(p){return!!p&&p.kind==="group-loci"}e.isLoci=a;function i(p,h){if(p.shape!==h.shape||p.groups.length!==h.groups.length)return!1;for(var m=0,v=p.groups.length;m<v;++m){var g=p.groups[m],y=g.ids,b=g.instance,S=h.groups[m],x=S.ids,C=S.instance;if(b!==C||!Ne.areEqual(y,x))return!1}return!0}e.areLociEqual=i;function o(p){return s(p)===0}e.isLociEmpty=o;function s(p){for(var h=0,m=0,v=p.groups;m<v.length;m++){var g=v[m];h+=Ne.size(g.ids)}return h}e.size=s;var u=new gd,l=A.zero();function c(p,h,m,v){for(var g=h.indices,y=h.offsets,b=function(E,P){Ne.forEach(E,function(D){for(var k=y[D],F=y[D+1];k<F;++k)A.fromArray(l,m,g[k]*3),A.transformMat4(l,l,v[P]),u.includeStep(l)})},S=0,x=p;S<x.length;S++){var C=x[S],w=C.ids,_=C.instance;b(w,_)}}function d(p,h,m,v){for(var g=h.indices,y=h.offsets,b=function(E,P){Ne.forEach(E,function(D){for(var k=y[D],F=y[D+1];k<F;++k)A.fromArray(l,m,g[k]*3),A.transformMat4(l,l,v[P]),u.radiusStep(l)})},S=0,x=p;S<x.length;S++){var C=x[S],w=C.ids,_=C.instance;b(w,_)}}function f(p,h){h||(h=He()),u.reset();var m=0,v=p.shape,g=v.geometry,y=v.transforms;if(g.kind==="mesh"||g.kind==="points"){var b=g.kind==="mesh"?g.vertexBuffer.ref.value:g.centerBuffer.ref.value;c(p.groups,g.groupMapping,b,y),u.finishedIncludeStep(),d(p.groups,g.groupMapping,b,y)}else if(g.kind==="lines"){var S=g.startBuffer.ref.value,x=g.endBuffer.ref.value;c(p.groups,g.groupMapping,S,y),c(p.groups,g.groupMapping,x,y),u.finishedIncludeStep(),d(p.groups,g.groupMapping,S,y),d(p.groups,g.groupMapping,x,y)}else if(g.kind==="spheres"||g.kind==="text"){var b=g.centerBuffer.ref.value;c(p.groups,g.groupMapping,b,y),u.finishedIncludeStep(),d(p.groups,g.groupMapping,b,y);for(var C=function(F,X){Ne.forEach(F,function(U){var j=p.shape.getSize(U,X);m<j&&(m=j)})},w=0,_=p.groups;w<_.length;w++){var E=_[w],P=E.ids,D=E.instance;C(P,D)}}else return He.copy(h,g.boundingSphere);return A.copy(h.center,u.center),h.radius=Math.sqrt(u.radiusSq),He.expand(h,h,m),h}e.getBoundingSphere=f})(po||(po={}));function fX(e){var t=e&&e.getElement("vertex"),r=e&&e.getElement("material"),n={group:"",vRed:"",vGreen:"",vBlue:"",mRed:"",mGreen:"",mBlue:""},a=[["",""]],i=[["",""]];if(t){for(var o=0,s=t.propertyNames.length;o<s;++o){var u=t.propertyNames[o],l=t.propertyTypes[o];(l==="uchar"||l==="uint8"||l==="ushort"||l==="uint16"||l==="uint"||l==="uint32"||l==="int")&&a.push([u,u]),(l==="uchar"||l==="uint8")&&i.push([u,u])}t.propertyNames.includes("atomid")?n.group="atomid":t.propertyNames.includes("material_index")&&(n.group="material_index"),t.propertyNames.includes("red")&&(n.vRed="red"),t.propertyNames.includes("green")&&(n.vGreen="green"),t.propertyNames.includes("blue")&&(n.vBlue="blue")}var c=[["",""]];if(r){for(var o=0,s=r.propertyNames.length;o<s;++o){var d=r.propertyNames[o],l=r.propertyTypes[o];(l==="uchar"||l==="uint8")&&c.push([d,d])}r.propertyNames.includes("red")&&(n.mRed="red"),r.propertyNames.includes("green")&&(n.mGreen="green"),r.propertyNames.includes("blue")&&(n.mBlue="blue")}var f=n.vRed&&n.vGreen&&n.vBlue?"vertex":n.mRed&&n.mGreen&&n.mBlue?"material":"uniform";return T(T({},Wt.Params),{coloring:M.MappedStatic(f,{vertex:M.Group({red:M.Select(n.vRed,i,{label:"Red Property"}),green:M.Select(n.vGreen,i,{label:"Green Property"}),blue:M.Select(n.vBlue,i,{label:"Blue Property"})},{isFlat:!0}),material:M.Group({red:M.Select(n.mRed,c,{label:"Red Property"}),green:M.Select(n.mGreen,c,{label:"Green Property"}),blue:M.Select(n.mBlue,c,{label:"Blue Property"})},{isFlat:!0}),uniform:M.Group({color:M.Color(gr.grey)},{isFlat:!0})}),grouping:M.MappedStatic(n.group?"vertex":"none",{vertex:M.Group({group:M.Select(n.group,a,{label:"Group Property"})},{isFlat:!0}),none:M.Group({})})})}var BL=fX();function uTe(e,t,r,n,a){var i=r.vertices,o=r.normals,s=r.groups,u=n.getProperty("x"),l=n.getProperty("y"),c=n.getProperty("z");if(!u||!l||!c)throw new Error("missing coordinate properties");for(var d=n.getProperty("nx"),f=n.getProperty("ny"),p=n.getProperty("nz"),h=!!d&&!!f&&!!p,m=e;m<t;++m)Ke.add3(i,u.value(m),l.value(m),c.value(m)),h&&Ke.add3(o,d.value(m),f.value(m),p.value(m)),Ke.add(s,a[m])}function lTe(e,t,r,n){for(var a=r.indices,i=e;i<t;++i){var o=n.value(i),s=o.entries,u=o.count;u===3?Ke.add3(a,s[0],s[1],s[2]):u===4&&(Ke.add3(a,s[2],s[1],s[0]),Ke.add3(a,s[2],s[0],s[3]))}}function cTe(e,t,r,n,a){return pe(this,void 0,void 0,function(){var i,o,s,u,l,c,d,f,p,h,m,h,m,v;return he(this,function(g){switch(g.label){case 0:if(i=kt.createState(t.rowCount,t.rowCount/4,a),o=t.getProperty("x"),s=t.getProperty("y"),u=t.getProperty("z"),!o||!s||!u)throw new Error("missing coordinate properties");l=t.getProperty("nx"),c=t.getProperty("ny"),d=t.getProperty("nz"),f=!!l&&!!c&&!!d,p=1e5,h=0,m=t.rowCount,g.label=1;case 1:return h<m?(uTe(h,Math.min(h+p,m),i,t,n),e.shouldUpdate?[4,e.update({message:"adding ply mesh vertices",current:h,max:m})]:[3,3]):[3,4];case 2:g.sent(),g.label=3;case 3:return h+=p,[3,1];case 4:h=0,m=r.rowCount,g.label=5;case 5:return h<m?(lTe(h,Math.min(h+p,m),i,r),e.shouldUpdate?[4,e.update({message:"adding ply mesh faces",current:h,max:m})]:[3,7]):[3,8];case 6:g.sent(),g.label=7;case 7:return h+=p,[3,5];case 8:return v=kt.getMesh(i),f||Wt.computeNormals(v),[2,v]}})})}var Pc=ye.Schema.int;function dTe(e,t){for(var r=t.grouping,n=e.rowCount,a=r.name==="vertex"?e.getProperty(r.params.group):void 0,i=r.name==="vertex"?vs(r.params.group):"Vertex",o=a?a.toArray({array:Uint32Array}):pu(new Uint32Array(n)),s=a?nc(o):n-1,u=new Uint32Array(s+1),l=0,c=o.length;l<c;++l)u[o[l]]=l;return{ids:o,map:u,label:i}}function FL(e,t,r){var n=r.coloring,a=e.rowCount,i,o,s;if(n.name==="vertex")i=e.getProperty(n.params.red)||ye.ofConst(127,a,Pc),o=e.getProperty(n.params.green)||ye.ofConst(127,a,Pc),s=e.getProperty(n.params.blue)||ye.ofConst(127,a,Pc);else if(n.name==="material")i=t&&t.getProperty(n.params.red)||ye.ofConst(127,a,Pc),o=t&&t.getProperty(n.params.green)||ye.ofConst(127,a,Pc),s=t&&t.getProperty(n.params.blue)||ye.ofConst(127,a,Pc);else{var u=vt.toRgb(n.params.color),l=u[0],c=u[1],d=u[2];i=ye.ofConst(l,a,Pc),o=ye.ofConst(c,a,Pc),s=ye.ofConst(d,a,Pc)}return{kind:n.name,red:i,green:o,blue:s}}function LL(e,t,r,n){var a=r.kind,i=r.red,o=r.green,s=r.blue,u=n.ids,l=n.map,c=n.label;return Nr.create("ply-mesh",e,t,function(d){var f=a==="material"?d:l[d];return vt.fromRgb(i.value(f),o.value(f),s.value(f))},function(){return 1},function(d){return c+" "+u[d]})}function fTe(){var e=this,t,r,n,a,i,o,s=function(u,l,c,d){return pe(e,void 0,void 0,function(){var f,p,h,m,v;return he(this,function(g){switch(g.label){case 0:if(f=l.getElement("vertex"),!f)throw new Error("missing vertex element");if(p=l.getElement("face"),!p)throw new Error("missing face element");return h=l.getElement("material"),m=!1,v=!1,(!t||t!==l)&&(m=!0),(!r||!M.isParamEqual(BL.grouping,r.grouping,c.grouping))&&(m=!0),(!r||!M.isParamEqual(BL.coloring,r.coloring,c.coloring))&&(v=!0),m?(i=FL(f,h,c),o=dTe(f,c),[4,cTe(u,f,p,o.ids,d&&d.geometry)]):[3,2];case 1:return a=g.sent(),n=LL(l,a,i,o),[3,3];case 2:v&&(i=FL(f,h,c),n=LL(l,a,i,o)),g.label=3;case 3:return t=l,r=mp(c),[2,n]}})})};return s}function pTe(e,t){var r=this;return Qe.create("Shape Provider",function(n){return pe(r,void 0,void 0,function(){return he(this,function(a){return[2,{label:"Mesh",data:e,params:fX(e),getShape:fTe(),geometryUtils:Wt.Utils}]})})})}function Rf(e,t){return{value:e,unit:t}}var O1;(function(e){function t(u,l,c){var d=!!u[0].cell,f=!!u[0].velocities,p=!!u[0].forces;return{id:Cn.create22(),frames:u,hasCell:d,hasVelocities:f,hasForces:p,deltaTime:l,timeOffset:c}}e.create=t;function r(u,l,c){var d=u.x,f=u.y,p=u.z;return u.xyzOrdering.frozen?c?u.xyzOrdering.isIdentity?(d=o(d,c),f=o(f,c),p=o(p,c)):yo(u.xyzOrdering.index,c)||(d=i(d,u.xyzOrdering.index,c),f=i(f,u.xyzOrdering.index,c),p=i(p,u.xyzOrdering.index,c)):u.xyzOrdering.isIdentity||(d=s(d,u.xyzOrdering.index),f=s(f,u.xyzOrdering.index),p=s(p,u.xyzOrdering.index)):c&&(u.xyzOrdering.isIdentity?(u.xyzOrdering.isIdentity=!1,u.xyzOrdering.index=c,a(d,c),a(f,c),a(p,c)):yo(u.xyzOrdering.index,c)||(d=i(d,u.xyzOrdering.index,c),f=i(f,u.xyzOrdering.index,c),p=i(p,u.xyzOrdering.index,c))),u.xyzOrdering.frozen=!0,{id:Cn.create22(),atomId:l,occupancy:ye.ofConst(1,u.elementCount,ye.Schema.int),B_iso_or_equiv:ye.ofConst(0,u.elementCount,ye.Schema.float),xyzDefined:!0,x:d,y:f,z:p}}e.getAtomicConformation=r;var n=[.123];function a(u,l){for(var c=n,d=0,f=u.length;d<f;d++)c[d]=u[l[d]];for(var d=0,f=u.length;d<f;d++)u[d]=c[d]}function i(u,l,c){for(var d=new Float32Array(u.length),f=0,p=u.length;f<p;f++)d[f]=u[l[c[f]]];return d}function o(u,l){for(var c=new Float32Array(u.length),d=0,f=u.length;d<f;d++)c[d]=u[l[d]];return c}function s(u,l){for(var c=new Float32Array(u.length),d=0,f=u.length;d<f;d++)c[l[d]]=u[d];return c}})(O1||(O1={}));function Gh(){return Gh.empty()}(function(e){function t(a,i){return{size:a,anglesInRadians:i}}e.create=t;function r(){return t(A(),A())}e.empty=r;function n(a,i,o){var s=A.magnitude(a),u=A.magnitude(i),l=A.magnitude(o),c=Math.acos(A.dot(i,o)/(u*l)),d=Math.acos(A.dot(a,o)/(s*l)),f=Math.acos(A.dot(a,i)/(s*u));return s<=0||u<=0||l<=0||c>=Math.PI||d>=Math.PI||f>=Math.PI?r():t(A.create(s,u,l),A.create(c,d,f))}e.fromBasis=n})(Gh||(Gh={}));var hTe=20.45482949774598;function mTe(e){var t=this;return Qe.create("Parse DCD",function(r){return pe(t,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d;return he(this,function(f){switch(f.label){case 0:return[4,r.update("Converting to coordinates")];case 1:for(f.sent(),n=e.header,a=n.DELTA?Rf(n.DELTA*hTe,"ps"):Rf(1,"step"),i=n.ISTART>=1?Rf((n.ISTART-1)*a.value,a.unit):Rf(0,a.unit),o=[],s=0,u=e.frames.length;s<u;++s)l=e.frames[s],c={elementCount:l.elementCount,time:Rf(i.value+a.value*s,a.unit),x:l.x,y:l.y,z:l.z,xyzOrdering:{isIdentity:!0}},l.cell&&(d=l.cell,d[1]>=-1&&d[1]<=1&&d[3]>=-1&&d[3]<=1&&d[4]>=-1&&d[4]<=1?c.cell=Gh.create(A.create(d[0],d[2],d[5]),A.create(rn(90-Math.asin(d[1])*90/Ry),rn(90-Math.asin(d[3])*90/Ry),rn(90-Math.asin(d[4])*90/Ry))):d[0]<0||d[1]<0||d[2]<0||d[3]<0||d[4]<0||d[5]<0||d[3]>180||d[4]>180||d[5]>180?c.cell=Gh.fromBasis(A.create(d[0],d[1],d[3]),A.create(d[1],d[2],d[4]),A.create(d[3],d[4],d[5])):c.cell=Gh.create(A.create(d[0],d[2],d[5]),A.create(rn(d[1]),rn(d[3]),rn(d[4])))),o.push(c);return[2,O1.create(o,a,i)]}})})})}function UC(e,t,r,n){for(var a=r,i=n-1,o=t.charCodeAt(a);(o===32||o>=48&&o<=57)&&a<=i;)o=t.charCodeAt(++a);for(o=t.charCodeAt(i);(o===32||o>=48&&o<=57)&&i>=a;)o=t.charCodeAt(--i);if(++i,a===i||a+1===i)return yt.add(e,a,i);if(o=t.charCodeAt(a),a+2===i){var s=t.charCodeAt(a+1);if((o===78||o===110)&&(s===65||s===97)||(o===67||o===99)&&(s===76||s===108)||(o===70||o===102)&&(s===69||s===101)||(o===83||o===115)&&(s===73||s===105)||(o===66||o===98)&&(s===82||s===114)||(o===65||o===97)&&(s===83||s===115))return yt.add(e,a,a+2)}if(o===67||o===99||o===72||o===104||o===78||o===110||o===79||o===111||o===80||o===112||o===83||o===115)return yt.add(e,a,a+1);yt.add(e,a,a)}var vTe=/^[\s\d]+|[\s\d]+$/g;function Qw(e){e=e.replace(vTe,"").toUpperCase();var t=e.length;if(t===0||t===1||t===2&&(e==="NA"||e==="CL"||e==="FE"||e==="SI"||e==="BR"||e==="AS"))return e;var r=e[0];return r==="C"||r==="H"||r==="N"||r==="O"||r==="P"||r==="S"?r:""}var as,Io,Lt={Blue:37052,Green:42577,Yellow:16765952,Orange:16021792,Pink:16162465,Purple:10830745,LightBlue:9424105,Brown:10582605,Red:15539236,Secondary:15854817};as={},as[0]="Hexose",as[1]="HexNAc",as[2]="Hexosamine",as[3]="Hexuronate",as[4]="Deoxyhexose",as[5]="DeoxyhexNAc",as[6]="Di-deoxyhexose",as[7]="Pentose",as[8]="Deoxynonulosonate",as[9]="Di-deoxynonulosonate",as[10]="Unknown",as[11]="Assigned";var gTe=(Io={},Io[0]=0,Io[1]=1,Io[2]=2,Io[3]=3,Io[4]=4,Io[5]=5,Io[6]=6,Io[7]=7,Io[8]=8,Io[9]=9,Io[10]=10,Io[11]=11,Io);function yTe(e,t){return e===10?t===4?12:t===5?13:t===6?14:t===7?15:10:gTe[e]}var pX={abbr:"Unk",name:"Unknown",color:Lt.Secondary,type:10},VC=[{abbr:"Glc",name:"Glucose",color:Lt.Blue,type:0},{abbr:"Man",name:"Mannose",color:Lt.Green,type:0},{abbr:"Gal",name:"Galactose",color:Lt.Yellow,type:0},{abbr:"Gul",name:"Gulose",color:Lt.Orange,type:0},{abbr:"Alt",name:"Altrose",color:Lt.Pink,type:0},{abbr:"All",name:"Allose",color:Lt.Purple,type:0},{abbr:"Tal",name:"Talose",color:Lt.LightBlue,type:0},{abbr:"Ido",name:"Idose",color:Lt.Brown,type:0},{abbr:"GlcNAc",name:"N-Acetyl Glucosamine",color:Lt.Blue,type:1},{abbr:"ManNAc",name:"N-Acetyl Mannosamine",color:Lt.Green,type:1},{abbr:"GalNAc",name:"N-Acetyl Galactosamine",color:Lt.Yellow,type:1},{abbr:"GulNAc",name:"N-Acetyl Gulosamine",color:Lt.Orange,type:1},{abbr:"AltNAc",name:"N-Acetyl Altrosamine",color:Lt.Pink,type:1},{abbr:"AllNAc",name:"N-Acetyl Allosamine",color:Lt.Purple,type:1},{abbr:"TalNAc",name:"N-Acetyl Talosamine",color:Lt.LightBlue,type:1},{abbr:"IdoNAc",name:"N-Acetyl Idosamine",color:Lt.Brown,type:1},{abbr:"GlcN",name:"Glucosamine",color:Lt.Blue,type:2},{abbr:"ManN",name:"Mannosamine",color:Lt.Green,type:2},{abbr:"GalN",name:"Galactosamine",color:Lt.Yellow,type:2},{abbr:"GulN",name:"Gulosamine",color:Lt.Orange,type:2},{abbr:"AltN",name:"Altrosamine",color:Lt.Pink,type:2},{abbr:"AllN",name:"Allosamine",color:Lt.Purple,type:2},{abbr:"TalN",name:"Talosamine",color:Lt.LightBlue,type:2},{abbr:"IdoN",name:"Idosamine",color:Lt.Brown,type:2},{abbr:"GlcA",name:"Glucuronic Acid",color:Lt.Blue,type:3},{abbr:"ManA",name:"Mannuronic Acid",color:Lt.Green,type:3},{abbr:"GalA",name:"Galacturonic Acid",color:Lt.Yellow,type:3},{abbr:"GulA",name:"Guluronic Acid",color:Lt.Orange,type:3},{abbr:"AltA",name:"Altruronic Acid",color:Lt.Pink,type:3},{abbr:"AllA",name:"Alluronic Acid",color:Lt.Purple,type:3},{abbr:"TalA",name:"Taluronic Acid",color:Lt.LightBlue,type:3},{abbr:"IdoA",name:"Iduronic Acid",color:Lt.Brown,type:3},{abbr:"Qui",name:"Quinovose",color:Lt.Blue,type:4},{abbr:"Rha",name:"Rhamnose",color:Lt.Green,type:4},{abbr:"6dGul",name:"6-Deoxy Gulose",color:Lt.Orange,type:4},{abbr:"6dAlt",name:"6-Deoxy Altrose",color:Lt.Pink,type:4},{abbr:"6dTal",name:"6-Deoxy Talose",color:Lt.LightBlue,type:4},{abbr:"Fuc",name:"Fucose",color:Lt.Red,type:4},{abbr:"QuiNAc",name:"N-Acetyl Quinovosamine",color:Lt.Blue,type:5},{abbr:"RhaNAc",name:"N-Acetyl Rhamnosamine",color:Lt.Green,type:5},{abbr:"6dAltNAc",name:"N-Acetyl 6-Deoxy Altrosamine",color:Lt.Pink,type:5},{abbr:"6dTalNAc",name:"N-Acetyl 6-Deoxy Talosamine",color:Lt.LightBlue,type:5},{abbr:"FucNAc",name:"N-Acetyl Fucosamine",color:Lt.Red,type:5},{abbr:"Oli",name:"Olivose",color:Lt.Blue,type:6},{abbr:"Tyv",name:"Tyvelose",color:Lt.Green,type:6},{abbr:"Abe",name:"Abequose",color:Lt.Orange,type:6},{abbr:"Par",name:"Paratose",color:Lt.Pink,type:6},{abbr:"Dig",name:"Digitoxose",color:Lt.Purple,type:6},{abbr:"Col",name:"Colitose",color:Lt.LightBlue,type:6},{abbr:"Ara",name:"Arabinose",color:Lt.Green,type:7},{abbr:"Lyx",name:"Lyxose",color:Lt.Yellow,type:7},{abbr:"Xyl",name:"Xylose",color:Lt.Orange,type:7},{abbr:"Rib",name:"Ribose",color:Lt.Pink,type:7},{abbr:"Kdn",name:"Keto-Deoxy Nonulonic Acid",color:Lt.Green,type:8},{abbr:"Neu5Ac",name:"N-Acetyl Neuraminic Acid",color:Lt.Purple,type:8},{abbr:"Neu5Gc",name:"N-Glycolyl Neuraminic Acid",color:Lt.LightBlue,type:8},{abbr:"Neu",name:"Neuraminic Acid",color:Lt.Brown,type:8},{abbr:"Sia",name:"Sialic acid",color:Lt.Red,type:8},{abbr:"Pse",name:"Pseudaminic Acid",color:Lt.Green,type:9},{abbr:"Leg",name:"Legionaminic Acid",color:Lt.Yellow,type:9},{abbr:"Aci",name:"Acinetaminic Acid",color:Lt.Pink,type:9},{abbr:"4eLeg",name:"4-Epilegionaminic Acid",color:Lt.LightBlue,type:9},{abbr:"Bac",name:"Bacillosamine",color:Lt.Blue,type:10},{abbr:"LDmanHep",name:"L-Glycero-D-Manno Heptose",color:Lt.Green,type:10},{abbr:"Kdo",name:"Keto-Deoxy Octulonic Acid",color:Lt.Yellow,type:10},{abbr:"Dha",name:"3-Deoxy Lyxo-Heptulosaric Acid",color:Lt.Orange,type:10},{abbr:"DDmanHep",name:"D-Glycero-D-Manno-Heptose",color:Lt.Pink,type:10},{abbr:"MurNAc",name:"N-Acetyl Muramic Acid",color:Lt.Purple,type:10},{abbr:"MurNGc",name:"N-Glycolyl Muramic Acid",color:Lt.LightBlue,type:10},{abbr:"Mur",name:"Muramic Acid",color:Lt.Brown,type:10},{abbr:"Api",name:"Apicose",color:Lt.Green,type:11},{abbr:"Fru",name:"Fructose",color:Lt.Green,type:11},{abbr:"Tag",name:"Tagatose",color:Lt.Yellow,type:11},{abbr:"Sor",name:"Sorbose",color:Lt.Orange,type:11},{abbr:"Psi",name:"Psicose",color:Lt.Pink,type:11}],bTe=function(){for(var e=new Map,t=0,r=VC.length;t<r;++t){var n=VC[t];e.set(n.abbr,n)}return e}(),xTe=[["Glc-family",Lt.Blue],["Man-family",Lt.Green],["Gal-family",Lt.Yellow],["Gul-family",Lt.Orange],["Alt-family",Lt.Pink],["All-family",Lt.Purple],["Tal-family",Lt.LightBlue],["Ido-family",Lt.Brown],["Fuc-family",Lt.Red],["Generic/Unknown/Secondary",Lt.Secondary]],STe={Glc:["GLC","BGC","Z8T","TRE","MLR"],Man:["MAN","BMA"],Gal:["GLA","GAL","GZL","GXL","GIV"],Gul:["4GL","GL0","GUP","Z8H"],Alt:["Z6H","3MK","SHD"],All:["AFD","ALL","WOO","Z2D"],Tal:["ZEE","A5C","SDY"],Ido:["ZCD","Z0F","4N2"],GlcNAc:["NDG","NAG","NGZ"],ManNAc:["BM3","BM7"],GalNAc:["A2G","NGA","YYQ"],GulNAc:["LXB"],AltNAc:[],AllNAc:["NAA"],TalNAc:[],IdoNAc:["LXZ","HSQ"],GlcN:["PA1","GCS"],ManN:["95Z"],GalN:["X6X","1GN"],GulN:[],AltN:[],AllN:[],TalN:[],IdoN:[],GlcA:["GCU","BDP"],ManA:["MAV","BEM"],GalA:["ADA","GTR","GTK"],GulA:["LGU"],AltA:[],AllA:[],TalA:["X1X","X0X"],IdoA:["IDR"],Qui:["G6D","YYK"],Rha:["RAM","RM4","XXR"],"6dGul":["66O"],"6dAlt":[],"6dTal":[],Fuc:["FUC","FUL","FCA","FCB","GYE"],QuiNAc:["Z9W"],RhaNAc:[],"6dAltNAc":[],"6dTalNAc":[],FucNAc:["49T"],Oli:["DDA","RAE","Z5J"],Tyv:["TYV"],Abe:["ABE"],Par:["PZU"],Dig:["Z3U"],Col:[],Ara:["64K","ARA","ARB","AHR","FUB","BXY","BXX","SEJ"],Lyx:["LDY","Z4W"],Xyl:["XYS","XYP","XYZ","HSY","LXC"],Rib:["YYM","RIP","RIB","BDR","0MK","Z6J","32O"],Kdn:["KDM","KDN"],Neu5Ac:["SIA","SLB"],Neu5Gc:["NGC","NGE"],Neu:[],Sia:[],Pse:[],Leg:[],Aci:[],"4eLeg":[],Bac:[],LDmanHep:["GMH"],Kdo:["KDO"],Dha:[],DDmanHep:["289"],MurNAc:["MUB","AMU"],MurNGc:[],Mur:["1S4","MUR"],Api:["XXM"],Fru:["BDF","Z9N","FRU","LFR"],Tag:["T6T"],Sor:["SOE","UEA"],Psi:["PSV","SF6","SF9","TTV"]},NL=["NGZ","LAT","PUF","GDA","9WJ"],qh=function(){for(var e=new Map,t=0,r=VC.length;t<r;++t){var n=VC[t],a=STe[n.abbr];if(a)for(var i=0,o=a.length;i<o;++i)e.set(a[i],n)}for(var t=0,r=NL.length;t<r;++t)e.set(NL[t],pX);return e}(),Aa;(function(e){function t(p){return HD(p.values())}e.toArray=t;function r(p,h){var m=!0;return h.forEach(function(v){p.has(v)||(m=!1)}),m}e.isSuperset=r;function n(p){for(var h=[],m=1;m<arguments.length;m++)h[m-1]=arguments[m];for(var v=0;v<h.length;v++)h[v].forEach(function(g){return p.add(g)});return p}e.add=n;function a(p,h){var m=new Set(p);return h.forEach(function(v){return m.add(v)}),m}e.union=a;function i(){for(var p=[],h=0;h<arguments.length;h++)p[h]=arguments[h];if(p.length===0)return new Set;for(var m=new Set(p[0]),v=1,g=p.length;v<g;v++)p[v].forEach(function(y){return m.add(y)});return m}e.unionMany=i;function o(p){if(p.length===0)return new Set;for(var h=new Set(p[0]),m=1;m<p.length;m++)for(var v=0,g=p[m];v<g.length;v++){var y=g[v];h.add(y)}return h}e.unionManyArrays=o;function s(p,h){var m=new Set;return h.forEach(function(v){p.has(v)&&m.add(v)}),m}e.intersection=s;function u(p,h){var m=!1;return h.forEach(function(v){p.has(v)&&(m=!0)}),m}e.areIntersecting=u;function l(p,h){var m=0;return h.forEach(function(v){p.has(v)&&(m+=1)}),m}e.intersectionSize=l;function c(p,h){var m=new Set(p);return h.forEach(function(v){return m.delete(v)}),m}e.difference=c;function d(p,h){var m=p.size;return p.forEach(function(v){h.has(v)&&(m-=1)}),m}e.differenceSize=d;function f(p,h){if(p.size!==h.size)return!1;var m=!0;return h.forEach(function(v){p.has(v)||(m=!1)}),m}e.areEqual=f})(Aa||(Aa={}));var hX=new Set(["DAPC","DBPC","DFPC","DGPC","DIPC","DLPC","DNPC","DOPC","DPPC","DRPC","DTPC","DVPC","DXPC","DYPC","LPPC","PAPC","PEPC","PGPC","PIPC","POPC","PRPC","PUPC","DAPE","DBPE","DFPE","DGPE","DIPE","DLPE","DNPE","DOPE","DPPE","DRPE","DTPE","DUPE","DVPE","DXPE","DYPE","LPPE","PAPE","PGPE","PIPE","POPE","PQPE","PRPE","PUPE","DAPS","DBPS","DFPS","DGPS","DIPS","DLPS","DNPS","DOPS","DPPS","DRPS","DTPS","DUPS","DVPS","DXPS","DYPS","LPPS","PAPS","PGPS","PIPS","POPS","PQPS","PRPS","PUPS","DAPG","DBPG","DFPG","DGPG","DIPG","DLPG","DNPG","DOPG","DPPG","DRPG","DTPG","DVPG","DXPG","DYPG","LPPG","PAPG","PGPG","PIPG","POPG","PRPG","DAPA","DBPA","DFPA","DGPA","DIPA","DLPA","DNPA","DOPA","DPPA","DRPA","DTPA","DVPA","DXPA","DYPA","LPPA","PAPA","PGPA","PIPA","POPA","PRPA","PUPA","DPP","DPPI","PAPI","PIPI","POP","POPI","PUPI","PVP","PVPI","PADG","PIDG","PODG","PUDG","PVDG","APC","CPC","IPC","LPC","OPC","PPC","TPC","UPC","VPC","BNSM","DBSM","DPSM","DXSM","PGSM","PNSM","POSM","PVSM","XNSM","DPCE","DXCE","PNCE","XNCE","DMPC"]),mX=new Set(["118","119","543","1AL","1CU","2FK","2HP","2OF","3CO","3MT","3NI","3OF","3P8","4MO","4PU","4TI","6MO","ACT","AG","AL","ALF","AM","ATH","AU","AU3","AUC","AZI","BA","BCT","BEF","BF4","BO4","BR","BS3","BSY","CA","CAC","CD","CD1","CD3","CD5","CE","CF","CHT","CL","CO","CO3","CO5","CON","CR","CS","CSB","CU","CU1","CU3","CUA","CUZ","CYN","DME","DMI","DSC","DTI","DY","E4N","EDR","EMC","ER3","EU","EU3","F","FE","FE2","FPO","GA","GD3","GEP","HAI","HG","HGC","IN","IOD","IR","IR3","IRI","IUM","K","KO4","LA","LCO","LCP","LI","LU","MAC","MG","MH2","MH3","MLI","MMC","MN","MN3","MN5","MN6","MO1","MO2","MO3","MO4","MO5","MO6","MOO","MOS","MOW","MW1","MW2","MW3","NA","NA2","NA5","NA6","NAO","NAW","NET","NH4","NI","NI1","NI2","NI3","NO2","NO3","NRU","O4M","OAA","OC1","OC2","OC3","OC4","OC5","OC6","OC7","OC8","OCL","OCM","OCN","OCO","OF1","OF2","OF3","OH","OS","OS4","OXL","PB","PBM","PD","PDV","PER","PI","PO3","PO4","PR","PT","PT4","PTN","RB","RH3","RHD","RU","SB","SCN","SE4","SEK","SM","SMO","SO3","SO4","SR","T1A","TB","TBA","TCN","TEA","TH","THE","TL","TMA","TRA","UNX","V","VN3","VO4","W","WO5","Y1","YB","YB2","YH","YT3","ZCM","ZN","ZN2","ZN3","ZNO","ZO3","ZR","NCO","OHX"]),Ic,CTe=function(){for(var e=Object.create(null),t=[],r="A".charCodeAt(0);r<="Z".charCodeAt(0);r++)t[t.length]=String.fromCharCode(r);for(var r="a".charCodeAt(0);r<="z".charCodeAt(0);r++)t[t.length]=String.fromCharCode(r);for(var r="0".charCodeAt(0);r<="9".charCodeAt(0);r++)t[t.length]=String.fromCharCode(r);for(var n=0,a=t;n<a.length;n++){var i=a[n];e[i]=i.toUpperCase();for(var o=0,s=t;o<s.length;o++){var u=s[o];e[i+u]=(i+u).toUpperCase();for(var l=0,c=t;l<c.length;l++){var d=c[l];e[i+u+d]=(i+u+d).toUpperCase()}}}return e}();function V0(e){return CTe[e]||e.toUpperCase()}var zL=new Map([[1,"H"],[2,"He"],[3,"Li"],[4,"Be"],[5,"B"],[6,"C"],[7,"N"],[8,"O"],[9,"F"],[10,"Ne"],[11,"Na"],[12,"Mg"],[13,"Al"],[14,"Si"],[15,"P"],[16,"S"],[17,"Cl"],[18,"Ar"],[19,"K"],[20,"Ca"],[21,"Sc"],[22,"Ti"],[23,"V"],[24,"Cr"],[25,"Mn"],[26,"Fe"],[27,"Co"],[28,"Ni"],[29,"Cu"],[30,"Zn"],[31,"Ga"],[32,"Ge"],[33,"As"],[34,"Se"],[35,"Br"],[36,"Kr"],[37,"Rb"],[38,"Sr"],[39,"Y"],[40,"Zr"],[41,"Nb"],[42,"Mo"],[43,"Tc"],[44,"Ru"],[45,"Rh"],[46,"Pd"],[47,"Ag"],[48,"Cd"],[49,"In"],[50,"Sn"],[51,"Sb"],[52,"Te"],[53,"I"],[54,"Xe"],[55,"Cs"],[56,"Ba"],[57,"La"],[58,"Ce"],[59,"Pr"],[60,"Nd"],[61,"Pm"],[62,"Sm"],[63,"Eu"],[64,"Gd"],[65,"Tb"],[66,"Dy"],[67,"Ho"],[68,"Er"],[69,"Tm"],[70,"Yb"],[71,"Lu"],[72,"Hf"],[73,"Ta"],[74,"W"],[75,"Re"],[76,"Os"],[77,"Ir"],[78,"Pt"],[79,"Au"],[80,"Hg"],[81,"Tl"],[82,"Pb"],[83,"Bi"],[84,"Po"],[85,"At"],[86,"Rn"],[87,"Fr"],[88,"Ra"],[89,"Ac"],[90,"Th"],[91,"Pa"],[92,"U"],[93,"Np"],[94,"Pu"],[95,"Am"],[96,"Cm"],[97,"Bk"],[98,"Cf"],[99,"Es"],[100,"Fm"],[101,"Md"],[102,"No"],[103,"Lr"],[104,"Rf"],[105,"Db"],[106,"Sg"],[107,"Bh"],[108,"Hs"],[109,"Mt"],[110,"Ds"],[111,"Rg"],[112,"Cn"],[113,"Uut"],[114,"Fl"],[115,"Uup"],[116,"Lv"],[117,"Uus"],[118,"Uuo"]].map(function(e){return[e[0],V0(e[1])]}));function wTe(e){return zL.has(e)?zL.get(e):V0("H")}var _Te=(Ic={},Ic[0]={trace:new Set,directionFrom:new Set,directionTo:new Set,backboneStart:new Set,backboneEnd:new Set,coarseBackbone:new Set},Ic[1]={trace:new Set(["CA"]),directionFrom:new Set(["C"]),directionTo:new Set(["O","OC1","O1","OX1","OXT"]),backboneStart:new Set(["N"]),backboneEnd:new Set(["C"]),coarseBackbone:new Set(["CA","BB","CA1"])},Ic[2]={trace:new Set(["CA"]),directionFrom:new Set(["C"]),directionTo:new Set(["O"]),backboneStart:new Set(["N"]),backboneEnd:new Set(["CD"]),coarseBackbone:new Set(["CA"])},Ic[3]={trace:new Set(["CA"]),directionFrom:new Set(["C"]),directionTo:new Set(["O"]),backboneStart:new Set(["N"]),backboneEnd:new Set(["CG"]),coarseBackbone:new Set(["CA"])},Ic[4]={trace:new Set(["O3'","O3*"]),directionFrom:new Set(["C4'","C4*"]),directionTo:new Set(["C3'","C3*"]),backboneStart:new Set(["P"]),backboneEnd:new Set(["O3'","O3*"]),coarseBackbone:new Set(["P"])},Ic[5]={trace:new Set(["O3'","O3*"]),directionFrom:new Set(["C3'","C3*"]),directionTo:new Set(["C1'","C1*"]),backboneStart:new Set(["P"]),backboneEnd:new Set(["O3'","O3*"]),coarseBackbone:new Set(["P"])},Ic[6]={trace:new Set(["N4'","N4*"]),directionFrom:new Set(["N4'","N4*"]),directionTo:new Set(["C7'","C7*"]),backboneStart:new Set(["N1'","N1*"]),backboneEnd:new Set(["C'","C*"]),coarseBackbone:new Set(["P"])},Ic),bd=new Set(["CA","C","N","O","O1","O2","OC1","OC2","OT1","OT2","OX1","OXT","H","H1","H2","H3","HA","HN","HXT","BB"]),Zw=new Set(["P","OP1","OP2","HOP2","HOP3","O2'","O3'","O4'","O5'","C1'","C2'","C3'","C4'","C5'","H1'","H2'","H2''","HO2'","H3'","H4'","H5'","H5''","HO3'","HO5'","O2*","O3*","O4*","O5*","C1*","C2*","C3*","C4*","C5*"]),vX=new Set(["D-PEPTIDE LINKING","D-PEPTIDE NH3 AMINO TERMINUS","D-PEPTIDE COOH CARBOXY TERMINUS","D-GAMMA-PEPTIDE, C-DELTA LINKING","D-BETA-PEPTIDE, C-GAMMA LINKING"]),gX=new Set(["L-PEPTIDE LINKING","L-PEPTIDE NH3 AMINO TERMINUS","L-PEPTIDE COOH CARBOXY TERMINUS","L-GAMMA-PEPTIDE, C-DELTA LINKING","L-BETA-PEPTIDE, C-GAMMA LINKING"]),ATe=new Set(["D-GAMMA-PEPTIDE, C-DELTA LINKING","L-GAMMA-PEPTIDE, C-DELTA LINKING"]),TTe=new Set(["D-BETA-PEPTIDE, C-GAMMA LINKING","L-BETA-PEPTIDE, C-GAMMA LINKING"]),ETe=new Set(["D-PEPTIDE NH3 AMINO TERMINUS","D-PEPTIDE COOH CARBOXY TERMINUS","L-PEPTIDE NH3 AMINO TERMINUS","L-PEPTIDE COOH CARBOXY TERMINUS"]),yX=new Set(["PEPTIDE LINKING","PEPTIDE-LIKE"]),PTe=Aa.unionMany(vX,gX,yX),bX=new Set(["DNA LINKING","L-DNA LINKING","DNA OH 5 PRIME TERMINUS","DNA OH 3 PRIME TERMINUS"]),xX=new Set(["RNA LINKING","L-RNA LINKING","RNA OH 5 PRIME TERMINUS","RNA OH 3 PRIME TERMINUS"]),SX=new Set(["D-SACCHARIDE, BETA LINKING","L-SACCHARIDE, BETA LINKING","D-SACCHARIDE, ALPHA LINKING","L-SACCHARIDE, ALPHA LINKING","L-SACCHARIDE","D-SACCHARIDE","SACCHARIDE","D-SACCHARIDE 1,4 AND 1,4 LINKING","L-SACCHARIDE 1,4 AND 1,4 LINKING","D-SACCHARIDE 1,4 AND 1,6 LINKING","L-SACCHARIDE 1,4 AND 1,6 LINKING"]),ITe=new Set(["NON-POLYMER","OTHER"]),MTe=new Set(["ION"]),DTe=new Set(["LIPID"]),Jw=new Set(["SOL","WAT","HOH","H2O","W","DOD","D3O","TIP","TIP3","TIP4","SPC"]),_k=new Set(["HIS","ARG","LYS","ILE","PHE","LEU","TRP","ALA","MET","PRO","CYS","ASN","VAL","GLY","SER","GLN","TYR","ASP","GLU","THR","SEC","PYL","UNK","MSE","SEP","TPO","PTR","PCA"]),CX=new Set(["DAL","DAR","DSG","DAS","DCY","DGL","DGN","DHI","DIL","DLE","DLY","MED","DPN","DPR","DSN","DTH","DTR","DTY","DVA","DNE"]),e_=Aa.unionMany(_k,CX),t_=new Set(["A","C","T","G","I","U","N"]),r_=new Set(["DA","DC","DT","DG","DI","DU","DN"]),Ak=new Set(["APN","CPN","TPN","GPN"]),kTe=new Set(["A","G","I","DA","DG","DI","APN","GPN"]),RTe=new Set(["C","T","U","DC","DT","DU","CPN","TPN"]),n_=Aa.unionMany(t_,r_,Ak),wX=function(e){return kTe.has(e.toUpperCase())},_X=function(e){return RTe.has(e.toUpperCase())},gb=Aa.unionMany(e_,n_);function H0(e,t){return e=e.toUpperCase(),t=t.toUpperCase(),Ak.has(t)?8:PTe.has(e)?5:xX.has(e)?6:bX.has(e)?7:SX.has(e)?9:Jw.has(t)?2:mX.has(t)?3:hX.has(t)?4:ITe.has(e)?qh.has(t)?9:1:0}function OTe(e,t){return e=e.toUpperCase(),t===5?ATe.has(e)?2:TTe.has(e)?3:ETe.has(e)?0:1:t===6?4:t===7?5:t===8?6:0}function AX(e){return e=e.toUpperCase(),e_.has(e)?"peptide linking":t_.has(e)?"RNA linking":r_.has(e)?"DNA linking":qh.has(e)?"saccharide":"other"}function BTe(e){return{formula:"",formula_weight:0,id:e,name:e,mon_nstd_flag:gb.has(e)?"y":"n",pdbx_synonyms:[],type:AX(e)}}function FTe(e){return e=e.toUpperCase(),Jw.has(e)?"water":gb.has(e)?"polymer":qh.has(e)?"branched":"non-polymer"}function LTe(e,t){return e=e.toUpperCase(),t=t.toUpperCase(),gX.has(t)?"polypeptide(L)":vX.has(t)?"polypeptide(D)":xX.has(t)?"polyribonucleotide":bX.has(t)?"polydeoxyribonucleotide":SX.has(t)||qh.has(e)?"oligosaccharide":Ak.has(e)?"peptide nucleic acid":_k.has(e)?"polypeptide(L)":CX.has(e)?"polypeptide(D)":t_.has(e)?"polyribonucleotide":r_.has(e)?"polydeoxyribonucleotide":MTe.has(t)||mX.has(e)?"ion":DTe.has(t)||hX.has(e)?"lipid":yX.has(t)?"peptide-like":"other"}function Tk(e){return kp(e)||TX(e)}function kp(e){return e===7||e===6||e===8}function TX(e){return e===5}var jr;(function(e){e.is=Oi.has,e.create=Oi.create,e.SecondaryStructureMmcif={HELX_LH_27_P:1058,HELX_LH_3T_P:2082,HELX_LH_AL_P:4130,HELX_LH_A_N:524321,HELX_LH_B_N:1048609,HELX_LH_GA_P:8226,HELX_LH_N:33,HELX_LH_OM_P:16418,HELX_LH_OT_N:131105,HELX_LH_OT_P:546,HELX_LH_P:34,HELX_LH_PI_P:32802,HELX_LH_PP_P:65570,HELX_LH_Z_N:262177,HELX_N:1,HELX_OT_N:1,HELX_OT_P:2,HELX_P:2,HELX_RH_27_P:1090,HELX_RH_3T_P:2114,HELX_RH_AL_P:4162,HELX_RH_A_N:524353,HELX_RH_B_N:1048641,HELX_RH_GA_P:8258,HELX_RH_N:65,HELX_RH_OM_P:16450,HELX_RH_OT_N:131137,HELX_RH_OT_P:578,HELX_RH_P:66,HELX_RH_PI_P:32834,HELX_RH_PP_P:65602,HELX_RH_Z_N:262209,STRN:4194308,TURN_OT_P:33554448,TURN_P:16,TURN_TY1P_P:67109136,TURN_TY1_P:67109008,TURN_TY2P_P:134218e3,TURN_TY2_P:134217872,TURN_TY3P_P:268435728,TURN_TY3_P:268435600},e.SecondaryStructurePdb={1:4162,2:16450,3:32834,4:8258,5:2114,6:4130,7:16418,8:8226,9:1026,10:65538},e.SecondaryStructureStride={H:4098,G:2050,I:32770,E:8388612,B:4194308,T:16,C:536870912},e.SecondaryStructureDssp={H:4098,B:4194308,E:8388612,G:2050,I:32770,T:16,S:8}})(jr||(jr={}));var $r;(function(e){e.is=Oi.has;function t(s){return Oi.create(s)}e.create=t;function r(s){return(s&1)!==0}e.isCovalent=r;function n(s){return s===Math.pow(2,6)-1}e.isAll=n,e.Names={covalent:1,"metal-coordination":2,"hydrogen-bond":4,disulfide:4,aromatic:4,computed:4};function a(s){return s in e.Names}e.isName=a;function i(s){switch(s){case"covalent":return 1;case"metal-coordination":return 2;case"hydrogen-bond":return 4;case"disulfide":return 8;case"aromatic":return 16;case"computed":return 32}}e.fromName=i;function o(s){for(var u=0,l=0,c=s.length;l<c;++l)u|=i(s[l]);return u}e.fromNames=o})($r||($r={}));var p5={ALA:[.17,.5,.33],ARG:[.81,1.81,1],ASN:[.42,.85,.43],ASP:[1.23,3.64,2.41],ASH:[-.07,.43,.5],CYS:[-.24,-.02,.22],GLN:[.58,.77,.19],GLU:[2.02,3.63,1.61],GLH:[-.01,.11,.12],GLY:[.01,1.15,1.14],HIS:[.17,.11,-.06],ILE:[-.31,-1.12,-.81],LEU:[-.56,-1.25,-.69],LYS:[.99,2.8,1.81],MET:[-.23,-.67,-.44],PHE:[-1.13,-1.71,-.58],PRO:[.45,.14,-.31],SER:[.13,.46,.33],THR:[.14,.25,.11],TRP:[-1.85,-2.09,-.24],TYR:[-.94,-.71,.23],VAL:[.07,-.46,-.53]};Cr.atom_site.label_comp_id,Cr.atom_site.label_seq_id,Cr.atom_site.pdbx_PDB_ins_code,Cr.atom_site.label_asym_id,Cr.atom_site.label_entity_id,Cr.atom_site.auth_atom_id,Cr.atom_site.auth_seq_id,Cr.atom_site.auth_asym_id;T(T({},Cr.chem_comp_bond),{molstar_protonation_variant:ye.Schema.Str()});var NTe=T(T({},Cr.chem_comp),{type:ye.Schema.Aliased(ye.Schema.str)}),vo={entry:Cr.entry,struct:Cr.struct,struct_asym:Cr.struct_asym,ihm_model_list:Cr.ihm_model_list,ihm_model_group:Cr.ihm_model_group,ihm_model_group_link:Cr.ihm_model_group_link,entity:Cr.entity,entity_poly:Cr.entity_poly,entity_poly_seq:Cr.entity_poly_seq,pdbx_entity_branch:Cr.pdbx_entity_branch,chem_comp:NTe,pdbx_chem_comp_identifier:Cr.pdbx_chem_comp_identifier,atom_site:Cr.atom_site,ihm_sphere_obj_site:Cr.ihm_sphere_obj_site,ihm_gaussian_obj_site:Cr.ihm_gaussian_obj_site,pdbx_unobs_or_zero_occ_residues:Cr.pdbx_unobs_or_zero_occ_residues,pdbx_molecule:Cr.pdbx_molecule};function Em(e){for(var t=Object.create(null),r=0,n=Object.keys(vo);r<n.length;r++){var a=n[r];a in e?t[a]=e[a]:t[a]=nn.ofUndefinedColumns(vo[a],0)}return t}var zTe=[new Set(["CA"]),new Set(["C"]),new Set(["N"])],UTe=[new Set(["P","O3'","O3*"]),new Set(["C4'","C4*"]),new Set(["O2'","O2*","F2'","F2*"])],VTe=[new Set(["P","O3'","O3*"]),new Set(["C3'","C3*"]),new Set(["O2'","O2*","F2'","F2*"])],UL=function(){var e=new Map,t=[{id:"HIS",name:"HISTIDINE",type:"L-peptide linking"},{id:"ARG",name:"ARGININE",type:"L-peptide linking"},{id:"LYS",name:"LYSINE",type:"L-peptide linking"},{id:"ILE",name:"ISOLEUCINE",type:"L-peptide linking"},{id:"PHE",name:"PHENYLALANINE",type:"L-peptide linking"},{id:"LEU",name:"LEUCINE",type:"L-peptide linking"},{id:"TRP",name:"TRYPTOPHAN",type:"L-peptide linking"},{id:"ALA",name:"ALANINE",type:"L-peptide linking"},{id:"MET",name:"METHIONINE",type:"L-peptide linking"},{id:"CYS",name:"CYSTEINE",type:"L-peptide linking"},{id:"ASN",name:"ASPARAGINE",type:"L-peptide linking"},{id:"VAL",name:"VALINE",type:"L-peptide linking"},{id:"GLY",name:"GLYCINE",type:"peptide linking"},{id:"SER",name:"SERINE",type:"L-peptide linking"},{id:"GLN",name:"GLUTAMINE",type:"L-peptide linking"},{id:"TYR",name:"TYROSINE",type:"L-peptide linking"},{id:"ASP",name:"ASPARTIC ACID",type:"L-peptide linking"},{id:"GLU",name:"GLUTAMIC ACID",type:"L-peptide linking"},{id:"THR",name:"THREONINE",type:"L-peptide linking"},{id:"PRO",name:"PROLINE",type:"L-peptide linking"},{id:"SEC",name:"SELENOCYSTEINE",type:"L-peptide linking"},{id:"PYL",name:"PYRROLYSINE",type:"L-peptide linking"},{id:"MSE",name:"SELENOMETHIONINE",type:"L-peptide linking"},{id:"SEP",name:"PHOSPHOSERINE",type:"L-peptide linking"},{id:"TPO",name:"PHOSPHOTHREONINE",type:"L-peptide linking"},{id:"PTR",name:"O-PHOSPHOTYROSINE",type:"L-peptide linking"},{id:"PCA",name:"PYROGLUTAMIC ACID",type:"L-peptide linking"},{id:"A",name:"ADENOSINE-5'-MONOPHOSPHATE",type:"RNA linking"},{id:"C",name:"CYTIDINE-5'-MONOPHOSPHATE",type:"RNA linking"},{id:"T",name:"THYMIDINE-5'-MONOPHOSPHATE",type:"RNA linking"},{id:"G",name:"GUANOSINE-5'-MONOPHOSPHATE",type:"RNA linking"},{id:"I",name:"INOSINIC ACID",type:"RNA linking"},{id:"U",name:"URIDINE-5'-MONOPHOSPHATE",type:"RNA linking"},{id:"DA",name:"2'-DEOXYADENOSINE-5'-MONOPHOSPHATE",type:"DNA linking"},{id:"DC",name:"2'-DEOXYCYTIDINE-5'-MONOPHOSPHATE",type:"DNA linking"},{id:"DT",name:"THYMIDINE-5'-MONOPHOSPHATE",type:"DNA linking"},{id:"DG",name:"2'-DEOXYGUANOSINE-5'-MONOPHOSPHATE",type:"DNA linking"},{id:"DI",name:"2'-DEOXYINOSINE-5'-MONOPHOSPHATE",type:"DNA linking"},{id:"DU",name:"2'-DEOXYURIDINE-5'-MONOPHOSPHATE",type:"DNA linking"}];return t.forEach(function(r){return e.set(r.id,r)}),e}(),VL=function(){var e=new Map,t=[{id:"ZN2",name:"ZINC ION",type:"Ion"},{id:"SOD",name:"SODIUM ION",type:"Ion"},{id:"CES",name:"CESIUM ION",type:"Ion"},{id:"CLA",name:"CHLORIDE ION",type:"Ion"},{id:"CAL",name:"CALCIUM ION",type:"Ion"},{id:"POT",name:"POTASSIUM ION",type:"Ion"}];return t.forEach(function(r){return e.set(r.id,r)}),e}(),Rp=function(){function e(t,r){this.seqId=t,this.atomId=r,this.namesMap=new Map,this.comps=new Map,this.ids=[],this.names=[],this.types=[],this.mon_nstd_flags=[]}return e.prototype.set=function(t){this.comps.set(t.id,t),this.ids.push(t.id),this.names.push(t.name),this.types.push(t.type),this.mon_nstd_flags.push(gb.has(t.id)?"y":"n")},e.prototype.getAtomIds=function(t){for(var r=new Set,n=this.seqId.value(t);t<this.seqId.rowCount;){var a=this.seqId.value(t);if(a!==n)break;r.add(this.atomId.value(t)),t+=1}return r},e.prototype.hasAtomIds=function(t,r){for(var n=0,a=r.length;n<a;++n)if(!Aa.areIntersecting(t,r[n]))return!1;return!0},e.prototype.getType=function(t){return this.hasAtomIds(t,zTe)?"peptide linking":this.hasAtomIds(t,UTe)?"RNA linking":this.hasAtomIds(t,VTe)?"DNA linking":"other"},e.prototype.has=function(t){return this.comps.has(t)},e.prototype.get=function(t){return this.comps.get(t)},e.prototype.add=function(t,r){if(!this.has(t))if(UL.has(t))this.set(UL.get(t));else if(Jw.has(t))this.set({id:t,name:"WATER",type:"non-polymer"});else{var n=this.getAtomIds(r);if(VL.has(t)&&n.size===1)this.set(VL.get(t));else{var a=this.getType(n);this.set({id:t,name:this.namesMap.get(t)||t,type:a})}}return this.get(t)},e.prototype.getChemCompTable=function(){return nn.ofPartialColumns(vo.chem_comp,{id:ye.ofStringArray(this.ids),name:ye.ofStringArray(this.names),type:ye.ofStringAliasArray(this.types),mon_nstd_flag:ye.ofStringAliasArray(this.mon_nstd_flags)},this.ids.length)},e.prototype.setNames=function(t){var r=this;t.forEach(function(n){return r.namesMap.set(n[0],n[1])})},e}();function Sp(e){var t=void 0,r=void 0;return function(){for(var n=[],a=0;a<arguments.length;a++)n[a]=arguments[a];if(!t||t.length!==n.length)return t=n,r=e.apply(void 0,n),r;for(var i=0,o=n.length;i<o;i++)if(n[i]!==t[i])return t=n,r=e.apply(void 0,n),r;return r}}function a_(e){var t=new Map;return function(r){if(t.has(r))return t.get(r);var n=e(r);return t.set(r,n),n}}var FA="ABCDEFGHIJKLMNOPQRSTUVWXYZ";function HTe(e){for(var t=FA.length,r=e,n=0,a=FA[r%t];r>=t;)r=Math.floor(r/t),a+=FA[r%t],n+=1;return n>=5&&console.warn("getChainId overflow"),a}var h5=a_(HTe),Op=function(){function e(){this.count=0,this.ids=[],this.types=[],this.descriptions=[],this.compoundsMap=new Map,this.namesMap=new Map,this.heteroMap=new Map,this.chainMap=new Map}return e.prototype.set=function(t,r){this.count+=1,this.ids.push(""+this.count),this.types.push(t),this.descriptions.push([r])},e.prototype.getEntityId=function(t,r,n,a){return r===2?(this.waterId===void 0&&(this.set("water",a?.customName||"Water"),this.waterId=""+this.count),this.waterId):Tk(r)?this.compoundsMap.has(n)?this.compoundsMap.get(n):(this.chainMap.has(n)||(this.set("polymer",a?.customName||"Polymer "+(this.chainMap.size+1)),this.chainMap.set(n,""+this.count)),this.chainMap.get(n)):(this.heteroMap.has(t)||(this.set("non-polymer",a?.customName||this.namesMap.get(t)||t),this.heteroMap.set(t,""+this.count)),this.heteroMap.get(t))},e.prototype.getEntityTable=function(){return nn.ofPartialColumns(vo.entity,{id:ye.ofStringArray(this.ids),type:ye.ofStringAliasArray(this.types),pdbx_description:ye.ofStringListArray(this.descriptions)},this.count)},e.prototype.setCompounds=function(t){for(var r=0,n=t.length;r<n;++r){var a=t[r],i=a.chains,o=a.description;this.set("polymer",o);for(var s=0,u=i.length;s<u;++s)this.compoundsMap.set(i[s],""+this.count)}},e.prototype.setNames=function(t){var r=this;t.forEach(function(n){return r.namesMap.set(n[0],n[1])})},e}();function jTe(e,t){var r=[],n=[],a=[];e.x.length&&(r.push.apply(r,ss(e.x)),n.push.apply(n,ss(e.y)),a.push.apply(a,ss(e.z))),t&&(t.spheres.x.length&&(r.push.apply(r,ss(t.spheres.x)),n.push.apply(n,ss(t.spheres.y)),a.push.apply(a,ss(t.spheres.z))),t.gaussians.x.length&&(r.push.apply(r,ss(t.gaussians.x)),n.push.apply(n,ss(t.gaussians.y)),a.push.apply(a,ss(t.gaussians.z))));var i=ss(r),o=i[0],s=i[1],u=ss(n),l=u[0],c=u[1],d=ss(a),f=d[0],p=d[1],h=o+(s-o)/2,m=l+(c-l)/2,v=f+(p-f)/2;return A.create(h,m,v)}function GTe(e){var t=new Set,r=new Set;return e.properties.structAsymMap.forEach(function(n,a){var i=n.auth_id;t.add(i),r.add(a)}),{auth:t.size,label:r.size}}var qo;(function(e){function t(d,f){if(d===f)return!0;if(d.vertexCount!==f.vertexCount||d.edgeCount!==f.edgeCount)return!1;for(var p=d.a,h=d.b,m=d.offset,v=f.a,g=f.b,y=f.offset,b=0,S=d.a.length;b<S;b++)if(p[b]!==v[b])return!1;for(var b=0,S=d.b.length;b<S;b++)if(h[b]!==g[b])return!1;for(var b=0,S=d.offset.length;b<S;b++)if(m[b]!==y[b])return!1;for(var x=0,C=Object.keys(d.edgeProps);x<C.length;x++){var w=C[x],_=d.edgeProps[w],E=f.edgeProps[w];if(!E)return!1;for(var b=0,S=_.length;b<S;b++)if(_[b]!==E[b])return!1}return!0}e.areEqual=t;var r=function(){function d(f,p,h,m,v,g){this.offset=f,this.a=p,this.b=h,this.edgeCount=m,this.props=g,this.vertexCount=f.length-1,this.edgeProps=v||{}}return d.prototype.getEdgeIndex=function(f,p){var h,m;f<p?(h=f,m=p):(h=p,m=f);for(var v=this.offset[h],g=this.offset[h+1];v<g;v++)if(this.b[v]===m)return v;return-1},d.prototype.getDirectedEdgeIndex=function(f,p){for(var h=this.offset[f],m=this.offset[f+1];h<m;h++)if(this.b[h]===p)return h;return-1},d.prototype.getVertexEdgeCount=function(f){return this.offset[f+1]-this.offset[f]},d}();function n(d,f,p,h,m,v){return new r(d,f,p,h,m,v)}e.create=n;var a=function(){function d(f,p,h){this.vertexCount=f,this.xs=p,this.ys=h,this.current=0,this.curA=0,this.curB=0,this.edgeCount=p.length,this.offsets=new Int32Array(this.vertexCount+1),this.bucketFill=new Int32Array(this.vertexCount);for(var m=new Int32Array(this.vertexCount),v=0,g=this.xs.length;v<g;v++)m[this.xs[v]]++;for(var v=0,g=this.ys.length;v<g;v++)m[this.ys[v]]++;for(var y=0,v=0;v<this.vertexCount;v++)this.offsets[v]=y,y+=m[v];this.offsets[this.vertexCount]=y,this.slotCount=y,this.a=new Int32Array(y),this.b=new Int32Array(y)}return d.prototype.createGraph=function(f,p){return n(this.offsets,this.a,this.b,this.edgeCount,f,p)},d.prototype.addNextEdge=function(){var f=this.xs[this.current],p=this.ys[this.current],h=this.offsets[f]+this.bucketFill[f],m=this.offsets[p]+this.bucketFill[p];this.a[h]=f,this.b[h]=p,this.bucketFill[f]++,this.a[m]=p,this.b[m]=f,this.bucketFill[p]++,this.current++,this.curA=h,this.curB=m},d.prototype.addAllEdges=function(){for(var f=0;f<this.edgeCount;f++)this.addNextEdge()},d.prototype.assignProperty=function(f,p){f[this.curA]=p,f[this.curB]=p},d}();e.EdgeBuilder=a;var i=function(){function d(f,p,h){this.vertexCount=f,this.xs=p,this.ys=h,this.current=0,this.curA=0,this.edgeCount=p.length,this.offsets=new Int32Array(this.vertexCount+1),this.bucketFill=new Int32Array(this.vertexCount);for(var m=new Int32Array(this.vertexCount),v=0,g=this.xs.length;v<g;v++)m[this.xs[v]]++;for(var y=0,v=0;v<this.vertexCount;v++)this.offsets[v]=y,y+=m[v];this.offsets[this.vertexCount]=y,this.slotCount=y,this.a=new Int32Array(y),this.b=new Int32Array(y)}return d.prototype.createGraph=function(f){return n(this.offsets,this.a,this.b,this.edgeCount,f)},d.prototype.addNextEdge=function(){var f=this.xs[this.current],p=this.ys[this.current],h=this.offsets[f]+this.bucketFill[f];this.a[h]=f,this.b[h]=p,this.bucketFill[f]++,this.current++,this.curA=h},d.prototype.addAllEdges=function(){for(var f=0;f<this.edgeCount;f++)this.addNextEdge()},d.prototype.assignProperty=function(f,p){f[this.curA]=p},d}();e.DirectedEdgeBuilder=i;var o=function(){function d(f){this.vertexCount=f,this.xs=[],this.ys=[],this.included=new Set}return d.prototype.addEdge=function(f,p){var h=f,m=p;f>p&&(h=p,m=f);var v=op(h,m);return this.included.has(v)?!1:(this.included.add(v),this.xs[this.xs.length]=h,this.ys[this.ys.length]=m,!0)},d.prototype.getGraph=function(){return s(this.vertexCount,this.xs,this.ys)},d.prototype.getEdgeBuiler=function(){return new a(this.vertexCount,this.xs,this.ys)},d}();e.UniqueEdgeBuilder=o;function s(d,f,p){var h=new e.EdgeBuilder(d,f,p);return h.addAllEdges(),h.createGraph({})}e.fromVertexPairs=s;function u(d,f){for(var p=d.b,h=d.offset,m=d.vertexCount,v=d.edgeProps,g=new Int32Array(m),y=0,b=f.length;y<b;y++)g[f[y]]=y+1;for(var S=0,y=0;y<m;y++)if(g[y]!==0)for(var x=h[y],C=h[y+1];x<C;x++)p[x]>y&&g[p[x]]!==0&&S++;for(var w=new Int32Array(f.length+1),_=new Int32Array(2*S),E=new Int32Array(2*S),P=new Int32Array(2*S),D=0,k=0,y=0;y<m;y++)if(g[y]!==0){for(var F=g[y]-1,x=h[y],C=h[y+1];x<C;x++){var X=g[p[x]];X!==0&&(E[D]=F,P[D]=X-1,_[D]=x,D++)}w[++k]=D}for(var U={},j=0,te=Object.keys(v);j<te.length;j++){var q=te[j];U[q]=tye(v[q],_)}return n(w,E,P,S,U)}e.induceByVertices=u;function l(d){var f=d.vertexCount;if(f===0)return{componentCount:0,componentIndex:new Int32Array(0)};if(d.edgeCount===0){for(var p=new Int32Array(f),h=0,m=f;h<m;h++)p[h]=h;return{componentCount:f,componentIndex:p}}for(var v=new Int32Array(f),h=0,m=f;h<m;h++)v[h]=-1;var g=0;v[0]=g;var y=d.offset,b=d.b,S=[0],x=ICe(f);for(x.remove(0);S.length>0;){for(var C=S.pop(),w=v[C],_=y[C],E=y[C+1];_<E;_++){var P=b[_];!x.has(P)||(x.remove(P),S.push(P),v[P]=w)}S.length===0&&x.head>=0&&(S.push(x.head),v[x.head]=++g,x.remove(x.head))}return{componentCount:f,componentIndex:v}}e.connectedComponents=l;function c(d,f,p,h){if(nt.areIntersecting(f,p))return!0;if(h<1)return!1;for(var m=new Set,v=0,g=f.length;v<g;++v)m.add(f[v]);return EX(d,f,p,h,m)}e.areVertexSetsConnected=c})(qo||(qo={}));function EX(e,t,r,n,a){for(var i=e.b,o=e.offset,s=[],u=0,l=t.length;u<l;++u)for(var c=t[u],d=o[c],f=o[c+1];d<f;++d){var p=i[d];if(!a.has(p)){if(nt.has(r,p))return!0;a.add(p),s[s.length]=p}}return n>1?EX(e,s,r,n-1,a):!1}var qTe=function(){function e(){this.map=new Map,this.applicable=new Map}return e.prototype.add=function(t,r,n){this.map.set(t,r),n&&this.applicable.set(t,n)},e.prototype.remove=function(t){this.map.delete(t),this.applicable.delete(t)},e.prototype.get=function(t){return this.map.get(t)},e.prototype.isApplicable=function(t){var r=this.applicable.get(t.sourceData.kind);return r?r(t):!0},e}(),ol;(function(e){function t(r){var n=r.name,a=new qTe;return{descriptor:r,formatRegistry:a,isApplicable:function(i){return a.isApplicable(i)},get:function(i){if(i._staticPropertyData[n])return i._staticPropertyData[n];if(!i.customProperties.has(r)){var o=a.get(i.sourceData.kind);if(!!o)return i._staticPropertyData[n]=o(i),i.customProperties.add(r),i._staticPropertyData[n]}},set:function(i,o){i._staticPropertyData[n]=o},delete:function(i){delete i._staticPropertyData[n]}}}e.create=t})(ol||(ol={}));function WTe(e,t,r,n){for(var a=new qo.EdgeBuilder(n,e,t),i=new Int8Array(a.slotCount),o=new Array(a.slotCount),s=new Array(a.slotCount),u=0,l=a.edgeCount;u<l;u++)a.addNextEdge(),a.assignProperty(i,r.order?r.order[u]:1),a.assignProperty(o,r.distance?r.distance[u]:-1),a.assignProperty(s,r.flag?r.flag[u]:1);return a.createGraph({order:i,distance:o,flag:s})}var Bi;(function(e){e.Descriptor={name:"index_pair_bonds"},e.Provider=ol.create(e.Descriptor);function t(r){var n=r.pairs,a=r.count,i=n.indexA.toArray(),o=n.indexB.toArray(),s=n.order&&n.order.toArray(),u=n.distance&&n.distance.toArray(),l=n.flag&&n.flag.toArray();return WTe(i,o,{order:s,distance:u,flag:l},a)}e.fromData=t})(Bi||(Bi={}));var m5=function(){function e(t,r,n){this.operatorsProvider=n,this.id=t,this.details=r}return Object.defineProperty(e.prototype,"operatorGroups",{get:function(){return this._operators?this._operators:(this._operators=this.operatorsProvider(),this._operators)},enumerable:!1,configurable:!0}),e}();(function(e){function t(r,n,a){return new e(r,n,a)}e.create=t})(m5||(m5={}));var B1;(function(e){e.Default={assemblies:[],spacegroup:al.ZeroP1,isNonStandardCrystalFrame:!1};function t(n,a){var i=a.toLocaleLowerCase(),o=wa.Provider.get(n);return o?VD(o.assemblies,function(s){return s.id.toLowerCase()===i}):void 0}e.findAssembly=t;function r(n){var a=n.spacegroup,i=a.cell,o=a.name,s=a.num,u=i.size,l=i.anglesInRadians,c=u[0].toFixed(2),d=u[1].toFixed(2),f=u[2].toFixed(2),p=qu(l[0]).toFixed(2),h=qu(l[1]).toFixed(2),m=qu(l[2]).toFixed(2),v=[];return v.push("Unit Cell <b>"+o+"</b> #"+s),v.push(c+"\xD7"+d+"\xD7"+f+" \u212B"),v.push("\u03B1="+p+"\xB0 \u03B2="+h+"\xB0 \u03B3="+m+"\xB0"),v.join(" | ")}e.getUnitcellLabel=r})(B1||(B1={}));var v5;(function(e){function t(r,n,a,i){return{id:Cn.create22(),label:r,basic:n,sourceData:i,bonds:a}}e.create=t})(v5||(v5={}));var XTe={HIS:"H",ARG:"R",LYS:"K",ILE:"I",PHE:"F",LEU:"L",TRP:"W",ALA:"A",MET:"M",PRO:"P",CYS:"C",ASN:"N",VAL:"V",GLY:"G",SER:"S",GLN:"Q",TYR:"Y",ASP:"D",GLU:"E",THR:"T",SEC:"U",PYL:"O"},YTe={DA:"A",DC:"C",DG:"G",DT:"T",DU:"U"},KTe={A:"A",C:"C",G:"G",T:"T",U:"U"};function HL(e){var t=XTe[e];return t||"X"}function jL(e){var t=KTe[e];return t||"X"}function GL(e){var t=YTe[e];return t||"X"}var F1;(function(e){function t(u){var l=u.code.toArray();return(l instanceof Array?l:Array.from(l)).join("")}e.getSequenceString=t;function r(u){for(var l=0,c=Math.min(u.rowCount,10);l<c;l++){var d=u.value(l)||"";if(HL(d)!=="X")return"protein";if(jL(d)!=="X")return"RNA";if(GL(d)!=="X")return"DNA"}return"generic"}function n(u,l){var c;switch(u){case"protein":c=HL;break;case"DNA":c=GL;break;case"RNA":c=jL;break;case"generic":c=function(){return"X"};break;default:throw new Error("unknown kind '"+u+"'")}return l&&l.size>0?function(d){var f=c(d);return f!=="X"||!l.has(d)?f:c(l.get(d))}:c}function a(u,l){if(l.rowCount===0)throw new Error("cannot be empty");var c=r(u);return new i(c,u,l)}e.ofResidueNames=a;var i=function(){function u(l,c,d){this.kind=l,this.microHet=new Map;for(var f=n(l),p=[],h=[],m=[],v=new Map,g=0,y=new Map,b=0,S=d.rowCount;b<S;++b){var x=d.value(b);if(y.has(x))v.has(x)?v.get(x).push(c.value(b)):v.set(x,[h[y.get(x)],c.value(b)]);else{y.set(x,g);var C=c.value(b);h[g]=C,m[g]=x,p[g]=f(C),g+=1}}for(var w=[],b=0,S=g;b<S;++b){var _=v.get(m[b]);if(_){var E=_.map(function(k){var F=f(k);return F==="X"?k:F});w[b]="("+E.join("|")+")"}else w[b]=p[b]==="X"?h[b]:p[b]}this.length=g,this.code=ye.ofStringArray(p),this.compId=ye.ofStringArray(h),this.seqId=ye.ofIntArray(m),this.label=ye.ofStringArray(w),this.microHet=v,this.indexMap=y}return u.prototype.index=function(l){return this.indexMap.get(l)},u}();function o(u,l){var c="generic";return new s(c,u,l)}e.ofSequenceRanges=o;var s=function(){function u(l,c,d){this.kind=l,this.seqIdStart=c,this.seqIdEnd=d,this.microHet=new Map;for(var f=0,p=Number.MAX_SAFE_INTEGER,h=0,m=this.seqIdStart.rowCount;h<m;h++){var v=this.seqIdStart.value(h),g=this.seqIdEnd.value(h);v<p&&(p=v),f<g&&(f=g)}var y=f-p+1;this.code=ye.ofConst("X",y,ye.Schema.str),this.label=ye.ofConst("",y,ye.Schema.str),this.seqId=ye.ofLambda({value:function(b){return b+p+1},rowCount:y,schema:ye.Schema.int}),this.compId=ye.ofConst("",y,ye.Schema.str),this.length=y,this.minSeqId=p}return u.prototype.index=function(l){return l-this.minSeqId},u}()})(F1||(F1={}));var g5;(function(e){var t={byEntityKey:{},sequences:[]};function r(){for(var s=[],u=0;u<arguments.length;u++)s[u]=arguments[u];for(var l=[],c={},d=0,f=s.length;d<f;++d)l.push.apply(l,s[d].sequences),Object.assign(c,s[d].byEntityKey);return{sequences:l,byEntityKey:c}}function n(s,u,l){var c=a(s,u),d=l.isDefined?i(s,l):t;return r(c,d)}e.fromHierarchy=n;function a(s,u){var l=u.atoms.label_comp_id,c=u.residues.label_seq_id,d=u.chainAtomSegments,f=u.residueAtomSegments,p=d.count,h=d.offsets,m={},v=[];if(p===1&&h[0]===0&&h[1]===0)return{byEntityKey:m,sequences:v};for(var g=0,y=u.chains._rowCount;g<y;g++){var b=u.index.getEntityFromChain(g);if(!(m[b]!==void 0||s.data.type.value(b)!=="polymer")){var S=g;for(g++;g<y&&b===u.index.getEntityFromChain(g)&&s.data.type.value(b)!=="polymer";)g++;g--;for(var x=f.index[h[S]],C=f.index[h[g+1]-1]+1,w=ye.window(c,x,C),_=[],E=x;E<C;++E)_.push(l.value(f.offsets[E]));var P=ye.ofStringArray(_);m[b]={entityId:s.data.id.value(b),sequence:F1.ofResidueNames(P,w)},v.push(m[b])}}return{byEntityKey:m,sequences:v}}e.fromAtomicHierarchy=a;function i(s,u){var l=o(s,u.spheres),c=o(s,u.gaussians);return r(l,c)}e.fromCoarseHierarchy=i;function o(s,u){var l=u.chainElementSegments,c=u.seq_id_begin,d=u.seq_id_end,f=l.count,p=l.offsets,h={},m=[];if(f===1&&p[0]===0&&p[1]===0)return{byEntityKey:h,sequences:m};for(var v=0,g=f;v<g;v++){var y=u.getEntityFromChain(v);if(h[y]===void 0){var b=v;for(v++;v<g&&y===u.getEntityFromChain(v);)v++;v--;var S=p[b],x=p[v+1]-1,C=ye.window(c,S,x),w=ye.window(d,S,x);h[y]={entityId:s.data.id.value(y),sequence:F1.ofSequenceRanges(C,w)},m.push(h[y])}}return{byEntityKey:h,sequences:m}}e.fromCoarseElements=o})(g5||(g5={}));var ot;(function(e){function t(f,p,h){return{kind:"element-location",structure:f,unit:p,element:h||0}}e.create=t;function r(f){return t(f.structure,f.unit,f.element)}e.clone=r;function n(f,p,h,m){return p&&(f.structure=p),h&&(f.unit=h),m!==void 0&&(f.element=m),f}e.set=n;function a(f,p){return f.unit=p.unit,f.element=p.element,f}e.copy=a;function i(f){return!!f&&f.kind==="element-location"}e.is=i;function o(f,p){return f.unit===p.unit&&f.element===p.element}e.areEqual=o;var s=A.zero(),u=A.zero();function l(f,p){return f.unit.conformation.position(f.element,s),p.unit.conformation.position(p.element,u),A.distance(s,u)}e.distance=l;function c(f){return f.unit.model.atomicHierarchy.residueAtomSegments.index[f.element]}e.residueIndex=c;function d(f){return f.unit.model.atomicHierarchy.chainAtomSegments.index[f.element]}e.chainIndex=d})(ot||(ot={}));var De;(function(e){function t(s,u,l){return{kind:"variable",name:s,type:u,isConstraint:l}}e.Variable=t;function r(s,u,l){return{kind:"value",namespace:s,name:u,parent:l}}e.Value=r;function n(s,u,l,c){return{kind:"container",namespace:s,name:u,child:l,alias:c}}e.Container=n;function a(s){return{kind:"union",types:s}}e.Union=a;function i(s,u,l,c){for(var d=Object.create(null),f=0,p=c;f<p.length;f++){var h=p[f];d[h]=!0}return{kind:"oneof",namespace:s,name:u,type:l,values:d}}e.OneOf=i,e.Any={kind:"any"},e.AnyValue={kind:"any-value"},e.Num=r("","Number"),e.Str=r("","String"),e.Bool=i("","Bool",e.Str,["true","false"]);function o(s){var u=s.values;return Object.keys(u).sort()}e.oneOfValues=o})(De||(De={}));var Ha;(function(e){function t(u){return{name:u}}e.Symbol=t;function r(u,l){return l?{head:u,args:l}:{head:u}}e.Apply=r;function n(u){return!!u&&Array.isArray(u)}e.isArgumentsArray=n;function a(u){return!!u&&!Array.isArray(u)}e.isArgumentsMap=a;function i(u){return!o(u)&&!s(u)}e.isLiteral=i;function o(u){return!!u&&!!u.head&&typeof u=="object"}e.isApply=o;function s(u){return!!u&&typeof u.name=="string"}e.isSymbol=s})(Ha||(Ha={}));function bt(e,t){var r=t||{},n=r.description,a=n===void 0?void 0:n,i=r.isOptional,o=i===void 0?!1:i,s=r.isRest,u=s===void 0?!1:s,l=r.defaultValue,c=l===void 0?void 0:l;return{type:e,isOptional:o,isRest:u,defaultValue:c,description:a}}var zt;(function(e){e.None=t({});function t(n){return{kind:"dictionary",map:n,"@type":0}}e.Dictionary=t;function r(n,a){var i=(a||{}).nonEmpty,o=i===void 0?!1:i;return{kind:"list",type:n,nonEmpty:o,"@type":0}}e.List=r})(zt||(zt={}));function Jg(e,t,r,n){var a=function(i){return Ha.Apply(Ha.Symbol(a.id),i)};return a.info={namespace:"",name:e,description:n},a.id="",a.args=t,a.type=r,a}function qL(e,t,r,n){var a=function(i){return Ha.Apply(Ha.Symbol(a.id),i)};return a.info={namespace:e,name:t,description:n},a.id=e+"."+t,a.args=zt.None,a.type=r,a}function HC(e){var t=e;return typeof t=="function"&&!!t.info&&!!t.args&&typeof t.info.namespace=="string"&&!!t.type}function qt(e,t,r){return Jg("",e,t,r)}function PX(e){MX("","",e)}function IX(e){var t=[];return DX(e,t),t}function WL(e){var t=/([a-z])([A-Z])([a-z]|$)/g;return e.replace(t,function(r,n,a,i){return n+"-"+a.toLocaleLowerCase()+i}).replace(t,function(r,n,a,i){return n+"-"+a.toLocaleLowerCase()+i})}function MX(e,t,r){if(HC(r)){r.info.namespace=e,r.info.name=r.info.name||WL(t),r.id=r.info.namespace+"."+r.info.name;return}for(var n=""+(r["@namespace"]||WL(t)),a=e?e+"."+n:n,i=0,o=Object.keys(r);i<o.length;i++){var s=o[i];typeof r[s]!="object"&&!HC(r[s])||MX(a,s,r[s])}}function DX(e,t){if(HC(e)){t.push(e);return}for(var r=0,n=Object.keys(e);r<n.length;r++){var a=n[r];typeof e[a]!="object"&&!HC(e[a])||DX(e[a],t)}}var Ir;(function(e){e.AnyVar=De.Variable("a",De.Any),e.AnyValueVar=De.Variable("a",De.Any),e.ConstrainedVar=De.Variable("a",De.Any,!0),e.Regex=De.Value("Core","Regex"),e.Set=function(t){return De.Container("Core","Set",t||e.AnyValueVar)},e.List=function(t){return De.Container("Core","List",t||e.AnyVar)},e.Fn=function(t,r){return De.Container("Core","Fn",t||e.AnyVar,r)},e.Flags=function(t,r){return De.Container("Core","Flags",t,r)},e.BitFlags=e.Flags(De.Num,"BitFlags")})(Ir||(Ir={}));function Qa(e,t){return qt(zt.Dictionary({0:bt(e)}),e,t)}function Of(e,t){return qt(zt.List(e,{nonEmpty:!0}),e,t)}function Fl(e,t,r){return qt(zt.Dictionary({0:bt(e),1:bt(e)}),t,r)}zt.Dictionary({0:bt(De.Num),1:bt(De.Num)});bt(De.Str);var $Te={"@header":"Types",bool:qt(zt.Dictionary({0:bt(De.AnyValue)}),De.Bool,"Convert a value to boolean."),num:qt(zt.Dictionary({0:bt(De.AnyValue)}),De.Num,"Convert a value to number."),str:qt(zt.Dictionary({0:bt(De.AnyValue)}),De.Str,"Convert a value to string."),regex:qt(zt.Dictionary({0:bt(De.Str,{description:"Expression"}),1:bt(De.Str,{isOptional:!0,description:"Flags, e.g. 'i' for ignore case"})}),Ir.Regex,"Creates a regular expression from a string using the ECMAscript syntax."),list:qt(zt.List(Ir.AnyVar),Ir.List()),set:qt(zt.List(Ir.AnyValueVar),Ir.Set()),bitflags:qt(zt.Dictionary({0:bt(De.Num)}),Ir.BitFlags,"Interpret a number as bitflags."),compositeKey:qt(zt.List(De.AnyValue),De.AnyValue)},QTe={"@header":"Logic",not:Qa(De.Bool),and:Of(De.Bool),or:Of(De.Bool)},ZTe={"@header":"Control",eval:qt(zt.Dictionary({0:bt(Ir.Fn(Ir.AnyVar))}),Ir.AnyVar,"Evaluate a function."),fn:qt(zt.Dictionary({0:bt(Ir.AnyVar)}),Ir.Fn(Ir.AnyVar),'Wrap an expression to a "lazy" function.'),if:qt(zt.Dictionary({0:bt(De.Bool,{description:"Condition"}),1:bt(De.Variable("a",De.Any),{description:"If true"}),2:bt(De.Variable("b",De.Any),{description:"If false"})}),De.Union([De.Variable("a",De.Any),De.Variable("b",De.Any)])),assoc:qt(zt.Dictionary({0:bt(De.Str,{description:"Name"}),1:bt(De.Variable("a",De.Any),{description:"Value to assign"})}),De.Variable("a",De.Any))},JTe={"@header":"Relational",eq:Fl(De.Variable("a",De.AnyValue,!0),De.Bool),neq:Fl(De.Variable("a",De.AnyValue,!0),De.Bool),lt:Fl(De.Num,De.Bool),lte:Fl(De.Num,De.Bool),gr:Fl(De.Num,De.Bool),gre:Fl(De.Num,De.Bool),inRange:qt(zt.Dictionary({0:bt(De.Num,{description:"Value to test"}),1:bt(De.Num,{description:"Minimum value"}),2:bt(De.Num,{description:"Maximum value"})}),De.Bool,"Check if the value of the 1st argument is >= 2nd and <= 3rd.")},eEe={"@header":"Math",add:Of(De.Num),sub:Of(De.Num),mult:Of(De.Num),div:Fl(De.Num,De.Num),pow:Fl(De.Num,De.Num),mod:Fl(De.Num,De.Num),min:Of(De.Num),max:Of(De.Num),floor:Qa(De.Num),ceil:Qa(De.Num),roundInt:Qa(De.Num),abs:Qa(De.Num),sqrt:Qa(De.Num),cbrt:Qa(De.Num),sin:Qa(De.Num),cos:Qa(De.Num),tan:Qa(De.Num),asin:Qa(De.Num),acos:Qa(De.Num),atan:Qa(De.Num),sinh:Qa(De.Num),cosh:Qa(De.Num),tanh:Qa(De.Num),exp:Qa(De.Num),log:Qa(De.Num),log10:Qa(De.Num),atan2:Fl(De.Num,De.Num)},tEe={"@header":"Strings",concat:Of(De.Str),match:qt(zt.Dictionary({0:bt(Ir.Regex),1:bt(De.Str)}),De.Bool)},rEe={"@header":"Lists",getAt:qt(zt.Dictionary({0:bt(Ir.List()),1:bt(De.Num)}),Ir.AnyVar),equal:qt(zt.Dictionary({0:bt(Ir.List()),1:bt(Ir.List())}),De.Bool)},nEe={"@header":"Sets",has:qt(zt.Dictionary({0:bt(Ir.Set(Ir.ConstrainedVar)),1:bt(Ir.ConstrainedVar)}),De.Bool,"Check if the the 1st argument includes the value of the 2nd."),isSubset:qt(zt.Dictionary({0:bt(Ir.Set(Ir.ConstrainedVar)),1:bt(Ir.Set(Ir.ConstrainedVar))}),De.Bool,"Check if the the 1st argument is a subset of the 2nd.")},aEe={"@header":"Flags",hasAny:qt(zt.Dictionary({0:bt(Ir.Flags(Ir.ConstrainedVar)),1:bt(Ir.Flags(Ir.ConstrainedVar))}),De.Bool,"Check if the the 1st argument has at least one of the 2nd one's flags."),hasAll:qt(zt.Dictionary({0:bt(Ir.Flags(Ir.ConstrainedVar)),1:bt(Ir.Flags(Ir.ConstrainedVar))}),De.Bool,"Check if the the 1st argument has all 2nd one's flags.")},Ek={"@header":"Language Primitives",type:$Te,logic:QTe,ctrl:ZTe,rel:JTe,math:eEe,str:tEe,list:rEe,set:nEe,flags:aEe};PX(Ek);var iEe=IX(Ek);(function(){for(var e=Object.create(null),t=0,r=iEe;t<r.length;t++){var n=r[t];e[n.id]=n}return e})();var Mt;(function(e){e.ElementSymbol=De.Value("Structure","ElementSymbol"),e.AtomName=De.Value("Structure","AtomName"),e.BondFlag=De.OneOf("Structure","BondFlag",De.Str,["covalent","metallic","ion","hydrogen","sulfide","computed","aromatic"]),e.BondFlags=Ir.Flags(e.BondFlag,"BondFlags"),e.SecondaryStructureFlag=De.OneOf("Structure","SecondaryStructureFlag",De.Str,["alpha","beta","3-10","pi","sheet","strand","helix","turn","none"]),e.SecondaryStructureFlags=Ir.Flags(e.SecondaryStructureFlag,"SecondaryStructureFlag"),e.RingFingerprint=De.Value("Structure","RingFingerprint"),e.EntityType=De.OneOf("Structure","EntityType",De.Str,["polymer","non-polymer","water","branched"]),e.EntitySubtype=De.OneOf("Structure","EntitySubtype",De.Str,["other","polypeptide(D)","polypeptide(L)","polydeoxyribonucleotide","polyribonucleotide","polydeoxyribonucleotide/polyribonucleotide hybrid","cyclic-pseudo-peptide","peptide nucleic acid","oligosaccharide"]),e.ObjectPrimitive=De.OneOf("Structure","ObjectPrimitive",De.Str,["atomistic","sphere","gaussian","other"]),e.ResidueId=De.Value("Structure","ResidueId"),e.ElementSet=De.Value("Structure","ElementSet"),e.ElementSelection=De.Value("Structure","ElementSelection"),e.ElementReference=De.Value("Structure","ElementReference"),e.ElementSelectionQuery=Ir.Fn(e.ElementSelection,"ElementSelectionQuery")})(Mt||(Mt={}));var oEe={"@header":"Types",elementSymbol:qt(zt.Dictionary({0:bt(De.Str)}),Mt.ElementSymbol,"Create element symbol representation from a string value."),atomName:qt(zt.Dictionary({0:bt(De.AnyValue)}),Mt.AtomName,"Convert a value to an atom name."),entityType:qt(zt.Dictionary({0:bt(Mt.EntityType)}),Mt.EntityType,"Create normalized representation of entity type: "+De.oneOfValues(Mt.EntityType).join(", ")+"."),bondFlags:qt(zt.List(Mt.BondFlag),Mt.BondFlags,"Create bond flags representation from a list of strings. Allowed flags: "+De.oneOfValues(Mt.BondFlag).join(", ")+"."),ringFingerprint:qt(zt.List(Mt.ElementSymbol,{nonEmpty:!0}),Mt.RingFingerprint,"Create ring fingerprint from the supplied atom element list."),secondaryStructureFlags:qt(zt.List(Mt.SecondaryStructureFlag),Mt.SecondaryStructureFlags,"Create secondary structure flags representation from a list of strings. Allowed flags: "+De.oneOfValues(Mt.SecondaryStructureFlag).join(", ")+"."),authResidueId:qt(zt.Dictionary({0:bt(De.Str,{description:"auth_asym_id"}),1:bt(De.Num,{description:"auth_seq_id"}),2:bt(De.Str,{description:"pdbx_PDB_ins_code",isOptional:!0})}),Mt.ResidueId,'Residue identifier based on "auth_" annotation.'),labelResidueId:qt(zt.Dictionary({0:bt(De.Str,{description:"label_entity_id"}),1:bt(De.Str,{description:"label_asym_id"}),2:bt(De.Num,{description:"label_seq_id"}),3:bt(De.Str,{description:"pdbx_PDB_ins_code",isOptional:!0})}),Mt.ResidueId,`Residue identifier based on mmCIF's "label_" annotation.`)},sEe={"@header":"Iteration Slots",element:qt(zt.None,Mt.ElementReference,"A reference to the current element."),elementSetReduce:qt(zt.None,De.Variable("a",De.AnyValue,!0),"Current value of the element set reducer.")},uEe={"@header":"Generators",all:qt(zt.None,Mt.ElementSelectionQuery,"The entire structure."),atomGroups:qt(zt.Dictionary({"entity-test":bt(De.Bool,{isOptional:!0,defaultValue:!0,description:"Test for the 1st atom of every entity"}),"chain-test":bt(De.Bool,{isOptional:!0,defaultValue:!0,description:"Test for the 1st atom of every chain"}),"residue-test":bt(De.Bool,{isOptional:!0,defaultValue:!0,description:"Test for the 1st atom every residue"}),"atom-test":bt(De.Bool,{isOptional:!0,defaultValue:!0}),"group-by":bt(De.Any,{isOptional:!0,defaultValue:"atom-key",description:"Group atoms to sets based on this property. Default: each atom has its own set"})}),Mt.ElementSelectionQuery,"Return all atoms for which the tests are satisfied, grouped into sets."),bondedAtomicPairs:qt(zt.Dictionary({0:bt(De.Bool,{isOptional:!0,defaultValue:"true for covalent bonds",description:"Test each bond with this predicate. Each bond is visited twice with swapped atom order."})}),Mt.ElementSelectionQuery,"Return all pairs of atoms for which the test is satisfied."),rings:qt(zt.Dictionary({fingerprint:bt(Mt.RingFingerprint,{isOptional:!0}),"only-aromatic":bt(De.Bool,{isOptional:!0,defaultValue:!1})}),Mt.ElementSelectionQuery,"Return all rings or those with the specified fingerprint and/or only aromatic rings."),queryInSelection:qt(zt.Dictionary({0:bt(Mt.ElementSelectionQuery),query:bt(Mt.ElementSelectionQuery),"in-complement":bt(De.Bool,{isOptional:!0,defaultValue:!1})}),Mt.ElementSelectionQuery,"Executes query only on atoms that are in the source selection."),empty:qt(zt.None,Mt.ElementSelectionQuery,"Nada.")},lEe={"@header":"Selection Modifications",queryEach:qt(zt.Dictionary({0:bt(Mt.ElementSelectionQuery),query:bt(Mt.ElementSelectionQuery)}),Mt.ElementSelectionQuery,"Query every atom set in the input selection separately."),intersectBy:qt(zt.Dictionary({0:bt(Mt.ElementSelectionQuery),by:bt(Mt.ElementSelectionQuery)}),Mt.ElementSelectionQuery,"Intersect each atom set from the first sequence from atoms in the second one."),exceptBy:qt(zt.Dictionary({0:bt(Mt.ElementSelectionQuery),by:bt(Mt.ElementSelectionQuery)}),Mt.ElementSelectionQuery,"Remove all atoms from 'selection' that occur in 'by'."),unionBy:qt(zt.Dictionary({0:bt(Mt.ElementSelectionQuery),by:bt(Mt.ElementSelectionQuery)}),Mt.ElementSelectionQuery,"For each atom set A in the orginal sequence, combine all atoms sets in the target selection that intersect with A."),union:qt(zt.Dictionary({0:bt(Mt.ElementSelectionQuery)}),Mt.ElementSelectionQuery,"Collects all atom sets in the sequence into a single atom set."),cluster:qt(zt.Dictionary({0:bt(Mt.ElementSelectionQuery),"min-distance":bt(De.Num,{isOptional:!0,defaultValue:0}),"max-distance":bt(De.Num),"min-size":bt(De.Num,{description:"Minimal number of sets to merge, must be at least 2",isOptional:!0,defaultValue:2}),"max-size":bt(De.Num,{description:"Maximal number of sets to merge, if not set, no limit",isOptional:!0})}),Mt.ElementSelectionQuery,"Combines atom sets that have mutual distance in the interval [min-radius, max-radius]. Minimum/maximum size determines how many atom sets can be combined."),includeSurroundings:qt(zt.Dictionary({0:bt(Mt.ElementSelectionQuery),radius:bt(De.Num),"atom-radius":bt(De.Num,{isOptional:!0,defaultValue:0,description:"Value added to each atom before the distance check, for example VDW radius. Using this argument is computationally demanding."}),"as-whole-residues":bt(De.Bool,{isOptional:!0})}),Mt.ElementSelectionQuery,"For each atom set in the selection, include all surrouding atoms/residues that are within the specified radius."),surroundingLigands:qt(zt.Dictionary({0:bt(Mt.ElementSelectionQuery),radius:bt(De.Num),"include-water":bt(De.Bool,{isOptional:!0,defaultValue:!0})}),Mt.ElementSelectionQuery,"Find all ligands components around the source query."),includeConnected:qt(zt.Dictionary({0:bt(Mt.ElementSelectionQuery),"bond-test":bt(De.Bool,{isOptional:!0,defaultValue:"true for covalent bonds"}),"layer-count":bt(De.Num,{isOptional:!0,defaultValue:1,description:"Number of bonded layers to include."}),"fixed-point":bt(De.Bool,{isOptional:!0,defaultValue:!1,description:"Continue adding layers as long as new connections exist."}),"as-whole-residues":bt(De.Bool,{isOptional:!0})}),Mt.ElementSelectionQuery,"Pick all atom sets that are connected to the target."),wholeResidues:qt(zt.Dictionary({0:bt(Mt.ElementSelectionQuery)}),Mt.ElementSelectionQuery,"Expand the selection to whole residues."),expandProperty:qt(zt.Dictionary({0:bt(Mt.ElementSelectionQuery),property:bt(De.AnyValue)}),Mt.ElementSelectionQuery,"To each atom set in the selection, add all atoms that have the same property value that was already present in the set.")},cEe={"@header":"Selection Filters",pick:qt(zt.Dictionary({0:bt(Mt.ElementSelectionQuery),test:bt(De.Bool)}),Mt.ElementSelectionQuery,"Pick all atom sets that satisfy the test."),first:qt(zt.Dictionary({0:bt(Mt.ElementSelectionQuery)}),Mt.ElementSelectionQuery,"Take the 1st atom set in the sequence."),withSameAtomProperties:qt(zt.Dictionary({0:bt(Mt.ElementSelectionQuery),source:bt(Mt.ElementSelectionQuery),property:bt(De.Any)}),Mt.ElementSelectionQuery,"Pick all atom sets for which the set of given atom properties is a subset of the source properties."),intersectedBy:qt(zt.Dictionary({0:bt(Mt.ElementSelectionQuery),by:bt(Mt.ElementSelectionQuery)}),Mt.ElementSelectionQuery,"Pick all atom sets that have non-zero intersection with the target."),within:qt(zt.Dictionary({0:bt(Mt.ElementSelectionQuery),target:bt(Mt.ElementSelectionQuery),"min-radius":bt(De.Num,{isOptional:!0,defaultValue:0}),"max-radius":bt(De.Num),"atom-radius":bt(De.Num,{isOptional:!0,defaultValue:0,description:"Value added to each atom before the distance check, for example VDW radius. Using this argument is computationally demanding."}),invert:bt(De.Bool,{isOptional:!0,defaultValue:!1,description:"If true, pick only atom sets that are further than the specified radius."})}),Mt.ElementSelectionQuery,"Pick all atom sets from selection that have any atom within the radius of any atom from target."),isConnectedTo:qt(zt.Dictionary({0:bt(Mt.ElementSelectionQuery),target:bt(Mt.ElementSelectionQuery),"bond-test":bt(De.Bool,{isOptional:!0,defaultValue:"true for covalent bonds"}),disjunct:bt(De.Bool,{isOptional:!0,defaultValue:!0,description:"If true, there must exist a bond to an atom that lies outside the given atom set to pass test."}),invert:bt(De.Bool,{isOptional:!0,defaultValue:!1,description:"If true, return atom sets that are not connected."})}),Mt.ElementSelectionQuery,"Pick all atom sets that are connected to the target.")},dEe={"@header":"Selection Combinators",intersect:qt(zt.List(Mt.ElementSelectionQuery),Mt.ElementSelectionQuery,"Return all unique atom sets that appear in all of the source selections."),merge:qt(zt.List(Mt.ElementSelectionQuery),Mt.ElementSelectionQuery,"Merges multiple selections into a single one. Only unique atom sets are kept."),distanceCluster:qt(zt.Dictionary({matrix:bt(Ir.List(Ir.List(De.Num)),{description:"Distance matrix, represented as list of rows (num[][])). Lower triangle is min distance, upper triangle is max distance."}),selections:bt(Ir.List(Mt.ElementSelectionQuery),{description:"A list of held selections."})}),Mt.ElementSelectionQuery,"Pick combinations of atom sets from the source sequences that are mutually within distances specified by a matrix.")},fEe={"@header":"Atom Sets",atomCount:qt(zt.None,De.Num),countQuery:qt(zt.Dictionary({0:bt(Mt.ElementSelectionQuery)}),De.Num,"Counts the number of occurences of a specific query inside the current atom set."),reduce:qt(zt.Dictionary({initial:bt(De.Variable("a",De.AnyValue,!0),{description:"Initial value assigned to slot.atom-set-reduce. Current atom is set to the 1st atom of the current set for this."}),value:bt(De.Variable("a",De.AnyValue,!0),{description:"Expression executed for each atom in the set"})}),De.Variable("a",De.AnyValue,!0),"Execute the value expression for each atom in the current atom set and return the result. Works the same way as Array.reduce in JavaScript (``result = value(value(...value(initial)))``)"),propertySet:qt(zt.Dictionary({0:bt(Ir.ConstrainedVar)}),Ir.Set(Ir.ConstrainedVar),"Returns a set with all values of the given property in the current atom set.")},pEe={"@header":"Atom Properties",core:{"@header":"Core Properties",elementSymbol:Tr(Mt.ElementSymbol),vdw:Tr(De.Num,"Van der Waals radius"),mass:Tr(De.Num,"Atomic weight"),atomicNumber:Tr(De.Num,"Atomic number"),x:Tr(De.Num,"Cartesian X coordinate"),y:Tr(De.Num,"Cartesian Y coordinate"),z:Tr(De.Num,"Cartesian Z coordinate"),atomKey:Tr(De.AnyValue,"Unique value for each atom. Main use case is grouping of atoms."),bondCount:qt(zt.Dictionary({0:bt(Mt.ElementReference,{isOptional:!0,defaultValue:"slot.current-atom"}),flags:bt(Mt.BondFlags,{isOptional:!0,defaultValue:"covalent"})}),De.Num,"Number of bonds (by default only covalent bonds are counted)."),sourceIndex:Tr(De.Num,"Index of the atom/element in the input file."),operatorName:Tr(De.Str,"Name of the symmetry operator applied to this element."),modelIndex:Tr(De.Num,"Index of the model in the input file."),modelLabel:Tr(De.Str,"Label/header of the model in the input file.")},topology:{connectedComponentKey:Tr(De.AnyValue,"Unique value for each connected component.")},macromolecular:{"@header":"Macromolecular Properties (derived from the mmCIF format)",authResidueId:Tr(Mt.ResidueId,"type.auth-residue-id symbol executed on current atom's residue"),labelResidueId:Tr(Mt.ResidueId,"type.label-residue-id symbol executed on current atom's residue"),residueKey:Tr(De.AnyValue,"Unique value for each tuple ``(label_entity_id,auth_asym_id, auth_seq_id, pdbx_PDB_ins_code)``, main use case is grouping of atoms"),chainKey:Tr(De.AnyValue,"Unique value for each tuple ``(label_entity_id, auth_asym_id)``, main use case is grouping of atoms"),entityKey:Tr(De.AnyValue,"Unique value for each tuple ``label_entity_id``, main use case is grouping of atoms"),isHet:Tr(De.Bool,"Equivalent to atom_site.group_PDB !== ATOM"),id:Tr(De.Num,"_atom_site.id"),label_atom_id:Tr(Mt.AtomName),label_alt_id:Tr(De.Str),label_comp_id:Tr(De.Str),label_asym_id:Tr(De.Str),label_entity_id:Tr(De.Str),label_seq_id:Tr(De.Num),auth_atom_id:Tr(Mt.AtomName),auth_comp_id:Tr(De.Str),auth_asym_id:Tr(De.Str),auth_seq_id:Tr(De.Num),pdbx_PDB_ins_code:Tr(De.Str),pdbx_formal_charge:Tr(De.Num),occupancy:Tr(De.Num),B_iso_or_equiv:Tr(De.Num),entityType:Tr(Mt.EntityType,"Type of the entity as defined in mmCIF (polymer, non-polymer, branched, water)"),entitySubtype:Tr(Mt.EntitySubtype,"Subtype of the entity as defined in mmCIF _entity_poly.type and _pdbx_entity_branch.type (other, polypeptide(D), polypeptide(L), polydeoxyribonucleotide, polyribonucleotide, polydeoxyribonucleotide/polyribonucleotide hybrid, cyclic-pseudo-peptide, peptide nucleic acid, oligosaccharide)"),entityPrdId:Tr(De.Str,"The PRD ID of the entity."),entityDescription:Tr(Ir.List(De.Str)),objectPrimitive:Tr(Mt.ObjectPrimitive,"Type of the primitive object used to model this segment as defined in mmCIF/IHM (atomistic, sphere, gaussian, other)"),secondaryStructureKey:Tr(De.AnyValue,"Unique value for each secondary structure element."),secondaryStructureFlags:Tr(Mt.SecondaryStructureFlags),isModified:Tr(De.Bool,"True if the atom belongs to modification of a standard residue."),modifiedParentName:Tr(De.Str,"'3-letter' code of the modifed parent residue."),isNonStandard:Tr(De.Bool,"True if this is a non-standard residue."),chemCompType:Tr(De.Str,"Type of the chemical component as defined in mmCIF.")}},hEe={"@header":"Bond Properties",flags:_g(Mt.BondFlags),order:_g(De.Num),length:_g(De.Num),atomA:_g(Mt.ElementReference),atomB:_g(Mt.ElementReference)};function Tr(e,t){return qt(zt.Dictionary({0:bt(Mt.ElementReference,{isOptional:!0,defaultValue:"slot.current-atom"})}),e,t)}function _g(e,t){return qt(zt.None,e,t)}var mEe={"@header":"Structure Queries",type:oEe,slot:sEe,generator:uEe,modifier:lEe,filter:cEe,combinator:dEe,atomSet:fEe,atomProperty:pEe,bondProperty:hEe},vEe={"@header":"Generators",bundleElement:qt(zt.Dictionary({groupedUnits:bt(De.Any),set:bt(De.Any),ranges:bt(De.Any)}),De.Any),bundle:qt(zt.Dictionary({elements:bt(De.Any)}),Mt.ElementSelectionQuery,"A selection with single structure containing represented by the bundle."),current:qt(zt.None,Mt.ElementSelectionQuery,"Current selection provided by the query context. Avoid using this in State Transforms.")},gEe={"@header":"Internal Queries",generator:vEe},Ae={core:Ek,structureQuery:mEe,internal:gEe};PX(Ae);var yEe=IX(Ae);(function(){for(var e=Object.create(null),t=0,r=yEe;t<r.length;t++){var n=r[t];e[n.id]=n}return e})();var ce;(function(e){e.core=Ae.core,e.struct=Ae.structureQuery,e.internal=Ae.internal;function t(y){return e.struct.type.atomName([y])}e.atomName=t;function r(y){return e.struct.type.elementSymbol([y])}e.es=r;function n(){for(var y=[],b=0;b<arguments.length;b++)y[b]=arguments[b];return e.core.type.list(y)}e.list=n;function a(){for(var y=[],b=0;b<arguments.length;b++)y[b]=arguments[b];return e.core.type.set(y)}e.set=a;function i(y,b){return e.core.type.regex([y,b])}e.re=i;function o(y){return e.core.ctrl.fn([y])}e.fn=o;function s(y){return e.core.ctrl.eval([y])}e.evaluate=s;var u=e.struct.atomProperty.core,l=e.struct.atomProperty.macromolecular,c=e.struct.atomProperty.topology;function d(y){return u[y]()}e.acp=d;function f(y){return c[y]()}e.atp=f;function p(y){return l[y]()}e.ammp=p;var h=e.struct.atomSet.propertySet;function m(y){return h([d(y)])}e.acpSet=m;function v(y){return h([f(y)])}e.atpSet=v;function g(y){return h([p(y)])}e.ammpSet=g})(ce||(ce={}));var sm=function(){function e(t){this.map=t;var r=0,n=[],a=new Map,i=new Map;this.map.forEach(function(o){o.forEach(function(s){r+=s.edgeCount,s.connectedIndices.forEach(function(u){s.getEdges(u).forEach(function(l){var c=s.unitA,d=s.unitB,f=e.getEdgeKey(u,c,l.indexB,d);a.set(f,n.length);var p=e.getVertexKey(u,c),h=i.get(p);h===void 0?i.set(p,[n.length]):h.push(n.length),n.push(T(T({},l),{indexA:u,unitA:c,unitB:d}))})})})}),this.edgeCount=r,this.edges=n,this.edgeKeyIndex=a,this.vertexKeyIndex=i}return e.prototype.getConnectedUnits=function(t){return this.map.has(t)?this.map.get(t):kX},e.prototype.getEdgeIndex=function(t,r,n,a){var i=e.getEdgeKey(t,r,n,a),o=this.edgeKeyIndex.get(i);return o!==void 0?o:-1},e.prototype.hasEdge=function(t,r,n,a){return this.getEdgeIndex(t,r,n,a)!==-1},e.prototype.getEdge=function(t,r,n,a){var i=this.getEdgeIndex(t,r,n,a);return i!==-1?this.edges[i]:void 0},e.prototype.getEdgeIndices=function(t,r){return this.vertexKeyIndex.get(e.getVertexKey(t,r))||[]},e}();(function(e){var t=function(){function o(s,u,l,c,d){this.unitA=s,this.unitB=u,this.edgeCount=l,this.connectedIndices=c,this.edgeMap=d}return o.prototype.hasEdges=function(s){return this.edgeMap.has(s)},o.prototype.getEdges=function(s){return this.edgeMap.has(s)?this.edgeMap.get(s):kX},Object.defineProperty(o.prototype,"areUnitsOrdered",{get:function(){return this.unitA<this.unitB},enumerable:!1,configurable:!0}),o}();e.UnitPairEdges=t;function r(o,s,u,l){return o+"|"+s+"|"+u+"|"+l}e.getEdgeKey=r;function n(o,s){return o+"|"+s}e.getVertexKey=n;function a(o,s,u){o.has(s)?o.get(s).push(u):o.set(s,[u])}var i=function(){function o(){this.map=new Map}return o.prototype.startUnitPair=function(s,u){this.uA=s,this.uB=u,this.mapAB=new Map,this.mapBA=new Map,this.linkedA=on.create(),this.linkedB=on.create(),this.linkCount=0},o.prototype.finishUnitPair=function(){this.linkCount!==0&&(a(this.map,this.uA,new t(this.uA,this.uB,this.linkCount,this.linkedA.array,this.mapAB)),a(this.map,this.uB,new t(this.uB,this.uA,this.linkCount,this.linkedB.array,this.mapBA)))},o.prototype.add=function(s,u,l){a(this.mapAB,s,{indexB:u,props:l}),a(this.mapBA,u,{indexB:s,props:l}),on.add(this.linkedA,s,s),on.add(this.linkedB,u,u),this.linkCount+=1},o.prototype.getMap=function(){return this.map},o}();e.Builder=i})(sm||(sm={}));var kX=[],y5;(function(e){e.Empty=qo.create([],[],[],0,{flags:[],order:[]})})(y5||(y5={}));var Ny=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getBondFromLocation=function(r){return We.isAtomic(r.aUnit)&&We.isAtomic(r.bUnit)?this.getEdge(r.aIndex,r.aUnit.id,r.bIndex,r.bUnit.id):void 0},t.prototype.getBondIndexFromLocation=function(r){return We.isAtomic(r.aUnit)&&We.isAtomic(r.bUnit)?this.getEdgeIndex(r.aIndex,r.aUnit.id,r.bIndex,r.bUnit.id):-1},t}(sm);(function(e){var t=function(r){Le(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n}(sm.UnitPairEdges);e.UnitPairBonds=t})(Ny||(Ny={}));var RX={forceCompute:!1,noCompute:!1},Pk={H:0,h:0,D:0,d:0,T:0,t:0,He:2,HE:2,he:2,Li:3,LI:3,li:3,Be:4,BE:4,be:4,B:5,b:5,C:6,c:6,N:7,n:7,O:8,o:8,F:9,f:9,Ne:10,NE:10,ne:10,Na:11,NA:11,na:11,Mg:12,MG:12,mg:12,Al:13,AL:13,al:13,Si:14,SI:14,si:14,P:15,p:15,S:16,s:16,Cl:17,CL:17,cl:17,Ar:18,AR:18,ar:18,K:19,k:19,Ca:20,CA:20,ca:20,Sc:21,SC:21,sc:21,Ti:22,TI:22,ti:22,V:23,v:23,Cr:24,CR:24,cr:24,Mn:25,MN:25,mn:25,Fe:26,FE:26,fe:26,Co:27,CO:27,co:27,Ni:28,NI:28,ni:28,Cu:29,CU:29,cu:29,Zn:30,ZN:30,zn:30,Ga:31,GA:31,ga:31,Ge:32,GE:32,ge:32,As:33,AS:33,as:33,Se:34,SE:34,se:34,Br:35,BR:35,br:35,Kr:36,KR:36,kr:36,Rb:37,RB:37,rb:37,Sr:38,SR:38,sr:38,Y:39,y:39,Zr:40,ZR:40,zr:40,Nb:41,NB:41,nb:41,Mo:42,MO:42,mo:42,Tc:43,TC:43,tc:43,Ru:44,RU:44,ru:44,Rh:45,RH:45,rh:45,Pd:46,PD:46,pd:46,Ag:47,AG:47,ag:47,Cd:48,CD:48,cd:48,In:49,IN:49,in:49,Sn:50,SN:50,sn:50,Sb:51,SB:51,sb:51,Te:52,TE:52,te:52,I:53,i:53,Xe:54,XE:54,xe:54,Cs:55,CS:55,cs:55,Ba:56,BA:56,ba:56,La:57,LA:57,la:57,Ce:58,CE:58,ce:58,Pr:59,PR:59,pr:59,Nd:60,ND:60,nd:60,Pm:61,PM:61,pm:61,Sm:62,SM:62,sm:62,Eu:63,EU:63,eu:63,Gd:64,GD:64,gd:64,Tb:65,TB:65,tb:65,Dy:66,DY:66,dy:66,Ho:67,HO:67,ho:67,Er:68,ER:68,er:68,Tm:69,TM:69,tm:69,Yb:70,YB:70,yb:70,Lu:71,LU:71,lu:71,Hf:72,HF:72,hf:72,Ta:73,TA:73,ta:73,W:74,w:74,Re:75,RE:75,re:75,Os:76,OS:76,os:76,Ir:77,IR:77,ir:77,Pt:78,PT:78,pt:78,Au:79,AU:79,au:79,Hg:80,HG:80,hg:80,Tl:81,TL:81,tl:81,Pb:82,PB:82,pb:82,Bi:83,BI:83,bi:83,Po:84,PO:84,po:84,At:85,AT:85,at:85,Rn:86,RN:86,rn:86,Fr:87,FR:87,fr:87,Ra:88,RA:88,ra:88,Ac:89,AC:89,ac:89,Th:90,TH:90,th:90,Pa:91,PA:91,pa:91,U:92,u:92,Np:93,NP:93,np:93,Pu:94,PU:94,pu:94,Am:95,AM:95,am:95,Cm:96,CM:96,cm:96,Bk:97,BK:97,bk:97,Cf:98,CF:98,cf:98,Es:99,ES:99,es:99,Fm:100,FM:100,fm:100,Md:101,MD:101,md:101,No:102,NO:102,no:102,Lr:103,LR:103,lr:103,Rf:104,RF:104,rf:104,Db:105,DB:105,db:105,Sg:106,SG:106,sg:106,Bh:107,BH:107,bh:107,Hs:108,HS:108,hs:108,Mt:109,MT:109,mt:109},bEe={0:1.42,1:1.42,3:2.7,4:2.7,6:1.75,7:1.6,8:1.52,11:2.7,12:2.7,13:2.7,14:1.9,15:2,16:1.9,17:1.8,19:2.7,20:2.7,21:2.7,22:2.7,23:2.7,24:2.7,25:2.7,26:2.7,27:2.7,28:2.7,29:2.7,30:2.7,31:2.7,33:2.68,37:2.7,38:2.7,39:2.7,40:2.7,41:2.7,42:2.7,43:2.7,44:2.7,45:2.7,46:2.7,47:2.7,48:2.7,49:2.7,50:2.7,55:2.7,56:2.7,57:2.7,58:2.7,59:2.7,60:2.7,61:2.7,62:2.7,63:2.7,64:2.7,65:2.7,66:2.7,67:2.7,68:2.7,69:2.7,70:2.7,71:2.7,72:2.7,73:2.7,74:2.7,75:2.7,76:2.7,77:2.7,78:2.7,79:2.7,80:2.7,81:2.7,82:2.7,83:2.7,87:2.7,88:2.7,89:2.7,90:2.7,91:2.7,92:2.7,93:2.7,94:2.7,95:2.7,96:2.7,97:2.7,98:2.7,99:2.7,100:2.7,101:2.7,102:2.7,103:2.7,104:2.7,105:2.7,106:2.7,107:2.7,108:2.7,109:2.88},xEe={0:.8,20:1.31,27:1.2,35:1.15,44:1.1,54:1,60:1.84,72:1.88,84:1.75,85:1.56,86:1.76,98:1.6,99:1.68,100:1.63,112:1.6,113:1.59,114:1.36,129:1.45,135:1.47,144:1.6,152:1.45,170:1.4,180:1.55,202:2.4,222:2.24,224:1.91,225:1.98,243:2.02,269:2,293:1.9,316:1.8,420:2.37,480:2.3,512:2.3,544:2.3,612:2.1,629:1.54,665:1,813:2.6,854:2.27,894:1.93,896:2.1,937:2.05,938:2.06,981:1.62,1258:2.68,1309:2.33,1484:1,1763:2.14,1823:2.48,1882:2.1,1944:1.72,2380:2.34,3367:2.44,3733:2.11,3819:2.6,3821:2.36,4736:2.75,5724:2.73,5959:2.63,6519:2.84,6750:2.87,8991:2.81},XL=2.001,L1=function(){for(var e=["LI","NA","K","RB","CS","FR","BE","MG","CA","SR","BA","RA","AL","GA","IN","SN","TL","PB","BI","SC","TI","V","CR","MN","FE","CO","NI","CU","ZN","Y","ZR","NB","MO","TC","RU","RH","PD","AG","CD","LA","HF","TA","W","RE","OS","IR","PT","AU","HG","AC","RF","DB","SG","BH","HS","MT","CE","PR","ND","PM","SM","EU","GD","TB","DY","HO","ER","TM","YB","LU","TH","PA","U","NP","PU","AM","CM","BK","CF","ES","FM","MD","NO","LR"],t=new Set,r=0,n=e;r<n.length;r++){var a=n[r];t.add(Pk[a])}return t}();function SEe(e,t){return e<t?(e+t)*(e+t+1)/2+t:(e+t)*(e+t+1)/2+e}function g0(e){var t=Pk[e];return t===void 0?-1:t}function OX(e,t){if(e<0||t<0)return-1;var r=xEe[SEe(e,t)];return r===void 0?-1:r}function jC(e){if(e<0)return XL;var t=bEe[e];return t===void 0?XL:t}var CEe=Pk.H;function N1(e){return e===CEe}var wEe=new Map([["HIS|CD2|CG",2],["HIS|CE1|ND1",2],["ARG|CZ|NH2",2],["PHE|CE1|CZ",2],["PHE|CD2|CE2",2],["PHE|CD1|CG",2],["TRP|CD1|CG",2],["TRP|CD2|CE2",2],["TRP|CE3|CZ3",2],["TRP|CH2|CZ2",2],["ASN|CG|OD1",2],["GLN|CD|OE1",2],["TYR|CD1|CG",2],["TYR|CD2|CE2",2],["TYR|CE1|CZ",2],["ASP|CG|OD1",2],["GLU|CD|OE1",2],["G|C8|N7",2],["G|C4|C5",2],["G|C2|N3",2],["G|C6|O6",2],["C|C4|N3",2],["C|C5|C6",2],["C|C2|O2",2],["A|C2|N3",2],["A|C6|N1",2],["A|C4|C5",2],["A|C8|N7",2],["U|C5|C6",2],["U|C2|O2",2],["U|C4|O4",2],["DG|C8|N7",2],["DG|C4|C5",2],["DG|C2|N3",2],["DG|C6|O6",2],["DC|C4|N3",2],["DC|C5|C6",2],["DC|C2|O2",2],["DA|C2|N3",2],["DA|C6|N1",2],["DA|C4|C5",2],["DA|C8|N7",2],["DT|C5|C6",2],["DT|C2|O2",2],["DT|C4|O4",2]]);function _Ee(e,t,r){var n;return n=t<r?[t,r]:[r,t],t=n[0],r=n[1],e_.has(e)&&t==="C"&&r==="O"||n_.has(e)&&t==="OP1"&&r==="P"?2:wEe.get(e+"|"+t+"|"+r)||1}var AEe=new Map([["LYS|NZ|RET|C15",2]]);function BX(e,t,r,n){var a,i;return e>r&&(a=[r,e],e=a[0],r=a[1],i=[n,t],t=i[0],n=i[1]),AEe.get(e+"|"+t+"|"+r+"|"+n)||1}var b5;(function(e){function t(s,u,l){return{name:s,type:0,value:u,valueKind:l&&l.valueKind,defaultFormat:l&&l.encoder?{encoder:l.encoder}:void 0,shouldInclude:l&&l.shouldInclude}}e.str=t;function r(s,u,l){return{name:s,type:1,value:u,valueKind:l&&l.valueKind,defaultFormat:l?{encoder:l.encoder,typedArray:l.typedArray}:void 0,shouldInclude:l&&l.shouldInclude}}e.int=r;function n(s,u,l){return{name:s,type:2,value:u,valueKind:l&&l.valueKind,defaultFormat:l?{encoder:l.encoder,typedArray:l.typedArray,digitCount:typeof l.digitCount<"u"?l.digitCount:void 0}:void 0,shouldInclude:l&&l.shouldInclude}}e.float=n;function a(s){return r(s,function(u,l,c){return c+1},{typedArray:Int32Array,encoder:wr.by(wr.delta).and(wr.runLength).and(wr.integerPacking)})}e.index=a;var i=function(){function s(){this.fields=[]}return s.prototype.index=function(u){return this.fields.push(e.index(u)),this},s.prototype.str=function(u,l,c){return this.fields.push(e.str(u,l,c)),this},s.prototype.int=function(u,l,c){return this.fields.push(e.int(u,l,c)),this},s.prototype.vec=function(u,l,c){for(var d=0;d<l.length;d++)this.fields.push(e.int(u+"["+(d+1)+"]",l[d],c));return this},s.prototype.float=function(u,l,c){return this.fields.push(e.float(u,l,c)),this},s.prototype.many=function(u){for(var l=0;l<u.length;l++)this.fields.push(u[l]);return this},s.prototype.add=function(u){return this.fields.push(u),this},s.prototype.getFields=function(){return this.fields},s}();e.Builder=i;function o(){return new i}e.build=o})(b5||(b5={}));var ps;(function(e){e.Empty={fields:[],source:[]};function t(n){for(var a=[],i=[],o=[],s=[],u=0,l=n.split(/[\r\n]+/);u<l.length;u++){var c=l[u];if(c=c.trim(),c.length!==0){var d=/^!/.test(c);d&&(c=c.substr(1));var f=c.split(/\./),p=f[1],h=d?p?s:i:p?o:a;h[h.length]=c,p&&!a.includes(f[0])&&(a[a.length]=f[0])}}var m=o.map(function(v){return v.split(".")[0]});return{includeCategory:function(v){return i.includes(v)?!1:a.length<=0||a.indexOf(v)!==-1},includeField:function(v,g){var y=v+"."+g;return s.includes(y)?!1:!m.includes(v)||o.includes(y)}}}e.filterOf=t,e.DefaultFilter={includeCategory:function(n){return!0},includeField:function(n,a){return!0}},e.DefaultFormatter={getFormat:function(n,a){}};function r(n,a){return a?{fields:YL(n._schema),source:[{data:n,rowCount:a.length,keys:function(){return OC.Array(a)}}]}:{fields:YL(n._schema),source:[{data:n,rowCount:n._rowCount}]}}e.ofTable=r})(ps||(ps={}));var x5;(function(e){function t(n,a,i){n.startDataBlock(a);for(var o=function(c){n.writeCategory({name:c,instance:function(){return ps.ofTable(i[c])}})},s=0,u=i._tableNames;s<u.length;s++){var l=u[s];o(l)}}e.writeDatabase=t;function r(n,a){for(var i=0,o=Object.keys(a);i<o.length;i++){var s=o[i];t(n,s,a[s])}}e.writeDatabaseCollection=r})(x5||(x5={}));function LA(e){return function(t,r){return r[e].value(t)}}function TEe(e){return function(t,r){return r[e].value(t).join(r[e].schema.separator)}}function NA(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return function(n,a){var i;return(i=a[e].schema.space).get.apply(i,Gt([a[e].value(n)],t))}}function ey(e){return function(t,r){return r[e].valueKind(t)}}function EEe(e,t){var r=[],n=2,a=ey(e);if(t.rank===1)for(var i=t.dimensions[0],o=0;o<i;o++){var s=e+"["+(o+1)+"]";r.push({name:s,type:n,value:NA(e,o),valueKind:a})}else if(t.rank===2)for(var i=t.dimensions[0],u=t.dimensions[1],o=0;o<i;o++)for(var l=0;l<u;l++){var c=e+"["+(o+1)+"]["+(l+1)+"]";r.push({name:c,type:n,value:NA(e,o,l),valueKind:a})}else if(t.rank===3)for(var d=t.dimensions[0],f=t.dimensions[1],p=t.dimensions[2],o=0;o<d;o++)for(var l=0;l<f;l++)for(var h=0;h<p;h++){var m=e+"["+(o+1)+"]["+(l+1)+"]["+(h+1)+"]";r.push({name:m,type:n,value:NA(e,o,l,h),valueKind:a})}else throw new Error("Tensors with rank > 3 or rank 0 are currently not supported.");return r}function YL(e){for(var t=[],r=0,n=Object.keys(e);r<n.length;r++){var a=n[r],i=e[a];if(i.valueType==="int")t.push({name:a,type:1,value:LA(a),valueKind:ey(a)});else if(i.valueType==="float")t.push({name:a,type:2,value:LA(a),valueKind:ey(a)});else if(i.valueType==="str")t.push({name:a,type:0,value:LA(a),valueKind:ey(a)});else if(i.valueType==="list")t.push({name:a,type:0,value:TEe(a),valueKind:ey(a)});else if(i.valueType==="tensor")t.push.apply(t,EEe(a,i.space));else throw new Error("Unknown valueType "+i.valueType)}return t}function PEe(e){return e.defaultFormat&&typeof e.defaultFormat.digitCount<"u"?Math.max(0,Math.min(e.defaultFormat.digitCount,16)):6}function Ik(e){return e.fields.some(function(t){return!!t.shouldInclude})?e.fields.filter(function(t){return!t.shouldInclude||e.source.some(function(r){return t.shouldInclude(r.data)})}):e.fields}function FX(e,t){var r=e.instance(t),n=r.source.filter(function(o){return o.rowCount>0});if(!n.length)return{instance:r,rowCount:0,source:[]};var a=n.reduce(function(o,s){return o+s.rowCount},0),i=n.map(function(o){return{data:o.data,keys:function(){return o.keys?o.keys():OC.Range(0,o.rowCount-1)},rowCount:o.rowCount}});return{instance:r,rowCount:a,source:i}}var IEe=function(){function e(){this.builder=Lr.create(),this.encoded=!1,this.dataBlockCreated=!1,this.filter=ps.DefaultFilter,this.formatter=ps.DefaultFormatter,this.isBinary=!1,this.binaryEncodingProvider=void 0}return e.prototype.setFilter=function(t){this.filter=t||ps.DefaultFilter},e.prototype.isCategoryIncluded=function(t){return this.filter.includeCategory(t)},e.prototype.setFormatter=function(t){this.formatter=t||ps.DefaultFormatter},e.prototype.startDataBlock=function(t){this.dataBlockCreated=!0,Lr.write(this.builder,"data_"+(t||"").replace(/[ \n\t]/g,"").toUpperCase()+`
#
`)},e.prototype.writeCategory=function(t,r,n){if(this.encoded)throw new Error("The writer contents have already been encoded, no more writing.");if(!this.dataBlockCreated)throw new Error("No data block created.");if(!(!n?.ignoreFilter&&!this.filter.includeCategory(t.name))){var a=FX(t,r),i=a.instance,o=a.rowCount,s=a.source;!o||(o===1?MEe(t,i,s,this.builder,this.filter,this.formatter):DEe(t,i,s,this.builder,this.filter,this.formatter))}},e.prototype.encode=function(){this.encoded=!0},e.prototype.writeTo=function(t){for(var r=Lr.getChunks(this.builder),n=0,a=r.length;n<a;n++)t.writeString(r[n])},e.prototype.getSize=function(){return Lr.getSize(this.builder)},e.prototype.getData=function(){return Lr.getString(this.builder)},e}();function LX(e,t,r,n,a,i){var o=n.valueKind,s=o?o(r,t):0;if(s!==0)s===1?BEe(e):FEe(e);else{var u=n.value(r,t,i),l=n.type;if(l===0)return kEe(u)?(pS(e,u),!0):LEe(e,u);l===1?REe(e,u):OEe(e,u,a)}return!1}function NX(e,t,r){for(var n=[],a=0,i=t;a<i.length;a++){var o=i[a],s=r.getFormat(e,o.name);s&&typeof s.digitCount<"u"?n[n.length]=o.type===2?Math.pow(10,Math.max(0,Math.min(s.digitCount,15))):0:n[n.length]=o.type===2?Math.pow(10,PEe(o)):0}return n}function MEe(e,t,r,n,a,i){var o=Ik(t),s=r[0],u=s.data,l=o.reduce(function(v,g){return a.includeField(e.name,g.name)?Math.max(v,g.name.length):0},0);if(l!==0){l+=e.name.length+6;for(var c=s.keys(),d=c.move(),f=NX(e.name,t.fields,i),p=0;p<o.length;p++){var h=o[p];if(!!a.includeField(e.name,h.name)){Lr.writePadRight(n,"_"+e.name+"."+h.name,l);var m=LX(n,u,d,h,f[p],0);m||Lr.newline(n)}}Lr.write(n,`#
`)}}function DEe(e,t,r,n,a,i){var o=Ik(t),s=a===ps.DefaultFilter?o:o.filter(function(b){return a.includeField(e.name,b.name)}),u=s.length;if(u!==0){var l=NX(e.name,s,i);KL(n,"loop_");for(var c=0;c<u;c++)KL(n,"_"+e.name+"."+s[c].name);for(var d=0,f=0;f<r.length;f++){var p=r[f],h=p.data;if(p.rowCount!==0)for(var m=p.keys();m.hasNext;){for(var v=m.move(),g=!1,y=0;y<u;y++)g=LX(n,h,v,s[y],l[y],d);g||Lr.newline(n),d++}}Lr.write(n,`#
`)}}function kEe(e){return typeof e=="string"&&e.indexOf(`
`)>=0}function KL(e,t){Lr.write(e,t),Lr.newline(e)}function REe(e,t){Lr.writeInteger(e,t),Lr.whitespace1(e)}function OEe(e,t,r){Lr.writeFloat(e,t,r),Lr.whitespace1(e)}function BEe(e){Lr.writeSafe(e,". ")}function FEe(e){Lr.writeSafe(e,"? ")}function LEe(e,t){if(!t)return Lr.writeSafe(e,". "),!1;for(var r=t.charCodeAt(0),n=!1,a=0,i=!1,o=!1,s=0,u=t.length-1;s<=u;s++){var l=t.charCodeAt(s);switch(l){case 9:n=!0;break;case 10:return pS(e,t),!0;case 32:n=!0;break;case 34:if(s&&s===u)break;if(i)return pS(e,t),!0;o=!0,n=!0,a=0;break;case 39:if(s&&s===u)break;if(o)return pS(e,t),!0;i=!0,n=!0,a=1;break}}return!n&&(r===35||r===36||r===59||r===91||r===93||r===95)&&(n=!0),n?(Lr.writeSafe(e,a?'"':"'"),Lr.writeSafe(e,t),Lr.writeSafe(e,a?'" ':"' ")):(Lr.writeSafe(e,t),Lr.writeSafe(e," ")),!1}function pS(e,t){Lr.writeSafe(e,`
;`+t),Lr.writeSafe(e,`
;
`)}function NEe(e){var t=new ArrayBuffer(hS(e)),r=new DataView(t),n=new Uint8Array(t);return mS(e,r,n,0),n}function hS(e){var t=typeof e;if(t==="string"){var r=xC(e);if(r<32)return 1+r;if(r<256)return 2+r;if(r<65536)return 3+r;if(r<4294967296)return 5+r}if(e instanceof Uint8Array){var n=e.byteLength;if(n<256)return 2+n;if(n<65536)return 3+n;if(n<4294967296)return 5+n}if(t==="number"){if(Math.floor(e)!==e)return 9;if(e>=0){if(e<128)return 1;if(e<256)return 2;if(e<65536)return 3;if(e<4294967296)return 5;throw new Error("Number too big 0x"+e.toString(16))}if(e>=-32)return 1;if(e>=-128)return 2;if(e>=-32768)return 3;if(e>=-2147483648)return 5;throw new Error("Number too small -0x"+e.toString(16).substr(1))}if(t==="boolean"||e===null||e===void 0)return 1;if(t==="object"){var a,i=0;if(Array.isArray(e)){a=e.length;for(var o=0;o<a;o++)i+=hS(e[o])}else{var s=Object.keys(e);a=s.length;for(var o=0;o<a;o++){var u=s[o];i+=hS(u)+hS(e[u])}}if(a<16)return 1+i;if(a<65536)return 3+i;if(a<4294967296)return 5+i;throw new Error("Array or object too long 0x"+a.toString(16))}throw new Error("Unknown type "+t)}function mS(e,t,r,n){var a=typeof e;if(a==="string"){var i=xC(e);if(i<32)return t.setUint8(n,i|160),Mv(r,n+1,e),1+i;if(i<256)return t.setUint8(n,217),t.setUint8(n+1,i),Mv(r,n+2,e),2+i;if(i<65536)return t.setUint8(n,218),t.setUint16(n+1,i),Mv(r,n+3,e),3+i;if(i<4294967296)return t.setUint8(n,219),t.setUint32(n+1,i),Mv(r,n+5,e),5+i}if(e instanceof Uint8Array){var o=e.byteLength,s=new Uint8Array(t.buffer);if(o<256)return t.setUint8(n,196),t.setUint8(n+1,o),s.set(e,n+2),2+o;if(o<65536)return t.setUint8(n,197),t.setUint16(n+1,o),s.set(e,n+3),3+o;if(o<4294967296)return t.setUint8(n,198),t.setUint32(n+1,o),s.set(e,n+5),5+o}if(a==="number"){if(!isFinite(e))throw new Error("Number not finite: "+e);if(Math.floor(e)!==e)return t.setUint8(n,203),t.setFloat64(n+1,e),9;if(e>=0){if(e<128)return t.setUint8(n,e),1;if(e<256)return t.setUint8(n,204),t.setUint8(n+1,e),2;if(e<65536)return t.setUint8(n,205),t.setUint16(n+1,e),3;if(e<4294967296)return t.setUint8(n,206),t.setUint32(n+1,e),5;throw new Error("Number too big 0x"+e.toString(16))}if(e>=-32)return t.setInt8(n,e),1;if(e>=-128)return t.setUint8(n,208),t.setInt8(n+1,e),2;if(e>=-32768)return t.setUint8(n,209),t.setInt16(n+1,e),3;if(e>=-2147483648)return t.setUint8(n,210),t.setInt32(n+1,e),5;throw new Error("Number too small -0x"+(-e).toString(16).substr(1))}if(e==null)return t.setUint8(n,192),1;if(a==="boolean")return t.setUint8(n,e?195:194),1;if(a==="object"){var u,l=0,c=Array.isArray(e),d=void 0;if(c?u=e.length:(d=Object.keys(e),u=d.length),u<16?(t.setUint8(n,u|(c?144:128)),l=1):u<65536?(t.setUint8(n,c?220:222),t.setUint16(n+1,u),l=3):u<4294967296&&(t.setUint8(n,c?221:223),t.setUint32(n+1,u),l=5),c)for(var f=0;f<u;f++)l+=mS(e[f],t,r,n+l);else for(var f=0,p=d.length;f<p;f++){var h=d[f];l+=mS(h,t,r,n+l),l+=mS(e[h],t,r,n+l)}return l}throw new Error("Unknown type "+a)}var zEe=function(){function e(t,r,n){this.autoClassify=n,this.dataBlocks=[],this.filter=ps.DefaultFilter,this.formatter=ps.DefaultFormatter,this.isBinary=!0,this.binaryEncodingProvider=void 0,this.binaryEncodingProvider=r,this.data={encoder:t,version:w2e,dataBlocks:this.dataBlocks}}return e.prototype.setFilter=function(t){this.filter=t||ps.DefaultFilter},e.prototype.isCategoryIncluded=function(t){return this.filter.includeCategory(t)},e.prototype.setFormatter=function(t){this.formatter=t||ps.DefaultFormatter},e.prototype.startDataBlock=function(t){this.dataBlocks.push({header:(t||"").replace(/[ \n\t]/g,"").toUpperCase(),categories:[]})},e.prototype.writeCategory=function(t,r,n){if(!this.data)throw new Error("The writer contents have already been encoded, no more writing.");if(!this.dataBlocks.length)throw new Error("No data block created.");if(!(!n?.ignoreFilter&&!this.filter.includeCategory(t.name))){var a=FX(t,r),i=a.instance,o=a.rowCount,s=a.source;if(!!o){for(var u={name:"_"+t.name,columns:[],rowCount:o},l=Ik(i),c=0,d=l;c<d.length;c++){var f=d[c];if(!!this.filter.includeField(t.name,f.name)){var p=this.formatter.getFormat(t.name,f.name);u.columns.push(GEe(t.name,f,s,o,p,this.binaryEncodingProvider,this.autoClassify))}}!u.columns.length||this.dataBlocks[this.dataBlocks.length-1].categories.push(u)}}},e.prototype.encode=function(){this.encodedData||(this.encodedData=NEe(this.data),this.data=null,this.dataBlocks=null)},e.prototype.writeTo=function(t){t.writeBinary(this.encodedData)},e.prototype.getData=function(){return this.encode(),this.encodedData},e.prototype.getSize=function(){return this.encodedData.length},e}();function UEe(e,t){return t&&t.typedArray?t.typedArray:e.defaultFormat&&e.defaultFormat.typedArray?e.defaultFormat.typedArray:e.type===0?Array:e.type===1?Int32Array:Float64Array}function VEe(e){return e===0?gp.by(wr.stringArray):gp.by(wr.byteArray)}function HEe(e,t,r,n){return r&&r.encoder?r.encoder:t.defaultFormat&&t.defaultFormat.encoder?t.defaultFormat.encoder:n?n.get(e,t.name):void 0}function jEe(e,t){return e===0?gp.by(wr.stringArray):e===1?t5(t):P2e(t)}function GEe(e,t,r,n,a,i,o){var s=qEe(t,UEe(t,a),n,r),u=s.array,l=s.allPresent,c=s.mask,d=HEe(e,t,a,i);d||(o?d=jEe(t.type,u):d=VEe(t.type));var f=d.encode(u),p=void 0;if(!l){var h=gp.by(wr.runLength).and(wr.byteArray).encode(c);h.data.length<c.length?p=h:p=gp.by(wr.byteArray).encode(c)}return{name:t.name,data:f,mask:p}}function qEe(e,t,r,n){for(var a=e.type===0,i=new t(r),o=new Uint8Array(r),s=e.valueKind,u=e.value,l=!0,c=0,d=0;d<n.length;d++)for(var f=n[d].data,p=n[d].keys();p.hasNext;){var h=p.move(),m=s?s(h,f):0;m!==0?(o[c]=m,a&&(i[c]=""),l=!1):(o[c]=0,i[c]=u(h,f,c)),c++}return{array:i,allPresent:l,mask:o}}var $a;(function(e){e.Encoder=x5,e.Category=ps,e.Field=b5,e.Encoding=wr;function t(u){var l=u||{},c=l.binary,d=c===void 0?!1:c,f=l.encoderName,p=f===void 0?"mol*":f;return d?new zEe(p,u?u.binaryEncodingPovider:void 0,u?!!u.binaryAutoClassifyEncoding:!1):new IEe}e.createEncoder=t;function r(){return e.Field.build()}e.fields=r;var n=e.Encoding;e.Encodings={deltaRLE:n.by(n.delta).and(n.runLength).and(n.integerPacking),fixedPoint2:n.by(n.fixedPoint(100)).and(n.delta).and(n.integerPacking),fixedPoint3:n.by(n.fixedPoint(1e3)).and(n.delta).and(n.integerPacking)};function a(u,l){return{fields:u,source:[l]}}e.categoryInstance=a;function i(u){return{get:function(l,c){var d=u.categories[l];if(!!d){var f=d.getField(c);return f&&f.binaryEncoding?gp.fromEncoding(f.binaryEncoding):void 0}}}}e.createEncodingProviderFromCifFrame=i;function o(u){return{get:function(l,c){for(var d=0;d<u.length;d++){var f=u[d];if(f.categoryName===l&&f.columnName===c)return s(f)}}}}e.createEncodingProviderFromJsonConfig=o;function s(u){var l=u.precision;if(l!==void 0){var c=Math.pow(10,l),d=n.by(n.fixedPoint(c));switch(u.encoding){case"pack":return d.and(n.integerPacking);case"rle":return d.and(n.runLength).and(n.integerPacking);case"delta":return d.and(n.delta).and(n.integerPacking);case"delta-rle":return d.and(n.delta).and(n.runLength).and(n.integerPacking)}}else switch(u.encoding){case"pack":return n.by(n.integerPacking);case"rle":return n.by(n.runLength).and(n.integerPacking);case"delta":return n.by(n.delta).and(n.integerPacking);case"delta-rle":return n.by(n.delta).and(n.runLength).and(n.integerPacking)}throw new Error("cannot be reached")}})($a||($a={}));var z1;(function(e){e.Descriptor={name:"chem_comp_bond",cifExport:{prefix:"",categories:[{name:"chem_comp_bond",instance:function(a){var i=e.Provider.get(a.firstModel);if(!i)return $a.Category.Empty;var o=i.data;if(!o)return $a.Category.Empty;for(var s=a.structures[0].uniqueResidueNames,u=o.comp_id,l=o._rowCount,c=[],d=0;d<l;d++)s.has(u.value(d))&&(c[c.length]=d);return $a.Category.ofTable(o,c)}}]}},e.Provider=ol.create(e.Descriptor);function t(a,i){return nn.pick(i,Cr.chem_comp_bond,function(o){return a.properties.chemicalComponentMap.has(i.comp_id.value(o))})}e.chemCompBondFromTable=t;function r(a){var i=new Map;function o(C){if(i.has(C))return i.get(C);var w=new n(C);return i.set(C,w),w}for(var s=a.comp_id,u=a.atom_id_1,l=a.atom_id_2,c=a.value_order,d=a.pdbx_aromatic_flag,f=a._rowCount,p=o(s.value(0)),h=0;h<f;h++){var m=s.value(h),v=u.value(h),g=l.value(h),y=c.value(h),b=d.value(h)==="Y";p.id!==m&&(p=o(m));var S=1,x=1;switch(b&&(S|=16),y.toLowerCase()){case"doub":case"delo":x=2;break;case"trip":x=3;break;case"quad":x=4;break}p.add(v,g,x,S)}return i}e.getEntriesFromChemCompBond=r;var n=function(){function a(i){this.id=i,this.map=new Map}return a.prototype.add=function(i,o,s,u,l){l===void 0&&(l=!0);var c=this.map.get(i);if(c!==void 0){var d=c.get(o);d===void 0&&c.set(o,{order:s,flags:u})}else{var f=new Map;f.set(o,{order:s,flags:u}),this.map.set(i,f)}l&&this.add(o,i,s,u,!1)},a}();e.Entry=n})(z1||(z1={}));var oc;(function(e){e.Descriptor={name:"struct_conn",cifExport:{prefix:"",categories:[{name:"struct_conn",instance:function(i){var o=e.Provider.get(i.firstModel);if(!o||o.entries.length===0)return $a.Category.Empty;for(var s=i.structures[0],u=[],l=0,c=o.entries;l<c.length;l++){var d=c[l];r(s,d.partnerA.atomIndex)&&r(s,d.partnerB.atomIndex)&&(u[u.length]=d.rowIndex)}return $a.Category.ofTable(o.data,u)}}]}},e.Provider=ol.create(e.Descriptor);function t(i){var o=e.Provider.get(i);return!!o&&o.data.id.rowCount/i.atomicConformation.atomId.rowCount>.95}e.isExhaustive=t;function r(i,o){for(var s=i.units,u=0,l=s.length;u<l;u++)if(nt.indexOf(s[u].elements,o)>=0)return!0;return!1}function n(i){for(var o=new Map,s=0,u=i;s<u.length;s++){var l=u[s],c=l.partnerA.atomIndex,d=l.partnerB.atomIndex;o.has(c)?o.get(c).push(l):o.set(c,[l]),o.has(d)?o.get(d).push(l):o.set(d,[l])}return o}e.getAtomIndexFromEntries=n;function a(i,o){for(var s=i.conn_type_id,u=i.pdbx_dist_value,l=i.pdbx_value_order,c={label_asym_id:i.ptnr1_label_asym_id,label_seq_id:i.ptnr1_label_seq_id,auth_seq_id:i.ptnr1_auth_seq_id,label_atom_id:i.ptnr1_label_atom_id,label_alt_id:i.pdbx_ptnr1_label_alt_id,ins_code:i.pdbx_ptnr1_PDB_ins_code,symmetry:i.ptnr1_symmetry},d={label_asym_id:i.ptnr2_label_asym_id,label_seq_id:i.ptnr2_label_seq_id,auth_seq_id:i.ptnr2_auth_seq_id,label_atom_id:i.ptnr2_label_atom_id,label_alt_id:i.pdbx_ptnr2_label_alt_id,ins_code:i.pdbx_ptnr2_PDB_ins_code,symmetry:i.ptnr2_symmetry},f=function(x,C){if(C.label_asym_id.valueKind(x)===0){var w=C.label_asym_id.value(x),_=o.atomicHierarchy.index.findEntity(w);if(!(_<0)){var E=o.atomicHierarchy.index.findResidue(o.entities.data.id.value(_),w,C.auth_seq_id.value(x),C.ins_code.value(x));if(!(E<0)){var P=C.label_atom_id.value(x);if(!!P){var D=o.atomicHierarchy.index.findAtomOnResidue(E,P,C.label_alt_id.value(x));if(!(D<0))return{residueIndex:E,atomIndex:D,symmetry:C.symmetry.value(x)}}}}}},p=[],h=0;h<i._rowCount;h++){var m=f(h,c),v=f(h,d);if(!(m===void 0||v===void 0)){var g=s.value(h),y=(l.value(h)||"").toLowerCase(),b=0,S=1;switch(y){case"sing":S=1;break;case"doub":S=2;break;case"trip":S=3;break;case"quad":S=4;break;default:S=BX(i.ptnr1_label_comp_id.value(h),i.ptnr1_label_atom_id.value(h),i.ptnr2_label_comp_id.value(h),i.ptnr2_label_atom_id.value(h))}switch(g){case"covale":b=1;break;case"disulf":b=9;break;case"hydrog":b=4;break;case"metalc":b=2;break}p.push({rowIndex:h,flags:b,order:S,distance:u.value(h),partnerA:m,partnerB:v})}}return p}e.getEntriesFromStructConn=a})(oc||(oc={}));function zX(e,t,r,n,a,i){for(var o=new qo.EdgeBuilder(a,e,t),s=new Uint16Array(o.slotCount),u=new Int8Array(o.slotCount),l=0,c=o.edgeCount;l<c;l++)o.addNextEdge(),o.assignProperty(s,n[l]),o.assignProperty(u,r[l]);return o.createGraph({flags:s,order:u},{canRemap:i})}var $L=A(),QL=A();function WEe(e,t,r){return e.conformation.position(t,$L),e.conformation.position(r,QL),A.distance($L,QL)}var XEe=new Set;function YEe(e){for(var t=Bi.Provider.get(e.model),r=e.elements,n=e.model.atomicHierarchy.atoms.type_symbol,a=e.elements.length,i=t.edgeProps,o=e.model.atomicHierarchy.atomSourceIndex,s=rr.getInvertedAtomSourceIndex(e.model).invertedIndex,u=[],l=[],c=[],d=[],f=0;f<a;f++)for(var p=r[f],h=n.value(p)==="H",m=o.value(p),v=t.offset[m],g=t.offset[m+1];v<g;++v){var y=s[t.b[v]];if(!(p>=y)){var b=nt.indexOf(e.elements,y);if(!(b<0)&&!(h&&n.value(y)==="H")){var S=i.distance[v];(S===-1||S===void 0||Hn(WEe(e,p,y),S,.5))&&(u[u.length]=f,l[l.length]=b,d[d.length]=i.order[v],c[c.length]=i.flag[v])}}}return zX(u,l,d,c,a,!1)}function KEe(e,t){for(var r=4,n=e.model.atomicConformation,a=n.x,i=n.y,o=n.z,s=e.elements.length,u=e.elements,l=e.residueIndex,c=e.chainIndex,d=e.model.atomicHierarchy.atoms,f=d.type_symbol,p=d.label_atom_id,h=d.label_alt_id,m=d.label_comp_id,v=e.model.atomicHierarchy.residues.label_seq_id,g=e.model.atomicHierarchy.index,y=e.model.sequence.byEntityKey,b=e.lookup3d,S=oc.Provider.get(e.model),x=z1.Provider.get(e.model),C=oc.isExhaustive(e.model),w=[],_=[],E=[],P=[],D=-1,k=void 0,F=!0,X=!0,U=!0,j=XEe,te=0;te<s;te++){var q=u[te],W=f.value(q);F&&(W!=="H"||W!=="O")&&(F=!1);var V=t.forceCompute?void 0:S&&S.byAtomIndex.get(q),ee=!1;if(V)for(var ue=0,$=V;ue<$.length;ue++){var Q=$[ue],R=Q.partnerA,Y=Q.partnerB;if(R.symmetry===Y.symmetry){var re=R.atomIndex===q?Y:R,K=nt.indexOf(e.elements,re.atomIndex);K<0||(w[w.length]=te,_[_.length]=K,E[E.length]=Q.flags,P[P.length]=Q.order,ee||j.clear(),ee=!0,j.add(K))}}if(!C){var L=l[q],H=v.value(L),Z=m.value(q);if(!t.forceCompute&&L!==D)if(!!x&&x.entries.has(Z)){var fe=y[g.getEntityFromChain(c[q])];fe&&fe.sequence.microHet.has(H)?k=void 0:k=x.entries.get(Z).map}else k=void 0;D=L;for(var me=g0(W),xe=p.value(q),Se=k?k.get(xe):void 0,ie=b.find(a[q],i[q],o[q],r),le=ie.indices,O=ie.count,G=ie.squaredDistances,ve=N1(me),we=jC(me),Te=h.value(q),Ue=L1.has(me),Ge=0;Ge<O;Ge++){var K=le[Ge];if(!(ee&&j.has(K))){var Je=u[K];if(!(Je<=q)){var st=h.value(Je);if(!(Te&&st&&Te!==st)){var ze=g0(f.value(Je)),et=N1(ze);if(!(ve&&et)){var ut=(Ue||L1.has(ze))&&!(ve||et),pt=l[Je];if(L===pt&&Se){var ht=Se.get(p.value(Je));if(ht){w[w.length]=te,_[_.length]=K,P[P.length]=ht.order;var Re=ht.flags;ut&&(Re|1&&(Re^=1),Re|=2),E[E.length]=Re}continue}var it=Math.sqrt(G[Ge]);if(it!==0){var Fe=OX(me,ze),tt=Fe>0?Fe:ze<0?we:(we+jC(ze))/1.95;if(it<=tt){w[w.length]=te,_[_.length]=K,P[P.length]=_Ee(Z,xe,p.value(Je)),E[E.length]=(ut?2:1)|32;var wt=v.value(pt);H===wt&&(X=!1),Math.abs(H-wt)>1&&(U=!1)}}}}}}}}}var dt=F||X&&U;return zX(w,_,P,E,s,dt)}function $Ee(e,t){var r=T(T({},RX),t);return r.noCompute||rr.isCoarseGrained(e.model)?y5.Empty:!r.forceCompute&&Bi.Provider.get(e.model)?YEe(e):KEe(e,r)}var ty=4,ZL=A(),JL=A();function e7(e,t,r,n){return e.conformation.position(t,ZL),r.conformation.position(n,JL),A.distance(ZL,JL)}var QEe=de(),$p=A();function ZEe(e,t,r,n){var a=e.elements,i=e.residueIndex,o=e.model.atomicConformation,s=o.x,u=o.y,l=o.z,c=t.elements,d=t.residueIndex,f=e.elements.length,p=e.model.atomicHierarchy.atoms,h=p.type_symbol,m=p.label_alt_id,v=p.label_atom_id,g=p.label_comp_id,y=t.model.atomicHierarchy.atoms,b=y.type_symbol,S=y.label_alt_id,x=y.label_atom_id,C=y.label_comp_id,w=e.model.atomicHierarchy.residues.auth_seq_id,_=t.model.atomicHierarchy.residues.auth_seq_id,E=e.model.atomicConformation.occupancy,P=t.model.atomicConformation.occupancy,D=E.isDefined&&P.isDefined,k=e.model===t.model&&oc.Provider.get(e.model),F=!r.forceCompute&&e.model===t.model&&Bi.Provider.get(e.model),X=e.model.atomicHierarchy.atomSourceIndex,U=(F?rr.getInvertedAtomSourceIndex(t.model):{invertedIndex:void 0}).invertedIndex,j=e.model===t.model&&oc.isExhaustive(e.model),te=de.mul(QEe,t.conformation.operator.inverse,e.conformation.operator.matrix),q=!de.isIdentity(te),W=t.boundary.sphere,V=W.center,ee=W.radius,ue=(ee+ty)*(ee+ty);n.startUnitPair(e.id,t.id);for(var $=0;$<f;$++){var Q=a[$];if(A.set($p,s[Q],u[Q],l[Q]),q&&A.transformMat4($p,$p,te),!(A.squaredDistance($p,V)>ue)){if(!r.forceCompute&&F){for(var R=F.edgeProps,Y=R.order,re=R.distance,K=R.flag,L=X.value(Q),H=F.offset[L],Z=F.offset[L+1];H<Z;++H){var fe=U[F.b[H]],me=nt.indexOf(t.elements,fe);if(!(me<0)&&!(h.value(Q)==="H"&&b.value(fe)==="H")){var xe=re[H];xe!==-1&&Hn(e7(e,Q,t,fe),xe,.5)&&n.add($,me,{order:Y[H],flag:K[H]})}}continue}var Se=r.forceCompute?void 0:k&&k.byAtomIndex.get(Q);if(Se&&Se.length){for(var ie=!1,le=0,O=Se;le<O.length;le++){var G=O[le],ve=G.partnerA,we=G.partnerB,Te=ve.atomIndex===Q?we:ve,me=nt.indexOf(t.elements,Te.atomIndex);me<0||e7(e,Q,t,Te.atomIndex)>ty||(n.add($,me,{order:G.order,flag:G.flags}),ie=!0)}if(ie)continue}if(!j){var Ue=E.value(Q),Ge=t.lookup3d,Je=Ge.find($p[0],$p[1],$p[2],ty),st=Je.indices,ze=Je.count,et=Je.squaredDistances;if(ze!==0)for(var ut=g0(h.value(Q)),pt=N1(ut),ht=jC(ut),Re=m.value(Q),it=L1.has(ut),Fe=v.value(Q),tt=g.value(i[Q]),wt=0;wt<ze;wt++){var me=st[wt],fe=c[me],dt=S.value(fe);if(!(Re&&dt&&Re!==dt)&&!(D&&P.value(fe)<1&&Ue<1&&w.value(Q)===_.value(fe))){var Et=g0(b.value(fe)),oe=N1(Et);if(!(pt&&oe)){var ge=(it||L1.has(Et))&&!(pt||oe),Ee=Math.sqrt(et[wt]);if(Ee!==0){var Ze=OX(ut,Et),xt=Ze>0?Ze:Et<0?ht:(ht+jC(Et))/1.95;if(Ee<=xt){var Tt=x.value(fe),Qt=C.value(d[fe]);n.add($,me,{order:BX(tt,Qt,Fe,Tt),flag:(ge?2:1)|32})}}}}}}}}n.finishUnitPair()}function JEe(e,t){var r=new sm.Builder;if(t.noCompute||e.isCoarseGrained)return new Ny(r.getMap());var n=e.models.length===1&&Bi.Provider.get(e.model);if(n){for(var a=n.edgeProps.distance,i=!1,o=0,s=a.length;o<s;++o)if(a[o]!==-1){i=!0;break}if(!i)return new Ny(r.getMap())}return $e.eachUnitPair(e,function(u,l){ZEe(u,l,t,r)},{maxRadius:ty,validUnit:function(u){return We.isAtomic(u)},validUnitPair:function(u,l){return t.validUnitPair(e,u,l)}}),new Ny(r.getMap())}function ePe(e,t){return JEe(e,T(T({},RX),{validUnitPair:t&&t.validUnitPair||function(r,n,a){var i=n.model.atomicHierarchy.derived.residue.moleculeType,o=a.model.atomicHierarchy.derived.residue.moleculeType,s=(!We.isAtomic(n)||i[n.residueIndex[n.elements[0]]]!==2)&&(!We.isAtomic(a)||o[a.residueIndex[a.elements[0]]]!==2);return $e.validUnitPair(r,n,a)&&s}}))}var $t;(function(e){function t(m,v,g,y,b,S){return{kind:"bond-location",aStructure:m,aUnit:v,aIndex:g,bStructure:y,bUnit:b,bIndex:S}}e.Location=t;function r(m){return!!m&&m.kind==="bond-location"}e.isLocation=r;function n(m,v){return m.aStructure.label===v.aStructure.label&&m.bStructure.label===v.bStructure.label&&m.aIndex===v.aIndex&&m.bIndex===v.bIndex&&m.aUnit.id===v.aUnit.id&&m.bUnit.id===v.bUnit.id}e.areLocationsEqual=n;function a(m,v){return{kind:"bond-loci",structure:m,bonds:v}}e.Loci=a;function i(m){return!!m&&m.kind==="bond-loci"}e.isLoci=i;function o(m,v){if(m.structure!==v.structure||m.bonds.length!==v.bonds.length)return!1;for(var g=0,y=m.bonds.length;g<y;++g)if(!n(m.bonds[g],v.bonds[g]))return!1;return!0}e.areLociEqual=o;function s(m){return m.bonds.length===0}e.isLociEmpty=s;function u(m,v){if(v===m.structure)return m;var g=[];return m.bonds.forEach(function(y){var b=v.unitMap.get(y.aUnit.id);if(!!b){var S=v.unitMap.get(y.bUnit.id);if(!!S){var x=y.aUnit.elements[y.aIndex],C=nt.indexOf(b.elements,x);if(C!==-1){var w=y.bUnit.elements[y.bIndex],_=nt.indexOf(S.elements,w);_!==-1&&g.push(t(m.structure,b,C,m.structure,S,_))}}}}),a(v,g)}e.remapLoci=u;function l(m){for(var v=[],g=new Map,y=0,b=m.bonds;y<b.length;y++){var S=b[y],x=S.aIndex,C=S.aUnit,w=S.bIndex,_=S.bUnit;C===_?g.has(C.id)?g.get(C.id).push(x,w):g.set(C.id,[x,w]):(g.has(C.id)?g.get(C.id).push(x):g.set(C.id,[x]),g.has(_.id)?g.get(_.id).push(w):g.set(_.id,[w]))}return g.forEach(function(E,P){v.push({unit:m.structure.unitMap.get(P),indices:nt.deduplicate(nt.ofUnsortedArray(E))})}),Oe(m.structure,v)}e.toStructureElementLoci=l;function c(m,v){if(v.aUnit===v.bUnit){var g=v.aUnit.bonds,y=g.getEdgeIndex(v.aIndex,v.bIndex);return y<0?$r.create(0):$r.create(g.edgeProps.flags[y])}else{var b=m.interUnitBonds.getBondFromLocation(v);return b?$r.create(b.props.flag):$r.create(0)}}e.getType=c;function d(m,v){if(v.aUnit===v.bUnit){var g=v.aUnit.bonds,y=g.getEdgeIndex(v.aIndex,v.bIndex);return y<0?0:g.edgeProps.order[y]}else{var b=m.interUnitBonds.getBondFromLocation(v);return b?b.props.order:0}}e.getOrder=d;function f(m){for(var v=0,g=0,y=m.units.length;g<y;++g){var b=m.units[g];We.isAtomic(b)&&(v+=b.bonds.edgeCount)}return v}e.getIntraUnitBondCount=f;var p=function(){function m(){this.current={},this.hasNext=!1}return m.prototype.move=function(){return this.advance(),this.current},m.prototype.setElement=function(v,g,y){this.structure=v,this.unit=g,this.index=y,this.interBondIndices=v.interUnitBonds.getEdgeIndices(y,g.id),this.interBondCount=this.interBondIndices.length,this.interBondIndex=0,this.intraBondEnd=g.bonds.offset[y+1],this.intraBondIndex=g.bonds.offset[y],this.hasNext=this.interBondIndex<this.interBondCount||this.intraBondIndex<this.intraBondEnd},m.prototype.advance=function(){if(this.intraBondIndex<this.intraBondEnd)this.current.otherUnit=this.unit,this.current.otherIndex=this.unit.bonds.b[this.intraBondIndex],this.current.type=this.unit.bonds.edgeProps.flags[this.intraBondIndex],this.current.order=this.unit.bonds.edgeProps.order[this.intraBondIndex],this.intraBondIndex+=1;else if(this.interBondIndex<this.interBondCount){var v=this.structure.interUnitBonds.edges[this.interBondIndex];this.current.otherUnit=this.structure.unitMap.get(v.unitA!==this.unit.id?v.unitA:v.unitB),this.current.otherIndex=v.indexA!==this.index?v.indexA:v.indexB,this.current.type=v.props.flag,this.current.order=v.props.order,this.interBondIndex+=1}else{this.hasNext=!1;return}this.hasNext=this.interBondIndex<this.interBondCount||this.intraBondIndex<this.intraBondEnd},m}();e.ElementBondIterator=p;function h(m,v){return gd.fromPairProvider(m.bonds.length,function(g,y,b){var S=m.bonds[g],x=S.aUnit,C=S.aIndex,w=S.bUnit,_=S.bIndex;x.conformation.position(x.elements[C],y),w.conformation.position(w.elements[_],b)},v)}e.getBoundingSphere=h})($t||($t={}));function tPe(e){for(var t=nPe(e),r=rPe(e,t),n=pr.transientSegments(e.model.atomicHierarchy.residueAtomSegments,e.elements);n.hasNext;){var a=n.move();aPe(r,a.start,a.end)}return r.rings}function rPe(e,t){return{startVertex:0,endVertex:0,count:0,visited:new Int32Array(t),queue:new Int32Array(t),pred:new Int32Array(t),left:new Int32Array(4),right:new Int32Array(4),color:new Int32Array(t),currentColor:0,currentAltLoc:"",hasAltLoc:!1,rings:[],currentRings:[],unit:e,bonds:e.bonds,altLoc:e.model.atomicHierarchy.atoms.label_alt_id}}function t7(e){e.count=e.endVertex-e.startVertex;for(var t=e.visited,r=e.pred,n=e.color,a=0;a<e.count;a++)t[a]=-1,r[a]=-1,n[a]=0;e.currentColor=0,e.currentAltLoc="",e.hasAltLoc=!1}function nPe(e){for(var t=pr.transientSegments(e.model.atomicHierarchy.residueAtomSegments,e.elements),r=0;t.hasNext;){var n=t.move();r=Math.max(r,n.end-n.start)}return r}function aPe(e,t,r){var n=e.visited;if(e.startVertex=t,e.endVertex=r,!(e.endVertex-e.startVertex<3)){e.currentRings=[];for(var a=e.unit.elements,i=[],o=e.startVertex;o<e.endVertex;o++){var s=e.altLoc.value(a[o]);ho(i,s)}if(Uh(i,""),i.length===0){t7(e);for(var o=0;o<e.count;o++)n[o]>=0||r7(e,o)}else for(var u=0;u<i.length;u++){t7(e),e.hasAltLoc=!0,e.currentAltLoc=i[u];for(var o=0;o<e.count;o++)if(!(n[o]>=0)){var s=e.altLoc.value(a[e.startVertex+o]);s&&s!==e.currentAltLoc||r7(e,o)}}for(var o=0,l=e.currentRings.length;o<l;o++)e.rings.push(e.currentRings[o])}}function iPe(e,t,r){if(!(r<t)){for(var n=e.pred,a=e.color,i=e.left,o=e.right,s=++e.currentColor,u=t,l=0;l<4&&(a[u]=s,u=n[u],!(u<0));l++);var c=0,d=0,f=!1,p=0;u=r;for(var l=0;l<4;l++){if(a[u]===s){p=u,f=!0;break}if(o[d++]=u,u=n[u],u<0)break}if(!!f){u=t;for(var l=0;l<4&&(i[c++]=u,!(p===u||(u=n[u],u<0)));l++);var h=c+d;if(!(h<3)){for(var m=new Int32Array(h),v=0,l=0;l<c;l++)m[v++]=e.startVertex+i[l];for(var l=d-1;l>=0;l--)m[v++]=e.startVertex+o[l];if(Wu(m),e.hasAltLoc)for(var g=0,y=e.currentRings.length;g<y;g++){var b=e.currentRings[g];if(m[0]===b[0]&&m.length===b.length){for(var S=!0,x=0,C=m.length;x<C;x++)if(m[x]!==b[x]){S=!1;break}if(S)return}}e.currentRings.push(nt.ofSortedArray(m))}}}}function r7(e,t){var r=e.bonds,n=e.startVertex,a=e.endVertex,i=e.visited,o=e.queue,s=e.pred,u=e.unit.elements,l=r.b,c=r.edgeProps.flags,d=r.offset;i[t]=1,o[0]=t;for(var f=0,p=1;f<p;)for(var h=o[f++],m=n+h,v=d[m],g=d[m+1],y=v;y<g;y++){var b=l[y];if(!(b<n||b>=a||!$r.isCovalent(c[y]))){if(e.hasAltLoc){var S=e.altLoc.value(u[b]);if(S&&e.currentAltLoc!==S)continue}var x=b-n;if(i[x]>0){s[x]!==h&&s[h]!==x&&iPe(e,h,x);continue}i[x]=1,o[p++]=x,s[x]=h}}}function oPe(e){for(var t=e.length,r=new Array(t),n=0;n<t;n++)r[n]=e[t-n-1];for(var a=n7(e),i=n7(r),o=!1,n=0;n<t;n++){var s=e[(n+a)%t],u=r[(n+i)%t];if(s!==u){o=s<u;break}}return o?a7(e,a):a7(r,i)}function n7(e){for(var t=e.length,r=new Int32Array(t*2),n=0;n<r.length;n++)r[n]=-1;for(var a="",i="",o=0,s=1;s<r.length;s++){for(var n=r[s-o-1];n!==-1&&(a=e[s%t],i=e[(o+n+1)%t],a!==i);)a<i&&(o=s-n-1),n=r[n];n===-1?(a=e[s%t],i=e[(o+n+1)%t],a!==i?(a<i&&(o=s),r[s-o]=-1):r[s-o]=n+1):r[s-o]=n+1}return o}function a7(e,t){var r=e.length,n=[],a;for(a=0;a<r-1;a++)n.push(e[(a+t)%r]),n.push("-");return n.push(e[(a+t)%r]),n.join("")}function sPe(e,t){for(var r=new Map,n=new Map,a=0,i=e.length;a<i;a++)for(var o=e[a],s=0,u=o.length;s<u;s++){var l=o[s];r.has(l)?r.get(l).push(a):r.set(l,[a])}for(var c=0,d=t.length;c<d;c++)for(var a=t[c],o=e[a],s=0,u=o.length;s<u;s++){var l=o[s];n.has(l)?n.get(l).push(a):n.set(l,[a])}for(var f=new qo.UniqueEdgeBuilder(e.length),a=0,i=e.length;a<i;a++)for(var o=e[a],s=0,u=o.length;s<u;s++){var l=o[s],p=r.get(l);if(p.length!==1)for(var h=0,m=p.length;h<m;h++){var v=p[h];a>=v||f.addEdge(a,v)}}for(var g=qo.connectedComponents(f.getGraph()),y=g.componentIndex,b=[],s=0;s<g.componentCount;s++)b[s]=[];for(var a=0,i=e.length;a<i;a++)b[y[a]].push(a);return{elementRingIndices:r,elementAromaticRingIndices:n,ringComponentIndex:y,ringComponents:b}}function uPe(e,t){var r=e.coarseElements.entityKey[t],n=e.model.sequence.byEntityKey[r].sequence,a=e.coarseElements.seq_id_begin.value(t);return n.compId.value(a-1)}function Mk(e,t){switch(e.kind){case 0:return e.model.atomicHierarchy.derived.residue.moleculeType[e.residueIndex[t]];case 1:case 2:var r=uPe(e,t),n=e.model.properties.chemicalComponentMap.get(r);if(n)return H0(n.type,r)}return 0}var lPe=new Set;function Yf(e,t){var r=_Te[e];if(r!==void 0){var n=r[t];if(n!==void 0)return n}return lPe}var i7=A.zero();function UX(e,t){for(var r=e.conformation.position,n=new Float32Array(t.length*3),a=e.elements,i=0,o=t.length;i<o;++i)r(a[t[i]],i7),A.toArray(i7,n,i*3);return n}var kr;(function(e){function t(f,p,h){h===void 0&&(h=Float32Array);var m=f*p;return{data:new h(m),size:m,cols:f,rows:p}}e.create=t;function r(f,p,h){return f.data[f.rows*h+p]}e.get=r;function n(f,p,h,m){return f.data[f.rows*h+p]=m,f}e.set=n;function a(f,p,h,m){return f.data[f.rows*h+p]+=m,f}e.add=a;function i(f){return f.data.fill(0),f}e.makeZero=i;function o(f){return{data:f.data.slice(),size:f.size,cols:f.cols,rows:f.rows}}e.clone=o;function s(f,p,h){return{data:f,size:p*h,cols:p,rows:h}}e.fromArray=s;function u(f,p){if(f.cols!==p.rows||f.rows!==p.cols)throw new Error("transpose: matrix dimensions incompatible");if(f.data===p.data)throw new Error("transpose: matrices share memory");for(var h=p.rows,m=p.cols,v=p.data,g=f.data,y=0,b=0,S=0;y<h;S+=1,b+=m,++y)for(var x=S,C=0;C<m;x+=h,C++)g[x]=v[b+C];return f}e.transpose=u;function l(f,p,h){for(var m=p.cols,v=p.rows,g=h.rows,y=p.data,b=h.data,S=f.data,x=0,C=0,w=0;x<v;C+=m,x++)for(var _=0,E=0;E<g;w++,E++){for(var P=0,D=C,k=0;k<m;D++,_++,k++)P+=y[D]*b[_];S[w]=P}return f}e.multiplyABt=l;function c(f){for(var p=f.rows,h=f.cols,m=f.data,v=new Array(h),g=0;g<h;++g)v[g]=0;for(var y=0,b=0;y<p;++y)for(var g=0;g<h;++g,++b)v[g]+=m[b];for(var g=0;g<h;++g)v[g]/=p;return v}e.meanRows=c;function d(f,p){for(var h=f.rows,m=f.cols,v=f.data,g=0,y=0;g<h;++g)for(var b=0;b<m;++b,++y)v[y]-=p[b];return f}e.subRows=d})(kr||(kr={}));function zA(e,t,r,n){n=e[t],e[t]=e[r],e[r]=n}function cPe(e,t){return e=Math.abs(e),t=Math.abs(t),e>t?(t/=e,e*Math.sqrt(1+t*t)):t>0?(e/=t,t*Math.sqrt(1+e*e)):0}var dPe=1192092896e-16,fPe=1e-37;function pPe(e,t,r,n,a,i,o,s){for(var u=dPe*2,l=fPe,c=0,d=0,f=0,p=0,h=Math.max(i,30),m=0,v=0,g=0,y=0,b=0,S=0,x=0,C=0,w=0,_=0,E=0,P=0,D=0,k=0,F=0,X=0,U=0,j=4660,te=0,q=0,W=0,V=new Float64Array(o<<3);c<o;c++){for(f=0,E=0;f<i;f++)C=e[c*t+f],E+=C*C;if(V[c]=E,n){for(f=0;f<o;f++)n[c*a+f]=0;n[c*a+c]=1}}for(;p<h;p++){for(b=0,c=0;c<o-1;c++)for(d=c+1;d<o;d++){for(m=c*t|0,v=d*t|0,F=V[c],X=0,U=V[d],f=2,X+=e[m]*e[v],X+=e[m+1]*e[v+1];f<i;f++)X+=e[m+f]*e[v+f];if(!(Math.abs(X)<=u*Math.sqrt(F*U))){for(X*=2,P=F-U,D=cPe(X,P),P<0?(k=(D-P)*.5,x=Math.sqrt(k/D),S=X/(D*x*2)):(S=Math.sqrt((D+P)/(D*2)),x=X/(D*S*2)),F=0,U=0,f=2,w=S*e[m]+x*e[v],_=-x*e[m]+S*e[v],e[m]=w,e[v]=_,F+=w*w,U+=_*_,w=S*e[m+1]+x*e[v+1],_=-x*e[m+1]+S*e[v+1],e[m+1]=w,e[v+1]=_,F+=w*w,U+=_*_;f<i;f++)w=S*e[m+f]+x*e[v+f],_=-x*e[m+f]+S*e[v+f],e[m+f]=w,e[v+f]=_,F+=w*w,U+=_*_;if(V[c]=F,V[d]=U,b=1,n)for(g=c*a|0,y=d*a|0,f=2,w=S*n[g]+x*n[y],_=-x*n[g]+S*n[y],n[g]=w,n[y]=_,w=S*n[g+1]+x*n[y+1],_=-x*n[g+1]+S*n[y+1],n[g+1]=w,n[y+1]=_;f<o;f++)w=S*n[g+f]+x*n[y+f],_=-x*n[g+f]+S*n[y+f],n[g+f]=w,n[y+f]=_}}if(b===0)break}for(c=0;c<o;c++){for(f=0,E=0;f<i;f++)C=e[c*t+f],E+=C*C;V[c]=Math.sqrt(E)}for(c=0;c<o-1;c++){for(d=c,f=c+1;f<o;f++)V[d]<V[f]&&(d=f);if(c!==d&&(zA(V,c,d,E),n)){for(f=0;f<i;f++)zA(e,c*t+f,d*t+f,C);for(f=0;f<o;f++)zA(n,c*a+f,d*a+f,C)}}for(c=0;c<o;c++)r[c]=V[c];if(!!n)for(c=0;c<s;c++){for(E=c<o?V[c]:0;E<=l;){for(q=1/i,f=0;f<i;f++)j=j*214013+2531011,te=(j>>16&32767&256)!==0?q:-q,e[c*t+f]=te;for(p=0;p<2;p++)for(d=0;d<c;d++){for(E=0,f=0;f<i;f++)E+=e[c*t+f]*e[d*t+f];for(W=0,f=0;f<i;f++)C=e[c*t+f]-E*e[d*t+f],e[c*t+f]=C,W+=Math.abs(C);for(W=W?1/W:0,f=0;f<i;f++)e[c*t+f]*=W}for(E=0,f=0;f<i;f++)C=e[c*t+f],E+=C*C;E=Math.sqrt(E)}for(x=1/E,f=0;f<i;f++)e[c*t+f]*=x}}function hPe(e,t,r,n){var a=0,i=0,o=e.rows,s=e.cols,u=o,l=s;u<l&&(a=1,i=u,u=l,l=i);var c=kr.create(u,u),d=kr.create(1,l),f=kr.create(l,l);if(a===0)kr.transpose(c,e);else{for(i=0;i<s*o;i++)c.data[i]=e.data[i];for(;i<l*u;i++)c.data[i]=0}if(pPe(c.data,u,d.data,f.data,l,u,l,u),t){for(i=0;i<l;i++)t.data[i]=d.data[i];for(;i<s;i++)t.data[i]=0}a===0?(r&&kr.transpose(r,c),n&&kr.transpose(n,f)):(r&&kr.transpose(r,f),n&&kr.transpose(n,c))}var um;(function(e){function t(u){var l=r(u),c=s(u,l);return{momentsAxes:l,boxAxes:c}}e.ofPositions=t;function r(u){if(u.length===3)return Hu.create(A.fromArray(A(),u,0),A.create(1,0,0),A.create(0,1,0),A.create(0,1,0));var l=kr.fromArray(u,3,u.length/3),c=l.rows,d=c/3,f=kr.create(3,3),p=kr.create(1,3),h=kr.create(3,3),m=kr.create(3,3),v=kr.meanRows(l),g=kr.subRows(kr.clone(l),v),y=kr.transpose(kr.create(c,3),g);kr.multiplyABt(f,y,y),hPe(f,p,h,m);var b=A.create(v[0],v[1],v[2]),S=A.create(h.data[0],h.data[3],h.data[6]),x=A.create(h.data[1],h.data[4],h.data[7]),C=A.create(h.data[2],h.data[5],h.data[8]);return A.scale(S,S,Math.sqrt(p.data[0]/d)),A.scale(x,x,Math.sqrt(p.data[1]/d)),A.scale(C,C,Math.sqrt(p.data[2]/d)),Hu.create(b,S,x,C)}e.calculateMomentsAxes=r;var n=A(),a=A(),i=A(),o=A();function s(u,l){if(u.length===3)return Hu.clone(l);for(var c=-1/0,d=-1/0,f=-1/0,p=-1/0,h=-1/0,m=-1/0,v=A(),g=A(),y=l.origin,b=A.normalize(a,l.dirA),S=A.normalize(i,l.dirB),x=A.normalize(o,l.dirC),C=0,w=u.length;C<w;C+=3){A.projectPointOnVector(v,A.fromArray(v,u,C),b,y);var _=A.dot(b,A.normalize(g,A.sub(g,v,y))),E=A.distance(v,y);_>0?E>c&&(c=E):E>d&&(d=E),A.projectPointOnVector(v,A.fromArray(v,u,C),S,y);var P=A.dot(S,A.normalize(g,A.sub(g,v,y))),D=A.distance(v,y);P>0?D>f&&(f=D):D>p&&(p=D),A.projectPointOnVector(v,A.fromArray(v,u,C),x,y);var k=A.dot(x,A.normalize(g,A.sub(g,v,y))),F=A.distance(v,y);k>0?F>h&&(h=F):F>m&&(m=F)}var X=A.setMagnitude(A(),b,(c+d)/2),U=A.setMagnitude(A(),S,(f+p)/2),j=A.setMagnitude(A(),x,(h+m)/2),te=A(),q=function(W,V,ee){A.copy(n,y),A.scaleAndAdd(n,n,b,W),A.scaleAndAdd(n,n,S,V),A.scaleAndAdd(n,n,x,ee),A.add(te,te,n)};return q(c,f,h),q(c,f,-m),q(c,-p,-m),q(c,-p,h),q(-d,-p,-m),q(-d,-p,h),q(-d,f,h),q(-d,f,-m),A.scale(te,te,1/8),Hu.create(te,X,U,j)}e.calculateBoxAxes=s})(um||(um={}));var GC=function(){function e(t,r){this.unit=r,this.all=t}return Object.defineProperty(e.prototype,"index",{get:function(){return this._index?this._index:(this._index=sPe(this.all,this.aromaticRings),this._index)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"byFingerprint",{get:function(){return this._byFingerprint?this._byFingerprint:(this._byFingerprint=mPe(this.unit,this.all),this._byFingerprint)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"elementRingIndices",{get:function(){return this.index.elementRingIndices},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"elementAromaticRingIndices",{get:function(){return this.index.elementAromaticRingIndices},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ringComponentIndex",{get:function(){return this.index.ringComponentIndex},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ringComponents",{get:function(){return this.index.ringComponents},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"aromaticRings",{get:function(){return this._aromaticRings?this._aromaticRings:(this._aromaticRings=yPe(this.unit,this.all),this._aromaticRings)},enumerable:!1,configurable:!0}),e}(),ru;(function(e){function t(s,u){for(var l=s.elements,c=s.model.atomicHierarchy.atoms.type_symbol,d=[],f=0,p=u.length;f<p;f++)d[d.length]=c.value(l[u[f]]);return r(d)}e.fingerprint=t;function r(s){return oPe(s)}e.elementFingerprint=r;var n=new Set(["B","C","N","O","SI","P","S","GE","AS","SN","SB","BI"]),a=.05;function i(s,u){var l=s.elements,c=s.bonds,d=c.b,f=c.offset,p=c.edgeProps.flags,h=s.model.atomicHierarchy.atoms,m=h.type_symbol,v=h.label_comp_id;if(v.value(s.elements[u[0]])==="PRO")return!1;for(var g=0,y=!1,b=0,S=u.length;b<S;++b){var x=u[b];!y&&n.has(m.value(l[x]))&&(y=!0);for(var C=f[x],w=f[x+1];C<w;++C)$r.is(16,p[C])&&nt.has(u,d[C])&&(g+=1)}if(g===2*u.length)return!0;if(!y)return!1;var _=um.calculateMomentsAxes(UX(s,u));return A.magnitude(_.dirC)<a}e.isAromatic=i;function o(s,u){for(var l=s.model.atomicHierarchy.atoms.label_alt_id,c=s.elements,d=0,f=u.length;d<f;++d){var p=c[u[d]],h=l.value(p);if(h)return h}return""}e.getAltId=o})(ru||(ru={}));(function(e){function t(n){var a=tPe(n);return new e(a,n)}e.create=t;function r(n,a){for(var i=new Map,o=0,s=a.length;o<s;o++){var u=a[o];gPe(n,u,i)}return i}e.byFingerprintAndResidue=r})(GC||(GC={}));function mPe(e,t){for(var r=new Map,n=0,a=0,i=t.length;a<i;a++){var o=t[a],s=ru.fingerprint(e,o);r.has(s)?r.get(s).push(n):r.set(s,[n]),n++}return r}function vPe(e,t){for(var r=e.elements,n=e.model.atomicHierarchy.residueAtomSegments.index,a=n[r[t[0]]],i=1,o=t.length;i<o;i++)if(a!==n[r[t[i]]])return-1;return a}function gPe(e,t,r){var n=e.byFingerprint.get(t);if(!!n)for(var a=0,i=n.length;a<i;a++){var o=n[a],s=vPe(e.unit,e.all[o]);s>=0&&(r.has(s)?r.get(s).push(o):r.set(s,[o]))}}function yPe(e,t){for(var r=[],n=0,a=t.length;n<a;++n)ru.isAromatic(e,t[n])&&r.push(n);return r}var In;(function(e){function t(S){return nt.ofSortedArray(S)}e.ofSortedRanges=t;function r(S){return S[0]}e.start=r;function n(S){return S[S.length-1]+1}e.end=n;function a(S){return S[0]}e.min=a;function i(S){return S[S.length-1]}e.max=i;function o(S){for(var x=0,C=0,w=S.length;C<w;C+=2)x+=S[C+1]-S[C]+1;return x}e.size=o;function s(S){return S.length/2}e.count=s;function u(S,x){return S[x*2]}e.startAt=u;function l(S,x){return S[x*2+1]+1}e.endAt=l;function c(S,x){return S[x*2]}e.minAt=c;function d(S,x){return S[x*2+1]}e.maxAt=d;function f(S,x){if(S.length!==x.length)return!1;for(var C=0,w=S.length;C<w;++C)if(S[C]!==x[C])return!1;return!0}e.areEqual=f;function p(S,x){for(var C=0,w=0,_=S.length;w<_;w+=2)for(var E=S[w],P=S[w+1];E<=P;++E)x(E,C),++C}e.forEach=p;function h(S,x){return v(S,x)!==-1}e.has=h;function m(S,x,C){return g(S,x,C)!==-1}e.hasFrom=m;function v(S,x){return g(S,x,0)}e.firstIntersectionIndex=v;function g(S,x,C){if(c(S,C)>Ne.max(x)||i(S)<Ne.min(x))return-1;for(var w=C,_=s(S);w<_;++w){var E=Me.ofRange(c(S,w),d(S,w));if(Ne.areIntersecting(E,x))return w}return-1}e.firstIntersectionIndexFrom=g;function y(S,x){return new b(S,x)}e.transientSegments=y;var b=function(){function S(x,C){this.ranges=x,this.set=C,this.value={index:0,start:0,end:0},this.curIndex=0,this.hasNext=!1,this.curIndex=v(x,C),this.hasNext=this.curIndex!==-1}return S.prototype.updateValue=function(){this.value.index=this.curIndex,this.value.start=Ne.findPredecessorIndex(this.set,u(this.ranges,this.curIndex)),this.value.end=Ne.findPredecessorIndex(this.set,l(this.ranges,this.curIndex))},S.prototype.move=function(){return this.hasNext&&(this.updateValue(),this.curIndex=g(this.ranges,this.set,this.curIndex+1),this.hasNext=this.curIndex!==-1),this.value},S}();e.Iterator=b})(In||(In={}));function bPe(e){for(var t=[],r=e.elements,n=e.model,a=e.model.atomicHierarchy.residueAtomSegments,i=n.atomicHierarchy.derived.residue.traceElementIndex,o=In.transientSegments(e.model.atomicRanges.polymerRanges,r),s=pr.transientSegments(a,r);o.hasNext;){var u=o.move();for(s.setSegment(u);s.hasNext;){var l=s.move(),c=l.start,d=l.end,f=l.index;if(Ne.areIntersecting(Me.ofRange(r[c],r[d-1]),r)){var p=i[f];t.push(p===-1?a.offsets[f]:p)}}}return nt.ofSortedArray(t)}function xPe(e){for(var t=[],r=e.elements,n=e.model,a=n.coarseHierarchy,i=a.spheres,o=a.gaussians,s=We.isSpheres(e)?i.polymerRanges:o.polymerRanges,u=In.transientSegments(s,r);u.hasNext;)for(var l=u.move(),c=l.start,d=l.end,f=c;f<d;++f)t.push(r[f]);return nt.ofSortedArray(t)}function SPe(e){for(var t=[],r=e.elements,n=e.model,a=e.residueIndex,i=e.model.atomicHierarchy.residueAtomSegments,o=n.atomicHierarchy.derived.residue.traceElementIndex,s=In.transientSegments(e.model.atomicRanges.gapRanges,e.elements);s.hasNext;){var u=s.move(),l=a[r[u.start]],c=a[r[u.end-1]],d=o[l],f=o[c];t.push(d===-1?i.offsets[l]:d),t.push(f===-1?i.offsets[c]:f)}return nt.ofSortedArray(t)}function CPe(e){for(var t=[],r=e.elements,n=e.model,a=n.coarseHierarchy,i=a.spheres,o=a.gaussians,s=We.isSpheres(e)?i.gapRanges:o.gapRanges,u=In.transientSegments(s,r);u.hasNext;){var l=u.move(),c=l.start,d=l.end;t.push(r[c],r[d-1])}return nt.ofSortedArray(t)}function wPe(e){for(var t=[],r=e.elements,n=e.model,a=n.atomicHierarchy,i=a.chainAtomSegments,o=a.residueAtomSegments,s=n.atomicHierarchy.derived.residue,u=s.moleculeType,l=s.traceElementIndex,c=pr.transientSegments(i,r),d=pr.transientSegments(o,r);c.hasNext;)for(d.setSegment(c.move());d.hasNext;){var f=d.move().index;if(kp(u[f])){var p=l[f];t.push(p===-1?o.offsets[f]:p)}}return nt.ofSortedArray(t)}function _Pe(e){for(var t=[],r=e.elements,n=e.model,a=n.atomicHierarchy,i=a.chainAtomSegments,o=a.residueAtomSegments,s=n.atomicHierarchy.derived.residue,u=s.moleculeType,l=s.traceElementIndex,c=pr.transientSegments(i,r),d=pr.transientSegments(o,r);c.hasNext;)for(d.setSegment(c.move());d.hasNext;){var f=d.move().index;if(TX(u[f])){var p=l[f];t.push(p===-1?o.offsets[f]:p)}}return nt.ofSortedArray(t)}var o7=A.zero();function APe(e){for(var t=e.conformation.invariantPosition,r=e.elements,n=new Float32Array(r.length*3),a=0,i=r.length;a<i;a++)t(r[a],o7),A.toArray(o7,n,a*3);return n}function s7(e){var t=APe(e);return um.ofPositions(t)}var u7=A.set,TPe=new Ms("14"),EPe=new Ms("98");function PPe(e){return e>1e4?TPe:EPe}var X2=A();function y0(e){var t=e.x,r=e.y,n=e.z,a=e.radius,i=e.indices,o=Ne.size(i);if(o>25e4){var s=tr.computeBounding(e);return{box:s,sphere:He.fromBox3D(He(),s)}}var u=PPe(o);u.reset();for(var l=0;l<o;l++){var c=Ne.getAt(i,l);u7(X2,t[c],r[c],n[c]),u.includePositionRadius(X2,a&&a[c]||0)}u.finishedIncludeStep();for(var l=0;l<o;l++){var c=Ne.getAt(i,l);u7(X2,t[c],r[c],n[c]),u.radiusPositionRadius(X2,a&&a[c]||0)}var d=u.getSphere();if(!a&&He.hasExtrema(d)&&o<=d.extrema.length){for(var f=[],l=0;l<o;l++){var c=Ne.getAt(i,l);f.push(A.create(t[c],r[c],n[c]))}He.setExtrema(d,f)}return{box:u.getBox(),sphere:d}}var IPe=function(){function e(){this.data=new Map}return e.prototype.get=function(t){var r=nt.hashCode(t);if(!!this.data.has(r))for(var n=0,a=this.data.get(r);n<a.length;n++){var i=a[n],o=i[0],s=i[1];if(nt.areEqual(t,o))return s}},e.prototype.set=function(t,r){var n=nt.hashCode(t);if(this.data.has(n)){for(var a=this.data.get(n),i=0,o=a;i<o.length;i++){var s=o[i];if(nt.areEqual(t,s[0])){s[1]=r;return}}a.push([t,r])}else this.data.set(n,[[t,r]])},e.get=function(t){return t._dynamicPropertyData.ElementSetIntraBondCache||(t._dynamicPropertyData.ElementSetIntraBondCache=new e),t._dynamicPropertyData.ElementSetIntraBondCache},e}(),We;(function(e){function t(U){return U.kind===0}e.isAtomic=t;function r(U){return U.kind===1||U.kind===2}e.isCoarse=r;function n(U){return U.kind===1}e.isSpheres=n;function a(U){return U.kind===2}e.isGaussians=a;function i(U,j,te,q,W,V,ee,ue,$){switch(W){case 0:return new h(U,j,te,q,V,ue,An.createMapping(ee,V.atomicConformation,void 0),$??m());case 1:return x(U,j,te,q,V,1,ue,An.createMapping(ee,V.coarseConformation.spheres,f(V)),$??y());case 2:return x(U,j,te,q,V,2,ue,An.createMapping(ee,V.coarseConformation.gaussians,p()),$??y())}}e.create=i;function o(U){for(var j=hu.Mutable(),te=0,q=U.length;te<q;te++)j.set(U[te].id,te);return j}function s(U){for(var j=[],te=0,q=U.length;te<q;te++)j.push(U[te].id);return eo(j)}function u(U){var j={};return{elements:U[0].elements,units:U,get unitIndexMap(){return j.unitIndexMap||(j.unitIndexMap=o(U)),j.unitIndexMap},hashCode:c(U[0]),transformHash:s(U)}}e.SymmetryGroup=u,function(U){function j(q,W){return q.hashCode!==W.hashCode?!1:nt.areEqual(q.elements,W.elements)}U.areInvariantElementsEqual=j;function te(q){for(var W=hu.Mutable(),V=0,ee=q.length;V<ee;++V)for(var ue=q[V],$=0,Q=ue.units.length;$<Q;++$)W.set(ue.units[$].id,V);return W}U.getUnitSymmetryGroupsIndexMap=te}(u=e.SymmetryGroup||(e.SymmetryGroup={}));function l(U){return e.isAtomic(U)?U.model.atomicConformation.id:U.model.coarseConformation.id}e.conformationId=l;function c(U){return wm(U.invariantId,nt.hashCode(U.elements))}e.hashUnit=c,function(U){U.is=Oi.has,U.create=Oi.create}(e.Traits||(e.Traits={}));function d(){return{}}function f(U){var j=U.coarseConformation.spheres.radius;return function(te){return j[te]}}function p(U){return function(j){return 0}}var h=function(){function U(j,te,q,W,V,ee,ue,$){this.kind=0,this.objectPrimitive="atomistic",this.id=j,this.invariantId=te,this.chainGroupId=q,this.traits=W,this.model=V,this.elements=ee,this.conformation=ue,this.residueIndex=V.atomicHierarchy.residueAtomSegments.index,this.chainIndex=V.atomicHierarchy.chainAtomSegments.index,this.props=$}return U.prototype.getChild=function(j){return j.length===this.elements.length?this:new U(this.id,this.invariantId,this.chainGroupId,this.traits,this.model,j,this.conformation,m())},U.prototype.applyOperator=function(j,te,q){q===void 0&&(q=!1);var W=q?te:An.compose(this.conformation.operator,te);return new U(j,this.invariantId,this.chainGroupId,this.traits,this.model,this.elements,An.createMapping(W,this.model.atomicConformation,this.conformation.r),this.props)},U.prototype.remapModel=function(j,te){te||(te=T(T({},this.props),{bonds:E(this,this.props.bonds,j)}),e.isSameConformation(this,j)||(te.boundary=void 0,te.lookup3d=void 0,te.principalAxes=void 0));var q=this.conformation.operator,W=wa.Provider.get(j);if(q.spgrOp!==-1&&W&&W!==wa.Provider.get(this.model)){var V=q.hkl,ee=V[0],ue=V[1],$=V[2],Q=W.spacegroup.cell.toFractional,R=A.transformMat4(A(),rr.getCenter(j),Q);q=al.getSymmetryOperatorRef(W.spacegroup,q.spgrOp,ee,ue,$,R)}var Y=this.model.atomicConformation!==j.atomicConformation||q!==this.conformation.operator?An.createMapping(q,j.atomicConformation):this.conformation;return new U(this.id,this.invariantId,this.chainGroupId,this.traits,j,this.elements,Y,te)},Object.defineProperty(U.prototype,"boundary",{get:function(){if(this.props.boundary)return this.props.boundary;var j=this.model.atomicConformation,te=j.x,q=j.y,W=j.z;return this.props.boundary=y0({x:te,y:q,z:W,indices:this.elements}),this.props.boundary},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"lookup3d",{get:function(){if(this.props.lookup3d)return this.props.lookup3d;var j=this.model.atomicConformation,te=j.x,q=j.y,W=j.z;return this.props.lookup3d=nm({x:te,y:q,z:W,indices:this.elements},this.boundary),this.props.lookup3d},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"principalAxes",{get:function(){return this.props.principalAxes?this.props.principalAxes:(this.props.principalAxes=s7(this),this.props.principalAxes)},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"bonds",{get:function(){if(this.props.bonds)return this.props.bonds;var j=IPe.get(this.model),te=j.get(this.elements);return te||(te=$Ee(this),j.set(this.elements,te)),this.props.bonds=te,this.props.bonds},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"rings",{get:function(){return this.props.rings?this.props.rings:(this.props.rings=GC.create(this),this.props.rings)},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"polymerElements",{get:function(){return this.props.polymerElements?this.props.polymerElements:(this.props.polymerElements=bPe(this),this.props.polymerElements)},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"gapElements",{get:function(){return this.props.gapElements?this.props.gapElements:(this.props.gapElements=SPe(this),this.props.gapElements)},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"nucleotideElements",{get:function(){return this.props.nucleotideElements?this.props.nucleotideElements:(this.props.nucleotideElements=wPe(this),this.props.nucleotideElements)},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"proteinElements",{get:function(){return this.props.proteinElements?this.props.proteinElements:(this.props.proteinElements=_Pe(this),this.props.proteinElements)},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"residueCount",{get:function(){if(this.props.residueCount!==void 0)return this.props.residueCount;for(var j=0,te=pr.transientSegments(this.model.atomicHierarchy.residueAtomSegments,this.elements);te.hasNext;)te.move(),j+=1;return this.props.residueCount=j,this.props.residueCount},enumerable:!1,configurable:!0}),U.prototype.getResidueIndex=function(j){return this.residueIndex[this.elements[j]]},U}();e.Atomic=h;function m(){return d()}var v=function(){function U(j,te,q,W,V,ee,ue,$,Q){this.kind=ee,this.objectPrimitive=ee===1?"sphere":"gaussian",this.id=j,this.invariantId=te,this.chainGroupId=q,this.traits=W,this.model=V,this.elements=ue,this.conformation=$,this.coarseElements=ee===1?V.coarseHierarchy.spheres:V.coarseHierarchy.gaussians,this.coarseConformation=ee===1?V.coarseConformation.spheres:V.coarseConformation.gaussians,this.props=Q}return U.prototype.getChild=function(j){return j.length===this.elements.length?this:x(this.id,this.invariantId,this.chainGroupId,this.traits,this.model,this.kind,j,this.conformation,y())},U.prototype.applyOperator=function(j,te,q){q===void 0&&(q=!1);var W=q?te:An.compose(this.conformation.operator,te);return x(j,this.invariantId,this.chainGroupId,this.traits,this.model,this.kind,this.elements,An.createMapping(W,this.getCoarseConformation(),this.conformation.r),this.props)},U.prototype.remapModel=function(j,te){var q=this.getCoarseConformation(),W=g(this.kind,j);te||(te=T({},this.props),e.isSameConformation(this,j)||(te.boundary=void 0,te.lookup3d=void 0,te.principalAxes=void 0));var V=q!==W?An.createMapping(this.conformation.operator,W):this.conformation;return new U(this.id,this.invariantId,this.chainGroupId,this.traits,j,this.kind,this.elements,V,te)},Object.defineProperty(U.prototype,"boundary",{get:function(){if(this.props.boundary)return this.props.boundary;var j=this.getCoarseConformation(),te=j.x,q=j.y,W=j.z;return this.props.boundary=y0({x:te,y:q,z:W,indices:this.elements}),this.props.boundary},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"lookup3d",{get:function(){if(this.props.lookup3d)return this.props.lookup3d;var j=this.getCoarseConformation(),te=j.x,q=j.y,W=j.z;return this.props.lookup3d=nm({x:te,y:q,z:W,indices:this.elements},this.boundary),this.props.lookup3d},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"principalAxes",{get:function(){return this.props.principalAxes?this.props.principalAxes:(this.props.principalAxes=s7(this),this.props.principalAxes)},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"polymerElements",{get:function(){return this.props.polymerElements?this.props.polymerElements:(this.props.polymerElements=xPe(this),this.props.polymerElements)},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"gapElements",{get:function(){return this.props.gapElements?this.props.gapElements:(this.props.gapElements=CPe(this),this.props.gapElements)},enumerable:!1,configurable:!0}),U.prototype.getCoarseConformation=function(){return g(this.kind,this.model)},U}();function g(U,j){return U===1?j.coarseConformation.spheres:j.coarseConformation.gaussians}function y(){return d()}var b=function(U){Le(j,U);function j(){return U!==null&&U.apply(this,arguments)||this}return j}(v);e.Spheres=b;var S=function(U){Le(j,U);function j(){return U!==null&&U.apply(this,arguments)||this}return j}(v);e.Gaussians=S;function x(U,j,te,q,W,V,ee,ue,$){return new v(U,j,te,q,W,V,ee,ue,$)}function C(U,j){return U.chainGroupId===j.chainGroupId&&U.conformation.operator.name===j.conformation.operator.name}e.areSameChainOperatorGroup=C;function w(U,j){return de.areEqual(U.conformation.operator.matrix,j.conformation.operator.matrix,1e-6)}e.areOperatorsEqual=w;function _(U,j){return nt.areEqual(U.elements,j.elements)?P(U,j.model):!1}e.areConformationsEqual=_;function E(U,j,te){var q;if(!!j){if(U.model.atomicConformation.id===te.atomicConformation.id)return j;var W=Bi.Provider.get(U.model);if(W){var V=Bi.Provider.get(te);return!V||W===V?j:void 0}return!((q=j.props)===null||q===void 0)&&q.canRemap||P(U,te)?j:void 0}}function P(U,j){var te=rr.CoordinatesHistory.get(rr.getRoot(j));if(te)return te.areEqual(U.elements,U.kind,j);for(var q=U.elements,W=U.conformation.coordinates,V=W.x,ee=W.y,ue=W.z,$=D(U.kind,j),Q=$.x,R=$.y,Y=$.z,re=0,K=q.length;re<K;re++){var L=q[re];if(V[L]!==Q[L]||ee[L]!==R[L]||ue[L]!==Y[L])return!1}return!0}e.isSameConformation=P;function D(U,j){return U===0?j.atomicConformation:U===1?j.coarseConformation.spheres:j.coarseConformation.gaussians}e.getModelConformationOfKind=D;function k(U){return D(U.kind,U.model)}e.getConformation=k;function F(U,j){return U===0?j.atomicHierarchy:U===1?j.coarseHierarchy.spheres:j.coarseHierarchy.gaussians}e.getModelHierarchyOfKind=F;function X(U){return F(U.kind,U.model)}e.getHierarchy=X})(We||(We={}));var qC;(function(e){function t(a,i,o,s){a.indices[a.count]=o,a.units[a.count]=i,a.squaredDistances[a.count]=s,a.count++}e.add=t;function r(){return{count:0,indices:[],units:[],squaredDistances:[]}}e.create=r;function n(a,i){for(var o=0;o<i.count;++o)a.indices[o]=i.indices[o],a.units[o]=i.units[o],a.squaredDistances[o]=i.squaredDistances[o];return a.count=i.count,a}e.copy=n})(qC||(qC={}));function VX(){return{result:qC.create(),closeUnitsResult:bp.create(),unitGroupResult:bp.create()}}var MPe=function(){function e(t){this.structure=t,this.pivot=A(),this.findContext=VX();for(var r=t.units,n=t.boundary,a=r.length,i=new Float32Array(a),o=new Float32Array(a),s=new Float32Array(a),u=new Float32Array(a),l=A(),c=0;c<a;c++){var d=r[c],f=d.boundary.sphere;A.transformMat4(l,f.center,d.conformation.operator.matrix),i[c]=l[0],o[c]=l[1],s[c]=l[2],u[c]=f.radius}var p={x:i,y:o,z:s,radius:u,indices:Ne.ofBounds(0,a)};this.unitLookup=nm(p,n)}return e.prototype.findUnitIndices=function(t,r,n,a){return this.unitLookup.find(t,r,n,a)},e.prototype.find=function(t,r,n,a,i){return this._find(t,r,n,a,i??this.findContext)},e.prototype._find=function(t,r,n,a,i){bp.reset(i.result);var o=this.structure.units,s=this.unitLookup.find(t,r,n,a,i.closeUnitsResult);if(s.count===0)return i.result;for(var u=0,l=s.count;u<l;u++){var c=o[s.indices[u]];A.set(this.pivot,t,r,n),c.conformation.operator.isIdentity||A.transformMat4(this.pivot,this.pivot,c.conformation.operator.inverse);for(var d=c.lookup3d,f=d.find(this.pivot[0],this.pivot[1],this.pivot[2],a,i.unitGroupResult),p=0,h=f.count;p<h;p++)qC.add(i.result,c,f.indices[p],f.squaredDistances[p])}return i.result},e.prototype.findIntoBuilder=function(t,r,n,a,i){var o=this.structure.units,s=this.unitLookup.find(t,r,n,a);if(s.count!==0)for(var u=0,l=s.count;u<l;u++){var c=o[s.indices[u]];A.set(this.pivot,t,r,n),c.conformation.operator.isIdentity||A.transformMat4(this.pivot,this.pivot,c.conformation.operator.inverse);var d=c.lookup3d,f=d.find(this.pivot[0],this.pivot[1],this.pivot[2],a);if(f.count!==0){var p=c.elements;i.beginUnit(c.id);for(var h=0,m=f.count;h<m;h++)i.addElement(p[f.indices[h]]);i.commitUnit()}}},e.prototype.findIntoBuilderIf=function(t,r,n,a,i,o){var s=this.structure.units,u=this.unitLookup.find(t,r,n,a);if(u.count!==0)for(var l=ot.create(this.structure),c=0,d=u.count;c<d;c++){var f=s[u.indices[c]];A.set(this.pivot,t,r,n),f.conformation.operator.isIdentity||A.transformMat4(this.pivot,this.pivot,f.conformation.operator.inverse);var p=f.lookup3d,h=p.find(this.pivot[0],this.pivot[1],this.pivot[2],a);if(h.count!==0){var m=f.elements;l.unit=f,i.beginUnit(f.id);for(var v=0,g=h.count;v<g;v++)l.element=m[h.indices[v]],o(l)&&i.addElement(l.element);i.commitUnit()}}},e.prototype.findIntoBuilderWithRadius=function(t,r,n,a,i,o,s,u){var l=this.structure.units,c=this.unitLookup.find(t,r,n,o);if(c.count!==0)for(var d=ot.create(this.structure),f=a+i+o,p=0,h=c.count;p<h;p++){var m=l[c.indices[p]];A.set(this.pivot,t,r,n),m.conformation.operator.isIdentity||A.transformMat4(this.pivot,this.pivot,m.conformation.operator.inverse);var v=m.lookup3d,g=v.find(this.pivot[0],this.pivot[1],this.pivot[2],f);if(g.count!==0){var y=m.elements;d.unit=m,u.beginUnit(m.id);for(var b=0,S=g.count;b<S;b++){d.element=y[g.indices[b]];var x=s(d);Math.sqrt(g.squaredDistances[b])-a-x>o||u.addElement(y[g.indices[b]])}u.commitUnit()}}},e.prototype.check=function(t,r,n,a){var i=this.structure.units,o=this.unitLookup.find(t,r,n,a);if(o.count===0)return!1;for(var s=0,u=o.count;s<u;s++){var l=i[o.indices[s]];A.set(this.pivot,t,r,n),l.conformation.operator.isIdentity||A.transformMat4(this.pivot,this.pivot,l.conformation.operator.inverse);var c=l.lookup3d;if(c.check(this.pivot[0],this.pivot[1],this.pivot[2],a))return!0}return!1},Object.defineProperty(e.prototype,"boundary",{get:function(){return this.structure.boundary},enumerable:!1,configurable:!0}),e}();function U1(e,t){if(t.length===0)return $e.Empty;if(t.length===1)return t[0];for(var r=new Map,n=new Set,a=0,i=t;a<i.length;a++)for(var o=i[a].units,s=0,u=o.length;s<u;s++){var l=o[s];if(r.has(l.id)){if(n.has(l.id))continue;var c=nt.union(r.get(l.id),l.elements);r.set(l.id,c),c.length===e.unitMap.get(l.id).elements.length&&n.add(l.id)}else r.set(l.id,l.elements),l.elements.length===e.unitMap.get(l.id).elements.length&&n.add(l.id)}var d=e.subsetBuilder(!0);return r.forEach(DPe,d),d.getStructure()}function DPe(e,t){this.setUnit(t,e)}function kPe(e,t){if(e===t)return!0;if(e.units.length!==t.units.length)return!1;for(var r=e.units,n=t.unitMap,a=0,i=r.length;a<i;a++){var o=r[a];if(!n.has(o.id))return!1;var s=n.get(o.id);if(!nt.areEqual(o.elements,s.elements))return!1}return!0}function i_(e,t){if(e===t)return!0;var r,n;e.units.length<t.units.length?(r=e,n=t):(r=t,n=e);for(var a=r.units,i=n.unitMap,o=0,s=a.length;o<s;o++){var u=a[o];if(!!i.has(u.id)){var l=i.get(u.id);if(nt.areIntersecting(u.elements,l.elements))return!0}}return!1}function HX(e,t){if(e===t)return e;if(!i_(e,t))return $e.Empty;var r,n;e.units.length<t.units.length?(r=e,n=t):(r=t,n=e);for(var a=r.units,i=n.unitMap,o=[],s=0,u=a.length;s<u;s++){var l=a[s];if(!!i.has(l.id)){var c=i.get(l.id);if(nt.areIntersecting(l.elements,c.elements)){var d=nt.intersect(l.elements,c.elements);o[o.length]=l.getChild(d)}}}return $e.create(o,{parent:e.parent||t.parent})}function Dk(e,t){if(e===t)return $e.Empty;if(!i_(e,t))return e;for(var r=e.units,n=t.unitMap,a=[],i=0,o=r.length;i<o;i++){var s=r[i];if(!n.has(s.id)){a[a.length]=s;continue}var u=n.get(s.id),l=nt.subtract(s.elements,u.elements);l.length>0&&(a[a.length]=s.getChild(l))}return $e.create(a,{parent:e.parent||t.parent})}var St;(function(e){function t(g,y){return{kind:"singletons",source:g,structure:y}}e.Singletons=t;function r(g,y){return{kind:"sequence",source:g,structures:y}}e.Sequence=r;function n(g){return t(g,$e.Empty)}e.Empty=n;function a(g){return g.kind==="singletons"}e.isSingleton=a;function i(g){return a(g)?g.structure.units.length===0:g.structures.length===0}e.isEmpty=i;function o(g){return a(g)?g.structure.elementCount:g.structures.length}e.structureCount=o;function s(g){return i(g)?$e.Empty:a(g)?g.structure:U1(g.source,g.structures)}e.unionStructure=s;function u(g){for(var y=[],b=g.source.unitMap,S=0,x=s(g).units;S<x.length;S++){var C=x[S];C===b.get(C.id)?y[y.length]={unit:C,indices:Ne.ofBounds(0,C.elements.length)}:y[y.length]={unit:C,indices:Ne.ofSortedArray(nt.indicesOf(b.get(C.id).elements,C.elements))}}return Oe(g.source,y)}e.toLociWithCurrentUnits=u;function l(g){for(var y=[],b=g.source.unitMap,S=0,x=s(g).units;S<x.length;S++){var C=x[S],w=b.get(C.id);w===C?y[y.length]={unit:w,indices:Ne.ofBounds(0,w.elements.length)}:y[y.length]={unit:w,indices:Ne.ofSortedArray(nt.indicesOf(w.elements,C.elements))}}return Oe(g.source,y)}e.toLociWithSourceUnits=l;function c(g,y,b){var S=y.length;return S===0?n(g):b?t(g,U1(g,y)):r(g,y)}var d=function(){function g(y){this.source=y,this.structures=[],this.allSingletons=!0}return g.prototype.add=function(y){var b=y.elementCount;b!==0&&(this.structures[this.structures.length]=y,b!==1&&(this.allSingletons=!1))},g.prototype.getSelection=function(){return c(this.source,this.structures,this.allSingletons)},g}(),f=function(){function g(y){this.structure=y,this.structures=[],this.allSingletons=!0,this.uniqueSets=tk($e.hashCode,$e.areUnitIdsAndIndicesEqual)}return g.prototype.add=function(y){var b=y.elementCount;b===0||!this.uniqueSets.add(y)||(this.structures[this.structures.length]=y,b!==1&&(this.allSingletons=!1))},g.prototype.getSelection=function(){return c(this.structure,this.structures,this.allSingletons)},g}();function p(g){return new d(g)}e.LinearBuilder=p;function h(g){return new f(g)}e.UniqueBuilder=h;function m(g,y){var b=0;if(e.isSingleton(g))for(var S=0,x=g.structure.units;S<x.length;S++)for(var C=x[S],w=C.elements,_=0,E=w.length;_<E;_++){var P=$e.create([C.getChild(nt.ofSingleton(w[_]))],{parent:g.source});y(P,b++)}else for(var D=0,k=g.structures;D<k.length;D++){var P=k[D];y(P,b++)}}e.forEach=m;function v(g,y){return a(g)?t(y,g.structure):r(y,g.structures)}e.withInputStructure=v})(St||(St={}));var sn;(function(e){e.Empty={hash:-1,elements:[]};function t(c,d){return n(St.toLociWithSourceUnits(St.Singletons(c,d)))}e.fromSubStructure=t;function r(c){return n(St.toLociWithSourceUnits(c))}e.fromSelection=r;function n(c){for(var d=[],f=0,p=c.elements;f<p.length;f++){var h=p[f],m=h.unit,v=h.indices;if(Ne.size(v)!==0){var g=[],y=[];if(Ne.isInterval(v))Ne.size(v)===1?y.push(Me.min(v)):g.push(Me.min(v),Me.max(v));else for(var b=0,S=v.length;b<S;){var x=b;for(b++;b<S&&v[b-1]+1===v[b];)b++;var C=b;if(C-x>2)g.push(v[x],v[C-1]);else for(var w=x;w<C;w++)y[y.length]=v[w]}d.push({unit:m,set:nt.ofSortedArray(y),ranges:In.ofSortedRanges(g)})}}for(var _=new Map,b=0,E=d.length;b<E;++b){var h=d[b],P=wm(eo(h.ranges),eo(h.set));if(_.has(P)){var D=_.get(P).groupedUnits;D.has(h.unit.invariantId)?D.get(h.unit.invariantId).push(h.unit.id):D.set(h.unit.invariantId,[h.unit.id])}else{var D=new Map;D.set(h.unit.invariantId,[h.unit.id]),_.set(P,{groupedUnits:D,set:h.set,ranges:h.ranges})}}var k=[];return _.forEach(function(F){var X=[];F.groupedUnits.forEach(function(U){return X.push(nt.ofUnsortedArray(U))}),X.sort(function(U,j){return U[0]-j[0]}),k.push({groupedUnits:X,set:F.set,ranges:F.ranges})}),{hash:c.structure.hashCode,elements:k}}e.fromLoci=n;function a(c,d){for(var f=[],p=0,h=c.length;p<h;++p){var m=c[p];d.unitMap.has(m)&&f.push(d.unitMap.get(m))}return f}function i(c,d){c.hash!==-1&&(c.hash,d.hashCode);for(var f=[],p=0,h=c.elements;p<h.length;p++)for(var m=h[p],v=function(S){var x=a(S,d);if(x.length===0)return"continue";var C=void 0;if(m.ranges.length===0)C=m.set;else if(m.set.length===0)if(m.ranges.length===2)C=Me.ofRange(m.ranges[0],m.ranges[1]);else{var w=new Int32Array(In.size(m.ranges));In.forEach(m.ranges,function(F,X){return w[X]=F}),C=nt.ofSortedArray(w)}else{var _=In.size(m.ranges),E=new Int32Array(m.set.length+_);In.forEach(m.ranges,function(F,X){return E[X]=F}),E.set(m.set,_),C=nt.ofUnsortedArray(E)}for(var P=0,D=x;P<D.length;P++){var k=D[P];f.push({unit:k,indices:C})}},g=0,y=m.groupedUnits;g<y.length;g++){var b=y[g];v(b)}return Oe(d,f)}e.toLoci=i;function o(c,d){c.hash!==-1&&(c.hash,d.hashCode);for(var f=[],p=0,h=c.elements;p<h.length;p++)for(var m=h[p],v=function(S){var x=a(S,d);if(x.length===0)return"continue";var C=x[0].elements,w=In.size(m.ranges),_=m.set.length,E=new Int32Array(_+w),P=void 0;if(w===0){for(var D=0,k=_;D<k;++D)E[D]=C[m.set[D]];P=nt.ofSortedArray(E)}else if(_===0)In.forEach(m.ranges,function(j,te){return E[te]=C[j]}),P=nt.ofSortedArray(E);else if(nt.min(m.set)>In.max(m.ranges)){In.forEach(m.ranges,function(j,te){return E[te]=C[j]});for(var D=0,k=_;D<k;++D)E[D+w]=C[m.set[D]];P=nt.ofSortedArray(E)}else if(In.min(m.ranges)>nt.max(m.set)){for(var D=0,k=_;D<k;++D)E[D]=C[m.set[D]];In.forEach(m.ranges,function(j,te){return E[te+_]=C[j]}),P=nt.ofSortedArray(E)}else{In.forEach(m.ranges,function(j,te){return E[te]=C[j]});for(var D=0,k=_;D<k;++D)E[D+w]=C[m.set[D]];P=nt.ofUnsortedArray(E)}for(var F=0,X=x;F<X.length;F++){var U=X[F];f.push(U.getChild(P))}},g=0,y=m.groupedUnits;g<y.length;g++){var b=y[g];v(b)}return $e.create(f,{parent:d})}e.toStructure=o;function s(c){return ce.internal.generator.bundleElement({groupedUnits:ce.core.type.list(c.groupedUnits.map(function(d){return ce.core.type.list(d)})),ranges:ce.core.type.list(c.ranges),set:ce.core.type.list(c.set)})}function u(c){return ce.internal.generator.bundle({elements:ce.core.type.list(c.elements.map(s))})}e.toExpression=u;function l(c,d){if(c.elements.length!==d.elements.length)return!1;for(var f=0,p=c.elements.length;f<p;++f){var h=c.elements[f],m=d.elements[f];if(h.groupedUnits.length!==m.groupedUnits.length)return!1;for(var v=0,g=m.groupedUnits.length;v<g;++v)if(!nt.areEqual(h.groupedUnits[v],m.groupedUnits[v]))return!1;if(!nt.areEqual(h.set,m.set)||!In.areEqual(h.ranges,m.ranges))return!1}return!0}e.areEqual=l})(sn||(sn={}));function S5(e){return $r.isCovalent(e.atomicBond.type)}function RPe(){return function(t){for(var r=t.inputStructure,n=ot.create(r),a=[],i=0,o=r.units;i<o.length;i++){var s=o[i];if(s.kind===0){n.unit=s;var u=s.elements;if(n.element=u[0],mt.entity.type(n)==="polymer"){for(var l=pr.transientSegments(s.model.atomicHierarchy.residueAtomSegments,u),c=0;l.hasNext;)c++,l.move();c<8||a.push(s)}}}return St.Singletons(r,$e.create(a,{parent:r}))}}function OPe(){return function(t){for(var r=t.inputStructure,n=ot.create(r),a=[],i=0,o=r.units;i<o.length;i++){var s=o[i];if(s.kind===0){n.unit=s;var u=s.elements;n.element=u[0],mt.entity.type(n)==="water"&&a.push(s)}}return St.Singletons(r,$e.create(a,{parent:r}))}}function BPe(){return function(t){for(var r=t.inputStructure,n=ot.create(r),a=[],i=0,o=r.units;i<o.length;i++){var s=o[i];if(s.kind===0){n.unit=s;var u=s.elements;if(n.element=u[0],mt.entity.type(n)!=="water"){if(mt.entity.type(n)==="polymer"){for(var l=pr.transientSegments(s.model.atomicHierarchy.residueAtomSegments,u),c=0;l.hasNext;)c++,l.move();if(c>=8)continue}a.push(s)}}}return St.Singletons(r,$e.create(a,{parent:r}))}}function FPe(){return function(t){for(var r=t.inputStructure,n=[],a=0,i=r.units;a<i.length;a++){var o=i[a];o.kind===1&&n.push(o)}return St.Singletons(r,$e.create(n,{parent:r}))}}function jX(e,t,r){return{groupedUnits:e,ranges:t,set:r}}function GX(e){return function(r){var n={hash:r.inputStructure.hashCode,elements:e};return St.Sequence(r.inputStructure,[sn.toStructure(n,r.inputStructure)])}}var LPe=Object.freeze({__proto__:null,defaultBondTest:S5,atomicSequence:RPe,water:OPe,atomicHet:BPe,spheres:FPe,bundleElementImpl:jX,bundleGenerator:GX}),As=function(){function e(t,r){this.currentElementStack=[],this.currentAtomicBondStack=[],this.currentStructureStack=[],this.inputStructureStack=[],this.timeCreated=Gn(),this.element=ot.create(void 0),this.currentStructure=void 0,this.atomicBond=new l7,this.currentSelection=void 0,this.inputStructure=t,this.timeoutMs=r&&r.timeoutMs||0,this.currentSelection=r&&r.currentSelection}return e.prototype.pushCurrentElement=function(){return this.currentElementStack[this.currentElementStack.length]=this.element,this.element=ot.create(void 0),this.element},e.prototype.popCurrentElement=function(){this.element=this.currentElementStack.pop()},e.prototype.pushCurrentBond=function(){return this.atomicBond&&this.currentAtomicBondStack.push(this.atomicBond),this.atomicBond=new l7,this.atomicBond},e.prototype.popCurrentBond=function(){this.currentAtomicBondStack.length>0?this.atomicBond=this.currentAtomicBondStack.pop():this.atomicBond=void 0},e.prototype.pushCurrentStructure=function(){this.currentStructure&&this.currentStructureStack.push(this.currentStructure)},e.prototype.popCurrentStructure=function(){this.currentStructureStack.length?this.currentStructure=this.currentStructureStack.pop():this.currentStructure=void 0},e.prototype.pushInputStructure=function(t){this.inputStructureStack.push(this.inputStructure),this.inputStructure=t},e.prototype.popInputStructure=function(){if(this.inputStructureStack.length===0)throw new Error("Must push before pop.");this.inputStructure=this.inputStructureStack.pop()},e.prototype.throwIfTimedOut=function(){if(this.timeoutMs!==0&&Gn()-this.timeCreated>this.timeoutMs)throw new Error("The query took too long to execute (> "+this.timeoutMs/1e3+"s).")},e.prototype.tryGetCurrentSelection=function(){if(!this.currentSelection)throw new Error("The current selection is not assigned.");return this.currentSelection},e}(),l7=function(){function e(){this.a=ot.create(void 0),this.aIndex=0,this.b=ot.create(void 0),this.bIndex=0,this.type=0,this.order=0,this.testFn=S5}return e.prototype.setStructure=function(t){this.a.structure=t,this.b.structure=t},e.prototype.setTestFn=function(t){this.testFn=t||S5},e.prototype.test=function(t,r){return this.testFn(t)?!0:r?(this.swap(),this.testFn(t)):!1},e.prototype.swap=function(){var t=this.aIndex;this.aIndex=this.bIndex,this.bIndex=t;var r=this.a.unit;this.a.unit=this.b.unit,this.b.unit=r;var n=this.a.element;this.a.element=this.b.element,this.b.element=n},Object.defineProperty(e.prototype,"length",{get:function(){return ot.distance(this.a,this.b)},enumerable:!1,configurable:!0}),e}(),C5;(function(e){function t(r,n,a){return r(new As(n,a))}e.run=t})(C5||(C5={}));var w5=function(){function e(t){this.source=t,this.set=tk($e.hashCode,$e.areUnitIdsAndIndicesEqual),this.structures=[],this.allSingletons=!0}return e.prototype.add=function(t){!t.elementCount||(t.elementCount!==1&&(this.allSingletons=!1),this.set.add(t)&&(this.structures[this.structures.length]=t))},e.prototype.getSelection=function(){return this.allSingletons?St.Singletons(this.source,U1(this.source,this.structures)):St.Sequence(this.source,this.structures)},e}(),NPe=function(){function e(t){this.source=t,this.builders=[],this.builderMap=new Map}return e.prototype.add=function(t,r,n){var a=this.builderMap.get(t);a||(a=this.source.subsetBuilder(!0),this.builders[this.builders.length]=a,this.builderMap.set(t,a)),a.addToUnit(r,n)},e.prototype.allSingletons=function(){for(var t=0,r=this.builders.length;t<r;t++)if(this.builders[t].elementCount>1)return!1;return!0},e.prototype.singletonSelection=function(){for(var t=this.source.subsetBuilder(!0),r=ot.create(this.source),n=0,a=this.builders.length;n<a;n++)this.builders[n].setSingletonLocation(r),t.addToUnit(r.unit.id,r.element);return St.Singletons(this.source,t.getStructure())},e.prototype.fullSelection=function(){for(var t=new Array(this.builders.length),r=0,n=this.builders.length;r<n;r++)t[r]=this.builders[r].getStructure();return St.Sequence(this.source,t)},e.prototype.getSelection=function(){var t=this.builders.length;return t===0?St.Empty(this.source):this.allSingletons()?this.singletonSelection():this.fullSelection()},e}(),kk=function(e){return St.Sequence(e.inputStructure,[])},qX=function(e){return St.Singletons(e.inputStructure,e.inputStructure)};function zPe(e){return Rk(T(T({},e),{groupBy:function(t){return mt.residue.key(t.element)}}))}function UPe(e){return Rk(T(T({},e),{groupBy:function(t){return mt.chain.key(t.element)}}))}function Bf(e){return!0}function VPe(e){return 0}function Rk(e){if(!e||!e.atomTest&&!e.residueTest&&!e.chainTest&&!e.entityTest&&!e.unitTest&&!e.groupBy)return qX;if(!!e.atomTest&&!e.residueTest&&!e.chainTest&&!e.entityTest&&!e.unitTest&&!e.groupBy)return HPe(e.atomTest);var t={unitTest:e.unitTest||Bf,entityTest:e.entityTest||Bf,chainTest:e.chainTest||Bf,residueTest:e.residueTest||Bf,atomTest:e.atomTest||Bf,groupBy:e.groupBy||VPe};return e.groupBy?GPe(t):jPe(t)}function HPe(e){return function(r){var n=r.inputStructure,a=n.units,i=r.pushCurrentElement(),o=n.subsetBuilder(!0);i.structure=n;for(var s=0,u=a;s<u.length;s++){var l=u[s];i.unit=l;var c=l.elements;o.beginUnit(l.id);for(var d=0,f=c.length;d<f;d++)i.element=c[d],e(r)&&o.addElement(i.element);o.commitUnit(),r.throwIfTimedOut()}return r.popCurrentElement(),St.Singletons(n,o.getStructure())}}function jPe(e){var t=e.unitTest,r=e.entityTest,n=e.chainTest,a=e.residueTest,i=e.atomTest;return function(s){var u=s.inputStructure,l=u.units,c=s.pushCurrentElement(),d=u.subsetBuilder(!0),f=a===Bf&&i===Bf,p=i===Bf;c.structure=u;for(var h=0,m=l;h<m.length;h++){var v=m[h];if(c.unit=v,!!t(s)){var g=v.elements,y=v.model;if(d.beginUnit(v.id),v.kind===0)for(var b=pr.transientSegments(v.model.atomicHierarchy.chainAtomSegments,g),S=pr.transientSegments(v.model.atomicHierarchy.residueAtomSegments,g);b.hasNext;){var x=b.move();if(c.element=g[x.start],!(!r(s)||!n(s))){if(f){d.addElementRange(g,x.start,x.end);continue}for(S.setSegment(x);S.hasNext;){var C=S.move();if(c.element=g[C.start],!!a(s)){if(p){d.addElementRange(g,C.start,C.end);continue}for(var w=C.start,_=C.end;w<_;w++)c.element=g[w],i(s)&&d.addElement(c.element)}}}}else for(var E=y.coarseHierarchy.spheres.chainElementSegments,b=pr.transientSegments(E,g);b.hasNext;){var x=b.move();if(c.element=g[x.start],!(!r(s)||!n(s))){if(f){d.addElementRange(g,x.start,x.end);continue}for(var w=x.start,_=x.end;w<_;w++)c.element=g[w],a(s)&&d.addElement(c.element)}}d.commitUnit(),s.throwIfTimedOut()}}return s.popCurrentElement(),St.Singletons(u,d.getStructure())}}function GPe(e){var t=e.unitTest,r=e.entityTest,n=e.chainTest,a=e.residueTest,i=e.atomTest,o=e.groupBy;return function(u){var l=u.inputStructure,c=l.units,d=u.pushCurrentElement(),f=new NPe(l);d.structure=l;for(var p=0,h=c;p<h.length;p++){var m=h[p];if(d.unit=m,!!t(u)){var v=m.elements,g=m.model;if(m.kind===0)for(var y=pr.transientSegments(g.atomicHierarchy.chainAtomSegments,v),b=pr.transientSegments(g.atomicHierarchy.residueAtomSegments,v);y.hasNext;){var S=y.move();if(d.element=v[S.start],!(!r(u)||!n(u)))for(b.setSegment(S);b.hasNext;){var x=b.move();if(d.element=v[x.start],!!a(u))for(var C=x.start,w=x.end;C<w;C++)d.element=v[C],i(u)&&f.add(o(u),m.id,d.element)}}else for(var _=g.coarseHierarchy.spheres.chainElementSegments,y=pr.transientSegments(_,v);y.hasNext;){var S=y.move();if(d.element=v[S.start],!(!r(u)||!n(u)))for(var C=S.start,w=S.end;C<w;C++)d.element=v[C],a(u)&&f.add(o(u),m.id,d.element)}u.throwIfTimedOut()}}return u.popCurrentElement(),f.getSelection()}}function UA(e,t,r){for(var n=new Int32Array(t.length),a=0,i=t.length;a<i;a++)n[a]=e.elements[t[a]];return $e.create([e.getChild(nt.ofSortedArray(n))],{parent:r})}function qPe(e,t){return function(n){var a=n.inputStructure.units,i=St.LinearBuilder(n.inputStructure);if(!e||e.length===0)for(var o=0,s=a;o<s.length;o++){var u=s[o];if(!!We.isAtomic(u))if(t)for(var l=0,c=u.rings.aromaticRings;l<c.length;l++){var d=c[l];i.add(UA(u,u.rings.all[d],n.inputStructure))}else for(var f=0,p=u.rings.all;f<p.length;f++){var d=p[f];i.add(UA(u,d,n.inputStructure))}}else{for(var h=on.create(),m=0;m<e.length;m++)on.add(h,e[m],e[m]);for(var v=0,g=a;v<g.length;v++){var u=g[v];if(!!We.isAtomic(u))for(var y=u.rings,b=0,S=h.array;b<S.length;b++){var x=S[b];if(!!y.byFingerprint.has(x))for(var C=0,w=y.byFingerprint.get(x);C<w.length;C++){var d=w[C];t&&!y.aromaticRings.includes(d)||i.add(UA(u,y.all[d],n.inputStructure))}}}}return i.getSelection()}}function WPe(e,t,r){return r===void 0&&(r=!1),function(a){var i=e(a);if(St.structureCount(i)===0)return i;var o=r?Dk(a.inputStructure,St.unionStructure(i)):St.unionStructure(i);if(o.elementCount===0)return St.Empty(a.inputStructure);a.throwIfTimedOut(),a.pushInputStructure(o);var s=t(a);return a.popInputStructure(),St.withInputStructure(s,a.inputStructure)}}function XPe(e){return function(r){var n=r.inputStructure,a=n.interUnitBonds,i=St.UniqueBuilder(r.inputStructure);r.pushCurrentBond();var o=r.atomicBond;o.setTestFn(e),o.setStructure(n);for(var s=0,u=n.units;s<u.length;s++){var l=u[s];if(l.kind===0){var c=l.bonds,d=c.offset,f=c.b,p=c.edgeProps,h=p.flags,m=p.order;o.a.unit=l,o.b.unit=l;for(var v=0,g=l.elements.length;v<g;v++){o.aIndex=v,o.a.element=l.elements[v];for(var y=d[v],b=d[v+1];y<b;y++)if(o.bIndex=f[y],o.b.element=l.elements[f[y]],o.type=h[y],o.order=m[y],o.test(r,!1)){var S=n.subsetBuilder(!1);S.beginUnit(l.id),S.addElement(o.a.element),S.addElement(o.b.element),S.commitUnit(),i.add(S.getStructure())}}}}for(var x=0,C=a.edges;x<C.length;x++){var w=C[x];if(o.a.unit=n.unitMap.get(w.unitA),o.a.element=o.a.unit.elements[w.indexA],o.aIndex=w.indexA,o.b.unit=n.unitMap.get(w.unitA),o.b.element=o.b.unit.elements[w.indexB],o.bIndex=w.indexB,o.order=w.props.order,o.type=w.props.flag,o.test(r,!1)){var S=n.subsetBuilder(!1);S.addToUnit(o.a.unit.id,o.a.element),S.addToUnit(o.b.unit.id,o.b.element),i.add(S.getStructure())}}return r.popCurrentBond(),i.getSelection()}}var YPe=Object.freeze({__proto__:null,none:kk,all:qX,residues:zPe,chains:UPe,atoms:Rk,rings:qPe,querySelection:WPe,bondedAtomicPairs:XPe}),o_=function(){function e(t){this.parent=t,this.ids=[],this.unitMap=hu.Mutable(),this.parentId=-1,this.currentUnit=on.create(),this.elementCount=0}return e.prototype.addToUnit=function(t,r){var n=this.unitMap.get(t);if(n)on.add(n,r,r)&&this.elementCount++;else{var a=on.create();on.add(a,r,r),this.unitMap.set(t,a),this.ids[this.ids.length]=t,this.elementCount++}},e.prototype.has=function(t,r){var n=this.unitMap.get(t);return n?on.has(n,r):!1},e.prototype.beginUnit=function(t){this.parentId=t,this.unitMap.has(t)?this.currentUnit=this.unitMap.get(t):this.currentUnit=this.currentUnit.array.length>0?on.create():this.currentUnit},e.prototype.addElement=function(t){on.add(this.currentUnit,t,t)&&this.elementCount++},e.prototype.commitUnit=function(){this.currentUnit.array.length===0||this.unitMap.has(this.parentId)||(this.ids[this.ids.length]=this.parentId,this.unitMap.set(this.parentId,this.currentUnit),this.parentId=-1)},e.prototype.getStructure=function(){if(this.isEmpty)return $e.Empty;var t=[];Wu(this.ids);for(var r=Gl.UnitEquivalenceBuilder(),n=0,a=this.ids.length;n<a;n++){var i=this.ids[n],o=this.parent.unitMap.get(i),s=this.unitMap.get(i).array,u=s.length;if(s.length===o.elements.length){t[t.length]=o,r.add(o.id,o);continue}u>1&&Wu(s);var l=o.getChild(nt.ofSortedArray(s)),c=r.add(l.id,l);l!==c&&(l=c.applyOperator(l.id,l.conformation.operator,!0)),t[t.length]=l}return $e.create(t,{parent:this.parent})},Object.defineProperty(e.prototype,"isEmpty",{get:function(){return this.elementCount===0},enumerable:!1,configurable:!0}),e}(),KPe={type_symbol:ye.Schema.Aliased(Cr.atom_site.type_symbol),label_atom_id:Cr.atom_site.label_atom_id,auth_atom_id:Cr.atom_site.auth_atom_id,label_alt_id:Cr.atom_site.label_alt_id,label_comp_id:Cr.atom_site.label_comp_id,auth_comp_id:Cr.atom_site.auth_comp_id,pdbx_formal_charge:Cr.atom_site.pdbx_formal_charge},$Pe={group_PDB:Cr.atom_site.group_PDB,label_seq_id:Cr.atom_site.label_seq_id,auth_seq_id:Cr.atom_site.auth_seq_id,pdbx_PDB_ins_code:Cr.atom_site.pdbx_PDB_ins_code},QPe={label_asym_id:Cr.atom_site.label_asym_id,auth_asym_id:Cr.atom_site.auth_asym_id,label_entity_id:Cr.atom_site.label_entity_id},_5;(function(e){function t(){return{label_entity_id:"",label_asym_id:"",auth_seq_id:0,pdbx_PDB_ins_code:void 0}}e.EmptyResidueKey=t})(_5||(_5={}));var lm;(function(e){function t(a,i){return a.residueAtomSegments.index[a.chainAtomSegments.offsets[i]]}e.chainStartResidueIndex=t;function r(a,i){return a.residueAtomSegments.index[a.chainAtomSegments.offsets[i+1]-1]+1}e.chainEndResidueIndexExcl=r;function n(a,i){return r(a,i)-t(a,i)}e.chainResidueCount=n})(lm||(lm={}));var s_={H:1,D:1,T:1,HE:2,LI:3,BE:4,B:5,C:6,N:7,O:8,F:9,NE:10,NA:11,MG:12,AL:13,SI:14,P:15,S:16,CL:17,AR:18,K:19,CA:20,SC:21,TI:22,V:23,CR:24,MN:25,FE:26,CO:27,NI:28,CU:29,ZN:30,GA:31,GE:32,AS:33,SE:34,BR:35,KR:36,RB:37,SR:38,Y:39,ZR:40,NB:41,MO:42,TC:43,RU:44,RH:45,PD:46,AG:47,CD:48,IN:49,SN:50,SB:51,TE:52,I:53,XE:54,CS:55,BA:56,LA:57,CE:58,PR:59,ND:60,PM:61,SM:62,EU:63,GD:64,TB:65,DY:66,HO:67,ER:68,TM:69,YB:70,LU:71,HF:72,TA:73,W:74,RE:75,OS:76,IR:77,PT:78,AU:79,HG:80,TL:81,PB:82,BI:83,PO:84,AT:85,RN:86,FR:87,RA:88,AC:89,TH:90,PA:91,U:92,NP:93,PU:94,AM:95,CM:96,BK:97,CF:98,ES:99,FM:100,MD:101,NO:102,LR:103,RF:104,DB:105,SG:106,BH:107,HS:108,MT:109},ZPe={1:1.1,2:1.4,3:1.81,4:1.53,5:1.92,6:1.7,7:1.55,8:1.52,9:1.47,10:1.54,11:2.27,12:1.73,13:1.84,14:2.1,15:1.8,16:1.8,17:1.75,18:1.88,19:2.75,20:2.31,21:2.3,22:2.15,23:2.05,24:2.05,25:2.05,26:2.05,27:2,28:2,29:2,30:2.1,31:1.87,32:2.11,33:1.85,34:1.9,35:1.83,36:2.02,37:3.03,38:2.49,39:2.4,40:2.3,41:2.15,42:2.1,43:2.05,44:2.05,45:2,46:2.05,47:2.1,48:2.2,49:2.2,50:1.93,51:2.17,52:2.06,53:1.98,54:2.16,55:3.43,56:2.68,57:2.5,58:2.48,59:2.47,60:2.45,61:2.43,62:2.42,63:2.4,64:2.38,65:2.37,66:2.35,67:2.33,68:2.32,69:2.3,70:2.28,71:2.27,72:2.25,73:2.2,74:2.1,75:2.05,76:2,77:2,78:2.05,79:2.1,80:2.05,81:1.96,82:2.02,83:2.07,84:1.97,85:2.02,86:2.2,87:3.48,88:2.83,89:2,90:2.4,91:2,92:2.3,93:2,94:2,95:2,96:2,97:2,98:2,99:2,100:2,101:2,102:2,103:2,104:2,105:2,106:2,107:2,108:2,109:2},JPe={1:1.008,2:4.0026,3:6.94,4:9.0122,5:10.81,6:10.81,7:14.007,8:15.999,9:18.998,10:20.18,11:22.99,12:24.305,13:26.982,14:28.085,15:30.974,16:32.06,17:35.45,18:39.948,19:39.098,20:40.078,21:44.956,22:47.867,23:50.942,24:51.996,25:54.938,26:55.845,27:58.933,28:58.693,29:63.546,30:65.38,31:69.723,32:72.63,33:74.922,34:78.971,35:79.904,36:83.798,37:85.468,38:87.62,39:88.906,40:91.224,41:92.906,42:95.95,43:96.906,44:101.07,45:102.91,46:106.42,47:107.87,48:112.41,49:114.82,50:118.71,51:121.76,52:127.6,53:127.6,54:131.29,55:132.91,56:137.33,57:138.91,58:140.12,59:140.91,60:144.24,61:144.912,62:150.36,63:151.96,64:157.25,65:158.93,66:162.5,67:164.93,68:167.26,69:168.93,70:173.05,71:174.97,72:178.49,73:180.95,74:183.84,75:186.21,76:190.23,77:192.22,78:195.08,79:196.97,80:200.59,81:204.38,82:207.2,83:208.98,84:1.97,85:2.02,86:2.2,87:3.48,88:2.83,89:2,90:232.04,91:231.04,92:238.03,93:237.048,94:244.064,95:243.061,96:247.07,97:247.07,98:251.079,99:252.083,100:257.095,101:258.098,102:259.101,103:262.11,104:267.122,105:270.131,106:271.134,107:270.133,108:270.134,109:278.156},e5e=1.7,t5e=10.81,r5e=0;function yb(e){var t=s_[e];return t===void 0?e5e:ZPe[t]}function n5e(e){var t=s_[e];return t===void 0?t5e:JPe[t]}function bb(e){var t=s_[e];return t===void 0?r5e:t}function WX(e,t,r,n){return{type:e,key:t,elements:r,getIndex:n}}function a5e(e){var t=e.unit,r=e.flags,n=e.proteinInfo,a=t.conformation.position,i=t.model.atomicHierarchy.derived.residue.traceElementIndex,o=n.residueIndices,s=n.nIndices,u=o.length,l=function(D,k){return D===-1?A.setNaN(k):a(D,k)},c=A(),d=A(),f=A(),p=A(),h=A(),m=A(),v=A();e:for(var g=2;g<u-2;g++){for(var y=0;y<4;y++){var b=g+y-2;if(l(i[b],p),l(s[b+1],h),A.squaredDistance(p,h)>6.25)continue e}var S=o[g-2],x=o[g],C=o[g+2],w=i[S],_=i[x],E=i[C];l(w,c),l(_,d),l(E,f),A.sub(m,c,d),A.sub(v,d,f);var P=qu(A.angle(m,v));P&&P>70&&(r[g]|=32)}}var i5e=9,Y2=-27.888,o5e=-.5,c7=-9.9;function s5e(e,t,r,n){var a=A.distance(e,n),i=A.distance(t,n),o=A.distance(t,r),s=A.distance(e,r),u=Y2/a-Y2/i,l=Y2/o-Y2/s,c=u+l;return c<c7?c7:c}function u5e(e,t,r){for(var n=t.residueIndices,a=t.cIndices,i=t.hIndices,o=t.nIndices,s=t.oIndices,u=e.model.atomicHierarchy.index,l=e.conformation.invariantPosition,c=e.model.atomicHierarchy.derived.residue.traceElementIndex,d=n.length,f=[],p=[],h=[],m=A(),v=A(),g=A(),y=A(),b=A(),S=A(),x=A(),C=0,w=n.length;C<w;++C){var _=C,E=n[C],P=s[_],D=a[_],k=c[E];if(!(P===-1||D===-1)&&u.findAtomOnResidue(E,"OXT")===-1){l(P,m),l(D,v),l(k,g);for(var F=r.find(g[0],g[1],g[2],i5e),X=F.indices,U=F.count,j=0;j<U;++j){var te=X[j];if(!(te===_||te-1===_||te+1===_)){var q=o[te];if(q!==-1){l(q,y);var W=i[te];if(W===-1){if(te===0)continue;var V=te-1,ee=s[V],ue=a[V];if(ee===-1||ue===-1)continue;l(ee,x),l(ue,S),A.sub(b,S,x);var $=A.distance(x,S);A.scaleAndAdd(b,y,b,1/$)}else l(W,b);var Q=s5e(m,v,y,b);Q>o5e||(f[f.length]=_,p[p.length]=te,h[h.length]=Q)}}}}}return l5e(d,f,p,h)}function l5e(e,t,r,n){for(var a=new qo.DirectedEdgeBuilder(e,t,r),i=new Float32Array(a.slotCount),o=0,s=a.edgeCount;o<s;o++)a.addNextEdge(),a.assignProperty(i,n[o]);return a.createGraph({energies:n})}var ur;(function(e){e.is=Oi.has,e.create=Oi.create})(ur||(ur={}));var K2=function(){function e(t,r,n){this.partner1=Math.min(t,r),this.partner2=Math.max(t,r),this.type=n}return e}();function c5e(e){for(var t=e.proteinInfo,r=e.hbonds,n=e.flags,a=[1024,2048,4096,128,256,512],i=0;i<3;i++)for(var o=0,s=t.residueIndices.length-1;o<s;++o)if(r.getDirectedEdgeIndex(o,o+i+3)!==-1)if(n[o]|=a[i+3]|a[i],e.params.oldDefinition)for(var u=1;u<i+3;++u)n[o+u]|=a[i+3]|64;else for(var u=0;u<=i+3;++u)n[o+u]|=a[i+3]|64}function d5e(e){for(var t=e.proteinInfo,r=e.flags,n=t.residueIndices.length,a=[1024,2048,4096,128,256,512],i=[0,0,0,8,1,16],o=e.params.oldOrdering?[4,3,5]:[3,4,5],s=0;s<o.length;s++)for(var u=o[s],l=1,c=n-u;l<c;l++){var d=ur.create(r[l]),f=ur.create(r[l-1]),p=ur.create(r[l+1]);if(e.params.oldOrdering){if(u===3&&(ur.is(d,1)||ur.is(p,1))||u===5&&(ur.is(d,1)||ur.is(d,8)||ur.is(p,1)||ur.is(p,8)))continue}else if(u===4&&(ur.is(d,8)||ur.is(p,8))||u===5&&(ur.is(d,1)||ur.is(d,8)||ur.is(p,1)||ur.is(p,8)))continue;if(ur.is(d,a[u])&&ur.is(d,a[u-3])&&ur.is(f,a[u])&&ur.is(f,a[u-3]))if(e.params.oldDefinition)for(var h=0;h<u;h++)r[l+h]|=i[u];else for(var h=-1;h<=u;h++)r[l+h]|=i[u]}}function f5e(e,t){if(t.type!==e.type||t.partner1!==e.firstEnd+1)return!1;if(t.type===0){if(t.partner2===e.secondEnd+1)return!0}else if(t.partner2===e.secondStart-1)return!0;return!1}function p5e(e,t){return e.type===t.type&&t.firstStart-e.firstEnd<6&&e.firstStart<t.firstStart&&t.nextLadder===0?e.type===0?d7(e,t):d7(t,e):!1}function d7(e,t){return t.secondStart-e.secondEnd>0&&(t.secondStart-e.secondEnd<6&&t.firstStart-e.firstEnd<3||t.secondStart-e.secondEnd<3)}function h5e(e){for(var t=e.bridges,r=e.ladders,n=0;n<t.length;n++){for(var a=t[n],i=!1,o=0;o<r.length;o++){var s=r[o];f5e(s,a)&&(i=!0,s.firstEnd++,a.type===0?s.secondEnd++:s.secondStart--)}i||(r[r.length]={previousLadder:0,nextLadder:0,firstStart:a.partner1,firstEnd:a.partner1,secondStart:a.partner2,secondEnd:a.partner2,type:a.type})}for(var u=0;u<r.length;u++)for(var l=r[u],c=u;c<r.length;c++){var d=r[c];p5e(l,d)&&(l.nextLadder=c,d.previousLadder=u)}}function m5e(e){for(var t=e.proteinInfo,r=e.hbonds,n=e.flags,a=e.bridges,i=r.offset,o=r.b,s,u,l=0,c=t.residueIndices.length;l<c;++l)for(var d=i[l],f=i[l+1];d<f;d++){var p=o[d];l>p||(s=l+1,u=p,s!==u&&r.getDirectedEdgeIndex(u,s+1)!==-1&&(n[s]|=2,n[u]|=2,a[a.length]=new K2(s,u,0)),s=l,u=p-1,s!==u&&r.getDirectedEdgeIndex(u-1,s)!==-1&&(n[s]|=2,n[u]|=2,a[a.length]=new K2(u,s,0)),s=l,u=p,s!==u&&r.getDirectedEdgeIndex(u,s)!==-1&&(n[s]|=2,n[u]|=2,a[a.length]=new K2(u,s,1)),s=l+1,u=p-1,s!==u&&r.getDirectedEdgeIndex(u-1,s+1)!==-1&&(n[s]|=2,n[u]|=2,a[a.length]=new K2(u,s,1)))}a.sort(function(h,m){return h.partner1>m.partner1?1:h.partner1<m.partner1?-1:0})}function f7(e){return ur.is(e,8)||ur.is(e,1)||ur.is(e,16)}function v5e(e){for(var t=e.ladders,r=e.flags,n=0;n<t.length;n++){for(var a=t[n],i=a.firstStart;i<=a.firstEnd;i++){var o=a.firstStart-i,s=a.secondStart-o;a.firstStart!==a.firstEnd?(r[i]|=4,r[s]|=4):(!f7(r[i])&&ur.is(r[i],4)&&(r[i]|=2),!f7(r[s])&&ur.is(r[s],4)&&(r[s]|=2))}if(a.nextLadder!==0){for(var u=t[a.nextLadder],i=a.firstStart;i<=u.firstEnd;i++)r[i]|=4;if(a.type===0)for(var i=a.secondStart;i<=u.secondEnd;i++)r[i]|=4;else for(var i=u.secondEnd;i<=a.secondStart;i++)r[i]|=4}}}function g5e(e,t){var r=t.cIndices,n=t.nIndices,a=t.residueIndices,i=e.conformation.position,o=e.model.atomicHierarchy.index,s=e.model.atomicHierarchy.derived.residue.traceElementIndex,u=a.length,l=function(C,w){return C===-1?A.setNaN(w):i(C,w)},c=A(),d=A(),f=A(),p=A(),h=A(),m=A(),v=A(),g=A(),y=A();if(u===0)return{phi:new Float32Array(0),psi:new Float32Array(0)};var b=new Float32Array(u-1),S=new Float32Array(u-1);l(-1,c),l(-1,d),l(-1,f),l(r[0],p),l(s[a[0]],h),l(n[0],m),l(r[1],v),l(s[a[1]],g),l(n[1],y);for(var x=0;x<u-1;++x)o.findAtomOnResidue(a[x],"OXT")===-1&&(b[x]=qu(A.dihedralAngle(c,m,h,p)),S[x]=qu(A.dihedralAngle(m,h,p,y)),c=p,d=h,f=m,p=v,h=g,m=y,l(r[x+1],v),l(s[a[x+1]],g),l(n[x+1],y));return{phi:b,psi:S}}function y5e(e,t){for(var r=e.model.atomicConformation,n=r.x,a=r.y,i=r.z,o=e.model.atomicHierarchy.derived.residue.traceElementIndex,s=new Uint32Array(t.length),u=0,l=t.length;u<l;++u)s[u]=o[t[u]];var c={x:n,y:a,z:i,indices:nt.ofSortedArray(s)};return nm(c,y0(c))}function b5e(e){for(var t=e.model.atomicHierarchy.index,r=e.proteinElements,n=e.residueIndex,a=r.length,i=new Uint32Array(a),o=new Int32Array(a),s=new Int32Array(a),u=new Int32Array(a),l=new Int32Array(a),c=0;c<a;++c){var d=n[r[c]];i[c]=d,o[c]=t.findAtomOnResidue(d,"C"),s[c]=t.findAtomOnResidue(d,"H"),u[c]=t.findAtomOnResidue(d,"O"),l[c]=t.findAtomOnResidue(d,"N")}return{residueIndices:nt.ofSortedArray(i),cIndices:o,hIndices:s,oIndices:u,nIndices:l}}var x5e={oldDefinition:M.Boolean(!0,{description:"Whether to use the old DSSP convention for the annotation of turns and helices, causes them to be two residues shorter"}),oldOrdering:M.Boolean(!0,{description:"Alpha-helices are preferred over 3-10 helices"})};function S5e(e,t){return pe(this,void 0,void 0,function(){var r,n,a,i,o,s,u,l,c,d,f,p,h,m,v,g,y,b,S,x,C;return he(this,function(w){for(r=b5e(e),n=r.residueIndices,a=y5e(e,n),i=u5e(e,r,a),o=n.length,s=new Uint32Array(o),u=g5e(e,r),l=[],c=[],d=t.oldDefinition?_5e:T5e,f=t.oldOrdering?A5e:E5e,p={params:t,getResidueFlag:d,getFlagName:f,unit:e,proteinInfo:r,flags:s,hbonds:i,torsionAngles:u,ladders:l,bridges:c},c5e(p),d5e(p),a5e(p),m5e(p),h5e(p),v5e(p),h=P5e(s,d),m=new Uint32Array(o),v=[],g=[],y=function(_){return nt.indexOf(n,_)},b=0,S=n.length;b<S;++b)x=h[b],m[b]=x,C=d(s[b]),(g.length===0||C!==g[g.length-1].flags)&&(g[g.length]=C5e(w5e(x),s[b],d)),v[b]=g.length-1;return[2,WX(m,v,g,y)]})})}function C5e(e,t,r){return e==="helix"?{kind:"helix",flags:r(t)}:e==="sheet"?{kind:"sheet",flags:r(t)}:e==="turn"||e==="bend"?{kind:"turn",flags:r(t)}:{kind:"none"}}function w5e(e){return e===jr.SecondaryStructureDssp.H||e===jr.SecondaryStructureDssp.G||e===jr.SecondaryStructureDssp.I?"helix":e===jr.SecondaryStructureDssp.B||e===jr.SecondaryStructureDssp.E?"sheet":e===jr.SecondaryStructureDssp.T?"turn":e===jr.SecondaryStructureDssp.S?"bend":"none"}function _5e(e){return ur.is(e,1)?jr.SecondaryStructureDssp.H:ur.is(e,4)?jr.SecondaryStructureDssp.E:ur.is(e,2)?jr.SecondaryStructureDssp.B:ur.is(e,8)?jr.SecondaryStructureDssp.G:ur.is(e,16)?jr.SecondaryStructureDssp.I:ur.is(e,64)?jr.SecondaryStructureDssp.T:ur.is(e,32)?jr.SecondaryStructureDssp.S:0}function A5e(e){return ur.is(e,1)?"H":ur.is(e,4)?"E":ur.is(e,2)?"B":ur.is(e,8)?"G":ur.is(e,16)?"I":ur.is(e,64)?"T":ur.is(e,32)?"S":"-"}function T5e(e){return ur.is(e,16)?jr.SecondaryStructureDssp.I:ur.is(e,1)?jr.SecondaryStructureDssp.H:ur.is(e,4)?jr.SecondaryStructureDssp.E:ur.is(e,2)?jr.SecondaryStructureDssp.B:ur.is(e,8)?jr.SecondaryStructureDssp.G:ur.is(e,64)?jr.SecondaryStructureDssp.T:ur.is(e,32)?jr.SecondaryStructureDssp.S:0}function E5e(e){return ur.is(e,16)?"I":ur.is(e,1)?"H":ur.is(e,4)?"E":ur.is(e,2)?"B":ur.is(e,8)?"G":ur.is(e,64)?"T":ur.is(e,32)?"S":"-"}function P5e(e,t){for(var r=new Uint32Array(e.length),n=0,a=e.length;n<a;++n){var i=ur.create(e[n]);r[n]=t(i)}return r}var Cp;(function(e){function t(n){var a=this,i=n.descriptor.name,o=n.type==="root"?"inheritedPropertyData":"currentPropertyData",s=function(l){return i in l[o]||(l[o][i]={props:T({},M.getDefaultValues(n.getParams(l))),data:hp.create(void 0)}),l[o][i]},u=function(l,c,d){var f=s(l);l[o][i]={props:c,data:hp.withValue(f.data,d)}};return{label:n.label,descriptor:n.descriptor,isHidden:n.isHidden,getParams:function(l){var c=M.clone(n.getParams(l));return M.setDefaultValues(c,s(l).props),c},defaultParams:n.defaultParams,isApplicable:n.isApplicable,attach:function(l,c,d,f){return d===void 0&&(d={}),pe(a,void 0,void 0,function(){var p,h,m,v,g,y;return he(this,function(b){switch(b.label){case 0:return f&&c.customPropertyDescriptors.reference(n.descriptor,!0),n.type==="root"&&(c=c.root),p=s(c.root).props,h=s(c),m=M.merge(n.defaultParams,p,d),h.data.value&&M.areEqual(n.defaultParams,h.props,m)?[2]:[4,n.obtain(l,c,m)];case 1:return v=b.sent(),g=v.value,y=v.assets,c.customPropertyDescriptors.add(n.descriptor),c.customPropertyDescriptors.assets(n.descriptor,y),u(c,m,g),[2]}})})},ref:function(l,c){return l.customPropertyDescriptors.reference(n.descriptor,c)},get:function(l){return s(l).data},set:function(l,c,d){c===void 0&&(c={}),n.type==="root"&&(l=l.root);var f=s(l),p=M.merge(n.defaultParams,f.props,c);M.areEqual(n.defaultParams,f.props,p)||(u(l,p,d),l.customPropertyDescriptors.assets(n.descriptor))},props:function(l){return s(l).props}}}e.createProvider=t;function r(n,a,i){var o=this,s={value:M.Value(i,{isHidden:!0})};return t({label:vs(n),descriptor:vu({name:n}),isHidden:!0,type:a,defaultParams:s,getParams:function(){return{value:M.Value(i,{isHidden:!0})}},isApplicable:function(){return!0},obtain:function(u,l,c){return pe(o,void 0,void 0,function(){return he(this,function(d){return[2,T(T({},M.getDefaultValues(s)),c)]})})}})}e.createSimple=r})(Cp||(Cp={}));var V1;(function(e){e.Descriptor={name:"model_secondary_structure"},e.Provider=ol.create(e.Descriptor);function t(r,n,a){var i=new Map,o=[{kind:"none"}];I5e(r,i,o),M5e(n,i,r._rowCount,o);var s=a.residues._rowCount,u=function(c){return c},l={type:new Int32Array(s),key:new Int32Array(s),elements:o};return i.size>0&&k5e(a,i,l),WX(l.type,l.key,l.elements,u)}e.fromStruct=t})(V1||(V1={}));function I5e(e,t,r){if(!!e._rowCount)for(var n=e.beg_label_asym_id,a=e.beg_auth_seq_id,i=e.pdbx_beg_PDB_ins_code,o=e.end_auth_seq_id,s=e.pdbx_end_PDB_ins_code,u=e.pdbx_PDB_helix_class,l=e.conf_type_id,c=e.details,d=0,f=e._rowCount;d<f;d++){var p=jr.create(u.valueKind(d)===0?jr.SecondaryStructurePdb[u.value(d)]:l.valueKind(d)===0?jr.SecondaryStructureMmcif[l.value(d)]:536870912),h={kind:"helix",flags:p,type_id:l.valueKind(d)===0?l.value(d):"HELIX_P",helix_class:u.value(d),details:c.valueKind(d)===0?c.value(d):void 0},m={startSeqNumber:a.value(d),startInsCode:i.value(d),endSeqNumber:o.value(d),endInsCode:s.value(d),type:p,key:r.length};r[r.length]=h;var v=n.value(d);if(t.has(v)){var g=t.get(v);g.has(m.startSeqNumber)?g.get(m.startSeqNumber).push(m):g.set(m.startSeqNumber,[m])}else t.set(v,new Map([[m.startSeqNumber,[m]]]))}}function M5e(e,t,r,n){if(!!e._rowCount)for(var a=e.beg_label_asym_id,i=e.beg_auth_seq_id,o=e.pdbx_beg_PDB_ins_code,s=e.end_auth_seq_id,u=e.pdbx_end_PDB_ins_code,l=e.sheet_id,c=new Map,d=r+1,f=0,p=e._rowCount;f<p;f++){var h=l.value(f),m=void 0;c.has(h)?m=c.get(h):(m=d++,c.set(h,m));var v=jr.create(8388612),g={kind:"sheet",flags:v,sheet_id:h,symmetry:void 0},y={startSeqNumber:i.value(f),startInsCode:o.value(f),endSeqNumber:s.value(f),endInsCode:u.value(f),type:v,key:n.length};n[n.length]=g;var b=a.value(f);if(t.has(b)){var S=t.get(b);S.has(y.startSeqNumber)?S.get(y.startSeqNumber).push(y):S.set(y.startSeqNumber,[y])}else t.set(b,new Map([[y.startSeqNumber,[y]]]))}}function D5e(e,t,r,n,a){for(var i=e.residues,o=i.auth_seq_id,s=i.pdbx_PDB_ins_code,u=t.endSeqNumber,l=t.endInsCode,c=t.key,d=t.type,f=r;f<n;){var p=o.value(f);if(a.type[f]=d,a.key[f]=c,p>u||p===u&&s.value(f)===l)break;f++}}function k5e(e,t,r){for(var n=e.chainAtomSegments.count,a=e.chains.label_asym_id,i=e.residues,o=i.auth_seq_id,s=i.pdbx_PDB_ins_code,u=0;u<n;u++){var l=lm.chainStartResidueIndex(e,u),c=lm.chainEndResidueIndexExcl(e,u),d=a.value(u);if(t.has(d))for(var f=t.get(d),p=l;p<c;p++){var h=o.value(p);if(f.has(h))for(var m=f.get(h),v=0,g=m;v<g.length;v++){var y=g[v],b=s.value(p);y.startInsCode===b&&D5e(e,y,p,c,r)}}}}function XX(e){var t="model";if(e){t="dssp";for(var r=0,n=e.models.length;r<n;++r){var a=e.models[r];if(rr.isFromPdbArchive(a)||rr.hasSecondaryStructure(a)){t="model";break}}}return{type:M.MappedStatic(t,{model:M.EmptyGroup({label:"Model"}),dssp:M.Group(x5e,{label:"DSSP",isFlat:!0})},{options:[["model","Model"],["dssp","DSSP"]]})}}var p7=XX(),sc=Cp.createProvider({label:"Secondary Structure",descriptor:vu({name:"molstar_computed_secondary_structure"}),type:"root",defaultParams:p7,getParams:XX,isApplicable:function(e){return!0},obtain:function(e,t,r){return pe(void 0,void 0,void 0,function(){var n,a,i,o;return he(this,function(s){switch(s.label){case 0:switch(n=T(T({},M.getDefaultValues(p7)),r),a=n.type.name,a){case"dssp":return[3,1];case"model":return[3,3]}return[3,5];case 1:return i={},[4,R5e(t,n.type.params)];case 2:return[2,(i.value=s.sent(),i)];case 3:return o={},[4,O5e(t)];case 4:return[2,(o.value=s.sent(),o)];case 5:return[2]}})})}});function R5e(e,t){return pe(this,void 0,void 0,function(){var r,n,a,i,o;return he(this,function(s){switch(s.label){case 0:r=new Map,n=0,a=e.unitSymmetryGroups.length,s.label=1;case 1:return n<a?(i=e.unitSymmetryGroups[n].units[0],We.isAtomic(i)&&!rr.isCoarseGrained(i.model)?[4,S5e(i,t)]:[3,3]):[3,4];case 2:o=s.sent(),r.set(i.invariantId,o),s.label=3;case 3:return++n,[3,1];case 4:return[2,r]}})})}function O5e(e){return pe(this,void 0,void 0,function(){var t,r,n,a,i;return he(this,function(o){for(t=new Map,r=0,n=e.unitSymmetryGroups.length;r<n;++r)a=e.unitSymmetryGroups[r].units[0],We.isAtomic(a)&&(i=V1.Provider.get(a.model),i&&t.set(a.invariantId,i));return[2,t]})})}var B5e={true:function(e){return!0},false:function(e){return!1},zero:function(e){return 0}};function Kn(){throw"Property only available for atomic models."}function nf(e){throw e?"Property only available for coarse models ("+e+").":"Property only available for coarse models."}var ry={key:function(e){return e.element},x:function(e){return e.unit.conformation.x(e.element)},y:function(e){return e.unit.conformation.y(e.element)},z:function(e){return e.unit.conformation.z(e.element)},id:function(e){return We.isAtomic(e.unit)?e.unit.model.atomicConformation.atomId.value(e.element):Kn()},occupancy:function(e){return We.isAtomic(e.unit)?e.unit.model.atomicConformation.occupancy.value(e.element):Kn()},B_iso_or_equiv:function(e){return We.isAtomic(e.unit)?e.unit.model.atomicConformation.B_iso_or_equiv.value(e.element):Kn()},sourceIndex:function(e){return We.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atomSourceIndex.value(e.element):e.element},type_symbol:function(e){return We.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.type_symbol.value(e.element):Kn()},label_atom_id:function(e){return We.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.label_atom_id.value(e.element):Kn()},auth_atom_id:function(e){return We.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.auth_atom_id.value(e.element):Kn()},label_alt_id:function(e){return We.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.label_alt_id.value(e.element):Kn()},label_comp_id:WC,auth_comp_id:function(e){return We.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.auth_comp_id.value(e.element):Kn()},pdbx_formal_charge:function(e){return We.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.pdbx_formal_charge.value(e.element):Kn()},vdw_radius:function(e){return We.isAtomic(e.unit)?yb(e.unit.model.atomicHierarchy.atoms.type_symbol.value(e.element)):Kn()}};function WC(e){return We.isAtomic(e.unit)||Kn(),e.unit.model.atomicHierarchy.atoms.label_comp_id.value(e.element)}function Ok(e){return We.isAtomic(e.unit)?e.unit.model.atomicHierarchy.residues.label_seq_id.value(e.unit.residueIndex[e.element]):Kn()}function F5e(e){We.isAtomic(e.unit)||Kn();var t=e.unit.model.sequence.byEntityKey[uo(e)];return t&&t.sequence.microHet.has(Ok(e))}function h7(e){We.isAtomic(e.unit)||Kn();var t=e.unit.model.sequence.byEntityKey[uo(e)];return t?t.sequence.microHet.get(Ok(e))||[WC(e)]:[WC(e)]}var L5e={key:function(e){return We.isAtomic(e.unit)?e.unit.residueIndex[e.element]:Kn()},group_PDB:function(e){return We.isAtomic(e.unit)?e.unit.model.atomicHierarchy.residues.group_PDB.value(e.unit.residueIndex[e.element]):Kn()},label_seq_id:Ok,auth_seq_id:function(e){return We.isAtomic(e.unit)?e.unit.model.atomicHierarchy.residues.auth_seq_id.value(e.unit.residueIndex[e.element]):Kn()},pdbx_PDB_ins_code:function(e){return We.isAtomic(e.unit)?e.unit.model.atomicHierarchy.residues.pdbx_PDB_ins_code.value(e.unit.residueIndex[e.element]):Kn()},isNonStandard:function(e){return We.isAtomic(e.unit)?h7(e).some(function(t){return e.unit.model.properties.chemicalComponentMap.get(t).mon_nstd_flag[0]==="n"}):Kn()},hasMicroheterogeneity:F5e,microheterogeneityCompIds:h7,secondary_structure_type:function(e){var t,r;We.isAtomic(e.unit)||Kn();var n=(t=sc.get(e.structure).value)===null||t===void 0?void 0:t.get(e.unit.invariantId);return(r=n?.type[e.unit.residueIndex[e.element]])!==null&&r!==void 0?r:536870912},secondary_structure_key:function(e){var t,r;We.isAtomic(e.unit)||Kn();var n=(t=sc.get(e.structure).value)===null||t===void 0?void 0:t.get(e.unit.invariantId);return(r=n?.key[e.unit.residueIndex[e.element]])!==null&&r!==void 0?r:-1},chem_comp_type:function(e){return We.isAtomic(e.unit)?e.unit.model.properties.chemicalComponentMap.get(WC(e)).type:Kn()}},N5e={key:function(e){return We.isAtomic(e.unit)?e.unit.chainIndex[e.element]:Kn()},label_asym_id:function(e){return We.isAtomic(e.unit)?e.unit.model.atomicHierarchy.chains.label_asym_id.value(e.unit.chainIndex[e.element]):Kn()},auth_asym_id:function(e){return We.isAtomic(e.unit)?e.unit.model.atomicHierarchy.chains.auth_asym_id.value(e.unit.chainIndex[e.element]):Kn()},label_entity_id:function(e){return We.isAtomic(e.unit)?e.unit.model.atomicHierarchy.chains.label_entity_id.value(e.unit.chainIndex[e.element]):Kn()}},z5e={key:ry.key,entityKey:function(e){return We.isCoarse(e.unit)?e.unit.coarseElements.entityKey[e.element]:nf()},x:ry.x,y:ry.y,z:ry.z,asym_id:function(e){return We.isCoarse(e.unit)?e.unit.coarseElements.asym_id.value(e.element):nf()},seq_id_begin:function(e){return We.isCoarse(e.unit)?e.unit.coarseElements.seq_id_begin.value(e.element):nf()},seq_id_end:function(e){return We.isCoarse(e.unit)?e.unit.coarseElements.seq_id_end.value(e.element):nf()},sphere_radius:function(e){return We.isSpheres(e.unit)?e.unit.coarseConformation.radius[e.element]:nf("spheres")},sphere_rmsf:function(e){return We.isSpheres(e.unit)?e.unit.coarseConformation.rmsf[e.element]:nf("spheres")},gaussian_weight:function(e){return We.isGaussians(e.unit)?e.unit.coarseConformation.weight[e.element]:nf("gaussians")},gaussian_covariance_matrix:function(e){return We.isGaussians(e.unit)?e.unit.coarseConformation.covariance_matrix[e.element]:nf("gaussians")}};function uo(e){switch(e.unit.kind){case 0:return e.unit.model.atomicHierarchy.index.getEntityFromChain(e.unit.chainIndex[e.element]);case 1:return e.unit.model.coarseHierarchy.spheres.entityKey[e.element];case 2:return e.unit.model.coarseHierarchy.gaussians.entityKey[e.element]}}var U5e={key:uo,id:function(e){return e.unit.model.entities.data.id.value(uo(e))},type:function(e){return e.unit.model.entities.data.type.value(uo(e))},src_method:function(e){return e.unit.model.entities.data.src_method.value(uo(e))},pdbx_description:function(e){return e.unit.model.entities.data.pdbx_description.value(uo(e))},formula_weight:function(e){return e.unit.model.entities.data.formula_weight.value(uo(e))},pdbx_number_of_molecules:function(e){return e.unit.model.entities.data.pdbx_number_of_molecules.value(uo(e))},details:function(e){return e.unit.model.entities.data.details.value(uo(e))},pdbx_mutation:function(e){return e.unit.model.entities.data.pdbx_mutation.value(uo(e))},pdbx_fragment:function(e){return e.unit.model.entities.data.pdbx_fragment.value(uo(e))},pdbx_ec:function(e){return e.unit.model.entities.data.pdbx_ec.value(uo(e))},subtype:function(e){return e.unit.model.entities.subtype.value(uo(e))},prd_id:function(e){return e.unit.model.entities.prd_id.value(uo(e))}},V5e=[],H5e={id:function(e){return e.unit.id},chainGroupId:function(e){return e.unit.chainGroupId},multiChain:function(e){return We.Traits.is(e.unit.traits,1)},object_primitive:function(e){return e.unit.objectPrimitive},operator_name:function(e){return e.unit.conformation.operator.name},model_index:function(e){return e.unit.model.modelNum},model_label:function(e){return e.unit.model.label},model_entry_id:function(e){return e.unit.model.entryId},hkl:function(e){return e.unit.conformation.operator.hkl},spgrOp:function(e){return e.unit.conformation.operator.spgrOp},model_num:function(e){return e.unit.model.modelNum},pdbx_struct_assembly_id:function(e){var t;return((t=e.unit.conformation.operator.assembly)===null||t===void 0?void 0:t.id)||An.DefaultName},pdbx_struct_oper_list_ids:function(e){var t;return((t=e.unit.conformation.operator.assembly)===null||t===void 0?void 0:t.operList)||V5e},struct_ncs_oper_id:function(e){return e.unit.conformation.operator.ncsId}},mt={constant:B5e,atom:ry,residue:L5e,chain:N5e,entity:U5e,unit:H5e,coarse:z5e},zy=function(){function e(t){var r;this.index=new Map,this.checkOperator=!1,this.checkOperator=(r=t?.checkOperator)!==null&&r!==void 0?r:!1}return e.prototype.add=function(t){var r=this.index.get(t.label_asym_id);r||(r=new Map,this.index.set(t.label_asym_id,r));var n=r.get(t.label_seq_id);n||(n=[],r.set(t.label_seq_id,n));var a=this._find(t,n);return a?!1:(n.push(t),!0)},e.prototype.hasLabelAsymId=function(t){return this.index.has(t)},e.prototype.has=function(t){var r,n,a=m7(t);if(!!this.index.has(a)){var i=this.index.get(a),o=v7(t);if(!!i.has(o))for(var s=i.get(o),u=g7(t),l=y7(t),c=b7(t),d=(r=x7(t))!==null&&r!==void 0?r:"1_555",f=0,p=s;f<p.length;f++){var h=p[f];if(!(h.label_comp_id!==u||h.label_alt_id!==l||h.ins_code!==c)&&!(this.checkOperator&&((n=h.operator_name)!==null&&n!==void 0?n:"1_555")!==d))return h}}},e.getLabel=function(t,r){var n;return r===void 0&&(r=!1),t.label_asym_id+" "+t.label_comp_id+" "+t.label_seq_id+":"+t.ins_code+":"+t.label_alt_id+(r?" "+((n=t.operator_name)!==null&&n!==void 0?n:"1_555"):"")},e.getEntryFromLocation=function(t){var r;return{label_asym_id:m7(t),label_comp_id:g7(t),label_seq_id:v7(t),label_alt_id:y7(t),ins_code:b7(t),operator_name:(r=x7(t))!==null&&r!==void 0?r:"1_555"}},e.prototype._find=function(t,r){for(var n,a,i=0,o=r;i<o.length;i++){var s=o[i];if(!(s.label_comp_id!==t.label_comp_id||s.label_alt_id!==t.label_alt_id||s.ins_code!==t.ins_code)&&!(this.checkOperator&&((n=s.operator_name)!==null&&n!==void 0?n:"1_555")!==((a=t.operator_name)!==null&&a!==void 0?a:"1_555")))return!0}return!1},e}(),m7=mt.chain.label_asym_id,v7=mt.residue.label_seq_id,g7=mt.atom.label_comp_id,y7=mt.atom.label_alt_id,b7=mt.residue.pdbx_PDB_ins_code,x7=mt.unit.operator_name;function b0(e,t,r){for(var n=t.subsetBuilder(!0),a=0,i=r.units;a<i.length;a++){var o=i[a];if(o.kind!==0){n.setUnit(o.id,o.elements);continue}var s=o.model.atomicHierarchy.residueAtomSegments,u=t.unitMap.get(o.id).elements,l=o.elements;n.beginUnit(o.id);for(var c=pr.transientSegments(s,l);c.hasNext;)for(var d=c.move().index,f=s.offsets[d],p=s.offsets[d+1];f<p;f++)nt.has(u,f)&&n.addElement(f);n.commitUnit(),e.throwIfTimedOut()}return n.getStructure()}function j5e(e){return function(r){var n=e(r);if(St.isSingleton(n))return St.Singletons(r.inputStructure,b0(r,r.inputStructure,n.structure));for(var a=new w5(r.inputStructure),i=0,o=n.structures;i<o.length;i++){var s=o[i];a.add(b0(r,r.inputStructure,s))}return a.getSelection()}}function A5(e,t,r,n){for(var a=new o_(t),i=t.lookup3d,o=n.radius,s=0,u=r.units;s<u.length;s++){for(var l=u[s],c=l.conformation,d=c.x,f=c.y,p=c.z,h=l.elements,m=0,v=h.length;m<v;m++){var g=h[m];i.findIntoBuilder(d(g),f(g),p(g),o,a)}e.throwIfTimedOut()}return n.wholeResidues?b0(e,t,a.getStructure()):a.getStructure()}function S7(e,t,r,n){var a=new o_(t),i=t.lookup3d,o=n.elementRadius,s=n.elementRadiusClosure,u=n.sourceMaxRadius,l=n.radius;e.pushCurrentElement(),e.element.structure=r;for(var c=0,d=r.units;c<d.length;c++){var f=d[c];e.element.unit=f;for(var p=f.conformation,h=p.x,m=p.y,v=p.z,g=f.elements,y=0,b=g.length;y<b;y++){var S=g[y];e.element.element=S;var x=o(e);i.findIntoBuilderWithRadius(h(S),m(S),v(S),x,u,l,s,a)}e.throwIfTimedOut()}return e.popCurrentElement(),n.wholeResidues?b0(e,t,a.getStructure()):a.getStructure()}function G5e(e,t){return function(r){return e.element.structure=r.structure,e.element.unit=r.unit,e.element.element=r.element,t(e)}}function q5e(e,t){var r=0;e.element.structure=e.inputStructure;for(var n=0,a=e.inputStructure.units;n<a.length;n++){var i=a[n];e.element.unit=i;for(var o=i.elements,s=0,u=o.length;s<u;s++){var l=o[s];e.element.element=l;var c=t(e);c>r&&(r=c)}}return e.throwIfTimedOut(),r}function W5e(e,t){return function(n){var a=e(n);if(t.elementRadius){var i=T(T({},t),{elementRadius:t.elementRadius,elementRadiusClosure:G5e(n,t.elementRadius),sourceMaxRadius:q5e(n,t.elementRadius)});if(St.isSingleton(a)){var o=S7(n,n.inputStructure,a.structure,i),s=St.Singletons(n.inputStructure,o);return s}else{for(var u=new w5(n.inputStructure),l=0,c=a.structures;l<c.length;l++){var d=c[l];u.add(S7(n,n.inputStructure,d,i))}return u.getSelection()}}if(St.isSingleton(a)){var o=A5(n,n.inputStructure,a.structure,t),s=St.Singletons(n.inputStructure,o);return s}else{for(var u=new w5(n.inputStructure),f=0,p=a.structures;f<p.length;f++){var d=p[f];u.add(A5(n,n.inputStructure,d,t))}return u.getSelection()}}}function X5e(e,t){return function(n){var a=e(n);if(St.structureCount(a)===0)return a;var i=St.UniqueBuilder(n.inputStructure),o=function(s){return i.add(s)};return St.forEach(a,function(s,u){n.pushInputStructure(s),St.forEach(t(n),o),n.popInputStructure(),u%10===0&&n.throwIfTimedOut()}),i.getSelection()}}function Y5e(e,t){return function(n){var a=e(n);if(St.structureCount(a)===0)return a;var i=t(n);if(St.structureCount(i)===0)return St.Empty(n.inputStructure);var o=St.unionStructure(i),s=St.UniqueBuilder(n.inputStructure);return St.forEach(a,function(u,l){var c=HX(o,u);c.elementCount!==0&&s.add(c),l%50===0&&n.throwIfTimedOut()}),s.getSelection()}}function K5e(e,t){return function(n){var a=e(n);if(St.structureCount(a)===0)return a;var i=t(n);if(St.structureCount(i)===0)return a;var o=St.unionStructure(i),s=St.UniqueBuilder(n.inputStructure);return St.forEach(a,function(u,l){var c=Dk(u,o);c.elementCount!==0&&s.add(c),l%50===0&&n.throwIfTimedOut()}),s.getSelection()}}function $5e(e){return function(r){var n=St.LinearBuilder(r.inputStructure);return n.add(St.unionStructure(e(r))),n.getSelection()}}function Q5e(e,t){return function(n){var a=e(n),i=new Map,o=[];n.pushCurrentElement(),St.forEach(a,function(x,C){n.element.structure=x;for(var w=0,_=x.units;w<_.length;w++){var E=_[w];n.element.unit=E;for(var P=E.elements,D=0,k=P.length;D<k;D++){n.element.element=P[D];var F=t(n),X=void 0;i.has(F)?X=i.get(F):(X=on.create(),i.set(F,X)),on.add(X,C,C)}}o[C]=n.inputStructure.subsetBuilder(!0),C%10===0&&n.throwIfTimedOut()}),n.element.structure=n.inputStructure;for(var s=0,u=n.inputStructure.units;s<u.length;s++){var l=u[s];n.element.unit=l;for(var c=l.elements,d=0,f=c.length;d<f;d++){n.element.element=c[d];var p=t(n);if(!!i.has(p))for(var h=i.get(p).array,m=0,v=h.length;m<v;m++)o[h[m]].addToUnit(l.id,c[d])}}n.popCurrentElement();for(var g=St.UniqueBuilder(n.inputStructure),y=0,b=o;y<b.length;y++){var S=b[y];g.add(S.getStructure())}return g.getSelection()}}function Z5e(e){var t=e.query,r=e.layerCount,n=e.wholeResidues,a=e.bondTest,i=e.fixedPoint,o=Math.max(r,0);return function(u){var l=St.UniqueBuilder(u.inputStructure),c=t(u);return u.pushCurrentBond(),u.atomicBond.setTestFn(a),St.forEach(c,function(d,f){var p=d;if(i)for(;;){var h=p.elementCount;if(p=C7(u,n,p),p.elementCount===h)break}else for(var m=0;m<o;m++)p=C7(u,n,p);l.add(p),f%10===0&&u.throwIfTimedOut()}),u.popCurrentBond(),l.getSelection()}}function C7(e,t,r){var n=J5e(e,r);return t?b0(e,e.inputStructure,n):n}function J5e(e,t){for(var r=e.inputStructure,n=r.interUnitBonds,a=new o_(r),i=e.atomicBond,o=0,s=t.units;o<s.length;o++){var u=s[o];if(u.kind!==0){a.beginUnit(u.id);for(var l=0,c=u.elements.length;l<c;l++)a.addElement(u.elements[l]);a.commitUnit();continue}var d=r.unitMap.get(u.id),f=d.bonds,p=f.offset,h=f.b,m=f.edgeProps,v=m.flags,g=m.order;i.setStructure(r),i.a.unit=d,i.b.unit=d;for(var l=0,c=u.elements.length;l<c;l++){a.addToUnit(u.id,u.elements[l]);for(var y=nt.indexOf(d.elements,u.elements[l]),b=p[y],S=p[y+1];b<S;b++){var x=h[b],C=d.elements[x];nt.has(u.elements,C)||a.has(u.id,C)||(i.aIndex=y,i.a.element=u.elements[l],i.bIndex=x,i.b.element=C,i.type=v[b],i.order=g[b],i.test(e,!0)&&a.addToUnit(u.id,C))}}for(var w=0,_=n.getConnectedUnits(d.id);w<_.length;w++)for(var E=_[w],P=t.unitMap.get(E.unitB),D=r.unitMap.get(E.unitB),k=0,F=E.connectedIndices;k<F.length;k++){var X=F[k];if(!!nt.has(u.elements,d.elements[X]))for(var U=0,j=E.getEdges(X);U<j.length;U++){var te=j[U],C=D.elements[te.indexB];P&&nt.has(P.elements,C)||a.has(E.unitB,C)||(i.a.unit=d,i.aIndex=X,i.a.element=d.elements[X],i.b.unit=D,i.bIndex=te.indexB,i.b.element=C,i.type=te.props.flag,i.order=te.props.order,i.test(e,!0)&&a.addToUnit(E.unitB,C))}}}return a.getStructure()}function eIe(e){var t=e.query,r=e.radius,n=e.includeWater;return function(i){for(var o=St.unionStructure(t(i)),s=b0(i,i.inputStructure,A5(i,i.inputStructure,o,{radius:r})),u=nIe(i.inputStructure),l=aIe(i.inputStructure),c=ot.create(s),d=new Map,f=new zy({checkOperator:!0}),p=0,h=s.units;p<h.length;p++){var m=h[p];if(m.kind===0){c.unit=m;for(var v=m.elements,g=pr.transientSegments(m.model.atomicHierarchy.chainAtomSegments,v),y=pr.transientSegments(m.model.atomicHierarchy.residueAtomSegments,v);g.hasNext;){var b=g.move();c.element=v[b.start];var S=mt.chain.label_asym_id(c),x=mt.unit.operator_name(c);if(u.has(S)){d.has(S)?ho(d.get(S),x):d.set(S,[x]);continue}var C=mt.entity.type(c);if(!(C==="water"||C==="polymer"))for(y.setSegment(b);y.hasNext;){var w=y.move();c.element=v[w.start],l.addComponent(zy.getEntryFromLocation(c),f)}}i.throwIfTimedOut()}}for(var _=i.inputStructure.subsetBuilder(!0),E=0,P=i.inputStructure.units;E<P.length;E++){var m=P[E];if(m.kind===0){c.unit=m;var v=m.elements,g=pr.transientSegments(m.model.atomicHierarchy.chainAtomSegments,v),y=pr.transientSegments(m.model.atomicHierarchy.residueAtomSegments,v);for(_.beginUnit(m.id);g.hasNext;){var b=g.move();c.element=v[b.start];var S=mt.chain.label_asym_id(c),x=mt.unit.operator_name(c);if(d.has(S)&&d.get(S).indexOf(x)>=0){_.addElementRange(v,b.start,b.end);continue}if(!!f.hasLabelAsymId(S))for(y.setSegment(b);y.hasNext;){var w=y.move();c.element=v[w.start],f.has(c)&&_.addElementRange(v,w.start,w.end)}}_.commitUnit(),i.throwIfTimedOut()}}var D=U1(i.inputStructure,[_.getStructure(),o]);if(n){for(var k=new o_(i.inputStructure),F=i.inputStructure.lookup3d,X=0,U=D.units;X<U.length;X++){for(var m=U[X],j=m.conformation,te=j.x,q=j.y,W=j.z,v=m.elements,V=0,ee=v.length;V<ee;V++){var ue=v[V];F.findIntoBuilderIf(te(ue),q(ue),W(ue),r,k,rIe),k.addToUnit(m.id,ue)}i.throwIfTimedOut()}return St.Sequence(i.inputStructure,[k.getStructure()])}else return St.Sequence(i.inputStructure,[D])}}var tIe=mt.entity.type;function rIe(e){return tIe(e)==="water"}function nIe(e){var t=e.models[0],r=new Set;if(!xn.is(t.sourceData))return r;for(var n=t.sourceData.data.db.pdbx_molecule,a=n._rowCount,i=n.asym_id,o=0;o<a;o++)r.add(i.value(o));return r}function aIe(e){var t,r,n=e.models[0],a=new iIe;if(!xn.is(n.sourceData))return a;for(var i=n.sourceData.data.db.struct_conn,o=i.conn_type_id,s=i.ptnr1_label_asym_id,u=i.ptnr1_label_comp_id,l=i.ptnr1_label_seq_id,c=i.ptnr1_symmetry,d=i.pdbx_ptnr1_label_alt_id,f=i.pdbx_ptnr1_PDB_ins_code,p=i.ptnr2_label_asym_id,h=i.ptnr2_label_comp_id,m=i.ptnr2_label_seq_id,v=i.ptnr2_symmetry,g=i.pdbx_ptnr2_label_alt_id,y=i.pdbx_ptnr2_PDB_ins_code,b=0;b<i._rowCount;b++){var S=o.value(b);if(!(S!=="covale"&&S!=="metalc")){var x={label_asym_id:s.value(b),label_comp_id:u.value(b),label_seq_id:l.value(b),label_alt_id:d.value(b),ins_code:f.value(b),operator_name:(t=c.value(b))!==null&&t!==void 0?t:"1_555"},C={label_asym_id:p.value(b),label_comp_id:h.value(b),label_seq_id:m.value(b),label_alt_id:g.value(b),ins_code:y.value(b),operator_name:(r=v.value(b))!==null&&r!==void 0?r:"1_555"};a.addEdge(x,C)}}return a}var iIe=function(){function e(){this.vertices=new Map,this.edges=new Map}return e.prototype.addVertex=function(t,r){this.vertices.has(r)||(this.vertices.set(r,t),this.edges.set(r,[]))},e.prototype.addEdge=function(t,r){var n=zy.getLabel(t),a=zy.getLabel(r);this.addVertex(t,n),this.addVertex(r,a),ho(this.edges.get(n),a),ho(this.edges.get(a),n)},e.prototype.addComponent=function(t,r){var n=zy.getLabel(t);if(!this.vertices.has(n)){r.add(t);return}var a=new Set,i=new Set,o=[n];for(i.add(n),r.add(t);o.length>0;){var s=o.pop();a.add(s);for(var u=this.vertices.get(s),l=0,c=this.edges.get(s);l<c.length;l++){var d=c[l];if(!a.has(d)&&(o.push(d),!i.has(d))){i.add(d);var f=this.vertices.get(d);u.operator_name===f.operator_name?r.add(T(T({},f),{operator_name:t.operator_name})):r.add(f)}}}},e}(),oIe=Object.freeze({__proto__:null,wholeResidues:j5e,includeSurroundings:W5e,querySelection:X5e,intersectBy:Y5e,exceptBy:K5e,union:$5e,expandProperty:Q5e,includeConnected:Z5e,surroundingLigands:eIe});function sIe(e,t,r,n,a,i){return t.elementCount===0||r.elementCount===0?!0:t.elementCount<=r.elementCount?XC.check(e,t,r,n,a,i):XC.check(e,r,t,n,a,i)}function uIe(e,t,r,n,a){return t.elementCount===0||r.elementCount===0?!0:t.elementCount<=r.elementCount?YC.check(e,t,r,n,a):YC.check(e,r,t,n,a)}var XC;(function(e){var t=A.zero();function r(o,s,u,l,c,d,f){var p=s.elements,h=s.conformation.position,m=t;o.element.unit=s;for(var v=!1,g=0,y=p.length;g<y;g++){var b=p[g];o.element.element=b;var S=Math.max(0,A.distance(u,h(b,m))-l-f(o));if(S<c)return 0;S<d&&(v=!0)}return v?1:2}function n(o,s,u,l,c,d,f){for(var p=s.units,h=!1,m=0,v=p.length;m<v;m++){var g=r(o,p[m],u,l,c,d,f);if(g===0)return 0;g===1&&(h=!0)}return h?1:2}e.toPoint=n;var a=A.zero();function i(o,s,u,l,c,d){if(s.elementCount===0||u.elementCount===0)return 0;var f=s.units,p=!1;o.element.structure=s;for(var h=0,m=f.length;h<m;h++){var v=f[h],g=v.elements,y=v.conformation.position;o.element.unit=v;for(var b=0,S=g.length;b<S;b++){var x=g[b];o.element.element=x;var C=n(o,u,y(x,a),d(o),l,c,d);if(C===0)return 0;C===1&&(p=!0)}}return p}e.check=i})(XC||(XC={}));var YC;(function(e){var t=A.zero();function r(o,s,u,l,c,d){var f=s.elements,p=s.conformation.position,h=t;o.element.unit=s;for(var m=0,v=f.length;m<v;m++){var g=f[m];if(o.element.element=g,Math.max(0,A.distance(u,p(g,h))-l-d(o))<=c)return!0}return!1}function n(o,s,u,l,c,d){for(var f=s.units,p=0,h=f.length;p<h;p++)if(r(o,f[p],u,l,c,d))return!0;return!1}e.toPoint=n;var a=A.zero();function i(o,s,u,l,c){if(s.elementCount===0||u.elementCount===0)return 0;var d=s.units;o.element.structure=s;for(var f=0,p=d.length;f<p;f++){var h=d[f];o.element.unit=h;for(var m=h.elements,v=h.conformation.position,g=0,y=m.length;g<y;g++){var b=m[g];if(o.element.element=b,n(o,u,v(b,a),c(o),l,c))return!0}}return!1}e.check=i})(YC||(YC={}));function lIe(e,t){return function(r){var n=e(r),a=St.LinearBuilder(r.inputStructure);return r.pushCurrentElement(),St.forEach(n,function(i,o){r.currentStructure=i,t(r)&&a.add(i),o%100&&r.throwIfTimedOut()}),r.popCurrentStructure(),a.getSelection()}}function cIe(e){return function(t){var r=e(t),n=St.LinearBuilder(t.inputStructure);if(r.kind==="singletons"){if(r.structure.elementCount>0){var a=r.structure.units[0],i=$e.create([a.getChild(nt.ofSingleton(a.elements[0]))],{parent:t.inputStructure});n.add(i)}}else r.structures.length>0&&n.add(r.structures[0]);return n.getSelection()}}function Bk(e,t,r){var n=e.currentStructure.units,a=e.pushCurrentElement();a.structure=e.currentStructure;for(var i=0,o=n;i<o.length;i++){var s=o[i];a.unit=s;var u=s.elements,l=void 0;if(We.isAtomic(s)?l=t.atomic:l=t.coarse,!!l){for(var c=0,d=u.length;c<d;c++)a.element=u[c],r.add(l(e));e.throwIfTimedOut()}}return e.popCurrentElement(),r}function dIe(e,t,r){var n=new Set,a=t(e);return e.pushCurrentElement(),St.forEach(a,function(i,o){e.currentStructure=i,Bk(e,r,n),o%10&&e.throwIfTimedOut()}),e.popCurrentElement(),n}function fIe(e,t,r){return function(n){var a=e(n),i=dIe(n,t,r),o=St.LinearBuilder(n.inputStructure);return n.pushCurrentStructure(),St.forEach(a,function(s,u){n.currentStructure=s;var l=Bk(n,r,new Set);Aa.isSuperset(l,i)&&o.add(s),u%10&&n.throwIfTimedOut()}),n.popCurrentStructure(),o.getSelection()}}function pIe(e,t){return function(r){var n=St.unionStructure(t(r)),a=St.LinearBuilder(r.inputStructure);return St.forEach(e(r),function(i,o){i_(n,i)&&a.add(i),o%10&&r.throwIfTimedOut()}),a.getSelection()}}function hIe(e){return function(t){var r={queryCtx:t,selection:e.query(t),target:e.target(t),maxRadius:e.maxRadius,minRadius:e.minRadius?Math.max(0,e.minRadius):0,elementRadius:e.elementRadius,invert:!!e.invert};return r.minRadius===0&&typeof e.minRadius>"u"?mIe(r):r.minRadius===0?vIe(r):gIe(r)}}function mIe(e){var t=e.queryCtx,r=e.selection,n=e.target,a=e.maxRadius,i=e.invert,o=St.unionStructure(n).lookup3d,s=St.LinearBuilder(t.inputStructure),u=A.zero();return St.forEach(r,function(l,c){for(var d=l.units,f=!1,p=0,h=d.length;p<h;p++){for(var m=d[p],v=m.elements,g=m.conformation,y=g.position,b=g.r,S=0,x=v.length;S<x;S++){var C=v[S];if(y(C,u),o.check(u[0],u[1],u[2],a+b(C))){f=!0;break}}if(f)break}i&&(f=!f),f&&s.add(l),c%10===0&&t.throwIfTimedOut()}),s.getSelection()}function vIe(e){var t=e.queryCtx,r=e.selection,n=e.target,a=e.maxRadius,i=e.invert,o=e.elementRadius,s=St.unionStructure(n),u=St.LinearBuilder(t.inputStructure);return t.pushCurrentElement(),St.forEach(r,function(l,c){var d=uIe(t,s,l,a,o);i&&(d=!d),d&&u.add(l),c%10===0&&t.throwIfTimedOut()}),t.popCurrentElement(),u.getSelection()}function gIe(e){var t=e.queryCtx,r=e.selection,n=e.target,a=e.minRadius,i=e.maxRadius,o=e.invert,s=e.elementRadius,u=St.unionStructure(n),l=St.LinearBuilder(t.inputStructure);return t.pushCurrentElement(),St.forEach(r,function(c,d){var f=sIe(t,u,c,a,i,s);o&&(f=!f),f&&l.add(c),d%10===0&&t.throwIfTimedOut()}),t.popCurrentElement(),l.getSelection()}function yIe(e,t){var r=e.queryCtx,n=e.input,a=e.target,i=e.disjunct,o=r.atomicBond,s=n.interUnitBonds;o.setStructure(n);for(var u=0,l=t.units;u<l.length;u++){var c=l[u];if(!!We.isAtomic(c))for(var d=n.unitMap.get(c.id),f=d.bonds,p=f.offset,h=f.b,m=f.edgeProps,v=m.flags,g=m.order,y=s.getConnectedUnits(c.id),b=y.length,S=c.elements,x=d.elements,C=0,w=S.length;C<w;C++){var _=nt.indexOf(x,S[C]);o.a.unit=d,o.b.unit=d;for(var E=p[_],P=p[_+1];E<P;E++)if(o.b.element=d.elements[h[E]],!(i&&nt.has(c.elements,o.b.element))&&!!a.hasElement(o.b)&&(o.aIndex=_,o.a.element=S[C],o.bIndex=h[E],o.type=v[E],o.order=g[E],o.test(r,!0)))return!0;for(var D=0;D<b;D++)for(var k=y[D],F=n.unitMap.get(k.unitB),X=F.elements,U=k.getEdges(_),j=0,te=U.length;j<te;j++){var q=U[j];if(o.b.unit=F,o.b.element=X[q.indexB],!!a.hasElement(o.b)&&!(i&&t.hasElement(o.b))&&(o.a.unit=d,o.aIndex=_,o.a.element=S[C],o.bIndex=q.indexB,o.type=q.props.flag,o.order=q.props.order,o.test(r,!0)))return!0}}}return!1}function bIe(e){var t=e.query,r=e.target,n=e.disjunct,a=e.invert,i=e.bondTest;return function(o){var s=r(o);if(St.isEmpty(s))return s;var u=t(o);if(St.isEmpty(u))return u;var l={queryCtx:o,input:o.inputStructure,disjunct:n,target:St.unionStructure(s)},c=St.LinearBuilder(o.inputStructure);return o.pushCurrentBond(),o.atomicBond.setTestFn(i),St.forEach(u,function(d,f){(yIe(l,d)||a)&&c.add(d),f%5===0&&o.throwIfTimedOut()}),o.popCurrentBond(),c.getSelection()}}var xIe=Object.freeze({__proto__:null,pick:lIe,first:cIe,getCurrentStructureProperties:Bk,withSameAtomProperties:fIe,areIntersectedBy:pIe,within:hIe,isConnectedTo:bIe});function SIe(e){return e.length===0?kk:e.length===1?e[0]:function(t){for(var r=St.UniqueBuilder(t.inputStructure),n=function(i){St.forEach(e[i](t),function(o,s){r.add(o),i%100&&t.throwIfTimedOut()})},a=0;a<e.length;a++)n(a);return r.getSelection()}}function CIe(e){return e.length===0?kk:e.length===1?e[0]:function(t){for(var r=[],n=0;n<e.length;n++)r.push(e[n](t));for(var a=0,i=St.structureCount(r[0]),n=1;n<r.length;n++){var o=St.structureCount(r[n]);o<i&&(a=n,i=o)}t.throwIfTimedOut();var s=tk(function(c){return c.hashCode},$e.areUnitIdsAndIndicesEqual);St.forEach(r[a],function(c){return s.add(c)});for(var u=St.UniqueBuilder(t.inputStructure),l=0;l<r.length;l++)l!==a&&(St.forEach(r[l],function(c){s.has(c)&&u.add(c)}),t.throwIfTimedOut());return u.getSelection()}}var wIe=Object.freeze({__proto__:null,merge:SIe,intersect:CIe}),T5;(function(e){function t(f){return!!f&&!!f.has}function r(f,p){return function(h){return f(h)===p}}e.eq=r;function n(f,p){return function(h){return f(h)<p}}e.lt=n;function a(f,p){return function(h){return f(h)<=p}}e.lte=a;function i(f,p){return function(h){return f(h)>p}}e.gt=i;function o(f,p){return function(h){return f(h)>=p}}e.gte=o;function s(f){return!0}function u(f){return!1}function l(f,p){if(t(p))return function(v){return p.has(f(v))};if(p.length===0)return u;for(var h=new Set,m=0;m<p.length;m++)h.add(p[m]);return function(v){return h.has(f(v))}}e.inSet=l;function c(){for(var f=[],p=0;p<arguments.length;p++)f[p]=arguments[p];switch(f.length){case 0:return s;case 1:return f[0];case 2:{var h=f[0],m=f[1];return function(W){return h(W)&&m(W)}}case 3:{var v=f[0],g=f[1],y=f[2];return function(W){return v(W)&&g(W)&&y(W)}}case 4:{var b=f[0],S=f[1],x=f[2],C=f[3];return function(W){return b(W)&&S(W)&&x(W)&&C(W)}}case 5:{var w=f[0],_=f[1],E=f[2],P=f[3],D=f[4];return function(W){return w(W)&&_(W)&&E(W)&&P(W)&&D(W)}}case 6:{var k=f[0],F=f[1],X=f[2],U=f[3],j=f[4],te=f[5];return function(W){return k(W)&&F(W)&&X(W)&&U(W)&&j(W)&&te(W)}}default:{var q=f.length;return function(W){for(var V=0;V<q;V++)if(!f[V])return!1;return!0}}}}e.and=c;function d(){for(var f=[],p=0;p<arguments.length;p++)f[p]=arguments[p];switch(f.length){case 0:return u;case 1:return f[0];case 2:{var h=f[0],m=f[1];return function(W){return h(W)||m(W)}}case 3:{var v=f[0],g=f[1],y=f[2];return function(W){return v(W)||g(W)||y(W)}}case 4:{var b=f[0],S=f[1],x=f[2],C=f[3];return function(W){return b(W)||S(W)||x(W)||C(W)}}case 5:{var w=f[0],_=f[1],E=f[2],P=f[3],D=f[4];return function(W){return w(W)||_(W)||E(W)||P(W)||D(W)}}case 6:{var k=f[0],F=f[1],X=f[2],U=f[3],j=f[4],te=f[5];return function(W){return k(W)||F(W)||X(W)||U(W)||j(W)||te(W)}}default:{var q=f.length;return function(W){for(var V=0;V<q;V++)if(f[V])return!0;return!1}}}}e.or=d})(T5||(T5={}));var un={generators:YPe,filters:xIe,modifiers:oIe,combinators:wIe,pred:T5,internal:LPe},Gl;(function(e){function t(c,d){var f=this;return Qe.create("Build Assembly",function(p){return pe(f,void 0,void 0,function(){var h,m,v,g,y,b,S,x,C,w,_,E,P,D,k,F;return he(this,function(X){if(h=c.models,h.length!==1)throw new Error("Can only build assemblies from structures based on 1 model.");if(m=B1.findAssembly(h[0],d),!m)throw new Error("Assembly '"+d+"' is not defined.");for(v=An.create(m.id,de.identity(),{assembly:{id:m.id,operId:0,operList:[]}}),g=$e.Builder({coordinateSystem:v,label:c.label}),y=new As(c),b=0,S=m.operatorGroups;b<S.length;b++)if(x=S[b],C=x.selector(y),St.structureCount(C)!==0)for(w=St.unionStructure(C).units,_=0,E=x.operators;_<E.length;_++)for(P=E[_],D=0,k=w;D<k.length;D++)F=k[D],g.addWithOperator(F,P);return[2,g.getStructure()]})})})}e.buildAssembly=t;function r(c,d,f){var p=this;return Qe.create("Build Symmetry Assembly",function(h){return pe(p,void 0,void 0,function(){var m,v,g,y,b,S,x,C,w,_,E,P,D,k,F,X,U,j,te,q,W,V,ee,ue,$;return he(this,function(Q){if(m=c.models,m.length!==1)throw new Error("Can only build symmetry assemblies from structures based on 1 model.");for(v=A(),g=$e.Builder({label:c.label,representativeModel:m[0]}),y=new As(c),b=0,S=d;b<S.length;b++)if(x=S[b],C=_Ie(x.asymIds),w=C(y),St.structureCount(w)!==0)for(_=St.unionStructure(w).units,E=0,P=x.operators;E<P.length;E++)for(D=P[E],k=D.index,F=D.shift,X=F[0],U=F[1],j=F[2],te=YX(f,k,X,U,j,v),q=0,W=_;q<W.length;q++)for(V=W[q],ee=0,ue=te;ee<ue.length;ee++)$=ue[ee],g.addWithOperator(V,$);return[2,g.getStructure()]})})})}e.buildSymmetryAssembly=r;function n(c,d){return Qe.create("Find Symmetry Mates",function(f){return PIe(f,c,d)})}e.builderSymmetryMates=n;function a(c,d,f){return Qe.create("Build Symmetry",function(p){return EIe(p,c,d,f)})}e.buildSymmetryRange=a;function i(c){return Qe.create("Build NCS",function(d){return TIe(d,c)})}e.buildNcs=i;function o(c,d){return c.invariantId===d.invariantId&&c.model.id===d.model.id&&nt.areEqual(c.elements,d.elements)}e.areUnitsEquivalent=o;function s(){return Fge(We.hashUnit,o)}e.UnitEquivalenceBuilder=s;function u(c){for(var d=s(),f=0,p=c.units;f<p.length;f++){var h=p[f];d.add(h.id,h)}for(var m=[],v=0,g=d.groups;v<g.length;v++){var y=g[v];m.push(We.SymmetryGroup(y.map(function(b){return c.unitMap.get(b)})))}return m}e.computeTransformGroups=u;function l(c,d){if(c.length!==d.length)return!1;for(var f=0,p=c.length;f<p;++f){var h=c[f].units,m=d[f].units;if(h.length!==m.length||c[f].hashCode!==d[f].hashCode)return!1;for(var v=0,g=h.length;v<g;v++)if(h[v].conformation!==m[v].conformation)return!1}return!0}e.areTransformGroupsEquivalent=l})(Gl||(Gl={}));function _Ie(e){return un.generators.atoms({chainTest:un.pred.and(un.pred.eq(function(t){return mt.unit.operator_name(t.element)},An.DefaultName),un.pred.inSet(function(t){return mt.chain.label_asym_id(t.element)},e))})}function YX(e,t,r,n,a,i){var o=e.spacegroup,s=e.ncsOperators,u=[],l=o.cell.toFractional,c=A.transformMat4(A(),i,l),d=al.getSymmetryOperatorRef(o,t,r,n,a,c);if(s&&s.length)for(var f=0,p=s.length;f<p;++f){var h=s[f],m=de.mul(de(),d.matrix,h.matrix),v=An.create(d.name+" "+h.name,m,{assembly:d.assembly,ncsId:h.ncsId,hkl:d.hkl,spgrOp:d.spgrOp});u.push(v)}else u.push(d);return u}function KX(e,t,r,n){var a=e.spacegroup,i=e.ncsOperators,o=i&&i.length||0,s=[];!o&&t[0]<=0&&r[0]>=0&&t[1]<=0&&r[1]>=0&&t[2]<=0&&r[2]>=0&&(s[0]=al.getSymmetryOperator(a,0,0,0,0));for(var u=a.cell.toFractional,l=A.transformMat4(A(),n,u),c=0;c<a.operators.length;c++)for(var d=t[0];d<=r[0];d++)for(var f=t[1];f<=r[1];f++)for(var p=t[2];p<=r[2];p++)!o&&c===0&&d===0&&f===0&&p===0||s.push.apply(s,YX(e,c,d,f,p,l));return s}function AIe(e,t){return e._operators_333&&A.equals(t,e._operators_333.ref)||(e._operators_333={ref:A.clone(t),operators:KX(e,A.create(-3,-3,-3),A.create(3,3,3),t)}),e._operators_333.operators}function $X(e,t){for(var r=$e.Builder({label:e.label}),n=e.units,a=0,i=t;a<i.length;a++)for(var o=i[a],s=0,u=n;s<u.length;s++){var l=u[s];r.addWithOperator(l,o)}return r.getStructure()}function TIe(e,t){return pe(this,void 0,void 0,function(){var r,n,a;return he(this,function(i){if(r=t.models,r.length!==1)throw new Error("Can only build NCS from structures based on 1 model.");return n=wa.Provider.get(r[0]),n?(a=n.ncsOperators,!a||!a.length?[2,t]:[2,$X(t,a)]):[2,t]})})}function EIe(e,t,r,n){return pe(this,void 0,void 0,function(){var a,i,o,s,u;return he(this,function(l){if(a=t.models,a.length!==1)throw new Error("Can only build symmetries from structures based on 1 model.");return i=wa.Provider.get(a[0]),i?(o=i.spacegroup,Go.isZero(o.cell)?[2,t]:(s=rr.getCenter(a[0]),u=KX(i,r,n,s),[2,$X(t,u)])):[2,t]})})}function PIe(e,t,r){return pe(this,void 0,void 0,function(){function n(P,D){return P.invariantId+"|"+D.name}var a,i,o,s,u,l,c,d,f,p,h,m,v,g,y,b,S,x,C,w,_,E;return he(this,function(P){switch(P.label){case 0:if(a=t.models,a.length!==1)throw new Error("Can only build symmetries from structures based on 1 model.");return i=wa.Provider.get(a[0]),i?(o=i.spacegroup,Go.isZero(o.cell)?[2,t]:e.shouldUpdate?[4,e.update("Initialing...")]:[3,2]):[2,t];case 1:P.sent(),P.label=2;case 2:s=rr.getCenter(a[0]),u=AIe(i,s),l=t.lookup3d,c=new Set,d=$e.Builder({label:t.label}),f=t.units,p=A.zero(),h=0,m=u,P.label=3;case 3:if(!(h<m.length))return[3,6];for(v=m[h],g=0,y=f;g<y.length;g++)for(b=y[g],S=b.lookup3d.boundary.sphere,A.transformMat4(p,S.center,v.matrix),x=l.findUnitIndices(p[0],p[1],p[2],S.radius+r),C=0,w=x.count;C<w;C++)_=f[x.indices[C]],_.lookup3d.check(p[0],p[1],p[2],S.radius+r)&&(E=n(b,v),c.has(E)||(d.addWithOperator(b,v),c.add(E)));return e.shouldUpdate?[4,e.update("Building symmetry...")]:[3,5];case 4:P.sent(),P.label=5;case 5:return h++,[3,3];case 6:return[2,d.getStructure()]}})})}var IIe=function(){function e(t,r){this.parent=t,this.isSorted=r,this.ids=[],this.unitMap=hu.Mutable(),this.parentId=-1,this.currentUnit=[],this.elementCount=0}return e.prototype.addToUnit=function(t,r){var n=this.unitMap.get(t);n?n[n.length]=r:(this.unitMap.set(t,[r]),this.ids[this.ids.length]=t),this.elementCount++},e.prototype.beginUnit=function(t){this.parentId=t,this.currentUnit=this.currentUnit.length>0?[]:this.currentUnit},e.prototype.addElement=function(t){this.currentUnit[this.currentUnit.length]=t,this.elementCount++},e.prototype.addElementRange=function(t,r,n){for(var a=r;a<n;a++)this.currentUnit[this.currentUnit.length]=t[a],this.elementCount++},e.prototype.commitUnit=function(){this.currentUnit.length!==0&&(this.ids[this.ids.length]=this.parentId,this.unitMap.set(this.parentId,this.currentUnit),this.parentId=-1)},e.prototype.setUnit=function(t,r){this.ids[this.ids.length]=t,this.unitMap.set(t,r),this.elementCount+=r.length},e.prototype._getStructure=function(t){if(this.isEmpty)return $e.Empty;var r=[];Wu(this.ids);for(var n=Gl.UnitEquivalenceBuilder(),a=0,i=this.ids.length;a<i;a++){var o=this.ids[a],s=this.parent.unitMap.get(o),u=this.unitMap.get(o),l=!1;t&&(this.isSorted||Wu(u),u=nt.deduplicate(nt.ofSortedArray(this.currentUnit)),l=!0);var c=u.length;if(u.length===s.elements.length){r[r.length]=s,n.add(s.id,s);continue}!this.isSorted&&!l&&c>1&&Wu(u);var d=s.getChild(nt.ofSortedArray(u)),f=n.add(d.id,d);d!==f&&(d=f.applyOperator(d.id,d.conformation.operator,!0)),r[r.length]=d}return $e.create(r,{parent:this.parent})},e.prototype.getStructure=function(){return this._getStructure(!1)},e.prototype.getStructureDeduplicate=function(){return this._getStructure(!0)},e.prototype.setSingletonLocation=function(t){var r=this.ids[0];t.unit=this.parent.unitMap.get(r),t.element=this.unitMap.get(r)[0]},Object.defineProperty(e.prototype,"isEmpty",{get:function(){return this.elementCount===0},enumerable:!1,configurable:!0}),e}();function w7(e,t){for(var r=1;t--;)r*=e--;return r}function MIe(e,t){return t>e?0:w7(e,t)/w7(t,t)}function DIe(e){var t=e&-e,r=e+t,n=r&-r,a=(n/t>>1)-1;return r|a}var kIe=function(){function e(t,r){this.array=t,this.hasNext=!1,this.index=(1<<r)-1,this.size=MIe(t.length,r),this.maxIndex=1<<t.length,this.value=new Array(r),this.hasNext=r>0&&r<=t.length}return e.prototype.move=function(){if(this.hasNext){for(var t=0,r=0,n=this.index;n;n>>>=1,t++)n&1&&(this.value[r++]=this.array[t]);this.index=DIe(this.index),this.hasNext=this.index<this.maxIndex}return this.value},e}();function QX(e,t){for(var r=[],n=new kIe(e,t);n.hasNext;)r.push(n.move().slice());return r}var Qp=[],RIe={links:Qp,terminalLinks:Qp,elements:Qp,partialElements:Qp,getElementIndices:function(){return Qp},getLinkIndices:function(){return Qp},getTerminalLinkIndices:function(){return Qp}},Va=V0("C"),ny=V0("O"),OIe=[ru.elementFingerprint([Va,Va,Va,ny]),ru.elementFingerprint([Va,Va,Va,Va,ny]),ru.elementFingerprint([Va,Va,Va,Va,Va,ny]),ru.elementFingerprint([Va,Va,Va,Va,Va,Va,ny])];function BIe(e,t){for(var r=-1,n=-1,a=-1,i=-1,o=e.elements,s=e.model.atomicHierarchy.atoms,u=s.type_symbol,l=s.label_atom_id,c=e.bonds,d=c.b,f=c.offset,p=0,h=t.length;p<h;++p){var m=o[t[p]];if(u.value(m)===Va){for(var v=0,g=0,y=f[t[p]],b=f[t[p]+1];y<b;++y){var S=o[d[y]],x=u.value(S);x===ny?++v:x===Va&&++g}if(v===2){r=m;break}else v===1&&g===1?n=m:l.value(m).startsWith("C1")?a=m:i=m}}return r!==-1?r:n!==-1?n:a!==-1?a:i!==-1?i:o[t[0]]}function FIe(e,t){var r=e.elements,n=e.model.atomicHierarchy.atoms.label_alt_id;return n.value(r[t])}function LIe(e,t,r,n){var a=t.conformation.position;return A.normalize(e,A.sub(e,n,a(r,e))),e}function _7(e,t){var r=e.elements,n=e.model.atomicHierarchy.atoms.label_atom_id;return n.value(r[t])}function NIe(e,t){if(!(!t||!t.length)){for(var r=e.unit,n=e.all,a=new Set,i=QX(pu(new Array(t.length)),2),o=0,s=i.length;o<s;++o){var u=i[o],l=n[t[u[0]]],c=n[t[u[1]]];nt.areIntersecting(l,c)&&ru.getAltId(r,l)===ru.getAltId(r,c)&&(a.add(t[u[0]]),a.add(t[u[1]]))}if(a.size){for(var d=[],o=0,s=t.length;o<s;++o)a.has(t[o])||d.push(t[o]);return d}else return t}}function zIe(e,t){return t.properties.saccharideComponentMap.get(e)}function UIe(e){if(e.models.reduce(function(me,xe){return me+xe.properties.saccharideComponentMap.size},0)===0)return RIe;var t=[],r=[],n=[],a=[],i=new Map;function o(me,xe,Se){return me+"|"+xe+"|"+Se}function s(me,xe){i.has(me)?i.get(me).push(xe):i.set(me,[xe])}function u(me,xe){A.sub(n[me].geometry.direction,n[xe].geometry.center,n[me].geometry.center),A.normalize(n[me].geometry.direction,n[me].geometry.direction)}var l=A.zero();function c(me,xe,Se){var ie=Se.conformation.position,le=n[me].geometry;A.sub(le.direction,ie(Se.elements[xe],l),le.center),A.normalize(le.direction,le.direction)}for(var d=0,f=e.units.length;d<f;++d){var p=e.units[d];if(!!We.isAtomic(p))for(var h=p.model,m=p.rings,v=h.atomicHierarchy,g=v.chainAtomSegments,y=v.residueAtomSegments,b=v.atoms,S=b.label_comp_id,x=pr.transientSegments(g,p.elements),C=pr.transientSegments(y,p.elements),w=void 0;x.hasNext;)for(C.setSegment(x.move());C.hasNext;){var _=C.move().index,E=zIe(S.value(y.offsets[_]),h);if(!!E){w||(w=GC.byFingerprintAndResidue(m,OIe));var P=NIe(m,w.get(_));if(!P||!P.length){a.push({unit:p,residueIndex:_,component:E});continue}for(var D=[],k=0,F=P.length;k<F;++k){var X=m.all[P[k]],U=BIe(p,X),j=um.calculateMomentsAxes(UX(p,X)),te=A.copy(A.zero(),j.origin),q=A.copy(A.zero(),j.dirC),W=LIe(A.zero(),p,U,te);A.orthogonalize(W,q,W);var V=ru.getAltId(p,X),ee=n.length;D.push(ee),s(o(_,p.id,V),ee),V&&s(o(_,p.id,""),ee),n.push({geometry:{center:te,normal:q,direction:W},component:E,ringIndex:P[k],altId:V,unit:p,residueIndex:_})}for(var ue=QX(pu(new Array(P.length)),2),k=0,F=ue.length;k<F;++k){var $=ue[k],Q=m.all[P[$[0]]],R=m.all[P[$[1]]];if(qo.areVertexSetsConnected(p.bonds,Q,R,3)){var Y=D[$[0]],re=D[$[1]];n[Y].altId===n[re].altId&&(u(Y,re),u(re,Y),t.push({carbohydrateIndexA:Y,carbohydrateIndexB:re}),t.push({carbohydrateIndexA:re,carbohydrateIndexB:Y}))}}}}}function K(me,xe){return i.get(o(me.getResidueIndex(xe),me.id,FIe(me,xe)))||[]}for(var d=0,f=n.length;d<f;++d)for(var L=n[d],p=L.unit,k=d+1;k<f;++k){var H=n[k];if(!(p!==H.unit||L.residueIndex===H.residueIndex)){var Z=p.rings.all[L.ringIndex],fe=p.rings.all[H.ringIndex];qo.areVertexSetsConnected(p.bonds,Z,fe,3)&&(u(d,k),u(k,d),t.push({carbohydrateIndexA:d,carbohydrateIndexB:k}),t.push({carbohydrateIndexA:k,carbohydrateIndexB:d}))}}for(var d=0,f=e.units.length;d<f;++d){var p=e.units[d];!We.isAtomic(p)||e.interUnitBonds.getConnectedUnits(p.id).forEach(function(ie){ie.connectedIndices.forEach(function(le){ie.getEdges(le).forEach(function(O){var G=O.props,ve=O.indexB;if(!!$r.isCovalent(G.flag)){var we=e.unitMap.get(ie.unitA),Te=e.unitMap.get(ie.unitB),Ue=K(we,le),Ge=K(Te,ve);if(Ue.length>0&&Ge.length>0)for(var Je=Ue.length,st=Ge.length,ze=0,et=Math.max(Je,st);ze<et;++ze){var ut=Ue[Math.min(ze,Je-1)],pt=Ge[Math.min(ze,st-1)],ht=_7(we,le);(ht.startsWith("O1")||ht.startsWith("C1"))&&u(ut,pt),t.push({carbohydrateIndexA:ut,carbohydrateIndexB:pt})}else if(Ge.length===0)for(var Re=0,it=Ue;Re<it.length;Re++){var ut=it[Re],ht=_7(we,le);(ht.startsWith("O1")||ht.startsWith("C1"))&&c(ut,ve,Te),r.push({carbohydrateIndex:ut,elementIndex:ve,elementUnit:Te,fromCarbohydrate:!0})}else if(Ue.length===0)for(var Fe=0,tt=Ge;Fe<tt.length;Fe++){var pt=tt[Fe];r.push({carbohydrateIndex:pt,elementIndex:le,elementUnit:we,fromCarbohydrate:!1})}}})})})}return T({links:t,terminalLinks:r,elements:n,partialElements:a},VIe(n,t,r))}function VIe(e,t,r){function n(F,X){return op(F.id,X)}function a(F,X,U){var j=[],te=F.get(n(X,U));if(te!==void 0)for(var q=0,W=te;q<W.length;q++){var V=W[q];ho(j,V)}return j}for(var i=new Map,o=0,s=e.length;o<s;++o)for(var u=e[o],l=u.unit,c=u.ringIndex,d=l.rings.all[c],f=0,p=d.length;f<p;++f){var h=n(l,l.elements[d[f]]),m=i.get(h);m===void 0?i.set(h,[o]):m.push(o)}function v(F,X){return a(i,F,X)}for(var g=new Map,o=0,s=t.length;o<s;++o)for(var y=t[o],b=e[y.carbohydrateIndexA],l=b.unit,c=b.ringIndex,d=l.rings.all[c],f=0,p=d.length;f<p;++f){var h=n(l,l.elements[d[f]]),m=g.get(h);m===void 0?g.set(h,[o]):m.push(o)}function S(F,X){return a(g,F,X)}for(var x=new Map,o=0,s=r.length;o<s;++o){var C=r[o],w=C.fromCarbohydrate,_=C.carbohydrateIndex,E=C.elementUnit,P=C.elementIndex;if(w)for(var D=e[_],l=D.unit,c=D.ringIndex,d=l.rings.all[c],f=0,p=d.length;f<p;++f){var h=n(l,l.elements[d[f]]),m=x.get(h);m===void 0?x.set(h,[o]):m.push(o)}else{var h=n(E,E.elements[P]),m=x.get(h);m===void 0?x.set(h,[o]):m.push(o)}}function k(F,X){return a(x,F,X)}return{getElementIndices:v,getLinkIndices:S,getTerminalLinkIndices:k}}var $2=He(),HIe=new Ms("14"),jIe=new Ms("98");function GIe(e){return e>500?HIe:jIe}function qIe(e){var t=e.units,r=GIe(t.length);r.reset();for(var n=0,a=t.length;n<a;n++){var i=t[n],o=i.boundary,s=i.conformation.operator;s.isIdentity?r.includeSphere(o.sphere):(He.transform($2,o.sphere,s.matrix),r.includeSphere($2))}r.finishedIncludeStep();for(var n=0,a=t.length;n<a;n++){var i=t[n],o=i.boundary,s=i.conformation.operator;s.isIdentity?r.radiusSphere(o.sphere):(He.transform($2,o.sphere,s.matrix),r.radiusSphere($2))}return{box:r.getBox(),sphere:r.getSphere()}}var $e=function(){function e(t,r,n,a,i){this.units=t,this.unitMap=r,this.unitIndexMap=n,this.state=a,this._child=i?.child,this._target=i?.target}return e.prototype.subsetBuilder=function(t){return new IIe(this,t)},Object.defineProperty(e.prototype,"elementCount",{get:function(){return this.state.elementCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bondCount",{get:function(){return this.state.bondCount===-1&&(this.state.bondCount=this.interUnitBonds.edgeCount+$t.getIntraUnitBondCount(this)),this.state.bondCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasCustomProperties",{get:function(){return!!this.state.customProps&&this.state.customProps.all.length>0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"customPropertyDescriptors",{get:function(){return this.state.customProps||(this.state.customProps=new fc),this.state.customProps},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentPropertyData",{get:function(){return this.state.propertyData||(this.state.propertyData=Object.create(null)),this.state.propertyData},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"inheritedPropertyData",{get:function(){return this.parent?this.parent.currentPropertyData:this.currentPropertyData},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"polymerResidueCount",{get:function(){return this.state.polymerResidueCount===-1&&(this.state.polymerResidueCount=JIe(this)),this.state.polymerResidueCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"polymerGapCount",{get:function(){return this.state.polymerGapCount===-1&&(this.state.polymerGapCount=eMe(this)),this.state.polymerGapCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"polymerUnitCount",{get:function(){return this.state.polymerUnitCount===-1&&(this.state.polymerUnitCount=tMe(this)),this.state.polymerUnitCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"uniqueElementCount",{get:function(){return this.state.uniqueElementCount===-1&&(this.state.uniqueElementCount=ZIe(this)),this.state.uniqueElementCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"atomicResidueCount",{get:function(){return this.state.atomicResidueCount===-1&&(this.state.atomicResidueCount=rMe(this)),this.state.atomicResidueCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isCoarseGrained",{get:function(){return this.models.some(function(t){return rr.isCoarseGrained(t)})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isEmpty",{get:function(){return this.units.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hashCode",{get:function(){return this.state.hashCode!==-1?this.state.hashCode:this.computeHash()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"transformHash",{get:function(){return this.state.transformHash!==-1?this.state.transformHash:(this.state.transformHash=eo(this.units.map(function(t){return t.id})),this.state.transformHash)},enumerable:!1,configurable:!0}),e.prototype.computeHash=function(){for(var t=23,r=0,n=this.units.length;r<n;r++){var a=this.units[r];t=31*t+a.id|0,t=31*t+nt.hashCode(a.elements)|0}return t=31*t+this.elementCount|0,t=gq(t),t===-1&&(t=0),this.state.hashCode=t,t},e.prototype.elementLocations=function(){return new e.ElementLocationIterator(this)},Object.defineProperty(e.prototype,"root",{get:function(){return this.state.parent||this},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return this.state.parent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"coordinateSystem",{get:function(){return this.state.coordinateSystem},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"label",{get:function(){return this.state.label},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"boundary",{get:function(){return this.state.boundary?this.state.boundary:(this.state.boundary=qIe(this),this.state.boundary)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lookup3d",{get:function(){return this.state.lookup3d?this.state.lookup3d:(this.state.lookup3d=new MPe(this),this.state.lookup3d)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"interUnitBonds",{get:function(){return this.state.interUnitBonds?this.state.interUnitBonds:(this.state.interUnitBonds=ePe(this),this.state.interUnitBonds)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"unitSymmetryGroups",{get:function(){return this.state.unitSymmetryGroups?this.state.unitSymmetryGroups:(this.state.unitSymmetryGroups=Gl.computeTransformGroups(this),this.state.unitSymmetryGroups)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"unitSymmetryGroupsIndexMap",{get:function(){return this.state.unitSymmetryGroupsIndexMap?this.state.unitSymmetryGroupsIndexMap:(this.state.unitSymmetryGroupsIndexMap=We.SymmetryGroup.getUnitSymmetryGroupsIndexMap(this.unitSymmetryGroups),this.state.unitSymmetryGroupsIndexMap)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"carbohydrates",{get:function(){return this.state.carbohydrates?this.state.carbohydrates:(this.state.carbohydrates=UIe(this),this.state.carbohydrates)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"models",{get:function(){return this.state.models?this.state.models:(this.state.models=XIe(this),this.state.models)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"uniqueResidueNames",{get:function(){return this.state.uniqueResidueNames||(this.state.uniqueResidueNames=YIe(this))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"uniqueElementSymbols",{get:function(){return this.state.uniqueElementSymbols||(this.state.uniqueElementSymbols=KIe(this))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"entityIndices",{get:function(){return this.state.entityIndices||(this.state.entityIndices=$Ie(this))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"uniqueAtomicResidueIndices",{get:function(){return this.state.uniqueAtomicResidueIndices||(this.state.uniqueAtomicResidueIndices=QIe(this))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isAtomic",{get:function(){for(var t=0,r=this.units;t<r.length;t++){var n=r[t];if(!We.isAtomic(n))return!1}return!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasAtomic",{get:function(){for(var t=0,r=this.units;t<r.length;t++){var n=r[t];if(We.isAtomic(n))return!0}return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isCoarse",{get:function(){for(var t=0,r=this.units;t<r.length;t++){var n=r[t];if(!We.isCoarse(n))return!1}return!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasCoarse",{get:function(){for(var t=0,r=this.units;t<r.length;t++){var n=r[t];if(We.isCoarse(n))return!0}return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"serialMapping",{get:function(){return this.state.serialMapping||(this.state.serialMapping=nMe(this))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"model",{get:function(){if(this.state.model)return this.state.model;if(this.state.representativeModel)return this.state.representativeModel;if(this.state.masterModel)return this.state.masterModel;var t=this.models;if(t.length>1)throw new Error("The structure is based on multiple models and has neither a master- nor a representative-model.");return this.state.model=t[0],this.state.model},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"masterModel",{get:function(){return this.state.masterModel},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"representativeModel",{get:function(){return this.state.representativeModel},enumerable:!1,configurable:!0}),e.prototype.hasElement=function(t){return this.unitMap.has(t.unit.id)?nt.has(this.unitMap.get(t.unit.id).elements,t.element):!1},e.prototype.getModelIndex=function(t){return this.models.indexOf(t)},e.prototype.remapModel=function(t){for(var r=[],n=0,a=this.unitSymmetryGroups;n<a.length;n++){var i=a[n],o=i.units[0].remapModel(t);r.push(o);for(var s=1,u=i.units.length;s<u;++s){var l=i.units[s];r.push(l.remapModel(t,o.props))}}return e.create(r,{label:this.label,interUnitBonds:this.state.interUnitBonds})},e.prototype.asParent=function(){return this.parent?new e(this.parent.units,this.parent.unitMap,this.parent.unitIndexMap,this.parent.state,{child:this,target:this.parent}):this},Object.defineProperty(e.prototype,"child",{get:function(){return this._child},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){var t;return(t=this._target)!==null&&t!==void 0?t:this},enumerable:!1,configurable:!0}),e}();function WIe(e,t,r){return e[t].id-e[r].id}function XIe(e){for(var t=e.units,r=on.create(),n=0,a=t;n<a.length;n++){var i=a[n];on.add(r,i.model.id,i.model)}return r.array}function YIe(e){for(var t=mt.residue.microheterogeneityCompIds,r=new Set,n=ot.create(e),a=0,i=e.unitSymmetryGroups;a<i.length;a++){var o=i[a],s=o.units[0];if(!!We.isAtomic(s)){var u=pr.transientSegments(s.model.atomicHierarchy.residueAtomSegments,s.elements);for(n.unit=s;u.hasNext;){var l=u.move();n.element=s.elements[l.start];for(var c=t(n),d=0,f=c;d<f.length;d++){var p=f[d];r.add(p)}}}}return r}function KIe(e){for(var t=mt.atom.type_symbol,r=new Set,n=ot.create(e),a=0,i=e.unitSymmetryGroups;a<i.length;a++){var o=i[a],s=o.units[0];if(!!We.isAtomic(s)){n.unit=s;for(var u=0,l=s.elements.length;u<l;++u)n.element=s.elements[u],r.add(t(n))}}return r}function $Ie(e){for(var t=e.units,r=ot.create(e),n=on.create(),a=0,i=t;a<i.length;a++){var o=i[a],s=o.kind===0?mt.entity.key:mt.coarse.entityKey;r.unit=o;for(var u=o.elements,l=pr.transientSegments(o.model.atomicHierarchy.chainAtomSegments,u);l.hasNext;){var c=l.move();r.element=u[c.start];var d=s(r);on.add(n,d,d)}}return Wu(n.array),n.array}function QIe(e){for(var t=new Map,r=[],n=e.unitSymmetryGroups,a=0,i=n;a<i.length;a++){var o=i[a],s=o.units[0];if(!!We.isAtomic(s)){var u=void 0;t.has(s.model.id)?u=t.get(s.model.id):(u=on.create(),r.push(s.model.id),t.set(s.model.id,u));for(var l=pr.transientSegments(s.model.atomicHierarchy.residueAtomSegments,s.elements);l.hasNext;){var c=l.move();on.add(u,c.index,c.index)}}}for(var d=new Map,f=0,p=r;f<p.length;f++){var h=p[f],m=t.get(h).array;Wu(m),d.set(h,m)}return d}function ZIe(e){for(var t=e.unitSymmetryGroups,r=0,n=0,a=t.length;n<a;n++)r+=t[n].elements.length;return r}function JIe(e){for(var t=e.units,r=0,n=0,a=t.length;n<a;n++)r+=t[n].polymerElements.length;return r}function eMe(e){for(var t=e.units,r=0,n=0,a=t.length;n<a;n++)r+=t[n].gapElements.length/2;return r}function tMe(e){for(var t=e.units,r=0,n=0,a=t.length;n<a;n++)t[n].polymerElements.length>0&&(r+=1);return r}function rMe(e){for(var t=e.units,r=0,n=0,a=t.length;n<a;n++){var i=t[n];if(!!We.isAtomic(i))for(var o=i.elements,s=i.residueIndex,u=-1,l=-1,c=0,d=o.length;c<d;++c)u=s[o[c]],u!==l&&(r+=1,l=u)}return r}function nMe(e){for(var t=e.units,r=e.elementCount,n=e.unitIndexMap,a=new Uint32Array(t.length),i=new Uint32Array(r),o=new Uint32Array(r),s=0,u=0,l=t.length;s<l;++s){a[s]=u;for(var c=t[s].elements,d=0,f=c.length;d<f;++d){var p=u+d;i[p]=s,o[p]=c[d]}u+=c.length}return{cumulativeUnitElementCount:a,unitIndices:i,elementIndices:o,getSerialIndex:function(h,m){return a[n.get(h.id)]+Ne.indexOf(h.elements,m)}}}(function(e){e.Empty=u([]);function t(R){return{kind:"structure-loci",structure:R}}e.Loci=t;function r(R){for(var Y=[],re=0,K=R.units;re<K.length;re++){var L=K[re];Y.push({unit:L,indices:Me.ofBounds(0,L.elements.length)})}return Oe(R,Y)}e.toStructureElementLoci=r;function n(R,Y){return St.toLociWithSourceUnits(St.Singletons(R,Y))}e.toSubStructureElementLoci=n;function a(R){return!!R&&R.kind==="structure-loci"}e.isLoci=a;function i(R,Y){return R.structure===Y.structure}e.areLociEqual=i;function o(R){return R.structure.isEmpty}e.isLociEmpty=o;function s(R,Y){return Y===R.structure?R:t(Y)}e.remapLoci=s;function u(R,Y){Y===void 0&&(Y={});for(var re=hu.Mutable(),K=hu.Mutable(),L=0,H=!0,Z=R.length>0?R[0].id:0,fe=0,me=R.length;fe<me;fe++){var xe=R[fe];re.set(xe.id,xe),L+=xe.elements.length,xe.id<Z&&(H=!1),Z=xe.id}H||vq(R,0,R.length,WIe,Ih);for(var fe=0,me=R.length;fe<me;fe++)K.set(R[fe].id,fe);var Se={hashCode:-1,transformHash:-1,elementCount:L,bondCount:-1,uniqueElementCount:-1,atomicResidueCount:-1,polymerResidueCount:-1,polymerGapCount:-1,polymerUnitCount:-1,coordinateSystem:An.Default,label:""};return Y.parent&&(Se.parent=Y.parent.parent||Y.parent),Y.interUnitBonds&&(Se.interUnitBonds=Y.interUnitBonds),Y.coordinateSystem?Se.coordinateSystem=Y.coordinateSystem:Y.parent&&(Se.coordinateSystem=Y.parent.coordinateSystem),Y.label?Se.label=Y.label:Y.parent&&(Se.label=Y.parent.label),Y.masterModel?Se.masterModel=Y.masterModel:Y.parent&&(Se.masterModel=Y.parent.masterModel),Y.representativeModel?Se.representativeModel=Y.representativeModel:Y.parent&&(Se.representativeModel=Y.parent.representativeModel),new e(R,re,K,Se)}e.create=u;function l(R,Y){return pe(this,void 0,void 0,function(){var re,K,L,H,Z,fe,me,xe,Se,ie,le,O,G;return he(this,function(ve){switch(ve.label){case 0:if(R.frameCount===0)return[2,e.Empty];re=[],K=void 0,L=0,H=0,Z=R.frameCount,ve.label=1;case 1:return H<Z?[4,Qe.resolveInContext(R.getFrameAtIndex(H),Y)]:[3,4];case 2:for(fe=ve.sent(),K||(K=fe),me=c(fe),xe=0,Se=me.units.length;xe<Se;++xe)ie=me.units[xe],le=ie.invariantId+L,O=ie.chainGroupId+L,G=We.create(re.length,le,O,ie.traits,ie.kind,ie.model,ie.conformation.operator,ie.elements),re.push(G);L=re.length,ve.label=3;case 3:return++H,[3,1];case 4:return[2,u(re,{representativeModel:K,label:K.label})]}})})}e.ofTrajectory=l;function c(R){for(var Y=R.atomicHierarchy.chainAtomSegments,re=R.atomicHierarchy.index,K=R.atomicHierarchy.chains.auth_asym_id,L=R.atomicChainOperatorMappinng,H=new h({label:R.label}),Z=0;Z<Y.count;Z++){var fe=L.get(Z)||An.Default,me=Y.offsets[Z];lm.chainResidueCount(R.atomicHierarchy,Z),Y.offsets[Z+1]-Y.offsets[Z];var xe=!1;if(d(R,Z))for(;Z+1<Y.count&&d(R,Z+1);){var Se=L.get(Z),ie=L.get(Z+1);if(Se!==ie)break;xe=!0,Z++}else for(;Z+1<Y.count&&Y.offsets[Z+1]-Y.offsets[Z]===1&&Y.offsets[Z+2]-Y.offsets[Z+1]===1;){var le=re.getEntityFromChain(Z),O=re.getEntityFromChain(Z+1);if(le!==O)break;var G=K.value(Z),ve=K.value(Z+1);if(G!==ve)break;var Se=L.get(Z),ie=L.get(Z+1);if(Se!==ie)break;xe=!0,Z++}var we=nt.ofBounds(me,Y.offsets[Z+1]);H.addUnit(0,R,fe,we,xe?1:0)}var Te=R.coarseHierarchy;return Te.isDefined&&(Te.spheres.count>0&&f(H,R,R.coarseHierarchy.spheres,1),Te.gaussians.count>0&&f(H,R,R.coarseHierarchy.gaussians,2)),H.getStructure()}e.ofModel=c;function d(R,Y){var re=R.atomicHierarchy.index.getEntityFromChain(Y);return R.entities.data.type.value(re)==="water"}function f(R,Y,re,K){for(var L=re.chainElementSegments,H=0;H<L.count;H++){var Z=nt.ofBounds(L.offsets[H],L.offsets[H+1]);R.addUnit(K,Y,An.Default,Z,0)}}function p(R,Y){if(de.isIdentity(Y))return R;if(!de.isRotationAndTranslation(Y,An.RotationTranslationEpsilon))throw new Error("Only rotation/translation combination can be applied.");for(var re=[],K=0,L=R.units;K<L.length;K++){var H=L[K],Z=H.conformation.operator,fe=An.create(Z.name,Y,Z);re.push(H.applyOperator(H.id,fe))}var me=R.coordinateSystem,xe=An.compose(An.create(me.name,Y,me),me);return u(re,{parent:R,coordinateSystem:xe})}e.transform=p;var h=function(){function R(Y){Y===void 0&&(Y={}),this.props=Y,this.units=[],this.invariantId=ro(),this.chainGroupId=-1,this.inChainGroup=!1,this.p=A(),this.singleElementUnits=new Map}return R.prototype.beginChainGroup=function(){this.chainGroupId++,this.inChainGroup=!0},R.prototype.endChainGroup=function(){this.inChainGroup=!1},R.prototype.addUnit=function(Y,re,K,L,H,Z){Z===void 0&&(Z=this.invariantId());var fe=this.inChainGroup?this.chainGroupId:++this.chainGroupId,me=We.create(this.units.length,Z,fe,H,Y,re,K,L);return this.add(me)},R.prototype.add=function(Y){if(Y.elements.length===1){Y.conformation.position(Y.elements[0],this.p);var re=[Y.invariantId,this.p[0],this.p[1],this.p[2]].join("|");if(this.singleElementUnits.has(re))return this.singleElementUnits.get(re);this.singleElementUnits.set(re,Y)}return this.units.push(Y),Y},R.prototype.addWithOperator=function(Y,re,K){return K===void 0&&(K=!1),this.add(Y.applyOperator(this.units.length,re,K))},R.prototype.getStructure=function(){return u(this.units,this.props)},Object.defineProperty(R.prototype,"isEmpty",{get:function(){return this.units.length===0},enumerable:!1,configurable:!0}),R}();e.StructureBuilder=h;function m(R){return R===void 0&&(R={}),new h(R)}e.Builder=m;function v(R){return R.hashCode}e.hashCode=v;function g(R){return zD(R.units.map(function(Y){return We.conformationId(Y)}).join("|"))}e.conformationHash=g;function y(R,Y){if(R===Y)return!0;if(R.elementCount!==Y.elementCount)return!1;var re=R.units.length;if(re!==Y.units.length)return!1;for(var K=0;K<re;K++)if(R.units[K].id!==Y.units[K].id)return!1;return!0}e.areUnitIdsEqual=y;function b(R,Y){if(!y(R,Y))return!1;for(var re=0,K=R.units.length;re<K;re++)if(!nt.areEqual(R.units[re].elements,Y.units[re].elements))return!1;return!0}e.areUnitIdsAndIndicesEqual=b;function S(R,Y){if(R.hashCode!==Y.hashCode)return!1;var re=R.models.length;if(re!==Y.models.length)return!1;for(var K=0;K<re;K++)if(!rr.areHierarchiesEqual(R.models[K],Y.models[K]))return!1;return!0}e.areHierarchiesEqual=S;function x(R,Y){return R===Y||R.hashCode===Y.hashCode&&Gl.areTransformGroupsEquivalent(R.unitSymmetryGroups,Y.unitSymmetryGroups)}e.areEquivalent=x;function C(R,Y){return x(R.root,Y.root)}e.areRootsEquivalent=C;function w(R,Y){return R.root===Y.root}e.areRootsEqual=w;var _=function(){function R(Y){this.structure=Y,this.unitIndex=0,this.maxIdx=0,this.idx=-1,this.current=ot.create(Y),this.hasNext=Y.elementCount>0,this.hasNext&&(this.elements=Y.units[0].elements,this.maxIdx=this.elements.length-1,this.current.unit=Y.units[0])}return R.prototype.move=function(){return this.advance(),this.current.element=this.elements[this.idx],this.current},R.prototype.advance=function(){if(this.idx<this.maxIdx){this.idx++,this.idx===this.maxIdx&&(this.hasNext=this.unitIndex+1<this.structure.units.length);return}if(this.idx=0,this.unitIndex++,this.unitIndex>=this.structure.units.length){this.hasNext=!1;return}this.current.unit=this.structure.units[this.unitIndex],this.elements=this.current.unit.elements,this.maxIdx=this.elements.length-1,this.maxIdx===0&&(this.hasNext=this.unitIndex+1<this.structure.units.length)},R}();e.ElementLocationIterator=_;var E=A();function P(R,Y,re){for(var K=R.elements,L=R.conformation,H=L.position,Z=L.r,fe=E,me=Number.MAX_VALUE,xe=0,Se=K.length;xe<Se;xe++){var ie=K[xe],le=A.distance(Y,H(ie,fe))-re-Z(ie);le<me&&(me=le)}return me}function D(R,Y,re){for(var K=R.units,L=Number.MAX_VALUE,H=0,Z=K.length;H<Z;H++){var fe=K[H],me=P(fe,Y,re);me<L&&(L=me)}return L}e.minDistanceToPoint=D;var k=A();function F(R,Y){if(R.elementCount===0||Y.elementCount===0)return 0;for(var re=R.units,K=Number.MAX_VALUE,L=0,H=re.length;L<H;L++)for(var Z=re[L],fe=Z.elements,me=Z.conformation,xe=me.position,Se=me.r,ie=0,le=fe.length;ie<le;ie++){var O=fe[ie],G=D(Y,xe(O,k),Se(O));G<K&&(K=G)}return K}e.distance=F;function X(R){return R.elementCount===1?"1 element":R.elementCount+" elements"}e.elementDescription=X;function U(R,Y,re){return R.masterModel?Y.model===re.model||Y.model===R.masterModel||re.model===R.masterModel:Y.model===re.model}e.validUnitPair=U;function j(R,Y,re){var K=re.maxRadius,L=re.validUnit,H=re.validUnitPair;if(!!R.units.some(function(ve){return L(ve)}))for(var Z=R.lookup3d,fe=A(),me=0,xe=R.units;me<xe.length;me++){var Se=xe[me];if(!!L(Se)){var ie=Se.boundary.sphere;A.transformMat4(fe,ie.center,Se.conformation.operator.matrix);for(var le=Z.findUnitIndices(fe[0],fe[1],fe[2],ie.radius+K),O=0;O<le.count;O++){var G=R.units[le.indices[O]];!L(G)||Se.id>=G.id||!H(Se,G)||(G.elements.length>=Se.elements.length?Y(Se,G):Y(G,Se))}}}}e.eachUnitPair=j;function te(R,Y){for(var re=Y.chain,K=Y.residue,L=Y.atom,H=ot.create(R),Z=0,fe=R.units;Z<fe.length;Z++){var me=fe[Z];if(me.kind===0){H.unit=me;for(var xe=me.elements,Se=pr.transientSegments(me.model.atomicHierarchy.chainAtomSegments,xe),ie=pr.transientSegments(me.model.atomicHierarchy.residueAtomSegments,xe);Se.hasNext;){var le=Se.move();if(re&&(H.element=xe[le.start],re(H)),!(!K&&!L))for(ie.setSegment(le);ie.hasNext;){var O=ie.move();if(K&&(H.element=xe[O.start],K(H)),!!L)for(var G=O.start,ve=O.end;G<ve;G++)H.element=xe[G],L(H)}}}}}e.eachAtomicHierarchyElement=te,e.DefaultSizeThresholds={smallResidueCount:10,mediumResidueCount:5e3,largeResidueCount:3e4,highSymmetryUnitCount:10,fiberResidueCount:15};function q(R){return R.unitSymmetryGroups.filter(function(Y){return Y.units[0].polymerElements.length>0})}function W(R,Y){var re=q(R);return re.length===1&&re[0].units.length>2&&re[0].units[0].polymerElements.length<Y.fiberResidueCount}function V(R,Y){var re=q(R);return re.length>=1&&re[0].units.length>Y.highSymmetryUnitCount}var ee;(function(R){R[R.Small=0]="Small",R[R.Medium=1]="Medium",R[R.Large=2]="Large",R[R.Huge=3]="Huge",R[R.Gigantic=4]="Gigantic"})(ee=e.Size||(e.Size={}));function ue(R,Y,re){Y===void 0&&(Y={}),re===void 0&&(re=1);var K=T(T({},e.DefaultSizeThresholds),Y);return R.polymerResidueCount>=K.largeResidueCount*re?V(R,K)?ee.Huge:ee.Gigantic:W(R,K)||R.polymerResidueCount<K.smallResidueCount*re?ee.Small:R.polymerResidueCount<K.mediumResidueCount*re?ee.Medium:ee.Large}e.getSize=ue,e.Index=Cp.createSimple("index","root");var $="__PrincipalAxes__";function Q(R){if(R.currentPropertyData[$])return R.currentPropertyData[$];var Y=Oe.getPrincipalAxes(e.toStructureElementLoci(R));return R.currentPropertyData[$]=Y,Y}e.getPrincipalAxes=Q})($e||($e={}));var aMe=Ne.size;function Oe(e,t){return{kind:"element-loci",structure:e,elements:t}}(function(e){function t(R){return!!R&&R.kind==="element-loci"}e.is=t;function r(R,Y){if(R.structure!==Y.structure||R.elements.length!==Y.elements.length)return!1;for(var re=0,K=R.elements.length;re<K;++re){var L=R.elements[re],H=Y.elements[re];if(L.unit.id!==H.unit.id||!Ne.areEqual(L.indices,H.indices))return!1}return!0}e.areEqual=r;function n(R){return i(R)===0}e.isEmpty=n;function a(R){return i(R)===R.structure.elementCount}e.isWholeStructure=a;function i(R){for(var Y=0,re=0,K=R.elements;re<K.length;re++){var L=K[re];Y+=aMe(L.indices)}return Y}e.size=i;function o(R){return e(R,R.units.map(function(Y){return{unit:Y,indices:Ne.ofBounds(0,Y.elements.length)}}))}e.all=o;function s(R){return e(R,[])}e.none=s;function u(R,Y){if(!n(R)){var re=R.elements[0].unit,K=re.elements[Ne.getAt(R.elements[0].indices,0)];return Y?(Y.structure=R.structure,Y.unit=R.elements[0].unit,Y.element=K,Y):ot.create(R.structure,re,K)}}e.getFirstLocation=u;function l(R){return n(R)?R:e(R.structure,[{unit:R.elements[0].unit,indices:Ne.ofSingleton(Ne.start(R.elements[0].indices))}])}e.firstElement=l;function c(R){return n(R)?R:b(l(R))}e.firstResidue=c;function d(R){return n(R)?R:E(l(R))}e.firstChain=d;function f(R){for(var Y=[],re=function(Z){var fe=Z.unit,me=Z.indices,xe=new Int32Array(Ne.size(me));Ne.forEach(me,function(Se,ie){return xe[ie]=fe.elements[Se]}),Y.push(fe.getChild(nt.ofSortedArray(xe)))},K=0,L=R.elements;K<L.length;K++){var H=L[K];re(H)}return $e.create(Y,{parent:R.structure.parent})}e.toStructure=f;function p(R,Y){if(Y===R.structure)return R;var re=[];return R.elements.forEach(function(K){if(!!Y.unitMap.has(K.unit.id)){var L=Y.unitMap.get(K.unit.id),H=Ne.indexedIntersect(K.indices,K.unit.elements,L.elements);Ne.size(H)>0&&re.push({unit:L,indices:H})}}),e(Y,re)}e.remap=p;function h(R,Y){if(R.elements.length>Y.elements.length)return h(Y,R);if(e.isEmpty(R))return Y;for(var re=new Map,K=0,L=R.elements;K<L.length;K++){var H=L[K];re.set(H.unit.id,H.indices)}for(var Z=[],fe=0,me=Y.elements;fe<me.length;fe++){var H=me[fe];re.has(H.unit.id)?(Z[Z.length]={unit:H.unit,indices:Ne.union(re.get(H.unit.id),H.indices)},re.delete(H.unit.id)):Z[Z.length]=H}return re.forEach(function(xe,Se){Z[Z.length]={unit:R.structure.unitMap.get(Se),indices:xe}}),e(R.structure,Z)}e.union=h;function m(R,Y){for(var re=new Map,K=0,L=Y.elements;K<L.length;K++){var H=L[K];re.set(H.unit.id,H.indices)}for(var Z=[],fe=0,me=R.elements;fe<me.length;fe++){var H=me[fe];if(re.has(H.unit.id)){var xe=Ne.subtract(H.indices,re.get(H.unit.id));if(Ne.size(xe)===0)continue;Z[Z.length]={unit:H.unit,indices:xe}}else Z[Z.length]=H}return e(R.structure,Z)}e.subtract=m;function v(R,Y){for(var re=new Map,K=0,L=R.elements;K<L.length;K++){var H=L[K];re.set(H.unit.id,H.indices)}for(var Z=[],fe=0,me=Y.elements;fe<me.length;fe++){var H=me[fe];if(!!re.has(H.unit.id)){var xe=Ne.intersect(re.get(H.unit.id),H.indices);Ne.size(xe)!==0&&(Z[Z.length]={unit:H.unit,indices:xe})}}return e(R.structure,Z)}e.intersect=v;function g(R,Y){if(R.elements.length>Y.elements.length)return g(Y,R);if(e.isEmpty(R))return e.isEmpty(Y);for(var re=new Map,K=0,L=R.elements;K<L.length;K++){var H=L[K];re.set(H.unit.id,H.indices)}for(var Z=0,fe=Y.elements;Z<fe.length;Z++){var H=fe[Z];if(!!re.has(H.unit.id)&&Ne.areIntersecting(re.get(H.unit.id),H.indices))return!0}return!1}e.areIntersecting=g;function y(R,Y){if(e.isEmpty(R))return e.isEmpty(Y);for(var re=new Map,K=0,L=R.elements;K<L.length;K++){var H=L[K];re.set(H.unit.id,H.indices)}for(var Z=!1,fe=0,me=Y.elements;fe<me.length;fe++){var H=me[fe];if(!!re.has(H.unit.id))if(Ne.isSubset(re.get(H.unit.id),H.indices))Z=!0;else return!1}return Z}e.isSubset=y;function b(R,Y){for(var re=[],K=new Set,L=0,H=R.elements;L<H.length;L++){var Z=H[L];if(x(Z)){re[re.length]=Z;continue}if(Z.unit.kind===0){for(var fe=Z.unit.elements,me=Z.unit.model.atomicHierarchy,xe=Z.unit.model.atomicHierarchy.atoms.label_alt_id,Se=me.residueAtomSegments,ie=Se.index,le=Se.offsets,O=[],G=Z.indices,ve=Ne.size(G),we=0;we<ve;){K.clear();var Te=fe[Ne.getAt(G,we)],Ue=ie[Te];for(K.add(xe.value(Te)),we++;we<ve;){var Ge=fe[Ne.getAt(G,we)];if(ie[Ge]!==Ue)break;K.add(xe.value(Ge)),we++}for(var Je=K.has(""),st=le[Ue],ze=le[Ue+1];st<ze;st++){var et=Ne.indexOf(fe,st);if(et>=0){var ut=xe.value(st);(!Y||Je||!ut||K.has(ut))&&(O[O.length]=et)}}}re[re.length]={unit:Z.unit,indices:nt.ofSortedArray(O)}}else re[re.length]=Z}return e(R.structure,re)}e.extendToWholeResidues=b;function S(R){switch(R.kind){case 0:return R.model.atomicHierarchy.chainAtomSegments;case 1:return R.model.coarseHierarchy.spheres.chainElementSegments;case 2:return R.model.coarseHierarchy.gaussians.chainElementSegments}}function x(R){return R.unit.elements.length===Ne.size(R.indices)}function C(R){return R.length>12&&R[R.length-1]-R[0]===R.length-1?Me.ofRange(R[0],R[R.length-1]):nt.ofSortedArray(R)}function w(R,Y,re){for(var K=S(R).index,L=R.elements,H=0,Z=0,fe=L.length;Z<fe;Z++){var me=L[Z],xe=K[me];!Y.has(xe)||H++}if(H===R.elements.length){re[re.length]={unit:R,indices:Me.ofBounds(0,H)};return}var Se=new Int32Array(H);H=0;for(var Z=0,fe=L.length;Z<fe;Z++){var me=L[Z],xe=K[me];!Y.has(xe)||(Se[H++]=Z)}Se.length>0&&(re[re.length]={unit:R,indices:C(Se)})}function _(R,Y,re,K,L){for(var H=S(R.elements[0].unit).index,Z=new Set,fe=Y;fe<re;fe++)for(var me=R.elements[fe],xe=me.indices,Se=me.unit.elements,ie=0,le=Ne.size(xe);ie<le;ie++)Z.add(H[Se[Ne.getAt(xe,ie)]]);if(K)for(var O=R.elements[0].unit,G=0,ve=R.structure.units;G<ve.length;G++){var we=ve[G];!We.areSameChainOperatorGroup(we,O)||w(we,Z,L)}else for(var fe=Y;fe<re;fe++)w(R.elements[fe].unit,Z,L)}function E(R){for(var Y=[],re=0,K=R.elements.length;re<K;re++){var L=R.elements[re];if(We.Traits.is(L.unit.traits,2)){for(var H=re;re<K&&We.areSameChainOperatorGroup(R.elements[re].unit,L.unit);)re++;var Z=re;re--,_(R,H,Z,!0,Y)}else x(L)?Y[Y.length]=L:_(R,re,re+1,!1,Y)}return e(R.structure,Y)}e.extendToWholeChains=E;function P(R){return R.unit.model.id+"|"+mt.entity.id(R)}function D(R){for(var Y=[],re=ot.create(R.structure),K=new Set,L=R.structure.units,H=0,Z=R.elements.length;H<Z;H++){var fe=R.elements[H];re.unit=fe.unit,re.element=fe.unit.elements[0],K.add(P(re))}for(var H=0,me=L.length;H<me;++H){var xe=L[H];if(re.unit=xe,re.element=xe.elements[0],K.has(P(re))){var Se=Ne.ofBounds(0,xe.elements.length);Y[Y.length]={unit:xe,indices:Se}}}return e(R.structure,Y)}e.extendToWholeEntities=D;function k(R){for(var Y=[],re=new Set,K=R.structure.units,L=0,H=R.elements.length;L<H;L++){var Z=R.elements[L];re.add(Z.unit.model.id)}for(var L=0,fe=K.length;L<fe;++L){var me=K[L];if(re.has(me.model.id)){var xe=Ne.ofBounds(0,me.elements.length);Y[Y.length]={unit:me,indices:xe}}}return e(R.structure,Y)}e.extendToWholeModels=k;function F(R,Y){for(var re=[],K=0,L=Ne.size(Y);K<L;++K)re.push(R[Ne.getAt(Y,K)]);return nt.ofSortedArray(re)}function X(R,Y){return nt.indicesOf(R,Y)}function U(R){for(var Y=[],re=new Map,K=0,L=R.elements.length;K<L;K++){var H=R.elements[K],Z=H.unit.model,fe=F(H.unit.elements,H.indices);re.has(Z)?re.set(Z,nt.union(fe,re.get(Z))):re.set(Z,fe)}for(var K=0,me=R.structure.units.length;K<me;++K){var xe=R.structure.units[K],fe=re.get(xe.model);if(!!fe){var Se=X(xe.elements,fe);Y[Y.length]={unit:xe,indices:Se}}}return e(R.structure,Y)}e.extendToAllInstances=U;var j=new Ms("98"),te=A();function q(R,Y){j.reset();for(var re=0,K=R.elements;re<K.length;re++)for(var L=K[re],H=L.indices,Z=L.unit.conformation.position,fe=L.unit.conformation.r,me=L.unit.elements,xe=0,Se=Ne.size(H);xe<Se;xe++){var ie=me[Ne.getAt(H,xe)];Z(ie,te),Y&&A.transformMat4(te,te,Y),j.includePositionRadius(te,fe(ie))}j.finishedIncludeStep();for(var le=0,O=R.elements;le<O.length;le++)for(var L=O[le],H=L.indices,Z=L.unit.conformation.position,fe=L.unit.conformation.r,me=L.unit.elements,xe=0,Se=Ne.size(H);xe<Se;xe++){var ie=me[Ne.getAt(H,xe)];Z(ie,te),Y&&A.transformMat4(te,te,Y),j.radiusPositionRadius(te,fe(ie))}return{box:j.getBox(),sphere:j.getSphere()}}e.getBoundary=q;var W=A();function V(R,Y,re){re===void 0&&(re=0);for(var K=re,L=0,H=R.elements;L<H.length;L++){for(var Z=H[L],fe=Z.indices,me=Z.unit.conformation.position,xe=Z.unit.elements,Se=Ne.size(fe),ie=0;ie<Se;ie++){var le=xe[Ne.getAt(fe,ie)];me(le,W),A.toArray(W,Y,K+ie*3)}K+=Se*3}return Y}e.toPositionsArray=V;function ee(R){var Y=i(R),re=V(R,new Float32Array(3*Y));return um.ofPositions(re)}e.getPrincipalAxes=ee;function ue(R,Y){return We.isAtomic(R)?R.model.atomicHierarchy.atomSourceIndex.value(Y):Y}function $(R){var Y;if(e.isEmpty(R))return ce.struct.generator.empty();for(var re=R.structure.models,K=new Map,L=0,H=R.elements;L<H.length;L++){var Z=H[L],fe=Z.indices,me=Z.unit.elements,xe=Z.unit.conformation.operator.name,Se=void 0;K.has(xe)?Se=K.get(xe).xs:(Se=on.create(),K.set(xe,{modelLabel:Z.unit.model.label,modelIndex:Z.unit.model.modelNum,xs:Se}));for(var ie=0,le=Ne.size(fe);ie<le;ie++){var O=ue(Z.unit,me[Ne.getAt(fe,ie)]);on.add(Se,O,O)}}for(var G=[],ve=K.keys();;){var we=ve.next();if(we.done)break;var Z=K.get(we.value);G.push(Q(we.value,Z.xs.array,re.length>1,Z.modelLabel,Z.modelIndex))}for(var Te=new Map,ie=0,Ue=G.length;ie<Ue;++ie){var Ge=G[ie],Je=wm(eo(Ge.atom.ranges),eo(Ge.atom.set)),xe=Je+"|"+(Ge.entity?Ge.entity.modelLabel+Ge.entity.modelIndex:"");Te.has(xe)?(Y=Te.get(xe).chain.opName).push.apply(Y,Ge.chain.opName):Te.set(xe,Ge)}var st=[];return Te.forEach(function(ze){var et=ze.atom,ut=et.ranges,pt=et.set,ht=ze.chain.opName,Re=ce.struct.atomProperty.core.operatorName(),it=ce.struct.atomProperty.core.sourceIndex(),Fe=[];pt.length>0&&(Fe[Fe.length]=ce.core.set.has([ce.core.type.set(pt),it]));for(var tt=0,wt=ut.length/2;tt<wt;tt++)Fe[Fe.length]=ce.core.rel.inRange([it,ut[2*tt],ut[2*tt+1]]);if(ze.entity){var dt=ze.entity,Et=dt.modelLabel,oe=dt.modelIndex;st.push(ce.struct.generator.atomGroups({"atom-test":Fe.length>1?ce.core.logic.or(Fe):Fe[0],"chain-test":ht.length>1?ce.core.set.has([ce.core.type.set(ht),Re]):ce.core.rel.eq([Re,ht[0]]),"entity-test":ce.core.logic.and([ce.core.rel.eq([ce.struct.atomProperty.core.modelLabel(),Et]),ce.core.rel.eq([ce.struct.atomProperty.core.modelIndex(),oe])])}))}else st.push(ce.struct.generator.atomGroups({"atom-test":Fe.length>1?ce.core.logic.or(Fe):Fe[0],"chain-test":ht.length>1?ce.core.set.has([ce.core.type.set(ht),Re]):ce.core.rel.eq([Re,ht[0]])}))}),ce.struct.modifier.union([st.length===1?st[0]:ce.struct.combinator.merge(st.map(function(ze){return ce.struct.modifier.union([ze])}))])}e.toExpression=$;function Q(R,Y,re,K,L){Wu(Y);for(var H=[],Z=[],fe=0,me=Y.length;fe<me;){var xe=fe;for(fe++;fe<me&&Y[fe-1]+1===Y[fe];)fe++;var Se=fe;if(Se-xe>12)H[H.length]=Y[xe],H[H.length]=Y[Se-1];else for(var ie=xe;ie<Se;ie++)Z[Z.length]=Y[ie]}return re?{atom:{set:Z,ranges:H},chain:{opName:[R]},entity:{modelLabel:K,modelIndex:L}}:{atom:{set:Z,ranges:H},chain:{opName:[R]}}}})(Oe||(Oe={}));var Kf;(function(e){function t(){return{elementCount:0,conformationCount:0,residueCount:0,chainCount:0,unitCount:0,structureCount:0,firstElementLoc:ot.create(void 0),firstConformationLoc:ot.create(void 0),firstResidueLoc:ot.create(void 0),firstChainLoc:ot.create(void 0),firstUnitLoc:ot.create(void 0),firstStructureLoc:ot.create(void 0)}}e.create=t;function r(u,l,c){var d=u.get(l)||0;u.set(l,d+c)}function n(u,l,c){var d=c.indices,f=c.unit,p=f.elements,h=Ne.size(d),m=new Map,v=new Map;if(h>0&&ot.set(u.firstElementLoc,l,f,p[Ne.start(d)]),h===p.length)u.unitCount+=1,u.unitCount===1&&ot.set(u.firstUnitLoc,l,f,p[Ne.start(d)]);else if(h===1){if(We.Traits.is(f.traits,1))return;u.elementCount+=1,u.elementCount===1&&ot.set(u.firstElementLoc,l,f,p[Ne.start(d)])}else if(We.isAtomic(f))for(var g=f.model.atomicHierarchy.residueAtomSegments,y=g.index,b=g.offsets,S=f.model.atomicHierarchy.atoms.label_alt_id,x=0,C=function(){m.clear();var w=0,_=p[Ne.getAt(d,x)],E=y[_];for(r(m,S.value(_),1),++x,++w;x<h;){var P=p[Ne.getAt(d,x)];if(y[P]!==E)break;r(m,S.value(P),1),++x,++w}if(b[E+1]-b[E]===w)u.residueCount+=1,u.residueCount===1&&ot.set(u.firstResidueLoc,l,f,b[E]);else{v.clear();for(var D=b[E],k=b[E+1];D<k;++D)r(v,S.value(D),1);v.get("")===m.get("")&&m.forEach(function(F,X){if(v.get(X)===F){if(X!==""&&(u.conformationCount+=1,u.conformationCount===1)){for(var U=b[E],j=b[E+1];U<j;++U)if(X===S.value(U)){ot.set(u.firstConformationLoc,l,f,U);break}}w-=F}}),u.elementCount+=w}};x<h;)C();else u.elementCount+=h,u.elementCount===1&&ot.set(u.firstElementLoc,l,f,p[Ne.start(d)])}function a(u,l,c){var d=c.indices,f=c.unit,p=Ne.size(d);if(p!==0){var h=f.elements;if(!We.Traits.is(f.traits,1)){p===h.length&&(u.chainCount+=1,u.chainCount===1&&ot.set(u.firstChainLoc,l,f,h[Ne.start(d)]));return}var m=We.isAtomic(f)?f.model.atomicHierarchy.chainAtomSegments:We.isSpheres(f)?f.model.coarseHierarchy.spheres.chainElementSegments:We.isGaussians(f)?f.model.coarseHierarchy.gaussians.chainElementSegments:void 0;if(!m){console.warn("StructureElement loci stats: unknown unit type");return}for(var v=m.index,g=m.offsets,y=0;y<p;){var b=0,S=h[Ne.getAt(d,y)],x=v[S];for(++y,++b;y<p;){var C=h[Ne.getAt(d,y)];if(v[C]!==x)break;++y,++b}g[x+1]-g[x]===b&&(u.chainCount+=1,u.chainCount===1&&ot.set(u.firstChainLoc,l,f,g[x]))}}}function i(u,l,c,d,f){var p=c[d],h=We.isAtomic(p.unit)?p.unit.model.atomicHierarchy.chainAtomSegments:We.isSpheres(p.unit)?p.unit.model.coarseHierarchy.spheres.chainElementSegments:We.isGaussians(p.unit)?p.unit.model.coarseHierarchy.gaussians.chainElementSegments:void 0;if(!h){console.warn("StructureElement loci stats: unknown unit type");return}for(var m=h.index,v=h.offsets,g=new Map,y=d;y<f;y++){p=c[y];var b=p.indices,S=p.unit,x=Ne.size(b);if(x!==0){var C=S.elements;if(!We.Traits.is(S.traits,1)){var w=C[Ne.start(b)];r(g,m[w],C.length);continue}for(var _=0;_<x;){var E=0,w=C[Ne.getAt(b,_)],P=m[w];for(++_,++E;_<x;){var D=C[Ne.getAt(b,_)];if(m[D]!==P)break;++_,++E}r(g,P,E)}}}var k=-1;if(g.forEach(function(F,X){v[X+1]-v[X]===F&&(u.chainCount+=1,u.chainCount===1&&(k=X))}),!(k<0))for(var y=d;y<f;y++){p=c[y];var b=p.indices,S=p.unit,x=Ne.size(b);if(x!==0)for(var C=S.elements,_=0;_<x;){var w=C[Ne.getAt(b,_)],P=m[w];if(P===k){ot.set(u.firstChainLoc,l,S,w);return}}}}function o(u){var l=t();if(Oe.isEmpty(u))return l;var c=!1;if(Oe.isWholeStructure(u)){if(l.structureCount+=1,l.structureCount===1){var d=u.elements[0],f=d.unit,p=d.indices;ot.set(l.firstStructureLoc,u.structure,f,f.elements[Ne.min(p)])}}else for(var h=0,m=u.elements;h<m.length;h++){var v=m[h];n(l,u.structure,v),We.Traits.is(v.unit.traits,2)?c=!0:a(l,u.structure,v)}if(c)for(var g=0,y=u.elements.length;g<y;g++){var v=u.elements[g];if(!!We.Traits.is(v.unit.traits,2)){for(var b=g;g<y&&We.areSameChainOperatorGroup(u.elements[g].unit,v.unit);)g++;var S=g;g--,S-b===1?a(l,u.structure,v):i(l,u.structure,u.elements,b,S)}}return l}e.ofLoci=o;function s(u,l,c){return l.elementCount===1&&c.elementCount===0?ot.copy(u.firstElementLoc,l.firstElementLoc):l.elementCount===0&&c.elementCount===1&&ot.copy(u.firstElementLoc,c.firstElementLoc),l.conformationCount===1&&c.conformationCount===0?ot.copy(u.firstConformationLoc,l.firstConformationLoc):l.conformationCount===0&&c.conformationCount===1&&ot.copy(u.firstConformationLoc,c.firstConformationLoc),l.residueCount===1&&c.residueCount===0?ot.copy(u.firstResidueLoc,l.firstResidueLoc):l.residueCount===0&&c.residueCount===1&&ot.copy(u.firstResidueLoc,c.firstResidueLoc),l.chainCount===1&&c.chainCount===0?ot.copy(u.firstChainLoc,l.firstChainLoc):l.chainCount===0&&c.chainCount===1&&ot.copy(u.firstChainLoc,c.firstChainLoc),l.unitCount===1&&c.unitCount===0?ot.copy(u.firstUnitLoc,l.firstUnitLoc):l.unitCount===0&&c.unitCount===1&&ot.copy(u.firstUnitLoc,c.firstUnitLoc),l.structureCount===1&&c.structureCount===0?ot.copy(u.firstStructureLoc,l.firstStructureLoc):l.structureCount===0&&c.structureCount===1&&ot.copy(u.firstStructureLoc,c.firstStructureLoc),u.elementCount=l.elementCount+c.elementCount,u.conformationCount=l.conformationCount+c.conformationCount,u.residueCount=l.residueCount+c.residueCount,u.chainCount=l.chainCount+c.chainCount,u.unitCount=l.unitCount+c.unitCount,u.structureCount=l.structureCount+c.structureCount,u}e.add=s})(Kf||(Kf={}));function iMe(e){return We.isAtomic(e.unit)?e.unit.residueIndex[e.element]:-1}function oMe(e){return We.isAtomic(e.unit)?e.unit.chainIndex[e.element]:-1}function sMe(e){return mt.entity.key(e)}$a.Field;$a.Encodings;$a.Field;$a.Category;$a.Category;var uMe={molstar_atom_site_operator_mapping:{label_asym_id:ye.Schema.Str(),auth_asym_id:ye.Schema.Str(),operator_name:ye.Schema.Str(),suffix:ye.Schema.Str(),assembly_id:ye.Schema.Str(),assembly_operator_id:ye.Schema.Int(),symmetry_operator_index:ye.Schema.Int(),symmetry_hkl:ye.Schema.Vector(3),ncs_id:ye.Schema.Int()}},A7=function(e,t){return typeof t[e].operator.assembly>"u"?1:0},VA=function(e,t){return t[e].operator.spgrOp===-1?1:0};$a.fields().str("label_asym_id",function(e,t){return t[e].label_asym_id}).str("auth_asym_id",function(e,t){return t[e].auth_asym_id}).str("operator_name",function(e,t){return t[e].operator.name}).str("suffix",function(e,t){return t[e].operator.suffix}).str("assembly_id",function(e,t){var r;return((r=t[e].operator.assembly)===null||r===void 0?void 0:r.id)||""},{valueKind:A7}).int("assembly_operator_id",function(e,t){var r;return((r=t[e].operator.assembly)===null||r===void 0?void 0:r.operId)||0},{valueKind:A7}).int("symmetry_operator_index",function(e,t){return t[e].operator.spgrOp},{valueKind:VA}).vec("symmetry_hkl",[function(e,t){return t[e].operator.hkl[0]},function(e,t){return t[e].operator.hkl[1]},function(e,t){return t[e].operator.hkl[2]}],{valueKind:VA}).int("ncs_id",function(e,t){return t[e].operator.ncsId},{valueKind:VA}).getFields();$a.Category;var T7;(function(e){function t(r){var n=Array.isArray(r)?r:[r];return{structures:n,firstModel:n[0].model,cache:Object.create(null)}}e.create=t})(T7||(T7={}));var E7;(function(e){e.AtomSitePositionsFieldNames=new Set(["id","Cartn_x","Cartn_y","Cartn_z"])})(E7||(E7={}));var P7;(function(e){function t(d,f,p){if(!f)return{rowCount:0};if(p&&p[f.id])return p[f.id];var h=f.getElements(d),m={data:h,rowCount:h.elements.length};return p&&(p[f.id]=m),m}e.getCifDataSource=t;function r(d){return new I7(d)}e.fromAtomMap=r;function n(d){return new I7(HA(d))}e.fromAtomArray=n;var a=function(d){return d.atomicHierarchy.residueAtomSegments};function i(d){return new Q2("residue",d,a,0)}e.fromResidueMap=i;function o(d){return new Q2("residue",HA(d),a,0)}e.fromResidueArray=o;var s=function(d){return d.atomicHierarchy.chainAtomSegments};function u(d){return new Q2("chain",d,s,0)}e.fromChainMap=u;function l(d){return new Q2("chain",HA(d),s,0)}e.fromChainArray=l;function c(d){return new lMe(d)}e.fromEntityMap=c})(P7||(P7={}));function HA(e){for(var t=new Map,r=0,n=e.length;r<n;r++)t.set(r,e[r]);return t}var Q2=function(){function e(t,r,n,a){this.level=t,this.map=r,this.segmentGetter=n,this.id=Cn.create22(),this.kind=a}return e.prototype.has=function(t){return this.map.has(t)},e.prototype.get=function(t){return this.map.get(t)},e.prototype.getStructureElements=function(t){var r=t.models;if(r.length!==1)throw new Error("Only works on structures with a single model.");for(var n=new Set,a=t.unitSymmetryGroups,i=[],o=this.segmentGetter(r[0]),s=0,u=a;s<u.length;s++){var l=u[s],c=l.units[0];if(c.kind===this.kind)for(var d=pr.transientSegments(o,c.elements);d.hasNext;){var f=d.move();!this.has(f.index)||n.has(f.index)||(n.add(f.index),i[i.length]=ot.create(t,c,c.elements[f.start]))}}return i.sort(function(p,h){return p.element-h.element}),i},e.prototype.getElements=function(t){var r=this,n=this.segmentGetter(t.model).index,a=this.getStructureElements(t);return{elements:a,property:function(i){return r.get(n[a[i].element])}}},e}(),I7=function(){function e(t){this.map=t,this.id=Cn.create22(),this.level="atom",this.kind=0}return e.prototype.has=function(t){return this.map.has(t)},e.prototype.get=function(t){return this.map.get(t)},e.prototype.getStructureElements=function(t){var r=t.models;if(r.length!==1)throw new Error("Only works on structures with a single model.");for(var n=new Set,a=t.unitSymmetryGroups,i=[],o=0,s=a;o<s.length;o++){var u=s[o],l=u.units[0];if(l.kind===this.kind)for(var c=l.elements,d=0,f=c.length;d<f;d++){var p=c[d];!this.has(p)||n.has(p)||(n.add(c[d]),i[i.length]=ot.create(t,l,p))}}return i.sort(function(h,m){return h.element-m.element}),i},e.prototype.getElements=function(t){var r=this,n=this.getStructureElements(t);return{elements:n,property:function(a){return r.get(n[a].element)}}},e}(),lMe=function(){function e(t){this.map=t,this.id=Cn.create22(),this.level="entity",this.kind=0}return e.prototype.has=function(t){return this.map.has(t)},e.prototype.get=function(t){return this.map.get(t)},e.prototype.getStructureElements=function(t){var r=t.models;if(r.length!==1)throw new Error("Only works on structures with a single model.");for(var n=r[0].atomicHierarchy.index,a=new Set,i=t.unitSymmetryGroups,o=[],s=r[0].atomicHierarchy.chainAtomSegments,u=0,l=i;u<l.length;u++){var c=l[u],d=c.units[0];if(d.kind===this.kind)for(var f=pr.transientSegments(s,d.elements);f.hasNext;){var p=f.move(),h=n.getEntityFromChain(p.index);!this.has(h)||a.has(h)||(a.add(h),o[o.length]=ot.create(t,d,d.elements[p.start]))}}return o.sort(function(m,v){return m.element-v.element}),o},e.prototype.getElements=function(t){var r=this,n=this.getStructureElements(t),a=t.model.atomicHierarchy.chainAtomSegments.index,i=t.model.atomicHierarchy.index;return{elements:n,property:function(o){return r.get(i.getEntityFromChain(a[n[o].element]))}}},e}(),cm=function(){function e(t){this.frames=t,this.frameCount=t.length,this.representative=t[0],this.duration=t.length}return e.prototype.getFrameAtIndex=function(t){return this.frames[t]},e}();function cMe(e,t,r){if(!e._rowCount)return[];for(var n=pMe(r),a=[],i=0;i<e._rowCount;i++)a[a.length]=dMe(e,t,i,n);return a}function dMe(e,t,r,n){for(var a=e.id.value(r),i=e.details.value(r),o=[],s=t.assembly_id,u=t.oper_expression,l=t.asym_id_list,c=0,d=t._rowCount;c<d;c++)s.value(c)===a&&(o[o.length]={assemblyId:a,expression:u.value(c),asymIds:l.value(c)});return m5.create(a,i,fMe(o,n))}function fMe(e,t){return function(){for(var r=[],n=0,a=0;a<e.length;a++){var i=e[a],o=vMe(i.expression),s=hMe(o),u=mMe(t,s,n,i.assemblyId),l=un.generators.atoms({chainTest:un.pred.and(un.pred.eq(function(c){return mt.unit.operator_name(c.element)},An.DefaultName),un.pred.inSet(function(c){return mt.chain.label_asym_id(c.element)},i.asymIds))});r[r.length]={selector:l,operators:u},n+=u.length}return r}}function pMe(e){for(var t=e.id,r=e.matrix,n=e.vector,a=e._schema,i=new Map,o=0,s=e._rowCount;o<s;o++){var u=Rr.toMat4(de(),a.matrix.space,r.value(o)),l=Rr.toVec3(A(),a.vector.space,n.value(o));de.setTranslation(u,l),de.setValue(u,3,3,1),i.set(t.value(o),u)}return i}function hMe(e){for(var t=[],r=[],n=0;n<e.length;n++)r[n]="";return ZX(e,t,e.length-1,r),t}function ZX(e,t,r,n){if(r<0){t[t.length]=n.slice(0);return}for(var a=e[r],i=a.length,o=0;o<i;o++)n[r]=a[o],ZX(e,t,r-1,n)}function mMe(e,t,r,n){for(var a=[],i=r,o=0,s=t;o<s.length;o++){for(var u=s[o],l=de.identity(),c=0;c<u.length;c++)de.mul(l,l,e.get(u[c]));i++,a[a.length]=An.create("ASM_"+i,l,{assembly:{id:n,operId:i,operList:u}})}return a}function vMe(e){for(var t=/\(?([^\(\)]+)\)?]*/g,r=[],n=[],a;a=t.exec(e);)r[r.length]=a[1];return r.forEach(function(i){var o=[];i.split(",").forEach(function(s){var u=s.indexOf("-");if(u>0)for(var l=parseInt(s.substring(0,u)),c=parseInt(s.substr(u+1)),d=l;d<=c;d++)o[o.length]=d.toString();else o[o.length]=s.trim()}),n[n.length]=o}),n}var wa;(function(e){e.Descriptor={name:"model_symmetry"},e.Provider=ol.create(e.Descriptor);function t(n){var a=cMe(n.pdbx_struct_assembly,n.pdbx_struct_assembly_gen,n.pdbx_struct_oper_list),i=bMe(n.symmetry,n.cell),o=gMe(n.atom_sites);return{assemblies:a,spacegroup:i,isNonStandardCrystalFrame:o,ncsOperators:xMe(n.struct_ncs_oper)}}e.fromData=t;function r(n,a){var i=Go.create("P 1",n,a),o=al.create(i);return{assemblies:[],spacegroup:o,isNonStandardCrystalFrame:!1}}e.fromCell=r})(wa||(wa={}));function gMe(e,t){return e._rowCount===0,!1}function yMe(e){var t=e.Int_Tables_number.value(0),r=e["space_group_name_H-M"].value(0);return e.Int_Tables_number.isDefined?e["space_group_name_H-M"].isDefined?r:t:r}function bMe(e,t){if(e._rowCount===0||t._rowCount===0)return al.ZeroP1;var r=yMe(e),n=Go.create(r,A.create(t.length_a.value(0),t.length_b.value(0),t.length_c.value(0)),A.scale(A.zero(),A.create(t.angle_alpha.value(0),t.angle_beta.value(0),t.angle_gamma.value(0)),Math.PI/180));return al.create(n)}function xMe(e){if(e._rowCount!==0){for(var t=e.id,r=e.matrix,n=e.vector,a=Cr.struct_ncs_oper.matrix.space,i=Cr.struct_ncs_oper.vector.space,o=[],s=0;s<e._rowCount;s++){var u=Rr.toMat3(ia(),a,r.value(s)),l=Rr.toVec3(A(),i,n.value(s));if(!!An.checkIfRotationAndTranslation(u,l)&&!(e.code.value(s)==="given"&&!ia.isIdentity(u)&&!A.isZero(l))){var c=t.value(s);o[o.length]=An.ofRotationAndOffset("ncs_"+c,u,l,c)}}return o}}var SMe={U:Cr.atom_site_anisotrop.U,U_esd:Cr.atom_site_anisotrop.U_esd},uc;(function(e){e.Schema=SMe,e.Descriptor={name:"atom_site_anisotrop",cifExport:{prefix:"",categories:[{name:"atom_site_anisotrop",instance:function(n){var a=e.Provider.get(n.firstModel);return!a||!xn.is(n.firstModel.sourceData)?$a.Category.Empty:$a.Category.ofTable(n.firstModel.sourceData.data.db.atom_site_anisotrop)}}]}},e.Provider=ol.create(e.Descriptor);function t(n,a){var i=new Int32Array(n.rowCount);i.fill(-1);for(var o=0,s=n.rowCount;o<s;o++)i[n.value(o)]=o;var u=new Int32Array(n.rowCount);u.fill(-1);for(var o=0,s=a.rowCount;o<s;++o){var l=i[a.value(o)];l!==-1&&(u[l]=o)}return u}e.getElementToAnsiotrop=t;function r(n,a){for(var i={},o=0,s=n.rowCount;o<s;o++)i[n.value(o)]=o;var u=new Int32Array(n.rowCount);u.fill(-1);for(var o=0,s=a.rowCount;o<s;++o){var l=i[a.value(o)];l!==void 0&&(u[l]=o)}return u}e.getElementToAnsiotropFromLabel=r})(uc||(uc={}));var Wh;(function(e){var t,r="molstar_global_model_transform_info";e.Schema=(t={},t[r]={matrix:ye.Schema.Matrix(4,4,ye.Schema.float)},t),e.Descriptor=vu({name:r,cifExport:{categories:[{name:r,instance:function(u){var l=a(u.firstModel);if(!l)return $a.Category.Empty;var c=nn.ofRows(e.Schema.molstar_global_model_transform_info,[{matrix:l}]);return $a.Category.ofTable(c)}}],prefix:"molstar"}}),e.Provider=ol.create(e.Descriptor);function n(u,l){u.customProperties.has(e.Descriptor)||u.customProperties.add(e.Descriptor),e.Provider.set(u,l)}e.attach=n;function a(u){return e.Provider.get(u)}e.get=a;function i(u){if(!!xn.is(u.sourceData)){var l=u.sourceData.data.frame.categories[r];if(!!l){var c=R2e(e.Schema[r],l);if(c._rowCount!==0)return c.matrix.value(0)}}}e.fromMmCif=i;function o(u){if(!xn.is(u.sourceData))return!1;var l=u.sourceData.data.frame.categories[r];return!!l&&l.rowCount>0}e.hasData=o;function s(u,l){u.writeCategory({name:r,instance:function(){var c=nn.ofRows(e.Schema.molstar_global_model_transform_info,[{matrix:l}]);return $a.Category.ofTable(c)}})}e.writeMmCif=s})(Wh||(Wh={}));function CMe(e){if(!!xn.is(e.sourceData))return wa.fromData(e.sourceData.data.db)}wa.Provider.formatRegistry.add("mmCIF",CMe);function wMe(e){if(!!xn.is(e.sourceData)){var t=e.sourceData.data.db,r=t.struct_conf,n=t.struct_sheet_range;return V1.fromStruct(r,n,e.atomicHierarchy)}}V1.Provider.formatRegistry.add("mmCIF",wMe);function _Me(e){if(!!xn.is(e.sourceData)){var t=e.sourceData.data.db.atom_site_anisotrop,r=nn.ofColumns(uc.Schema,t),n=uc.getElementToAnsiotrop(e.atomicConformation.atomId,t.id);return{data:r,elementToAnsiotrop:n}}}function AMe(e){return xn.is(e.sourceData)?e.sourceData.data.db.atom_site_anisotrop.U.isDefined:!1}uc.Provider.formatRegistry.add("mmCIF",_Me,AMe);function TMe(e){if(!!xn.is(e.sourceData)){var t=e.sourceData.data.db.chem_comp_bond;if(t._rowCount!==0)return{data:t,entries:z1.getEntriesFromChemCompBond(t)}}}z1.Provider.formatRegistry.add("mmCIF",TMe);function EMe(e){if(!!xn.is(e.sourceData)){var t=e.sourceData.data.db.struct_conn;if(t._rowCount!==0){var r=oc.getEntriesFromStructConn(t,e);return{data:t,byAtomIndex:oc.getAtomIndexFromEntries(r),entries:r}}}}oc.Provider.formatRegistry.add("mmCIF",EMe);Wh.Provider.formatRegistry.add("mmCIF",Wh.fromMmCif,Wh.hasData);var xn;(function(e){function t(n){return n?.kind==="mmCIF"}e.is=t;function r(n,a,i){return a||(a=md.schema.mmCIF(n)),{kind:"mmCIF",name:a._name,data:{db:a,frame:n,source:i}}}e.fromFrame=r})(xn||(xn={}));function JX(e){var t=xn.fromFrame(e);return Qe.create("Create mmCIF Model",function(r){return Hd(t.data.db,t,r)})}var H1;(function(e){function t(n){var a=this,i=n.descriptor.name,o=n.type==="static"?"_staticPropertyData":"_dynamicPropertyData",s=function(l){return i in l[o]||(l[o][i]={props:T({},M.getDefaultValues(n.getParams(l))),data:hp.create(void 0)}),l[o][i]},u=function(l,c,d){var f=s(l);l[o][i]={props:c,data:hp.withValue(f.data,d)}};return{label:n.label,descriptor:n.descriptor,isHidden:n.isHidden,getParams:function(l){var c=M.clone(n.getParams(l));return M.setDefaultValues(c,s(l).props),c},defaultParams:n.defaultParams,isApplicable:n.isApplicable,attach:function(l,c,d,f){return d===void 0&&(d={}),pe(a,void 0,void 0,function(){var p,h,m,v,g;return he(this,function(y){switch(y.label){case 0:return f&&c.customProperties.reference(n.descriptor,!0),p=s(c),h=M.merge(n.defaultParams,p.props,d),p.data.value&&M.areEqual(n.defaultParams,p.props,h)?[2]:[4,n.obtain(l,c,h)];case 1:return m=y.sent(),v=m.value,g=m.assets,c.customProperties.add(n.descriptor),c.customProperties.assets(n.descriptor,g),u(c,h,v),[2]}})})},ref:function(l,c){return l.customProperties.reference(n.descriptor,c)},get:function(l){var c;return(c=s(l))===null||c===void 0?void 0:c.data},set:function(l,c){c===void 0&&(c={});var d=s(l),f=M.merge(n.defaultParams,d.props,c);M.areEqual(n.defaultParams,d.props,f)||(u(l,f,void 0),l.customProperties.assets(n.descriptor))},props:function(l){return s(l).props}}}e.createProvider=t;function r(n,a,i){var o=this,s={value:M.Value(i,{isHidden:!0})};return t({label:vs(n),descriptor:vu({name:n}),isHidden:!0,type:a,defaultParams:s,getParams:function(){return{value:M.Value(i,{isHidden:!0})}},isApplicable:function(){return!0},obtain:function(u,l,c){return pe(o,void 0,void 0,function(){var d;return he(this,function(f){return[2,{value:(d=c.value)!==null&&d!==void 0?d:i}]})})}})}e.createSimple=r})(H1||(H1={}));var rr;(function(e){function t(U,j){for(var te=[],q=j.frames,W=U.atomicHierarchy.atomSourceIndex,V=ye.isIdentity(W),ee=V?void 0:W.toArray({array:Int32Array}),ue=0,$=q.length;ue<$;++ue){var Q=q[ue],R=T(T({},U),{id:Cn.create22(),modelNum:ue,atomicConformation:O1.getAtomicConformation(Q,U.atomicConformation.atomId,ee),customProperties:new fc,_staticPropertyData:Object.create(null),_dynamicPropertyData:Object.create(null)});if(Q.cell){var Y=wa.fromCell(Q.cell.size,Q.cell.anglesInRadians);wa.Provider.set(R,Y)}e.TrajectoryInfo.set(R,{index:ue,size:q.length}),te.push(R)}return{trajectory:te,srcIndexArray:ee}}function r(U,j){return new cm(t(U,j).trajectory)}e.trajectoryFromModelAndCoordinates=r;function n(U,j){var te=this;return Qe.create("Create Trajectory",function(q){return pe(te,void 0,void 0,function(){var W,V,ee,ue,$,Q,R,Y,re;return he(this,function(K){switch(K.label){case 0:return[4,Hd(U.basic,U.sourceData,q)];case 1:if(W=K.sent(),W.frameCount===0)throw new Error("found no model");for(V=W.representative,ee=t(V,j).trajectory,ue={pairs:U.bonds,count:V.atomicHierarchy.atoms._rowCount},$=Bi.fromData(ue),Q=0,R=0,Y=ee;R<Y.length;R++)re=Y[R],Bi.Provider.set(re,$),e.TrajectoryInfo.set(re,{index:Q++,size:ee.length});return[2,new cm(ee)]}})})})}e.trajectoryFromTopologyAndCoordinates=n;var a="__Center__";function i(U){if(U._dynamicPropertyData[a])return U._dynamicPropertyData[a];var j=jTe(U.atomicConformation,U.coarseConformation);return U._dynamicPropertyData[a]=j,j}e.getCenter=i;function o(U){for(var j=new Int32Array(U.rowCount),te=!1,q=0,W=U.rowCount;q<W;q++){var V=U.value(q);V!==q&&(te=!1),j[V]=q}return{isIdentity:te,invertedIndex:j}}var s="__InvertedAtomSrcIndex__";function u(U){if(U._staticPropertyData[s])return U._staticPropertyData[s];var j=o(U.atomicHierarchy.atomSourceIndex);return U._staticPropertyData[s]=j,j}e.getInvertedAtomSourceIndex=u;var l="__TrajectoryInfo__";e.TrajectoryInfo={get:function(U){return U._dynamicPropertyData[l]||{index:0,size:1}},set:function(U,j){return U._dynamicPropertyData[l]=j}};var c="__AsymIdCount__";e.AsymIdCount={get:function(U){if(U._dynamicPropertyData[c])return U._dynamicPropertyData[c];var j=GTe(U);return U._dynamicPropertyData[c]=j,j}},e.AsymIdOffset=H1.createSimple("asym_id_offset","static"),e.Index=H1.createSimple("index","static");function d(U){return U.parent||U}e.getRoot=d;function f(U,j){return U.atomicHierarchy===j.atomicHierarchy&&U.coarseHierarchy===j.coarseHierarchy}e.areHierarchiesEqual=f;var p="__CoordinatesHistory__";e.CoordinatesHistory={get:function(U){return U._staticPropertyData[p]},set:function(U,j){return U._staticPropertyData[p]=j}};var h="__CoarseGrained__";function m(U){if(U._staticPropertyData[h]!==void 0)return U._staticPropertyData[h];for(var j=0,te=U.atomicHierarchy.derived.residue.polymerType,q=0;q<te.length;++q)te[q]!==0&&(j+=1);for(var W=!1,V=!1,ee=U.atomicHierarchy.atoms,ue=ee.label_atom_id,$=ee._rowCount,q=0;q<$;++q){var Q=ue.value(q);if(!W&&Q==="BB"&&(W=!0),!V&&Q==="SC1"&&(V=!0),W&&V)break}var R=W&&V||(j&&$?$/j<3:!1);return U._staticPropertyData[h]=R,R}e.isCoarseGrained=m;function v(U){return U.properties.saccharideComponentMap.size>0}e.hasCarbohydrate=v;function g(U){for(var j=U.entities.subtype,te=0,q=j.rowCount;te<q;++te)if(j.value(te).startsWith("polypeptide"))return!0;return!1}e.hasProtein=g;function y(U){for(var j=U.entities.subtype,te=0,q=j.rowCount;te<q;++te){var W=j.value(te);if(W.endsWith("ribonucleotide hybrid")||W.endsWith("ribonucleotide"))return!0}return!1}e.hasNucleic=y;function b(U){if(!xn.is(U.sourceData))return!1;var j=U.sourceData.data.db;return j.database_2.database_id.isDefined||U.entryId.match(/^[1-9][a-z0-9]{3,3}$/i)!==null||U.entryId.match(/^pdb_[0-9]{4,4}[1-9][a-z0-9]{3,3}$/i)!==null}e.isFromPdbArchive=b;function S(U){if(!xn.is(U.sourceData))return!1;var j=U.sourceData.data.db;return j.struct_conf.id.isDefined||j.struct_sheet_range.id.isDefined}e.hasSecondaryStructure=S;var x=A.create(1.5707963,1.5707963,1.5707963),C=A.create(1,1,1);function w(U){var j,te=(j=wa.Provider.get(U))===null||j===void 0?void 0:j.spacegroup;return!!te&&!(te.num===1&&A.equals(te.cell.anglesInRadians,x)&&A.equals(te.cell.size,C))}e.hasCrystalSymmetry=w;function _(U){if(!xn.is(U.sourceData))return!1;for(var j=U.sourceData.data.db,te=0;te<j.exptl.method.rowCount;te++){var q=j.exptl.method.value(te).toUpperCase();if(q.indexOf("DIFFRACTION")>=0)return!0}return!1}e.isFromXray=_;function E(U){if(!xn.is(U.sourceData))return!1;for(var j=U.sourceData.data.db,te=0;te<j.exptl.method.rowCount;te++){var q=j.exptl.method.value(te).toUpperCase();if(q.indexOf("MICROSCOPY")>=0)return!0}return!1}e.isFromEm=E;function P(U){if(!xn.is(U.sourceData))return!1;for(var j=U.sourceData.data.db,te=0;te<j.exptl.method.rowCount;te++){var q=j.exptl.method.value(te).toUpperCase();if(q.indexOf("NMR")>=0)return!0}return!1}e.isFromNmr=P;function D(U){if(!xn.is(U.sourceData)||!_(U))return!1;var j=U.sourceData.data.db,te=j.pdbx_database_status.status_code_sf;return te.isDefined&&te.value(0)==="REL"}e.hasXrayMap=D;function k(U){if(!xn.is(U.sourceData))return!1;for(var j=U.sourceData.data.db,te=j.pdbx_database_related,q=te.db_name,W=te.content_type,V=0,ee=j.pdbx_database_related._rowCount;V<ee;++V)if(q.value(V).toUpperCase()==="EMDB"&&W.value(V)==="associated EM volume")return!0;return!1}e.hasEmMap=k;function F(U){return xn.is(U.sourceData)?D(U)||k(U):!1}e.hasDensityMap=F;function X(U){if(!xn.is(U.sourceData))return!1;var j=U.sourceData.data.db;return F(U)||b(U)&&(!j.exptl.method.isDefined||_(U)&&(!j.pdbx_database_status.status_code_sf.isDefined||j.pdbx_database_status.status_code_sf.valueKind(0)===2)||E(U)&&!j.pdbx_database_related.db_name.isDefined)}e.probablyHasDensityMap=X})(rr||(rr={}));function Uy(e,t){return t?t.length===1?op(t.charCodeAt(0),e):t.length===2?op(t.charCodeAt(0),op(t.charCodeAt(1),e)):e+" "+t:e}function PMe(e,t,r,n){if(e.has(t)){var a=e.get(t);a.has(r)||a.set(r,n)}else{var a=new Map;e.set(t,a),a.set(r,n)}}function IMe(e){throw new Error("Missing entity entry for entity id '"+e+"'.")}function MMe(e,t,r){return{entities:e,segments:r,label_seq_id:nt.ofSortedArray(t.residues.label_seq_id.toArray({array:Int32Array})),label_atom_id:t.atoms.label_atom_id,auth_atom_id:t.atoms.auth_atom_id,label_alt_id:t.atoms.label_alt_id,chain_index_entity_index:new Int32Array(t.chains._rowCount),entity_index_label_asym_id:new Map,chain_index_label_seq_id:new Map,auth_asym_id_auth_seq_id:new Map,chain_index_auth_seq_id:new Map,label_asym_id:new Map}}var Ag=_5.EmptyResidueKey(),DMe=function(){function e(t){this.map=t,this.entityIndex=t.entities.getEntityIndex,this.residueOffsets=this.map.segments.residueAtomSegments.offsets}return e.prototype.getEntityFromChain=function(t){return this.map.chain_index_entity_index[t]},e.prototype.findEntity=function(t){var r=this.map.label_asym_id.get(t);return r!==void 0?r:-1},e.prototype.findChainLabel=function(t){var r=this.entityIndex(t.label_entity_id);if(r<0||!this.map.entity_index_label_asym_id.has(r))return-1;var n=this.map.entity_index_label_asym_id.get(r);return n&&n.has(t.label_asym_id)?n.get(t.label_asym_id):-1},e.prototype.findChainAuth=function(t){if(!this.map.auth_asym_id_auth_seq_id.has(t.auth_asym_id))return-1;var r=this.map.auth_asym_id_auth_seq_id.get(t.auth_asym_id);return r.has(t.auth_seq_id)?r.get(t.auth_seq_id):-1},e.prototype.findResidue=function(t,r,n,a){var i;arguments.length===1?i=t:(Ag.label_entity_id=t,Ag.label_asym_id=r,Ag.auth_seq_id=n,Ag.pdbx_PDB_ins_code=a,i=Ag);var o=this.findChainLabel(i);if(o<0)return-1;var s=this.map.chain_index_auth_seq_id.get(o),u=Uy(i.auth_seq_id,i.pdbx_PDB_ins_code||"");return s.has(u)?s.get(u):-1},e.prototype.findResidueAuth=function(t){var r=this.findChainAuth(t);if(r<0)return-1;var n=this.map.chain_index_auth_seq_id.get(r),a=Uy(t.auth_seq_id,t.pdbx_PDB_ins_code||"");return n.has(a)?n.get(a):-1},e.prototype.findResidueInsertion=function(t){var r=this.findChainLabel(t);if(r<0)return-1;var n=this.map.chain_index_label_seq_id.get(r),a=Uy(t.label_seq_id,t.pdbx_PDB_ins_code||"");if(n.has(a))return n.get(a);var i=nt.findPredecessorIndex(this.map.label_seq_id,t.label_seq_id),o=lm.chainStartResidueIndex(this.map.segments,r);if(i<o)return o;var s=lm.chainEndResidueIndexExcl(this.map.segments,r)-1;return i>=s?s:i},e.prototype.findAtom=function(t){var r=this.findResidue(t);return r<0?-1:typeof t.label_alt_id>"u"?jA(this.residueOffsets[r],this.residueOffsets[r+1],this.map.label_atom_id,t.label_atom_id):GA(this.residueOffsets[r],this.residueOffsets[r+1],this.map.label_atom_id,this.map.label_alt_id,t.label_atom_id,t.label_alt_id)},e.prototype.findAtomAuth=function(t){var r=this.findResidueAuth(t);return r<0?-1:typeof t.label_alt_id>"u"?jA(this.residueOffsets[r],this.residueOffsets[r+1],this.map.auth_atom_id,t.auth_atom_id):GA(this.residueOffsets[r],this.residueOffsets[r+1],this.map.auth_atom_id,this.map.label_alt_id,t.auth_atom_id,t.label_alt_id)},e.prototype.findAtomOnResidue=function(t,r,n){return typeof n>"u"?jA(this.residueOffsets[t],this.residueOffsets[t+1],this.map.label_atom_id,r):GA(this.residueOffsets[t],this.residueOffsets[t+1],this.map.label_atom_id,this.map.label_alt_id,r,n)},e.prototype.findAtomsOnResidue=function(t,r){return kMe(this.residueOffsets[t],this.residueOffsets[t+1],this.map.label_atom_id,r)},e}();function jA(e,t,r,n){for(var a=e;a<t;a++)if(r.value(a)===n)return a;return-1}function kMe(e,t,r,n){for(var a=e;a<t;a++)if(n.has(r.value(a)))return a;return-1}function GA(e,t,r,n,a,i){for(var o=e;o<t;o++)if(r.value(o)===a&&n.value(o)===i)return o;return-1}function RMe(e,t,r){for(var n=MMe(t,e,r),a=e.residues,i=a.label_seq_id,o=a.auth_seq_id,s=a.pdbx_PDB_ins_code,u=e.chains,l=u.label_entity_id,c=u.label_asym_id,d=u.auth_asym_id,f=Me.ofBounds(0,e.atoms._rowCount),p=pr.transientSegments(r.chainAtomSegments,f);p.hasNext;){var h=p.move(),m=h.index,v=t.getEntityIndex(l.value(m));v<0&&IMe(l.value(m)),n.chain_index_entity_index[m]=v;var g=d.value(m),y=n.auth_asym_id_auth_seq_id.get(g);y||(y=new Map,n.auth_asym_id_auth_seq_id.set(g,y));var b=c.value(m);n.label_asym_id.has(b)||n.label_asym_id.set(b,v),PMe(n.entity_index_label_asym_id,v,b,m);var S=new Map,x=new Map;n.chain_index_label_seq_id.set(m,S),n.chain_index_auth_seq_id.set(m,x);for(var C=pr.transientSegments(r.residueAtomSegments,f,h);C.hasNext;){var w=C.move(),_=w.index,E=o.value(_),P=s.value(_);S.set(Uy(i.value(_),P),_),x.set(Uy(E,P),_),y.set(E,m)}}return new DMe(n)}function OMe(e,t,r,n){for(var a=e.atoms,i=a.label_comp_id,o=a.type_symbol,s=a._rowCount,u=e.residues._rowCount,l=t.residueAtomSegments.offsets,c=new Uint8Array(s),d=0;d<s;++d)c[d]=bb(o.value(d));for(var f=new Int32Array(u),p=new Int32Array(u),h=new Int32Array(u),m=new Uint8Array(u),v=new Uint8Array(u),g=new Map,y=new Map,d=0;d<u;++d){var b=i.value(l[d]),S=n,x=void 0,C=void 0;if(g.has(b))x=g.get(b),C=y.get(b);else{var w=void 0;S.has(b)?w=S.get(b).type:(R0||console.info("chemComp not found",b),w=AX(b)),x=H0(w,b),C=OTe(w,x),g.set(b,x),y.set(b,C)}m[d]=x,v[d]=C;var _=Yf(C,"trace"),E=r.findAtomsOnResidue(d,_);if(E===-1){var P=Yf(C,"coarseBackbone");E=r.findAtomsOnResidue(d,P)}f[d]=E;var D=Yf(C,"directionFrom");p[d]=r.findAtomsOnResidue(d,D);var k=Yf(C,"directionTo");h[d]=r.findAtomsOnResidue(d,k)}return{atom:{atomicNumber:c},residue:{traceElementIndex:f,directionFromElementIndex:p,directionToElementIndex:h,moleculeType:m,polymerType:v}}}function BMe(e){if(e._rowCount===0)return{residues:[],chains:[]};for(var t=0,r=e._rowCount,n=[t],a=[t],i=e.label_entity_id,o=e.label_asym_id,s=e.label_seq_id,u=e.auth_seq_id,l=e.pdbx_PDB_ins_code,c=t+1;c<r;c++){var d=!i.areValuesEqual(c-1,c)||!o.areValuesEqual(c-1,c),f=d||!s.areValuesEqual(c-1,c)||!u.areValuesEqual(c-1,c)||!l.areValuesEqual(c-1,c);f&&(n[n.length]=c),d&&(a[a.length]=c)}return{residues:n,chains:a}}function Z2(e,t,r){e[t].isDefined||(e[t]=e[r]),e[r].isDefined||(e[r]=e[t])}function FMe(e,t,r){var n=nn.ofColumns(KPe,{type_symbol:ye.ofArray({array:ye.mapToArray(e.type_symbol,V0),schema:ye.Schema.Aliased(ye.Schema.str)}),label_atom_id:e.label_atom_id,auth_atom_id:e.auth_atom_id,label_alt_id:e.label_alt_id,label_comp_id:e.label_comp_id,auth_comp_id:e.auth_comp_id,pdbx_formal_charge:e.pdbx_formal_charge}),a=nn.view(e,$Pe,r.residues),i=nn.view(e,QPe,r.chains);if(!a.label_seq_id.isDefined){for(var o=new Int32Array(a.label_seq_id.rowCount),s=r.residues,u=r.chains,l=0,c=0,d=0,f=o.length;d<f;++d)s[d]>=u[l+1]&&(l+=1,c=0),o[d]=++c;a.label_seq_id=ye.ofIntArray(o)}return nn.columnToArray(a,"label_seq_id",Int32Array),nn.columnToArray(a,"auth_seq_id",Int32Array),Z2(n,"label_atom_id","auth_atom_id"),Z2(n,"label_comp_id","auth_comp_id"),Z2(a,"label_seq_id","auth_seq_id"),Z2(i,"label_asym_id","auth_asym_id"),{atoms:n,residues:a,chains:i,atomSourceIndex:t}}function LMe(e){return{id:Cn.create22(),atomId:e.id,occupancy:e.occupancy,B_iso_or_equiv:e.B_iso_or_equiv,xyzDefined:e.Cartn_x.isDefined&&e.Cartn_y.isDefined&&e.Cartn_z.isDefined,x:e.Cartn_x.toArray({array:Float32Array}),y:e.Cartn_y.toArray({array:Float32Array}),z:e.Cartn_z.toArray({array:Float32Array})}}function NMe(e,t){return nn.areEqual(e.chains,t.chains)&&nn.areEqual(e.residues,t.residues)&&nn.areEqual(e.atoms,t.atoms)}function zMe(e,t){var r=new Map;if(!xn.is(t))return r;var n=Lc(uMe,t.data.frame).molstar_atom_site_operator_mapping;if(n._rowCount===0)return r;for(var a=new Map,i=new Map,o=0;o<n._rowCount;o++){var s=n.assembly_operator_id.valueKind(o)===0?{id:n.assembly_id.value(o),operList:[],operId:n.assembly_operator_id.value(o)}:void 0,u=An.create(n.operator_name.value(o),de.identity(),{assembly:s,spgrOp:n.symmetry_operator_index.valueKind(o)===0?n.symmetry_operator_index.value(o):void 0,hkl:A.ofArray(n.symmetry_hkl.value(o)),ncsId:n.ncs_id.value(o)}),l=n.suffix.value(o),c=n.label_asym_id.value(o);a.set(""+c+l,{name:c,operator:u});var d=n.auth_asym_id.value(o);i.set(""+d+l,d)}for(var f=e.chains,p=f.label_asym_id,h=f.auth_asym_id,m=new Array(p.rowCount),v=new Array(p.rowCount),o=0;o<p.rowCount;o++){var c=p.value(o),d=h.value(o);if(!a.has(c)){m[o]=c,v[o]=d;continue}var g=a.get(c),y=g.name,u=g.operator;r.set(o,u),m[o]=y,v[o]=i.get(d)||d}return e.chains.label_asym_id=ye.ofArray({array:m,valueKind:e.chains.label_asym_id.valueKind,schema:e.chains.label_asym_id.schema}),e.chains.auth_asym_id=ye.ofArray({array:v,valueKind:e.chains.auth_asym_id.valueKind,schema:e.chains.auth_asym_id.schema}),r}function UMe(e,t,r,n,a,i){var o=BMe(e),s=FMe(e,t,o),u=zMe(s,a);if(i&&NMe(i.atomicHierarchy,s))return{sameAsPrevious:!0,hierarchy:i.atomicHierarchy,chainOperatorMapping:u};var l={residueAtomSegments:pr.ofOffsets(o.residues,Me.ofBounds(0,e._rowCount)),chainAtomSegments:pr.ofOffsets(o.chains,Me.ofBounds(0,e._rowCount))},c=RMe(s,r,l),d=OMe(s,l,c,n),f=T(T(T({},s),l),{index:c,derived:d});return{sameAsPrevious:!1,hierarchy:f,chainOperatorMapping:u}}function eY(e,t,r,n,a,i){var o=UMe(e,t,r,n,a,i),s=o.sameAsPrevious,u=o.hierarchy,l=o.chainOperatorMapping,c=LMe(e);return{sameAsPrevious:s,hierarchy:u,conformation:c,chainOperatorMapping:l}}var E5;(function(e){e.Empty={isDefined:!1}})(E5||(E5={}));function VMe(e,t,r){if(e.has(t))return e.get(t);var n=r.index++;return e.set(t,n),n}function HMe(e,t){if(e.has(t))return e.get(t);var r=new Map;return e.set(t,r),r}function jMe(e,t,r){var n=e.getEntityIndex,a=function(o,s){var u=n(o);if(u<0)return-1;var l=t.get(u);return l.has(s)?l.get(s):-1},i=function(o,s,u){var l=n(o);if(l<0)return-1;var c=t.get(l);if(c===void 0)return-1;var d=c.get(s);if(d===void 0)return-1;var f=r.get(d),p=f.elementIndices,h=f.seqRanges,m=In.firstIntersectionIndex(h,Ne.ofSingleton(u));return m!==-1?p[m]:-1};return{findChainKey:a,findSequenceKey:i}}function GMe(e){throw new Error("Missing entity entry for entity id '"+e+"'.")}function M7(e,t){for(var r=e.entity_id,n=e.asym_id,a=e.seq_id_begin,i=e.seq_id_end,o=e.count,s=e.chainElementSegments,u=new Map,l=new Map,c={index:0},d=new Int32Array(o),f=new Int32Array(o),p=new Int32Array(s.count),h=0;h<o;h++)f[h]=t.getEntityIndex(r.value(h)),f[h]<0&&GMe(r.value(h));for(var m=0;m<s.count;m++){var v=s.offsets[m],g=s.offsets[m+1],y=f[v];p[m]=y;for(var b=HMe(l,y),S=VMe(b,n.value(v),c),h=v;h<g;h++)d[h]=S;for(var x=[],C=[],h=v;h<g;h++){var w=a.value(h),_=i.value(h);x.push(h),C.push(w,_)}var E={elementIndices:x,seqRanges:In.ofSortedRanges(C)};u.set(S,E)}var P=jMe(t,l,u),D=P.findChainKey,k=P.findSequenceKey,F=function(X){return p[X]};return{chainKey:d,entityKey:f,findSequenceKey:k,findChainKey:D,getEntityFromChain:F}}function D7(e,t){for(var r=[],n=[],a=pr.transientSegments(e.chainElementSegments,Me.ofBounds(0,e.count)),i=e.seq_id_begin,o=e.seq_id_end;a.hasNext;)for(var s=a.move(),u=s.start,l=s.end,c=-1,d=-1,f=u;f<l;++f){var p=o.value(f);f===u?(c=f,d=o.value(f)):i.value(f)-d>1&&(r.push(c,f-1),n.push(f-1,f),c=f),f===l-1&&r.push(c,f),d=p}return{polymerRanges:In.ofSortedRanges(r),gapRanges:In.ofSortedRanges(n)}}var tY={hierarchy:E5.Empty,conformation:void 0};function qMe(e,t){var r=e.ihm_sphere_obj_site,n=e.ihm_gaussian_obj_site;if(r._rowCount===0&&n._rowCount===0)return tY;var a=k7(r),i=WMe(r),o=M7(a,e.entities),s=D7(a,t.chemicalComponentMap),u=k7(n),l=XMe(n),c=M7(u,e.entities),d=D7(u,t.chemicalComponentMap);return{hierarchy:{isDefined:!0,spheres:T(T(T({},a),o),s),gaussians:T(T(T({},u),c),d)},conformation:{id:Cn.create22(),spheres:i,gaussians:l}}}function WMe(e){return{x:e.Cartn_x.toArray({array:Float32Array}),y:e.Cartn_y.toArray({array:Float32Array}),z:e.Cartn_z.toArray({array:Float32Array}),radius:e.object_radius.toArray({array:Float32Array}),rmsf:e.rmsf.toArray({array:Float32Array})}}function XMe(e){for(var t=vo.ihm_gaussian_obj_site.covariance_matrix.space,r=[],n=e.covariance_matrix,a=0,i=n.rowCount;a<i;a++)r[a]=Rr.toMat3(ia(),t,n.value(a));return{x:e.mean_Cartn_x.toArray({array:Float32Array}),y:e.mean_Cartn_y.toArray({array:Float32Array}),z:e.mean_Cartn_z.toArray({array:Float32Array}),weight:e.weight.toArray({array:Float32Array}),covariance_matrix:r}}function YMe(e,t,r){for(var n=[0],a=1,i=e.rowCount;a<i;a++){var o=!e.areValuesEqual(a-1,a);o&&(n[n.length]=a)}return{chainElementSegments:pr.ofOffsets(n,Me.ofBounds(0,e.rowCount))}}function k7(e){var t=e.entity_id,r=e.seq_id_begin,n=e.seq_id_end,a=e.asym_id;return T({count:t.rowCount,entity_id:t,asym_id:a,seq_id_begin:r,seq_id_end:n},YMe(a))}function rY(e,t,r,n){if(!e.entity_poly_seq||!e.entity_poly_seq._rowCount)return g5.fromHierarchy(t,r,n);for(var a=e.entity_poly_seq,i=a.entity_id,o=a.num,s=a.mon_id,u={},l=[],c=i.rowCount,d=0;d<c;){for(var f=d;d<c-1&&i.areValuesEqual(d,d+1);)d++;d++;var p=i.value(f),h=ye.window(s,f,d),m=ye.window(o,f,d),v=t.getEntityIndex(p);u[v]={entityId:p,sequence:F1.ofResidueNames(h,m)},l.push(u[v])}return{byEntityKey:u,sequences:l}}function nY(e,t,r,n){return pe(this,void 0,void 0,function(){var a,i,o,s,u,l,c,d,f,p,h;return he(this,function(m){switch(m.label){case 0:return a=LP(r,n-1),i=t.label_entity_id,o=t.label_asym_id,s=t.label_seq_id,u=J4(a,i.value),e.shouldUpdate?[4,e.update()]:[3,2];case 1:m.sent(),m.label=2;case 2:l=0,c=u.length-1,m.label=3;case 3:if(!(l<c))return[3,10];d=J4(a,o.value,{start:u[l],end:u[l+1]}),f=0,p=d.length-1,m.label=4;case 4:return f<p?(h=d[f],s.valueKind(h)!==0?[3,6]:(J4(a,s.value,{sort:!0,start:h,end:d[f+1]}),e.shouldUpdate?[4,e.update()]:[3,6])):[3,7];case 5:m.sent(),m.label=6;case 6:return f++,[3,4];case 7:return e.shouldUpdate?[4,e.update()]:[3,9];case 8:m.sent(),m.label=9;case 9:return l++,[3,3];case 10:return Kye(a)&&a.length===t._rowCount?[2,{atom_site:t,sourceIndex:ye.ofIntArray(a)}]:[2,{atom_site:nn.view(t,t._schema,a),sourceIndex:ye.ofIntArray(a)}]}})})}function R7(e,t,r,n,a){var i=a.residue,o=i.polymerType,s=i.traceElementIndex,u=i.directionFromElementIndex,l=i.directionToElementIndex,c=o[e],d=o[t];if(c===0||d===0||s[e]===-1||s[t]===-1)return!1;var f=n.findAtomsOnResidue(e,Yf(c,"backboneStart")),p=n.findAtomsOnResidue(t,Yf(d,"backboneEnd"));(f===-1||p===-1)&&(f=n.findAtomsOnResidue(e,Yf(c,"coarseBackbone")),p=n.findAtomsOnResidue(t,Yf(d,"coarseBackbone")));var h=r.x,m=r.y,v=r.z,g=A.create(h[f],m[f],v[f]),y=A.create(h[p],m[p],v[p]),b=u[e]===-1||l[e]===-1||u[t]===-1||l[t]===-1;return A.distance(g,y)<(b?10:3)}function aY(e,t,r,n){for(var a=[],i=[],o=new Map,s=pr.transientSegments(e.chainAtomSegments,Me.ofBounds(0,e.atoms._rowCount)),u=pr.transientSegments(e.residueAtomSegments,Me.ofBounds(0,e.atoms._rowCount)),l=e.index,c=e.derived,d=e.residues.label_seq_id,f=e.chains.label_entity_id,p=c.residue,h=p.moleculeType,m=p.traceElementIndex,v,g,y,b;s.hasNext;){var S=s.move();u.setSegment(S),v=-1,g=-1,y=-1,b=-1;var x=t.getEntityIndex(f.value(S.index)),C=n.byEntityKey[x],w=C?C.sequence.seqId.value(C.sequence.seqId.rowCount-1):-1,_=e.residueAtomSegments.index[S.start],E=e.residueAtomSegments.index[S.end-1],P=d.value(_),D=d.value(E);for(P===1&&D===w&&r.xyzDefined&&R7(_,E,r,l,c)&&(o.set(_,E),o.set(E,_));u.hasNext;){var k=u.move(),F=k.index,X=d.value(F);if(Tk(h[F])&&m[F]!==-1)if(b!==-1)if(X!==v+1)a.push(b,y-1),i.push(g,k.end-1),b=k.start;else if(!u.hasNext)a.push(b,k.end-1);else{var U=e.residueAtomSegments.index[k.start],j=e.residueAtomSegments.index[y-1];r.xyzDefined&&!R7(U,j,r,e.index,c)&&(a.push(b,y-1),i.push(g,k.end-1),b=k.start)}else b=k.start;else b!==-1&&(a.push(b,y-1),b=-1);g=k.start,y=k.end,v=X}}return{polymerRanges:In.ofSortedRanges(a),gapRanges:In.ofSortedRanges(i),cyclicPolymerMap:o}}function KMe(e){for(var t=new Map,r=function(s,u,l){return s+"|"+u+"|"+l},n=e.pdbx_unobs_or_zero_occ_residues,a=0,i=n._rowCount;a<i;++a){var o=r(n.PDB_model_num.value(a),n.label_asym_id.value(a),n.label_seq_id.value(a));t.set(o,{polymer_flag:n.polymer_flag.value(a),occupancy_flag:n.occupancy_flag.value(a)})}return{has:function(s,u,l){return t.has(r(s,u,l))},get:function(s,u,l){return t.get(r(s,u,l))},size:t.size}}function $Me(e){var t=new Map;if(e.chem_comp._rowCount>0)for(var r=e.chem_comp.id,n=0,a=r.rowCount;n<a;++n)t.set(r.value(n),nn.getRow(e.chem_comp,n));else{var i=iY(e);i.forEach(function(o){t.set(o,BTe(o))})}return t}function QMe(e){var t=new Map;if(e.pdbx_chem_comp_identifier._rowCount>0){for(var r=e.pdbx_chem_comp_identifier,n=r.comp_id,a=r.type,i=r.identifier,o=0,s=n.rowCount;o<s;++o)if(a.value(o)==="SNFG CARBOHYDRATE SYMBOL"||a.value(o)==="SNFG CARB SYMBOL"){var u=i.value(o),l=bTe.get(u);l?t.set(n.value(o),l):console.warn("Unknown SNFG name '"+u+"'")}}if(e.chem_comp._rowCount>0)for(var c=e.chem_comp,d=c.id,a=c.type,o=0,s=d.rowCount;o<s;++o){var f=d.value(o);if(!t.has(f)){var p=a.value(o);qh.has(f)?t.set(f,qh.get(f)):H0(p,f)===9&&t.set(f,pX)}}else{var h=iY(e);qh.forEach(function(m,v){!t.has(v)&&h.has(v)&&t.set(v,m)})}return t}var iY=a_(function(e){for(var t=new Set,r=e.atom_site,n=r.label_comp_id,a=r.auth_comp_id,i=n.isDefined?n:a,o=0,s=i.rowCount;o<s;++o)t.add(i.value(o));return t});function ZMe(e){for(var t=new Map,r=e.atom_site,n=r.label_asym_id,a=r.auth_asym_id,i=r.label_entity_id,o=0,s=n.rowCount;o<s;++o){var u=n.value(o);t.has(u)||t.set(u,{id:u,auth_id:a.value(o),entity_id:i.value(o)})}if(e.struct_asym._rowCount>0)for(var l=e.struct_asym,u=l.id,c=l.entity_id,o=0,s=u.rowCount;o<s;++o){var d=u.value(o);t.has(d)||t.set(d,{id:d,auth_id:"",entity_id:c.value(o)})}return t}function JMe(e){return{missingResidues:KMe(e),chemicalComponentMap:$Me(e),saccharideComponentMap:QMe(e),structAsymMap:ZMe(e)}}var eDe=ye.Schema.Aliased(ye.Schema.Str(""));function oY(e,t){var r,n;if(e.entity.id.isDefined)n=e.entity;else{for(var a=new Set,i=[],o=[],s=e.atom_site,u=s.label_entity_id,l=s.label_comp_id,c=0,d=e.atom_site._rowCount;c<d;c++){var f=u.value(c);a.has(f)||(i.push(f),o.push(FTe(l.value(c))),a.add(f))}for(var p=e.ihm_sphere_obj_site.entity_id,c=0,d=e.ihm_sphere_obj_site._rowCount;c<d;c++){var f=p.value(c);a.has(f)||(i.push(f),o.push("polymer"),a.add(f))}for(var h=e.ihm_gaussian_obj_site.entity_id,c=0,d=e.ihm_gaussian_obj_site._rowCount;c<d;c++){var f=h.value(c);a.has(f)||(i.push(f),o.push("polymer"),a.add(f))}n=nn.ofPartialColumns(vo.entity,{id:ye.ofArray({array:i,schema:vo.entity.id}),type:ye.ofArray({array:o,schema:vo.entity.type})},i.length)}var m=ye.createIndexer(n.id),v=new Array(n._rowCount);v.fill("other");var g=new Set,y=!1;if(e.entity_poly&&e.entity_poly.type.isDefined)for(var b=e.entity_poly,S=b.entity_id,x=b.type,C=b._rowCount,c=0;c<C;++c){var f=S.value(c);v[m(f)]=x.value(c),g.add(f)}else y=!0;if(e.pdbx_entity_branch&&e.pdbx_entity_branch.entity_id.isDefined)for(var w=e.pdbx_entity_branch,S=w.entity_id,x=w.type,C=w._rowCount,c=0;c<C;++c){var f=S.value(c);v[m(f)]=x.value(c),g.add(f)}else y=!0;if(g.size<v.length&&(y=!0),y){var _=new Map;if(e.chem_comp)for(var E=e.chem_comp,P=E.id,x=E.type,c=0,d=e.chem_comp._rowCount;c<d;c++)_.set(P.value(c),x.value(c));if(e.atom_site)for(var D=e.atom_site,u=D.label_entity_id,l=D.label_comp_id,c=0,d=e.atom_site._rowCount;c<d;c++){var f=u.value(c);if(!g.has(f)){var k=l.value(c),F=_.get(k)||"";v[m(f)]=LTe(k,F),g.add(f)}}}var X=ye.ofArray({array:v,schema:eDe}),U=new Array(n._rowCount);if(U.fill(""),e.pdbx_molecule&&e.pdbx_molecule.prd_id.isDefined)for(var j=e.pdbx_molecule,te=j.asym_id,q=j.prd_id,C=j._rowCount,c=0;c<C;++c){var W=te.value(c),f=(r=t.structAsymMap.get(W))===null||r===void 0?void 0:r.entity_id;f!==void 0&&(U[m(f)]=q.value(c))}var V=ye.ofArray({array:U,schema:ye.Schema.str});return{data:n,subtype:X,prd_id:V,getEntityIndex:m}}function tDe(e,t){var r=t.ihm_model_group,n=t.ihm_model_group_link,a=nn.pickRow(n,function(o){return n.model_id.value(o)===e});if(a){var i=nn.pickRow(r,function(o){return r.id.value(o)===a.group_id});if(i)return i.name}return""}function Hd(e,t,r){return pe(this,void 0,void 0,function(){var n,a,i,o;return he(this,function(s){switch(s.label){case 0:return n=JMe(e),e.ihm_model_list._rowCount>0?[4,iDe(r,e,n,t)]:[3,2];case 1:return i=s.sent(),[3,4];case 2:return[4,aDe(r,e,n,t)];case 3:i=s.sent(),s.label=4;case 4:for(a=i,o=0;o<a.length;o++)rr.TrajectoryInfo.set(a[o],{index:o,size:a.length});return[2,new cm(a)]}})})}function rDe(e,t,r,n,a,i,o){var s=eY(t,r,n,a.chemicalComponentMap,i,o),u=t.pdbx_PDB_model_num.value(0);if(o&&s.sameAsPrevious)return T(T({},o),{id:Cn.create22(),modelNum:u,atomicConformation:s.conformation,_dynamicPropertyData:Object.create(null)});var l=tY,c=rY(e,n,s.hierarchy,l.hierarchy),d=aY(s.hierarchy,n,s.conformation,c),f=e.entry.id.valueKind(0)===0?e.entry.id.value(0):i.name,p=[];return f&&p.push(f),e.struct.title.valueKind(0)===0&&p.push(e.struct.title.value(0)),{id:Cn.create22(),entryId:f,label:p.join(" | "),entry:f,sourceData:i,modelNum:u,parent:void 0,entities:n,sequence:c,atomicHierarchy:s.hierarchy,atomicConformation:s.conformation,atomicRanges:d,atomicChainOperatorMappinng:s.chainOperatorMapping,coarseHierarchy:l.hierarchy,coarseConformation:l.conformation,properties:a,customProperties:new fc,_staticPropertyData:Object.create(null),_dynamicPropertyData:Object.create(null)}}function nDe(e,t,r,n){var a=eY(t.atom_site,t.atom_site_sourceIndex,t.entities,r.chemicalComponentMap,n),i=qMe(t,r),o=rY(e,t.entities,a.hierarchy,i.hierarchy),s=aY(a.hierarchy,t.entities,a.conformation,o),u=e.entry.id.valueKind(0)===0?e.entry.id.value(0):n.name,l=[];return u&&l.push(u),e.struct.title.valueKind(0)===0&&l.push(e.struct.title.value(0)),t.model_name&&l.push(t.model_name),t.model_group_name&&l.push(t.model_group_name),{id:Cn.create22(),entryId:u,label:l.join(" | "),entry:u,sourceData:n,modelNum:t.model_id,parent:void 0,entities:t.entities,sequence:o,atomicHierarchy:a.hierarchy,atomicConformation:a.conformation,atomicRanges:s,atomicChainOperatorMappinng:a.chainOperatorMapping,coarseHierarchy:i.hierarchy,coarseConformation:i.conformation,properties:r,customProperties:new fc,_staticPropertyData:Object.create(null),_dynamicPropertyData:Object.create(null)}}function sY(e,t){var r=e.rowCount;if(!e.isDefined)return r;for(var n=t+1;n<r&&e.areValuesEqual(t,n);)n++;return n}function aDe(e,t,r,n){return pe(this,void 0,void 0,function(){var a,i,o,s,u,l,c,d,f;return he(this,function(p){switch(p.label){case 0:if(a=[],!t.atom_site)return[3,3];i=t.atom_site.id.rowCount,o=oY(t,r),s=0,p.label=1;case 1:return s<i?(u=sY(t.atom_site.pdbx_PDB_model_num,s),[4,nY(e,t.atom_site,s,u)]):[3,3];case 2:return l=p.sent(),c=l.atom_site,d=l.sourceIndex,f=rDe(t,c,d,o,r,n,a.length>0?a[a.length-1]:void 0),a.push(f),s=u,[3,1];case 3:return[2,a]}})})}function qA(e,t){for(var r=new Map,n=e._rowCount,a=0;a<n;){var i=sY(t,a),o=t.value(a);r.set(o,{table:nn.window(e,e._schema,a,i),start:a,end:i}),a=i}return r}function iDe(e,t,r,n){return pe(this,void 0,void 0,function(){var a,i,o,s,u,l,c,d,f,p,h,m,v,g,y,b,S,x,C;return he(this,function(w){switch(w.label){case 0:if(a=oY(t,r),i=t.atom_site.ihm_model_id.isDefined?t.atom_site.ihm_model_id:t.atom_site.pdbx_PDB_model_num,o=qA(t.atom_site,i),s=qA(t.ihm_sphere_obj_site,t.ihm_sphere_obj_site.model_id),u=qA(t.ihm_gaussian_obj_site,t.ihm_gaussian_obj_site.model_id),l=[],!t.ihm_model_list)return[3,6];c=t.ihm_model_list,d=c.model_id,f=c.model_name,p=0,w.label=1;case 1:return p<t.ihm_model_list._rowCount?(h=d.value(p),m=void 0,v=void 0,o.has(h)?(g=o.get(h),[4,nY(e,t.atom_site,g.start,g.end)]):[3,3]):[3,6];case 2:return y=w.sent(),b=y.atom_site,S=y.sourceIndex,m=b,v=S,[3,4];case 3:m=nn.window(t.atom_site,t.atom_site._schema,0,0),v=ye.ofIntArray([]),w.label=4;case 4:x={model_id:h,model_name:f.value(p),model_group_name:tDe(h,t),entities:a,atom_site:m,atom_site_sourceIndex:v,ihm_sphere_obj_site:s.has(h)?s.get(h).table:nn.window(t.ihm_sphere_obj_site,t.ihm_sphere_obj_site._schema,0,0),ihm_gaussian_obj_site:u.has(h)?u.get(h).table:nn.window(t.ihm_gaussian_obj_site,t.ihm_gaussian_obj_site._schema,0,0)},C=nDe(t,x,r,n),l.push(C),w.label=5;case 5:return p++,[3,1];case 6:return[2,l]}})})}function oDe(e,t){for(var r=e.atomName,n=e.residueName,a=new Array(e.count),i=new Array(e.count),o=new Uint32Array(e.count),s=new Uint32Array(e.count),u=new Op,l=new Rp(e.residueNumber,e.atomName),c="",d=0,f="",p=0,h=0,m=-1,v=0,g=e.count;v<g;++v){var y=e.residueNumber.value(v);if(y!==m){var b=e.residueName.value(v),S=H0(l.add(b,v).type,b);(S!==h||y!==m+1&&!(m===99999&&y===0))&&(f=h5(d),d+=1,p=0),c=u.getEntityId(b,S,f),p+=1,m=y,h=S}a[v]=c,i[v]=f,o[v]=p,s[v]=v}var x=ye.ofStringArray(i),C=nn.ofPartialColumns(vo.atom_site,{auth_asym_id:x,auth_atom_id:r,auth_comp_id:n,auth_seq_id:e.residueNumber,Cartn_x:ye.ofFloatArray(ye.mapToArray(e.x,function(w){return w*10},Float32Array)),Cartn_y:ye.ofFloatArray(ye.mapToArray(e.y,function(w){return w*10},Float32Array)),Cartn_z:ye.ofFloatArray(ye.mapToArray(e.z,function(w){return w*10},Float32Array)),id:ye.ofIntArray(s),label_asym_id:x,label_atom_id:r,label_comp_id:n,label_seq_id:ye.ofIntArray(o),label_entity_id:ye.ofStringArray(a),occupancy:ye.ofConst(1,e.count,ye.Schema.float),type_symbol:ye.ofStringArray(ye.mapToArray(e.atomName,function(w){return Qw(w)})),pdbx_PDB_model_num:ye.ofConst(t,e.count,ye.Schema.int)},e.count);return Em({entity:u.getEntityTable(),chem_comp:l.getChemCompTable(),atom_site:C})}var P5;(function(e){function t(n){return n?.kind==="gro"}e.is=t;function r(n){return{kind:"gro",name:n.structures[0].header.title,data:n}}e.fromGro=r})(P5||(P5={}));function sDe(e){var t=this;return Qe.create("Parse GRO",function(r){return pe(t,void 0,void 0,function(){var n,a,i,o,s,u;return he(this,function(l){switch(l.label){case 0:n=P5.fromGro(e),a=[],i=0,o=e.structures.length,l.label=1;case 1:return i<o?(s=oDe(e.structures[i].atoms,i+1),[4,Hd(s,n,r)]):[3,4];case 2:u=l.sent(),u.frameCount===1&&a.push(u.representative),l.label=3;case 3:return++i,[3,1];case 4:return[2,new cm(a)]}})})})}function uDe(e,t){var r=function(i,o){return(t.substr(i,o)||"").trim()},n={entry_id:Pt.ofString(e),length_a:Pt.ofString(r(6,9)),length_b:Pt.ofString(r(15,9)),length_c:Pt.ofString(r(24,9)),angle_alpha:Pt.ofString(r(33,7)),angle_beta:Pt.ofString(r(40,7)),angle_gamma:Pt.ofString(r(47,7)),Z_PDB:Pt.ofString(r(66,4)),pdbx_unique_axis:Pt.ofString("?")},a={entry_id:Pt.ofString(e),"space_group_name_H-M":Pt.ofString(r(55,11)),Int_Tables_number:Pt.ofString("?"),cell_setting:Pt.ofString("?"),space_group_name_Hall:Pt.ofString("?")};return[Mi.ofFields("cell",n),Mi.ofFields("symmetry",a)]}function O7(e,t){return{id:e,details:t,groups:[]}}function lDe(e,t,r){for(var n=[],a,i,o,s=1,u=1,l=function(Q){return e.data.substring(e.indices[2*Q],e.indices[2*Q+1])},c=t;c<r;c++){var d=l(c);if(d.substr(11,12)==="BIOMOLECULE:"){var f=d.substr(23).trim(),p="Biomolecule "+f;d=l(c+1),d.substr(11,30)!=="APPLY THE FOLLOWING TO CHAINS:"&&(c++,p=d.substr(11).trim()),a=O7(f,p),n.push(a)}else if(d.substr(13,5)==="BIOMT"){var h=d.split(/\s+/),m=parseInt(d[18])-1;m===0&&(o=de.identity(),i.operators.push({id:s++,matrix:o})),de.setValue(o,m,0,parseFloat(h[4])),de.setValue(o,m,1,parseFloat(h[5])),de.setValue(o,m,2,parseFloat(h[6])),de.setValue(o,m,3,parseFloat(h[7]))}else if(d.substr(11,30)==="APPLY THE FOLLOWING TO CHAINS:"||d.substr(11,30)==="                   AND CHAINS:"){d.substr(11,5)==="APPLY"&&(i={chains:[],operators:[]},a.groups.push(i));for(var v=d.substr(41,30).split(","),g=0,y=v.length;g<y;++g){var b=v[g].trim();b&&i.chains.push(b)}}else if(d.substr(11,33)==="APPLYING THE FOLLOWING TO CHAINS:"){a=O7(""+u,"Biomolecule "+u),n.push(a),u+=1,i={chains:[],operators:[]},a.groups.push(i),c++,d=l(c);for(var v=d.substr(11,69).split(","),g=0,y=v.length;g<y;++g){var b=v[g].trim();b&&i.chains.push(b)}}}if(n.length===0)return[];for(var S={id:Pt.ofStrings(n.map(function(Q){return Q.id})),details:Pt.ofStrings(n.map(function(Q){return Q.details}))},x=[],C=0,w=n;C<w.length;C++)for(var _=w[C],E=0,P=_.groups;E<P.length;E++){var D=P[E];x.push({assembly_id:_.id,oper_expression:D.operators.map(function(Q){return Q.id}).join(","),asym_id_list:D.chains.join(",")})}for(var k={assembly_id:Pt.ofStrings(x.map(function(Q){return Q.assembly_id})),oper_expression:Pt.ofStrings(x.map(function(Q){return Q.oper_expression})),asym_id_list:Pt.ofStrings(x.map(function(Q){return Q.asym_id_list}))},F=[],X=0,U=n;X<U.length;X++)for(var _=U[X],j=0,te=_.groups;j<te.length;j++)for(var q=te[j],W=0,V=q.operators;W<V.length;W++){for(var ee=V[W],m={id:""+ee.id,type:"?",name:"?",symmetry_operation:"?"},c=0;c<3;c++){for(var g=0;g<3;g++)m["matrix["+(c+1)+"]["+(g+1)+"]"]=""+de.getValue(ee.matrix,c,g);m["vector["+(c+1)+"]"]=""+de.getValue(ee.matrix,c,3)}F.push(m)}for(var ue={id:Pt.ofStrings(F.map(function(Q){return Q.id})),type:Pt.ofStrings(F.map(function(Q){return Q.type})),name:Pt.ofStrings(F.map(function(Q){return Q.name})),symmetry_operation:Pt.ofStrings(F.map(function(Q){return Q.symmetry_operation}))},$=function(Q){for(var R=function(K){var L="matrix["+(Q+1)+"]["+(K+1)+"]";ue[L]=Pt.ofStrings(F.map(function(H){return H[L]}))},Y=0;Y<3;Y++)R(Y);var re="vector["+(Q+1)+"]";ue[re]=Pt.ofStrings(F.map(function(K){return K[re]}))},c=0;c<3;c++)$(c);return[Mi.ofFields("pdbx_struct_assembly",S),Mi.ofFields("pdbx_struct_assembly_gen",k),Mi.ofFields("pdbx_struct_oper_list",ue)]}function cDe(e,t,r){for(var n=[],a,i=function(y){return e.data.substring(e.indices[2*y],e.indices[2*y+1])},o=t;o<r;o++){var s=i(o),u=s.split(/\s+/),l=parseInt(s[5])-1;l===0&&(a=de.identity(),n.push(a)),de.setValue(a,l,0,parseFloat(u[2])),de.setValue(a,l,1,parseFloat(u[3])),de.setValue(a,l,2,parseFloat(u[4])),de.setValue(a,l,3,parseFloat(u[5]))}if(n.length===0)return[];for(var c=[],d=1,f=0,p=n;f<p.length;f++){for(var h=p[f],l={id:"ncsop"+d++,code:".",details:"."},o=0;o<3;o++){for(var m=0;m<3;m++)l["matrix["+(o+1)+"]["+(m+1)+"]"]=""+de.getValue(h,o,m);l["vector["+(o+1)+"]"]=""+de.getValue(h,o,3)}c.push(l)}for(var v={id:Pt.ofStrings(c.map(function(y){return y.id})),code:Pt.ofStrings(c.map(function(y){return y.code})),details:Pt.ofStrings(c.map(function(y){return y.details}))},g=function(y){for(var b=function(C){var w="matrix["+(y+1)+"]["+(C+1)+"]";v[w]=Pt.ofStrings(c.map(function(_){return _[w]}))},S=0;S<3;S++)b(S);var x="vector["+(y+1)+"]";v[x]=Pt.ofStrings(c.map(function(C){return C[x]}))},o=0;o<3;o++)g(o);return[Mi.ofFields("struct_ncs_oper",v)]}var dDe={1:"HELX_RH_AL_P",2:"HELX_RH_OM_P",3:"HELX_RH_PI_P",4:"HELX_RH_GA_P",5:"HELX_RH_3T_P",6:"HELX_LH_AL_P",7:"HELX_LH_OM_P",8:"HELX_LH_GA_P",9:"HELX_RH_27_P",10:"HELX_RH_PP_P"};function fDe(e){return dDe[e]||"HELX_P"}function pDe(e,t,r){for(var n=[],a=function(f){return e.data.substring(e.indices[2*f],e.indices[2*f+1])},i=t;i<r;i++){var o=a(i);n.push({serNum:o.substr(7,3).trim(),helixID:o.substr(11,3).trim(),initResName:o.substr(15,3).trim(),initChainID:o.substr(19,1).trim(),initSeqNum:o.substr(21,4).trim(),initICode:o.substr(25,1).trim(),endResName:o.substr(27,3).trim(),endChainID:o.substr(31,3).trim(),endSeqNum:o.substr(33,4).trim(),endICode:o.substr(37,1).trim(),helixClass:o.substr(38,2).trim(),comment:o.substr(40,30).trim(),length:o.substr(71,5).trim()})}var s=Pt.ofStrings(n.map(function(f){return f.initChainID})),u=Pt.ofStrings(n.map(function(f){return f.initResName})),l=Pt.ofStrings(n.map(function(f){return f.endChainID})),c=Pt.ofStrings(n.map(function(f){return f.endResName})),d={beg_label_asym_id:s,beg_label_comp_id:u,beg_label_seq_id:Pt.ofUndefined(n.length,ye.Schema.int),beg_auth_asym_id:s,beg_auth_comp_id:u,beg_auth_seq_id:Pt.ofStrings(n.map(function(f){return f.initSeqNum})),conf_type_id:Pt.ofStrings(n.map(function(f){return fDe(f.helixClass)})),details:Pt.ofStrings(n.map(function(f){return f.comment})),end_label_asym_id:l,end_label_comp_id:c,end_label_seq_id:Pt.ofUndefined(n.length,ye.Schema.int),end_auth_asym_id:l,end_auth_comp_id:c,end_auth_seq_id:Pt.ofStrings(n.map(function(f){return f.endSeqNum})),id:Pt.ofStrings(n.map(function(f){return f.serNum})),pdbx_beg_PDB_ins_code:Pt.ofStrings(n.map(function(f){return f.initICode})),pdbx_end_PDB_ins_code:Pt.ofStrings(n.map(function(f){return f.endICode})),pdbx_PDB_helix_class:Pt.ofStrings(n.map(function(f){return f.helixClass})),pdbx_PDB_helix_length:Pt.ofStrings(n.map(function(f){return f.length})),pdbx_PDB_helix_id:Pt.ofStrings(n.map(function(f){return f.helixID}))};return Mi.ofFields("struct_conf",d)}function hDe(e,t,r){for(var n=[],a=function(h){return e.data.substring(e.indices[2*h],e.indices[2*h+1])},i=t;i<r;i++){var o=a(i);n.push({strand:o.substr(7,3).trim(),sheetID:o.substr(11,3).trim(),numStrands:o.substr(14,2).trim(),initResName:o.substr(17,3).trim(),initChainID:o.substr(21,1).trim(),initSeqNum:o.substr(22,4).trim(),initICode:o.substr(26,1).trim(),endResName:o.substr(28,3).trim(),endChainID:o.substr(32,1).trim(),endSeqNum:o.substr(33,4).trim(),endICode:o.substr(37,1).trim(),sense:o.substr(38,2).trim(),curAtom:o.substr(41,4).trim(),curResName:o.substr(45,3).trim(),curChainId:o.substr(49,1).trim(),curResSeq:o.substr(50,4).trim(),curICode:o.substr(54,1).trim(),prevAtom:o.substr(56,4).trim(),prevResName:o.substr(60,3).trim(),prevChainId:o.substr(64,1).trim(),prevResSeq:o.substr(65,4).trim(),prevICode:o.substr(69,1).trim()})}var s=Pt.ofStrings(n.map(function(h){return h.initChainID})),u=Pt.ofStrings(n.map(function(h){return h.initResName})),l=Pt.ofStrings(n.map(function(h){return h.initSeqNum})),c=Pt.ofStrings(n.map(function(h){return h.endChainID})),d=Pt.ofStrings(n.map(function(h){return h.endResName})),f=Pt.ofStrings(n.map(function(h){return h.endSeqNum})),p={beg_label_asym_id:s,beg_label_comp_id:u,beg_label_seq_id:l,beg_auth_asym_id:s,beg_auth_comp_id:u,beg_auth_seq_id:l,end_label_asym_id:c,end_label_comp_id:c,end_label_seq_id:f,end_auth_asym_id:c,end_auth_comp_id:d,end_auth_seq_id:f,id:Pt.ofStrings(n.map(function(h){return h.strand})),sheet_id:Pt.ofStrings(n.map(function(h){return h.sheetID})),pdbx_beg_PDB_ins_code:Pt.ofStrings(n.map(function(h){return h.initICode})),pdbx_end_PDB_ins_code:Pt.ofStrings(n.map(function(h){return h.endICode}))};return Mi.ofFields("struct_sheet_range",p)}var mDe={MOL_ID:"",MOLECULE:"",CHAIN:"",FRAGMENT:"",SYNONYM:"",EC:"",ENGINEERED:"",MUTATION:"",OTHER_DETAILS:""};function vDe(e,t,r){for(var n=function(p){return e.data.substring(e.indices[2*p],e.indices[2*p+1])},a,i={chains:[],description:""},o=[],s=t;s<r;s++){var u=n(s),l=u.substr(10,70).trim(),c=l.indexOf(":"),d=l.substring(0,c),f=void 0;d in mDe?(a=d,f=l.substring(c+2)):f=l,f=f.replace(/;$/,""),a==="MOL_ID"?(i={chains:[],description:""},o.push(i)):a==="MOLECULE"?(i.description&&(i.description+=" "),i.description+=f):a==="CHAIN"&&Array.prototype.push.apply(i.chains,f.split(/\s*,\s*/))}return o}function gDe(e,t,r){for(var n=function(l){return e.data.substring(e.indices[2*l],e.indices[2*l+1])},a=new Map,i=t;i<r;i++){var o=n(i),s=o.substr(11,3).trim(),u=o.substr(15).trim();a.has(s)?a.set(s,a.get(s)+" "+u):a.set(s,u)}return a}function yDe(e,t){var r=function(){return[]},n=function(){return yt.create(e,2*t)};return{index:0,group_PDB:n(),id:r(),auth_atom_id:n(),label_alt_id:n(),auth_comp_id:n(),auth_asym_id:n(),auth_seq_id:n(),pdbx_PDB_ins_code:n(),Cartn_x:n(),Cartn_y:n(),Cartn_z:n(),occupancy:n(),B_iso_or_equiv:n(),type_symbol:n(),pdbx_PDB_model_num:r(),label_entity_id:r(),partial_charge:n()}}function bDe(e){var t=Pt.ofTokens(e.auth_asym_id),r=Pt.ofTokens(e.auth_atom_id),n=Pt.ofTokens(e.auth_comp_id);return{auth_asym_id:t,auth_atom_id:r,auth_comp_id:n,auth_seq_id:Pt.ofTokens(e.auth_seq_id),B_iso_or_equiv:Pt.ofTokens(e.B_iso_or_equiv),Cartn_x:Pt.ofTokens(e.Cartn_x),Cartn_y:Pt.ofTokens(e.Cartn_y),Cartn_z:Pt.ofTokens(e.Cartn_z),group_PDB:Pt.ofTokens(e.group_PDB),id:Pt.ofStrings(e.id),label_alt_id:Pt.ofTokens(e.label_alt_id),label_asym_id:t,label_atom_id:r,label_comp_id:n,label_seq_id:Pt.ofUndefined(e.index,ye.Schema.int),label_entity_id:Pt.ofStrings(e.label_entity_id),occupancy:Pt.ofTokens(e.occupancy),type_symbol:Pt.ofTokens(e.type_symbol),pdbx_PDB_ins_code:Pt.ofTokens(e.pdbx_PDB_ins_code),pdbx_PDB_model_num:Pt.ofStrings(e.pdbx_PDB_model_num),partial_charge:Pt.ofTokens(e.partial_charge)}}function B7(e,t,r,n,a,i){var o=r.data,s=a-n;yt.addToken(e.group_PDB,Bt.trim(r,n,n+6)),Bt.trim(r,n+6,n+11),e.id[e.index]=r.data.substring(r.tokenStart,r.tokenEnd),yt.addToken(e.auth_atom_id,Bt.trim(r,n+12,n+16)),o.charCodeAt(n+16)===32?yt.add(e.label_alt_id,0,0):yt.add(e.label_alt_id,n+16,n+17),yt.addToken(e.auth_comp_id,Bt.trim(r,n+17,n+20)),yt.add(e.auth_asym_id,n+21,n+22),yt.addToken(e.auth_seq_id,Bt.trim(r,n+22,n+26)),o.charCodeAt(n+26)===32?yt.add(e.pdbx_PDB_ins_code,0,0):yt.add(e.pdbx_PDB_ins_code,n+26,n+27),yt.addToken(e.Cartn_x,Bt.trim(r,n+30,n+38)),yt.addToken(e.Cartn_y,Bt.trim(r,n+38,n+46)),yt.addToken(e.Cartn_z,Bt.trim(r,n+46,n+54)),yt.addToken(e.occupancy,Bt.trim(r,n+54,n+60)),s>=66?yt.addToken(e.B_iso_or_equiv,Bt.trim(r,n+60,n+66)):yt.add(e.B_iso_or_equiv,0,0),i&&yt.addToken(e.partial_charge,Bt.trim(r,n+70,n+76)),s>=78&&!i?(Bt.trim(r,n+76,n+78),r.tokenStart<r.tokenEnd?yt.addToken(e.type_symbol,r):UC(e.type_symbol,o,n+12,n+16)):UC(e.type_symbol,o,n+12,n+16),e.pdbx_PDB_model_num[e.index]=t,e.index++}function xDe(e,t){var r=function(){return[]},n=function(){return new Float32Array(t)},a=function(){return yt.create(e,2*t)};return{index:0,count:t,id:r(),type_symbol:a(),pdbx_label_atom_id:a(),pdbx_label_alt_id:a(),pdbx_label_comp_id:a(),pdbx_label_asym_id:a(),pdbx_label_seq_id:a(),pdbx_PDB_ins_code:a(),"U[1][1]":n(),"U[2][2]":n(),"U[3][3]":n(),"U[1][2]":n(),"U[1][3]":n(),"U[2][3]":n(),pdbx_auth_seq_id:a(),pdbx_auth_comp_id:a(),pdbx_auth_asym_id:a(),pdbx_auth_atom_id:a()}}function SDe(e){var t=Pt.ofTokens(e.pdbx_auth_seq_id),r=Pt.ofTokens(e.pdbx_auth_comp_id),n=Pt.ofTokens(e.pdbx_auth_asym_id),a=Pt.ofTokens(e.pdbx_auth_atom_id),i={id:Pt.ofStrings(e.id),type_symbol:Pt.ofTokens(e.type_symbol),pdbx_label_atom_id:a,pdbx_label_alt_id:Pt.ofTokens(e.pdbx_label_alt_id),pdbx_label_comp_id:r,pdbx_label_asym_id:n,pdbx_label_seq_id:t,pdbx_PDB_ins_code:Pt.ofTokens(e.pdbx_PDB_ins_code),pdbx_auth_seq_id:t,pdbx_auth_comp_id:r,pdbx_auth_asym_id:n,pdbx_auth_atom_id:a};return i["U[1][1]"]=Pt.ofNumbers(e["U[1][1]"]),i["U[2][2]"]=Pt.ofNumbers(e["U[2][2]"]),i["U[3][3]"]=Pt.ofNumbers(e["U[3][3]"]),i["U[1][2]"]=Pt.ofNumbers(e["U[1][2]"]),i["U[1][3]"]=Pt.ofNumbers(e["U[1][3]"]),i["U[2][3]"]=Pt.ofNumbers(e["U[2][3]"]),i}function CDe(e,t,r,n,a){var i=r.data,o=a-n;Bt.trim(r,n+6,n+11),e.id[e.index]=i.substring(r.tokenStart,r.tokenEnd),yt.addToken(e.pdbx_auth_atom_id,Bt.trim(r,n+12,n+16)),i.charCodeAt(n+16)===32?yt.add(e.pdbx_label_alt_id,0,0):yt.add(e.pdbx_label_alt_id,n+16,n+17),yt.addToken(e.pdbx_auth_comp_id,Bt.trim(r,n+17,n+20)),yt.add(e.pdbx_auth_asym_id,n+21,n+22),yt.addToken(e.pdbx_auth_seq_id,Bt.trim(r,n+22,n+26)),i.charCodeAt(n+26)===32?yt.add(e.pdbx_PDB_ins_code,0,0):yt.add(e.pdbx_PDB_ins_code,n+26,n+27),e["U[1][1]"][e.index]=hh(i,n+28,n+35)/1e4,e["U[2][2]"][e.index]=hh(i,n+35,n+42)/1e4,e["U[3][3]"][e.index]=hh(i,n+42,n+49)/1e4,e["U[1][2]"][e.index]=hh(i,n+49,n+56)/1e4,e["U[1][3]"][e.index]=hh(i,n+56,n+63)/1e4,e["U[2][3]"][e.index]=hh(i,n+63,n+70)/1e4,o>=78?(Bt.trim(r,n+76,n+78),r.tokenStart<r.tokenEnd?yt.addToken(e.type_symbol,r):UC(e.type_symbol,i,n+12,n+16)):UC(e.type_symbol,i,n+12,n+16),e.index++}function wDe(e,t,r,n){for(var a={},i=0,o=n.id.rowCount;i<o;++i)a[n.id.str(i)]=i;for(var s=function(D){return e.data.substring(e.indices[2*D],e.indices[2*D+1])},u=[],l=[],c=[],d=[],f=[],p=[],h=[],m=[],v=[],g=[],y=[11,16,21,26],b=1,i=t;i<r;i++){var S=s(i),x=a[parseInt(S.substr(6,5))],C={};if(x!==void 0)for(var w=0;w<4;++w){var _=parseInt(S.substr(y[w],5));if(!Number.isNaN(_)){var E=a[_];E!==void 0&&(x>E||C[E]===void 0&&(u.push("covale"+b),l.push("covale"),c.push(n.label_asym_id.str(x)),f.push(n.auth_seq_id.int(x)),d.push(n.label_seq_id.int(x)),p.push(n.label_atom_id.str(x)),h.push(n.label_asym_id.str(E)),v.push(n.auth_seq_id.int(E)),m.push(n.label_seq_id.int(E)),g.push(n.label_atom_id.str(E)),b+=1))}}}var P={id:Pt.ofStrings(u),conn_type_id:Pt.ofStrings(l),ptnr1_label_asym_id:Pt.ofStrings(c),ptnr1_auth_seq_id:Pt.ofNumbers(f),ptnr1_label_seq_id:Pt.ofNumbers(d),ptnr1_label_atom_id:Pt.ofStrings(p),ptnr2_label_asym_id:Pt.ofStrings(h),ptnr2_label_seq_id:Pt.ofNumbers(m),ptnr2_auth_seq_id:Pt.ofNumbers(v),ptnr2_label_atom_id:Pt.ofStrings(g)};return Mi.ofFields("struct_conn",P)}function _De(e){return pe(this,void 0,void 0,function(){var t,r,n,a,i,o,s,E,v,g,y,u,l,c,d,f,p,h,m,E,v,g,y,b,b,b,b,b,b,b,S,x,C,w,_,E,P,D,k,F,X,U,j,te;return he(this,function(q){for(t=e.lines,r=t.data,n=t.indices,a=Bt(r),i=!!e.isPdbqt,o=0,s=0,E=0,v=t.count;E<v;E++)switch(g=n[2*E],y=n[2*E+1],r[g]){case"A":Ta(r,g,y,"ATOM  ")?o++:Ta(r,g,y,"ANISOU")&&s++;break;case"H":Ta(r,g,y,"HETATM")&&o++;break}for(u=yDe(r,o),l=xDe(r,s),c=new Op,d=[],f=[],p=0,h="",m=void 0,E=0,v=t.count;E<v;E++)switch(g=n[2*E],y=n[2*E+1],r[g]){case"A":Ta(r,g,y,"ATOM  ")?(p||(p++,h=""+p),B7(u,h,a,g,y,i)):Ta(r,g,y,"ANISOU")&&CDe(l,h,a,g,y);break;case"C":if(Ta(r,g,y,"CRYST1"))d.push.apply(d,uDe(e.id||"?",r.substring(g,y)));else if(Ta(r,g,y,"CONECT")){for(b=E+1;g=n[2*b],y=n[2*b+1],!!Ta(r,g,y,"CONECT");)b++;m?Fr&&console.log("only single CONECT block allowed, ignoring others"):m=[E,b],E=b-1}else if(Ta(r,g,y,"COMPND")){for(b=E+1;g=n[2*b],y=n[2*b+1],!!Ta(r,g,y,"COMPND");)b++;c.setCompounds(vDe(t,E,b)),E=b-1}break;case"H":if(Ta(r,g,y,"HETATM"))p||(p++,h=""+p),B7(u,h,a,g,y,i);else if(Ta(r,g,y,"HELIX")){for(b=E+1;g=n[2*b],y=n[2*b+1],!!Ta(r,g,y,"HELIX");)b++;d.push(pDe(t,E,b)),E=b-1}else if(Ta(r,g,y,"HETNAM")){for(b=E+1;g=n[2*b],y=n[2*b+1],!!Ta(r,g,y,"HETNAM");)b++;f.push.apply(f,Array.from(gDe(t,E,b).entries())),E=b-1}break;case"M":if(Ta(r,g,y,"MODEL ")&&(p++,h=""+p),Ta(r,g,y,"MTRIX")){for(b=E+1;g=n[2*b],y=n[2*b+1],!!Ta(r,g,y,"MTRIX");)b++;d.push.apply(d,cDe(t,E,b)),E=b-1}break;case"O":break;case"R":if(Ta(r,g,y,"REMARK 350")){for(b=E+1;g=n[2*b],y=n[2*b+1],!!Ta(r,g,y,"REMARK 350");)b++;d.push.apply(d,lDe(t,E,b)),E=b-1}break;case"S":if(Ta(r,g,y,"SHEET")){for(b=E+1;g=n[2*b],y=n[2*b+1],!!Ta(r,g,y,"SHEET");)b++;d.push(hDe(t,E,b)),E=b-1}break}for(S=ye.ofIntTokens(u.auth_seq_id),x=ye.ofStringTokens(u.auth_atom_id),C=ye.ofStringTokens(u.auth_comp_id),w=ye.ofStringTokens(u.auth_asym_id),_=new Rp(S,x),_.setNames(f),c.setNames(f),E=0,P=C.rowCount;E<P;++E)D=C.value(E),k=H0(_.add(D,E).type,D),u.label_entity_id[E]=c.getEntityId(D,k,w.value(E));for(F=bDe(u),i||delete F.partial_charge,m&&d.push(wDe(t,m[0],m[1],F)),X={entity:Mi.ofTable("entity",c.getEntityTable()),chem_comp:Mi.ofTable("chem_comp",_.getChemCompTable()),atom_site:Mi.ofFields("atom_site",F),atom_site_anisotrop:Mi.ofFields("atom_site_anisotrop",SDe(l))},U=0,j=d;U<j.length;U++)te=j[U],X[te.name]=te;return[2,{header:e.id||"PDB",categoryNames:Object.keys(X),categories:X}]})})}var x0;(function(e){e.Descriptor={name:"atom_partial_charge"},e.Provider=ol.create(e.Descriptor)})(x0||(x0={}));var I5;(function(e){function t(n){return n?.kind==="pdb"}e.is=t;function r(n){return{kind:"pdb",name:n.id||"",data:n}}e.create=r})(I5||(I5={}));function ADe(e){var t=this;return Qe.create("Parse PDB",function(r){return pe(t,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d,f,p;return he(this,function(h){switch(h.label){case 0:return[4,r.update("Converting to mmCIF")];case 1:return h.sent(),[4,_De(e)];case 2:return n=h.sent(),a=xn.fromFrame(n,void 0,I5.create(e)),[4,Hd(a.data.db,a,r)];case 3:return i=h.sent(),o=(p=n.categories.atom_site)===null||p===void 0?void 0:p.getField("partial_charge"),o&&i.frameCount===1&&(s=i.representative,u=s.atomicHierarchy.atomSourceIndex,l=ye.isIdentity(u),c=l?void 0:u.toArray({array:Int32Array}),d=o.toFloatArray(),f=c?ye.ofFloatArray(ye.mapToArray(u,function(m){return d[m]},Float32Array)):ye.ofFloatArray(d),x0.Provider.set(s,{data:f,type:"GASTEIGER"})),[2,i]}})})})}function TDe(e){for(var t=new Array(e.count),r=new Array(e.count),n=new Uint32Array(e.count),a=new Uint32Array(e.count),i=new Op,o=new Rp(e.residueId,e.atomName),s="",u=0,l="",c=0,d=e.segmentName.value(0),f=!1,p=0,h=-1,m=0,v=e.count;m<v;++m){var g=e.residueId.value(m),y=e.segmentName.value(m);if(d!==y?(l=h5(u),u+=1,c=0,f=!0,d=y):f=!1,f||g!==h){var b=e.residueName.value(m),S=H0(o.add(b,m).type,b);!f&&(S!==p||g!==h+1)&&(l=h5(u),u+=1,c=0),s=i.getEntityId(b,S,l),c+=1,h=g,p=S}t[m]=s,r[m]=l,n[m]=c,a[m]=m}var x=nn.ofPartialColumns(vo.atom_site,{auth_asym_id:e.segmentName,auth_atom_id:e.atomName,auth_comp_id:e.residueName,auth_seq_id:e.residueId,id:ye.ofIntArray(a),label_asym_id:ye.ofStringArray(r),label_atom_id:e.atomName,label_comp_id:e.residueName,label_seq_id:ye.ofIntArray(n),label_entity_id:ye.ofStringArray(t),occupancy:ye.ofConst(1,e.count,ye.Schema.float),type_symbol:ye.ofStringArray(ye.mapToArray(e.atomName,function(C){return Qw(C)})),pdbx_PDB_model_num:ye.ofConst(1,e.count,ye.Schema.int)},e.count);return Em({entity:i.getEntityTable(),chem_comp:o.getChemCompTable(),atom_site:x})}var M5;(function(e){function t(n){return n?.kind==="psf"}e.is=t;function r(n){return{kind:"psf",name:n.id,data:n}}e.fromPsf=r})(M5||(M5={}));function EDe(e){var t=this;return Qe.create("Parse PSF",function(r){return pe(t,void 0,void 0,function(){var n,a,i,o,s,u;return he(this,function(l){return n=M5.fromPsf(e),a=TDe(e.atoms),i=e.bonds,o=i.atomIdA,s=i.atomIdB,u={indexA:ye.ofLambda({value:function(c){return o.value(c)-1},rowCount:o.rowCount,schema:o.schema}),indexB:ye.ofLambda({value:function(c){return s.value(c)-1},rowCount:s.rowCount,schema:s.schema}),order:ye.ofConst(1,e.bonds.count,ye.Schema.int)},[2,v5.create(e.id,a,u,n)]})})})}function PDe(e){return Object.keys(e).filter(function(t){return!isNaN(t)}).map(function(t){return+t}).sort(function(t,r){return t-r}).map(function(t){return e[t]})}function WA(e,t,r){return e&&e[t]!==void 0?e[t]:r}function ct(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return{kind:"alias",aliases:t,symbol:e}}function J2(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];return e.info.namespace="molscript-macro",e.id="molscript-macro."+e.info.name,{kind:"macro",symbol:e,translate:t,aliases:Gt([e.info.name],r)}}function IDe(e){return e.kind==="alias"||e.kind==="macro"}var MDe=[["Core symbols",ct(Ae.core.type.bool,"bool"),ct(Ae.core.type.num,"num"),ct(Ae.core.type.str,"str"),ct(Ae.core.type.regex,"regex"),ct(Ae.core.type.list,"list"),ct(Ae.core.type.set,"set"),ct(Ae.core.type.compositeKey,"composite-key"),ct(Ae.core.logic.not,"not"),ct(Ae.core.logic.and,"and"),ct(Ae.core.logic.or,"or"),ct(Ae.core.ctrl.if,"if"),ct(Ae.core.ctrl.fn,"fn"),ct(Ae.core.ctrl.eval,"eval"),ct(Ae.core.math.add,"add","+"),ct(Ae.core.math.sub,"sub","-"),ct(Ae.core.math.mult,"mult","*"),ct(Ae.core.math.div,"div","/"),ct(Ae.core.math.pow,"pow","**"),ct(Ae.core.math.mod,"mod"),ct(Ae.core.math.min,"min"),ct(Ae.core.math.max,"max"),ct(Ae.core.math.floor,"floor"),ct(Ae.core.math.ceil,"ceil"),ct(Ae.core.math.roundInt,"round"),ct(Ae.core.math.abs,"abs"),ct(Ae.core.math.sqrt,"sqrt"),ct(Ae.core.math.cbrt,"cbrt"),ct(Ae.core.math.sin,"sin"),ct(Ae.core.math.cos,"cos"),ct(Ae.core.math.tan,"tan"),ct(Ae.core.math.asin,"asin"),ct(Ae.core.math.acos,"acos"),ct(Ae.core.math.atan,"atan"),ct(Ae.core.math.sinh,"sinh"),ct(Ae.core.math.cosh,"cosh"),ct(Ae.core.math.tanh,"tanh"),ct(Ae.core.math.exp,"exp"),ct(Ae.core.math.log,"log"),ct(Ae.core.math.log10,"log10"),ct(Ae.core.math.atan2,"atan2"),ct(Ae.core.rel.eq,"eq","="),ct(Ae.core.rel.neq,"neq","!="),ct(Ae.core.rel.lt,"lt","<"),ct(Ae.core.rel.lte,"lte","<="),ct(Ae.core.rel.gr,"gr",">"),ct(Ae.core.rel.gre,"gre",">="),ct(Ae.core.rel.inRange,"in-range"),ct(Ae.core.str.concat,"concat"),ct(Ae.core.str.match,"regex.match"),ct(Ae.core.list.getAt,"list.get"),ct(Ae.core.set.has,"set.has"),ct(Ae.core.set.isSubset,"set.subset")],["Structure",["Types",ct(Ae.structureQuery.type.entityType,"ent-type"),ct(Ae.structureQuery.type.authResidueId,"auth-resid"),ct(Ae.structureQuery.type.labelResidueId,"label-resid"),ct(Ae.structureQuery.type.ringFingerprint,"ringfp"),ct(Ae.structureQuery.type.bondFlags,"bond-flags")],["Slots",ct(Ae.structureQuery.slot.elementSetReduce,"atom.set.reduce.value")],["Generators",ct(Ae.structureQuery.generator.atomGroups,"sel.atom.atom-groups"),ct(Ae.structureQuery.generator.queryInSelection,"sel.atom.query-in-selection"),ct(Ae.structureQuery.generator.rings,"sel.atom.rings"),ct(Ae.structureQuery.generator.empty,"sel.atom.empty"),ct(Ae.structureQuery.generator.all,"sel.atom.all"),ct(Ae.structureQuery.generator.bondedAtomicPairs,"sel.atom.bonded-pairs"),J2(Jg("sel.atom.atoms",zt.Dictionary({0:bt(De.Bool,{isOptional:!0,defaultValue:!0,description:"Test applied to each atom."})}),Mt.ElementSelection,"A selection of singleton atom sets."),function(e){return ce.struct.generator.atomGroups({"atom-test":WA(e,0,!0)})}),J2(Jg("sel.atom.res",zt.Dictionary({0:bt(De.Bool,{isOptional:!0,defaultValue:!0,description:"Test applied to the 1st atom of each residue."})}),Mt.ElementSelection,"A selection of atom sets grouped by residue."),function(e){return ce.struct.generator.atomGroups({"residue-test":WA(e,0,!0),"group-by":ce.ammp("residueKey")})}),J2(Jg("sel.atom.chains",zt.Dictionary({0:bt(De.Bool,{isOptional:!0,defaultValue:!0,description:"Test applied to the 1st atom of each chain."})}),Mt.ElementSelection,"A selection of atom sets grouped by chain."),function(e){return ce.struct.generator.atomGroups({"chain-test":WA(e,0,!0),"group-by":ce.ammp("chainKey")})})],["Modifiers",ct(Ae.structureQuery.modifier.queryEach,"sel.atom.query-each"),ct(Ae.structureQuery.modifier.intersectBy,"sel.atom.intersect-by"),ct(Ae.structureQuery.modifier.exceptBy,"sel.atom.except-by"),ct(Ae.structureQuery.modifier.unionBy,"sel.atom.union-by"),ct(Ae.structureQuery.modifier.union,"sel.atom.union"),ct(Ae.structureQuery.modifier.cluster,"sel.atom.cluster"),ct(Ae.structureQuery.modifier.includeSurroundings,"sel.atom.include-surroundings"),ct(Ae.structureQuery.modifier.surroundingLigands,"sel.atom.surrounding-ligands"),ct(Ae.structureQuery.modifier.includeConnected,"sel.atom.include-connected"),ct(Ae.structureQuery.modifier.expandProperty,"sel.atom.expand-property")],["Filters",ct(Ae.structureQuery.filter.pick,"sel.atom.pick"),ct(Ae.structureQuery.filter.first,"sel.atom.first"),ct(Ae.structureQuery.filter.withSameAtomProperties,"sel.atom.with-same-atom-properties"),ct(Ae.structureQuery.filter.intersectedBy,"sel.atom.intersected-by"),ct(Ae.structureQuery.filter.within,"sel.atom.within"),ct(Ae.structureQuery.filter.isConnectedTo,"sel.atom.is-connected-to")],["Combinators",ct(Ae.structureQuery.combinator.intersect,"sel.atom.intersect"),ct(Ae.structureQuery.combinator.merge,"sel.atom.merge"),ct(Ae.structureQuery.combinator.distanceCluster,"sel.atom.dist-cluster")],["Atom Set Properties",ct(Ae.structureQuery.atomSet.atomCount,"atom.set.atom-count"),ct(Ae.structureQuery.atomSet.countQuery,"atom.set.count-query"),ct(Ae.structureQuery.atomSet.reduce,"atom.set.reduce"),ct(Ae.structureQuery.atomSet.propertySet,"atom.set.property")],["Atom Properties",ct(Ae.structureQuery.atomProperty.core.elementSymbol,"atom.el"),ct(Ae.structureQuery.atomProperty.core.vdw,"atom.vdw"),ct(Ae.structureQuery.atomProperty.core.mass,"atom.mass"),ct(Ae.structureQuery.atomProperty.core.atomicNumber,"atom.atomic-number"),ct(Ae.structureQuery.atomProperty.core.x,"atom.x"),ct(Ae.structureQuery.atomProperty.core.y,"atom.y"),ct(Ae.structureQuery.atomProperty.core.z,"atom.z"),ct(Ae.structureQuery.atomProperty.core.sourceIndex,"atom.src-index"),ct(Ae.structureQuery.atomProperty.core.operatorName,"atom.op-name"),ct(Ae.structureQuery.atomProperty.core.modelIndex,"atom.model-index"),ct(Ae.structureQuery.atomProperty.core.modelLabel,"atom.model-label"),ct(Ae.structureQuery.atomProperty.core.atomKey,"atom.key"),ct(Ae.structureQuery.atomProperty.core.bondCount,"atom.bond-count"),ct(Ae.structureQuery.atomProperty.topology.connectedComponentKey,"atom.key.molecule"),ct(Ae.structureQuery.atomProperty.macromolecular.authResidueId,"atom.auth-resid"),ct(Ae.structureQuery.atomProperty.macromolecular.labelResidueId,"atom.label-resid"),ct(Ae.structureQuery.atomProperty.macromolecular.residueKey,"atom.key.res"),ct(Ae.structureQuery.atomProperty.macromolecular.chainKey,"atom.key.chain"),ct(Ae.structureQuery.atomProperty.macromolecular.entityKey,"atom.key.entity"),ct(Ae.structureQuery.atomProperty.macromolecular.isHet,"atom.is-het"),ct(Ae.structureQuery.atomProperty.macromolecular.id,"atom.id"),ct(Ae.structureQuery.atomProperty.macromolecular.label_atom_id,"atom.label_atom_id"),ct(Ae.structureQuery.atomProperty.macromolecular.label_alt_id,"atom.label_alt_id","atom.altloc"),ct(Ae.structureQuery.atomProperty.macromolecular.label_comp_id,"atom.label_comp_id"),ct(Ae.structureQuery.atomProperty.macromolecular.label_asym_id,"atom.label_asym_id"),ct(Ae.structureQuery.atomProperty.macromolecular.label_entity_id,"atom.label_entity_id"),ct(Ae.structureQuery.atomProperty.macromolecular.label_seq_id,"atom.label_seq_id"),ct(Ae.structureQuery.atomProperty.macromolecular.auth_atom_id,"atom.auth_atom_id","atom.name"),ct(Ae.structureQuery.atomProperty.macromolecular.auth_comp_id,"atom.auth_comp_id","atom.resname"),ct(Ae.structureQuery.atomProperty.macromolecular.auth_asym_id,"atom.auth_asym_id","atom.chain"),ct(Ae.structureQuery.atomProperty.macromolecular.auth_seq_id,"atom.auth_seq_id","atom.resno"),ct(Ae.structureQuery.atomProperty.macromolecular.pdbx_PDB_ins_code,"atom.pdbx_PDB_ins_code","atom.inscode"),ct(Ae.structureQuery.atomProperty.macromolecular.pdbx_formal_charge,"atom.pdbx_formal_charge"),ct(Ae.structureQuery.atomProperty.macromolecular.occupancy,"atom.occupancy"),ct(Ae.structureQuery.atomProperty.macromolecular.B_iso_or_equiv,"atom.B_iso_or_equiv","atom.bfactor"),ct(Ae.structureQuery.atomProperty.macromolecular.entityType,"atom.entity-type"),ct(Ae.structureQuery.atomProperty.macromolecular.entitySubtype,"atom.entity-subtype"),ct(Ae.structureQuery.atomProperty.macromolecular.entityPrdId,"atom.entity-prd-id"),ct(Ae.structureQuery.atomProperty.macromolecular.entityDescription,"atom.entity-description"),ct(Ae.structureQuery.atomProperty.macromolecular.objectPrimitive,"atom.object-primitive"),ct(Ae.structureQuery.atomProperty.macromolecular.chemCompType,"atom.chem-comp-type"),ct(Ae.structureQuery.atomProperty.macromolecular.secondaryStructureKey,"atom.key.sec-struct"),ct(Ae.structureQuery.atomProperty.macromolecular.isModified,"atom.is-modified"),ct(Ae.structureQuery.atomProperty.macromolecular.modifiedParentName,"atom.modified-parent")],["Bond Properties",ct(Ae.structureQuery.bondProperty.order,"bond.order"),ct(Ae.structureQuery.bondProperty.length,"bond.length"),ct(Ae.structureQuery.bondProperty.atomA,"bond.atom-a"),ct(Ae.structureQuery.bondProperty.atomB,"bond.atom-b"),J2(Jg("bond.is",zt.List(Mt.BondFlag),De.Bool,"Test if the current bond has at least one (or all if partial = false) of the specified flags: "+De.oneOfValues(Mt.BondFlag).join(", ")),function(e){return ce.core.flags.hasAny([ce.struct.bondProperty.flags(),ce.struct.type.bondFlags(PDe(e))])})]]],uY=[];function lY(e){for(var t=0,r=e;t<r.length;t++){var n=r[t];IDe(n)?uY.push(n):n instanceof Array&&lY(n)}}lY(MDe);var DDe=function(){for(var e=[],t=Object.create(null),r=on.create(),n=on.create(),a=0,i=uY;a<i.length;a++){for(var o=i[a],s=0,u=o.aliases;s<u.length;s++){var l=u[s];if(e.push([l,o]),t[l])throw new Error("Alias '"+l+"' already in use.");t[l]=o}var c=o.symbol.args;if(c.kind!=="dictionary"){c.type.kind==="oneof"&&De.oneOfValues(c.type).forEach(function(h){return on.add(n,h,h)});continue}for(var d=0,f=Object.keys(c.map);d<f.length;d++){var l=f[d];isNaN(l)&&on.add(r,l,l);var p=c.map[l];p.type.kind==="oneof"&&De.oneOfValues(p.type).forEach(function(m){return on.add(n,m,m)})}}return{symbolList:e,symbolMap:t,namedArgs:r.array,constants:n.array}}(),Jm=DDe.symbolMap;function ay(e){if(Ha.isLiteral(e))return e;if(Ha.isSymbol(e)){if(!Jm[e.name])return e;var t=Jm[e.name];if(t.kind==="alias")return Ha.Symbol(Jm[e.name].symbol.id);throw t.translate([])}var r=Ha.isSymbol(e.head)&&!!Jm[e.head.name]&&Jm[e.head.name].kind==="macro",n=r?e.head:ay(e.head),a=n!==e.head;if(!e.args)return r?ay(e.head):a?Ha.Apply(n):e;var i=!1,o;if(Ha.isArgumentsArray(e.args)){o=[];for(var s=0,u=e.args.length;s<u;s++){var l=e.args[s],c=ay(l);l!==c&&(i=!0),o[o.length]=c}if(i||(o=e.args),!r&&!a&&!i)return e}else{o={};for(var d=0,f=Object.keys(e.args);d<f.length;d++){var p=f[d],l=e.args[p],c=ay(l);l!==c&&(i=!0),o[p]=c}if(!r&&!a&&!i)return e;i||(o=e.args)}if(r){var h=Jm[e.head.name];if(h.kind!=="macro")return Ha.Apply(n,o);var m=h.translate(o);return m}return Ha.Apply(n,o)}function kDe(e){return ay(e)}var Fu=function(){function e(t){this._=t}return e.prototype.parse=function(t){var r=this.skip(e.eof)._(t,0);return r.status?{success:!0,value:r.value}:{success:!1,index:cY(t,r.furthest),expected:r.expected}},e.prototype.tryParse=function(t){var r=this.parse(t);if(r.success)return r.value;var n=BDe(t,r),a=new Error(n);throw a},e.prototype.or=function(t){return e.alt(this,t)},e.prototype.trim=function(t){return this.wrap(t,t)},e.prototype.wrap=function(t,r){return XA(1,typeof t=="string"?e.string(t):t,this,typeof r=="string"?e.string(r):r)},e.prototype.thru=function(t){return t(this)},e.prototype.then=function(t){return XA(1,this,t)},e.prototype.many=function(){var t=this;return new e(function(r,n){for(var a=[],i=void 0;;)if(i=Qs(t._(r,n),i),i.status){if(n===i.index)throw new Error("infinite loop detected in .many() parser --- calling .many() on a parser which can accept zero characters is usually the cause");n=i.index,a.push(i.value)}else return Qs(Gi(n,a),i)})},e.prototype.times=function(t,r){var n=this,a=typeof r>"u"?t:r;return new e(function(i,o){var s=[],u=void 0,l=void 0,c;for(c=0;c<t;c++)if(u=n._(i,o),l=Qs(u,l),u.status)o=u.index,s.push(u.value);else return l;for(;c<a&&(u=n._(i,o),l=Qs(u,l),u.status);c+=1)o=u.index,s.push(u.value);return Qs(Gi(o,s),l)})},e.prototype.result=function(t){return this.map(function(){return t})},e.prototype.atMost=function(t){return this.times(0,t)},e.prototype.atLeast=function(t){return e.seq(this.times(t),this.many()).map(function(r){return Gt(Gt([],r[0]),r[1])})},e.prototype.map=function(t){var r=this;return new e(function(n,a){var i=r._(n,a);return i.status?Qs(Gi(i.index,t(i.value)),i):i})},e.prototype.skip=function(t){return XA(0,this,t)},e.prototype.mark=function(){return e.seq(e.index,this,e.index).map(function(t){return{start:t[0],value:t[1],end:t[2]}})},e.prototype.node=function(t){return e.seq(e.index,this,e.index).map(function(r){return{name:t,start:r[0],value:r[1],end:r[2]}})},e.prototype.sepBy=function(t){return e.sepBy(this,t)},e.prototype.sepBy1=function(t){return e.sepBy1(this,t)},e.prototype.lookahead=function(t){return this.skip(e.lookahead(t))},e.prototype.notFollowedBy=function(t){return this.skip(e.notFollowedBy(t))},e.prototype.desc=function(t){var r=this;return new e(function(n,a){var i=r._(n,a);return i.status||(i.expected=[t]),i})},e.prototype.fallback=function(t){return this.or(e.succeed(t))},e.prototype.ap=function(t){return e.seq(t,this).map(function(r){var n=r[0],a=r[1];return n(a)})},e.prototype.chain=function(t){var r=this;return new e(function(n,a){var i=r._(n,a);if(!i.status)return i;var o=t(i.value);return Qs(o._(n,i.index),i)})},e}();(function(e){function t(){for(var S=[],x=0;x<arguments.length;x++)S[x]=arguments[x];var C=S.length;return new e(function(w,_){for(var E,P=new Array(C),D=_,k=0;k<C;k++){if(E=Qs(S[k]._(w,D),E),!E.status)return E;P[k]=E.value,D=E.index}return Qs(Gi(D,P),E)})}e.seq=t;function r(){for(var S=[],x=0;x<arguments.length;x++)S[x]=arguments[x];var C=S.length;return C===0?c("zero alternates"):new e(function(w,_){for(var E,P=0;P<S.length;P++)if(E=Qs(S[P]._(w,_),E),E.status)return E;return E})}e.alt=r;function n(S,x){return a(S,x).or(l([]))}e.sepBy=n;function a(S,x){var C=x.then(S).many();return t(S,C).map(function(w){return Gt([w[0]],w[1])})}e.sepBy1=a;function i(S){var x="'"+S+"'";if(S.length===1){var C=S.charCodeAt(0);return new e(function(w,_){return w.charCodeAt(_)===C?Gi(_+1,S):Mc(_,x)})}return new e(function(w,_){var E=_+S.length;return w.slice(_,E)===S?Gi(E,S):Mc(_,x)})}e.string=i;function o(S){var x=""+S;return x.slice(x.lastIndexOf("/")+1)}function s(S){return RegExp("^(?:"+S.source+")",o(S))}function u(S,x){x===void 0&&(x=0);var C=s(S),w=""+S;return new e(function(_,E){var P=C.exec(_.slice(E));if(P){if(0<=x&&x<=P.length){var D=P[0],k=P[x];return Gi(E+D.length,k)}var F="invalid match group (0 to "+P.length+") in "+w;return Mc(E,F)}return Mc(E,w)})}e.regexp=u;function l(S){return new e(function(x,C){return Gi(C,S)})}e.succeed=l;function c(S){return new e(function(x,C){return Mc(C,S)})}e.fail=c;function d(S){if(LDe(S))return new e(function(x,C){var w=S._(x,C);return w.status&&(w.index=C,w.value=null),w});if(typeof S=="string")return d(i(S));if(S instanceof RegExp)return d(u(S));throw new Error("not a string, regexp, or parser: "+S)}e.lookahead=d;function f(S){return new e(function(x,C){var w=S._(x,C);return w.status?Mc(C,'not "'+x.slice(C,w.index)+'"'):Gi(C,null)})}e.notFollowedBy=f;function p(S){return new e(function(x,C){var w=x.charAt(C);return C<x.length&&S(w)?Gi(C+1,w):Mc(C,"a character "+S)})}e.test=p;function h(S){return p(function(x){return S.indexOf(x)>=0})}e.oneOf=h;function m(S){return p(function(x){return S.indexOf(x)<0})}e.noneOf=m;function v(S,x){return p(function(C){return S<=C&&C<=x}).desc(S+"-"+x)}e.range=v;function g(S){return new e(function(x,C){for(var w=C;w<x.length&&S(x.charAt(w));)w++;return Gi(w,x.slice(C,w))})}e.takeWhile=g;function y(S){var x=new e(function(C,w){var _=S()._;return x._=_,_(C,w)});return x}e.lazy=y;function b(){return c("empty")}e.empty=b,e.index=new e(function(S,x){return Gi(x,cY(S,x))}),e.anyChar=new e(function(S,x){return x>=S.length?Mc(x,"any character"):Gi(x+1,S.charAt(x))}),e.all=new e(function(S,x){return Gi(S.length,S.slice(x))}),e.eof=new e(function(S,x){return x<S.length?Mc(x,"EOF"):Gi(x,null)}),e.digit=u(/[0-9]/).desc("a digit"),e.digits=u(/[0-9]*/).desc("optional digits"),e.letter=u(/[a-z]/i).desc("a letter"),e.letters=u(/[a-z]*/i).desc("optional letters"),e.optWhitespace=u(/\s*/).desc("optional whitespace"),e.whitespace=u(/\s+/).desc("whitespace"),e.cr=i("\r"),e.lf=i(`
`),e.crlf=i(`\r
`),e.newline=r(e.crlf,e.lf,e.cr).desc("newline"),e.end=r(e.newline,e.eof)})(Fu||(Fu={}));function XA(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var n=t.length;return new Fu(function(a,i){for(var o,s,u=i,l=0;l<n;l++){if(o=Qs(t[l]._(a,u),o),!o.status)return o;e===l&&(s=o.value),u=o.index}return Qs(Gi(u,s),o)})}function Gi(e,t){return{status:!0,index:e,value:t}}function Mc(e,t){return{status:!1,furthest:e,expected:[t]}}function Qs(e,t){if(!t||e.status||t.status||e.furthest>t.furthest)return e;var r=e.furthest===t.furthest?FDe(e.expected,t.expected):t.expected;return{status:e.status,furthest:t.furthest,expected:r}}function cY(e,t){var r=e.slice(0,t).split(`
`),n=r.length,a=r[r.length-1].length+1;return{offset:t,line:n,column:a}}function RDe(e){return e.length===1?e[0]:"one of "+e.join(", ")}function ODe(e,t){var r=t.index,n=r.offset;if(n===e.length)return", got the end of the input";var a=n>0?"'...":"'",i=e.length-n>12?"...'":"'";return" at line "+r.line+" column "+r.column+", got "+a+e.slice(n,n+12)+i}function BDe(e,t){return"expected "+RDe(t.expected)+ODe(e,t)}function FDe(e,t){var r=e.length,n=t.length;if(r===0)return t;if(n===0)return e;for(var a=new Set,i=[],o=0;o<r;o++)a.has(e[o])||(i[i.length]=e[o],a.add(e[o]));for(var o=0;o<n;o++)a.has(t[o])||(i[i.length]=t[o],a.add(t[o]));return i.sort(),i}function LDe(e){return e instanceof Fu}function NDe(e){return D5.parse(e)}var D5;(function(e){var t;(function(S){function x(E){return{kind:"string",value:E}}S.str=x;function C(E){return{kind:"symbol",value:E}}S.symb=C;function w(E,P){return{kind:"list",bracket:E,nodes:P}}S.list=w;function _(E){return{kind:"comment",value:E}}S.comment=_})(t||(t={}));var r=Fu.regexp(/[\n\r\s]*/),n=Fu.lazy(function(){return Fu.alt(a,d,i,o).trim(r)}),a=Fu.takeWhile(function(S){return S!=="`"}).trim("`").map(t.str),i=Fu.regexp(/[^()\[\]{};`,\n\r\s]+/).map(t.symb),o=Fu.regexp(/\s*;+([^\n\r]*)\n/,1).map(t.comment),s=n.many(),u=s.wrap("(",")").map(function(S){return t.list("(",S)}),l=s.wrap("[","]").map(function(S){return t.list("[",S)}),c=s.wrap("{","}").map(function(S){return t.list("{",S)}),d=Fu.alt(u,l,c),f=n.many();function p(S){return f.tryParse(S)}function h(S){switch(S.kind){case"string":return S.value;case"symbol":{var x=S.value;if(x.length>1){var C=x.charAt(0);switch(C){case".":return ce.atomName(x.substr(1));case"_":return ce.struct.type.elementSymbol([x.substr(1)])}}return x==="true"?!0:x==="false"?!1:y(x)?+x:Ha.Symbol(x)}case"list":{switch(S.bracket){case"[":return ce.core.type.list(g(S.nodes).map(h));case"{":return ce.core.type.set(g(S.nodes).map(h));case"(":{var w=h(S.nodes[0]);return Ha.Apply(w,m(S.nodes))}}return 0}default:throw new Error("should not happen")}}function m(S){if(!(S.length<=1)){if(!v(S)){for(var x=[],C=1,w=S.length;C<w;C++){var _=S[C];_.kind!=="comment"&&(x[x.length]=h(_))}return x}for(var E={},P=!0,D=0,C=1,w=S.length;C<w;C++){var _=S[C];if(_.kind!=="comment")if(_.kind==="symbol"&&_.value.length>1&&_.value.charAt(0)===":"){var k=_.value.substr(1);for(++C;C<w&&S[C].kind==="comment";)C++;if(C>=w)throw new Error("There must be a value foolowed a named arg ':"+k+"'.");E[k]=h(S[C]),isNaN(+k)&&(P=!1)}else E[D++]=h(_)}if(P){for(var F=Object.keys(E).map(function(j){return+j}).sort(function(j,te){return j-te}),X=!0,C=0,w=F.length;C<w;C++)if(F[C]!==C){X=!1;break}if(X){for(var U=[],C=0,w=F.length;C<w;C++)U[C]=E[C];return U}}return E}}function v(S){for(var x=1,C=S.length;x<C;x++){var w=S[x];if(w.kind==="symbol"&&w.value.length>1&&w.value.charAt(0)===":")return!0}return!1}function g(S){for(var x=!1,C=0,w=S.length;C<w;C++)if(S[C].kind==="comment"){x=!0;break}return x?S.filter(function(_){return _.kind!=="comment"}):S}function y(S){return/-?(0|[1-9][0-9]*)([.][0-9]+)?([eE][+-]?[0-9]+)?/.test(S)&&!isNaN(+S)}function b(S){for(var x=p(S),C=[],w=0,_=x;w<_.length;w++){var E=_[w];E.kind!=="comment"&&(C[C.length]=h(E))}return C}e.parse=b})(D5||(D5={}));var zDe=function(){function e(){this.map=new Map}return e.prototype.removeSymbol=function(t){this.map.delete(t.symbol.id)},e.prototype.addSymbol=function(t){this.map.has(t.symbol.id)&&console.warn("Symbol '"+t.symbol.id+"' already added. Call removeSymbol/removeCustomProps re-adding the symbol."),this.map.set(t.symbol.id,t)},e.prototype.addCustomProp=function(t){if(!!t.symbols)for(var r=0,n=Object.keys(t.symbols);r<n.length;r++){var a=n[r];this.addSymbol(t.symbols[a])}},e.prototype.removeCustomProp=function(t){if(!!t.symbols)for(var r=0,n=Object.keys(t.symbols);r<n.length;r++){var a=n[r];this.removeSymbol(t.symbols[a])}},e.prototype.getRuntime=function(t){return this.map.get(t)},e}(),KC=new zDe,UDe=function(){function e(t){this.table=t,this.constQueryContext=new As($e.Empty)}return e}(),F7;(function(e){function t(n){return{kind:"const",value:n}}e.Const=t;function r(n){return{kind:"dynamic",runtime:n}}e.Dynamic=r})(F7||(F7={}));var Xh;(function(e){function t(n){return{isConst:!0,fn:function(i){return n}}}e.Const=t;function r(n){return{isConst:!1,fn:n}}e.Dynamic=r})(Xh||(Xh={}));var Vy;(function(e){function t(r,n,a,i){if(typeof r.length=="number")for(var o=0,s=r.length;o<s;o++)a(r[o](n),o,i);else for(var o=0,u=0,l=Object.keys(r);u<l.length;u++){var c=l[u];a(r[c](n),o++,i)}return i}e.forEachEval=t})(Vy||(Vy={}));var S0;(function(e){function t(n,a){return new L7(n,a,!0)}e.Const=t;function r(n,a){return new L7(n,a,!1)}e.Dynamic=r})(S0||(S0={}));var L7=function(){function e(t,r,n){this.symbol=t,this.fn=r,this.isConst=n}return e.prototype.compile=function(t,r){var n,a=!1;if(!r)n=void 0,a=!0;else if(Ha.isArgumentsArray(r)){n=[],a=!1;for(var i=0,o=r;i<o.length;i++){var s=o[i],u=k5(t,s);a=a&&u.isConst,n.push(u.fn)}}else{n=Object.create(null),a=!1;for(var l=0,c=Object.keys(r);l<c.length;l++){var d=c[l],u=k5(t,r[d]);a=a&&u.isConst,n[d]=u.fn}}return this.isConst?this.isConst&&a?Xh.Const(this.fn(t.constQueryContext,n)):Xh.Dynamic(N7(this.fn,n)):Xh.Dynamic(N7(this.fn,n))},e}();function N7(e,t){return function(n){return e(n,t)}}function k5(e,t){if(Ha.isLiteral(t))return Xh.Const(t);if(Ha.isSymbol(t)){var r=e.table.getRuntime(t.name);return r?r.compile(e):Xh.Const(t.name)}if(!Ha.isSymbol(t.head))throw new Error("Can only apply symbols.");var n=e.table.getRuntime(t.head.name);if(!n)throw new Error("Symbol '"+t.head.name+"' is not implemented.");return n.compile(e,t.args)}function dm(e){var t=new UDe(KC);return k5(t,e).fn}var ar=S0.Const,Xt=S0.Dynamic,VDe=[ar(Ae.core.type.bool,function(t,r){return!!r[0](t)}),ar(Ae.core.type.num,function(t,r){return+r[0](t)}),ar(Ae.core.type.str,function(t,r){return""+r[0](t)}),ar(Ae.core.type.list,function(t,r){return Vy.forEachEval(r,t,function(n,a,i){return i[a]=n},[])}),ar(Ae.core.type.set,function(t,r){return Vy.forEachEval(r,t,function(a,i,o){return o.add(a)},new Set)}),ar(Ae.core.type.regex,function(t,r){return new RegExp(r[0](t),r[1]&&r[1](t)||"")}),ar(Ae.core.type.bitflags,function(t,r){return+r[0](t)}),ar(Ae.core.type.compositeKey,function(t,r){return Vy.forEachEval(r,t,function(n,a,i){return i[a]=""+n},[]).join("-")}),ar(Ae.core.logic.not,function(e,t){return!t[0](e)}),ar(Ae.core.logic.and,function(e,t){if(typeof t.length=="number"){for(var r=0,n=t.length;r<n;r++)if(!t[r](e))return!1}else for(var a=0,i=Object.keys(t);a<i.length;a++){var o=i[a];if(!t[o](e))return!1}return!0}),ar(Ae.core.logic.or,function(e,t){if(typeof t.length=="number"){for(var r=0,n=t.length;r<n;r++)if(t[r](e))return!0}else for(var a=0,i=Object.keys(t);a<i.length;a++){var o=i[a];if(t[o](e))return!0}return!1}),ar(Ae.core.rel.eq,function(e,t){return t[0](e)===t[1](e)}),ar(Ae.core.rel.neq,function(e,t){return t[0](e)!==t[1](e)}),ar(Ae.core.rel.lt,function(e,t){return t[0](e)<t[1](e)}),ar(Ae.core.rel.lte,function(e,t){return t[0](e)<=t[1](e)}),ar(Ae.core.rel.gr,function(e,t){return t[0](e)>t[1](e)}),ar(Ae.core.rel.gre,function(e,t){return t[0](e)>=t[1](e)}),ar(Ae.core.rel.inRange,function(e,t){var r=t[0](e);return r>=t[1](e)&&r<=t[2](e)}),ar(Ae.core.math.add,function(e,t){var r=0;if(typeof t.length=="number")for(var n=0,a=t.length;n<a;n++)r+=t[n](e);else for(var i=0,o=Object.keys(t);i<o.length;i++){var s=o[i];r+=t[s](e)}return r}),ar(Ae.core.math.sub,function(e,t){var r=0;if(typeof t.length=="number"){if(t.length===1)return-t[0](e);r=t[0](e)||0;for(var n=1,a=t.length;n<a;n++)r-=t[n](e)}else{var i=Object.keys(t);if(i.length===1)return-t[i[0]](e);r=t[i[0]](e)||0;for(var n=1,a=i.length;n<a;n++)r-=t[i[n]](e)}return r}),ar(Ae.core.math.mult,function(e,t){var r=1;if(typeof t.length=="number")for(var n=0,a=t.length;n<a;n++)r*=t[n](e);else for(var i=0,o=Object.keys(t);i<o.length;i++){var s=o[i];r*=t[s](e)}return r}),ar(Ae.core.math.div,function(e,t){return t[0](e)/t[1](e)}),ar(Ae.core.math.pow,function(e,t){return Math.pow(t[0](e),t[1](e))}),ar(Ae.core.math.mod,function(e,t){return t[0](e)%t[1](e)}),ar(Ae.core.math.min,function(e,t){var r=Number.POSITIVE_INFINITY;if(typeof t.length=="number")for(var n=0,a=t.length;n<a;n++)r=Math.min(t[n](e),r);else for(var i=0,o=Object.keys(t);i<o.length;i++){var s=o[i];r=Math.min(t[s](e),r)}return r}),ar(Ae.core.math.max,function(e,t){var r=Number.NEGATIVE_INFINITY;if(typeof t.length=="number")for(var n=0,a=t.length;n<a;n++)r=Math.max(t[n](e),r);else for(var i=0,o=Object.keys(t);i<o.length;i++){var s=o[i];r=Math.max(t[s](e),r)}return r}),ar(Ae.core.math.floor,function(e,t){return Math.floor(t[0](e))}),ar(Ae.core.math.ceil,function(e,t){return Math.ceil(t[0](e))}),ar(Ae.core.math.roundInt,function(e,t){return Math.round(t[0](e))}),ar(Ae.core.math.abs,function(e,t){return Math.abs(t[0](e))}),ar(Ae.core.math.sqrt,function(e,t){return Math.sqrt(t[0](e))}),ar(Ae.core.math.cbrt,function(e,t){return Math.cbrt(t[0](e))}),ar(Ae.core.math.sin,function(e,t){return Math.sin(t[0](e))}),ar(Ae.core.math.cos,function(e,t){return Math.cos(t[0](e))}),ar(Ae.core.math.tan,function(e,t){return Math.tan(t[0](e))}),ar(Ae.core.math.asin,function(e,t){return Math.asin(t[0](e))}),ar(Ae.core.math.acos,function(e,t){return Math.acos(t[0](e))}),ar(Ae.core.math.atan,function(e,t){return Math.atan(t[0](e))}),ar(Ae.core.math.sinh,function(e,t){return Math.sinh(t[0](e))}),ar(Ae.core.math.cosh,function(e,t){return Math.cosh(t[0](e))}),ar(Ae.core.math.tanh,function(e,t){return Math.tanh(t[0](e))}),ar(Ae.core.math.exp,function(e,t){return Math.exp(t[0](e))}),ar(Ae.core.math.log,function(e,t){return Math.log(t[0](e))}),ar(Ae.core.math.log10,function(e,t){return Math.log10(t[0](e))}),ar(Ae.core.math.atan2,function(e,t){return Math.atan2(t[0](e),t[1](e))}),ar(Ae.core.str.match,function(e,t){return t[0](e).test(t[1](e))}),ar(Ae.core.str.concat,function(e,t){var r=[];if(typeof t.length=="number")for(var n=0,a=t.length;n<a;n++)r.push(t[n](e).toString());else for(var i=0,o=Object.keys(t);i<o.length;i++){var s=o[i];r.push(t[s](e).toString())}return r.join("")}),ar(Ae.core.list.getAt,function(e,t){return t[0](e)[t[1](e)]}),ar(Ae.core.list.equal,function(e,t){return XD(t[0](e),t[1](e))}),ar(Ae.core.set.has,function(t,r){return r[0](t).has(r[1](t))}),ar(Ae.core.set.isSubset,function(t,r){return Aa.isSuperset(r[1](t),r[0](t))}),ar(Ae.core.flags.hasAny,function(e,t){var r=t[1](e),n=t[0](e);return r?(n&r)!==0:!!n}),ar(Ae.core.flags.hasAll,function(e,t){var r=t[1](e),n=t[0](e);return r?(n&r)===r:!n}),ar(Ae.structureQuery.type.elementSymbol,function(e,t){return V0(t[0](e))}),ar(Ae.structureQuery.type.atomName,function(e,t){return Sge(t[0](e))}),ar(Ae.structureQuery.type.bondFlags,function(e,t){var r=0;if(typeof t.length=="number")for(var n=0,a=t.length;n<a;n++)r=z7(r,t[n](e));else for(var i=0,o=Object.keys(t);i<o.length;i++){var s=o[i];r=z7(r,t[s](e))}return r}),ar(Ae.structureQuery.type.ringFingerprint,function(e,t){return ru.elementFingerprint(HDe(e,t))}),ar(Ae.structureQuery.type.secondaryStructureFlags,function(e,t){var r=0;if(typeof t.length=="number")for(var n=0,a=t.length;n<a;n++)r=U7(r,t[n](e));else for(var i=0,o=Object.keys(t);i<o.length;i++){var s=o[i];r=U7(r,t[s](e))}return r}),Xt(Ae.structureQuery.filter.pick,function(e,t){return un.filters.pick(t[0],t.test)(e)}),Xt(Ae.structureQuery.filter.first,function(e,t){return un.filters.first(t[0])(e)}),Xt(Ae.structureQuery.filter.withSameAtomProperties,function(e,t){return un.filters.withSameAtomProperties(t[0],t.source,t.property)(e)}),Xt(Ae.structureQuery.filter.intersectedBy,function(e,t){return un.filters.areIntersectedBy(t[0],t.by)(e)}),Xt(Ae.structureQuery.filter.within,function(e,t){return un.filters.within({query:t[0],target:t.target,minRadius:t["min-radius"],maxRadius:t["max-radius"],elementRadius:t["atom-radius"],invert:t.invert})(e)}),Xt(Ae.structureQuery.filter.isConnectedTo,function(e,t){return un.filters.isConnectedTo({query:t[0],target:t.target,disjunct:t.disjunct,invert:t.invert,bondTest:t["bond-test"]})(e)}),Xt(Ae.structureQuery.generator.atomGroups,function(t,r){return un.generators.atoms({entityTest:r["entity-test"],chainTest:r["chain-test"],residueTest:r["residue-test"],atomTest:r["atom-test"],groupBy:r["group-by"]})(t)}),Xt(Ae.structureQuery.generator.all,function(t){return un.generators.all(t)}),Xt(Ae.structureQuery.generator.empty,function(t){return un.generators.none(t)}),Xt(Ae.structureQuery.generator.bondedAtomicPairs,function(t,r){return un.generators.bondedAtomicPairs(r&&r[0])(t)}),Xt(Ae.structureQuery.generator.rings,function(t,r){var n,a;return un.generators.rings((n=r?.fingerprint)===null||n===void 0?void 0:n.call(r,t),(a=r?.["only-aromatic"])===null||a===void 0?void 0:a.call(r,t))(t)}),Xt(Ae.structureQuery.modifier.includeSurroundings,function(t,r){return un.modifiers.includeSurroundings(r[0],{radius:r.radius(t),wholeResidues:!!(r["as-whole-residues"]&&r["as-whole-residues"](t)),elementRadius:r["atom-radius"]})(t)}),Xt(Ae.structureQuery.modifier.surroundingLigands,function(t,r){return un.modifiers.surroundingLigands({query:r[0],radius:r.radius(t),includeWater:!!(r["include-water"]&&r["include-water"](t))})(t)}),Xt(Ae.structureQuery.modifier.wholeResidues,function(t,r){return un.modifiers.wholeResidues(r[0])(t)}),Xt(Ae.structureQuery.modifier.union,function(t,r){return un.modifiers.union(r[0])(t)}),Xt(Ae.structureQuery.modifier.expandProperty,function(t,r){return un.modifiers.expandProperty(r[0],r.property)(t)}),Xt(Ae.structureQuery.modifier.exceptBy,function(t,r){return un.modifiers.exceptBy(r[0],r.by)(t)}),Xt(Ae.structureQuery.modifier.includeConnected,function(t,r){var n,a;return un.modifiers.includeConnected({query:r[0],bondTest:r["bond-test"],wholeResidues:!!(r["as-whole-residues"]&&r["as-whole-residues"](t)),layerCount:r["layer-count"]&&r["layer-count"](t)||1,fixedPoint:(a=(n=r["fixed-point"])===null||n===void 0?void 0:n.call(r,t))!==null&&a!==void 0?a:!1})(t)}),Xt(Ae.structureQuery.combinator.merge,function(e,t){return un.combinators.merge(t)(e)}),Xt(Ae.structureQuery.atomProperty.core.elementSymbol,pn(mt.atom.type_symbol)),Xt(Ae.structureQuery.atomProperty.core.vdw,function(e,t){return yb(mt.atom.type_symbol(t&&t[0]&&t[0](e)||e.element))}),Xt(Ae.structureQuery.atomProperty.core.mass,function(e,t){return n5e(mt.atom.type_symbol(t&&t[0]&&t[0](e)||e.element))}),Xt(Ae.structureQuery.atomProperty.core.atomicNumber,function(e,t){return bb(mt.atom.type_symbol(t&&t[0]&&t[0](e)||e.element))}),Xt(Ae.structureQuery.atomProperty.core.x,pn(mt.atom.x)),Xt(Ae.structureQuery.atomProperty.core.y,pn(mt.atom.y)),Xt(Ae.structureQuery.atomProperty.core.z,pn(mt.atom.z)),Xt(Ae.structureQuery.atomProperty.core.sourceIndex,pn(mt.atom.sourceIndex)),Xt(Ae.structureQuery.atomProperty.core.operatorName,pn(mt.unit.operator_name)),Xt(Ae.structureQuery.atomProperty.core.modelIndex,pn(mt.unit.model_index)),Xt(Ae.structureQuery.atomProperty.core.modelLabel,pn(mt.unit.model_label)),Xt(Ae.structureQuery.atomProperty.core.atomKey,function(e,t){var r=t&&t[0]&&t[0](e)||e.element;return op(r.unit.id,r.element)}),Xt(Ae.structureQuery.atomProperty.macromolecular.residueKey,function(e,t){return iMe(t&&t[0]&&t[0](e)||e.element)}),Xt(Ae.structureQuery.atomProperty.macromolecular.chainKey,function(e,t){return oMe(t&&t[0]&&t[0](e)||e.element)}),Xt(Ae.structureQuery.atomProperty.macromolecular.entityKey,function(e,t){return sMe(t&&t[0]&&t[0](e)||e.element)}),Xt(Ae.structureQuery.atomProperty.macromolecular.id,pn(mt.atom.id)),Xt(Ae.structureQuery.atomProperty.macromolecular.isHet,function(e,t){return mt.residue.group_PDB(t&&t[0]&&t[0](e)||e.element)!=="ATOM"}),Xt(Ae.structureQuery.atomProperty.macromolecular.label_atom_id,pn(mt.atom.label_atom_id)),Xt(Ae.structureQuery.atomProperty.macromolecular.label_alt_id,pn(mt.atom.label_alt_id)),Xt(Ae.structureQuery.atomProperty.macromolecular.label_comp_id,pn(mt.atom.label_comp_id)),Xt(Ae.structureQuery.atomProperty.macromolecular.label_seq_id,pn(mt.residue.label_seq_id)),Xt(Ae.structureQuery.atomProperty.macromolecular.label_asym_id,pn(mt.chain.label_asym_id)),Xt(Ae.structureQuery.atomProperty.macromolecular.label_entity_id,pn(mt.entity.id)),Xt(Ae.structureQuery.atomProperty.macromolecular.auth_atom_id,pn(mt.atom.auth_atom_id)),Xt(Ae.structureQuery.atomProperty.macromolecular.auth_comp_id,pn(mt.atom.auth_comp_id)),Xt(Ae.structureQuery.atomProperty.macromolecular.auth_seq_id,pn(mt.residue.auth_seq_id)),Xt(Ae.structureQuery.atomProperty.macromolecular.auth_asym_id,pn(mt.chain.auth_asym_id)),Xt(Ae.structureQuery.atomProperty.macromolecular.pdbx_PDB_ins_code,pn(mt.residue.pdbx_PDB_ins_code)),Xt(Ae.structureQuery.atomProperty.macromolecular.pdbx_formal_charge,pn(mt.atom.pdbx_formal_charge)),Xt(Ae.structureQuery.atomProperty.macromolecular.occupancy,pn(mt.atom.occupancy)),Xt(Ae.structureQuery.atomProperty.macromolecular.B_iso_or_equiv,pn(mt.atom.B_iso_or_equiv)),Xt(Ae.structureQuery.atomProperty.macromolecular.entityType,pn(mt.entity.type)),Xt(Ae.structureQuery.atomProperty.macromolecular.entitySubtype,pn(mt.entity.subtype)),Xt(Ae.structureQuery.atomProperty.macromolecular.entityPrdId,pn(mt.entity.prd_id)),Xt(Ae.structureQuery.atomProperty.macromolecular.entityDescription,pn(mt.entity.pdbx_description)),Xt(Ae.structureQuery.atomProperty.macromolecular.objectPrimitive,pn(mt.unit.object_primitive)),Xt(Ae.structureQuery.atomProperty.macromolecular.isNonStandard,pn(mt.residue.isNonStandard)),Xt(Ae.structureQuery.atomProperty.macromolecular.secondaryStructureKey,pn(mt.residue.secondary_structure_key)),Xt(Ae.structureQuery.atomProperty.macromolecular.secondaryStructureFlags,pn(mt.residue.secondary_structure_type)),Xt(Ae.structureQuery.atomProperty.macromolecular.chemCompType,pn(mt.residue.chem_comp_type)),Xt(Ae.structureQuery.bondProperty.order,function(e,t){return e.atomicBond.order}),Xt(Ae.structureQuery.bondProperty.flags,function(e,t){return e.atomicBond.type}),Xt(Ae.structureQuery.bondProperty.atomA,function(e,t){return e.atomicBond.a}),Xt(Ae.structureQuery.bondProperty.atomB,function(e,t){return e.atomicBond.b}),Xt(Ae.structureQuery.bondProperty.length,function(e,t){return e.atomicBond.length}),Xt(Ae.internal.generator.bundleElement,function(t,r){return jX(r.groupedUnits(t),r.ranges(t),r.set(t))}),Xt(Ae.internal.generator.bundle,function(t,r){return GX(r.elements(t))(t)}),Xt(Ae.internal.generator.current,function(t,r){return t.tryGetCurrentSelection()})];function pn(e){return function(t,r){return e(r&&r[0]&&r[0](t)||t.element)}}function z7(e,t){return e|($r.isName(t)?$r.fromName(t):0)}function U7(e,t){switch(t.toLowerCase()){case"helix":return e|2;case"alpha":return e|2|4096;case"pi":return e|2|32768;case"310":return e|2|2048;case"beta":return e|4;case"strand":return e|4|4194304;case"sheet":return e|4|8388608;case"turn":return e|16;case"bend":return e|8;case"coil":return e|536870912;default:return e}}function HDe(e,t){var r=[];if(!t)return r;if(typeof t.length=="number")for(var n=0,a=t.length;n<a;n++)r.push(t[n](e));else for(var i=Object.keys(t),n=1,a=i.length;n<a;n++)r.push(t[i[n]](e));return r}(function(){for(var e=0,t=VDe;e<t.length;e++){var r=t[e];KC.addSymbol(r)}})();function yi(e,t){return{expression:e,language:t}}(function(e){function t(s){return!!s&&typeof s.expression=="string"&&!!s.language}e.is=t;function r(s,u){return s.language===u.language&&s.expression===u.expression}e.areEqual=r;function n(s){switch(s.language){case"mol-script":var u=NDe(s.expression);if(u.length===0)throw new Error("No query");return kDe(u[0])}throw new Error("unsupported script language")}e.toExpression=n;function a(s){var u=n(s);return dm(u)}e.toQuery=a;function i(s,u){var l=a(s),c=l(new As(u));return St.toLociWithSourceUnits(c)}e.toLoci=i;function o(s,u,l){var c=typeof s=="function"?s(ce):s,d=dm(c);return d(new As(u,l))}e.getStructureSelection=o})(yi||(yi={}));var Yh;(function(e){function t(u,l){var c=u&&wa.Provider.get(u),d=c?c.assemblies.map(function(S){return[S.id,S.id+": "+vs(S.details)]}):[],f=c?!Go.isZero(c.spacegroup.cell):!0,p=[];if(c)for(var h=c.spacegroup.operators,m=0,v=h.length;m<v;m++)p.push([m,m+1+": "+al.getOperatorXyz(h[m])]);var g=[];u&&u.properties.structAsymMap.forEach(function(S){var x=S.id===S.auth_id?S.id:S.id+" [auth "+S.auth_id+"]";g.push([S.id,x])});var y={auto:M.EmptyGroup(),model:M.EmptyGroup(),assembly:M.Group({id:M.Optional(u?M.Select(d.length?d[0][0]:"",d,{label:"Asm Id",description:"Assembly Id"}):M.Text("",{label:"Asm Id",description:"Assembly Id (use empty for the 1st assembly)"}))},{isFlat:!0}),"symmetry-mates":M.Group({radius:M.Numeric(5,{min:0,max:50,step:1})},{isFlat:!0}),symmetry:M.Group({ijkMin:M.Vec3(A.create(-1,-1,-1),{step:1},{label:"Min IJK",fieldLabels:{x:"I",y:"J",z:"K"}}),ijkMax:M.Vec3(A.create(1,1,1),{step:1},{label:"Max IJK",fieldLabels:{x:"I",y:"J",z:"K"}})},{isFlat:!0}),"symmetry-assembly":M.Group({generators:M.ObjectList({operators:M.ObjectList({index:M.Select(0,p),shift:M.Vec3(A(),{step:1},{label:"IJK",fieldLabels:{x:"I",y:"J",z:"K"}})},function(S){return S.index+1+"_"+S.shift.map(function(x){return x+5}).join("")},{defaultValue:[]}),asymIds:M.MultiSelect([],g)},function(S){return S.asymIds.length+" asym ids, "+S.operators.length+" operators"},{defaultValue:[]})},{isFlat:!0})},b=[];return l==="auto"&&b.push(["auto","Auto"]),b.push(["model","Model"]),d.length>0&&b.push(["assembly","Assembly"]),f&&(b.push(["symmetry-mates","Symmetry Mates"]),b.push(["symmetry","Symmetry (indices)"]),b.push(["symmetry-assembly","Symmetry (assembly)"])),{type:M.MappedStatic(l||"model",y,{options:b})}}e.getParams=t;function r(u,l){return!(l.name==="symmetry-assembly"||l.name==="symmetry"&&u.name==="symmetry")}e.canAutoUpdate=r;function n(u,l,c,d){return pe(this,void 0,void 0,function(){var f,p,h,m,v,g;return he(this,function(y){switch(y.label){case 0:return f=void 0,p=wa.Provider.get(c),!d&&p&&p.assemblies.length!==0&&(d=p.assemblies[0].id),!p||p.assemblies.length===0?u.log.warn("Model '"+c.entryId+"' has no assembly, returning model structure."):(f=B1.findAssembly(c,d||""),f||u.log.warn("Model '"+c.entryId+"' has no assembly called '"+d+"', returning model structure.")),h=$e.ofModel(c),f?(d=f.id,[4,Gl.buildAssembly(h,d).runInContext(l)]):(m={label:"Model",description:$e.elementDescription(h)},[2,new be.Molecule.Structure(h,m)]);case 1:return v=y.sent(),g={label:"Assembly "+d,description:$e.elementDescription(v)},[2,new be.Molecule.Structure(v,g)]}})})}function a(u,l,c,d){return pe(this,void 0,void 0,function(){var f,p,h;return he(this,function(m){switch(m.label){case 0:return f=$e.ofModel(l),[4,Gl.buildSymmetryRange(f,c,d).runInContext(u)];case 1:return p=m.sent(),h={label:"Symmetry ["+c+"] to ["+d+"]",description:$e.elementDescription(p)},[2,new be.Molecule.Structure(p,h)]}})})}function i(u,l,c){return pe(this,void 0,void 0,function(){var d,f,p;return he(this,function(h){switch(h.label){case 0:return d=$e.ofModel(l),[4,Gl.builderSymmetryMates(d,c).runInContext(u)];case 1:return f=h.sent(),p={label:"Symmetry Mates",description:$e.elementDescription(f)},[2,new be.Molecule.Structure(f,p)]}})})}function o(u,l,c,d){return pe(this,void 0,void 0,function(){var f,p,h;return he(this,function(m){switch(m.label){case 0:return f=$e.ofModel(l),[4,Gl.buildSymmetryAssembly(f,c,d).runInContext(u)];case 1:return p=m.sent(),h={label:"Symmetry Assembly",description:$e.elementDescription(p)},[2,new be.Molecule.Structure(p,h)]}})})}function s(u,l,c,d){return pe(this,void 0,void 0,function(){var f,p,p;return he(this,function(h){if(f=wa.Provider.get(c),!f||!d||d.name==="model")return p=$e.ofModel(c),[2,new be.Molecule.Structure(p,{label:"Model",description:$e.elementDescription(p)})];if(d.name==="auto")return f.assemblies.length===0?(p=$e.ofModel(c),[2,new be.Molecule.Structure(p,{label:"Model",description:$e.elementDescription(p)})]):[2,n(u,l,c)];if(d.name==="assembly")return[2,n(u,l,c,d.params.id)];if(d.name==="symmetry")return[2,a(l,c,d.params.ijkMin,d.params.ijkMax)];if(d.name==="symmetry-mates")return[2,i(l,c,d.params.radius)];if(d.name==="symmetry-assembly")return[2,o(l,c,d.params.generators,f)];throw new Error("Unknown represetation type: "+d.name)})})}e.create=s})(Yh||(Yh={}));var Ki;(function(e){function t(s,u,l){return s.currentStructure!==l?!1:yi.is(u)?!!s.script&&yi.areEqual(s.script,u):s.expression===u}e.isUnchanged=t;function r(s,u){var l=yi.is(u)?u:void 0,c=yi.is(u)?yi.toExpression(u):u,d=dm(c);return{script:l,expression:c,compiled:d,originalStructure:s,currentStructure:s}}e.create=r;function n(s,u){return s.compiled(new As(u))}e.run=n;function a(s,u){var l=r(s,u);return{entry:l,selection:n(l,s)}}e.createAndRun=a;function i(s,u){return s.currentStructure=u,s.compiled(new As(u))}e.updateStructure=i;function o(s,u,l){var c=St.unionStructure(u);s.label=""+(l||"Selection"),s.description=$e.elementDescription(c),s.data=c}e.updateStructureObject=o})(Ki||(Ki={}));var jDe={H:"Hydrogen",HE:"Helium",LI:"Lithium",BE:"Beryllium",B:"Boron",C:"Carbon",N:"Nitrogen",O:"Oxygen",F:"Fluorine",NE:"Neon",NA:"Sodium",MG:"Magnesium",AL:"Aluminum",SI:"Silicon",P:"Phosphorus",S:"Sulfur",CL:"Chlorine",AR:"Argon",K:"Potassium",CA:"Calcium",SC:"Scandium",TI:"Titanium",V:"Vanadium",CR:"Chromium",MN:"Manganese",FE:"Iron",CO:"Cobalt",NI:"Nickel",CU:"Copper",ZN:"Zinc",GA:"Gallium",GE:"Germanium",AS:"Arsenic",SE:"Selenium",BR:"Bromine",KR:"Krypton",RB:"Rubidium",SR:"Strontium",Y:"Yttrium",ZR:"Zirconium",NB:"Niobium",MO:"Molybdenum",TC:"Technetium",RU:"Ruthenium",RH:"Rhodium",PD:"Palladium",AG:"Silver",CD:"Cadmium",IN:"Indium",SN:"Tin",SB:"Antimony",TE:"Tellurium",I:"Iodine",XE:"Xenon",CS:"Cesium",BA:"Barium",LA:"Lanthanum",CE:"Cerium",PR:"Praseodymium",ND:"Neodymium",PM:"Promethium",SM:"Samarium",EU:"Europium",GD:"Gadolinium",TB:"Terbium",DY:"Dysprosium",HO:"Holmium",ER:"Erbium",TM:"Thulium",YB:"Ytterbium",LU:"Lutetium",HF:"Hafnium",TA:"Tantalum",W:"Wolfram",RE:"Rhenium",OS:"Osmium",IR:"Iridium",PT:"Platinum",AU:"Gold",HG:"Mercury",TL:"Thallium",PB:"Lead",BI:"Bismuth",PO:"Polonium",AT:"Astatine",RN:"Radon",FR:"Francium",RA:"Radium",AC:"Actinium",TH:"Thorium",PA:"Protactinium",U:"Uranium",NP:"Neptunium",PU:"Plutonium",AM:"Americium",CM:"Curium",BK:"Berkelium",CF:"Californium",ES:"Einsteinium",FM:"Fermium",MD:"Mendelevium",NO:"Nobelium",LR:"Lawrencium",RF:"Rutherfordium",DB:"Dubnium",SG:"Seaborgium",BH:"Bohrium",HS:"Hassium",MT:"Meitnerium",DS:"Darmstadtium",RG:"Roentgenium",CN:"Copernicium",NH:"Nihonium",FL:"Flerovium",MC:"Moscovium",LV:"Livermorium",TS:"Tennessine",OG:"Oganesson"},GDe=new Set(["LI","NA","K","RB","CS","FR"]);function qDe(e){return GDe.has(e)}var WDe=new Set(["BE","MG","CA","SR","BA","RA"]);function XDe(e){return WDe.has(e)}var YDe=new Set(["ZN","GA","CD","IN","SN","HG","TI","PB","BI","PO","CN"]);function KDe(e){return YDe.has(e)}var $De=new Set(["F","CL","BR","I","AT"]);function QDe(e){return $De.has(e)}function dY(e){var t=bb(e);return t>=21&&t<=29||t>=39&&t<=47||t>=72&&t<=79||t>=104&&t<=108}function ZDe(e){var t=bb(e);return t>=57&&t<=71}function JDe(e){var t=bb(e);return t>=89&&t<=103}function eke(e){return qDe(e)||XDe(e)||ZDe(e)||JDe(e)||dY(e)||KDe(e)}var Gr;(function(e){e.Type="Type",e.Structure="Structure Property",e.Atom="Atom Property",e.Bond="Bond Property",e.Residue="Residue Property",e.AminoAcid="Amino Acid",e.NucleicBase="Nucleic Base",e.Manipulate="Manipulate Selection",e.Validation="Validation",e.Misc="Miscellaneous",e.Internal="Internal"})(Gr||(Gr={}));function qr(e,t,r){var n;r===void 0&&(r={});var a;return{label:e,expression:t,description:r.description||"",category:(n=r.category)!==null&&n!==void 0?n:Gr.Misc,isHidden:!!r.isHidden,priority:r.priority||0,referencesCurrent:!!r.referencesCurrent,get query(){return a||(a=dm(t)),a},ensureCustomProperties:r.ensureCustomProperties,getSelection:function(i,o,s){return pe(this,void 0,void 0,function(){var u,l;return he(this,function(c){switch(c.label){case 0:return u=i.managers.structure.selection.getStructure(s),l=u?St.Sequence(s,[u]):St.Empty(s),r.ensureCustomProperties?[4,r.ensureCustomProperties({runtime:o,assetManager:i.managers.asset},s)]:[3,2];case 1:c.sent(),c.label=2;case 2:return a||(a=dm(t)),[2,a(new As(s,{currentSelection:l}))]}})})}}}var tke=qr("All",ce.struct.generator.all(),{category:"",priority:1e3}),rke=qr("Current Selection",ce.internal.generator.current(),{category:"",referencesCurrent:!0}),nke=qr("Polymer",ce.struct.modifier.union([ce.struct.generator.atomGroups({"entity-test":ce.core.logic.and([ce.core.rel.eq([ce.ammp("entityType"),"polymer"]),ce.core.str.match([ce.re("(polypeptide|cyclic-pseudo-peptide|peptide-like|nucleotide|peptide nucleic acid)","i"),ce.ammp("entitySubtype")])])})]),{category:Gr.Type}),ake=qr("Trace",ce.struct.modifier.union([ce.struct.combinator.merge([ce.struct.modifier.union([ce.struct.generator.atomGroups({"entity-test":ce.core.rel.eq([ce.ammp("entityType"),"polymer"]),"chain-test":ce.core.set.has([ce.set("sphere","gaussian"),ce.ammp("objectPrimitive")])})]),ce.struct.modifier.union([ce.struct.generator.atomGroups({"entity-test":ce.core.rel.eq([ce.ammp("entityType"),"polymer"]),"chain-test":ce.core.rel.eq([ce.ammp("objectPrimitive"),"atomistic"]),"atom-test":ce.core.set.has([ce.set("CA","P"),ce.ammp("label_atom_id")])})])])]),{category:Gr.Structure}),j0=ce.core.logic.and([ce.core.rel.eq([ce.ammp("entityType"),"polymer"]),ce.core.str.match([ce.re("(polypeptide|cyclic-pseudo-peptide|peptide-like)","i"),ce.ammp("entitySubtype")])]),u_=ce.core.logic.and([ce.core.rel.eq([ce.ammp("entityType"),"polymer"]),ce.core.str.match([ce.re("(nucleotide|peptide nucleic acid)","i"),ce.ammp("entitySubtype")])]),fm=ce.core.str.match([ce.re("non-polymer|(amino|carboxy) terminus|peptide-like","i"),ce.ammp("chemCompType")]),ike=qr("Backbone",ce.struct.modifier.union([ce.struct.combinator.merge([ce.struct.modifier.union([ce.struct.generator.atomGroups({"entity-test":j0,"chain-test":ce.core.rel.eq([ce.ammp("objectPrimitive"),"atomistic"]),"residue-test":ce.core.logic.not([fm]),"atom-test":ce.core.set.has([ce.set.apply(ce,Aa.toArray(bd)),ce.ammp("label_atom_id")])})]),ce.struct.modifier.union([ce.struct.generator.atomGroups({"entity-test":u_,"chain-test":ce.core.rel.eq([ce.ammp("objectPrimitive"),"atomistic"]),"residue-test":ce.core.logic.not([fm]),"atom-test":ce.core.set.has([ce.set.apply(ce,Aa.toArray(Zw)),ce.ammp("label_atom_id")])})])])]),{category:Gr.Structure}),oke=qr("Sidechain",ce.struct.modifier.union([ce.struct.combinator.merge([ce.struct.modifier.union([ce.struct.generator.atomGroups({"entity-test":j0,"chain-test":ce.core.rel.eq([ce.ammp("objectPrimitive"),"atomistic"]),"residue-test":ce.core.logic.not([fm]),"atom-test":ce.core.logic.or([ce.core.logic.not([ce.core.set.has([ce.set.apply(ce,Aa.toArray(bd)),ce.ammp("label_atom_id")])])])})]),ce.struct.modifier.union([ce.struct.generator.atomGroups({"entity-test":u_,"chain-test":ce.core.rel.eq([ce.ammp("objectPrimitive"),"atomistic"]),"residue-test":ce.core.logic.not([fm]),"atom-test":ce.core.logic.or([ce.core.logic.not([ce.core.set.has([ce.set.apply(ce,Aa.toArray(Zw)),ce.ammp("label_atom_id")])])])})])])]),{category:Gr.Structure}),ske=qr("Sidechain with Trace",ce.struct.modifier.union([ce.struct.combinator.merge([ce.struct.modifier.union([ce.struct.generator.atomGroups({"entity-test":j0,"chain-test":ce.core.rel.eq([ce.ammp("objectPrimitive"),"atomistic"]),"residue-test":ce.core.logic.not([fm]),"atom-test":ce.core.logic.or([ce.core.logic.not([ce.core.set.has([ce.set.apply(ce,Aa.toArray(bd)),ce.ammp("label_atom_id")])]),ce.core.rel.eq([ce.ammp("label_atom_id"),"CA"]),ce.core.logic.and([ce.core.rel.eq([ce.ammp("auth_comp_id"),"PRO"]),ce.core.rel.eq([ce.ammp("label_atom_id"),"N"])])])})]),ce.struct.modifier.union([ce.struct.generator.atomGroups({"entity-test":u_,"chain-test":ce.core.rel.eq([ce.ammp("objectPrimitive"),"atomistic"]),"residue-test":ce.core.logic.not([fm]),"atom-test":ce.core.logic.or([ce.core.logic.not([ce.core.set.has([ce.set.apply(ce,Aa.toArray(Zw)),ce.ammp("label_atom_id")])]),ce.core.rel.eq([ce.ammp("label_atom_id"),"P"])])})])])]),{category:Gr.Structure}),uke=qr("Protein",ce.struct.modifier.union([ce.struct.generator.atomGroups({"entity-test":j0})]),{category:Gr.Type}),lke=qr("Nucleic",ce.struct.modifier.union([ce.struct.generator.atomGroups({"entity-test":u_})]),{category:Gr.Type}),cke=qr("Helix",ce.struct.modifier.union([ce.struct.generator.atomGroups({"entity-test":j0,"residue-test":ce.core.flags.hasAny([ce.ammp("secondaryStructureFlags"),ce.core.type.bitflags([2])])})]),{category:Gr.Structure}),dke=qr("Beta Strand/Sheet",ce.struct.modifier.union([ce.struct.generator.atomGroups({"entity-test":j0,"residue-test":ce.core.flags.hasAny([ce.ammp("secondaryStructureFlags"),ce.core.type.bitflags([4])])})]),{category:Gr.Structure}),fke=qr("Water",ce.struct.modifier.union([ce.struct.generator.atomGroups({"entity-test":ce.core.rel.eq([ce.ammp("entityType"),"water"])})]),{category:Gr.Type}),pke=qr("Ion",ce.struct.modifier.union([ce.struct.generator.atomGroups({"entity-test":ce.core.rel.eq([ce.ammp("entitySubtype"),"ion"])})]),{category:Gr.Type}),hke=qr("Lipid",ce.struct.modifier.union([ce.struct.generator.atomGroups({"entity-test":ce.core.rel.eq([ce.ammp("entitySubtype"),"lipid"])})]),{category:Gr.Type}),l_=qr("Carbohydrate",ce.struct.modifier.union([ce.struct.generator.atomGroups({"entity-test":ce.core.logic.or([ce.core.rel.eq([ce.ammp("entityType"),"branched"]),ce.core.logic.and([ce.core.rel.eq([ce.ammp("entityType"),"non-polymer"]),ce.core.str.match([ce.re("oligosaccharide","i"),ce.ammp("entitySubtype")])])])})]),{category:Gr.Type}),fY=qr("Carbohydrate with Connected",ce.struct.modifier.union([ce.struct.modifier.includeConnected({0:l_.expression,"layer-count":1,"as-whole-residues":!0})]),{category:Gr.Internal,isHidden:!0}),pY=qr("Connected to Carbohydrate",ce.struct.modifier.union([ce.struct.modifier.exceptBy({0:fY.expression,by:l_.expression})]),{category:Gr.Internal,isHidden:!0}),Fk=qr("Ligand",ce.struct.modifier.union([ce.struct.combinator.merge([ce.struct.modifier.union([ce.struct.generator.atomGroups({"entity-test":ce.core.logic.and([ce.core.logic.or([ce.core.rel.eq([ce.ammp("entityType"),"non-polymer"]),ce.core.rel.neq([ce.ammp("entityPrdId"),""])]),ce.core.logic.not([ce.core.str.match([ce.re("(oligosaccharide|lipid|ion)","i"),ce.ammp("entitySubtype")])])]),"chain-test":ce.core.rel.eq([ce.ammp("objectPrimitive"),"atomistic"]),"residue-test":ce.core.logic.not([ce.core.str.match([ce.re("saccharide","i"),ce.ammp("chemCompType")])])})]),ce.struct.modifier.union([ce.struct.generator.atomGroups({"entity-test":ce.core.rel.eq([ce.ammp("entityType"),"polymer"]),"chain-test":ce.core.rel.eq([ce.ammp("objectPrimitive"),"atomistic"]),"residue-test":fm})])])]),{category:Gr.Type}),hY=qr("Ligand with Connected",ce.struct.modifier.union([ce.struct.modifier.exceptBy({0:ce.struct.modifier.union([ce.struct.modifier.includeConnected({0:Fk.expression,"layer-count":1,"as-whole-residues":!0,"bond-test":ce.core.flags.hasAny([ce.struct.bondProperty.flags(),ce.core.type.bitflags([3])])})]),by:l_.expression})]),{category:Gr.Internal,isHidden:!0}),mY=qr("Connected to Ligand",ce.struct.modifier.union([ce.struct.modifier.exceptBy({0:hY.expression,by:Fk.expression})]),{category:Gr.Internal,isHidden:!0}),mke=qr("Connected to Ligand or Carbohydrate",ce.struct.modifier.union([ce.struct.combinator.merge([pY.expression,mY.expression])]),{category:Gr.Internal,isHidden:!0}),vke=qr("Disulfide Bridges",ce.struct.modifier.union([ce.struct.combinator.merge([ce.struct.modifier.union([ce.struct.modifier.wholeResidues([ce.struct.filter.isConnectedTo({0:ce.struct.generator.atomGroups({"residue-test":ce.core.set.has([ce.set("CYS"),ce.ammp("auth_comp_id")]),"atom-test":ce.core.set.has([ce.set("SG"),ce.ammp("label_atom_id")])}),target:ce.struct.generator.atomGroups({"residue-test":ce.core.set.has([ce.set("CYS"),ce.ammp("auth_comp_id")]),"atom-test":ce.core.set.has([ce.set("SG"),ce.ammp("label_atom_id")])}),"bond-test":!0})])]),ce.struct.modifier.union([ce.struct.modifier.wholeResidues([ce.struct.modifier.union([ce.struct.generator.bondedAtomicPairs({0:ce.core.flags.hasAny([ce.struct.bondProperty.flags(),ce.core.type.bitflags([8])])})])])])])]),{category:Gr.Bond}),gke=qr("NOS Bridges",ce.struct.modifier.union([ce.struct.modifier.wholeResidues([ce.struct.filter.isConnectedTo({0:ce.struct.generator.atomGroups({"residue-test":ce.core.set.has([ce.set("CSO","LYS"),ce.ammp("auth_comp_id")]),"atom-test":ce.core.set.has([ce.set("OD","NZ"),ce.ammp("label_atom_id")])}),target:ce.struct.generator.atomGroups({"residue-test":ce.core.set.has([ce.set("CSO","LYS"),ce.ammp("auth_comp_id")]),"atom-test":ce.core.set.has([ce.set("OD","NZ"),ce.ammp("label_atom_id")])}),"bond-test":!0})])]),{category:Gr.Bond}),yke=qr("Non-standard Residues in Polymers",ce.struct.modifier.union([ce.struct.generator.atomGroups({"entity-test":ce.core.rel.eq([ce.ammp("entityType"),"polymer"]),"chain-test":ce.core.rel.eq([ce.ammp("objectPrimitive"),"atomistic"]),"residue-test":ce.ammp("isNonStandard")})]),{category:Gr.Residue}),bke=qr("Coarse Elements",ce.struct.modifier.union([ce.struct.generator.atomGroups({"chain-test":ce.core.set.has([ce.set("sphere","gaussian"),ce.ammp("objectPrimitive")])})]),{category:Gr.Type}),xke=qr("Rings in Residues",ce.struct.modifier.union([ce.struct.generator.rings()]),{category:Gr.Residue}),Ske=qr("Aromatic Rings in Residues",ce.struct.modifier.union([ce.struct.generator.rings({"only-aromatic":!0})]),{category:Gr.Residue}),Cke=qr("Surrounding Residues (5 \u212B) of Selection",ce.struct.modifier.union([ce.struct.modifier.exceptBy({0:ce.struct.modifier.includeSurroundings({0:ce.internal.generator.current(),radius:5,"as-whole-residues":!0}),by:ce.internal.generator.current()})]),{description:"Select residues within 5 \u212B of the current selection.",category:Gr.Manipulate,referencesCurrent:!0}),wke=qr("Surrounding Ligands (5 \u212B) of Selection",ce.struct.modifier.union([ce.struct.modifier.surroundingLigands({0:ce.internal.generator.current(),radius:5,"include-water":!0})]),{description:"Select ligand components within 5 \u212B of the current selection.",category:Gr.Manipulate,referencesCurrent:!0}),_ke=qr("Inverse / Complement of Selection",ce.struct.modifier.union([ce.struct.modifier.exceptBy({0:ce.struct.generator.all(),by:ce.internal.generator.current()})]),{description:"Select everything not in the current selection.",category:Gr.Manipulate,referencesCurrent:!0}),Ake=qr("Residues Covalently Bonded to Selection",ce.struct.modifier.union([ce.struct.modifier.includeConnected({0:ce.internal.generator.current(),"layer-count":1,"as-whole-residues":!0})]),{description:"Select residues covalently bonded to current selection.",category:Gr.Manipulate,referencesCurrent:!0}),Tke=qr("Covalently Bonded Component",ce.struct.modifier.union([ce.struct.modifier.includeConnected({0:ce.internal.generator.current(),"fixed-point":!0})]),{description:"Select covalently bonded component based on current selection.",category:Gr.Manipulate,referencesCurrent:!0}),Eke=qr("Residues with Cov. or Metallic Bond to Selection",ce.struct.modifier.union([ce.struct.modifier.includeConnected({0:ce.internal.generator.current(),"layer-count":1,"as-whole-residues":!0,"bond-test":ce.core.flags.hasAny([ce.struct.bondProperty.flags(),ce.core.type.bitflags([3])])})]),{description:"Select residues with covalent or metallic bond to current selection.",category:Gr.Manipulate,referencesCurrent:!0}),Pke=qr("Whole Residues of Selection",ce.struct.modifier.union([ce.struct.modifier.wholeResidues({0:ce.internal.generator.current()})]),{description:"Expand current selection to whole residues.",category:Gr.Manipulate,referencesCurrent:!0}),Ike=[[["HIS"],"Histidine"],[["ARG"],"Arginine"],[["LYS"],"Lysine"],[["ILE"],"Isoleucine"],[["PHE"],"Phenylalanine"],[["LEU"],"Leucine"],[["TRP"],"Tryptophan"],[["ALA"],"Alanine"],[["MET"],"Methionine"],[["PRO"],"Proline"],[["CYS"],"Cysteine"],[["ASN"],"Asparagine"],[["VAL"],"Valine"],[["GLY"],"Glycine"],[["SER"],"Serine"],[["GLN"],"Glutamine"],[["TYR"],"Tyrosine"],[["ASP"],"Aspartic Acid"],[["GLU"],"Glutamic Acid"],[["THR"],"Threonine"],[["SEC"],"Selenocysteine"],[["PYL"],"Pyrrolysine"],[["UNK"],"Unknown"]].sort(function(e,t){return e[1]<t[1]?-1:e[1]>t[1]?1:0}),Mke=[[["A","DA"],"Adenosine"],[["C","DC"],"Cytidine"],[["T","DT"],"Thymidine"],[["G","DG"],"Guanosine"],[["I","DI"],"Inosine"],[["U","DU"],"Uridine"],[["N","DN"],"Unknown"]].sort(function(e,t){return e[1]<t[1]?-1:e[1]>t[1]?1:0});function R5(e,t,r){var n=e[0],a=e[1];r===void 0&&(r=0);var i=n.length===1&&!vY.has(n[0])?"["+n[0]+"] "+a:a+" ("+n.join(", ")+")";return qr(i,ce.struct.modifier.union([ce.struct.generator.atomGroups({"residue-test":ce.core.set.has([ce.set.apply(ce,n),ce.ammp("auth_comp_id")])})]),{category:t,priority:r,description:i})}function Dke(e,t,r){var n=e[0],a=e[1],i=a+" ("+n.join(", ")+")";return qr(i,ce.struct.modifier.union([ce.struct.generator.atomGroups({"atom-test":ce.core.set.has([ce.set.apply(ce,n),ce.acp("elementSymbol")])})]),{category:t,priority:r,description:i})}function kke(e,t,r){var n=e[0],a=e[1],i=""+a;return qr(""+a,ce.struct.modifier.union([ce.struct.generator.atomGroups({"entity-test":ce.core.list.equal([ce.list.apply(ce,n),ce.ammp("entityDescription")])})]),{category:t,priority:r,description:i})}var vY=Aa.unionMany(_k,t_,r_,Jw);function Rke(e){for(var t=new Set,r=0,n=e;r<n.length;r++){var a=n[r];a.uniqueElementSymbols.forEach(function(o){return t.add(o)})}var i=[];return t.forEach(function(o){var s=jDe[o]||o;i.push(Dke([[o],s],"Element Symbol",0))}),i}function Oke(e){for(var t=new Map,r=new Set,n=0,a=e;n<a.length;n++){var i=a[n];i.uniqueResidueNames.forEach(function(d){return r.add(d)});for(var o=function(d){i.uniqueResidueNames.forEach(function(f){var p=d.properties.chemicalComponentMap.get(f);p&&t.set(f,p.name)})},s=0,u=i.models;s<u.length;s++){var l=u[s];o(l)}}var c=[];return Aa.difference(r,vY).forEach(function(d){var f=t.get(d)||d;c.push(R5([[d],f],"Ligand/Non-standard Residue",200))}),c}function Bke(e){for(var t=new Map,r=ot.create(),n=0,a=e;n<a.length;n++){var i=a[n];r.structure=i;for(var o=0,s=i.unitSymmetryGroups;o<s.length;o++){var u=s[o];r.unit=u.units[0],r.element=u.elements[0];var l=mt.entity.type(r);if(l==="polymer"||l==="branched"){var c=mt.entity.pdbx_description(r);t.set(c.join(", "),c)}}}var d=[];return t.forEach(function(f,p){d.push(kke([f,p],"Polymer/Carbohydrate Entities",300))}),d}var Ea={all:tke,current:rke,polymer:nke,trace:ake,backbone:ike,sidechain:oke,sidechainWithTrace:ske,protein:uke,nucleic:lke,helix:cke,beta:dke,water:fke,ion:pke,lipid:hke,branched:l_,branchedPlusConnected:fY,branchedConnectedOnly:pY,ligand:Fk,ligandPlusConnected:hY,ligandConnectedOnly:mY,connectedOnly:mke,disulfideBridges:vke,nosBridges:gke,nonStandardPolymer:yke,coarse:bke,ring:xke,aromaticRing:Ske,surroundings:Cke,surroundingLigands:wke,complement:_ke,covalentlyBonded:Ake,covalentlyOrMetallicBonded:Eke,covalentlyBondedComponent:Tke,wholeResidues:Pke},Fke=function(){function e(){var t,r;this.list=[],this.options=[],this.version=1,(t=this.list).push.apply(t,Gt(Gt(Gt([],Object.values(Ea)),Ike.map(function(n){return R5(n,Gr.AminoAcid)})),Mke.map(function(n){return R5(n,Gr.NucleicBase)}))),(r=this.options).push.apply(r,this.list.map(function(n){return[n,n.label,n.category]}))}return e.prototype.add=function(t){this.list.push(t),this.options.push([t,t.label,t.category]),this.version+=1},e.prototype.remove=function(t){var r=this.list.indexOf(t);r!==-1&&(this.list.splice(r,1),this.options.splice(r,1),this.version+=1)},e}(),Lke=function(){return{type:M.MappedStatic("static",{static:M.Text("polymer"),expression:M.Value(ce.struct.generator.all),bundle:M.Value(sn.Empty),script:M.Script({language:"mol-script",expression:"(sel.atom.all)"})},{isHidden:!0}),nullIfEmpty:M.Optional(M.Boolean(!0,{isHidden:!0})),label:M.Text("",{isHidden:!0})}};function Nke(e,t,r){r.source=e;var n=$e.Empty,a=void 0;switch(t.type.name){case"static":{var i=void 0;switch(t.type.params){case"all":i=Ea.all.query,a="All";break;case"polymer":i=Ea.polymer.query,a="Polymer";break;case"protein":i=Ea.protein.query,a="Protein";break;case"nucleic":i=Ea.nucleic.query,a="Nucleic";break;case"water":i=un.internal.water(),a="Water";break;case"ion":i=Ea.ion.query,a="Ion";break;case"lipid":i=Ea.lipid.query,a="Lipid";break;case"branched":i=Ea.branchedPlusConnected.query,a="Branched";break;case"ligand":i=Ea.ligandPlusConnected.query,a="Ligand";break;case"non-standard":i=Ea.nonStandardPolymer.query,a="Non-standard";break;case"coarse":i=Ea.coarse.query,a="Coarse";break;default:throw new Error(t.type+" is a not valid complex element.")}var o=i(new As(e));n=St.unionStructure(o);break}case"script":case"expression":{var s=Ki.createAndRun(e,t.type.params),u=s.selection,l=s.entry;r.entry=l,n=St.unionStructure(u);break}case"bundle":{if(t.type.params.hash!==e.hashCode)break;n=sn.toStructure(t.type.params,e);break}}if(t.nullIfEmpty&&n.elementCount===0)return qn.Null;var c={label:""+(t.label||a||"Component"),description:$e.elementDescription(n)};return new be.Molecule.Structure(n,c)}function zke(e,t,r,n,a){if(r.type.name!==n.type.name)return gt.UpdateResult.Recreate;var i=!1;switch(n.type.name){case"static":return r.type.params!==n.type.params||!$e.areEquivalent(e,a.source)?gt.UpdateResult.Recreate:t.data.model===e.model?gt.UpdateResult.Unchanged:rr.areHierarchiesEqual(e.model,t.data.model)?(t.data=t.data.remapModel(e.model),gt.UpdateResult.Updated):gt.UpdateResult.Recreate;case"script":if(!yi.areEqual(r.type.params,n.type.params))return gt.UpdateResult.Recreate;case"expression":{if(r.type.params!==n.type.params)return gt.UpdateResult.Recreate;if(e===a.source)break;var o=a.entry,s=Ki.updateStructure(o,e);a.source=e,t.data=St.unionStructure(s),Ki.updateStructureObject(t,s,n.label),i=!0;break}case"bundle":{if(e===a.source&&sn.areEqual(r.type.params,n.type.params))break;a.source=e,n.type.params.hash!==e.hashCode?(i=t.data.elementCount!==0,t.data=t.data.elementCount===0?t.data:$e.Empty):(i=!0,t.data=sn.toStructure(n.type.params,e));break}}if(i){if(n.nullIfEmpty&&t.data.elementCount===0)return gt.UpdateResult.Null;t.description=$e.elementDescription(t.data)}return r.label!==n.label&&(i=!0,t.label=""+(n.label||t.label)),i?gt.UpdateResult.Updated:gt.UpdateResult.Unchanged}function gY(e,t){for(var r=yt.create(e.data,t*2),n=yt.create(e.data,t*2),a=yt.create(e.data,t*2),i=yt.create(e.data,t*2),o=0;o<t;++o){Bt.markLine(e);var s=e.tokenStart,u=e.position;Bt.trim(e,s,s+10),yt.addUnchecked(r,e.tokenStart,e.tokenEnd),Bt.trim(e,s+10,s+20),yt.addUnchecked(n,e.tokenStart,e.tokenEnd),Bt.trim(e,s+20,s+30),yt.addUnchecked(a,e.tokenStart,e.tokenEnd),Bt.trim(e,s+31,s+34),yt.addUnchecked(i,e.tokenStart,e.tokenEnd),e.position=u}return{count:t,x:tn(r)(ye.Schema.float),y:tn(n)(ye.Schema.float),z:tn(a)(ye.Schema.float),type_symbol:tn(i)(ye.Schema.str)}}function yY(e,t){for(var r=yt.create(e.data,t*2),n=yt.create(e.data,t*2),a=yt.create(e.data,t*2),i=0;i<t;++i){Bt.markLine(e);var o=e.tokenStart,s=e.position;Bt.trim(e,o,o+3),yt.addUnchecked(r,e.tokenStart,e.tokenEnd),Bt.trim(e,o+3,o+6),yt.addUnchecked(n,e.tokenStart,e.tokenEnd),Bt.trim(e,o+6,o+9),yt.addUnchecked(a,e.tokenStart,e.tokenEnd),e.position=s}return{count:t,atomIdxA:tn(r)(ye.Schema.int),atomIdxB:tn(n)(ye.Schema.int),order:tn(a)(ye.Schema.int)}}function Uke(e){var t=Bt(e),r=Bt.readLine(t).trim(),n=Bt.readLine(t).trim(),a=Bt.readLine(t).trim(),i=Bt.readLine(t),o=+i.substr(0,3),s=+i.substr(3,3),u=gY(t,o),l=yY(t,s),c={title:r,program:n,comment:a,atoms:u,bonds:l};return Nn.success(c)}function Vke(e){var t=this;return Qe.create("Parse Mol",function(){return pe(t,void 0,void 0,function(){return he(this,function(r){return[2,Uke(e)]})})})}function Hke(e,t){return pe(this,void 0,void 0,function(){var r,n,a,i,o,s,u,l,c,d,f,p,h,m,v;return he(this,function(g){switch(g.label){case 0:return r=e.atoms,n=e.bonds,a=ye.ofConst("MOL",e.atoms.count,ye.Schema.str),i=ye.ofConst("A",e.atoms.count,ye.Schema.str),o=ye.asArrayColumn(r.type_symbol),s=ye.ofConst(1,r.count,ye.Schema.int),u=nn.ofPartialColumns(vo.atom_site,{auth_asym_id:i,auth_atom_id:o,auth_comp_id:a,auth_seq_id:s,Cartn_x:ye.asArrayColumn(r.x,Float32Array),Cartn_y:ye.asArrayColumn(r.y,Float32Array),Cartn_z:ye.asArrayColumn(r.z,Float32Array),id:ye.range(0,r.count-1),label_asym_id:i,label_atom_id:o,label_comp_id:a,label_seq_id:s,label_entity_id:ye.ofConst("1",r.count,ye.Schema.str),occupancy:ye.ofConst(1,r.count,ye.Schema.float),type_symbol:o,pdbx_PDB_model_num:ye.ofConst(1,r.count,ye.Schema.int)},r.count),l=new Op,l.setNames([["MOL","Unknown Entity"]]),l.getEntityId("MOL",0,"A"),c=new Rp(s,o),c.setNames([["MOL","Unknown Molecule"]]),c.add("MOL",0),d=Em({entity:l.getEntityTable(),chem_comp:c.getChemCompTable(),atom_site:u}),[4,Hd(d,O5.create(e),t)];case 1:return f=g.sent(),f.frameCount>0&&(p=ye.ofIntArray(ye.mapToArray(n.atomIdxA,function(y){return y-1},Int32Array)),h=ye.ofIntArray(ye.mapToArray(n.atomIdxB,function(y){return y-1},Int32Array)),m=ye.asArrayColumn(n.order,Int32Array),v=Bi.fromData({pairs:{indexA:p,indexB:h,order:m},count:r.count}),Bi.Provider.set(f.representative,v)),[2,f]}})})}var O5;(function(e){function t(n){return n?.kind==="mol"}e.is=t;function r(n){return{kind:"mol",name:n.title,data:n}}e.create=r})(O5||(O5={}));function bY(e){return Qe.create("Parse MOL",function(t){return Hke(e,t)})}function jke(e){var t=e.IT_number.value(0),r=e["name_H-M_full"].value(0);return e.IT_number.isDefined?(e["name_H-M_full"].isDefined,t):r}function Gke(e){var t=e.cell,r=e.space_group,n=jke(r),a=Go.create(n,A.create(t.length_a.value(0),t.length_b.value(0),t.length_c.value(0)),A.scale(A(),A.create(t.angle_alpha.value(0),t.angle_beta.value(0),t.angle_gamma.value(0)),Math.PI/180));return{spacegroup:al.create(a),assemblies:[],isNonStandardCrystalFrame:!1,ncsOperators:[]}}function qke(e,t,r){var n;return pe(this,void 0,void 0,function(){var a,i,o,s,u,l,c,d,f,p,h,m,v,g,Se,y,b,S,x,C,P,w,Se,_,E,P,Se,D,k,F,X,U,j,te,q,W,V,Se,ee,ue,$,Q,R,Y,re,K,L,H,Z,fe,me,xe,Se,ie,le,O,G;return he(this,function(ve){switch(ve.label){case 0:for(a=e.atom_site._rowCount,i=ye.ofConst("MOL",a,ye.Schema.str),o=ye.ofConst("A",a,ye.Schema.str),s=ye.ofConst(1,a,ye.Schema.int),u=Gke(e),l=u.spacegroup.cell.fromFractional,c=e.atom_site,d=c.fract_x,f=c.fract_y,p=c.fract_z,h=new Float32Array(a),m=new Float32Array(a),v=new Float32Array(a),g=A(),Se=0;Se<a;++Se)A.set(g,d.value(Se),f.value(Se),p.value(Se)),A.transformMat4(g,g,l),h[Se]=g[0],m[Se]=g[1],v[Se]=g[2];if(y=e.atom_site,b=y.type_symbol,S=y.label,b.isDefined){for(P=new Array(a),w=new Int8Array(a),Se=0;Se<a;++Se)_=b.value(Se),E=_.length,_[E-1]==="+"?(P[Se]=_.substring(0,E-2),w[Se]=parseInt(_[E-2])):_[E-2]==="+"?(P[Se]=_.substring(0,E-2),w[Se]=parseInt(_[E-1])):_[E-1]==="-"?(P[Se]=_.substring(0,E-2),w[Se]=-parseInt(_[E-2])):_[E-2]==="-"?(P[Se]=_.substring(0,E-2),w[Se]=-parseInt(_[E-1])):(P[Se]=_,w[Se]=0);x=ye.ofStringArray(P),C=ye.ofIntArray(w)}else{for(P=new Array(a),Se=0;Se<a;++Se)P[Se]=Qw(S.value(Se));x=ye.ofStringArray(P),C=ye.Undefined(a,ye.Schema.int)}return D=nn.ofPartialColumns(vo.atom_site,{auth_asym_id:o,auth_atom_id:S,auth_comp_id:i,auth_seq_id:s,Cartn_x:ye.ofFloatArray(h),Cartn_y:ye.ofFloatArray(m),Cartn_z:ye.ofFloatArray(v),id:ye.range(0,a-1),label_asym_id:o,label_atom_id:S,label_comp_id:i,label_seq_id:s,label_entity_id:ye.ofConst("1",a,ye.Schema.str),occupancy:e.atom_site.occupancy.isDefined?e.atom_site.occupancy:ye.ofConst(1,a,ye.Schema.float),type_symbol:x,pdbx_formal_charge:C,pdbx_PDB_model_num:ye.ofConst(1,a,ye.Schema.int),B_iso_or_equiv:e.atom_site.U_iso_or_equiv},a),k=e.chemical.name_common.value(0)||e.chemical.name_systematic.value(0)||e.chemical_formula.sum.value(0),F=new Op,F.setNames([["MOL",k||"Unknown Entity"]]),F.getEntityId("MOL",0,"A"),X=new Rp(s,e.atom_site.type_symbol),X.setNames([["MOL",k||"Unknown Molecule"]]),X.add("MOL",0),U=Em({entity:F.getEntityTable(),chem_comp:X.getChemCompTable(),atom_site:D}),[4,Hd(U,t,r)];case 1:if(j=ve.sent(),j.frameCount>0&&(te=j.representative,wa.Provider.set(te,u),q=e.geom_bond._rowCount,q>0)){for(W={},V=e.atom_site.label,Se=0,ee=V.rowCount;Se<ee;++Se)W[V.value(Se)]=Se;for(ue=(n=t.data.frame.categories.ccdc_geom_bond_type)===null||n===void 0?void 0:n.getField(""),$=[],Q=[],R=[],Y=[],re=[],K=new Set,L=0,H=e.geom_bond,Z=H.atom_site_label_1,fe=H.atom_site_label_2,me=H.valence,xe=H.distance,Se=0;Se<q;++Se)ie=W[Z.value(Se)],le=W[fe.value(Se)],O=ie<le?op(ie,le):op(le,ie),!K.has(O)&&(K.add(O),$[L]=ie,Q[L]=le,Y[L]=xe.value(Se)||-1,ue?(G=ue.str(Se),G==="D"?(R[L]=2,re[L]=1):G==="A"?(R[L]=1,re[L]=17):(R[L]=1,re[L]=1)):(re[L]=1,R[L]=me.isDefined?me.value(Se):1),L+=1);Bi.Provider.set(te,Bi.fromData({pairs:{indexA:ye.ofIntArray($),indexB:ye.ofIntArray(Q),order:ye.ofIntArray(R),distance:ye.ofFloatArray(Y),flag:ye.ofIntArray(re)},count:a}))}return[2,j]}})})}function Wke(e){if(!!j1.is(e.sourceData)){var t=e.sourceData.data.db,r=t.atom_site,n=t.atom_site_aniso,a=nn.ofPartialColumns(uc.Schema,{U:n.U,U_esd:n.U_su},n._rowCount),i=uc.getElementToAnsiotropFromLabel(r.label,n.label);return{data:a,elementToAnsiotrop:i}}}function Xke(e){return j1.is(e.sourceData)?e.sourceData.data.db.atom_site_aniso.U.isDefined:!1}uc.Provider.formatRegistry.add("cifCore",Wke,Xke);var j1;(function(e){function t(n){return n?.kind==="cifCore"}e.is=t;function r(n,a){a||(a=md.schema.cifCore(n));var i=a.database_code.depnum_ccdc_archive.value(0)||a.database_code.depnum_ccdc_fiz.value(0)||a.database_code.ICSD.value(0)||a.database_code.MDF.value(0)||a.database_code.NBS.value(0)||a.database_code.CSD.value(0)||a.database_code.COD.value(0)||a._name;return{kind:"cifCore",name:i,data:{db:a,frame:n}}}e.fromFrame=r})(j1||(j1={}));function Yke(e){var t=j1.fromFrame(e);return Qe.create("Parse CIF Core",function(r){return qke(t.data.db,t,r)})}function Kke(e,t){return pe(this,void 0,void 0,function(){var r,n,a,i,o,s,u,l,c;return he(this,function(d){switch(d.label){case 0:return r=e.atoms,n=ye.ofConst("MOL",e.atoms.count,ye.Schema.str),a=ye.ofConst("A",e.atoms.count,ye.Schema.str),i=ye.ofArray({array:ye.mapToArray(r.number,function(f){return wTe(f)}),schema:ye.Schema.Aliased(ye.Schema.str)}),o=ye.ofConst(1,r.count,ye.Schema.int),s=nn.ofPartialColumns(vo.atom_site,{auth_asym_id:a,auth_atom_id:i,auth_comp_id:n,auth_seq_id:o,Cartn_x:ye.asArrayColumn(r.x,Float32Array),Cartn_y:ye.asArrayColumn(r.y,Float32Array),Cartn_z:ye.asArrayColumn(r.z,Float32Array),id:ye.range(0,r.count-1),label_asym_id:a,label_atom_id:i,label_comp_id:n,label_seq_id:o,label_entity_id:ye.ofConst("1",r.count,ye.Schema.str),occupancy:ye.ofConst(1,r.count,ye.Schema.float),type_symbol:i,pdbx_PDB_model_num:ye.ofConst(1,r.count,ye.Schema.int)},r.count),u=new Op,u.setNames([["MOL","Unknown Entity"]]),u.getEntityId("MOL",0,"A"),l=new Rp(o,i),l.setNames([["MOL","Unknown Molecule"]]),l.add("MOL",0),c=Em({entity:u.getEntityTable(),chem_comp:l.getChemCompTable(),atom_site:s}),[4,Hd(c,B5.create(e),t)];case 1:return[2,d.sent()]}})})}var B5;(function(e){function t(n){return n?.kind==="cube"}e.is=t;function r(n){return{kind:"cube",name:n.header.comment1,data:n}}e.create=r})(B5||(B5={}));function $ke(e){return Qe.create("Parse Cube",function(t){return Kke(e,t)})}var Lk=Bt.skipWhitespace,xY=Bt.eatValue,Ml=Bt.markLine,Dl=Bt.getTokenString,SY=Bt.readLine;function Qke(){return{mol_name:"",num_atoms:0,num_bonds:0,num_subst:0,num_feat:0,num_sets:0,mol_type:"",charge_type:"",status_bits:"",mol_comment:""}}function Zke(e,t){return{tokenizer:e,molecule:Qke(),runtimeCtx:t}}var Jke=/\s+/g;function eRe(e){for(var t=e.tokenizer,r=e.molecule;Dl(t)!=="@<TRIPOS>MOLECULE"&&t.position<t.data.length;)Ml(t);Ml(t),r.mol_name=Dl(t),Ml(t);var n=Dl(t).trim().split(Jke);r.num_atoms=parseInt(n[0]),r.num_bonds=parseInt(n[1]),r.num_subst=parseInt(n[2]),r.num_feat=parseInt(n[3]),r.num_sets=parseInt(n[4]),Ml(t);var a=Dl(t);if(!a.startsWith("@<TRIPOS>")){r.mol_type=a,Ml(t);var i=Dl(t);if(!i.startsWith("@<TRIPOS>")){r.charge_type=i,Ml(t);var o=Dl(t);if(!o.startsWith("@<TRIPOS>")){r.status_bits=o,Ml(t);var s=Dl(t);s.startsWith("@<TRIPOS>")||(r.mol_comment=s)}}}}function tRe(e){return pe(this,void 0,void 0,function(){var t,r,n,a,i,o,s,u,l,c,d,f,p,h,m,v,g,y,b,S,x,C,w;return he(this,function(_){switch(_.label){case 0:for(t=e.tokenizer,r=e.molecule;Dl(t)!=="@<TRIPOS>ATOM"&&t.position<t.data.length;)Ml(t);return n=t.position,a=t.lineNumber,i=SY(t),o=i.trim().split(/\s+/g),s=o.length,u=yt.create(t.data,r.num_atoms*2),l=yt.create(t.data,r.num_atoms*2),c=yt.create(t.data,r.num_atoms*2),d=yt.create(t.data,r.num_atoms*2),f=yt.create(t.data,r.num_atoms*2),p=yt.create(t.data,r.num_atoms*2),h=yt.create(t.data,r.num_atoms*2),m=yt.create(t.data,r.num_atoms*2),v=yt.create(t.data,r.num_atoms*2),g=yt.create(t.data,r.num_atoms*2),y=ye.Undefined(r.num_atoms,ye.Schema.float),b=ye.Undefined(r.num_atoms,ye.Schema.int),S=ye.Undefined(r.num_atoms,ye.Schema.str),t.position=n,t.lineNumber=a,x=t.length,C=0,[4,fd(e.runtimeCtx,1e5,void 0,function(E){for(var P=Math.min(r.num_atoms-C,E),D=0;D<P;D++)for(var k=0;k<s;k++)switch(Lk(t),t.tokenStart=t.position,xY(t),k){case 0:yt.addUnchecked(u,t.tokenStart,t.tokenEnd);break;case 1:yt.addUnchecked(l,t.tokenStart,t.tokenEnd);break;case 2:yt.addUnchecked(c,t.tokenStart,t.tokenEnd);break;case 3:yt.addUnchecked(d,t.tokenStart,t.tokenEnd);break;case 4:yt.addUnchecked(f,t.tokenStart,t.tokenEnd);break;case 5:yt.addUnchecked(p,t.tokenStart,t.tokenEnd);break;case 6:yt.addUnchecked(h,t.tokenStart,t.tokenEnd);break;case 7:yt.addUnchecked(m,t.tokenStart,t.tokenEnd);break;case 8:yt.addUnchecked(v,t.tokenStart,t.tokenEnd);break;case 9:yt.addUnchecked(g,t.tokenStart,t.tokenEnd);break}return C+=P,P},function(E){return E.update({message:"Parsing...",current:t.position,max:x})})];case 1:return _.sent(),w={count:r.num_atoms,atom_id:tn(u)(ye.Schema.int),atom_name:tn(l)(ye.Schema.str),x:tn(c)(ye.Schema.float),y:tn(d)(ye.Schema.float),z:tn(f)(ye.Schema.float),atom_type:s>5?tn(p)(ye.Schema.str):S,subst_id:s>6?tn(h)(ye.Schema.int):b,subst_name:s>7?tn(m)(ye.Schema.str):S,charge:s>8?tn(v)(ye.Schema.float):y,status_bit:s>9?tn(g)(ye.Schema.str):S},[2,w]}})})}function rRe(e){return pe(this,void 0,void 0,function(){var t,r,n,a,i,o,s,u,l,c,d,f,p,h,m;return he(this,function(v){switch(v.label){case 0:for(t=e.tokenizer,r=e.molecule;Dl(t)!=="@<TRIPOS>BOND"&&t.position<t.data.length;)Ml(t);return n=t.position,a=t.lineNumber,i=SY(t),o=i.trim().split(/\s+/g),s=o.length,u=yt.create(t.data,r.num_bonds*2),l=yt.create(t.data,r.num_bonds*2),c=yt.create(t.data,r.num_bonds*2),d=yt.create(t.data,r.num_bonds*2),f=yt.create(t.data,r.num_bonds*2),t.position=n,t.lineNumber=a,p=t.length,h=0,[4,fd(e.runtimeCtx,1e5,void 0,function(g){for(var y=Math.min(r.num_bonds-h,g),b=0;b<y;b++)for(var S=0;S<s;S++)switch(Lk(t),t.tokenStart=t.position,xY(t),S){case 0:yt.addUnchecked(u,t.tokenStart,t.tokenEnd);break;case 1:yt.addUnchecked(l,t.tokenStart,t.tokenEnd);break;case 2:yt.addUnchecked(c,t.tokenStart,t.tokenEnd);break;case 3:yt.addUnchecked(d,t.tokenStart,t.tokenEnd);break;default:yt.addUnchecked(f,t.tokenStart,t.tokenEnd);break}return h+=y,y},function(g){return g.update({message:"Parsing...",current:t.position,max:p})})];case 1:return v.sent(),m={count:r.num_bonds,bond_id:tn(u)(ye.Schema.int),origin_atom_id:tn(l)(ye.Schema.int),target_atom_id:tn(c)(ye.Schema.int),bond_type:tn(d)(ye.Schema.str),status_bits:s>4?tn(f)(ye.Schema.str):ye.Undefined(r.num_bonds,ye.Schema.str)},[2,m]}})})}function nRe(e,t,r){return pe(this,void 0,void 0,function(){var n,a,i,o,s,u;return he(this,function(l){switch(l.label){case 0:n=Bt(t),e.update({message:"Parsing...",current:0,max:t.length}),a=[],l.label=1;case 1:return n.position<t.length?(i=Zke(n,e),eRe(i),[4,tRe(i)]):[3,4];case 2:return o=l.sent(),[4,rRe(i)];case 3:for(s=l.sent(),a.push({molecule:i.molecule,atoms:o,bonds:s}),Lk(n);Dl(n)!=="@<TRIPOS>MOLECULE"&&n.position<n.data.length;)Ml(n);return[3,1];case 4:return u={name:r,structures:a},[2,Nn.success(u)]}})})}function aRe(e,t){var r=this;return Qe.create("Parse MOL2",function(n){return pe(r,void 0,void 0,function(){return he(this,function(a){switch(a.label){case 0:return[4,nRe(n,e,t)];case 1:return[2,a.sent()]}})})})}function iRe(e,t){return pe(this,void 0,void 0,function(){var r,n,a,i,o,s,u,l,c,d,f,p,h,m,v,g,y,b,S,x,C,w;return he(this,function(_){switch(_.label){case 0:r=[],n=0,a=e.structures.length,_.label=1;case 1:if(!(n<a))return[3,4];for(i=e.structures[n],o=i.atoms,s=i.bonds,u=i.molecule,l=ye.ofConst("A",o.count,ye.Schema.str),c=new Array(o.count),d=0;d<o.count;++d)c[d]=Qw(o.atom_name.value(d));for(f=nn.ofPartialColumns(vo.atom_site,{auth_asym_id:l,auth_atom_id:ye.asArrayColumn(o.atom_name),auth_comp_id:o.subst_name,auth_seq_id:o.subst_id,Cartn_x:ye.asArrayColumn(o.x,Float32Array),Cartn_y:ye.asArrayColumn(o.y,Float32Array),Cartn_z:ye.asArrayColumn(o.z,Float32Array),id:ye.asArrayColumn(o.atom_id),label_asym_id:l,label_atom_id:ye.asArrayColumn(o.atom_name),label_comp_id:o.subst_name,label_seq_id:o.subst_id,label_entity_id:ye.ofConst("1",o.count,ye.Schema.str),occupancy:ye.ofConst(1,o.count,ye.Schema.float),type_symbol:ye.ofStringArray(c),pdbx_PDB_model_num:ye.ofConst(n,o.count,ye.Schema.int)},o.count),p=new Op,p.setNames([["MOL",u.mol_name||"Unknown Entity"]]),p.getEntityId("MOL",0,"A"),h=new Rp(o.subst_id,o.atom_name),m=0,v=o.subst_name.rowCount;m<v;++m)h.add(o.subst_name.value(m),m);return g=Em({entity:p.getEntityTable(),chem_comp:h.getChemCompTable(),atom_site:f}),[4,Hd(g,F5.create(e),t)];case 2:y=_.sent(),y.frameCount>0&&(b=ye.ofIntArray(ye.mapToArray(s.origin_atom_id,function(E){return E-1},Int32Array)),S=ye.ofIntArray(ye.mapToArray(s.target_atom_id,function(E){return E-1},Int32Array)),x=ye.ofIntArray(ye.mapToArray(s.bond_type,function(E){return E==="ar"?1:parseInt(E)},Int8Array)),C=Bi.fromData({pairs:{indexA:b,indexB:S,order:x},count:o.count}),w=y.representative,Bi.Provider.set(w,C),x0.Provider.set(w,{data:o.charge,type:u.charge_type}),r.push(w)),_.label=3;case 3:return++n,[3,1];case 4:return[2,new cm(r)]}})})}var F5;(function(e){function t(n){return n?.kind==="mol2"}e.is=t;function r(n){return{kind:"mol2",name:n.name,data:n}}e.create=r})(F5||(F5={}));function oRe(e){return Qe.create("Parse MOL2",function(t){return iRe(e,t)})}var ev=new Uint32Array([0,0,0,0,0,0,0,0,0,8,10,12,16,20,25,32,40,50,64,80,101,128,161,203,256,322,406,512,645,812,1024,1290,1625,2048,2580,3250,4096,5060,6501,8192,10321,13003,16384,20642,26007,32768,41285,52015,65536,82570,104031,131072,165140,208063,262144,330280,416127,524287,660561,832255,1048576,1321122,1664510,2097152,2642245,3329021,4194304,5284491,6658042,8388607,10568983,13316085,16777216]),YA=9,Ro;(function(e){function t(c){for(var d=1,f=0;c>=d&&f<32;)f++,d<<=1;return f}e.sizeOfInt=t;var r=new Uint8Array(32);function n(c,d){var f=1,p=0;r[0]=1;for(var h=0;h<c;h++){var m=void 0,v=0;for(m=0;m<f;m++)v+=r[m]*d[h],r[m]=v&255,v>>=8;for(;v!==0;)r[m++]=v&255,v>>=8;f=m}var g=1;for(f--;r[f]>=g;)p++,g*=2;return p+f*8}e.sizeOfInts=n;var a=new ArrayBuffer(8*3);e.buf=new Int32Array(a);var i=new Uint32Array(a);function o(c,d,f){for(var p=f,h=(1<<p)-1,m=i[1],v=i[2],g=e.buf[0],y=0;p>=8;)v=v<<8|c[d+g++],y|=v>>m<<p-8,p-=8;return p>0&&(m<p&&(m+=8,v=v<<8|c[d+g++]),m-=p,y|=v>>m&(1<<p)-1),y&=h,e.buf[0]=g,e.buf[1]=m,e.buf[2]=v,y}e.decodeBits=o;function s(c,d){var f=i[2],p=e.buf[0];return f=f<<8|c[d+p],e.buf[0]=p+1,e.buf[2]=f,f>>i[1]&255}var u=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];function l(c,d,f,p,h){var m=f,v=0;for(u[0]=0,u[1]=0,u[2]=0,u[3]=0;m>8;)u[v++]=s(c,d),m-=8;m>0&&(u[v++]=o(c,d,m));for(var g=2;g>0;g--){for(var y=0,b=p[g],S=v-1;S>=0;S--){y=y<<8|u[S];var x=y/b|0;u[S]=x,y=y-x*b}h[g]=y}h[0]=u[0]|u[1]<<8|u[2]<<16|u[3]<<24}e.decodeInts=l})(Ro||(Ro={}));function sRe(){throw new Error("(xdrfile error) Undefined error.")}function uRe(e,t){return pe(this,void 0,void 0,function(){var r,n,a,i,o,s,u,l,c,d,f,p,h,m,v,g,F,F,y,b,S,x,C,w,_,E,P,D,k,F,X,U,j,te,q;return he(this,function(W){switch(W.label){case 0:r=new DataView(t.buffer,t.byteOffset),n={frames:[],boxes:[],times:[],timeOffset:0,deltaTime:0},a=n.frames,i=n.boxes,o=n.times,s=[0,0,0,0,0,0],u=[0,0,0],l=[0,0,0],c=[0,0,0],d=[.1,.1,.1],f=[.1,.1,.1],p=0,h=Ro.buf,W.label=1;case 1:for(m=void 0,v=r.getInt32(p+4),p+=12,o.push(r.getFloat32(p)),p+=4,g=new Float32Array(9),F=0;F<9;++F)g[F]=r.getFloat32(p)*10,p+=4;if(i.push(g),v<=9)for(m={count:v/3,x:new Float32Array(v/3),y:new Float32Array(v/3),z:new Float32Array(v/3)},F=0;F<v/3;++F)m.x[F]=r.getFloat32(p),m.y[F]=r.getFloat32(p),m.z[F]=r.getFloat32(p),p+=4;else{for(h[0]=h[1]=h[2]=0,u[0]=u[1]=u[2]=0,c[0]=c[1]=c[2]=0,l[0]=l[1]=l[2]=0,d[0]=d[1]=d[2]=0,f[0]=f[1]=f[2]=0,m={count:v,x:new Float32Array(v),y:new Float32Array(v),z:new Float32Array(v)},y=0,b=r.getInt32(p),p+=4,S=r.getFloat32(p),p+=4,s[0]=r.getInt32(p),s[1]=r.getInt32(p+4),s[2]=r.getInt32(p+8),s[3]=r.getInt32(p+12),s[4]=r.getInt32(p+16),s[5]=r.getInt32(p+20),u[0]=s[3]-s[0]+1,u[1]=s[4]-s[1]+1,u[2]=s[5]-s[2]+1,p+=24,x=void 0,(u[0]|u[1]|u[2])>16777215?(l[0]=Ro.sizeOfInt(u[0]),l[1]=Ro.sizeOfInt(u[1]),l[2]=Ro.sizeOfInt(u[2]),x=0):x=Ro.sizeOfInts(3,u),C=r.getInt32(p),p+=4,w=C-1,w=YA>w?YA:w,_=ev[w]/2|0,E=ev[C]/2|0,c[0]=c[1]=c[2]=ev[C],P=Math.ceil(r.getInt32(p)/4)*4,p+=4,D=1/S,k=0,F=0,d[0]=d[1]=d[2]=0;F<b;){if(x===0?(d[0]=Ro.decodeBits(t,p,l[0]),d[1]=Ro.decodeBits(t,p,l[1]),d[2]=Ro.decodeBits(t,p,l[2])):Ro.decodeInts(t,p,x,u,d),F++,d[0]+=s[0],d[1]+=s[1],d[2]+=s[2],f[0]=d[0],f[1]=d[1],f[2]=d[2],X=Ro.decodeBits(t,p,1),U=0,X===1&&(k=Ro.decodeBits(t,p,5),U=k%3,k-=U,U--),k>0)for(d[0]=d[1]=d[2]=0,j=0;j<k;j+=3)Ro.decodeInts(t,p,C,c,d),F++,d[0]+=f[0]-E,d[1]+=f[1]-E,d[2]+=f[2]-E,j===0?(te=d[0],d[0]=f[0],f[0]=te,te=d[1],d[1]=f[1],f[1]=te,te=d[2],d[2]=f[2],f[2]=te,m.x[y]=f[0]*D,m.y[y]=f[1]*D,m.z[y]=f[2]*D,y++):(f[0]=d[0],f[1]=d[1],f[2]=d[2]),m.x[y]=d[0]*D,m.y[y]=d[1]*D,m.z[y]=d[2]*D,y++;else m.x[y]=d[0]*D,m.y[y]=d[1]*D,m.z[y]=d[2]*D,y++;C+=U,U<0?(E=_,C>YA?_=ev[C-1]/2|0:_=0):U>0&&(_=E,E=ev[C]/2|0),c[0]=c[1]=c[2]=ev[C],(c[0]===0||c[1]===0||c[2]===0)&&sRe()}p+=P}for(q=0;q<v;q++)m.x[q]*=10,m.y[q]*=10,m.z[q]*=10;return a.push(m),e.shouldUpdate?[4,e.update({current:p,max:t.length})]:[3,3];case 2:W.sent(),W.label=3;case 3:return p>=t.length?[3,4]:[3,1];case 4:return o.length>=1&&(n.timeOffset=o[0]),o.length>=2&&(n.deltaTime=o[1]-o[0]),[2,n]}})})}function lRe(e){var t=this;return Qe.create("Parse XTC",function(r){return pe(t,void 0,void 0,function(){var n,a;return he(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),r.update({canAbort:!0,message:"Parsing trajectory..."}),[4,uRe(r,e)];case 1:return n=i.sent(),[2,Nn.success(n)];case 2:return a=i.sent(),[2,Nn.error(""+a)];case 3:return[2]}})})})}function cRe(e){var t=this;return Qe.create("Parse XTC",function(r){return pe(t,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d;return he(this,function(f){switch(f.label){case 0:return[4,r.update("Converting to coordinates")];case 1:for(f.sent(),n=Rf(e.deltaTime,"step"),a=Rf(e.timeOffset,n.unit),i=[],o=0,s=e.frames.length;o<s;++o)u=e.boxes[o],l=A.fromArray(A(),u,0),c=A.fromArray(A(),u,3),d=A.fromArray(A(),u,6),i.push({elementCount:e.frames[o].count,cell:Gh.fromBasis(l,c,d),x:e.frames[o].x,y:e.frames[o].y,z:e.frames[o].z,xyzOrdering:{isIdentity:!0},time:Rf(a.value+n.value*o,n.unit)});return[2,O1.create(i,n,a)]}})})})}function dRe(e){var t=e.position>=e.data.length-1?0:+Bt.readLine(e);isNaN(t)&&(t=0);for(var r=Bt.readLine(e),n=new Float64Array(t),a=new Float64Array(t),i=new Float64Array(t),o=new Array(t),s=0;s<t;++s){var u=Bt.readLineTrim(e),l=u.split(/\s+/g);o[s]=l[0],n[s]=+l[1],a[s]=+l[2],i[s]=+l[3]}return{count:t,comment:r,x:ye.ofFloatArray(n),y:ye.ofFloatArray(a),z:ye.ofFloatArray(i),type_symbol:ye.ofStringArray(o)}}function fRe(e){for(var t=Bt(e),r=[];;){var n=dRe(t);if(n.count===0)break;r.push(n)}var a={molecules:r};return Nn.success(a)}function pRe(e){var t=this;return Qe.create("Parse Mol",function(){return pe(t,void 0,void 0,function(){return he(this,function(r){return[2,fRe(e)]})})})}function hRe(e,t){for(var r=e.molecules,n=0,a=0,i=r;a<i.length;a++){var o=i[a];n+=o.count}for(var s=new Array(n),u=new Int32Array(n),l=new Float32Array(n),c=new Float32Array(n),d=new Float32Array(n),f=new Int32Array(n),p=0,h=0;h<r.length;h++)for(var o=r[h],m=0;m<o.count;m++)s[p]=o.type_symbol.value(m),l[p]=o.x.value(m),c[p]=o.y.value(m),d[p]=o.z.value(m),u[p]=m,f[p]=h,p++;var v=ye.ofConst("MOL",n,ye.Schema.str),g=ye.ofConst("A",n,ye.Schema.str),y=ye.ofConst(1,n,ye.Schema.int),b=ye.ofStringArray(s),S=nn.ofPartialColumns(vo.atom_site,{auth_asym_id:g,auth_atom_id:b,auth_comp_id:v,auth_seq_id:y,Cartn_x:ye.ofFloatArray(l),Cartn_y:ye.ofFloatArray(c),Cartn_z:ye.ofFloatArray(d),id:ye.ofIntArray(u),label_asym_id:g,label_atom_id:b,label_comp_id:v,label_seq_id:y,label_entity_id:ye.ofConst("1",n,ye.Schema.str),occupancy:ye.ofConst(1,n,ye.Schema.float),type_symbol:b,pdbx_PDB_model_num:ye.ofIntArray(f)},n),x=new Op;x.setNames([["MOL","Unknown Entity"]]),x.getEntityId("MOL",0,"A");var C=new Rp(y,b);C.setNames([["MOL","Unknown Molecule"]]),C.add("MOL",0);var w=Em({entity:x.getEntityTable(),chem_comp:C.getChemCompTable(),atom_site:S});return Hd(w,L5.create(e),t)}var L5;(function(e){function t(n){return n?.kind==="xyz"}e.is=t;function r(n){return{kind:"xyz",name:"xyz",data:n}}e.create=r})(L5||(L5={}));function mRe(e){return Qe.create("Parse XYZ",function(t){return hRe(e,t)})}var N5="$$$$";function vRe(e){for(var t=yt.create(e.data,32),r=yt.create(e.data,32);e.position<e.length;){var n=Bt.readLine(e);if(n.startsWith(N5))break;if(!!n&&n.startsWith("> <")){yt.add(t,e.tokenStart+3,e.tokenEnd-1),Bt.markLine(e);for(var a=e.tokenStart,i=e.tokenEnd,o=!1;e.position<e.length;){var s=Bt.readLine(e);if(!s||s.startsWith(N5)||s.startsWith("> <")){yt.add(r,a,i),o=!0;break}i=e.tokenEnd}o||yt.add(r,a,i)}}return{dataHeader:tn(t)(ye.Schema.str),data:tn(r)(ye.Schema.str)}}function gRe(e){var t=Bt.readLine(e).trim(),r=Bt.readLine(e).trim(),n=Bt.readLine(e).trim(),a=Bt.readLine(e),i=+a.substr(0,3),o=+a.substr(3,3);if(Number.isNaN(i)||Number.isNaN(o)){for(;e.position<e.length;){var s=Bt.readLine(e);if(s.startsWith(N5))break}return}var u=gY(e,i),l=yY(e,o),c=vRe(e);return{molFile:{title:t,program:r,comment:n,atoms:u,bonds:l},dataItems:c}}function yRe(e){for(var t=Bt(e),r=[];t.position<t.length;){var n=gRe(t);n&&r.push(n)}return Nn.success({compounds:r})}function bRe(e){var t=this;return Qe.create("Parse Sdf",function(){return pe(t,void 0,void 0,function(){return he(this,function(r){return[2,yRe(e)]})})})}var xRe=Ut.BuiltIn({name:"coordinates-from-dcd",display:{name:"Parse DCD",description:"Parse DCD binary data."},from:[be.Data.Binary],to:be.Molecule.Coordinates})({apply:function(e){var t=this,r=e.a;return Qe.create("Parse DCD",function(n){return pe(t,void 0,void 0,function(){var a,i;return he(this,function(o){switch(o.label){case 0:return[4,tSe(r.data).runInContext(n)];case 1:if(a=o.sent(),a.isError)throw new Error(a.message);return[4,mTe(a.result).runInContext(n)];case 2:return i=o.sent(),[2,new be.Molecule.Coordinates(i,{label:r.label,description:"Coordinates"})]}})})})}}),SRe=Ut.BuiltIn({name:"coordinates-from-xtc",display:{name:"Parse XTC",description:"Parse XTC binary data."},from:[be.Data.Binary],to:be.Molecule.Coordinates})({apply:function(e){var t=this,r=e.a;return Qe.create("Parse XTC",function(n){return pe(t,void 0,void 0,function(){var a,i;return he(this,function(o){switch(o.label){case 0:return[4,lRe(r.data).runInContext(n)];case 1:if(a=o.sent(),a.isError)throw new Error(a.message);return[4,cRe(a.result).runInContext(n)];case 2:return i=o.sent(),[2,new be.Molecule.Coordinates(i,{label:r.label,description:"Coordinates"})]}})})})}}),CRe=Ut.BuiltIn({name:"topology-from-psf",display:{name:"PSF Topology",description:"Parse PSF string data."},from:[be.Format.Psf],to:be.Molecule.Topology})({apply:function(e){var t=this,r=e.a;return Qe.create("Create Topology",function(n){return pe(t,void 0,void 0,function(){var a;return he(this,function(i){switch(i.label){case 0:return[4,EDe(r.data).runInContext(n)];case 1:return a=i.sent(),[2,new be.Molecule.Topology(a,{label:a.label||r.label,description:"Topology"})]}})})})}});function wRe(e,t,r){return pe(this,void 0,void 0,function(){var n,a;return he(this,function(i){switch(i.label){case 0:return t.type!==be.Molecule.Topology.type?[3,2]:(n=t.data,[4,rr.trajectoryFromTopologyAndCoordinates(n,r).runInContext(e)]);case 1:return[2,i.sent()];case 2:if(t.type===be.Molecule.Model.type)return a=t.data,[2,rr.trajectoryFromModelAndCoordinates(a,r)];i.label=3;case 3:throw new Error("no model/topology found")}})})}var CY=Ut.BuiltIn({name:"trajectory-from-model-and-coordinates",display:{name:"Trajectory from Topology & Coordinates",description:"Create a trajectory from existing model/topology and coordinates."},from:be.Root,to:be.Molecule.Trajectory,params:{modelRef:M.Text("",{isHidden:!0}),coordinatesRef:M.Text("",{isHidden:!0})}})({apply:function(e){var t=this,r=e.params,n=e.dependencies;return Qe.create("Create trajectory from model/topology and coordinates",function(a){return pe(t,void 0,void 0,function(){var i,o,s;return he(this,function(u){switch(u.label){case 0:return i=n[r.coordinatesRef].data,[4,wRe(a,n[r.modelRef],i)];case 1:return o=u.sent(),s={label:"Trajectory",description:o.frameCount+" model"+(o.frameCount===1?"":"s")},[2,new be.Molecule.Trajectory(o,s)]}})})})}}),_Re=Ut.BuiltIn({name:"trajectory-from-blob",display:{name:"Parse Blob",description:"Parse format blob into a single trajectory."},from:be.Format.Blob,to:be.Molecule.Trajectory})({apply:function(e){var t=this,r=e.a;return Qe.create("Parse Format Blob",function(n){return pe(t,void 0,void 0,function(){var a,i,o,s,u,l,d,c,d,f;return he(this,function(p){switch(p.label){case 0:a=[],i=0,o=r.data,p.label=1;case 1:return i<o.length?(s=o[i],s.kind!=="cif"?[3,6]:(u=s.data.blocks[0],[4,JX(u).runInContext(n)])):[3,7];case 2:if(l=p.sent(),l.frameCount===0)throw new Error("No models found.");d=0,p.label=3;case 3:return d<l.frameCount?[4,Qe.resolveInContext(l.getFrameAtIndex(d),n)]:[3,6];case 4:c=p.sent(),a.push(c),p.label=5;case 5:return d++,[3,3];case 6:return i++,[3,1];case 7:for(d=0;d<a.length;d++)rr.TrajectoryInfo.set(a[d],{index:d,size:a.length});return f={label:"Trajectory",description:a.length+" model"+(a.length===1?"":"s")},[2,new be.Molecule.Trajectory(new cm(a),f)]}})})})}});function jd(e){var t=e.representative;return{label:""+t.entry,description:e.frameCount+" model"+(e.frameCount===1?"":"s")}}var ARe=Ut.BuiltIn({name:"trajectory-from-mmcif",display:{name:"Trajectory from mmCIF",description:"Identify and create all separate models in the specified CIF data block"},from:be.Format.Cif,to:be.Molecule.Trajectory,params:function(e){if(!e)return{blockHeader:M.Optional(M.Text(void 0,{description:"Header of the block to parse. If none is specifed, the 1st data block in the file is used."}))};var t=e.data.blocks;return{blockHeader:M.Optional(M.Select(t[0]&&t[0].header,t.map(function(r){return[r.header,r.header]}),{description:"Header of the block to parse"}))}}})({isApplicable:function(e){return e.data.blocks.length>0},apply:function(e){var t=this,r=e.a,n=e.params;return Qe.create("Parse mmCIF",function(a){return pe(t,void 0,void 0,function(){var i,o,s,u;return he(this,function(l){switch(l.label){case 0:if(i=n.blockHeader||r.data.blocks[0].header,o=r.data.blocks.find(function(c){return c.header===i}),!o)throw new Error("Data block '"+[i]+"' not found.");return[4,JX(o).runInContext(a)];case 1:if(s=l.sent(),s.frameCount===0)throw new Error("No models found.");return u=jd(s),[2,new be.Molecule.Trajectory(s,u)]}})})})}}),TRe=Ut.BuiltIn({name:"trajectory-from-pdb",display:{name:"Parse PDB",description:"Parse PDB string and create trajectory."},from:[be.Data.String],to:be.Molecule.Trajectory,params:{isPdbqt:M.Boolean(!1)}})({apply:function(e){var t=this,r=e.a,n=e.params;return Qe.create("Parse PDB",function(a){return pe(t,void 0,void 0,function(){var i,o,s;return he(this,function(u){switch(u.label){case 0:return[4,fSe(r.data,r.label,n.isPdbqt).runInContext(a)];case 1:if(i=u.sent(),i.isError)throw new Error(i.message);return[4,ADe(i.result).runInContext(a)];case 2:return o=u.sent(),s=jd(o),[2,new be.Molecule.Trajectory(o,s)]}})})})}}),ERe=Ut.BuiltIn({name:"trajectory-from-gro",display:{name:"Parse GRO",description:"Parse GRO string and create trajectory."},from:[be.Data.String],to:be.Molecule.Trajectory})({apply:function(e){var t=this,r=e.a;return Qe.create("Parse GRO",function(n){return pe(t,void 0,void 0,function(){var a,i,o;return he(this,function(s){switch(s.label){case 0:return[4,dSe(r.data).runInContext(n)];case 1:if(a=s.sent(),a.isError)throw new Error(a.message);return[4,sDe(a.result).runInContext(n)];case 2:return i=s.sent(),o=jd(i),[2,new be.Molecule.Trajectory(i,o)]}})})})}}),PRe=Ut.BuiltIn({name:"trajectory-from-xyz",display:{name:"Parse XYZ",description:"Parse XYZ string and create trajectory."},from:[be.Data.String],to:be.Molecule.Trajectory})({apply:function(e){var t=this,r=e.a;return Qe.create("Parse XYZ",function(n){return pe(t,void 0,void 0,function(){var a,i,o;return he(this,function(s){switch(s.label){case 0:return[4,pRe(r.data).runInContext(n)];case 1:if(a=s.sent(),a.isError)throw new Error(a.message);return[4,mRe(a.result).runInContext(n)];case 2:return i=s.sent(),o=jd(i),[2,new be.Molecule.Trajectory(i,o)]}})})})}}),IRe=Ut.BuiltIn({name:"trajectory-from-mol",display:{name:"Parse MOL",description:"Parse MOL string and create trajectory."},from:[be.Data.String],to:be.Molecule.Trajectory})({apply:function(e){var t=this,r=e.a;return Qe.create("Parse MOL",function(n){return pe(t,void 0,void 0,function(){var a,i,o;return he(this,function(s){switch(s.label){case 0:return[4,Vke(r.data).runInContext(n)];case 1:if(a=s.sent(),a.isError)throw new Error(a.message);return[4,bY(a.result).runInContext(n)];case 2:return i=s.sent(),o=jd(i),[2,new be.Molecule.Trajectory(i,o)]}})})})}}),MRe=Ut.BuiltIn({name:"trajectory-from-sdf",display:{name:"Parse SDF",description:"Parse SDF string and create trajectory."},from:[be.Data.String],to:be.Molecule.Trajectory})({apply:function(e){var t=this,r=e.a;return Qe.create("Parse SDF",function(n){return pe(t,void 0,void 0,function(){var a,i,o,s,u,l,c,d,f,p,h;return he(this,function(m){switch(m.label){case 0:return[4,bRe(r.data).runInContext(n)];case 1:if(a=m.sent(),a.isError)throw new Error(a.message);i=[],o=0,s=a.result.compounds,m.label=2;case 2:return o<s.length?(u=s[o].molFile,[4,bY(u).runInContext(n)]):[3,8];case 3:l=m.sent(),c=0,m.label=4;case 4:return c<l.frameCount?(f=(d=i).push,[4,Qe.resolveInContext(l.getFrameAtIndex(c),n)]):[3,7];case 5:f.apply(d,[m.sent()]),m.label=6;case 6:return c++,[3,4];case 7:return o++,[3,2];case 8:return p=new cm(i),h=jd(p),[2,new be.Molecule.Trajectory(p,h)]}})})})}}),DRe=Ut.BuiltIn({name:"trajectory-from-mol2",display:{name:"Parse MOL2",description:"Parse MOL2 string and create trajectory."},from:[be.Data.String],to:be.Molecule.Trajectory})({apply:function(e){var t=this,r=e.a;return Qe.create("Parse MOL2",function(n){return pe(t,void 0,void 0,function(){var a,i,o;return he(this,function(s){switch(s.label){case 0:return[4,aRe(r.data,r.label).runInContext(n)];case 1:if(a=s.sent(),a.isError)throw new Error(a.message);return[4,oRe(a.result).runInContext(n)];case 2:return i=s.sent(),o=jd(i),[2,new be.Molecule.Trajectory(i,o)]}})})})}}),kRe=Ut.BuiltIn({name:"trajectory-from-cube",display:{name:"Parse Cube",description:"Parse Cube file to create a trajectory."},from:be.Format.Cube,to:be.Molecule.Trajectory})({apply:function(e){var t=this,r=e.a;return Qe.create("Parse MOL",function(n){return pe(t,void 0,void 0,function(){var a,i;return he(this,function(o){switch(o.label){case 0:return[4,$ke(r.data).runInContext(n)];case 1:return a=o.sent(),i=jd(a),[2,new be.Molecule.Trajectory(a,i)]}})})})}}),RRe=Ut.BuiltIn({name:"trajectory-from-cif-core",display:{name:"Parse CIF Core",description:"Identify and create all separate models in the specified CIF data block"},from:be.Format.Cif,to:be.Molecule.Trajectory,params:function(e){if(!e)return{blockHeader:M.Optional(M.Text(void 0,{description:"Header of the block to parse. If none is specifed, the 1st data block in the file is used."}))};var t=e.data.blocks;return{blockHeader:M.Optional(M.Select(t[0]&&t[0].header,t.map(function(r){return[r.header,r.header]}),{description:"Header of the block to parse"}))}}})({apply:function(e){var t=this,r=e.a,n=e.params;return Qe.create("Parse CIF Core",function(a){return pe(t,void 0,void 0,function(){var i,o,s,u;return he(this,function(l){switch(l.label){case 0:if(i=n.blockHeader||r.data.blocks[0].header,o=r.data.blocks.find(function(c){return c.header===i}),!o)throw new Error("Data block '"+[i]+"' not found.");return[4,Yke(o).runInContext(a)];case 1:if(s=l.sent(),s.frameCount===0)throw new Error("No models found.");return u=jd(s),[2,new be.Molecule.Trajectory(s,u)]}})})})}}),ORe=function(e){return e+1},BRe=function(e){return e-1},FRe=Ut.BuiltIn({name:"model-from-trajectory",display:{name:"Molecular Model",description:"Create a molecular model from specified index in a trajectory."},from:be.Molecule.Trajectory,to:be.Molecule.Model,params:function(e){return e?{modelIndex:M.Converted(ORe,BRe,M.Numeric(1,{min:1,max:e.data.frameCount,step:1},{description:"Model Index",immediateUpdate:!0}))}:{modelIndex:M.Numeric(0,{},{description:"Zero-based index of the model",immediateUpdate:!0})}}})({isApplicable:function(e){return e.data.frameCount>0},apply:function(e){var t=this,r=e.a,n=e.params;return Qe.create("Model from Trajectory",function(a){return pe(t,void 0,void 0,function(){var i,o,s,u;return he(this,function(l){switch(l.label){case 0:return i=n.modelIndex%r.data.frameCount,i<0&&(i+=r.data.frameCount),[4,Qe.resolveInContext(r.data.getFrameAtIndex(i),a)];case 1:return o=l.sent(),s="Model "+(i+1),u=r.data.frameCount===1?void 0:"of "+r.data.frameCount,[2,new be.Molecule.Model(o,{label:s,description:u})]}})})})},interpolate:function(e,t,r){var n=r>=1?t.modelIndex:e.modelIndex+Math.floor((t.modelIndex-e.modelIndex+1)*r);return{modelIndex:n}},dispose:function(e){var t=e.b;t?.data.customProperties.dispose()}}),LRe=Ut.BuiltIn({name:"structure-from-trajectory",display:{name:"Structure from Trajectory",description:"Create a molecular structure from a trajectory."},from:be.Molecule.Trajectory,to:be.Molecule.Structure})({apply:function(e){var t=this,r=e.a;return Qe.create("Build Structure",function(n){return pe(t,void 0,void 0,function(){var a,i;return he(this,function(o){switch(o.label){case 0:return[4,$e.ofTrajectory(r.data,n)];case 1:return a=o.sent(),i={label:"Ensemble",description:$e.elementDescription(a)},[2,new be.Molecule.Structure(a,i)]}})})})},dispose:function(e){var t=e.b;t?.data.customPropertyDescriptors.dispose()}}),NRe=Ut.BuiltIn({name:"structure-from-model",display:{name:"Structure",description:"Create a molecular structure (model, assembly, or symmetry) from the specified model."},from:be.Molecule.Model,to:be.Molecule.Structure,params:function(e){return Yh.getParams(e&&e.data)}})({canAutoUpdate:function(e){var t=e.oldParams,r=e.newParams;return Yh.canAutoUpdate(t.type,r.type)},apply:function(e,t){var r=this,n=e.a,a=e.params;return Qe.create("Build Structure",function(i){return pe(r,void 0,void 0,function(){return he(this,function(o){return[2,Yh.create(t,i,n.data,a&&a.type)]})})})},update:function(e){var t=e.a,r=e.b,n=e.oldParams,a=e.newParams;return dd(n,a)?r.data.model===t.data?gt.UpdateResult.Unchanged:rr.areHierarchiesEqual(t.data,r.data.model)?(r.data=r.data.remapModel(t.data),gt.UpdateResult.Updated):gt.UpdateResult.Recreate:gt.UpdateResult.Recreate},dispose:function(e){var t=e.b;t?.data.customPropertyDescriptors.dispose()}}),V7=A(),H7=de(),j7=de(),zRe=Ut.BuiltIn({name:"transform-structure-conformation",display:{name:"Transform Conformation"},isDecorator:!0,from:be.Molecule.Structure,to:be.Molecule.Structure,params:{transform:M.MappedStatic("components",{components:M.Group({axis:M.Vec3(A.create(1,0,0)),angle:M.Numeric(0,{min:-180,max:180,step:.1}),translation:M.Vec3(A.create(0,0,0))},{isFlat:!0}),matrix:M.Group({data:M.Mat4(de.identity()),transpose:M.Boolean(!1)},{isFlat:!0})},{label:"Kind"})}})({canAutoUpdate:function(e){var t=e.newParams;return t.transform.name!=="matrix"},apply:function(e){var t=e.a,r=e.params,n=de();if(r.transform.name==="components"){var a=r.transform.params,i=a.axis,o=a.angle,s=a.translation,u=t.data.boundary.sphere.center;de.fromTranslation(H7,A.negate(V7,u)),de.fromTranslation(j7,A.add(V7,u,s));var l=de.fromRotation(de(),Math.PI/180*o,A.normalize(A(),i));de.mul3(n,j7,l,H7)}else r.transform.name==="matrix"&&(de.copy(n,r.transform.params.data),r.transform.params.transpose&&de.transpose(n,n));var c=$e.transform(t.data,n);return new be.Molecule.Structure(c,{label:t.label,description:t.description+" [Transformed]"})},dispose:function(e){var t=e.b;t?.data.customPropertyDescriptors.dispose()}}),URe=Ut.BuiltIn({name:"structure-selection-from-expression",display:{name:"Selection",description:"Create a molecular structure from the specified expression."},from:be.Molecule.Structure,to:be.Molecule.Structure,params:function(){return{expression:M.Value(ce.struct.generator.all,{isHidden:!0}),label:M.Optional(M.Text("",{isHidden:!0}))}}})({apply:function(e){var t=e.a,r=e.params,n=e.cache,a=Ki.createAndRun(t.data,r.expression),i=a.selection,o=a.entry;if(n.entry=o,St.isEmpty(i))return qn.Null;var s=St.unionStructure(i),u={label:""+(r.label||"Selection"),description:$e.elementDescription(s)};return new be.Molecule.Structure(s,u)},update:function(e){var t=e.a,r=e.b,n=e.oldParams,a=e.newParams,i=e.cache;if(n.expression!==a.expression)return gt.UpdateResult.Recreate;var o=i.entry;if(o.currentStructure===t.data)return gt.UpdateResult.Unchanged;var s=Ki.updateStructure(o,t.data);return St.isEmpty(s)?gt.UpdateResult.Null:(Ki.updateStructureObject(r,s,a.label),gt.UpdateResult.Updated)},dispose:function(e){var t=e.b;t?.data.customPropertyDescriptors.dispose()}}),VRe=Ut.BuiltIn({name:"structure-multi-selection-from-expression",display:{name:"Multi-structure Measurement Selection",description:"Create selection object from multiple structures."},from:be.Root,to:be.Molecule.Structure.Selections,params:function(){return{selections:M.ObjectList({key:M.Text(void 0,{description:"A unique key."}),ref:M.Text(),groupId:M.Optional(M.Text()),expression:M.Value(ce.struct.generator.empty)},function(e){return e.ref},{isHidden:!0}),isTransitive:M.Optional(M.Boolean(!1,{isHidden:!0,description:"Remap the selections from the original structure if structurally equivalent."})),label:M.Optional(M.Text("",{isHidden:!0}))}}})({apply:function(e){for(var t=e.params,r=e.cache,n=e.dependencies,a=new Map,i=[],o=0,s=0,u=t.selections;s<u.length;s++){var l=u[s],c=Ki.createAndRun(n[l.ref].data,l.expression),d=c.selection,f=c.entry;a.set(l.key,f);var p=St.toLociWithSourceUnits(d);i.push({key:l.key,loci:p,groupId:l.groupId}),o+=Oe.size(p)}r.entries=a;var h={label:""+(t.label||"Multi-selection"),description:t.selections.length+" source(s), "+o+" element(s) total"};return new be.Molecule.Structure.Selections(i,h)},update:function(e){var t=e.b,r=e.oldParams,n=e.newParams,a=e.cache,i=e.dependencies;if(!!r.isTransitive!=!!n.isTransitive)return gt.UpdateResult.Recreate;for(var o=a.entries,s=new Map,u=new Map,l=0,c=t.data;l<c.length;l++){var d=c[l];u.set(d.key,d)}for(var f=!1,p=0,h=[],m=0,v=n.selections;m<v.length;m++){var g=v[m],y=i[g.ref].data,b=!1;if(o.has(g.key)){var S=o.get(g.key);if(Ki.isUnchanged(S,g.expression,y)&&u.has(g.key)){var x=u.get(g.key);x.groupId!==g.groupId&&(x.groupId=g.groupId,f=!0),s.set(g.key,S),h.push(x),p+=Oe.size(x.loci);continue}if(S.expression!==g.expression)b=!0;else{var C=!1;if(n.isTransitive)if($e.areUnitIdsAndIndicesEqual(S.originalStructure,y)){var w=Ki.run(S,S.originalStructure);S.currentStructure=y,s.set(g.key,S);var x=Oe.remap(St.toLociWithSourceUnits(w),y);h.push({key:g.key,loci:x,groupId:g.groupId}),p+=Oe.size(x),f=!0}else C=!0;else C=!0;if(C){f=!0;var w=Ki.updateStructure(S,y);s.set(g.key,S);var x=St.toLociWithSourceUnits(w);h.push({key:g.key,loci:x,groupId:g.groupId}),p+=Oe.size(x)}}}else b=!0;if(b){f=!0;var _=Ki.createAndRun(y,g.expression),w=_.selection,S=_.entry;s.set(g.key,S);var x=St.toLociWithSourceUnits(w);h.push({key:g.key,loci:x}),p+=Oe.size(x)}}return f?(a.entries=s,t.data=h,t.label=""+(n.label||"Multi-selection"),t.description=h.length+" source(s), "+p+" element(s) total",gt.UpdateResult.Updated):gt.UpdateResult.Unchanged}}),HRe=Ut.BuiltIn({name:"structure-selection-from-script",display:{name:"Selection",description:"Create a molecular structure from the specified script."},from:be.Molecule.Structure,to:be.Molecule.Structure,params:function(){return{script:M.Script({language:"mol-script",expression:"(sel.atom.atom-groups :residue-test (= atom.resname ALA))"}),label:M.Optional(M.Text(""))}}})({apply:function(e){var t=e.a,r=e.params,n=e.cache,a=Ki.createAndRun(t.data,r.script),i=a.selection,o=a.entry;n.entry=o;var s=St.unionStructure(i),u={label:""+(r.label||"Selection"),description:$e.elementDescription(s)};return new be.Molecule.Structure(s,u)},update:function(e){var t=e.a,r=e.b,n=e.oldParams,a=e.newParams,i=e.cache;if(!yi.areEqual(n.script,a.script))return gt.UpdateResult.Recreate;var o=i.entry;if(o.currentStructure===t.data)return gt.UpdateResult.Unchanged;var s=Ki.updateStructure(o,t.data);return Ki.updateStructureObject(r,s,a.label),gt.UpdateResult.Updated},dispose:function(e){var t=e.b;t?.data.customPropertyDescriptors.dispose()}}),jRe=Ut.BuiltIn({name:"structure-selection-from-bundle",display:{name:"Selection",description:"Create a molecular structure from the specified structure-element bundle."},from:be.Molecule.Structure,to:be.Molecule.Structure,params:function(){return{bundle:M.Value(sn.Empty,{isHidden:!0}),label:M.Optional(M.Text("",{isHidden:!0}))}}})({apply:function(e){var t=e.a,r=e.params,n=e.cache;if(r.bundle.hash!==t.data.hashCode)return qn.Null;n.source=t.data;var a=sn.toStructure(r.bundle,t.data);if(a.elementCount===0)return qn.Null;var i={label:""+(r.label||"Selection"),description:$e.elementDescription(a)};return new be.Molecule.Structure(a,i)},update:function(e){var t=e.a,r=e.b,n=e.oldParams,a=e.newParams,i=e.cache;if(!sn.areEqual(n.bundle,a.bundle))return gt.UpdateResult.Recreate;if(a.bundle.hash!==t.data.hashCode)return gt.UpdateResult.Null;if(i.source===t.data)return gt.UpdateResult.Unchanged;i.source=t.data;var o=sn.toStructure(a.bundle,t.data);return o.elementCount===0?gt.UpdateResult.Null:(r.label=""+(a.label||"Selection"),r.description=$e.elementDescription(o),r.data=o,gt.UpdateResult.Updated)},dispose:function(e){var t=e.b;t?.data.customPropertyDescriptors.dispose()}}),wY={polymer:"polymer",protein:"protein",nucleic:"nucleic",water:"water",branched:"branched",ligand:"ligand","non-standard":"non-standard",coarse:"coarse","atomic-sequence":"atomic-sequence","atomic-het":"atomic-het",spheres:"spheres"},GRe=M.objectToOptions(wY),qRe=Ut.BuiltIn({name:"structure-complex-element",display:{name:"Complex Element",description:"Create a molecular structure from the specified model."},from:be.Molecule.Structure,to:be.Molecule.Structure,params:{type:M.Select("atomic-sequence",GRe,{isHidden:!0})}})({apply:function(e){var t=e.a,r=e.params,n,a;switch(r.type){case"polymer":n=Ea.polymer.query,a="Polymer";break;case"protein":n=Ea.protein.query,a="Protein";break;case"nucleic":n=Ea.nucleic.query,a="Nucleic";break;case"water":n=un.internal.water(),a="Water";break;case"branched":n=Ea.branchedPlusConnected.query,a="Branched";break;case"ligand":n=Ea.ligandPlusConnected.query,a="Ligand";break;case"non-standard":n=Ea.nonStandardPolymer.query,a="Non-standard";break;case"coarse":n=Ea.coarse.query,a="Coarse";break;case"atomic-sequence":n=un.internal.atomicSequence(),a="Sequence";break;case"atomic-het":n=un.internal.atomicHet(),a="HET Groups/Ligands";break;case"spheres":n=un.internal.spheres(),a="Coarse Spheres";break;default:throw new Error(r.type+" is a not valid complex element.")}var i=n(new As(t.data)),o=St.unionStructure(i);return o.elementCount===0?qn.Null:new be.Molecule.Structure(o,{label:a,description:$e.elementDescription(o)})},dispose:function(e){var t=e.b;t?.data.customPropertyDescriptors.dispose()}}),WRe=Ut.BuiltIn({name:"structure-component",display:{name:"Component",description:"A molecular structure component."},from:be.Molecule.Structure,to:be.Molecule.Structure,params:Lke})({apply:function(e){var t=e.a,r=e.params,n=e.cache;return Nke(t.data,r,n)},update:function(e){var t=e.a,r=e.b,n=e.oldParams,a=e.newParams,i=e.cache;return zke(t.data,r,n,a,i)},dispose:function(e){var t=e.b;t?.data.customPropertyDescriptors.dispose()}}),_Y=Ut.BuiltIn({name:"custom-model-properties",display:{name:"Custom Model Properties"},isDecorator:!0,from:be.Molecule.Model,to:be.Molecule.Model,params:function(e,t){return t.customModelProperties.getParams(e?.data)}})({apply:function(e,t){var r=this,n=e.a,a=e.params;return Qe.create("Custom Props",function(i){return pe(r,void 0,void 0,function(){return he(this,function(o){switch(o.label){case 0:return[4,G7(n.data,t,i,a)];case 1:return o.sent(),[2,new be.Molecule.Model(n.data,{label:n.label,description:n.description})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b,i=e.oldParams,o=e.newParams;return Qe.create("Custom Props",function(s){return pe(r,void 0,void 0,function(){var u,l,c,d;return he(this,function(f){switch(f.label){case 0:for(a.data=n.data,a.label=n.label,a.description=n.description,u=0,l=i.autoAttach;u<l.length;u++)c=l[u],d=t.customModelProperties.get(c),d&&n.data.customProperties.reference(d.descriptor,!1);return[4,G7(n.data,t,s,o)];case 1:return f.sent(),[2,gt.UpdateResult.Updated]}})})})},dispose:function(e){var t=e.b;t?.data.customProperties.dispose()}});function G7(e,t,r,n){return pe(this,void 0,void 0,function(){var a,i,o,s,u,l,c,d,f;return he(this,function(p){switch(p.label){case 0:a={runtime:r,assetManager:t.managers.asset},i=n.autoAttach,o=n.properties,s=0,u=Object.keys(o),p.label=1;case 1:if(!(s<u.length))return[3,8];if(l=u[s],c=t.customModelProperties.get(l),d=o[l],!(i.includes(l)||c.isHidden))return[3,6];p.label=2;case 2:return p.trys.push([2,4,,5]),[4,c.attach(a,e,d,!0)];case 3:return p.sent(),[3,5];case 4:return f=p.sent(),t.log.warn("Error attaching model prop '"+l+"': "+f),[3,5];case 5:return[3,7];case 6:c.set(e,d),p.label=7;case 7:return s++,[3,1];case 8:return[2]}})})}var AY=Ut.BuiltIn({name:"custom-structure-properties",display:{name:"Custom Structure Properties"},isDecorator:!0,from:be.Molecule.Structure,to:be.Molecule.Structure,params:function(e,t){return t.customStructureProperties.getParams(e?.data.root)}})({apply:function(e,t){var r=this,n=e.a,a=e.params;return Qe.create("Custom Props",function(i){return pe(r,void 0,void 0,function(){return he(this,function(o){switch(o.label){case 0:return[4,q7(n.data.root,t,i,a)];case 1:return o.sent(),[2,new be.Molecule.Structure(n.data,{label:n.label,description:n.description})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b,i=e.oldParams,o=e.newParams;return n.data!==a.data?gt.UpdateResult.Recreate:Qe.create("Custom Props",function(s){return pe(r,void 0,void 0,function(){var u,l,c,d;return he(this,function(f){switch(f.label){case 0:for(a.data=n.data,a.label=n.label,a.description=n.description,u=0,l=i.autoAttach;u<l.length;u++)c=l[u],d=t.customStructureProperties.get(c),d&&n.data.customPropertyDescriptors.reference(d.descriptor,!1);return[4,q7(n.data.root,t,s,o)];case 1:return f.sent(),[2,gt.UpdateResult.Updated]}})})})},dispose:function(e){var t=e.b;t?.data.customPropertyDescriptors.dispose()}});function q7(e,t,r,n){return pe(this,void 0,void 0,function(){var a,i,o,s,u,l,c,d,f;return he(this,function(p){switch(p.label){case 0:a={runtime:r,assetManager:t.managers.asset},i=n.autoAttach,o=n.properties,s=0,u=Object.keys(o),p.label=1;case 1:if(!(s<u.length))return[3,8];if(l=u[s],c=t.customStructureProperties.get(l),d=o[l],!(i.includes(l)||c.isHidden))return[3,6];p.label=2;case 2:return p.trys.push([2,4,,5]),[4,c.attach(a,e,d,!0)];case 3:return p.sent(),[3,5];case 4:return f=p.sent(),t.log.warn("Error attaching structure prop '"+l+"': "+f),[3,5];case 5:return[3,7];case 6:c.set(e,d),p.label=7;case 7:return s++,[3,1];case 8:return[2]}})})}var XRe=Ut.BuiltIn({name:"shape-from-ply",display:{name:"Shape from PLY",description:"Create Shape from PLY data"},from:be.Format.Ply,to:be.Shape.Provider,params:function(e){return{}}})({apply:function(e){var t=this,r=e.a;return e.params,Qe.create("Create shape from PLY",function(n){return pe(t,void 0,void 0,function(){var a,i;return he(this,function(o){switch(o.label){case 0:return[4,pTe(r.data).runInContext(n)];case 1:return a=o.sent(),i={label:"Shape"},[2,new be.Shape.Provider(a,i)]}})})})}}),YRe=Object.freeze({__proto__:null,CoordinatesFromDcd:xRe,CoordinatesFromXtc:SRe,TopologyFromPsf:CRe,TrajectoryFromModelAndCoordinates:CY,TrajectoryFromBlob:_Re,TrajectoryFromMmCif:ARe,TrajectoryFromPDB:TRe,TrajectoryFromGRO:ERe,TrajectoryFromXYZ:PRe,TrajectoryFromMOL:IRe,TrajectoryFromSDF:MRe,TrajectoryFromMOL2:DRe,TrajectoryFromCube:kRe,TrajectoryFromCifCore:RRe,ModelFromTrajectory:FRe,StructureFromTrajectory:LRe,StructureFromModel:NRe,TransformStructureConformation:zRe,StructureSelectionFromExpression:URe,MultiStructureSelectionFromExpression:VRe,StructureSelectionFromScript:HRe,StructureSelectionFromBundle:jRe,StructureComplexElement:qRe,StructureComponent:WRe,CustomModelProperties:_Y,CustomStructureProperties:AY,ShapeFromPly:XRe,StructureComplexElementTypes:wY});function KRe(e){return e.originX===0&&e.originY===0&&e.originZ===0?A.create(e.NCSTART,e.NRSTART,e.NSSTART):A.create(e.originX/(e.xLength/e.NX),e.originY/(e.yLength/e.NY),e.originZ/(e.zLength/e.NZ))}function $Re(e){var t=Qq(e);switch(t){case Ii.Float32:return Float32Array;case Ii.Int8:return Int8Array;case Ii.Int16:return Int16Array;case Ii.Uint16:return Uint16Array}throw Error(t+" is not a supported value format.")}function QRe(e,t){var r=this;return Qe.create("Create Volume",function(n){return pe(r,void 0,void 0,function(){var a,i,o,s,u,l,c,d,f,p,h,m,v,g,y,b,S;return he(this,function(x){return a=e.header,i=e.values,o=A.create(a.xLength,a.yLength,a.zLength),t&&t.voxelSize&&A.mul(o,o,t.voxelSize),s=A.create(rn(a.alpha),rn(a.beta),rn(a.gamma)),u=a.ISPG>65536?0:a.ISPG,l=Go.create(u||"P 1",o,s),c=A.create(a.MAPC-1,a.MAPR-1,a.MAPS-1),d=Rr.convertToCanonicalAxisIndicesFastToSlow(c),f=[a.NX,a.NY,a.NZ],p=d([a.NC,a.NR,a.NS]),h=KRe(a),t?.offset&&A.add(h,h,t.offset),m=d(h),v=A.create(m[0]/f[0],m[1]/f[1],m[2]/f[2]),g=A.create(p[0]/f[0],p[1]/f[1],p[2]/f[2]),y=Rr.Space(p,Rr.invertAxisOrder(c),$Re(a)),b=Rr.create(y,Rr.Data1(i)),S=a.AMIN===0&&a.AMAX===0&&a.AMEAN===0&&a.ARMS===0,[2,{label:t?.label,entryId:t?.entryId,grid:{transform:{kind:"spacegroup",cell:l,fractionalBox:tr.create(v,A.add(A.zero(),v,g))},cells:b,stats:{min:isNaN(a.AMIN)||S?Uw(i):a.AMIN,max:isNaN(a.AMAX)||S?nc(i):a.AMAX,mean:isNaN(a.AMEAN)||S?Vw(i):a.AMEAN,sigma:isNaN(a.ARMS)||a.ARMS===0?Hw(i):a.ARMS}},sourceData:z5.create(e),customProperties:new fc,_propertyData:Object.create(null)}]})})})}var z5;(function(e){function t(n){return n?.kind==="ccp4"}e.is=t;function r(n){return{kind:"ccp4",name:n.name,data:n}}e.create=r})(z5||(z5={}));function TY(e,t){var r=this;return Qe.create("Create Volume",function(n){return pe(r,void 0,void 0,function(){var a,i,o,s,u,l,c,d,f,p;return he(this,function(h){return a=e.volume_data_3d_info,i=e.volume_data_3d,o=Go.create(a.spacegroup_number.value(0),A.ofArray(a.spacegroup_cell_size.value(0)),A.scale(A.zero(),A.ofArray(a.spacegroup_cell_angles.value(0)),Math.PI/180)),s=a.axis_order.value(0),u=Rr.convertToCanonicalAxisIndicesFastToSlow(s),l=u(a.sample_count.value(0)),c=Rr.Space(l,Rr.invertAxisOrder(s),Float32Array),d=Rr.create(c,Rr.Data1(i.values.toArray({array:Float32Array}))),f=A.ofArray(u(a.origin.value(0))),p=A.ofArray(u(a.dimensions.value(0))),[2,{label:t?.label,entryId:t?.entryId,grid:{transform:{kind:"spacegroup",cell:o,fractionalBox:tr.create(f,A.add(A.zero(),f,p))},cells:d,stats:{min:a.min_sampled.value(0),max:a.max_sampled.value(0),mean:a.mean_sampled.value(0),sigma:a.sigma_sampled.value(0)}},sourceData:$C.create(e),customProperties:new fc,_propertyData:Object.create(null)}]})})})}var $C;(function(e){function t(n){return n?.kind==="dscif"}e.is=t;function r(n){return{kind:"dscif",name:n._name,data:n}}e.create=r})($C||($C={}));function ZRe(e,t){var r=this;return Qe.create("Create Volume",function(n){return pe(r,void 0,void 0,function(){var a,i,o,s,u,l,c,d,f,p,h,m;return he(this,function(v){return a=e.header,i=e.values,o=A.create(a.xlen,a.ylen,a.zlen),t&&t.voxelSize&&A.mul(o,o,t.voxelSize),s=A.create(rn(a.alpha),rn(a.beta),rn(a.gamma)),u=Go.create("P 1",o,s),l=[a.xRate,a.yRate,a.zRate],c=[a.xExtent,a.yExtent,a.zExtent],d=[a.xStart,a.yStart,a.zStart],f=A.create(d[0]/l[0],d[1]/l[1],d[2]/l[2]),p=A.create(c[0]/l[0],c[1]/l[1],c[2]/l[2]),h=Rr.Space(c,[0,1,2],Float32Array),m=Rr.create(h,Rr.Data1(i)),[2,{label:t?.label,entryId:t?.entryId,grid:{transform:{kind:"spacegroup",cell:u,fractionalBox:tr.create(f,A.add(A.zero(),f,p))},cells:m,stats:{min:Uw(i),max:nc(i),mean:Vw(i),sigma:a.sigma!==void 0?a.sigma:Hw(i)}},sourceData:U5.create(e),customProperties:new fc,_propertyData:Object.create(null)}]})})})}var U5;(function(e){function t(n){return n?.kind==="dsn6"}e.is=t;function r(n){return{kind:"dsn6",name:n.name,data:n}}e.create=r})(U5||(U5={}));function JRe(e,t){var r=this;return Qe.create("Create Volume",function(){return pe(r,void 0,void 0,function(){var n,a,i,o,s,u;return he(this,function(l){return n=e.header,a=e.values,i=Rr.Space(n.dim,[0,1,2],Float64Array),o=Rr.create(i,Rr.Data1(a)),s=de.fromTranslation(de(),n.min),u=de.fromScaling(de(),n.h),de.mul(s,s,u),[2,{label:t?.label,entryId:t?.entryId,grid:{transform:{kind:"matrix",matrix:s},cells:o,stats:{min:Uw(a),max:nc(a),mean:Vw(a),sigma:Hw(a)}},sourceData:V5.create(e),customProperties:new fc,_propertyData:Object.create(null)}]})})})}var V5;(function(e){function t(n){return n?.kind==="dx"}e.is=t;function r(n){return{kind:"dx",name:n.name,data:n}}e.create=r})(V5||(V5={}));var e6e=Ut.BuiltIn({name:"volume-from-ccp4",display:{name:"Volume from CCP4/MRC/MAP",description:"Create Volume from CCP4/MRC/MAP data"},from:be.Format.Ccp4,to:be.Volume.Data,params:function(e){return{voxelSize:M.Vec3(A.create(1,1,1)),offset:M.Vec3(A.create(0,0,0)),entryId:M.Text("")}}})({apply:function(e){var t=this,r=e.a,n=e.params;return Qe.create("Create volume from CCP4/MRC/MAP",function(a){return pe(t,void 0,void 0,function(){var i,o;return he(this,function(s){switch(s.label){case 0:return[4,QRe(r.data,T(T({},n),{label:r.data.name||r.label})).runInContext(a)];case 1:return i=s.sent(),o={label:i.label||"Volume",description:"Volume "+r.data.header.NX+"\xD7"+r.data.header.NX+"\xD7"+r.data.header.NX},[2,new be.Volume.Data(i,o)]}})})})},dispose:function(e){var t=e.b;t?.data.customProperties.dispose()}}),t6e=Ut.BuiltIn({name:"volume-from-dsn6",display:{name:"Volume from DSN6/BRIX",description:"Create Volume from DSN6/BRIX data"},from:be.Format.Dsn6,to:be.Volume.Data,params:function(e){return{voxelSize:M.Vec3(A.create(1,1,1)),entryId:M.Text("")}}})({apply:function(e){var t=this,r=e.a,n=e.params;return Qe.create("Create volume from DSN6/BRIX",function(a){return pe(t,void 0,void 0,function(){var i,o;return he(this,function(s){switch(s.label){case 0:return[4,ZRe(r.data,T(T({},n),{label:r.data.name||r.label})).runInContext(a)];case 1:return i=s.sent(),o={label:i.label||"Volume",description:"Volume "+r.data.header.xExtent+"\xD7"+r.data.header.yExtent+"\xD7"+r.data.header.zExtent},[2,new be.Volume.Data(i,o)]}})})})},dispose:function(e){var t=e.b;t?.data.customProperties.dispose()}}),r6e=Ut.BuiltIn({name:"volume-from-cube",display:{name:"Volume from Cube",description:"Create Volume from Cube data"},from:be.Format.Cube,to:be.Volume.Data,params:function(e){var t=e?M.Select(0,e.data.header.dataSetIds.map(function(r,n){return[n,""+r]})):M.Numeric(0);return{dataIndex:t,entryId:M.Text("")}}})({apply:function(e){var t=this,r=e.a,n=e.params;return Qe.create("Create volume from Cube",function(a){return pe(t,void 0,void 0,function(){var i,o;return he(this,function(s){switch(s.label){case 0:return[4,Q3e(r.data,T(T({},n),{label:r.data.name||r.label})).runInContext(a)];case 1:return i=s.sent(),o={label:i.label||"Volume",description:"Volume "+r.data.header.dim[0]+"\xD7"+r.data.header.dim[1]+"\xD7"+r.data.header.dim[2]},[2,new be.Volume.Data(i,o)]}})})})},dispose:function(e){var t=e.b;t?.data.customProperties.dispose()}}),n6e=Ut.BuiltIn({name:"volume-from-dx",display:{name:"Parse DX",description:"Create volume from DX data."},from:be.Format.Dx,to:be.Volume.Data})({apply:function(e){var t=this,r=e.a;return Qe.create("Parse DX",function(n){return pe(t,void 0,void 0,function(){var a,i;return he(this,function(o){switch(o.label){case 0:return[4,JRe(r.data,{label:r.data.name||r.label}).runInContext(n)];case 1:return a=o.sent(),i={label:a.label||"Volume",description:"Volume "+r.data.header.dim[0]+"\xD7"+r.data.header.dim[1]+"\xD7"+r.data.header.dim[2]},[2,new be.Volume.Data(a,i)]}})})})},dispose:function(e){var t=e.b;t?.data.customProperties.dispose()}}),a6e=Ut.BuiltIn({name:"volume-from-density-server-cif",display:{name:"Volume from density-server CIF",description:"Identify and create all separate models in the specified CIF data block"},from:be.Format.Cif,to:be.Volume.Data,params:function(e){if(!e)return{blockHeader:M.Optional(M.Text(void 0,{description:"Header of the block to parse. If none is specifed, the 1st data block in the file is used."})),entryId:M.Text("")};var t=e.data.blocks.slice(1);return{blockHeader:M.Optional(M.Select(t[0]&&t[0].header,t.map(function(r){return[r.header,r.header]}),{description:"Header of the block to parse"})),entryId:M.Text("")}}})({isApplicable:function(e){return e.data.blocks.length>0},apply:function(e){var t=this,r=e.a,n=e.params;return Qe.create("Parse density-server CIF",function(a){return pe(t,void 0,void 0,function(){var i,o,s,u,l,c,d,f,p,h;return he(this,function(m){switch(m.label){case 0:if(i=n.blockHeader||r.data.blocks[1].header,o=r.data.blocks.find(function(v){return v.header===i}),!o)throw new Error("Data block '"+[i]+"' not found.");return s=md.schema.densityServer(o),[4,TY(s,{entryId:n.entryId}).runInContext(a)];case 1:return u=m.sent(),l=u.grid.cells.space.dimensions,c=l[0],d=l[1],f=l[2],p={label:(h=n.entryId)!==null&&h!==void 0?h:s.volume_data_3d_info.name.value(0),description:"Volume "+c+"\xD7"+d+"\xD7"+f},[2,new be.Volume.Data(u,p)]}})})})},dispose:function(e){var t=e.b;t?.data.customProperties.dispose()}}),i6e=Ut.BuiltIn({name:"assign-color-volume",display:{name:"Assign Color Volume",description:"Assigns another volume to be available for coloring."},from:be.Volume.Data,to:be.Volume.Data,isDecorator:!0,params:function(e,t){if(!e)return{ref:M.Text()};var r=t.state.data.select(lr.Generators.root.subtree().ofType(be.Volume.Data).filter(function(n){var a;return!!n.obj&&!(!((a=n.obj)===null||a===void 0)&&a.data.colorVolume)&&n.obj!==e}));return r.length===0?{ref:M.Text("",{isHidden:!0})}:{ref:M.Select(r[0].transform.ref,r.map(function(n){return[n.transform.ref,n.obj.label]}))}}})({apply:function(e){var t=this,r=e.a,n=e.params,a=e.dependencies;return Qe.create("Assign Color Volume",function(i){return pe(t,void 0,void 0,function(){var o,s,u;return he(this,function(l){if(!a||!a[n.ref])throw new Error("Dependency not available.");return o=a[n.ref].data,s=T(T({},r.data),{colorVolume:o}),u={label:r.label,description:"Volume + Colors"},[2,new be.Volume.Data(s,u)]})})})}}),o6e=Object.freeze({__proto__:null,VolumeFromCcp4:e6e,VolumeFromDsn6:t6e,VolumeFromCube:r6e,VolumeFromDx:n6e,AssignColorVolume:i6e,VolumeFromDensityServerCif:a6e}),ex=vt(13421772),s6e="Assigns colors according to the Symbol Nomenclature for Glycans (SNFG).",EY={};function u6e(e){return EY}function PY(e,t){var r;if(e.structure){var n=e.structure.carbohydrates,a=n.elements,i=n.getElementIndices,o=function(s,u){if(!We.isAtomic(s))return ex;var l=i(s,u);return l.length>0?a[l[0]].component.color:ex};r=function(s,u){return u?Lt.Secondary:ot.is(s)?o(s.unit,s.element):$t.isLocation(s)?o(s.aUnit,s.aUnit.elements[s.aIndex]):ex}}else r=function(){return ex};return{factory:PY,granularity:"group",color:r,props:t,description:s6e,legend:Dp(xTe)}}var l6e={name:"carbohydrate-symbol",label:"Carbohydrate Symbol",category:"Residue Property",factory:PY,getParams:u6e,defaultValues:M.getDefaultValues(EY),isApplicable:function(e){return!!e.structure&&e.structure.models.some(function(t){return rr.hasCarbohydrate(t)})}},IY={hue:M.Interval([1,360],{min:0,max:360,step:1}),chroma:M.Interval([40,70],{min:0,max:100,step:1}),luminance:M.Interval([15,85],{min:0,max:100,step:1}),clusteringStepCount:M.Numeric(50,{min:10,max:200,step:1},{isHidden:!0}),minSampleCount:M.Numeric(800,{min:100,max:5e3,step:100},{isHidden:!0})};function MY(e,t){return Math.sqrt(Math.pow(Math.abs(e[0]-t[0]),2)+Math.pow(Math.abs(e[1]-t[1]),2)+Math.pow(Math.abs(e[2]-t[2]),2))}var tv=2,Zp=[0,0,0],Jp=[0,0,0];function c6e(e,t){return gi.toHcl(Zp,e),gi.fromColor(Jp,gi.toColor(e)),Zp[0]>=t.hue[0]&&Zp[0]<=t.hue[1]&&Zp[1]>=t.chroma[0]&&Zp[1]<=t.chroma[1]&&Zp[2]>=t.luminance[0]&&Zp[2]<=t.luminance[1]&&Jp[0]>=e[0]-tv&&Jp[0]<=e[0]+tv&&Jp[1]>=e[1]-tv&&Jp[1]<=e[1]+tv&&Jp[2]>=e[2]-tv&&Jp[2]<=e[2]+tv}function d6e(e){for(var t=e.slice(0),r=[t.shift()];t.length>0;){for(var n=r[r.length-1],a=0,i=Number.MIN_SAFE_INTEGER,o=0;o<t.length;++o){var s=MY(n,t[o]);s>i&&(i=s,a=o)}r.push(t.splice(a,1)[0])}return r}function f6e(e,t){for(var r=new Map,n=Math.cbrt(e)*1.001,a=(t.hue[1]-t.hue[0])/n,i=(t.chroma[1]-t.chroma[0])/n,o=(t.luminance[1]-t.luminance[0])/n,s=t.hue[0];s<=t.hue[1];s+=a)for(var u=t.chroma[0];u<=t.chroma[1];u+=i)for(var l=t.luminance[0];l<=t.luminance[1];l+=o){var c=gi.fromHcl(gi(),tc.create(s,u,l));c6e(c,t)&&r.set(c.toString(),c)}return Array.from(r.values())}function p6e(e,t){t===void 0&&(t={});var r=T(T({},M.getDefaultValues(IY)),t);if(e<=0)return[];var n=f6e(Math.max(r.minSampleCount,e*5),r);if(n.length<e)throw new Error("Not enough samples to generate distinct colors, increase sample count.");for(var a=[],i=[],o=Math.floor(n.length/e),s=0;s<n.length&&(a.push(n[s]),i.push([]),!(a.length>=e));s+=o);for(var u=1;u<=r.clusteringStepCount;++u){for(var l=mp(i),s=0;s<n.length;++s){for(var c=Number.MAX_SAFE_INTEGER,d=0,f=0;f<a.length;f++){var p=MY(n[s],a[f]);p<c&&(c=p,d=f)}l[d].push(n[s])}for(var h=mp(a),s=0;s<l.length;++s){for(var m=l[s],v=m.length,g=[],y=[],b=[],S=0,x=m;S<x.length;S++){var C=x[S];g.push(C[0]),y.push(C[1]),b.push(C[2])}var w=Ly(g)/v,_=Ly(y)/v,E=Ly(b)/v;a[s]=[w,_,E]}if(dd(h,a))break}return d6e(a).map(function(P){return gi.toColor(P)})}var DY={type:"generate",colorList:"red-yellow-blue"};function ks(e){e===void 0&&(e={});var t=T(T({},DY),e);return{palette:M.MappedStatic(t.type,{colors:M.Group({list:M.ColorList(t.colorList)},{isFlat:!0}),generate:M.Group(T(T({},IY),{maxCount:M.Numeric(75,{min:1,max:250,step:1})}),{isFlat:!0})},{options:[["colors","Color List"],["generate","Generate Distinct"]]})}}M.getDefaultValues(ks());var W7={valueLabel:function(e){return""+(e+1)},minLabel:"Start",maxLabel:"End"};function Su(e,t,r){var n;r===void 0&&(r={});var a,i;if(t.palette.name==="colors"&&t.palette.params.list.kind==="interpolate"){var o=t.palette.params.list,s=[0,e-1],u=T(T({},W7),r),l=u.minLabel,c=u.maxLabel,d=o.colors;d.length===0&&(d=fu(DY.colorList).list);var f=nl.create({listOrName:d,domain:s,minLabel:l,maxLabel:c});i=f.legend,a=f.color}else{var p;t.palette.name==="colors"?(p=t.palette.params.list.colors.map(function(b){return Array.isArray(b)?b[0]:b}),p.length===0&&(p=fu("dark-2").list.map(function(b){return Array.isArray(b)?b[0]:b}))):(e=Math.min(e,t.palette.params.maxCount),p=p6e(e,t.palette.params));for(var h=(n=r.valueLabel)!==null&&n!==void 0?n:W7.valueLabel,m=p.length,v=[],g=0;g<e;++g){var y=g%m;v[y]===void 0?v[y]=[h(g),p[y]]:v[y][0]+=", "+h(g)}i=Dp(v),a=function(b){return p[b%m]}}return{color:a,legend:i}}var h6e="many-distinct",X7=vt(16448250),m6e="Gives every chain a color based on its `asym_id` value.",c_=T({asymId:M.Select("auth",M.arrayToOptions(["auth","label"]))},ks({type:"colors",colorList:h6e}));function v6e(e){var t,r=M.clone(c_);return!((t=e.structure)===null||t===void 0)&&t.models.some(function(n){return n.coarseHierarchy.isDefined})&&(r.asymId.defaultValue="label"),r}function g6e(e,t){switch(e.kind){case 0:return t==="auth"?mt.chain.auth_asym_id:mt.chain.label_asym_id;case 1:case 2:return mt.coarse.asym_id}}function Y7(e,t){var r=g6e(e.unit,t)(e);return e.structure.root.models.length>1?kY(e.unit.model,r):r}function kY(e,t){return t+"|"+((rr.Index.get(e).value||0)+1)}function y6e(e,t){for(var r=new Map,n=function(s){var u=rr.AsymIdOffset.get(s).value,l=(t==="auth"?u?.auth:u?.label)||0,c=0;s.properties.structAsymMap.forEach(function(d,f){var p=d.auth_id,h=t==="auth"?p:f,m=e.models.length>1?kY(s,h):h;r.has(m)||(r.set(m,c+l),++c)})},a=0,i=e.models;a<i.length;a++){var o=i[a];n(o)}return r}function d_(e,t){var r,n;if(e.structure){var a=ot.create(e.structure.root),i=y6e(e.structure.root,t.asymId),o=Array.from(i.keys()),s=function(l){return o[l]},u=Su(i.size,t,{valueLabel:s});n=u.legend,r=function(l){var c=void 0;if(ot.is(l)){var d=Y7(l,t.asymId);c=i.get(d)}else if($t.isLocation(l)){a.unit=l.aUnit,a.element=l.aUnit.elements[l.aIndex];var d=Y7(a,t.asymId);c=i.get(d)}return c===void 0?X7:u.color(c)}}else r=function(){return X7};return{factory:d_,granularity:"group",color:r,props:t,description:m6e,legend:n}}var RY={name:"chain-id",label:"Chain Id",category:"Chain Property",factory:d_,getParams:v6e,defaultValues:M.getDefaultValues(c_),isApplicable:function(e){return!!e.structure}},K7=vt(13421772),b6e="Gives every element (atom or coarse sphere/gaussian) a unique color based on the position (index) of the element in the list of elements in the structure.",OY=T({},ks({type:"colors",colorList:"red-yellow-blue"}));function x6e(e){return OY}function BY(e,t){var r,n;if(e.structure){for(var a=e.structure.root.units,i=a.length,o=new Map,s=new Map,u=0,l=0;l<i;++l)o.set(l,u),u+=a[l].elements.length,s.set(a[l].id,l);var c=Su(u,t);n=c.legend,r=function(d){if(ot.is(d)){var f=s.get(d.unit.id),p=Ne.findPredecessorIndex(a[f].elements,d.element);return c.color(o.get(f)+p)}else if($t.isLocation(d)){var f=s.get(d.aUnit.id),p=Ne.findPredecessorIndex(a[f].elements,d.aUnit.elements[d.aIndex]);return c.color(o.get(f)+p)}return K7}}else r=function(){return K7};return{factory:BY,granularity:"groupInstance",preferSmoothing:!0,color:r,props:t,description:b6e,legend:n}}var S6e={name:"element-index",label:"Element Index",category:"Atom Property",factory:BY,getParams:x6e,defaultValues:M.getDefaultValues(OY),isApplicable:function(e){return!!e.structure}},C6e="many-distinct",$7=vt(13421772),w6e="Assigns a color based on the operator name of a transformed chain.",Nk=T({},ks({type:"colors",colorList:C6e}));function _6e(e){var t=M.clone(Nk);return t}function A6e(e){for(var t=new Map,r=0,n=e.units.length;r<n;++r){var a=e.units[r].conformation.operator.name;t.has(a)||t.set(a,t.size)}return t}function zk(e,t){var r,n;if(e.structure){var a=A6e(e.structure.root),i=Array.from(a.keys()),o=function(u){return i[u]},s=Su(a.size,t,{valueLabel:o});n=s.legend,r=function(u){var l=void 0;if(ot.is(u)){var c=u.unit.conformation.operator.name;l=a.get(c)}else if($t.isLocation(u)){var d=u.aUnit.conformation.operator.name;l=a.get(d)}return l===void 0?$7:s.color(l)}}else r=function(){return $7};return{factory:zk,granularity:"instance",color:r,props:t,description:w6e,legend:n}}var Uk={name:"operator-name",label:"Operator Name",category:"Symmetry",factory:zk,getParams:_6e,defaultValues:M.getDefaultValues(Nk),isApplicable:function(e){return!!e.structure}},KA={H:16777215,D:16777152,T:16777120,HE:14286847,LI:13402367,BE:12779264,B:16758197,C:9474192,N:3166456,O:16715021,F:9494608,NE:11789301,NA:11230450,MG:9109248,AL:12560038,SI:1578e4,P:16744448,S:16777008,CL:2093087,AR:8442339,K:9388244,CA:4062976,SC:15132390,TI:12567239,V:10921643,CR:9083335,MN:10255047,FE:14706227,CO:15765664,NI:5296208,CU:13140019,ZN:8224944,GA:12750735,GE:6721423,AS:12419299,SE:16752896,BR:10889513,KR:6076625,RB:7351984,SR:65280,Y:9764863,ZR:9756896,NB:7586505,MO:5551541,TC:3907230,RU:2396047,RH:687500,PD:27013,AG:12632256,CD:16767375,IN:10909043,SN:6717568,SB:10380213,TE:13924864,I:9699476,XE:9699476,CS:5707663,BA:51456,LA:7394559,CE:16777159,PR:14286791,ND:13107143,PM:10747847,SM:9437127,EU:6422471,GD:4587463,TB:3211207,DY:2097095,HO:65436,ER:58997,TM:54354,YB:48952,LU:43812,HF:5096191,TA:5089023,W:2200790,RE:2522539,OS:2516630,IR:1528967,PT:13684960,AU:16765219,HG:12105936,TL:10900557,PB:5724513,BI:10375093,PO:11230208,AT:7688005,RN:4358806,FR:4325478,RA:32e3,AC:7384058,TH:47871,PA:41471,U:36863,NP:33023,PU:27647,AM:5528818,CM:7888099,BK:9064419,CF:10565332,ES:11739092,FM:11739066,MD:11734438,NO:12389767,LR:13041766,RF:13369433,DB:13697103,SG:14221381,BH:14680120,HS:15073326,MT:15400998,DS:16777215,RG:16777215,CN:16777215,UUT:16777215,FL:16777215,UUP:16777215,LV:16777215,UUH:16777215},FY=vt(16777215),T6e="Assigns a color to every atom according to its chemical element.",LY={carbonColor:M.MappedStatic("chain-id",{"chain-id":M.Group(T({},c_)),"operator-name":M.Group(T({},Nk)),"element-symbol":M.Group({})},{description:"Use chain-id coloring for carbon atoms."}),saturation:M.Numeric(0,{min:-6,max:6,step:.1}),lightness:M.Numeric(.2,{min:-6,max:6,step:.1})};function E6e(e){return LY}function P6e(e,t){var r=e[t];return r===void 0?FY:r}function NY(e,t){var r=zw(KA,t.saturation,t.lightness),n=t.carbonColor.name==="chain-id"?d_(e,t.carbonColor.params).color:t.carbonColor.name==="operator-name"?zk(e,t.carbonColor.params).color:void 0;function a(s,u){return n&&s==="C"?n(u,!1):P6e(r,s)}function i(s){if(ot.is(s)){if(We.isAtomic(s.unit)){var u=s.unit.model.atomicHierarchy.atoms.type_symbol;return a(u.value(s.element),s)}}else if($t.isLocation(s)&&We.isAtomic(s.aUnit)){var u=s.aUnit.model.atomicHierarchy.atoms.type_symbol,l=u.value(s.aUnit.elements[s.aIndex]);return a(l,s)}return FY}var o=t.carbonColor.name==="operator-name"?"groupInstance":"group";return{factory:NY,granularity:o,preferSmoothing:!0,color:i,props:t,description:T6e,legend:Dp(Object.keys(KA).map(function(s){return[s,KA[s]]}))}}var I6e={name:"element-symbol",label:"Element Symbol",category:"Atom Property",factory:NY,getParams:E6e,defaultValues:M.getDefaultValues(LY),isApplicable:function(e){return!!e.structure}},$A={water:3697840,ion:15729279,protein:12496596,RNA:16629894,DNA:12540695,PNA:4367514,saccharide:8374655},H5=vt(16777113),M6e="Assigns a color based on the molecule type of a residue.",zY={saturation:M.Numeric(0,{min:-6,max:6,step:.1}),lightness:M.Numeric(0,{min:-6,max:6,step:.1})};function D6e(e){return zY}function Q7(e,t,r){var n=Mk(t,r);switch(n){case 2:return e.water;case 3:return e.ion;case 5:return e.protein;case 6:return e.RNA;case 7:return e.DNA;case 8:return e.PNA;case 9:return e.saccharide}return H5}function UY(e,t){var r=zw($A,t.saturation,t.lightness);function n(a){return ot.is(a)?Q7(r,a.unit,a.element):$t.isLocation(a)?Q7(r,a.aUnit,a.aUnit.elements[a.aIndex]):H5}return{factory:UY,granularity:"group",color:n,props:t,description:M6e,legend:Dp(Object.keys($A).map(function(a){return[a,$A[a]]}).concat([["Other/unknown",H5]]))}}var k6e={name:"molecule-type",label:"Molecule Type",category:"Residue Property",factory:UY,getParams:D6e,defaultValues:M.getDefaultValues(zY),isApplicable:function(e){return!!e.structure}},j5="dark-2",Z7=vt(16448250),R6e="Gives every polymer chain a color based on its `asym_id` value.",VY=T({},ks({type:"colors",colorList:j5}));function O6e(e){var t=M.clone(VY);return e.structure&&HY(e.structure.root).size>Vo[j5].list.length&&(t.palette.defaultValue.name="colors",t.palette.defaultValue.params=T(T({},t.palette.defaultValue.params),{list:{kind:"interpolate",colors:fu(j5).list}})),t}function J7(e){switch(e.kind){case 0:return mt.chain.label_asym_id;case 1:case 2:return mt.coarse.asym_id}}function HY(e){for(var t=new Map,r=0,n=e.unitSymmetryGroups.length;r<n;++r){var a=e.unitSymmetryGroups[r].units[0],i=a.model;if(We.isAtomic(a))for(var o=i.atomicHierarchy,s=o.chainAtomSegments,u=o.chains,l=pr.transientSegments(s,a.elements);l.hasNext;){var c=l.move().index,d=u.label_entity_id.value(c),f=i.entities.getEntityIndex(d);if(i.entities.data.type.value(f)==="polymer"){var p=u.label_asym_id.value(c);t.has(p)||t.set(p,t.size)}}else if(We.isCoarse(a))for(var h=We.isSpheres(a)?i.coarseHierarchy.spheres:i.coarseHierarchy.gaussians,m=h.chainElementSegments,v=h.asym_id,g=h.entity_id,l=pr.transientSegments(m,a.elements);l.hasNext;){var c=l.move().index,y=m.offsets[c],d=g.value(y),f=i.entities.getEntityIndex(d);if(i.entities.data.type.value(f)==="polymer"){var p=v.value(y);t.has(p)||t.set(p,t.size)}}}return t}function jY(e,t){var r,n;if(e.structure){var a=ot.create(e.structure),i=HY(e.structure.root),o=Array.from(i.keys()),s=function(l){return o[l]},u=Su(i.size,t,{valueLabel:s});n=u.legend,r=function(l){var c=void 0;if(ot.is(l)){var d=J7(l.unit);c=i.get(d(l))}else if($t.isLocation(l)){var d=J7(l.aUnit);a.unit=l.aUnit,a.element=l.aUnit.elements[l.aIndex],c=i.get(d(a))}return c===void 0?Z7:u.color(c)}}else r=function(){return Z7};return{factory:jY,granularity:"group",color:r,props:t,description:R6e,legend:n}}var B6e={name:"polymer-id",label:"Polymer Chain Id",category:"Chain Property",factory:jY,getParams:O6e,defaultValues:M.getDefaultValues(VY),isApplicable:function(e){return!!e.structure}},G5="dark-2",e9=vt(13421772),F6e="Gives every polymer chain instance a unique color based on the position (index) of the polymer in the list of polymers in the structure.",GY=T({},ks({type:"colors",colorList:G5}));function L6e(e){var t=M.clone(GY);return e.structure&&qY(e.structure.root)>Vo[G5].list.length&&(t.palette.defaultValue.name="colors",t.palette.defaultValue.params=T(T({},t.palette.defaultValue.params),{list:{kind:"interpolate",colors:fu(G5).list}})),t}function qY(e){for(var t=0,r=e.units,n=0,a=r.length;n<a;++n)r[n].polymerElements.length>0&&++t;return t}function WY(e,t){var r,n;if(e.structure){var a=Su(qY(e.structure.root),t);n=a.legend;for(var i=e.structure.root.units,o=new Map,s=0,u=0,l=i.length;s<l;++s)i[s].polymerElements.length>0&&(o.set(i[s].id,a.color(u)),++u);r=function(c){var d;return ot.is(c)?d=o.get(c.unit.id):$t.isLocation(c)&&(d=o.get(c.aUnit.id)),d!==void 0?d:e9}}else r=function(){return e9};return{factory:WY,granularity:"instance",color:r,props:t,description:F6e,legend:n}}var N6e={name:"polymer-index",label:"Polymer Chain Instance",category:"Chain Property",factory:WY,getParams:L6e,defaultValues:M.getDefaultValues(GY),isApplicable:function(e){return!!e.structure}},QA={ALA:9240460,ARG:124,ASN:16743536,ASP:10485826,CYS:16777072,GLN:16731212,GLU:6684672,GLY:15658734,HIS:7368959,ILE:19456,LEU:4546117,LYS:4671416,MET:12099650,PHE:5459026,PRO:5395026,SER:16740418,THR:12078080,TRP:5195264,TYR:9203788,VAL:16747775,A:14423100,G:3329330,I:10145074,C:16766720,T:4286945,U:4251856,DA:14423100,DG:3329330,DI:10145074,DC:16766720,DT:4286945,DU:4251856,APN:14423100,GPN:3329330,CPN:16766720,TPN:4286945},q5=vt(16711935),z6e="Assigns a color to every residue according to its name.",XY={saturation:M.Numeric(0,{min:-6,max:6,step:.1}),lightness:M.Numeric(1,{min:-6,max:6,step:.1})};function U6e(e){return XY}function t9(e,t){return e.model.atomicHierarchy.atoms.label_comp_id.value(t)}function r9(e,t){var r=e.coarseElements.seq_id_begin.value(t),n=e.coarseElements.seq_id_end.value(t);if(r===n){var a=e.coarseElements.entityKey[t],i=e.model.sequence.byEntityKey[a].sequence;return i.compId.value(r-1)}}function tx(e,t){var r=e[t];return r===void 0?q5:r}function YY(e,t){var r=zw(QA,t.saturation,t.lightness);function n(a){if(ot.is(a))if(We.isAtomic(a.unit)){var i=t9(a.unit,a.element);return tx(r,i)}else{var i=r9(a.unit,a.element);if(i)return tx(r,i)}else if($t.isLocation(a))if(We.isAtomic(a.aUnit)){var i=t9(a.aUnit,a.aUnit.elements[a.aIndex]);return tx(r,i)}else{var i=r9(a.aUnit,a.aUnit.elements[a.aIndex]);if(i)return tx(r,i)}return q5}return{factory:YY,granularity:"group",preferSmoothing:!0,color:n,props:t,description:z6e,legend:Dp(Object.keys(QA).map(function(a){return[a,QA[a]]}).concat([["Unknown",q5]]))}}var V6e={name:"residue-name",label:"Residue Name",category:"Residue Property",factory:YY,getParams:U6e,defaultValues:M.getDefaultValues(XY),isApplicable:function(e){return!!e.structure}},ZA={alphaHelix:16711808,threeTenHelix:10485888,piHelix:6291584,betaTurn:6324479,betaStrand:16762880,coil:16777215,bend:6740169,turn:45670,dna:11403518,rna:16580962,carbohydrate:10921722},W5=vt(8421504),H6e="Assigns a color based on the type of secondary structure and basic molecule type.",KY={saturation:M.Numeric(-1,{min:-6,max:6,step:.1}),lightness:M.Numeric(0,{min:-6,max:6,step:.1})};function j6e(e){return KY}function n9(e,t,r,n){var a=jr.create(0);if(n&&We.isAtomic(t)){var i=n.get(t.invariantId);i&&(a=i.type[i.getIndex(t.residueIndex[r])])}if(jr.is(a,2))return jr.is(a,2048)?e.threeTenHelix:jr.is(a,32768)?e.piHelix:e.alphaHelix;if(jr.is(a,4))return e.betaStrand;if(jr.is(a,8))return e.bend;if(jr.is(a,16))return e.turn;var o=Mk(t,r);return o===7?e.dna:o===6?e.rna:o===9?e.carbohydrate:o===5?e.coil:W5}function $Y(e,t){var r=e.structure&&sc.get(e.structure),n=r?wm(r.id,r.version):-1,a=zw(ZA,t.saturation,t.lightness);function i(o){return ot.is(o)?n9(a,o.unit,o.element,r?.value):$t.isLocation(o)?n9(a,o.aUnit,o.aUnit.elements[o.aIndex],r?.value):W5}return{factory:$Y,granularity:"group",preferSmoothing:!0,color:i,props:t,contextHash:n,description:H6e,legend:Dp(Object.keys(ZA).map(function(o){return[o,ZA[o]]}).concat([["Other",W5]]))}}var G6e={name:"secondary-structure",label:"Secondary Structure",category:"Residue Property",factory:$Y,getParams:j6e,defaultValues:M.getDefaultValues(KY),isApplicable:function(e){return!!e.structure},ensureCustomProperties:{attach:function(e,t){return t.structure?sc.attach(e,t.structure,void 0,!0):Promise.resolve()},detach:function(e){return e.structure&&sc.ref(e.structure,!1)}}},q6e=vt(13421772),W6e="Gives every polymer residue a color based on its `seq_id` value.",QY={list:M.ColorList("turbo",{presetKind:"scale"})};function X6e(e){return QY}function a9(e,t){var r=e.model;switch(e.kind){case 0:var n=r.atomicHierarchy.residueAtomSegments.index[t];return r.atomicHierarchy.residues.label_seq_id.value(n);case 1:return Math.round((r.coarseHierarchy.spheres.seq_id_begin.value(t)+r.coarseHierarchy.spheres.seq_id_end.value(t))/2);case 2:return Math.round((r.coarseHierarchy.gaussians.seq_id_begin.value(t)+r.coarseHierarchy.gaussians.seq_id_end.value(t))/2)}}function i9(e,t){var r=e.model,n="";switch(e.kind){case 0:var a=r.atomicHierarchy.chainAtomSegments.index[t];n=r.atomicHierarchy.chains.label_entity_id.value(a);break;case 1:n=r.coarseHierarchy.spheres.entity_id.value(t);break;case 2:n=r.coarseHierarchy.gaussians.entity_id.value(t);break}if(n==="")return 0;var i=r.entities.getEntityIndex(n);if(i===-1)return 0;var o=r.sequence.byEntityKey[i];return o===void 0?0:o.sequence.length}function ZY(e,t){var r=nl.create({listOrName:t.list.colors,minLabel:"Start",maxLabel:"End"}),n=function(a){if(ot.is(a)){var i=a.unit,o=a.element,s=a9(i,o);if(s>0){var u=i9(i,o);if(u)return r.setDomain(0,u-1),r.color(s)}}else if($t.isLocation(a)){var l=a.aUnit,c=a.aIndex,s=a9(l,l.elements[c]);if(s>0){var u=i9(l,l.elements[c]);if(u)return r.setDomain(0,u-1),r.color(s)}}return q6e};return{factory:ZY,granularity:"group",preferSmoothing:!0,color:n,props:t,description:W6e,legend:r?r.legend:void 0}}var Y6e={name:"sequence-id",label:"Sequence Id",category:"Residue Property",factory:ZY,getParams:X6e,defaultValues:M.getDefaultValues(QY),isApplicable:function(e){return!!e.structure}},X5="dark-2",o9=vt(13421772),K6e="Gives every chain instance (single chain or collection of single elements) a unique color based on the position (index) of the chain in the list of chains in the structure.",JY=T({},ks({type:"colors",colorList:X5}));function $6e(e){var t=M.clone(JY);return e.structure&&e.structure.root.units.length>Vo[X5].list.length&&(t.palette.defaultValue.name="colors",t.palette.defaultValue.params=T(T({},t.palette.defaultValue.params),{list:{kind:"interpolate",colors:fu(X5).list}})),t}function eK(e,t){var r,n;if(e.structure){var a=e.structure.root.units,i=Su(a.length,t);n=i.legend;for(var o=new Map,s=0,u=a.length;s<u;++s)o.set(a[s].id,i.color(s));r=function(l){return ot.is(l)?o.get(l.unit.id):$t.isLocation(l)?o.get(l.aUnit.id):o9}}else r=function(){return o9};return{factory:eK,granularity:"instance",color:r,props:t,description:K6e,legend:n}}var Q6e={name:"unit-index",label:"Chain Instance",category:"Chain Property",factory:eK,getParams:$6e,defaultValues:M.getDefaultValues(JY),isApplicable:function(e){return!!e.structure}},Z6e=vt(16777113),J6e="Assigns a color based on the uncertainty or disorder of an element's position, e.g. B-factor or RMSF, depending on the data availability and experimental technique.",tK={domain:M.Interval([0,100]),list:M.ColorList("red-white-blue",{presetKind:"scale"})};function e8e(e){return tK}function s9(e,t){return We.isAtomic(e)?e.model.atomicConformation.B_iso_or_equiv.value(t):We.isSpheres(e)?e.model.coarseConformation.spheres.rmsf[t]:0}function rK(e,t){var r=nl.create({reverse:!0,domain:t.domain,listOrName:t.list.colors});function n(a){return ot.is(a)?r.color(s9(a.unit,a.element)):$t.isLocation(a)?r.color(s9(a.aUnit,a.aUnit.elements[a.aIndex])):Z6e}return{factory:rK,granularity:"group",preferSmoothing:!0,color:n,props:t,description:J6e,legend:r?r.legend:void 0}}var t8e={name:"uncertainty",label:"Uncertainty/Disorder",category:"Atom Property",factory:rK,getParams:e8e,defaultValues:M.getDefaultValues(tK),isApplicable:function(e){return!!e.structure&&e.structure.models.some(function(t){return t.atomicConformation.B_iso_or_equiv.isDefined||t.coarseHierarchy.isDefined})}},Y5="dark-2",rx=vt(16448250),r8e="Gives ranges of a polymer chain a color based on the entity source it originates from (e.g. gene, plasmid, organism).",nK=T({},ks({type:"colors",colorList:Y5}));function n8e(e){var t=M.clone(nK);return e.structure&&iK(e.structure.root.models).srcKeySerialMap.size>Vo[Y5].list.length&&(t.palette.defaultValue.name="colors",t.palette.defaultValue.params=T(T({},t.palette.defaultValue.params),{list:{kind:"interpolate",colors:fu(Y5).list}})),t}function aK(e,t){return e+"|"+t}function a8e(e,t,r,n,a,i){return e+"|"+t+"|"+r+"|"+(i||a||n)}function JA(e,t,r,n,a,i,o,s){for(var u=a.entity_id,l=a.pdbx_src_id,c=a.pdbx_beg_seq_num,d=a.pdbx_end_seq_num,f=0,p=a._rowCount;f<p;++f){var h=u.value(f),m=aK(r,h),v=void 0;if(e.has(m))v=e.get(m);else{var g=n.entities.getEntityIndex(h),y=n.sequence.sequences[g].sequence;v=new Int16Array(y.length),e.set(m,v)}var b=o?o.value(f):"",S=s?s.value(f)[0]:"",x=a8e(r,h,i.value(f),l.value(f),b,S),C=c.valueKind(f)===0?c.value(f):1,w=d.valueKind(f)===0?d.value(f):v.length,_=void 0;t.has(x)?_=t.get(x):(_=t.size+1,t.set(x,_));for(var E=C,P=w;E<=P;++E)v[E-1]=_}}function iK(e){for(var t=new Map,r=new Map,n=0,a=e.length;n<a;++n){var i=e[n];if(!!xn.is(i.sourceData)){var o=i.sourceData.data.db,s=o.entity_src_gen,u=o.entity_src_nat,l=o.pdbx_entity_src_syn;JA(t,r,n,i,s,s.pdbx_gene_src_scientific_name,s.plasmid_name,s.pdbx_gene_src_gene),JA(t,r,n,i,u,u.pdbx_organism_scientific,u.pdbx_plasmid_name),JA(t,r,n,i,l,l.organism_scientific)}}return{seqToSrcByModelEntity:t,srcKeySerialMap:r}}function i8e(e){var t=0;return Array.from(e.keys()).map(function(r){var n=r.split("|"),a=n[2],i=E2e(n[3])?"Unnamed "+ ++t:n[3];return""+i+(a?" ("+a+")":"")})}function oK(e,t){var r,n;if(e.structure){var a=ot.create(e.structure),i=e.structure.root.models,o=iK(i),s=o.seqToSrcByModelEntity,u=o.srcKeySerialMap,l=i8e(u),c=function(p){return l[p]},d=Su(u.size,t,{valueLabel:c});n=d.legend;var f=function(p){var h=i.indexOf(p.unit.model),m=mt.entity.id(p),v=aK(h,m),g=s.get(v);if(g){var y=g[mt.residue.label_seq_id(p)-1]-1;return y===-1?rx:d.color(y)}else return rx};r=function(p){return ot.is(p)?f(p):$t.isLocation(p)?(a.unit=p.aUnit,a.element=p.aUnit.elements[p.aIndex],f(a)):rx}}else r=function(){return rx};return{factory:oK,granularity:"group",color:r,props:t,description:r8e,legend:n}}var o8e={name:"entity-source",label:"Entity Source",category:"Chain Property",factory:oK,getParams:n8e,defaultValues:M.getDefaultValues(nK),isApplicable:function(e){return!!e.structure}},s8e=vt(15658734),u8e="Assigns an illustrative color that gives every chain a unique color with lighter carbons (inspired by David Goodsell's Molecule of the Month style).",sK=T({},c_);function l8e(e){return sK}function uK(e,t){var r=d_(e,t),n=r.color,a=r.legend;function i(s,u){var l=n(s,!1);return u==="C"?vt.lighten(l,.8):l}function o(s){if(ot.is(s)&&We.isAtomic(s.unit)){var u=s.unit.model.atomicHierarchy.atoms.type_symbol.value(s.element);return i(s,u)}else if($t.isLocation(s)&&We.isAtomic(s.aUnit)){var l=s.aUnit.elements[s.aIndex],u=s.aUnit.model.atomicHierarchy.atoms.type_symbol.value(l);return i(s,u)}return s8e}return{factory:uK,granularity:"group",preferSmoothing:!0,color:o,props:t,description:u8e,legend:a}}var c8e={name:"illustrative",label:"Illustrative",category:"Miscellaneous",factory:uK,getParams:l8e,defaultValues:M.getDefaultValues(sK),isApplicable:function(e){return!!e.structure}},d8e='Assigns a color to every amino acid according to the "Experimentally determined hydrophobicity scale for proteins at membrane interfaces" by Wimely and White (doi:10.1038/nsb1096-842).',lK={list:M.ColorList("red-yellow-green",{presetKind:"scale"}),scale:M.Select("DGwif",[["DGwif","DG water-membrane"],["DGwoct","DG water-octanol"],["Oct-IF","DG difference"]])};function f8e(e){return lK}var p8e={DGwif:0,DGwoct:1,"Oct-IF":2};function h8e(e,t){var r=p5[e];return r===void 0?0:r[t]}function u9(e,t){return e.model.atomicHierarchy.atoms.label_comp_id.value(t)}function l9(e,t){var r=e.coarseElements.seq_id_begin.value(t),n=e.coarseElements.seq_id_end.value(t);if(r===n){var a=e.coarseElements.entityKey[t],i=e.model.sequence.byEntityKey[a].sequence;return i.compId.value(r-1)}}function cK(e,t){var r=p8e[t.scale],n=1/0,a=-1/0;for(var i in p5){var o=p5[i][r];n=Math.min(n,o),a=Math.max(a,o)}var s=nl.create({listOrName:t.list.colors,domain:[a,n],minLabel:"Hydrophobic",maxLabel:"Hydrophilic"});function u(l){var c;return ot.is(l)?We.isAtomic(l.unit)?c=u9(l.unit,l.element):c=l9(l.unit,l.element):$t.isLocation(l)&&(We.isAtomic(l.aUnit)?c=u9(l.aUnit,l.aUnit.elements[l.aIndex]):c=l9(l.aUnit,l.aUnit.elements[l.aIndex])),s.color(c?h8e(c,r):0)}return{factory:cK,granularity:"group",preferSmoothing:!0,color:u,props:t,description:d8e,legend:s?s.legend:void 0}}var m8e={name:"hydrophobicity",label:"Hydrophobicity",category:"Residue Property",factory:cK,getParams:f8e,defaultValues:M.getDefaultValues(lK),isApplicable:function(e){return!!e.structure}},c9=vt(13421772),v8e="Gives every model a unique color based on the position (index) of the model in the list of models in the structure.",dK=T({},ks({type:"colors",colorList:"purples"}));function g8e(e){return dK}function fK(e,t){var r,n,a,i;if(e.structure){for(var o=e.structure.root.models,s=0,u=0,l=o;u<l.length;u++){var c=l[u];s=Math.max(s,((r=rr.TrajectoryInfo.get(c))===null||r===void 0?void 0:r.size)||0)}var d=Su(s,t);i=d.legend;for(var f=new Map,p=0,h=o.length;p<h;++p){var m=((n=rr.TrajectoryInfo.get(o[p]))===null||n===void 0?void 0:n.index)||0;f.set(m,d.color(m))}a=function(v){return ot.is(v)?f.get(rr.TrajectoryInfo.get(v.unit.model).index):$t.isLocation(v)?f.get(rr.TrajectoryInfo.get(v.aUnit.model).index):c9}}else a=function(){return c9};return{factory:fK,granularity:"instance",color:a,props:t,description:v8e,legend:i}}var y8e={name:"model-index",label:"Model Index",category:"Chain Property",factory:fK,getParams:g8e,defaultValues:M.getDefaultValues(dK),isApplicable:function(e){return!!e.structure&&e.structure.elementCount>0&&rr.TrajectoryInfo.get(e.structure.models[0]).size>1}},b8e=vt(13421772),x8e="Assigns a color based on the occupancy of an atom.",pK={domain:M.Interval([0,1]),list:M.ColorList("purples",{presetKind:"scale"})};function S8e(e){return pK}function d9(e,t){return We.isAtomic(e)?e.model.atomicConformation.occupancy.value(t):0}function hK(e,t){var r=nl.create({reverse:!1,domain:t.domain,listOrName:t.list.colors});function n(a){return ot.is(a)?r.color(d9(a.unit,a.element)):$t.isLocation(a)?r.color(d9(a.aUnit,a.aUnit.elements[a.aIndex])):b8e}return{factory:hK,granularity:"group",preferSmoothing:!0,color:n,props:t,description:x8e,legend:r?r.legend:void 0}}var C8e={name:"occupancy",label:"Occupancy",category:"Atom Property",factory:hK,getParams:S8e,defaultValues:M.getDefaultValues(pK),isApplicable:function(e){return!!e.structure&&e.structure.models.some(function(t){return t.atomicConformation.occupancy.isDefined})}},K5="dark-2",f9=vt(13421772),w8e="Assigns a color based on the operator HKL value of a transformed chain.",mK=T({},ks({type:"colors",colorList:K5}));function _8e(e){var t=M.clone(mK);return e.structure&&vK(e.structure.root).map.size>Vo[K5].list.length&&(t.palette.defaultValue.name="colors",t.palette.defaultValue.params=T(T({},t.palette.defaultValue.params),{list:{kind:"interpolate",colors:fu(K5).list}})),t}var iy=1e4;function $5(e){return e.map(function(t){return(""+(t+iy)).padStart(5,"0")}).join("")}function Q5(e){var t=A2e(iy,0),r=parseInt(e.substr(0,t)),n=parseInt(e.substr(t,t)),a=parseInt(e.substr(t+t,t));return[r-iy,n-iy,a-iy]}function eT(e){return e.map(function(t){return t+5}).join("")}function vK(e){for(var t=new Map,r=new Set,n=0,a=e.units.length;n<a;++n){var i=$5(e.units[n].conformation.operator.hkl);r.add(i)}var o=Array.from(r.values()).sort();o.forEach(function(l){return t.set(l,t.size)});var s=Q5(o[0]),u=Q5(o[o.length-1]);return{min:s,max:u,map:t}}function gK(e,t){var r,n;if(e.structure){var a=vK(e.structure.root),i=a.min,o=a.max,s=a.map,u=[];s.forEach(function(d,f){var p=d%s.size,h=eT(Q5(f));u[p]===void 0?u[p]=h:u[p]+=", "+h});var l={minLabel:eT(i),maxLabel:eT(o),valueLabel:function(d){return u[d]}},c=Su(s.size,t,l);n=c.legend,r=function(d){var f=void 0;if(ot.is(d)){var p=$5(d.unit.conformation.operator.hkl);f=s.get(p)}else if($t.isLocation(d)){var p=$5(d.aUnit.conformation.operator.hkl);f=s.get(p)}return f===void 0?f9:c.color(f)}}else r=function(){return f9};return{factory:gK,granularity:"instance",color:r,props:t,description:w8e,legend:n}}var A8e={name:"operator-hkl",label:"Operator HKL",category:"Symmetry",factory:gK,getParams:_8e,defaultValues:M.getDefaultValues(mK),isApplicable:function(e){return!!e.structure}},tT=vt(16777113),T8e="Assigns a color based on the partial charge of an atom.",yK={domain:M.Interval([-1,1]),list:M.ColorList("red-white-blue",{presetKind:"scale"})};function E8e(e){return yK}function p9(e,t){var r;return(r=x0.Provider.get(e.model))===null||r===void 0?void 0:r.data.value(t)}function bK(e,t){var r=nl.create({domain:t.domain,listOrName:t.list.colors});function n(a){if(ot.is(a)){var i=p9(a.unit,a.element);return i!==void 0?r.color(i):tT}else if($t.isLocation(a)){var i=p9(a.aUnit,a.aUnit.elements[a.aIndex]);return i!==void 0?r.color(i):tT}return tT}return{factory:bK,granularity:"group",preferSmoothing:!0,color:n,props:t,description:T8e,legend:r?r.legend:void 0}}var P8e={name:"partial-charge",label:"Partial Charge",category:"Atom Property",factory:bK,getParams:E8e,defaultValues:M.getDefaultValues(yK),isApplicable:function(e){return!!e.structure&&e.structure.models.some(function(t){return x0.Provider.get(t)!==void 0})}},I8e="many-distinct",h9=vt(16448250),M8e="Gives every atom a color based on its `label_atom_id` value.",xK=T({},ks({type:"colors",colorList:I8e}));function D8e(e){var t=M.clone(xK);return t}function k8e(e){for(var t=new Map,r=0,n=e.models;r<n.length;r++)for(var a=n[r],i=a.atomicHierarchy.atoms.label_atom_id,o=0,s=i.rowCount;o<s;++o){var u=i.value(o);t.has(u)||t.set(u,t.size)}return t}function SK(e,t){var r,n;if(e.structure){var a=ot.create(e.structure.root),i=k8e(e.structure.root),o=Array.from(i.keys()),s=function(l){return o[l]},u=Su(i.size,t,{valueLabel:s});n=u.legend,r=function(l){var c=void 0;if(ot.is(l)){var d=mt.atom.label_atom_id(l);c=i.get(d)}else if($t.isLocation(l)){a.unit=l.aUnit,a.element=l.aUnit.elements[l.aIndex];var d=mt.atom.label_atom_id(a);c=i.get(d)}return c===void 0?h9:u.color(c)}}else r=function(){return h9};return{factory:SK,granularity:"group",preferSmoothing:!0,color:r,props:t,description:M8e,legend:n}}var R8e={name:"atom-id",label:"Atom Id",category:"Atom Property",factory:SK,getParams:D8e,defaultValues:M.getDefaultValues(xK),isApplicable:function(e){return!!e.structure}},O8e="many-distinct",m9=vt(16448250),B8e="Gives every chain a color based on its `label_entity_id` value.",CK=T({},ks({type:"colors",colorList:O8e}));function F8e(e){var t=M.clone(CK);return t}function Z5(e,t){return e+"|"+t}function L8e(e){for(var t=new Map,r=0,n=e.models.length;r<n;++r)for(var a=e.models[r].atomicHierarchy.chains.label_entity_id,i=0,o=a.rowCount;i<o;++i){var s=Z5(a.value(i),r);t.has(s)||t.set(s,t.size)}return t}function wK(e,t){var r,n;if(e.structure){var a=ot.create(e.structure.root),i=L8e(e.structure.root),o=Array.from(i.keys()),s=function(l){return o[l]},u=Su(i.size,t,{valueLabel:s});n=u.legend,r=function(l){var c=void 0;if(ot.is(l)){var d=mt.chain.label_entity_id(l),f=l.structure.models.indexOf(l.unit.model),p=Z5(d,f);c=i.get(p)}else if($t.isLocation(l)){a.unit=l.aUnit,a.element=l.aUnit.elements[l.aIndex];var d=mt.chain.label_entity_id(a),f=a.structure.models.indexOf(a.unit.model),p=Z5(d,f);c=i.get(p)}return c===void 0?m9:u.color(c)}}else r=function(){return m9};return{factory:wK,granularity:"group",color:r,props:t,description:B8e,legend:n}}var N8e={name:"entity-id",label:"Entity Id",category:"Chain Property",factory:wK,getParams:F8e,defaultValues:M.getDefaultValues(CK),isApplicable:function(e){return!!e.structure}},xd;(function(e){e.PaletteScale=(1<<24)-1,e.EmptyFactory=function(){return e.Empty};var t=vt(13421772);e.Empty={factory:e.EmptyFactory,granularity:"uniform",color:function(){return t},props:{}};function r(a,i){return a.contextHash===i.contextHash&&a.factory===i.factory&&dd(a.props,i.props)}e.areEqual=r,e.EmptyProvider={name:"",label:"",category:"",factory:e.EmptyFactory,getParams:function(){return{}},defaultValues:{},isApplicable:function(){return!0}};function n(){return new EK(e.BuiltIn,e.EmptyProvider)}e.createRegistry=n,e.BuiltIn={"atom-id":R8e,"carbohydrate-symbol":l6e,"chain-id":RY,"element-index":S6e,"element-symbol":I6e,"entity-id":N8e,"entity-source":o8e,hydrophobicity:m8e,illustrative:c8e,"model-index":y8e,"molecule-type":k6e,occupancy:C8e,"operator-hkl":A8e,"operator-name":Uk,"partial-charge":P8e,"polymer-id":B6e,"polymer-index":N6e,"residue-name":V6e,"secondary-structure":G6e,"sequence-id":Y6e,"shape-group":RAe,uncertainty:t8e,"unit-index":Q6e,uniform:D3e}})(xd||(xd={}));var z8e=1,U8e="Assigns a physical size, i.e. vdW radius for atoms or given radius for coarse spheres.",_K={scale:M.Numeric(1,{min:.1,max:5,step:.1})};function V8e(e){return _K}function rT(e,t){return We.isAtomic(e)?yb(e.model.atomicHierarchy.atoms.type_symbol.value(t)):We.isSpheres(e)?e.model.coarseConformation.spheres.radius[t]:0}function xb(e,t){var r=t.scale===void 0?1:t.scale;function n(a){var i;return ot.is(a)?i=r*rT(a.unit,a.element):$t.isLocation(a)?i=r*Math.min(rT(a.aUnit,a.aUnit.elements[a.aIndex]),rT(a.bUnit,a.bUnit.elements[a.bIndex])):i=r*z8e,i}return{factory:xb,granularity:"group",size:n,props:t,description:U8e}}var H8e={name:"physical",label:"Physical",category:"",factory:xb,getParams:V8e,defaultValues:M.getDefaultValues(_K),isApplicable:function(e){return!!e.structure}},j8e="Assigns a size reflecting the uncertainty or disorder of an element's position, e.g. B-factor or RMSF, depending on the data availability and experimental technique.",AK={bfactorFactor:M.Numeric(.1,{min:0,max:1,step:.01}),rmsfFactor:M.Numeric(.05,{min:0,max:1,step:.01}),baseSize:M.Numeric(.2,{min:0,max:2,step:.1})};function G8e(e){return AK}function v9(e,t,r){return We.isAtomic(e)?e.model.atomicConformation.B_iso_or_equiv.value(t)*r.bfactorFactor:We.isSpheres(e)?e.model.coarseConformation.spheres.rmsf[t]*r.rmsfFactor:0}function TK(e,t){function r(n){var a=t.baseSize;return ot.is(n)?a+=v9(n.unit,n.element,t):$t.isLocation(n)&&(a+=v9(n.aUnit,n.aUnit.elements[n.aIndex],t)),a}return{factory:TK,granularity:"group",size:r,props:t,description:j8e}}var q8e={name:"uncertainty",label:"Uncertainty/Disorder",category:"",factory:TK,getParams:G8e,defaultValues:M.getDefaultValues(AK),isApplicable:function(e){return!!e.structure&&e.structure.models.some(function(t){return t.atomicConformation.B_iso_or_equiv.isDefined||t.coarseHierarchy.isDefined})}},oi;(function(e){e.EmptyFactory=function(){return e.Empty},e.Empty={factory:e.EmptyFactory,granularity:"uniform",size:function(){return 1},props:{}};function t(n,a){return n.factory===a.factory&&dd(n.props,a.props)}e.areEqual=t,e.EmptyProvider={name:"",label:"",category:"",factory:e.EmptyFactory,getParams:function(){return{}},defaultValues:{},isApplicable:function(){return!0}};function r(){return new EK(e.BuiltIn,e.EmptyProvider)}e.createRegistry=r,e.BuiltIn={physical:H8e,"shape-group":IAe,uncertainty:q8e,uniform:O3e}})(oi||(oi={}));var Ia;(function(e){function t(i,o,s,u){u=u||r();var l=s.colorTheme,c=s.sizeTheme;return u.color=i.colorThemeRegistry.create(l.name,o,l.params),u.size=i.sizeThemeRegistry.create(c.name,o,c.params),u}e.create=t;function r(){return{color:xd.Empty,size:oi.Empty}}e.createEmpty=r;function n(i,o,s,u){var l,c;return pe(this,void 0,void 0,function(){return he(this,function(d){switch(d.label){case 0:return[4,(l=o.colorThemeRegistry.get(u.colorTheme.name).ensureCustomProperties)===null||l===void 0?void 0:l.attach(i,s)];case 1:return d.sent(),[4,(c=o.sizeThemeRegistry.get(u.sizeTheme.name).ensureCustomProperties)===null||c===void 0?void 0:c.attach(i,s)];case 2:return d.sent(),[2]}})})}e.ensureDependencies=n;function a(i,o,s){var u,l;(u=i.colorThemeRegistry.get(s.colorTheme.name).ensureCustomProperties)===null||u===void 0||u.detach(o),(l=i.sizeThemeRegistry.get(s.sizeTheme.name).ensureCustomProperties)===null||l===void 0||l.detach(o)}e.releaseDependencies=a})(Ia||(Ia={}));function g9(e){return e.map(function(t){return[t.name,t.provider.label,t.provider.category]})}var EK=function(){function e(t,r){var n=this;this.emptyProvider=r,this._list=[],this._map=new Map,this._name=new Map,rl(t,function(a,i){if(a.name!==i)throw new Error("Fix build in themes to have matching names. "+a.name+" "+i);n.add(a)})}return Object.defineProperty(e.prototype,"default",{get:function(){return this._list[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"list",{get:function(){return this._list},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"types",{get:function(){return g9(this._list)},enumerable:!1,configurable:!0}),e.prototype.sort=function(){this._list.sort(function(t,r){return t.provider.category===r.provider.category?t.provider.label<r.provider.label?-1:t.provider.label>r.provider.label?1:0:t.provider.category<r.provider.category?-1:1})},e.prototype.add=function(t){if(this._map.has(t.name))throw new Error(t.name+" already registered.");var r=t.name;this._list.push({name:r,provider:t}),this._map.set(r,t),this._name.set(t,r),this.sort()},e.prototype.remove=function(t){this._list.splice(this._list.findIndex(function(n){return n.name===t.name}),1);var r=this._map.get(t.name);r&&(this._map.delete(t.name),this._name.delete(r))},e.prototype.has=function(t){return this._map.has(t.name)},e.prototype.get=function(t){return this._map.get(t)||this.emptyProvider},e.prototype.getName=function(t){if(!this._name.has(t))throw new Error("'"+t.label+"' is not a registered theme provider.");return this._name.get(t)},e.prototype.create=function(t,r,n){n===void 0&&(n={});var a=this.get(t);return a.factory(r,T(T({},M.getDefaultValues(a.getParams(r))),n))},e.prototype.getApplicableList=function(t){return this._list.filter(function(r){return r.provider.isApplicable(t)})},e.prototype.getApplicableTypes=function(t){return g9(this.getApplicableList(t))},e}();function f_(e){return Object.keys(e)}function J5(e){throw new Error("unreachable")}function Vk(e){return typeof e?.then=="function"}var sr;(function(e){e[e.None=0]="None",e[e.Highlight=1]="Highlight",e[e.RemoveHighlight=2]="RemoveHighlight",e[e.Select=4]="Select",e[e.Deselect=8]="Deselect",e[e.Toggle=16]="Toggle",e[e.Clear=32]="Clear"})(sr||(sr={}));var Wo;(function(e){e.is=Oi.has,e.All=sr.Highlight|sr.RemoveHighlight|sr.Select|sr.Deselect|sr.Toggle|sr.Clear,e.Highlighting=sr.Highlight|sr.RemoveHighlight|sr.Clear,e.Selecting=sr.Select|sr.Deselect|sr.Toggle|sr.Clear})(Wo||(Wo={}));function QC(e,t,r){switch(r){case sr.Highlight:e[t]|=1;break;case sr.RemoveHighlight:e[t]&=-2;break;case sr.Select:e[t]|=2;break;case sr.Deselect:e[t]&=-3;break;case sr.Toggle:e[t]^=2;break;case sr.Clear:e[t]=0;break}}function sl(e,t,r){if(r===sr.None)return!1;if(Me.is(t)){var n=Me.start(t),a=Me.end(t),i=new Uint32Array(e.buffer,0,e.buffer.byteLength>>2),o=n+3>>2,s=o+(a-4*o>>2),u=n,l=Math.min(4*o,a),c=Math.max(n,4*s),d=a;switch(r){case sr.Highlight:for(var f=o;f<s;++f)i[f]|=16843009;break;case sr.RemoveHighlight:for(var f=o;f<s;++f)i[f]&=-16843010;break;case sr.Select:for(var f=o;f<s;++f)i[f]|=33686018;break;case sr.Deselect:for(var f=o;f<s;++f)i[f]&=-33686019;break;case sr.Toggle:for(var f=o;f<s;++f)i[f]^=33686018;break;case sr.Clear:for(var f=o;f<s;++f)i[f]=0;break;default:J5()}for(var f=u;f<l;++f)QC(e,f,r);for(var f=c;f<d;++f)QC(e,f,r)}else switch(r){case sr.Highlight:for(var f=0,p=t.length;f<p;++f)e[t[f]]|=1;break;case sr.RemoveHighlight:for(var f=0,p=t.length;f<p;++f)e[t[f]]&=-2;break;case sr.Select:for(var f=0,p=t.length;f<p;++f)e[t[f]]|=2;break;case sr.Deselect:for(var f=0,p=t.length;f<p;++f)e[t[f]]&=-3;break;case sr.Toggle:for(var f=0,p=t.length;f<p;++f)e[t[f]]^=2;break;case sr.Clear:for(var f=0,p=t.length;f<p;++f)e[t[f]]=0;break;default:J5()}return!0}var W8e={kind:"every-loci"};function uu(e){return!!e&&e.kind==="every-loci"}var zr={kind:"empty-loci"};function Ku(e){return!!e&&e.kind==="empty-loci"}function Hy(e){return!!e&&e.kind==="data-loci"}function X8e(e,t){if(!mC(e.data,t.data)||e.tag!==t.tag||e.elements.length!==t.elements.length)return!1;for(var r=0,n=e.elements.length;r<n;++r)if(!mC(e.elements[r],t.elements[r]))return!1;return!0}function Y8e(e){return e.elements.length===0}function p_(e,t,r,n,a){return{kind:"data-loci",tag:e,data:t,elements:r,getBoundingSphere:n,getLabel:a}}var cr;(function(e){var t=new Ms("98");function r(m){var v=m.loci.map(function(C){return s(C)}).filter(function(C){return!!C});t.reset();for(var g=0,y=v;g<y.length;g++){var b=y[g];t.includePositionRadius(b.center,b.radius)}t.finishedIncludeStep();for(var S=0,x=v;S<x.length;S++){var b=x[S];t.radiusPositionRadius(b.center,b.radius)}return t.getSphere()}e.getBundleBoundingSphere=r;function n(m,v){return uu(m)&&uu(v)||Ku(m)&&Ku(v)?!0:Hy(m)&&Hy(v)?X8e(m,v):$e.isLoci(m)&&$e.isLoci(v)?$e.areLociEqual(m,v):Oe.is(m)&&Oe.is(v)?Oe.areEqual(m,v):$t.isLoci(m)&&$t.isLoci(v)?$t.areLociEqual(m,v):Nr.isLoci(m)&&Nr.isLoci(v)?Nr.areLociEqual(m,v):po.isLoci(m)&&po.isLoci(v)?po.areLociEqual(m,v):It.isLoci(m)&&It.isLoci(v)?It.areLociEqual(m,v):It.Isosurface.isLoci(m)&&It.Isosurface.isLoci(v)?It.Isosurface.areLociEqual(m,v):It.Cell.isLoci(m)&&It.Cell.isLoci(v)?It.Cell.areLociEqual(m,v):!1}e.areEqual=n;function a(m){return!!m&&m.kind==="every-loci"}e.isEvery=a;function i(m){return uu(m)?!1:Ku(m)?!0:Hy(m)?Y8e(m):$e.isLoci(m)?$e.isLociEmpty(m):Oe.is(m)?Oe.isEmpty(m):$t.isLoci(m)?$t.isLociEmpty(m):Nr.isLoci(m)?Nr.isLociEmpty(m):po.isLoci(m)?po.isLociEmpty(m):It.isLoci(m)?It.isLociEmpty(m):It.Isosurface.isLoci(m)?It.Isosurface.isLociEmpty(m):It.Cell.isLoci(m)?It.Cell.isLociEmpty(m):!1}e.isEmpty=i;function o(m,v){return v instanceof $e&&(Oe.is(m)?m=Oe.remap(m,v):$e.isLoci(m)?m=$e.remapLoci(m,v):$t.isLoci(m)&&(m=$t.remapLoci(m,v))),m}e.remap=o;function s(m,v){var g;if(!(m.kind==="every-loci"||m.kind==="empty-loci")){if(v||(v=He()),m.kind==="structure-loci")return He.copy(v,m.structure.boundary.sphere);if(m.kind==="element-loci")return He.copy(v,Oe.getBoundary(m).sphere);if(m.kind==="bond-loci")return $t.getBoundingSphere(m,v);if(m.kind==="shape-loci")return He.copy(v,m.shape.geometry.boundingSphere);if(m.kind==="group-loci")return po.getBoundingSphere(m,v);if(m.kind==="data-loci")return(g=m.getBoundingSphere)===null||g===void 0?void 0:g.call(m,v);if(m.kind==="volume-loci")return It.getBoundingSphere(m.volume,v);if(m.kind==="isosurface-loci")return It.Isosurface.getBoundingSphere(m.volume,m.isoValue,v);if(m.kind==="cell-loci")return It.Cell.getBoundingSphere(m.volume,m.indices,v)}}e.getBoundingSphere=s;var u=He.zero();function l(m,v){var g=s(m,u);return g?A.copy(v||A(),g.center):void 0}e.getCenter=l;function c(m){if(!(m.kind==="every-loci"||m.kind==="empty-loci")){if(m.kind==="structure-loci")return Oe.getPrincipalAxes($e.toStructureElementLoci(m.structure));if(m.kind==="element-loci")return Oe.getPrincipalAxes(m);if(m.kind==="bond-loci")return;if(m.kind==="shape-loci")return;if(m.kind==="group-loci")return;if(m.kind==="data-loci")return;if(m.kind==="volume-loci")return;if(m.kind==="isosurface-loci")return;if(m.kind==="cell-loci")return}}e.getPrincipalAxes=c;var d={element:function(m){return m},residue:function(m){return Oe.is(m)?Oe.extendToWholeResidues(m,!0):m},chain:function(m){return Oe.is(m)?Oe.extendToWholeChains(m):m},entity:function(m){return Oe.is(m)?Oe.extendToWholeEntities(m):m},model:function(m){return Oe.is(m)?Oe.extendToWholeModels(m):m},structure:function(m){return Oe.is(m)?$e.toStructureElementLoci(m.structure):po.isLoci(m)?Nr.Loci(m.shape):m},elementInstances:function(m){return Oe.is(m)?Oe.extendToAllInstances(m):m},residueInstances:function(m){return Oe.is(m)?Oe.extendToAllInstances(Oe.extendToWholeResidues(m,!0)):m},chainInstances:function(m){return Oe.is(m)?Oe.extendToAllInstances(Oe.extendToWholeChains(m)):m}};e.GranularityOptions=M.objectToOptions(d,function(m){switch(m){case"element":return"Atom/Coarse Element";case"elementInstances":return["Atom/Coarse Element Instances","With Symmetry"];case"structure":return"Structure/Shape";default:return m.indexOf("Instances")?[vs(m),"With Symmetry"]:vs(m)}});function f(m){return m.replace("Instances","")}e.simpleGranularity=f;function p(m,v){return d[v](m)}e.applyGranularity=p;function h(m,v){return v!=="element"&&$t.isLoci(m)&&(m=$t.toStructureElementLoci(m)),$e.isLoci(m)&&(m=$e.toStructureElementLoci(m.structure)),Oe.is(m)&&(m=Oe.remap(m,m.structure.root)),v&&(m=p(m,v)),m}e.normalize=h})(cr||(cr={}));function ri(e){return{layers:e}}(function(e){e.Empty={layers:[]};function t(l,c){if(l.layers.length===0&&c.layers.length===0)return!0;if(l.layers.length!==c.layers.length)return!1;for(var d=0,f=l.layers.length;d<f;++d)if(l.layers[d].clear!==c.layers[d].clear||l.layers[d].color!==c.layers[d].color||!cr.areEqual(l.layers[d].loci,c.layers[d].loci))return!1;return!0}e.areEqual=t;function r(l){return l.layers.length===0}e.isEmpty=r;function n(l,c){for(var d=[],f=0,p=l.layers;f<p.length;f++){var h=p[f],m=h.loci,v=h.color,g=h.clear;m=Oe.remap(m,c),Oe.isEmpty(m)||d.push({loci:m,color:v,clear:g})}return{layers:d}}e.remap=n;function a(l){if(r(l))return l;for(var c=l.layers[0].loci.structure,d=new Map,f=Oe.none(c),p=0,h=l.layers.length;p<h;++p){var m=l.layers[h-p-1],v=m.loci,g=m.color,y=m.clear;if(v=Oe.subtract(v,f),f=Oe.union(v,f),!Oe.isEmpty(v)){var b=y?-1:g;d.has(b)&&(v=Oe.union(v,d.get(b))),d.set(b,v)}}var S=[];return d.forEach(function(x,C){var w=C===-1,_=C===-1?vt(0):C;S.push({loci:x,color:_,clear:w})}),{layers:S}}e.merge=a;function i(l,c){if(r(l))return l;for(var d=l.layers[0].loci.structure,f=[],p=0,h=l.layers;p<h.length;p++){var m=h[p],v=m.loci,g=m.color,y=m.clear,b=Oe.remap(v,c);v=Oe.remap(b,d),Oe.isEmpty(v)||f.push({loci:v,color:g,clear:y})}return{layers:f}}e.filter=i;function o(l,c){for(var d=[],f=0,p=l.length;f<p;++f){var h=l[f],m=h.script,v=h.color,g=h.clear,y=yi.toLoci(m,c);Oe.isEmpty(y)||d.push({loci:y,color:v,clear:g})}return{layers:d}}e.ofScript=o;function s(l,c){for(var d=[],f=0,p=l.length;f<p;++f){var h=l[f],m=h.bundle,v=h.color,g=h.clear,y=sn.toLoci(m,c.root);d.push({loci:y,color:v,clear:g})}return{layers:d}}e.ofBundle=s;function u(l){for(var c=[],d=0,f=l.layers.length;d<f;++d){var p=l.layers[d],h=p.loci,m=p.color,v=p.clear,g=sn.fromLoci(h);c.push({bundle:g,color:m,clear:v})}return{layers:c}}e.toBundle=u})(ri||(ri={}));function ni(e,t){return{kind:e,layers:t}}(function(e){e.Empty={kind:"empty-loci",layers:[]};function t(l,c){if(l.layers.length===0&&c.layers.length===0)return!0;if(l.layers.length!==c.layers.length)return!1;for(var d=0,f=l.layers.length;d<f;++d)if(l.layers[d].value!==c.layers[d].value||!cr.areEqual(l.layers[d].loci,c.layers[d].loci))return!1;return!0}e.areEqual=t;function r(l){return l.layers.length===0}e.isEmpty=r;function n(l,c){if(l.kind==="element-loci"){for(var d=[],f=0,p=l.layers;f<p.length;f++){var h=p[f],m=Oe.remap(h.loci,c);Oe.isEmpty(m)||d.push({loci:m,value:h.value})}return{kind:"element-loci",layers:d}}else return l}e.remap=n;function a(l){if(r(l))return l;if(l.kind==="element-loci"){for(var c=l.layers[0].loci.structure,d=new Map,f=Oe.none(c),p=0,h=l.layers.length;p<h;++p){var m=l.layers[h-p-1],v=m.loci,g=m.value;v=Oe.subtract(v,f),f=Oe.union(v,f),Oe.isEmpty(v)||(d.has(g)&&(v=Oe.union(v,d.get(g))),d.set(g,v))}var y=[];return d.forEach(function(b,S){y.push({loci:b,value:S})}),{kind:"element-loci",layers:y}}else return l}e.merge=a;function i(l,c){if(r(l))return l;if(l.kind==="element-loci"){for(var d=l.layers[0].loci.structure,f=[],p=0,h=l.layers;p<h.length;p++){var m=h[p],v=m.loci,g=m.value,y=Oe.remap(v,c);v=Oe.remap(y,d),Oe.isEmpty(v)||f.push({loci:v,value:g})}return{kind:"element-loci",layers:f}}else return l}e.filter=i;function o(l,c){for(var d=[],f=0,p=l.length;f<p;++f){var h=l[f],m=h.script,v=h.value,g=yi.toLoci(m,c);Oe.isEmpty(g)||d.push({loci:g,value:v})}return{kind:"element-loci",layers:d}}e.ofScript=o;function s(l,c){for(var d=[],f=0,p=l.length;f<p;++f){var h=l[f],m=h.bundle,v=h.value,g=sn.toLoci(m,c.root);d.push({loci:g,value:v})}return{kind:"element-loci",layers:d}}e.ofBundle=s;function u(l){for(var c=[],d=0,f=l.layers.length;d<f;++d){var p=l.layers[d],h=p.loci,m=p.value,v=sn.fromLoci(h);c.push({bundle:v,value:m})}return{kind:"element-loci",layers:c}}e.toBundle=u})(ni||(ni={}));var lc;(function(e){function t(){return{updateTransform:!1,updateMatrix:!1,updateColor:!1,updateSize:!1,createGeometry:!1,createNew:!1,info:{}}}e.create=t;function r(n){n.updateTransform=!1,n.updateMatrix=!1,n.updateColor=!1,n.updateSize=!1,n.createGeometry=!1,n.createNew=!1}e.reset=r})(lc||(lc={}));var K8e={lowestElementCount:1e6,lowerElementCount:5e5,lowElementCount:1e5,mediumElementCount:2e4,highElementCount:2e3,coarseGrainedFactor:10,elementCountFactor:1};function PK(e,t){t===void 0&&(t={});var r=T(T({},K8e),t),n=e.elementCount*r.elementCountFactor;return e.isCoarseGrained&&(n*=r.coarseGrainedFactor),n>r.lowestElementCount?"lowest":n>r.lowerElementCount?"lower":n>r.lowElementCount?"low":n>r.mediumElementCount?"medium":n>r.highElementCount?"high":"higher"}function $8e(e){if(e.root.models.length===1){var t=wa.Provider.get(e.root.model);if(t&&t.spacegroup.name==="P 1"&&!Go.isZero(t.spacegroup.cell))return t.spacegroup.cell.volume}return tr.volume(e.root.boundary.box)}function eI(e,t){var r=ja(e.quality,"auto"),n=ja(e.detail,1),a=ja(e.radialSegments,12),i=ja(e.linearSegments,8),o=ja(e.resolution,2),s=ja(e.probePositions,12),u=ja(e.doubleSided,!0),l=0;if(r==="auto"){if(t instanceof $e)r=PK(t.root),l=$8e(t);else if(It.is(t)){var c=t.grid.cells.space.dimensions,d=c[0],f=c[1],p=c[2];l=d*f*p,r=l<1e7?"medium":"low"}}switch(r){case"highest":n=3,a=36,i=18,o=.1,s=72,u=!0;break;case"higher":n=3,a=28,i=14,o=.3,s=48,u=!0;break;case"high":n=2,a=20,i=10,o=.5,s=36,u=!0;break;case"medium":n=1,a=12,i=8,o=.8,s=24,u=!0;break;case"low":n=0,a=8,i=3,o=1.3,s=24,u=!1;break;case"lower":n=0,a=4,i=2,o=3,s=12,u=!1;break;case"lowest":n=0,a=2,i=1,o=8,s=12,u=!1;break}return o=Math.max(o,l/5e8),o=Math.min(o,20),(e.alpha!==void 0&&e.alpha<1||!!e.xrayShaded)&&(u=!1),{detail:n,radialSegments:a,linearSegments:i,resolution:o,probePositions:s,doubleSided:u}}var Pr;(function(e){function t(c,d){c&&(c.state.visible=d)}e.setVisibility=t;function r(c,d){c&&(c.state.alphaFactor=d)}e.setAlphaFactor=r;function n(c,d){c&&(c.state.pickable=d)}e.setPickable=n;function a(c,d){c&&(c.state.colorOnly=d)}e.setColorOnly=a;function i(c,d,f,p){if(!c)return!1;var h=c.values,m=h.tMarker,v=h.uGroupCount,g=h.instanceCount,y=v.ref.value*g.ref.value,b=m.ref.value.array,S=!1;return uu(d)?S=sl(b,Me.ofLength(y),f):Ku(d)||(S=p(d,function(x){return sl(b,x,f)},!0)),S&&N.update(m,m.ref.value),S}e.mark=i;function o(c,d,f,p){if(!!c){var h=c.values,m=h.tOverpaint,v=h.uGroupCount,g=h.instanceCount,y=v.ref.value*g.ref.value;N3e(d.layers.length?y:0,c.values);var b=m.ref.value.array;p&&WF(b,0,y);for(var S=function(w,_){var E=d.layers[w],P=E.loci,D=E.color,k=E.clear,F=function(X){var U=Me.start(X),j=Me.end(X);return k?WF(b,U,j):L3e(b,U,j,D)};f(P,F,!1)},x=0,C=d.layers.length;x<C;++x)S(x);N.update(m,m.ref.value)}}e.setOverpaint=o;function s(c,d,f,p){if(!!c){var h=c.values,m=h.tTransparency,v=h.transparencyAverage,g=h.uGroupCount,y=h.instanceCount,b=g.ref.value*y.ref.value;V3e(d.layers.length?b:0,c.values);var S=m.ref.value.array;p&&U3e(S,0,b);for(var x=function(_,E){var P=d.layers[_],D=P.loci,k=P.value,F=function(X){var U=Me.start(X),j=Me.end(X);return z3e(S,U,j,k)};f(D,F,!1)},C=0,w=d.layers.length;C<w;++C)x(C);N.update(m,m.ref.value),N.updateIfChanged(v,NW(S,b))}}e.setTransparency=s;function u(c,d,f,p){if(!!c){var h=c.values,m=h.tClipping,v=h.uGroupCount,g=h.instanceCount,y=v.ref.value*g.ref.value;G3e(d.layers.length?y:0,c.values);var b=m.ref.value.array;p&&j3e(b,0,y);for(var S=function(w,_){var E=d.layers[w],P=E.loci,D=E.groups,k=function(F){var X=Me.start(F),U=Me.end(F);return H3e(b,X,U,D)};f(P,k,!1)},x=0,C=d.layers.length;x<C;++x)S(x);N.update(m,m.ref.value)}}e.setClipping=u;function l(c,d,f){if(!(!c||!d&&!f)){var p=c.values;d&&(de.copy(p.matrix.ref.value,d),N.update(p.matrix,p.matrix.ref.value)),f?(p.extraTransform.ref.value.set(f),N.update(p.extraTransform,p.extraTransform.ref.value)):f===null&&(BC(p.extraTransform.ref.value,p.instanceCount.ref.value),N.update(p.extraTransform,p.extraTransform.ref.value)),OW(p);var h=ii(p.invariantBoundingSphere.ref.value,p.aTransform.ref.value,p.instanceCount.ref.value);N.update(p.boundingSphere,h)}}e.setTransform=l})(Pr||(Pr={}));function cn(e){return{layers:e}}(function(e){e.Empty={layers:[]},function(l){l.is=Oi.has;function c(m){return Oi.create(m)}l.create=c,l.Names={one:1,two:2,three:4,four:8,five:16,six:32};function d(m){return m in l.Names}l.isName=d;function f(m){switch(m){case"one":return 1;case"two":return 2;case"three":return 4;case"four":return 8;case"five":return 16;case"six":return 32}}l.fromName=f;function p(m){for(var v=0,g=0,y=m.length;g<y;++g)v|=f(m[g]);return v}l.fromNames=p;function h(m){var v=[];return l.is(m,1)&&v.push("one"),l.is(m,2)&&v.push("two"),l.is(m,4)&&v.push("three"),l.is(m,8)&&v.push("four"),l.is(m,16)&&v.push("five"),l.is(m,32)&&v.push("six"),v}l.toNames=h}(e.Groups||(e.Groups={})),e.Type={none:0,plane:1,sphere:2,cube:3,cylinder:4,infiniteCone:5};function t(l,c){if(l.layers.length===0&&c.layers.length===0)return!0;if(l.layers.length!==c.layers.length)return!1;for(var d=0,f=l.layers.length;d<f;++d)if(l.layers[d].groups!==c.layers[d].groups||!cr.areEqual(l.layers[d].loci,c.layers[d].loci))return!1;return!0}e.areEqual=t;function r(l){return l.layers.length===0}e.isEmpty=r;function n(l,c){for(var d=[],f=0,p=l.layers;f<p.length;f++){var h=p[f],m=h.loci,v=h.groups;m=Oe.remap(m,c),Oe.isEmpty(m)||d.push({loci:m,groups:v})}return{layers:d}}e.remap=n;function a(l){if(r(l))return l;for(var c=l.layers[0].loci.structure,d=new Map,f=Oe.none(c),p=0,h=l.layers.length;p<h;++p){var m=l.layers[h-p-1],v=m.loci,g=m.groups;v=Oe.subtract(v,f),f=Oe.union(v,f),Oe.isEmpty(v)||(d.has(g)&&(v=Oe.union(v,d.get(g))),d.set(g,v))}var y=[];return d.forEach(function(b,S){y.push({loci:b,groups:S})}),{layers:y}}e.merge=a;function i(l,c){if(r(l))return l;for(var d=l.layers[0].loci.structure,f=[],p=0,h=l.layers;p<h.length;p++){var m=h[p],v=m.loci,g=m.groups,y=Oe.remap(v,c);v=Oe.remap(y,d),Oe.isEmpty(v)||f.push({loci:v,groups:g})}return{layers:f}}e.filter=i;function o(l,c){for(var d=[],f=0,p=l.length;f<p;++f){var h=l[f],m=h.script,v=h.groups,g=yi.toLoci(m,c);Oe.isEmpty(g)||d.push({loci:g,groups:v})}return{layers:d}}e.ofScript=o;function s(l,c){for(var d=[],f=0,p=l.length;f<p;++f){var h=l[f],m=h.bundle,v=h.groups,g=sn.toLoci(m,c.root);d.push({loci:g,groups:v})}return{layers:d}}e.ofBundle=s;function u(l){for(var c=[],d=0,f=l.layers.length;d<f;++d){var p=l.layers[d],h=p.loci,m=p.groups,v=sn.fromLoci(h);c.push({bundle:v,groups:m})}return{layers:c}}e.toBundle=u})(cn||(cn={}));var y9;(function(e){function t(r,n,a){return M.getDefaultValues(r.getParams(n,a))}e.getDetaultParams=t})(y9||(y9={}));var Q8e={label:"",description:"",factory:function(){return mr.Empty},getParams:function(){return{}},defaultValues:{}};function b9(e){return e.map(function(t){return[t.name,t.provider.label]})}var IK=function(){function e(){this._list=[],this._map=new Map,this._name=new Map}return Object.defineProperty(e.prototype,"default",{get:function(){return this._list[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"types",{get:function(){return b9(this._list)},enumerable:!1,configurable:!0}),e.prototype.add=function(t){if(this._map.has(t.name))throw new Error(t.name+" already registered.");this._list.push({name:t.name,provider:t}),this._map.set(t.name,t),this._name.set(t,t.name)},e.prototype.getName=function(t){if(!this._name.has(t))throw new Error("'"+t.label+"' is not a registered represenatation provider.");return this._name.get(t)},e.prototype.remove=function(t){var r=t.name;this._list.splice(this._list.findIndex(function(a){return a.name===r}),1);var n=this._map.get(r);n&&(this._map.delete(r),this._name.delete(n))},e.prototype.get=function(t){return this._map.get(t)||Q8e},Object.defineProperty(e.prototype,"list",{get:function(){return this._list},enumerable:!1,configurable:!0}),e.prototype.getApplicableList=function(t){return this._list.filter(function(r){return r.provider.isApplicable(t)})},e.prototype.getApplicableTypes=function(t){return b9(this.getApplicableList(t))},e}(),mr;(function(e){(function(i){function o(u,l){return u.repr===l.repr&&cr.areEqual(u.loci,l.loci)}i.areEqual=o;function s(u){return cr.isEmpty(u.loci)}i.isEmpty=s,i.Empty={loci:zr}})(e.Loci||(e.Loci={}));function t(){return{visible:!0,alphaFactor:1,pickable:!0,colorOnly:!1,syncManually:!1,transform:de.identity(),overpaint:ri.Empty,transparency:ni.Empty,clipping:cn.Empty,markerActions:Wo.All}}e.createState=t;function r(i,o){o.visible!==void 0&&(i.visible=o.visible),o.alphaFactor!==void 0&&(i.alphaFactor=o.alphaFactor),o.pickable!==void 0&&(i.pickable=o.pickable),o.colorOnly!==void 0&&(i.colorOnly=o.colorOnly),o.overpaint!==void 0&&(i.overpaint=o.overpaint),o.transparency!==void 0&&(i.transparency=o.transparency),o.clipping!==void 0&&(i.clipping=o.clipping),o.syncManually!==void 0&&(i.syncManually=o.syncManually),o.transform!==void 0&&de.copy(i.transform,o.transform),o.markerActions!==void 0&&(i.markerActions=o.markerActions)}e.updateState=r,e.StateBuilder={create:t,update:r},e.Empty={label:"",groupCount:0,renderObjects:[],props:{},params:{},updated:new ha,state:t(),theme:Ia.createEmpty(),createOrUpdate:function(){return Qe.constant("",void 0)},setState:function(){},setTheme:function(){},getLoci:function(){return zr},mark:function(){return!1},destroy:function(){}};function n(i,o,s,u,l){var c=this,d=0,f=new ha,p=u.create(),h=Ia.createEmpty(),m,v,g,y={},b=Object.keys(l).map(function(S,x){y[x]=S;var C=l[S](o,s);return C.setState(p),C});return{label:i,updated:f,get groupCount(){var S=0;if(v)for(var x=v.visuals,C=0,w=b.length;C<w;++C)(!x||x.includes(y[C]))&&(S+=b[C].groupCount);return S},get renderObjects(){var S=[];if(v)for(var x=v.visuals,C=0,w=b.length;C<w;++C)(!x||x.includes(y[C]))&&S.push.apply(S,b[C].renderObjects);return S},get props(){return v},get params(){return m},createOrUpdate:function(S,x){S===void 0&&(S={}),x&&x!==g&&(m=s(o,x),g=x,v||(v=M.getDefaultValues(m)));var C=eI(Object.assign({},v,S),g);Object.assign(v,S,C);var w=v.visuals;return Qe.create("Creating or updating '"+i+"' representation",function(_){return pe(c,void 0,void 0,function(){var E,P;return he(this,function(D){switch(D.label){case 0:E=0,P=b.length,D.label=1;case 1:return E<P?!w||w.includes(y[E])?[4,b[E].createOrUpdate(v,g).runInContext(_)]:[3,3]:[3,4];case 2:D.sent(),D.label=3;case 3:return++E,[3,1];case 4:return f.next(d++),[2]}})})})},get state(){return p},get theme(){return h},getLoci:function(S){for(var x=v.visuals,C=0,w=b.length;C<w;++C)if(!x||x.includes(y[C])){var _=b[C].getLoci(S);if(!Ku(_))return _}return zr},mark:function(S,x){for(var C=!1,w=0,_=b.length;w<_;++w)C=b[w].mark(S,x)||C;return C},setState:function(S){u.update(p,S);for(var x=0,C=b.length;x<C;++x)b[x].setState(p)},setTheme:function(S){for(var x=0,C=b.length;x<C;++x)b[x].setTheme(S)},destroy:function(){for(var S=0,x=b.length;S<x;++S)b[S].destroy()}}}e.createMulti=n;function a(i,o){var s=this,u=0,l=new ha,c=e.createState(),d=Ia.createEmpty(),f=M.clone(Dt.Params),p=M.getDefaultValues(Dt.Params);return{label:i,updated:l,get groupCount(){return o.values.uGroupCount.ref.value},get renderObjects(){return[o]},get props(){return p},get params(){return f},createOrUpdate:function(h){h===void 0&&(h={});var m=eI(Object.assign({},p,h));return Object.assign(p,h,m),Qe.create("Updating '"+i+"' representation",function(v){return pe(s,void 0,void 0,function(){return he(this,function(g){return l.next(u++),[2]})})})},get state(){return c},get theme(){return d},getLoci:function(){return zr},mark:function(h,m){return!1},setState:function(h){h.visible!==void 0&&Pr.setVisibility(o,h.visible),h.alphaFactor!==void 0&&Pr.setAlphaFactor(o,h.alphaFactor),h.pickable!==void 0&&Pr.setPickable(o,h.pickable),h.colorOnly!==void 0&&Pr.setColorOnly(o,h.colorOnly),h.overpaint,h.transparency,h.transform!==void 0&&Pr.setTransform(o,h.transform),e.updateState(c,h)},setTheme:function(){},destroy:function(){}}}e.fromRenderObject=a})(mr||(mr={}));function Ga(e,t,r){r===void 0&&(r={});var n=0,a=new ha,i=mr.createState(),o=Vd(),s=[],u,l,c=Ia.createEmpty(),d=M.getDefaultValues(t.Params),f,p,h;r.modifyState&&mr.updateState(i,r.modifyState(i));var m=lc.create();function v(b,S){lc.reset(m),!(!S&&!l)&&(S&&!l?m.createNew=!0:S&&l&&S.id===l.id||(S&&l&&S.id!==l.id?(m.updateTransform=!0,m.createGeometry=!0):S&&console.warn("unexpected state")),m.updateTransform&&(m.updateColor=!0,m.updateSize=!0),m.createGeometry&&(m.updateColor=!0,m.updateSize=!0))}function g(b,S){var x=this;return b===void 0&&(b={}),r.modifyProps&&(b=r.modifyProps(b)),Qe.create("ShapeRepresentation.create",function(C){return pe(x,void 0,void 0,function(){var w,_,E,P,D,k,F,X;return he(this,function(U){switch(U.label){case 0:return w=Object.assign(d,b),S?[4,e(C,S,w,l)]:[3,2];case 1:return E=U.sent(),[3,3];case 2:E=void 0,U.label=3;case 3:if(_=E,v(b,_),_&&(l=_,Object.assign(c,Nr.getTheme(l))),m.createNew)s.length=0,p=Nr.groupIterator(l),P=Nr.createTransform(l.transforms),D=t.createValues(l.geometry,P,p,c,w),k=t.createRenderableState(w),r.modifyState&&Object.assign(k,r.modifyState(k)),mr.updateState(i,k),u=U0(l.geometry.kind,D,k,o),u&&s.push(u),h=t.createPositionIterator(l.geometry,u.values);else{if(!u)throw new Error("expected renderObject to be available");m.updateTransform&&(Nr.createTransform(l.transforms,u.values),p=Nr.groupIterator(l),F=p.instanceCount,X=p.groupCount,xu(F*X,u.values)),m.createGeometry&&(N.updateIfChanged(u.values.drawCount,xi.getDrawCount(l.geometry)),N.updateIfChanged(u.values.uVertexCount,xi.getVertexCount(l.geometry))),(m.updateTransform||m.createGeometry)&&(t.updateBoundingSphere(u.values,l.geometry),h=t.createPositionIterator(l.geometry,u.values)),m.updateColor&&Ds(p,h,c.color,u.values),m.updateSize&&"uSize"in u.values&&Dd(p,c.size,u.values),t.updateValues(u.values,w),t.updateRenderableState(u.state,w)}return d=w,a.next(n++),[2]}})})})}function y(b,S){return uu(b)||Nr.isLoci(b)&&b.shape===l?S(Me.ofBounds(0,l.groupCount*l.transforms.length)):Z8e(b,l,S)}return{label:"Shape geometry",get groupCount(){return p?p.count:0},get props(){return d},get params(){return f},get state(){return i},get theme(){return c},renderObjects:s,updated:a,createOrUpdate:g,getLoci:function(b){if(b===void 0)return Nr.Loci(l);var S=b.objectId,x=b.groupId,C=b.instanceId;return u&&u.id===S?po.Loci(l,[{ids:Ne.ofSingleton(x),instance:C}]):zr},mark:function(b,S){if(!Wo.is(i.markerActions,S))return!1;if(po.isLoci(b)||Nr.isLoci(b)){if(b.shape!==l)return!1}else if(!uu(b))return!1;return Pr.mark(u,b,S,y)},setState:function(b){r.modifyState&&(b=r.modifyState(b)),u&&(b.visible!==void 0&&Pr.setVisibility(u,b.visible),b.alphaFactor!==void 0&&Pr.setAlphaFactor(u,b.alphaFactor),b.pickable!==void 0&&Pr.setPickable(u,b.pickable),b.colorOnly!==void 0&&Pr.setColorOnly(u,b.colorOnly),b.overpaint!==void 0&&Pr.setOverpaint(u,b.overpaint,y,!0),b.transparency!==void 0&&Pr.setTransparency(u,b.transparency,y,!0),b.transform!==void 0&&Pr.setTransform(u,b.transform)),mr.updateState(i,b)},setTheme:function(b){Fr&&console.warn("The `ShapeRepresentation` theme is fixed to `ShapeGroupColorTheme` and `ShapeGroupSizeTheme`. Colors are taken from `Shape.getColor` and sizes from `Shape.getSize`")},destroy:function(){s.length=0,u&&(u.state.disposed=!0,u=void 0)}}}function Z8e(e,t,r){if(!po.isLoci(e)||e.shape!==t)return!1;for(var n=!1,a=t.groupCount,i=e.groups,o=0,s=i;o<s.length;o++){var u=s[o],l=u.ids,c=u.instance;if(Me.is(l)){var d=c*a+Me.start(l),f=c*a+Me.end(l);r(Me.ofBounds(d,f))&&(n=!0)}else for(var p=0,h=l.length;p<h;p++){var m=c*a+l[p];r(Me.ofSingleton(m))&&(n=!0)}}return n}var x9=de(),C0=function(){function e(t){this.structure=t,this.groupUnitTransforms=[],this.unitOffsetMap=hu.Mutable(),this.groupIndexMap=hu.Mutable(),this._isIdentity=void 0,this.version=0,this.unitTransforms=new Float32Array(t.units.length*16),this.size=t.units.length,this.reset();for(var r=0,n=0,a=t.unitSymmetryGroups.length;n<a;++n){var i=t.unitSymmetryGroups[n];this.groupIndexMap.set(i.hashCode,n);var o=this.unitTransforms.subarray(r,r+i.units.length*16);this.groupUnitTransforms.push(o);for(var s=0,u=i.units.length;s<u;++s)this.unitOffsetMap.set(i.units[s].id,r+s*16);r+=i.units.length*16}}return e.prototype.reset=function(){this.version=0,BC(this.unitTransforms,this.size),this._isIdentity=!0},Object.defineProperty(e.prototype,"isIdentity",{get:function(){if(this._isIdentity===void 0){this._isIdentity=!0;for(var t=0,r=this.size*16;t<r;t+=16)if(de.fromArray(x9,this.unitTransforms,t),!de.isIdentity(x9)){this._isIdentity=!1;break}}return this._isIdentity},enumerable:!1,configurable:!0}),e.prototype.setTransform=function(t,r){this.version=(this.version+1)%2147483647,de.toArray(t,this.unitTransforms,this.unitOffsetMap.get(r.id)),this._isIdentity=void 0},e.prototype.getTransform=function(t,r){return de.fromArray(t,this.unitTransforms,this.unitOffsetMap.get(r.id))},e.prototype.getSymmetryGroupTransforms=function(t){return this.groupUnitTransforms[this.groupIndexMap.get(t.hashCode)]},e}(),S9=de.zero();function C9(e,t,r){for(var n=0,a=e.units.length;n<a;n++){var i=e.units[n];An.lerpFromIdentity(S9,i.conformation.operator,r),t.setTransform(S9,i)}}var w9=A.zero(),Rv=A.zero(),ZC=de.zero();function _9(e,t,r){for(var n=e.boundary.sphere,a=n.radius*r,i=0,o=e.units.length;i<o;i++){var s=e.units[i];A.transformMat4(w9,s.lookup3d.boundary.sphere.center,s.conformation.operator.matrix),A.sub(Rv,w9,n.center),A.setMagnitude(Rv,Rv,a),de.fromTranslation(ZC,Rv),t.setTransform(ZC,s)}}var J8e={axis:M.MappedStatic("custom",{structure:M.Group({principalAxis:M.Select("dirA",[["dirA","A"],["dirB","B"],["dirC","C"]])}),custom:M.Group({vector:M.Vec3(A.create(0,0,1))})}),origin:M.MappedStatic("structure",{structure:M.Group({}),custom:M.Group({vector:M.Vec3(A.create(0,0,0))})})};function A9(e,t){var r,n;if(t.axis.name==="custom")r=t.axis.params.vector;else{var a=$e.getPrincipalAxes(e);r=a.momentsAxes[t.axis.params.principalAxis]}if(t.origin.name==="custom")n=t.origin.params.vector;else{var a=$e.getPrincipalAxes(e);n=a.momentsAxes.origin}return{axis:r,origin:n}}var T9=de(),E9=de(),nx=de();function P9(e,t,r,n,a){for(var i=0,o=e.units.length;i<o;i++){var s=e.units[i];A.negate(Rv,a),de.fromTranslation(ZC,Rv),de.fromRotation(T9,Math.PI*r*2,n),de.fromTranslation(E9,a),de.mul(nx,T9,ZC),de.mul(nx,E9,nx),t.setTransform(nx,s)}}var eOe=de.fromTranslation(de(),A.create(.5,.5,.5)),tOe=VW(UW(jW()),eOe),Du=A(),I9=de(),rOe={origin:"Origin",model:"Model"},nOe={corner:"Corner",center:"Center"},aOe=T(T({},Wt.Params),{cellColor:M.Color(gr.orange),cellScale:M.Numeric(2,{min:.1,max:5,step:.1}),ref:M.Select("model",M.objectToOptions(rOe),{isEssential:!0}),attachment:M.Select("corner",M.objectToOptions(nOe),{isEssential:!0})}),iOe={mesh:function(e,t){return Ga(sOe,Wt.Utils)}},M9=T({},aOe);function oOe(e,t,r){var n=kt.createState(256,128,r),a=e.symmetry.spacegroup.cell.fromFractional;A.copy(Du,e.ref),t.attachment==="center"?(A.trunc(Du,Du),A.subScalar(Du,Du,.5)):A.floor(Du,Du),de.fromTranslation(I9,Du);var i=VW(UW(tOe),I9),o=Math.cbrt(e.symmetry.spacegroup.cell.volume)/300*t.cellScale;n.currentGroup=1,kt.addCage(n,a,i,o,2,20);var s=He.fromDimensionsAndTransform(He(),A.unit,a);A.transformMat4(Du,Du,a),He.translate(s,s,Du),He.expand(s,s,o);var u=kt.getMesh(n);return u.setBoundingSphere(s),u}function sOe(e,t,r,n){var a=oOe(t,r,n&&n.geometry),i=B1.getUnitcellLabel(t.symmetry);return Nr.create(i,t,a,function(){return r.cellColor},function(){return 1},function(){return i})}function D9(e,t,r){var n=A();return r.ref==="model"&&A.transformMat4(n,rr.getCenter(e),t.spacegroup.cell.toFractional),{symmetry:t,ref:n}}function uOe(e,t){return mr.createMulti("Unit Cell",e,t,mr.StateBuilder,iOe)}var Us=new Uint16Array([0,1,2,1,3,2]),eh=Ke.add3,di=Ke.add2,k9=Ke.add,Sd;(function(e){function t(r,n,a,i){r===void 0&&(r={}),n===void 0&&(n=2048),a===void 0&&(a=1024),n*=2,a*=2;var o=Ke.create(Float32Array,3,a,i?i.centerBuffer.ref.value:n),s=Ke.create(Float32Array,2,a,i?i.mappingBuffer.ref.value:n),u=Ke.create(Float32Array,1,a,i?i.depthBuffer.ref.value:n),l=Ke.create(Uint32Array,3,a,i?i.indexBuffer.ref.value:n),c=Ke.create(Float32Array,1,a,i?i.groupBuffer.ref.value:n),d=Ke.create(Float32Array,2,a,i?i.tcoordBuffer.ref.value:n),f=T(T({},M.getDefaultValues(mu.Params)),r),p=f.attachment,h=f.background,m=f.backgroundMargin,v=f.tether,g=f.tetherLength,y=f.tetherBaseWidth,b=q3e(f),S=1/2.5*m,x=b.buffer/b.lineHeight,C=function(w,_,E,P,D){eh(o,w,_,E),k9(u,P),k9(c,D)};return{add:function(w,_,E,P,D,k,F){for(var X=0,U=w.length,j=0;j<U;++j){var te=b.get(w[j]);X+=te.nw-2*x}var q=1/1.25,W,V;if(p.startsWith("top")?W=q:p.startsWith("middle")?W=q/2:W=0,p.endsWith("right")?V=X:p.endsWith("center")?V=X/2:V=0,v)switch(p){case"bottom-left":V-=g/2+S+.1,W-=g/2+S;break;case"bottom-center":W-=g+S;break;case"bottom-right":V+=g/2+S+.1,W-=g/2+S;break;case"middle-left":V-=g+S+.1;break;case"middle-center":break;case"middle-right":V+=g+S+.1;break;case"top-left":V-=g/2+S+.1,W+=g/2+S;break;case"top-center":W+=g+S;break;case"top-right":V+=g/2+S+.1,W+=g/2+S;break}var ee=(-V-S-.1)*k,ue=(X-V+S+.1)*k,$=(q-W+S)*k,Q=(-W-S)*k;if(h){di(s,ee,$),di(s,ee,Q),di(s,ue,$),di(s,ue,Q);for(var R=o.elementCount,Y=0;Y<4;++Y)di(d,10,10),C(_,E,P,D,F);eh(l,R+Us[0],R+Us[1],R+Us[2]),eh(l,R+Us[3],R+Us[4],R+Us[5])}if(v){var re=void 0,K=void 0,L=void 0,H=void 0,Z=void 0,fe=void 0,me=void 0,xe=void 0,Se=g*k,ie=y*k;switch(p){case"bottom-left":re=ee-Se/2,L=ee+ie/2,Z=ee,me=ee,K=Q-Se/2,H=Q,fe=Q+ie/2,xe=Q;break;case"bottom-center":re=0,L=ie/2,Z=-ie/2,me=0,K=Q-Se,H=Q,fe=Q,xe=Q;break;case"bottom-right":re=ue+Se/2,L=ue,Z=ue-ie/2,me=ue,K=Q-Se/2,H=Q+ie/2,fe=Q,xe=Q;break;case"middle-left":re=ee-Se,L=ee,Z=ee,me=ee,K=0,H=-ie/2,fe=ie/2,xe=0;break;case"middle-center":re=0,L=0,Z=0,me=0,K=0,H=0,fe=0,xe=0;break;case"middle-right":re=ue+Se,L=ue,Z=ue,me=ue,K=0,H=ie/2,fe=-ie/2,xe=0;break;case"top-left":re=ee-Se/2,L=ee+ie/2,Z=ee,me=ee,K=$+Se/2,H=$,fe=$-ie/2,xe=$;break;case"top-center":re=0,L=ie/2,Z=-ie/2,me=0,K=$+Se,H=$,fe=$,xe=$;break;case"top-right":re=ue+Se/2,L=ue,Z=ue-ie/2,me=ue,K=$+Se/2,H=$-ie/2,fe=$,xe=$;break;default:throw new Error("unsupported attachment")}di(s,re,K),di(s,L,H),di(s,Z,fe),di(s,me,xe);for(var R=o.elementCount,Y=0;Y<4;++Y)di(d,10,10),C(_,E,P,D,F);eh(l,R,R+1,R+3),eh(l,R,R+3,R+2)}V+=x,W+=x;for(var le=0,j=0;j<U;++j){var te=b.get(w[j]),O=(le-V)*k,G=(le+te.nw-V)*k,ve=(te.nh-W)*k,we=-W*k;di(s,O,ve),di(s,O,we),di(s,G,ve),di(s,G,we);var Te=b.texture.width,Ue=b.texture.height;di(d,te.x/Te,te.y/Ue),di(d,te.x/Te,(te.y+te.h)/Ue),di(d,(te.x+te.w)/Te,te.y/Ue),di(d,(te.x+te.w)/Te,(te.y+te.h)/Ue),le+=te.nw-2*x;for(var R=o.elementCount,Y=0;Y<4;++Y)C(_,E,P,D,F);eh(l,R+Us[0],R+Us[1],R+Us[2]),eh(l,R+Us[3],R+Us[4],R+Us[5])}},getText:function(){var w=b.texture,_=Ke.compact(o,!0),E=Ke.compact(s,!0),P=Ke.compact(u,!0),D=Ke.compact(l,!0),k=Ke.compact(c,!0),F=Ke.compact(d,!0);return mu.create(w,_,E,P,D,k,F,l.elementCount/2,i)}}}e.create=t})(Sd||(Sd={}));var G0={granularity:"element",condensed:!1,reverse:!1,countsOnly:!1,hidePrefix:!1,htmlStyling:!0};function wp(e,t){switch(t===void 0&&(t={}),e.kind){case"structure-loci":return e.structure.models.map(function(l){return l.entry}).filter(function(l){return!!l}).join(", ");case"element-loci":return JC(Kf.ofLoci(e),t);case"bond-loci":var r=e.bonds[0];return r?Hk(r):"";case"shape-loci":return e.shape.name;case"group-loci":var n=e.groups[0];return n?e.shape.getLabel(Ne.start(n.ids),n.instance):"";case"every-loci":return"Everything";case"empty-loci":return"Nothing";case"data-loci":return e.getLabel();case"volume-loci":return e.volume.label||"Volume";case"isosurface-loci":return[""+(e.volume.label||"Volume"),"Isosurface at "+It.IsoValue.toString(e.isoValue)].join(" | ");case"cell-loci":var a=Ne.size(e.indices),i=Ne.start(e.indices),o=It.IsoValue.absolute(e.volume.grid.cells.data[i]),s=It.IsoValue.toRelative(o,e.volume.grid.stats),u=[""+(e.volume.label||"Volume"),a===1?"Cell #"+i:a+" Cells"];return a===1&&u.push(It.IsoValue.toString(o)+" ("+It.IsoValue.toString(s)+")"),u.join(" | ")}}function pv(e,t){return e===1?"1 "+t:e+" "+t+"s"}function Tg(e,t,r,n,a,i){return Ou(t,{granularity:r,hidePrefix:n,reverse:a,condensed:i})+" <small>[+ "+pv(e-1,"other "+k0(r))+"]</small>"}function lOe(e){var t=e.elements,r=e.model,n=r.atomicHierarchy,a=n.chainAtomSegments,i=n.residueAtomSegments,o=a.offsets[a.index[t[0]]],s=a.offsets[a.index[t[t.length-1]]+1]-1;return i.index[s]-i.index[o]+1}function JC(e,t){t===void 0&&(t={});var r=T(T({},G0),t),n=cOe(e,r.countsOnly,r.hidePrefix,r.condensed,r.reverse);return r.htmlStyling?n:jf(n)}function cOe(e,t,r,n,a){t===void 0&&(t=!1),r===void 0&&(r=!1),n===void 0&&(n=!1),a===void 0&&(a=!1);var i=e.structureCount,o=e.chainCount,s=e.residueCount,u=e.conformationCount,l=e.elementCount;if(!t&&l===1&&s===0&&o===0)return Ou(e.firstElementLoc,{hidePrefix:r,condensed:n,granularity:"element",reverse:a});if(!t&&l===0&&s===1&&o===0)return Ou(e.firstResidueLoc,{hidePrefix:r,condensed:n,granularity:"residue",reverse:a});if(!t&&l===0&&s===0&&o===1){var c=e.firstChainLoc.unit,d=We.isAtomic(c)&&lOe(c)===1||We.Traits.is(c.traits,1)?"residue":"chain";return Ou(e.firstChainLoc,{hidePrefix:r,condensed:n,granularity:d,reverse:a})}else if(t){var f=[];return i>0&&f.push(pv(i,"Structure")),o>0&&f.push(pv(o,"Chain")),s>0&&f.push(pv(s,"Residue")),u>0&&f.push(pv(u,"Conformation")),l>0&&f.push(pv(l,"Element")),f.join("<small> + </small>")}else{var f=[];return i>0&&f.push(i===1?Ou(e.firstStructureLoc,{hidePrefix:r,condensed:n,granularity:"structure",reverse:a}):Tg(i,e.firstStructureLoc,"structure",r,a,n)),o>0&&(f.push(o===1?Ou(e.firstChainLoc,{condensed:n,granularity:"chain",hidePrefix:r,reverse:a}):Tg(o,e.firstChainLoc,"chain",r,a,n)),r=!0),s>0&&(f.push(s===1?Ou(e.firstResidueLoc,{condensed:n,granularity:"residue",hidePrefix:r,reverse:a}):Tg(s,e.firstResidueLoc,"residue",r,a,n)),r=!0),u>0&&(f.push(u===1?Ou(e.firstConformationLoc,{condensed:n,granularity:"conformation",hidePrefix:r,reverse:a}):Tg(u,e.firstConformationLoc,"conformation",r,a,n)),r=!0),l>0&&f.push(l===1?Ou(e.firstElementLoc,{condensed:n,granularity:"element",hidePrefix:r,reverse:a}):Tg(l,e.firstElementLoc,"element",r,a,n)),f.join("<small> + </small>")}}function Hk(e,t){return t===void 0&&(t={}),h_({loci:[Oe(e.aStructure,[{unit:e.aUnit,indices:Ne.ofSingleton(e.aIndex)}]),Oe(e.bStructure,[{unit:e.bUnit,indices:Ne.ofSingleton(e.bIndex)}])]},t)}function h_(e,t){t===void 0&&(t={});var r=T(T({},G0),t),n=dOe(e,r);return r.htmlStyling?n:jf(n)}function dOe(e,t){for(var r=t.granularity,n=t.hidePrefix,a=t.reverse,i=t.condensed,o=!0,s=0,u=e.loci;s<u.length;s++){var l=u[s];if(!Oe.is(l)||Oe.size(l)!==1){o=!1;break}}if(o){var c=e.loci.map(function(b){var S=b.elements[0],x=S.unit,C=S.indices;return ot.create(b.structure,x,x.elements[Ne.start(C)])}),d=c.map(function(b){return MK(b,r,n,a||i)});if(i)return d.map(function(b){return b[0].replace(/\[.*\]/g,"").trim()}).filter(function(b){return!!b}).join(" \u2014 ");for(var f=0,p=0,h=Math.min.apply(Math,d.map(function(b){return b.length}))-1;p<h;++p){for(var m=!0,v=1,g=d.length;v<g;++v)if(d[0][p]!==d[v][p]){m=!1;break}if(m)f+=1;else break}if(f>0){for(var y=[d[0].join(" | ")],v=1,g=d.length;v<g;++v)y.push(d[v].slice(f).filter(function(x){return!!x}).join(" | "));return y.join(" \u2014 ")}else return d.map(function(b){return b.filter(function(S){return!!S}).join(" | ")}).filter(function(b){return!!b}).join("</br>")}else{var d=e.loci.map(function(S){return wp(S,t)});return d.filter(function(S){return!!S}).join(i?" \u2014 ":"</br>")}}function Ou(e,t){var r,n;t===void 0&&(t={});var a=T(T({},G0),t),i=MK(e,a.granularity,a.hidePrefix,a.reverse||a.condensed),o=a.condensed?(n=(r=i[0])===null||r===void 0?void 0:r.replace(/\[.*\]/g,"").trim())!==null&&n!==void 0?n:"":i.filter(function(s){return!!s}).join(" | ");return a.htmlStyling?o:jf(o)}function MK(e,t,r,n){t===void 0&&(t="element"),r===void 0&&(r=!1),n===void 0&&(n=!1);var a=[];if(!r){var i=e.unit.model.entry;i.length>30&&(i=i.substr(0,27)+"\u2026"),a.push("<small>"+i+"</small>"),t!=="structure"&&(a.push("<small>Model "+e.unit.model.modelNum+"</small>"),a.push("<small>Instance "+e.unit.conformation.operator.name+"</small>"))}return We.isAtomic(e.unit)?a.push.apply(a,fOe(e,t,n)):We.isCoarse(e.unit)?a.push.apply(a,pOe(e,t)):a.push("Unknown"),n?a.reverse():a}function fOe(e,t,r){r===void 0&&(r=!1);var n=ot.residueIndex(e),a=mt.chain.label_asym_id(e),i=mt.chain.auth_asym_id(e),o=e.unit.model.atomicHierarchy.residues.label_seq_id.valueKind(n)===0,s=mt.residue.label_seq_id(e),u=mt.residue.auth_seq_id(e),l=mt.residue.pdbx_PDB_ins_code(e),c=mt.atom.label_comp_id(e),d=mt.atom.label_atom_id(e),f=mt.atom.label_alt_id(e),p=mt.atom.occupancy(e),h=mt.residue.microheterogeneityCompIds(e),m=t==="residue"&&h.length>1?"("+h.join("|")+")":c,v=[];switch(t){case"element":v.push("<b>"+d+"</b>"+(f?"%"+f:""));case"conformation":t==="conformation"&&f&&v.push("<small>Conformation</small> <b>"+f+"</b>");case"residue":var g=s===u||!o?u:s;v.push("<b>"+m+" "+g+"</b>"+(g!==u?" <small>[auth</small> <b>"+u+"</b><small>]</small>":"")+"<b>"+(l||"")+"</b>");case"chain":a===i?v.push("<b>"+a+"</b>"):t==="chain"&&We.Traits.is(e.unit.traits,1)?v.push("<small>[auth</small> <b>"+i+"</b><small>]</small>"):v.push("<b>"+a+"</b> <small>[auth</small> <b>"+i+"</b><small>]</small>")}return v.length>0&&p!==1&&!r&&(v[0]=v[0]+" <small>[occupancy</small> <b>"+Math.round(100*p)/100+"</b><small>]</small>"),v.reverse()}function pOe(e,t){var r=mt.coarse.asym_id(e),n=mt.coarse.seq_id_begin(e),a=mt.coarse.seq_id_end(e),i=[];switch(t){case"element":case"conformation":case"residue":if(n===a){var o=mt.coarse.entityKey(e),s=e.unit.model.sequence.byEntityKey[o],u=s.sequence.compId.value(n-1);i.push("<b>"+u+" "+n+"</b>")}else i.push("<b>"+n+"-"+a+"</b>");case"chain":i.push("<b>"+r+"</b>")}return i.reverse()}function m_(e,t){t===void 0&&(t={});var r=T(T(T({},G0),{measureOnly:!1,unitLabel:"\u212B"}),t),n=e.loci.map(function(u){return cr.getCenter(u)}),a=n[0],i=n[1],o=A.distance(a,i).toFixed(2)+" "+r.unitLabel;if(r.measureOnly)return o;var s=h_(e,r);return r.condensed?o+" | "+s:"Distance "+o+"</br>"+s}function v_(e,t){t===void 0&&(t={});var r=T(T(T({},G0),{measureOnly:!1}),t),n=e.loci.map(function(d){return cr.getCenter(d)}),a=n[0],i=n[1],o=n[2],s=A.sub(A(),a,i),u=A.sub(A(),o,i),l=qu(A.angle(s,u)).toFixed(2)+"\xB0";if(r.measureOnly)return l;var c=h_(e,r);return r.condensed?l+" | "+c:"Angle "+l+"</br>"+c}function g_(e,t){t===void 0&&(t={});var r=T(T(T({},G0),{measureOnly:!1}),t),n=e.loci.map(function(c){return cr.getCenter(c)}),a=n[0],i=n[1],o=n[2],s=n[3],u=qu(A.dihedralAngle(a,i,o,s)).toFixed(2)+"\xB0";if(r.measureOnly)return u;var l=h_(e,r);return r.condensed?u+" | "+l:"Dihedral "+u+"</br>"+l}var DK={customText:M.Text("",{label:"Text",description:"Override the label with custom value."}),textColor:M.Color(gr.black,{isEssential:!0}),textSize:M.Numeric(.5,{min:.1,max:5,step:.1},{isEssential:!0})},y_=T(T(T({},mu.Params),DK),{borderWidth:M.Numeric(.2,{min:0,max:.5,step:.01})}),kK={unitLabel:M.Text("\u212B",{isEssential:!0})},hOe=T(T(T({},Mn.Params),kK),{lineSizeAttenuation:M.Boolean(!0),linesColor:M.Color(gr.lightgreen,{isEssential:!0}),linesSize:M.Numeric(.075,{min:.01,max:5,step:.01}),dashLength:M.Numeric(.2,{min:.01,max:.2,step:.01})}),mOe=T(T({},y_),kK),RK={lines:function(e,t){return Ga(yOe,Mn.Utils,{modifyState:function(r){return T(T({},r),{markerActions:Wo.Highlighting})}})},text:function(e,t){return Ga(xOe,mu.Utils,{modifyState:function(r){return T(T({},r),{markerActions:sr.None})}})}},R9=T(T(T({},hOe),mOe),{visuals:M.MultiSelect(["lines","text"],M.objectToOptions(RK))});function vOe(){return{sphereA:He(),sphereB:He(),center:A(),distance:0}}function OK(e,t){var r=t.sphereA,n=t.sphereB,a=t.center,i=e.loci,o=i[0],s=i[1];return cr.getBoundingSphere(o,r),cr.getBoundingSphere(s,n),A.add(a,r.center,n.center),A.scale(a,a,.5),t.distance=A.distance(r.center,n.center),t}var Ff=vOe();function BK(e,t){return e.pairs.length===1?"Distance "+m_(e.pairs[0],{unitLabel:t,measureOnly:!0}):e.pairs.length+" Distances"}function gOe(e,t,r){for(var n=_s.create(128,64,r),a=0,i=e.pairs.length;a<i;++a)OK(e.pairs[a],Ff),n.addFixedLengthDashes(Ff.sphereA.center,Ff.sphereB.center,t.dashLength,a);return n.getLines()}function yOe(e,t,r,n){var a=gOe(t,r,n&&n.geometry),i=BK(t,r.unitLabel),o=function(s){return m_(t.pairs[s],r)};return Nr.create(i,t,a,function(){return r.linesColor},function(){return r.linesSize},o)}function bOe(e,t,r){for(var n=Sd.create(t,128,64,r),a=0,i=e.pairs.length;a<i;++a){OK(e.pairs[a],Ff);var o=Ff.center,s=Ff.distance,u=Ff.sphereA,l=Ff.sphereB,c=t.customText||s.toFixed(2)+" "+t.unitLabel,d=Math.max(2,u.radius,l.radius),f=d/2;n.add(c,o[0],o[1],o[2],1,f,a)}return n.getText()}function xOe(e,t,r,n){var a=bOe(t,r,n&&n.geometry),i=BK(t,r.unitLabel),o=function(s){return m_(t.pairs[s],r)};return Nr.create(i,t,a,function(){return r.textColor},function(){return r.textSize},o)}function SOe(e,t){return mr.createMulti("Distance",e,t,mr.StateBuilder,RK)}function O9(e){var t=e[0].loci,r=e[1].loci;return{pairs:[{loci:[t,r]}]}}function B9(e){var t=e[0].loci,r=e[1].loci,n=e[2].loci;return{triples:[{loci:[t,r,n]}]}}function F9(e){var t=e[0].loci,r=e[1].loci,n=e[2].loci,a=e[3].loci;return{quads:[{loci:[t,r,n,a]}]}}function L9(e){var t=e[0].loci;return{infos:[{loci:t}]}}function N9(e){var t=e[0].loci;return{locis:[t]}}var COe=T(T({},y_),{offsetZ:M.Numeric(2,{min:0,max:10,step:.1})}),FK={text:function(e,t){return Ga(TOe,mu.Utils,{modifyState:function(r){return T(T({},r),{pickable:!1})}})}},z9=T(T({},COe),{scaleByRadius:M.Boolean(!0),visuals:M.MultiSelect(["text"],M.objectToOptions(FK))}),wOe=He();function jk(e,t){return t===void 0&&(t=!1),e.label||wp(e.loci,{hidePrefix:!0,htmlStyling:!1,condensed:t})}function _Oe(e){return e.infos.length===1?jk(e.infos[0]):e.infos.length+" Labels"}function AOe(e,t,r){for(var n=Sd.create(t,128,64,r),a=t.customText.trim(),i=0,o=e.infos.length;i<o;++i){var s=e.infos[i],u=cr.getBoundingSphere(s.loci,wOe);if(!!u){var l=u.center,c=u.radius,d=a||jk(s,!0);n.add(d,l[0],l[1],l[2],t.scaleByRadius?c/.9:0,t.scaleByRadius?Math.max(1,c):1,i)}}return n.getText()}function TOe(e,t,r,n){var a=AOe(t,r,n&&n.geometry),i=_Oe(t),o=r.customText.trim(),s=o?function(u){return o}:function(u){return jk(t.infos[u])};return Nr.create(i,t,a,function(){return r.textColor},function(){return r.textSize},s)}function EOe(e,t){return mr.createMulti("Label",e,t,mr.StateBuilder,FK)}var th=A(),POe=de.identity(),rh=new Float32Array(6*3),IOe=new Uint8Array([0,1,2,3,4,5]);function MOe(e,t,r,n,a){var i=t.origin,o=t.dirA,s=t.dirB,u=t.dirC;A.add(th,i,o),A.toArray(A.add(th,i,o),rh,0),A.toArray(A.sub(th,i,o),rh,3),A.toArray(A.add(th,i,s),rh,6),A.toArray(A.sub(th,i,s),rh,9),A.toArray(A.add(th,i,u),rh,12),A.toArray(A.sub(th,i,u),rh,15);var l=gk(rh,IOe),c=Hu.volume(t),d=Math.cbrt(c)/300*r;kt.addCage(e,POe,l,d,n,a)}A.zero();A.zero();var af=A(),DOe=A(),kOe=A(),ROe=A(),OOe=de.identity(),U9=new Float32Array(8*3),BOe=new Uint8Array([0,1,0,3,0,6,1,2,1,7,2,3,2,4,3,5,4,5,4,7,5,6,6,7]);function FOe(e,t,r,n,a){var i=t.origin,o=t.dirA,s=t.dirB,u=t.dirC,l=A.negate(DOe,o),c=A.negate(kOe,s),d=A.negate(ROe,u),f=0,p=function(g,y,b){A.copy(af,i),A.add(af,af,g),A.add(af,af,y),A.add(af,af,b),A.toArray(af,U9,f),f+=3};p(o,s,u),p(o,s,d),p(o,c,d),p(o,c,u),p(l,c,d),p(l,c,u),p(l,s,u),p(l,s,d);var h=gk(U9,BOe),m=Hu.volume(t),v=Math.cbrt(m)/300*r;kt.addCage(e,OOe,h,v,n,a)}var LOe=de.identity(),V9=A();function NOe(e,t,r,n,a){return A.add(V9,t,r),de.targetTo(e,t,V9,n),de.setTranslation(e,t),de.scale(e,e,a)}function Gk(e,t,r,n,a,i){kt.addPrimitive(e,NOe(LOe,t,r,n,a),sX(i))}var qk={color:M.Color(gr.orange),scale:M.Numeric(2,{min:.1,max:10,step:.1})},zOe=T(T({},Wt.Params),qk),UOe=T(T({},Wt.Params),qk);T(T({},Wt.Params),qk);var LK={axes:function(e,t){return Ga(HOe,Wt.Utils)},box:function(e,t){return Ga(GOe,Wt.Utils)},ellipsoid:function(e,t){return Ga(WOe,Wt.Utils)}},H9=T(T(T({},zOe),UOe),{visuals:M.MultiSelect(["box"],M.objectToOptions(LK)),color:M.Color(gr.orange),scale:M.Numeric(2,{min:.1,max:5,step:.1})});function b_(e){var t=wp(e,{countsOnly:!0});return"Principal Axes of "+t}function Wk(e){return e.locis.length===1?b_(e.locis[0]):e.locis.length+" Orientations"}function VOe(e,t,r){for(var n=kt.createState(256,128,r),a=0,i=e.locis.length;a<i;++a){var o=cr.getPrincipalAxes(e.locis[a]);o&&(n.currentGroup=a,MOe(n,o.momentsAxes,t.scale,2,20))}return kt.getMesh(n)}function HOe(e,t,r,n){var a=VOe(t,r,n&&n.geometry),i=Wk(t),o=function(s){return b_(t.locis[s])};return Nr.create(i,t,a,function(){return r.color},function(){return 1},o)}function jOe(e,t,r){for(var n=kt.createState(256,128,r),a=0,i=e.locis.length;a<i;++a){var o=cr.getPrincipalAxes(e.locis[a]);o&&(n.currentGroup=a,FOe(n,o.boxAxes,t.scale,2,20))}return kt.getMesh(n)}function GOe(e,t,r,n){var a=jOe(t,r,n&&n.geometry),i=Wk(t),o=function(s){return b_(t.locis[s])};return Nr.create(i,t,a,function(){return r.color},function(){return 1},o)}function qOe(e,t,r){for(var n=kt.createState(256,128,r),a=0,i=e.locis.length;a<i;++a){var o=cr.getPrincipalAxes(e.locis[a]);if(o){var s=o.boxAxes,u=s.origin,l=s.dirA,c=s.dirB,d=Hu.size(A(),s);A.scale(d,d,.5);var f=A.create(d[2],d[1],d[0]);n.currentGroup=a,Gk(n,u,l,c,f,2)}}return kt.getMesh(n)}function WOe(e,t,r,n){var a=qOe(t,r,n&&n.geometry),i=Wk(t),o=function(s){return b_(t.locis[s])};return Nr.create(i,t,a,function(){return r.color},function(){return 1},o)}function XOe(e,t){var r=mr.createMulti("Orientation",e,t,mr.StateBuilder,LK);return r.setState({markerActions:Wo.Highlighting}),r}var YOe={radius:1,segments:36,thetaStart:0,thetaLength:Math.PI*2};function NK(e){var t=T(T({},YOe),e),r=t.radius,n=t.segments,a=t.thetaStart,i=t.thetaLength,o=i===Math.PI*2,s=o?n+1:n+2,u=new Float32Array(s*3),l=new Float32Array(s*3),c=new Uint32Array(n*3);u[0]=0,u[1]=0,u[2]=0,l[0]=0,l[1]=1,l[2]=0;for(var d=0,f=3;d<n;++d,f+=3){var p=a+d/n*i;u[f]=r*Math.sin(p),u[f+1]=0,u[f+2]=r*Math.cos(p),l[f]=0,l[f+1]=1,l[f+2]=0}for(var d=1,f=0;d<n;++d,f+=3)c[f]=d,c[f+1]=d+1,c[f+2]=0;if(o){var h=(n-1)*3;c[h]=n,c[h+1]=1,c[h+2]=0}else{var p=a+i,f=(n+1)*3;u[f]=r*Math.sin(p),u[f+1]=0,u[f+2]=r*Math.cos(p),l[f]=0,l[f+1]=1,l[f+2]=0;var h=(n-1)*3;c[h]=n,c[h+1]=n+1,c[h+2]=0}return{vertices:u,normals:l,indices:c}}var zK={color:M.Color(gr.lightgreen),arcScale:M.Numeric(.7,{min:.01,max:1,step:.01})},UK=T(T(T({},Mn.Params),zK),{lineSizeAttenuation:M.Boolean(!0),linesSize:M.Numeric(.04,{min:.01,max:5,step:.01}),dashLength:M.Numeric(.04,{min:.01,max:.2,step:.01})}),KOe=T({},UK),$Oe=T({},UK),QOe=T(T(T({},Wt.Params),zK),{ignoreLight:M.Boolean(!0),sectorOpacity:M.Numeric(.75,{min:0,max:1,step:.01})}),VK={vectors:function(e,t){return Ga(eBe,Mn.Utils,{modifyState:function(r){return T(T({},r),{pickable:!1})}})},arc:function(e,t){return Ga(rBe,Mn.Utils,{modifyState:function(r){return T(T({},r),{pickable:!1})}})},sector:function(e,t){return Ga(aBe,Wt.Utils,{modifyProps:function(r){return T(T({},r),{alpha:r.sectorOpacity})},modifyState:function(r){return T(T({},r),{markerActions:Wo.Highlighting})}})},text:function(e,t){return Ga(oBe,mu.Utils,{modifyState:function(r){return T(T({},r),{markerActions:sr.None})}})}},j9=T(T(T(T(T({},KOe),$Oe),QOe),y_),{visuals:M.MultiSelect(["vectors","sector","text"],M.objectToOptions(VK))});function ZOe(){return{sphereA:He(),sphereB:He(),sphereC:He(),arcDirA:A(),arcDirC:A(),arcNormal:A(),radius:0,angle:0}}var of=A(),Eg=de();function x_(e,t,r){var n=t.sphereA,a=t.sphereB,i=t.sphereC,o=t.arcDirA,s=t.arcDirC,u=t.arcNormal,l=e.loci,c=l[0],d=l[1],f=l[2];cr.getBoundingSphere(c,n),cr.getBoundingSphere(d,a),cr.getBoundingSphere(f,i),A.sub(o,n.center,a.center),A.sub(s,i.center,a.center),A.cross(u,o,s);var p=Math.min(A.magnitude(o),A.magnitude(s)),h=p*r;return t.radius=h,t.angle=A.angle(o,s),t}function HK(e,t){var r=e.radius,n=e.angle,a=t?pq(n,r)/t:32;de.targetTo(Eg,e.sphereB.center,e.sphereA.center,e.arcNormal),de.setTranslation(Eg,e.sphereB.center),de.mul(Eg,Eg,de.rotY180);var i=NK({radius:r,thetaLength:n,segments:a});return vk(i,Eg)}var mi=ZOe();function S_(e){return e.triples.length===1?"Angle "+v_(e.triples[0],{measureOnly:!0}):e.triples.length+" Angles"}function JOe(e,t,r){for(var n=_s.create(128,64,r),a=0,i=e.triples.length;a<i;++a)x_(e.triples[a],mi,t.arcScale),n.addFixedLengthDashes(mi.sphereB.center,mi.sphereA.center,t.dashLength,a),n.addFixedLengthDashes(mi.sphereB.center,mi.sphereC.center,t.dashLength,a);return n.getLines()}function eBe(e,t,r,n){var a=JOe(t,r,n&&n.geometry),i=S_(t);return Nr.create(i,t,a,function(){return r.color},function(){return r.linesSize},function(){return""})}function tBe(e,t,r){for(var n=_s.create(128,64,r),a=0,i=e.triples.length;a<i;++a){x_(e.triples[a],mi,t.arcScale);for(var o=HK(mi,t.dashLength),s=o.indices,u=o.vertices,l=0,c=s.length;l<c;l+=3)if(l%2!==1){var d=s[l]*3,f=s[l+1]*3,p=u[d],h=u[d+1],m=u[d+2],v=u[f],g=u[f+1],y=u[f+2];n.add(p,h,m,v,g,y,a)}}return n.getLines()}function rBe(e,t,r,n){var a=tBe(t,r,n&&n.geometry),i=S_(t);return Nr.create(i,t,a,function(){return r.color},function(){return r.linesSize},function(){return""})}function nBe(e,t,r){for(var n=kt.createState(128,64,r),a=0,i=e.triples.length;a<i;++a){x_(e.triples[a],mi,t.arcScale);var o=HK(mi);n.currentGroup=a,kt.addPrimitive(n,de.id,o),kt.addPrimitiveFlipped(n,de.id,o)}return kt.getMesh(n)}function aBe(e,t,r,n){var a=nBe(t,r,n&&n.geometry),i=S_(t),o=function(s){return v_(t.triples[s])};return Nr.create(i,t,a,function(){return r.color},function(){return 1},o)}function iBe(e,t,r){for(var n=Sd.create(t,128,64,r),a=0,i=e.triples.length;a<i;++a){x_(e.triples[a],mi,t.arcScale),A.add(of,mi.arcDirA,mi.arcDirC),A.setMagnitude(of,of,mi.radius),A.add(of,mi.sphereB.center,of);var o=qu(mi.angle).toFixed(2),s=t.customText||o+"\xB0",u=Math.max(2,mi.sphereA.radius,mi.sphereB.radius,mi.sphereC.radius),l=u/2;n.add(s,of[0],of[1],of[2],.1,l,a)}return n.getText()}function oBe(e,t,r,n){var a=iBe(t,r,n&&n.geometry),i=S_(t),o=function(s){return v_(t.triples[s])};return Nr.create(i,t,a,function(){return r.textColor},function(){return r.textSize},o)}function sBe(e,t){return mr.createMulti("Angle",e,t,mr.StateBuilder,VK)}var jK={color:M.Color(gr.lightgreen),arcScale:M.Numeric(.7,{min:.01,max:1,step:.01})},C_=T(T(T({},Mn.Params),jK),{lineSizeAttenuation:M.Boolean(!0),linesSize:M.Numeric(.04,{min:.01,max:5,step:.01}),dashLength:M.Numeric(.04,{min:.01,max:.2,step:.01})}),uBe=T({},C_),lBe=T({},C_),cBe=T({},C_),dBe=T({},C_),fBe=T(T(T({},Wt.Params),jK),{ignoreLight:M.Boolean(!0),sectorOpacity:M.Numeric(.75,{min:0,max:1,step:.01})}),GK={vectors:function(e,t){return Ga(mBe,Mn.Utils,{modifyState:function(r){return T(T({},r),{pickable:!1})}})},extenders:function(e,t){return Ga(SBe,Mn.Utils,{modifyState:function(r){return T(T({},r),{pickable:!1})}})},connector:function(e,t){return Ga(gBe,Mn.Utils,{modifyState:function(r){return T(T({},r),{pickable:!1})}})},arms:function(e,t){return Ga(bBe,Mn.Utils,{modifyState:function(r){return T(T({},r),{pickable:!1})}})},arc:function(e,t){return Ga(wBe,Mn.Utils,{modifyState:function(r){return T(T({},r),{pickable:!1})}})},sector:function(e,t){return Ga(ABe,Wt.Utils,{modifyProps:function(r){return T(T({},r),{alpha:r.sectorOpacity})},modifyState:function(r){return T(T({},r),{markerActions:Wo.Highlighting})}})},text:function(e,t){return Ga(EBe,mu.Utils,{modifyState:function(r){return T(T({},r),{markerActions:sr.None})}})}},G9=T(T(T(T(T(T(T({},uBe),lBe),cBe),dBe),fBe),y_),{visuals:M.MultiSelect(["extenders","arms","sector","text"],M.objectToOptions(GK))});function pBe(){return{sphereA:He(),sphereB:He(),sphereC:He(),sphereD:He(),dirBA:A(),dirCD:A(),projA:A(),projD:A(),arcPointA:A(),arcPointD:A(),arcDirA:A(),arcDirD:A(),arcCenter:A(),arcNormal:A(),radius:0,angle:0}}var Wi=A(),Pg=de();function Pm(e,t,r){var n=t.sphereA,a=t.sphereB,i=t.sphereC,o=t.sphereD,s=t.dirBA,u=t.dirCD,l=t.projA,c=t.projD,d=t.arcPointA,f=t.arcPointD,p=t.arcDirA,h=t.arcDirD,m=t.arcCenter,v=t.arcNormal,g=e.loci,y=g[0],b=g[1],S=g[2],x=g[3];cr.getBoundingSphere(y,n),cr.getBoundingSphere(b,a),cr.getBoundingSphere(S,i),cr.getBoundingSphere(x,o),A.add(m,a.center,i.center),A.scale(m,m,.5),A.sub(s,n.center,a.center),A.sub(u,o.center,i.center),A.add(d,m,s),A.add(f,m,u),A.sub(v,i.center,a.center),A.orthogonalize(p,v,s),A.orthogonalize(h,v,u),A.projectPointOnVector(l,d,p,m),A.projectPointOnVector(c,f,h,m);var C=Math.min(A.distance(l,m),A.distance(c,m)),w=C*r;A.setMagnitude(p,p,w),A.setMagnitude(h,h,w),A.add(d,m,p),A.add(f,m,h),t.radius=w,t.angle=A.dihedralAngle(n.center,a.center,i.center,o.center),A.matchDirection(Wi,v,A.sub(Wi,d,n.center));var _=A.angle(s,Wi),E=w/Math.cos(_-Ry);A.add(l,a.center,A.setMagnitude(Wi,s,E)),A.matchDirection(Wi,v,A.sub(Wi,f,o.center));var P=A.angle(u,Wi),D=w/Math.cos(P-Ry);return A.add(c,i.center,A.setMagnitude(Wi,u,D)),t}function qK(e,t){var r=e.radius,n=e.angle,a=t?pq(n,r)/t:32;de.targetTo(Pg,e.arcCenter,n<0?e.arcPointD:e.arcPointA,e.arcNormal),de.setTranslation(Pg,e.arcCenter),de.mul(Pg,Pg,de.rotY180);var i=NK({radius:r,thetaLength:Math.abs(n),segments:a});return vk(i,Pg)}var mn=pBe();function Im(e){return e.quads.length===1?"Dihedral "+g_(e.quads[0],{measureOnly:!0}):e.quads.length+" Dihedrals"}function hBe(e,t,r){for(var n=_s.create(128,64,r),a=0,i=e.quads.length;a<i;++a)Pm(e.quads[a],mn,t.arcScale),n.addFixedLengthDashes(mn.arcCenter,mn.arcPointA,t.dashLength,a),n.addFixedLengthDashes(mn.arcCenter,mn.arcPointD,t.dashLength,a);return n.getLines()}function mBe(e,t,r,n){var a=hBe(t,r,n&&n.geometry),i=Im(t);return Nr.create(i,t,a,function(){return r.color},function(){return r.linesSize},function(){return""})}function vBe(e,t,r){for(var n=_s.create(128,64,r),a=0,i=e.quads.length;a<i;++a)Pm(e.quads[a],mn,t.arcScale),n.addFixedLengthDashes(mn.sphereB.center,mn.sphereC.center,t.dashLength,a);return n.getLines()}function gBe(e,t,r,n){var a=vBe(t,r,n&&n.geometry),i=Im(t);return Nr.create(i,t,a,function(){return r.color},function(){return r.linesSize},function(){return""})}function yBe(e,t,r){for(var n=_s.create(128,64,r),a=0,i=e.quads.length;a<i;++a)Pm(e.quads[a],mn,t.arcScale),n.addFixedLengthDashes(mn.sphereB.center,mn.sphereA.center,t.dashLength,a),n.addFixedLengthDashes(mn.sphereC.center,mn.sphereD.center,t.dashLength,a);return n.getLines()}function bBe(e,t,r,n){var a=yBe(t,r,n&&n.geometry),i=Im(t);return Nr.create(i,t,a,function(){return r.color},function(){return r.linesSize},function(){return""})}function xBe(e,t,r){for(var n=_s.create(128,64,r),a=0,i=e.quads.length;a<i;++a)Pm(e.quads[a],mn,t.arcScale),n.addFixedLengthDashes(mn.arcPointA,mn.projA,t.dashLength,a),n.addFixedLengthDashes(mn.arcPointD,mn.projD,t.dashLength,a);return n.getLines()}function SBe(e,t,r,n){var a=xBe(t,r,n&&n.geometry),i=Im(t);return Nr.create(i,t,a,function(){return r.color},function(){return r.linesSize},function(){return""})}function CBe(e,t,r){for(var n=_s.create(128,64,r),a=0,i=e.quads.length;a<i;++a){Pm(e.quads[a],mn,t.arcScale);for(var o=qK(mn,t.dashLength),s=o.indices,u=o.vertices,l=0,c=s.length;l<c;l+=3)if(l%2!==1){var d=s[l]*3,f=s[l+1]*3,p=u[d],h=u[d+1],m=u[d+2],v=u[f],g=u[f+1],y=u[f+2];n.add(p,h,m,v,g,y,a)}}return n.getLines()}function wBe(e,t,r,n){var a=CBe(t,r,n&&n.geometry),i=Im(t);return Nr.create(i,t,a,function(){return r.color},function(){return r.linesSize},function(){return""})}function _Be(e,t,r){for(var n=kt.createState(128,64,r),a=0,i=e.quads.length;a<i;++a){Pm(e.quads[a],mn,t.arcScale);var o=qK(mn);n.currentGroup=a,kt.addPrimitive(n,de.id,o),kt.addPrimitiveFlipped(n,de.id,o)}return kt.getMesh(n)}function ABe(e,t,r,n){var a=_Be(t,r,n&&n.geometry),i=Im(t),o=function(s){return g_(t.quads[s])};return Nr.create(i,t,a,function(){return r.color},function(){return 1},o)}function TBe(e,t,r){for(var n=Sd.create(t,128,64,r),a=0,i=e.quads.length;a<i;++a){Pm(e.quads[a],mn,t.arcScale),A.add(Wi,mn.arcDirA,mn.arcDirD),A.setMagnitude(Wi,Wi,mn.radius),A.add(Wi,mn.arcCenter,Wi);var o=qu(mn.angle).toFixed(2);o==="-0.00"&&(o="0.00");var s=t.customText||o+"\xB0",u=Math.max(2,mn.sphereA.radius,mn.sphereB.radius,mn.sphereC.radius,mn.sphereD.radius),l=u/2;n.add(s,Wi[0],Wi[1],Wi[2],.1,l,a)}return n.getText()}function EBe(e,t,r,n){var a=TBe(t,r,n&&n.geometry),i=Im(t),o=function(s){return g_(t.quads[s])};return Nr.create(i,t,a,function(){return r.textColor},function(){return r.textSize},o)}function PBe(e,t){return mr.createMulti("Dihedral",e,t,mr.StateBuilder,GK)}var IBe=Ut.BuiltIn({name:"box-shape-3d",display:"Box Shape",from:be.Root,to:be.Shape.Provider,params:{bottomLeft:M.Vec3(A()),topRight:M.Vec3(A.create(1,1,1)),radius:M.Numeric(.15,{min:.01,max:4,step:.01}),color:M.Color(gr.red)}})({canAutoUpdate:function(){return!0},apply:function(e){var t=this,r=e.params;return Qe.create("Shape Representation",function(n){return pe(t,void 0,void 0,function(){return he(this,function(a){return[2,new be.Shape.Provider({label:"Box",data:r,params:Wt.Params,getShape:function(i,o){var s=Xk(tr.create(r.bottomLeft,r.topRight),r.radius);return Nr.create("Box",o,s,function(){return o.color},function(){return 1},function(){return"Box"})},geometryUtils:Wt.Utils},{label:"Box"})]})})})}});function Xk(e,t,r){var n=A.sub(A(),e.max,e.min),a=de.fromTranslation(de(),A.create(.5,.5,.5)),i=de.fromScaling(de(),n),o=de.fromTranslation(de(),e.min),s=de.mul3(de(),o,i,a),u=kt.createState(256,128,r);u.currentGroup=1,kt.addCage(u,s,jW(),t,2,20);var l=kt.getMesh(u),c=A.scaleAndAdd(A(),e.min,n,.5),d=A.distance(e.min,c);return l.setBoundingSphere(He.create(c,d)),l}var MBe=Object.freeze({__proto__:null,BoxShape3D:IBe,getBoxMesh:Xk}),e3=Ut.BuiltIn({name:"structure-representation-3d",display:"3D Representation",from:be.Molecule.Structure,to:be.Molecule.Structure.Representation3D,params:function(e,t){var r=t.representation.structure,n=r.registry,a=r.themes,i=n.get(n.default.name);if(!e){var o={help:function(l){var c=l.name,d=l.params,f=a.colorThemeRegistry.get(c),p=f.factory({},d);return{description:p.description,legend:p.legend}}};return{type:M.Mapped(n.default.name,n.types,function(l){return M.Group(n.get(l).getParams(a,$e.Empty))}),colorTheme:M.Mapped(i.defaultColorTheme.name,a.colorThemeRegistry.types,function(l){return M.Group(a.colorThemeRegistry.get(l).getParams({structure:$e.Empty}))},o),sizeTheme:M.Mapped(i.defaultSizeTheme.name,a.sizeThemeRegistry.types,function(l){return M.Group(a.sizeThemeRegistry.get(l).getParams({structure:$e.Empty}))})}}var s={structure:e.data},u={help:function(l){var c=l.name,d=l.params,f=a.colorThemeRegistry.get(c),p=f.factory(s,d);return{description:p.description,legend:p.legend}}};return{type:M.Mapped(n.default.name,n.getApplicableTypes(e.data),function(l){return M.Group(n.get(l).getParams(a,e.data))}),colorTheme:M.Mapped(i.defaultColorTheme.name,a.colorThemeRegistry.getApplicableTypes(s),function(l){return M.Group(a.colorThemeRegistry.get(l).getParams(s))},u),sizeTheme:M.Mapped(i.defaultSizeTheme.name,a.sizeThemeRegistry.types,function(l){return M.Group(a.sizeThemeRegistry.get(l).getParams(s))})}}})({canAutoUpdate:function(e){var t=e.a,r=e.oldParams,n=e.newParams;return t.data.elementCount<1e4||r.type.name===n.type.name&&n.type.params.quality!=="custom"},apply:function(e,t){var r=this,n=e.a,a=e.params;return e.cache,Qe.create("Structure Representation",function(i){return pe(r,void 0,void 0,function(){var o,s,u,l,c,d,f;return he(this,function(p){switch(p.label){case 0:return o={runtime:i,assetManager:t.managers.asset},s=t.representation.structure.registry.get(a.type.name),u=((d=s.getData)===null||d===void 0?void 0:d.call(s,n.data,a.type.params))||n.data,s.ensureCustomProperties?[4,s.ensureCustomProperties.attach(o,u)]:[3,2];case 1:p.sent(),p.label=2;case 2:return l=s.factory(T({webgl:(f=t.canvas3d)===null||f===void 0?void 0:f.webgl},t.representation.structure.themes),s.getParams),[4,Ia.ensureDependencies(o,t.representation.structure.themes,{structure:u},a)];case 3:return p.sent(),l.setTheme(Ia.create(t.representation.structure.themes,{structure:u},a)),c=a.type.params||{},[4,l.createOrUpdate(c,u).runInContext(i)];case 4:return p.sent(),[2,new be.Molecule.Structure.Representation3D({repr:l,sourceData:n.data},{label:s.label})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b,i=e.oldParams,o=e.newParams;return e.cache,Qe.create("Structure Representation",function(s){return pe(r,void 0,void 0,function(){var u,l,c,d,f,p;return he(this,function(h){switch(h.label){case 0:return o.type.name!==i.type.name?[2,gt.UpdateResult.Recreate]:(u=t.representation.structure.registry.get(o.type.name),!((f=u.mustRecreate)===null||f===void 0)&&f.call(u,i.type.params,o.type.params)?[2,gt.UpdateResult.Recreate]:(l=((p=u.getData)===null||p===void 0?void 0:p.call(u,n.data,o.type.params))||n.data,c={runtime:s,assetManager:t.managers.asset},u.ensureCustomProperties?[4,u.ensureCustomProperties.attach(c,l)]:[3,2]));case 1:h.sent(),h.label=2;case 2:return Ia.releaseDependencies(t.representation.structure.themes,{structure:a.data.sourceData},i),[4,Ia.ensureDependencies(c,t.representation.structure.themes,{structure:l},o)];case 3:return h.sent(),a.data.repr.setTheme(Ia.create(t.representation.structure.themes,{structure:l},o)),d=T(T({},a.data.repr.props),o.type.params),[4,a.data.repr.createOrUpdate(d,l).runInContext(s)];case 4:return h.sent(),a.data.sourceData=n.data,[2,gt.UpdateResult.Updated]}})})})},dispose:function(e,t){var r=e.b,n=e.params;if(!(!r||!n)){var a=r.data.sourceData,i=t.representation.structure.registry.get(n.type.name);i.ensureCustomProperties&&i.ensureCustomProperties.detach(a),Ia.releaseDependencies(t.representation.structure.themes,{structure:a},n)}},interpolate:function(e,t,r){if(e.colorTheme.name!=="uniform"||t.colorTheme.name!=="uniform")return r<=.5?e:t;var n=e.colorTheme.params.value,a=t.colorTheme.params.value,i=vt.interpolate(n,a,r);return{type:r<=.5?e.type:t.type,colorTheme:{name:"uniform",params:{value:i}},sizeTheme:r<=.5?e.sizeTheme:t.sizeTheme}}}),DBe=Ut.BuiltIn({name:"unwind-structure-assembly-representation-3d",display:"Unwind Assembly 3D Representation",from:be.Molecule.Structure.Representation3D,to:be.Molecule.Structure.Representation3DState,params:{t:M.Numeric(0,{min:0,max:1,step:.01})}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,a=new C0(n);return C9(n,a,r.t),new be.Molecule.Structure.Representation3DState({state:{unitTransforms:a},initialState:{unitTransforms:new C0(n)},info:n,repr:t.data.repr},{label:"Unwind T = "+r.t.toFixed(2)})},update:function(e){var t=e.a,r=e.b,n=e.newParams,a=e.oldParams,i=r.data.info;if(t.data.sourceData!==i||t.data.repr!==r.data.repr)return gt.UpdateResult.Recreate;if(a.t===n.t)return gt.UpdateResult.Unchanged;var o=r.data.state.unitTransforms;return C9(i,o,n.t),r.label="Unwind T = "+n.t.toFixed(2),r.data.repr=t.data.repr,gt.UpdateResult.Updated}}),kBe=Ut.BuiltIn({name:"explode-structure-representation-3d",display:"Explode 3D Representation",from:be.Molecule.Structure.Representation3D,to:be.Molecule.Structure.Representation3DState,params:{t:M.Numeric(0,{min:0,max:1,step:.01})}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,a=new C0(n.root);return _9(n,a,r.t),new be.Molecule.Structure.Representation3DState({state:{unitTransforms:a},initialState:{unitTransforms:new C0(n.root)},info:n.root,repr:t.data.repr},{label:"Explode T = "+r.t.toFixed(2)})},update:function(e){var t=e.a,r=e.b,n=e.newParams,a=e.oldParams,i=t.data.sourceData;if(r.data.info!==i.root||t.data.repr!==r.data.repr)return gt.UpdateResult.Recreate;if(a.t===n.t)return gt.UpdateResult.Unchanged;var o=r.data.state.unitTransforms;return _9(i.root,o,n.t),r.label="Explode T = "+n.t.toFixed(2),r.data.repr=t.data.repr,gt.UpdateResult.Updated}}),RBe=Ut.BuiltIn({name:"spin-structure-representation-3d",display:"Spin 3D Representation",from:be.Molecule.Structure.Representation3D,to:be.Molecule.Structure.Representation3DState,params:T({t:M.Numeric(0,{min:0,max:1,step:.01})},J8e)})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,a=new C0(n.root),i=A9(n.root,r),o=i.axis,s=i.origin;return P9(n,a,r.t,o,s),new be.Molecule.Structure.Representation3DState({state:{unitTransforms:a},initialState:{unitTransforms:new C0(n.root)},info:n.root,repr:t.data.repr},{label:"Spin T = "+r.t.toFixed(2)})},update:function(e){var t=e.a,r=e.b,n=e.newParams,a=e.oldParams,i=t.data.sourceData;if(r.data.info!==i.root||t.data.repr!==r.data.repr)return gt.UpdateResult.Recreate;if(a.t===n.t&&a.axis===n.axis&&a.origin===n.origin)return gt.UpdateResult.Unchanged;var o=r.data.state.unitTransforms,s=A9(i.root,n),u=s.axis,l=s.origin;return P9(i.root,o,n.t,u,l),r.label="Spin T = "+n.t.toFixed(2),r.data.repr=t.data.repr,gt.UpdateResult.Updated}}),OBe=Ut.BuiltIn({name:"overpaint-structure-representation-3d-from-script",display:"Overpaint 3D Representation",from:be.Molecule.Structure.Representation3D,to:be.Molecule.Structure.Representation3DState,params:function(){return{layers:M.ObjectList({script:M.Script(yi("(sel.atom.all)","mol-script")),color:M.Color(gr.blueviolet),clear:M.Boolean(!1)},function(e){return""+(e.clear?"Clear":vt.toRgbString(e.color))},{defaultValue:[{script:yi("(sel.atom.all)","mol-script"),color:gr.blueviolet,clear:!1}]})}}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,a=ri.ofScript(r.layers,n);return new be.Molecule.Structure.Representation3DState({state:{overpaint:a},initialState:{overpaint:ri.Empty},info:n,repr:t.data.repr},{label:"Overpaint ("+a.layers.length+" Layers)"})},update:function(e){var t=e.a,r=e.b,n=e.newParams;e.oldParams;var a=r.data.info,i=t.data.sourceData;if(i!==a||t.data.repr!==r.data.repr)return gt.UpdateResult.Recreate;var o=r.data.state.overpaint,s=ri.ofScript(n.layers,i);return ri.areEqual(o,s)?gt.UpdateResult.Unchanged:(r.data.state.overpaint=s,r.data.repr=t.data.repr,r.label="Overpaint ("+s.layers.length+" Layers)",gt.UpdateResult.Updated)}}),BBe=Ut.BuiltIn({name:"overpaint-structure-representation-3d-from-bundle",display:"Overpaint 3D Representation",from:be.Molecule.Structure.Representation3D,to:be.Molecule.Structure.Representation3DState,params:function(){return{layers:M.ObjectList({bundle:M.Value(sn.Empty),color:M.Color(gr.blueviolet),clear:M.Boolean(!1)},function(e){return""+(e.clear?"Clear":vt.toRgbString(e.color))},{defaultValue:[{bundle:sn.Empty,color:gr.blueviolet,clear:!1}],isHidden:!0})}}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,a=ri.ofBundle(r.layers,n);return new be.Molecule.Structure.Representation3DState({state:{overpaint:a},initialState:{overpaint:ri.Empty},info:n,repr:t.data.repr},{label:"Overpaint ("+a.layers.length+" Layers)"})},update:function(e){var t=e.a,r=e.b,n=e.newParams;e.oldParams;var a=r.data.info,i=t.data.sourceData;if(i!==a||t.data.repr!==r.data.repr)return gt.UpdateResult.Recreate;var o=r.data.state.overpaint,s=ri.ofBundle(n.layers,i);return ri.areEqual(o,s)?gt.UpdateResult.Unchanged:(r.data.state.overpaint=s,r.data.repr=t.data.repr,r.label="Overpaint ("+s.layers.length+" Layers)",gt.UpdateResult.Updated)}}),FBe=Ut.BuiltIn({name:"transparency-structure-representation-3d-from-script",display:"Transparency 3D Representation",from:be.Molecule.Structure.Representation3D,to:be.Molecule.Structure.Representation3DState,params:function(){return{layers:M.ObjectList({script:M.Script(yi("(sel.atom.all)","mol-script")),value:M.Numeric(.5,{min:0,max:1,step:.01},{label:"Transparency"})},function(e){return"Transparency ("+e.value+")"},{defaultValue:[{script:yi("(sel.atom.all)","mol-script"),value:.5}]})}}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,a=ni.ofScript(r.layers,n);return new be.Molecule.Structure.Representation3DState({state:{transparency:a},initialState:{transparency:ni.Empty},info:n,repr:t.data.repr},{label:"Transparency ("+a.layers.length+" Layers)"})},update:function(e){var t=e.a,r=e.b,n=e.newParams;e.oldParams;var a=r.data.info;if(t.data.sourceData!==a||t.data.repr!==r.data.repr)return gt.UpdateResult.Recreate;var i=r.data.state.transparency,o=ni.ofScript(n.layers,a);return ni.areEqual(i,o)?gt.UpdateResult.Unchanged:(r.data.state.transparency=o,r.data.repr=t.data.repr,r.label="Transparency ("+o.layers.length+" Layers)",gt.UpdateResult.Updated)}}),LBe=Ut.BuiltIn({name:"transparency-structure-representation-3d-from-bundle",display:"Transparency 3D Representation",from:be.Molecule.Structure.Representation3D,to:be.Molecule.Structure.Representation3DState,params:function(){return{layers:M.ObjectList({bundle:M.Value(sn.Empty),value:M.Numeric(.5,{min:0,max:1,step:.01},{label:"Transparency"})},function(e){return"Transparency ("+e.value+")"},{defaultValue:[{bundle:sn.Empty,value:.5}],isHidden:!0})}}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,a=ni.ofBundle(r.layers,n);return new be.Molecule.Structure.Representation3DState({state:{transparency:a},initialState:{transparency:ni.Empty},info:n,repr:t.data.repr},{label:"Transparency ("+a.layers.length+" Layers)"})},update:function(e){var t=e.a,r=e.b,n=e.newParams;e.oldParams;var a=r.data.info;if(t.data.sourceData!==a||t.data.repr!==r.data.repr)return gt.UpdateResult.Recreate;var i=r.data.state.transparency,o=ni.ofBundle(n.layers,a);return ni.areEqual(i,o)?gt.UpdateResult.Unchanged:(r.data.state.transparency=o,r.data.repr=t.data.repr,r.label="Transparency ("+o.layers.length+" Layers)",gt.UpdateResult.Updated)}}),NBe=Ut.BuiltIn({name:"clipping-structure-representation-3d-from-script",display:"Clipping 3D Representation",from:be.Molecule.Structure.Representation3D,to:be.Molecule.Structure.Representation3DState,params:function(){return{layers:M.ObjectList({script:M.Script(yi("(sel.atom.all)","mol-script")),groups:M.Converted(function(e){return cn.Groups.toNames(e)},function(e){return cn.Groups.fromNames(e)},M.MultiSelect(f_(cn.Groups.Names),M.objectToOptions(cn.Groups.Names)))},function(e){return cn.Groups.toNames(e.groups).length+" group(s)"},{defaultValue:[{script:yi("(sel.atom.all)","mol-script"),groups:0}]})}}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,a=cn.ofScript(r.layers,n);return new be.Molecule.Structure.Representation3DState({state:{clipping:a},initialState:{clipping:cn.Empty},info:n,repr:t.data.repr},{label:"Clipping ("+a.layers.length+" Layers)"})},update:function(e){var t=e.a,r=e.b,n=e.newParams;e.oldParams;var a=r.data.info;if(t.data.sourceData!==a||t.data.repr!==r.data.repr)return gt.UpdateResult.Recreate;var i=r.data.state.clipping,o=cn.ofScript(n.layers,a);return cn.areEqual(i,o)?gt.UpdateResult.Unchanged:(r.data.state.clipping=o,r.data.repr=t.data.repr,r.label="Clipping ("+o.layers.length+" Layers)",gt.UpdateResult.Updated)}}),zBe=Ut.BuiltIn({name:"clipping-structure-representation-3d-from-bundle",display:"Clipping 3D Representation",from:be.Molecule.Structure.Representation3D,to:be.Molecule.Structure.Representation3DState,params:function(){return{layers:M.ObjectList({bundle:M.Value(sn.Empty),groups:M.Converted(function(e){return cn.Groups.toNames(e)},function(e){return cn.Groups.fromNames(e)},M.MultiSelect(f_(cn.Groups.Names),M.objectToOptions(cn.Groups.Names)))},function(e){return cn.Groups.toNames(e.groups).length+" group(s)"},{defaultValue:[{bundle:sn.Empty,groups:0}],isHidden:!0})}}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,a=cn.ofBundle(r.layers,n);return new be.Molecule.Structure.Representation3DState({state:{clipping:a},initialState:{clipping:cn.Empty},info:n,repr:t.data.repr},{label:"Clipping ("+a.layers.length+" Layers)"})},update:function(e){var t=e.a,r=e.b,n=e.newParams;e.oldParams;var a=r.data.info;if(t.data.sourceData!==a||t.data.repr!==r.data.repr)return gt.UpdateResult.Recreate;var i=r.data.state.clipping,o=cn.ofBundle(n.layers,a);return cn.areEqual(i,o)?gt.UpdateResult.Unchanged:(r.data.state.clipping=o,r.data.repr=t.data.repr,r.label="Clipping ("+o.layers.length+" Layers)",gt.UpdateResult.Updated)}}),nd;(function(e){function t(a,i,o,s){var u=a.representation.volume.registry.get(i),l={volume:o},c=a.representation.volume.themes.colorThemeRegistry.get(u.defaultColorTheme.name).getParams(l),d=a.representation.volume.themes.sizeThemeRegistry.get(u.defaultSizeTheme.name).getParams(l),f=M.getDefaultValues(u.getParams(a.representation.volume.themes,o));return{type:{name:i,params:s?T(T({},f),s):f},colorTheme:{name:u.defaultColorTheme.name,params:M.getDefaultValues(c)},sizeTheme:{name:u.defaultSizeTheme.name,params:M.getDefaultValues(d)}}}e.getDefaultParams=t;function r(a,i,o,s,u,l,c){var d=a.representation.volume.registry.get(i),f=a.representation.volume.themes.colorThemeRegistry.get(s||d.defaultColorTheme.name),p=a.representation.volume.themes.sizeThemeRegistry.get(l||d.defaultSizeTheme.name);return{type:{name:i,params:o?T(T({},d.defaultValues),o):d.defaultValues},colorTheme:{name:d.defaultColorTheme.name,params:u?T(T({},f.defaultValues),u):f.defaultValues},sizeTheme:{name:d.defaultSizeTheme.name,params:c?T(T({},p.defaultValues),c):p.defaultValues}}}e.getDefaultParamsStatic=r;function n(a){var i,o,s,u;if(a.isoValue)return It.IsoValue.toString(a.isoValue);if(!((o=(i=a.renderMode)===null||i===void 0?void 0:i.params)===null||o===void 0)&&o.isoValue)return It.IsoValue.toString((u=(s=a.renderMode)===null||s===void 0?void 0:s.params)===null||u===void 0?void 0:u.isoValue)}e.getDescription=n})(nd||(nd={}));var UBe=Ut.BuiltIn({name:"volume-representation-3d",display:"3D Representation",from:be.Volume.Data,to:be.Volume.Representation3D,params:function(e,t){var r=t.representation.volume,n=r.registry,a=r.themes,i=n.get(n.default.name);if(!e)return{type:M.Mapped(n.default.name,n.types,function(s){return M.Group(n.get(s).getParams(a,It.One))}),colorTheme:M.Mapped(i.defaultColorTheme.name,a.colorThemeRegistry.types,function(s){return M.Group(a.colorThemeRegistry.get(s).getParams({volume:It.One}))}),sizeTheme:M.Mapped(i.defaultSizeTheme.name,a.sizeThemeRegistry.types,function(s){return M.Group(a.sizeThemeRegistry.get(s).getParams({volume:It.One}))})};var o={volume:e.data};return{type:M.Mapped(n.default.name,n.types,function(s){return M.Group(n.get(s).getParams(a,e.data))}),colorTheme:M.Mapped(i.defaultColorTheme.name,a.colorThemeRegistry.getApplicableTypes(o),function(s){return M.Group(a.colorThemeRegistry.get(s).getParams(o))}),sizeTheme:M.Mapped(i.defaultSizeTheme.name,a.sizeThemeRegistry.types,function(s){return M.Group(a.sizeThemeRegistry.get(s).getParams(o))})}}})({canAutoUpdate:function(e){var t=e.oldParams,r=e.newParams;return t.type.name===r.type.name},apply:function(e,t){var r=this,n=e.a,a=e.params;return Qe.create("Volume Representation",function(i){return pe(r,void 0,void 0,function(){var o,s,u,l,c;return he(this,function(d){switch(d.label){case 0:return o={runtime:i,assetManager:t.managers.asset},s=t.representation.volume.registry.get(a.type.name),s.ensureCustomProperties?[4,s.ensureCustomProperties.attach(o,n.data)]:[3,2];case 1:d.sent(),d.label=2;case 2:return u=s.factory(T({webgl:(c=t.canvas3d)===null||c===void 0?void 0:c.webgl},t.representation.volume.themes),s.getParams),u.setTheme(Ia.create(t.representation.volume.themes,{volume:n.data},a)),l=a.type.params||{},[4,u.createOrUpdate(l,n.data).runInContext(i)];case 3:return d.sent(),[2,new be.Volume.Representation3D({repr:u,sourceData:n.data},{label:s.label,description:nd.getDescription(l)})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b,i=e.oldParams,o=e.newParams;return Qe.create("Volume Representation",function(s){return pe(r,void 0,void 0,function(){var u,l,c;return he(this,function(d){switch(d.label){case 0:return o.type.name!==i.type.name?(u=t.representation.volume.registry.get(i.type.name),(c=u.ensureCustomProperties)===null||c===void 0||c.detach(n.data),[2,gt.UpdateResult.Recreate]):(l=T(T({},a.data.repr.props),o.type.params),a.data.repr.setTheme(Ia.create(t.representation.volume.themes,{volume:n.data},o)),[4,a.data.repr.createOrUpdate(l,n.data).runInContext(s)]);case 1:return d.sent(),a.data.sourceData=n.data,a.description=nd.getDescription(l),[2,gt.UpdateResult.Updated]}})})})}}),VBe=Ut.BuiltIn({name:"shape-representation-3d",display:"3D Representation",from:be.Shape.Provider,to:be.Shape.Representation3D,params:function(e,t){return e?e.data.params:Dt.Params}})({canAutoUpdate:function(){return!0},apply:function(e,t){var r=this,n=e.a,a=e.params;return Qe.create("Shape Representation",function(i){return pe(r,void 0,void 0,function(){var o,s;return he(this,function(u){switch(u.label){case 0:return o=T(T({},M.getDefaultValues(n.data.params)),a),s=Ga(n.data.getShape,n.data.geometryUtils),[4,s.createOrUpdate(o,n.data.data).runInContext(i)];case 1:return u.sent(),[2,new be.Shape.Representation3D({repr:s,sourceData:n.data},{label:n.data.label})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b;e.oldParams;var i=e.newParams;return Qe.create("Shape Representation",function(o){return pe(r,void 0,void 0,function(){var s;return he(this,function(u){switch(u.label){case 0:return s=T(T({},a.data.repr.props),i),[4,a.data.repr.createOrUpdate(s,n.data.data).runInContext(o)];case 1:return u.sent(),a.data.sourceData=n.data,[2,gt.UpdateResult.Updated]}})})})}}),HBe=Ut.BuiltIn({name:"model-unitcell-3d",display:"Model Unit Cell",from:be.Molecule.Model,to:be.Shape.Representation3D,params:function(){return T({},M9)}})({isApplicable:function(e){return!!wa.Provider.get(e.data)},canAutoUpdate:function(e){return e.oldParams,e.newParams,!0},apply:function(e,t){var r=this,n=e.a,a=e.params;return Qe.create("Model Unit Cell",function(i){return pe(r,void 0,void 0,function(){var o,s,u,l;return he(this,function(c){switch(c.label){case 0:return o=wa.Provider.get(n.data),o?(s=D9(n.data,o,a),u=uOe(T({webgl:(l=t.canvas3d)===null||l===void 0?void 0:l.webgl},t.representation.structure.themes),function(){return M9}),[4,u.createOrUpdate(a,s).runInContext(i)]):[2,qn.Null];case 1:return c.sent(),[2,new be.Shape.Representation3D({repr:u,sourceData:s},{label:"Unit Cell",description:o.spacegroup.name})]}})})})},update:function(e){var t=this,r=e.a,n=e.b,a=e.newParams;return Qe.create("Model Unit Cell",function(i){return pe(t,void 0,void 0,function(){var o,s,u;return he(this,function(l){switch(l.label){case 0:return o=wa.Provider.get(r.data),o?(s=T(T({},n.data.repr.props),a),u=D9(r.data,o,s),[4,n.data.repr.createOrUpdate(s,u).runInContext(i)]):[2,gt.UpdateResult.Null];case 1:return l.sent(),n.data.sourceData=u,[2,gt.UpdateResult.Updated]}})})})}}),jBe=Ut.BuiltIn({name:"structure-bounding-box-3d",display:"Bounding Box",from:be.Molecule.Structure,to:be.Shape.Representation3D,params:T({radius:M.Numeric(.05,{min:.01,max:4,step:.01},{isEssential:!0}),color:M.Color(gr.red,{isEssential:!0})},Wt.Params)})({canAutoUpdate:function(){return!0},apply:function(e,t){var r=this,n=e.a,a=e.params;return Qe.create("Bounding Box",function(i){return pe(r,void 0,void 0,function(){var o;return he(this,function(s){switch(s.label){case 0:return o=Ga(function(u,l,c,d){var f=Xk(l.box,l.radius,d?.geometry);return Nr.create("Bouding Box",l,f,function(){return l.color},function(){return 1},function(){return"Bounding Box"})},Wt.Utils),[4,o.createOrUpdate(a,{box:n.data.boundary.box,radius:a.radius,color:a.color}).runInContext(i)];case 1:return s.sent(),[2,new be.Shape.Representation3D({repr:o,sourceData:n.data},{label:"Bounding Box"})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b;e.oldParams;var i=e.newParams;return Qe.create("Bounding Box",function(o){return pe(r,void 0,void 0,function(){return he(this,function(s){switch(s.label){case 0:return[4,a.data.repr.createOrUpdate(i,{box:n.data.boundary.box,radius:i.radius,color:i.color}).runInContext(o)];case 1:return s.sent(),a.data.sourceData=n.data,[2,gt.UpdateResult.Updated]}})})})}}),GBe=Ut.BuiltIn({name:"structure-selections-distance-3d",display:"3D Distance",from:be.Molecule.Structure.Selections,to:be.Shape.Representation3D,params:function(){return T({},R9)}})({canAutoUpdate:function(e){return e.oldParams,e.newParams,!0},apply:function(e,t){var r=this,n=e.a,a=e.params;return Qe.create("Structure Distance",function(i){return pe(r,void 0,void 0,function(){var o,s,u;return he(this,function(l){switch(l.label){case 0:return o=O9(n.data),s=SOe(T({webgl:(u=t.canvas3d)===null||u===void 0?void 0:u.webgl},t.representation.structure.themes),function(){return R9}),[4,s.createOrUpdate(a,o).runInContext(i)];case 1:return l.sent(),[2,new be.Shape.Representation3D({repr:s,sourceData:o},{label:"Distance"})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b;e.oldParams;var i=e.newParams;return Qe.create("Structure Distance",function(o){return pe(r,void 0,void 0,function(){var s,u;return he(this,function(l){switch(l.label){case 0:return s=T(T({},a.data.repr.props),i),u=O9(n.data),[4,a.data.repr.createOrUpdate(s,u).runInContext(o)];case 1:return l.sent(),a.data.sourceData=u,[2,gt.UpdateResult.Updated]}})})})}}),qBe=Ut.BuiltIn({name:"structure-selections-angle-3d",display:"3D Angle",from:be.Molecule.Structure.Selections,to:be.Shape.Representation3D,params:function(){return T({},j9)}})({canAutoUpdate:function(e){return e.oldParams,e.newParams,!0},apply:function(e,t){var r=this,n=e.a,a=e.params;return Qe.create("Structure Angle",function(i){return pe(r,void 0,void 0,function(){var o,s,u;return he(this,function(l){switch(l.label){case 0:return o=B9(n.data),s=sBe(T({webgl:(u=t.canvas3d)===null||u===void 0?void 0:u.webgl},t.representation.structure.themes),function(){return j9}),[4,s.createOrUpdate(a,o).runInContext(i)];case 1:return l.sent(),[2,new be.Shape.Representation3D({repr:s,sourceData:o},{label:"Angle"})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b;e.oldParams;var i=e.newParams;return Qe.create("Structure Angle",function(o){return pe(r,void 0,void 0,function(){var s,u;return he(this,function(l){switch(l.label){case 0:return s=T(T({},a.data.repr.props),i),u=B9(n.data),[4,a.data.repr.createOrUpdate(s,u).runInContext(o)];case 1:return l.sent(),a.data.sourceData=u,[2,gt.UpdateResult.Updated]}})})})}}),WBe=Ut.BuiltIn({name:"structure-selections-dihedral-3d",display:"3D Dihedral",from:be.Molecule.Structure.Selections,to:be.Shape.Representation3D,params:function(){return T({},G9)}})({canAutoUpdate:function(e){return e.oldParams,e.newParams,!0},apply:function(e,t){var r=this,n=e.a,a=e.params;return Qe.create("Structure Dihedral",function(i){return pe(r,void 0,void 0,function(){var o,s,u;return he(this,function(l){switch(l.label){case 0:return o=F9(n.data),s=PBe(T({webgl:(u=t.canvas3d)===null||u===void 0?void 0:u.webgl},t.representation.structure.themes),function(){return G9}),[4,s.createOrUpdate(a,o).runInContext(i)];case 1:return l.sent(),[2,new be.Shape.Representation3D({repr:s,sourceData:o},{label:"Dihedral"})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b;e.oldParams;var i=e.newParams;return Qe.create("Structure Dihedral",function(o){return pe(r,void 0,void 0,function(){var s,u;return he(this,function(l){switch(l.label){case 0:return s=T(T({},a.data.repr.props),i),u=F9(n.data),[4,a.data.repr.createOrUpdate(s,u).runInContext(o)];case 1:return l.sent(),a.data.sourceData=u,[2,gt.UpdateResult.Updated]}})})})}}),XBe=Ut.BuiltIn({name:"structure-selections-label-3d",display:"3D Label",from:be.Molecule.Structure.Selections,to:be.Shape.Representation3D,params:function(){return T({},z9)}})({canAutoUpdate:function(e){return e.oldParams,e.newParams,!0},apply:function(e,t){var r=this,n=e.a,a=e.params;return Qe.create("Structure Label",function(i){return pe(r,void 0,void 0,function(){var o,s,u;return he(this,function(l){switch(l.label){case 0:return o=L9(n.data),s=EOe(T({webgl:(u=t.canvas3d)===null||u===void 0?void 0:u.webgl},t.representation.structure.themes),function(){return z9}),[4,s.createOrUpdate(a,o).runInContext(i)];case 1:return l.sent(),[2,new be.Shape.Representation3D({repr:s,sourceData:o},{label:"Label"})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b;e.oldParams;var i=e.newParams;return Qe.create("Structure Label",function(o){return pe(r,void 0,void 0,function(){var s,u;return he(this,function(l){switch(l.label){case 0:return s=T(T({},a.data.repr.props),i),u=L9(n.data),[4,a.data.repr.createOrUpdate(s,u).runInContext(o)];case 1:return l.sent(),a.data.sourceData=u,[2,gt.UpdateResult.Updated]}})})})}}),YBe=Ut.BuiltIn({name:"structure-selections-orientation-3d",display:"3D Orientation",from:be.Molecule.Structure.Selections,to:be.Shape.Representation3D,params:function(){return T({},H9)}})({canAutoUpdate:function(e){return e.oldParams,e.newParams,!0},apply:function(e,t){var r=this,n=e.a,a=e.params;return Qe.create("Structure Orientation",function(i){return pe(r,void 0,void 0,function(){var o,s,u;return he(this,function(l){switch(l.label){case 0:return o=N9(n.data),s=XOe(T({webgl:(u=t.canvas3d)===null||u===void 0?void 0:u.webgl},t.representation.structure.themes),function(){return H9}),[4,s.createOrUpdate(a,o).runInContext(i)];case 1:return l.sent(),[2,new be.Shape.Representation3D({repr:s,sourceData:o},{label:"Orientation"})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b;e.oldParams;var i=e.newParams;return Qe.create("Structure Orientation",function(o){return pe(r,void 0,void 0,function(){var s,u;return he(this,function(l){switch(l.label){case 0:return s=T(T({},a.data.repr.props),i),u=N9(n.data),[4,a.data.repr.createOrUpdate(s,u).runInContext(o)];case 1:return l.sent(),a.data.sourceData=u,[2,gt.UpdateResult.Updated]}})})})}}),KBe=Object.freeze({__proto__:null,StructureRepresentation3D:e3,ExplodeStructureRepresentation3D:kBe,SpinStructureRepresentation3D:RBe,UnwindStructureAssemblyRepresentation3D:DBe,OverpaintStructureRepresentation3DFromScript:OBe,OverpaintStructureRepresentation3DFromBundle:BBe,TransparencyStructureRepresentation3DFromScript:FBe,TransparencyStructureRepresentation3DFromBundle:LBe,ClippingStructureRepresentation3DFromScript:NBe,ClippingStructureRepresentation3DFromBundle:zBe,VolumeRepresentation3D:UBe,get VolumeRepresentation3DHelpers(){return nd},ShapeRepresentation3D:VBe,ModelUnitcell3D:HBe,StructureBoundingBox3D:jBe,StructureSelectionsDistance3D:GBe,StructureSelectionsAngle3D:qBe,StructureSelectionsDihedral3D:WBe,StructureSelectionsLabel3D:XBe,StructureSelectionsOrientation3D:YBe}),lt={Data:Qxe,Misc:Jxe,Model:YRe,Volume:o6e,Representation:KBe,Shape:MBe};function Pn(){var e=function(t,r){return t.commands.dispatch(e,r||{})};return e.subscribe=function(t,r){return t.commands.subscribe(e,r)},e.id=Cn.create22(),e}var $Be=function(){function e(){this.subs=new Map,this.disposing=!1}return e.prototype.subscribe=function(t,r){var n=this,a=this.subs.get(t.id);return a||(a=[],this.subs.set(t.id,a)),a.push(r),{unsubscribe:function(){var i=n.subs.get(t.id);if(!!i){var o=i.indexOf(r);if(!(o<0)){for(var s=o+1;s<i.length;s++)i[s-1]=i[s];i.pop()}}}}},e.prototype.dispatch=function(t,r){var n=this;return new Promise(function(a,i){if(n.disposing){i("disposed");return}var o=n.subs.get(t.id);if(!o){a();return}n.resolve({cmd:t,params:r,resolve:a,reject:i})})},e.prototype.dispose=function(){this.subs.clear()},e.prototype.resolve=function(t){return pe(this,void 0,void 0,function(){var r,n,a,i,o;return he(this,function(s){switch(s.label){case 0:if(r=this.subs.get(t.cmd.id),!r)return t.resolve(),[2];s.label=1;case 1:s.trys.push([1,6,,7]),n=0,a=r,s.label=2;case 2:return n<a.length?(i=a[n],[4,i(t.params)]):[3,5];case 3:s.sent(),s.label=4;case 4:return n++,[3,2];case 5:return t.resolve(),[3,7];case 6:return o=s.sent(),t.reject(o),[3,7];case 7:return[2]}})})},e}(),Rt={State:{SetCurrentObject:Pn(),ApplyAction:Pn(),Update:Pn(),RemoveObject:Pn(),ToggleExpanded:Pn(),ToggleVisibility:Pn(),Snapshots:{Add:Pn(),Replace:Pn(),Move:Pn(),Remove:Pn(),Apply:Pn(),Clear:Pn(),Upload:Pn(),Fetch:Pn(),DownloadToFile:Pn(),OpenFile:Pn(),OpenUrl:Pn()}},Interactivity:{Object:{Highlight:Pn()},Structure:{Highlight:Pn(),Select:Pn()},ClearHighlights:Pn()},Layout:{Update:Pn()},Toast:{Show:Pn(),Hide:Pn()},Camera:{Reset:Pn(),SetSnapshot:Pn(),Focus:Pn()},Canvas3D:{SetSettings:Pn(),ResetSettings:Pn()}},QBe=pp.create({name:"built-in.animate-assembly-unwind",display:{name:"Unwind Assembly"},isExportable:!0,params:function(e){for(var t=[["all","All"]],r=e.state.data.select(lr.Generators.rootsOfType(be.Molecule.Structure)),n=0,a=r;n<a.length;n++){var i=a[n];t.push([i.transform.ref,i.obj.data.models[0].label])}return{durationInMs:M.Numeric(3e3,{min:100,max:1e4,step:100}),playOnce:M.Boolean(!1),target:M.Select(t[0][0],t)}},canApply:function(e){var t=e.state.data,r=vr.RootRef,n=t.select(lr.Generators.ofType(be.Molecule.Structure.Representation3D,r));return{canApply:n.length>0}},getDuration:function(e){return{kind:"fixed",durationMs:e.durationInMs}},initialState:function(){return{t:0}},setup:function(e,t,r){for(var n=r.state.data,a=!e.target||e.target==="all"?vr.RootRef:e.target,i=n.select(lr.Generators.ofType(be.Molecule.Structure.Representation3D,a)),o=n.build(),s=!1,u=0,l=i;u<l.length;u++){var c=l[u],d=n.select(lr.Generators.ofTransformer(lt.Representation.UnwindStructureAssemblyRepresentation3D,c.transform.ref));d.length>0||(s=!0,o.to(c).apply(lt.Representation.UnwindStructureAssemblyRepresentation3D,{t:0},{tags:"animate-assembly-unwind"}))}if(!!s)return o.commit({doNotUpdateCurrent:!0})},teardown:function(e,t,r){var n=r.state.data,a=n.select(lr.Generators.ofType(be.Molecule.Structure.Representation3DState).withTag("animate-assembly-unwind"));if(a.length!==0){for(var i=n.build(),o=0,s=a;o<s.length;o++){var u=s[o];i.delete(u.transform.ref)}return i.commit()}},apply:function(e,t,r){return pe(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d,f;return he(this,function(p){switch(p.label){case 0:if(n=r.plugin.state.data,a=!r.params.target||r.params.target==="all"?vr.RootRef:r.params.target,i=n.select(lr.Generators.ofTransformer(lt.Representation.UnwindStructureAssemblyRepresentation3D,a)),i.length===0)return[2,{kind:"finished"}];for(o=n.build(),s=(t.current-t.lastApplied)/r.params.durationInMs,u=e.t+s,l=!1,r.params.playOnce&&u>=1?(l=!0,u=1):u=u%1,c=0,d=i;c<d.length;c++)f=d[c],o.to(f).update({t:u});return[4,Rt.State.Update(r.plugin,{state:n,tree:o,options:{doNotLogTiming:!0}})];case 1:return p.sent(),l?[2,{kind:"finished"}]:[2,{kind:"next",state:{t:u}}]}})})}}),ax=A(),q9=A(),W9=aa(),ZBe=pp.create({name:"built-in.animate-camera-spin",display:{name:"Camera Spin"},isExportable:!0,params:function(){return{durationInMs:M.Numeric(4e3,{min:100,max:2e4,step:100}),speed:M.Numeric(1,{min:1,max:10,step:1},{description:"How many times to spin in the specified dutation."}),direction:M.Select("cw",[["cw","Clockwise"],["ccw","Counter Clockwise"]],{cycle:!0})}},initialState:function(e,t){var r;return{snapshot:(r=t.canvas3d)===null||r===void 0?void 0:r.camera.getSnapshot()}},getDuration:function(e){return{kind:"fixed",durationMs:e.durationInMs}},teardown:function(e,t,r){var n;(n=r.canvas3d)===null||n===void 0||n.requestCameraReset({snapshot:t.snapshot,durationMs:0})},apply:function(e,t,r){var n,a;return pe(this,void 0,void 0,function(){var i,o,s,u;return he(this,function(l){return t.current===0?[2,{kind:"next",state:e}]:(i=e.snapshot,i.radiusMax<1e-4?[2,{kind:"finished"}]:(o=$i(t.current/r.params.durationInMs,0,1),o>=.99999?((n=r.plugin.canvas3d)===null||n===void 0||n.requestCameraReset({snapshot:i,durationMs:0}),[2,{kind:"finished"}]):(s=2*Math.PI*o*r.params.speed*(r.params.direction==="ccw"?-1:1),A.sub(ax,i.position,i.target),A.normalize(q9,i.up),aa.setAxisAngle(W9,q9,s),A.transformQuat(ax,ax,W9),u=A.add(A(),i.target,ax),(a=r.plugin.canvas3d)===null||a===void 0||a.requestCameraReset({snapshot:T(T({},i),{position:u}),durationMs:0}),[2,{kind:"next",state:e}])))})})}}),JBe=pp.create({name:"built-in.animate-model-index",display:{name:"Animate Trajectory"},isExportable:!0,params:function(){return{mode:M.MappedStatic("loop",{palindrome:M.Group({}),loop:M.Group({direction:M.Select("forward",[["forward","Forward"],["backward","Backward"]])}),once:M.Group({direction:M.Select("forward",[["forward","Forward"],["backward","Backward"]])},{isFlat:!0})},{options:[["palindrome","Palindrome"],["loop","Loop"],["once","Once"]]}),duration:M.MappedStatic("fixed",{fixed:M.Group({durationInS:M.Numeric(5,{min:1,max:120,step:.1},{description:"Duration in seconds"})},{isFlat:!0}),computed:M.Group({targetFps:M.Numeric(30,{min:5,max:250,step:1},{label:"Target FPS"})},{isFlat:!0}),sequential:M.Group({maxFps:M.Numeric(30,{min:5,max:60,step:1})},{isFlat:!0})})}},canApply:function(e){for(var t=e.state.data,r=t.select(lr.Generators.ofTransformer(lt.Model.ModelFromTrajectory)),n=0,a=r;n<a.length;n++){var i=a[n],o=lr.findAncestorOfType(t.tree,t.cells,i.transform.ref,be.Molecule.Trajectory);if(o&&o.obj&&o.obj.data.frameCount>1)return{canApply:!0}}return{canApply:!1,reason:"No trajectory to animate"}},getDuration:function(e,t){var r;if(((r=e.duration)===null||r===void 0?void 0:r.name)==="fixed")return{kind:"fixed",durationMs:e.duration.params.durationInS*1e3};if(e.duration.name==="computed"){for(var n=t.state.data,a=n.select(lr.Generators.ofTransformer(lt.Model.ModelFromTrajectory)),i=0,o=0,s=a;o<s.length;o++){var u=s[o],l=lr.findAncestorOfType(n.tree,n.cells,u.transform.ref,be.Molecule.Trajectory);if(!(!l||!l.obj)){var c=l.obj;i=Math.max(Math.ceil(1e3*c.data.frameCount/e.duration.params.targetFps),i)}}return{kind:"fixed",durationMs:i}}return{kind:"unknown"}},initialState:function(){return{}},apply:function(e,t,r){return pe(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d,f,p;return he(this,function(h){switch(h.label){case 0:if(r.params.duration.name==="sequential"&&t.current>0&&t.current-t.lastApplied<1e3/r.params.duration.params.maxFps)return[2,{kind:"skip"}];if(n=r.plugin.state.data,a=n.select(lr.Generators.ofTransformer(lt.Model.ModelFromTrajectory)),a.length===0)return[2,{kind:"finished"}];for(i=n.build(),o=r.params,s=e.palindromeDirections||{},u=!1,l=!0,c=function(m){var v=lr.findAncestorOfType(n.tree,n.cells,m.transform.ref,be.Molecule.Trajectory);if(!v||!v.obj)return"continue";var g=v.obj;if(g.data.frameCount<=1)return"continue";i.to(m).update(function(y){var b=g.data.frameCount;if(b!==1)l=!1;else return y;if(o.duration.name==="sequential"){var S=1;if(o.mode.name==="once"){if(S=o.mode.params.direction==="backward"?-1:1,S===-1&&y.modelIndex===0||S===1&&y.modelIndex===b-1)return u=!0,y}else o.mode.name==="palindrome"&&(y.modelIndex===0?S=1:y.modelIndex===b-1?S=-1:S=s[m.transform.ref]||1);s[m.transform.ref]=S;var x=(y.modelIndex+S)%b;return x<0&&(x+=b),u=u||S===-1&&x===0||S===1&&x===b-1,{modelIndex:x}}else{var C=o.duration.name==="fixed"?o.duration.params.durationInS*1e3:Math.ceil(1e3*g.data.frameCount/o.duration.params.targetFps),w=t.current%C/C;o.mode.name==="loop"&&o.mode.params.direction==="backward"&&(w=1-w),o.mode.name==="palindrome"&&(w=2*w,w>1&&(w=2-w));var x=Math.min(Math.floor(g.data.frameCount*w),g.data.frameCount-1);return u=u||x===g.data.frameCount-1,{modelIndex:x}}})},d=0,f=a;d<f.length;d++)p=f[d],c(p);return l?[3,2]:[4,Rt.State.Update(r.plugin,{state:n,tree:i,options:{doNotLogTiming:!0}})];case 1:h.sent(),h.label=2;case 2:return l||o.mode.name==="once"&&u?[2,{kind:"finished"}]:o.mode.name==="palindrome"?[2,{kind:"next",state:{palindromeDirections:s}}]:[2,{kind:"next",state:{}}]}})})}});function X9(e,t,r){var n;return r===void 0&&(r=!1),pe(this,void 0,void 0,function(){return he(this,function(a){switch(a.label){case 0:return t.snapshot.data?[4,e.runTask(e.state.data.setSnapshot(t.snapshot.data))]:[3,2];case 1:a.sent(),a.label=2;case 2:return t.snapshot.camera&&((n=e.canvas3d)===null||n===void 0||n.requestCameraReset({snapshot:t.snapshot.camera.current,durationMs:r||t.snapshot.camera.transitionStyle==="instant"?0:t.snapshot.camera.transitionDurationInMs})),[2]}})})}var eFe=pp.create({name:"built-in.animate-state-snapshots",display:{name:"State Snapshots"},isExportable:!0,params:function(){return{}},canApply:function(e){var t=e.managers.snapshot.state.entries;return t.size<2?{canApply:!1,reason:"At least 2 states required."}:t.some(function(r){return!!r?.snapshot.startAnimation})?{canApply:!1,reason:"Nested animations not supported."}:{canApply:e.managers.snapshot.state.entries.size>1}},setup:function(e,t,r){var n=r.managers.snapshot.state.entries.get(0);X9(r,n,!0)},getDuration:function(e,t){return{kind:"fixed",durationMs:t.managers.snapshot.state.entries.toArray().reduce(function(r,n){var a;return r+((a=n.snapshot.durationInMs)!==null&&a!==void 0?a:0)},0)}},initialState:function(e,t){var r=t.managers.snapshot.state.entries.toArray();return{totalDuration:r.reduce(function(n,a){var i;return n+((i=a.snapshot.durationInMs)!==null&&i!==void 0?i:0)},0),snapshots:r,currentIndex:0}},apply:function(e,t,r){var n;return pe(this,void 0,void 0,function(){var a,i,o,s,u;return he(this,function(l){if(t.current>=e.totalDuration)return[2,{kind:"finished"}];for(a=0,i=0,o=0,s=e.snapshots;o<s.length&&(u=s[o],a+=(n=u.snapshot.durationInMs)!==null&&n!==void 0?n:0,!(t.current<a));o++)i++;return i>=e.snapshots.length?[2,{kind:"finished"}]:i===e.currentIndex?[2,{kind:"skip"}]:(X9(r.plugin,e.snapshots[i]),[2,{kind:"next",state:T(T({},e),{currentIndex:i})}])})})}}),Ur;(function(e){var t=function(c){Le(d,c);function d(){return c!==null&&c.apply(this,arguments)||this}return d}(be.Create({name:"Root",typeClass:"Root"}));e.Root=t;var r=function(c){Le(d,c);function d(){return c!==null&&c.apply(this,arguments)||this}return d}(be.Create({name:"Category",typeClass:"Object"}));e.Category=r;var n=function(c){Le(d,c);function d(){return c!==null&&c.apply(this,arguments)||this}return d}(be.CreateBehavior({name:"Behavior"}));e.Behavior=n,e.Categories={common:"Common",representation:"Representation",interaction:"Interaction","custom-props":"Custom Properties",misc:"Miscellaneous"},e.CreateCategory=Ut.BuiltIn({name:"create-behavior-category",display:{name:"Behavior Category"},from:t,to:r,params:{label:M.Text("",{isHidden:!0})}})({apply:function(c){var d=c.params;return new r({},{label:d.label})}});var a=new Map;function i(c){return a.get(c.id)}e.getCategoryId=i;function o(c){var d=Ut.CreateBuiltIn({name:c.name,display:c.display,from:[t],to:[n],params:c.params,apply:function(f,p){var h=f.params,m=c.label?c.label(h):{label:c.display.name,description:c.display.description};return new n(new c.ctor(p,h),m)},update:function(f){var p=this,h=f.b,m=f.newParams;return Qe.create("Update Behavior",function(){return pe(p,void 0,void 0,function(){var v;return he(this,function(g){switch(g.label){case 0:return h.data.update?[4,h.data.update(m)]:[2,gt.UpdateResult.Unchanged];case 1:return v=g.sent(),[2,v?gt.UpdateResult.Updated:gt.UpdateResult.Unchanged]}})})})},canAutoUpdate:c.canAutoUpdate});return a.set(d.id,c.category),d}e.create=o;function s(c,d){return function(){function f(p){this.ctx=p,this.sub=void 0}return f.prototype.register=function(){var p=this;this.sub=c.subscribe(this.ctx,function(h){return d(h,p.ctx)})},f.prototype.unregister=function(){this.sub&&this.sub.unsubscribe(),this.sub=void 0},f}()}e.simpleCommandHandler=s;var u=function(){function c(d,f){this.ctx=d,this.params=f,this.subs=[]}return c.prototype.subscribeCommand=function(d,f){this.subs.push(d.subscribe(this.ctx,f))},c.prototype.subscribeObservable=function(d,f){this.subs.push(d.subscribe(f))},c.prototype.track=function(d){this.subs.push(d)},c.prototype.unregister=function(){for(var d=0,f=this.subs;d<f.length;d++){var p=f[d];p.unsubscribe()}this.subs=[]},c.prototype.update=function(d){return p0(d,this.params)?!1:(this.params=d,!0)},c}();e.Handler=u;var l=function(){function c(d,f){this.plugin=d,this.params=f,this.subs=[]}return c.prototype.subscribeCommand=function(d,f){this.subs.push(d.subscribe(this.plugin,f))},c.prototype.subscribeObservable=function(d,f){this.subs.push(d.subscribe(f))},c.prototype.unregister=function(){for(var d=0,f=this.subs;d<f.length;d++){var p=f[d];p.unsubscribe()}this.subs=[]},c}();e.WithSubscribers=l})(Ur||(Ur={}));var Sb=function(){function e(){this.subs=void 0}return e.prototype.subscribe=function(t,r){var n=this;typeof this.subs>"u"&&(this.subs=[]);var a=t.subscribe(r);return this.subs.push(a),{unsubscribe:function(){a&&n.subs&&Uh(n.subs,a)&&(a.unsubscribe(),a=void 0)}}},Object.defineProperty(e.prototype,"ev",{get:function(){return this._ev||(this._ev=pd.create())},enumerable:!1,configurable:!0}),e.prototype.dispose=function(){if(this._ev&&this._ev.dispose(),this.subs){for(var t=0,r=this.subs;t<r.length;t++){var n=r[t];n.unsubscribe()}this.subs=void 0}},e}(),Gd=function(e){Le(t,e);function t(r){var n=e.call(this)||this;return n._state=r,n}return t.prototype.updateState=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var a=this.state,i=bge(a,r);return i!==a?(this._state=i,!0):!1},Object.defineProperty(t.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),t}(Sb),tI="2.0.7",tFe=new Date(typeof __MOLSTAR_DEBUG_TIMESTAMP__<"u"?__MOLSTAR_DEBUG_TIMESTAMP__:1624445009906),t3=function(e){Le(t,e);function t(r){var n=e.call(this,{current:void 0,entries:ma.exports.List(),isPlaying:!1,nextSnapshotDelayInMs:t.DefaultNextSnapshotDelayInMs})||this;return n.plugin=r,n.entryMap=new Map,n.events={changed:n.ev()},n.timeoutHandle=void 0,n.next=function(){return pe(n,void 0,void 0,function(){var a,i,o;return he(this,function(s){switch(s.label){case 0:return this.timeoutHandle=void 0,a=this.getNextId(this.state.current,1),!a||a===this.state.current?(this.stop(),[2]):(i=this.setCurrent(a),[4,this.plugin.state.setSnapshot(i)]);case 1:return s.sent(),o=typeof i.durationInMs<"u"?i.durationInMs:this.state.nextSnapshotDelayInMs,this.state.isPlaying&&(this.timeoutHandle=setTimeout(this.next,o)),[2]}})})},n}return t.prototype.getIndex=function(r){return this.state.entries.indexOf(r)},t.prototype.getEntry=function(r){if(!!r)return this.entryMap.get(r)},t.prototype.remove=function(r){var n=this.entryMap.get(r);!n||(this.entryMap.delete(r),this.updateState({current:this.state.current===r?void 0:this.state.current,entries:this.state.entries.delete(this.getIndex(n))}),this.events.changed.next())},t.prototype.add=function(r){this.entryMap.set(r.snapshot.id,r),this.updateState({current:r.snapshot.id,entries:this.state.entries.push(r)}),this.events.changed.next()},t.prototype.replace=function(r,n){var a=this.getEntry(r);if(!!a){var i=this.getIndex(a),o=t.Entry(n,{name:a.name,description:a.description});this.entryMap.set(n.id,o),this.updateState({current:o.snapshot.id,entries:this.state.entries.set(i,o)}),this.events.changed.next()}},t.prototype.move=function(r,n){var a=this.state.entries.size;if(!(a<2)){var i=this.getEntry(r);if(!!i){var o=this.getIndex(i),s=(o+n)%a;s<0&&(s+=a);var u=this.state.entries.get(s),l=this.state.entries.asMutable();l.set(s,i),l.set(o,u),this.updateState({current:i.snapshot.id,entries:l.asImmutable()}),this.events.changed.next()}}},t.prototype.clear=function(){this.state.entries.size!==0&&(this.entryMap.clear(),this.updateState({current:void 0,entries:ma.exports.List()}),this.events.changed.next())},t.prototype.setCurrent=function(r){var n=this.getEntry(r);return n&&(this.updateState({current:r}),this.events.changed.next()),n&&n.snapshot},t.prototype.getNextId=function(r,n){var a=this.state.entries.size;if(!r){if(a===0)return;var i=n===-1?a-1:0;return this.state.entries.get(i).snapshot.id}var o=this.getEntry(r);if(!!o){var s=this.getIndex(o);if(!(s<0))return s=(s+n)%a,s<0&&(s+=a),this.state.entries.get(s).snapshot.id}},t.prototype.setStateSnapshot=function(r){return pe(this,void 0,void 0,function(){var n,a,i,o,s,u,l;return he(this,function(c){switch(c.label){case 0:for(r.version,this.clear(),n=ma.exports.List().asMutable(),a=0,i=r.entries;a<i.length;a++)o=i[a],this.entryMap.set(o.snapshot.id,o),n.push(o);return s=r.current?r.current:r.entries.length>0?r.entries[0].snapshot.id:void 0,this.updateState({current:s,entries:n.asImmutable(),isPlaying:!1,nextSnapshotDelayInMs:r.playback?r.playback.nextSnapshotDelayInMs:t.DefaultNextSnapshotDelayInMs}),this.events.changed.next(),s?(u=this.getEntry(s),l=u&&u.snapshot,l?[4,this.plugin.state.setSnapshot(l)]:[2]):[2];case 1:return c.sent(),r.playback&&r.playback.isPlaying&&this.play(!0),[2,l]}})})},t.prototype.syncCurrent=function(r){var n=this.plugin.state.getSnapshot(r?.params);this.state.entries.size===0||!this.state.current?this.add(t.Entry(n,{name:r?.name,description:r?.description})):this.replace(this.state.current,n)},t.prototype.getStateSnapshot=function(r){return this.syncCurrent(r),{timestamp:+new Date,version:tI,name:r&&r.name,description:r&&r.description,current:this.state.current,playback:{isPlaying:!!(r&&r.playOnLoad),nextSnapshotDelayInMs:this.state.nextSnapshotDelayInMs},entries:this.state.entries.valueSeq().toArray()}},t.prototype.serialize=function(r){return pe(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d,f,p,h,m,v,g;return he(this,function(y){switch(y.label){case 0:return n=JSON.stringify(this.getStateSnapshot({params:r?.params}),null,2),!r?.type||r.type==="json"||r.type==="molj"?[2,new Blob([n],{type:"application/json;charset=utf-8"})]:[3,1];case 1:a=new Uint8Array(xC(n)),Mv(a,0,n),i={"state.json":a},o=[],s=0,u=this.plugin.managers.asset.assets,y.label=2;case 2:return s<u.length?(l=u[s],c=l.asset,d=l.file,o.push([c.id,c]),f=i,p="assets/"+c.id,h=Uint8Array.bind,[4,d.arrayBuffer()]):[3,5];case 3:f[p]=new(h.apply(Uint8Array,[void 0,y.sent()])),y.label=4;case 4:return s++,[3,2];case 5:return o.length>0&&(m=JSON.stringify(o,null,2),v=new Uint8Array(xC(m)),Mv(v,0,m),i["assets.json"]=v),[4,this.plugin.runTask(Oye(i))];case 6:return g=y.sent(),[2,new Blob([g],{type:"application/zip"})]}})})},t.prototype.open=function(r){return pe(this,void 0,void 0,function(){var n,a,g,a,i,o,s,u,l,c,d,f,p,h,m,v,g,y;return he(this,function(b){switch(b.label){case 0:return b.trys.push([0,8,,9]),n=r.name.toLowerCase(),n.endsWith("json")||n.endsWith("molj")?[4,this.plugin.runTask(qf(r,"string"))]:[3,2];case 1:return a=b.sent(),g=JSON.parse(a),t.isStateSnapshot(g)?[2,this.setStateSnapshot(g)]:t.isStateSnapshot(g.data)?[2,this.setStateSnapshot(g.data)]:(this.plugin.state.setSnapshot(g),[3,7]);case 2:return[4,this.plugin.runTask(qf(r,"zip"))];case 3:return a=b.sent(),i=Object.create(null),rl(a,function(S,x){if(!(x==="state.json"||x==="assets.json")){var C=x.substring(x.indexOf("/")+1);i[C]=new File([S],C)}}),o=new File([a["state.json"]],"state.json"),[4,this.plugin.runTask(qf(o,"string"))];case 4:return s=b.sent(),a["assets.json"]?(u=new File([a["assets.json"]],"assets.json"),d=(c=JSON).parse,[4,this.plugin.runTask(qf(u,"string"))]):[3,6];case 5:for(l=d.apply(c,[b.sent()]),f=0,p=l;f<p.length;f++)h=p[f],m=h[0],v=h[1],this.plugin.managers.asset.set(v,i[m]);b.label=6;case 6:return g=JSON.parse(s),[2,this.setStateSnapshot(g)];case 7:return[3,9];case 8:return y=b.sent(),this.plugin.log.error("Reading state: "+y),[3,9];case 9:return[2]}})})},t.prototype.play=function(r){if(r===void 0&&(r=!1),this.updateState({isPlaying:!0}),r){var n=this.getEntry(this.state.current);if(!n){this.next();return}this.events.changed.next();var a=n.snapshot,i=typeof a.durationInMs<"u"?a.durationInMs:this.state.nextSnapshotDelayInMs;this.timeoutHandle=setTimeout(this.next,i)}else this.next()},t.prototype.stop=function(){this.updateState({isPlaying:!1}),typeof this.timeoutHandle<"u"&&clearTimeout(this.timeoutHandle),this.timeoutHandle=void 0,this.events.changed.next()},t.prototype.togglePlay=function(){this.state.isPlaying?(this.stop(),this.plugin.managers.animation.stop()):this.play()},t.DefaultNextSnapshotDelayInMs=1500,t}(Gd);(function(e){function t(n,a){return T({timestamp:+new Date,snapshot:n},a)}e.Entry=t;function r(n){var a=n;return!!a&&!!a.timestamp&&!!a.entries}e.isStateSnapshot=r})(t3||(t3={}));function rFe(){var e=new Date,t=e.getFullYear(),r=e.getMonth()+1,n=e.getDate(),a=e.getHours(),i=e.getMinutes(),o=e.getSeconds();return t+"-"+r+"-"+n+"-"+a+"-"+i+"-"+o}function nFe(e){var t=window.open(e,"_blank");t||(window.location.href=e)}function Y9(e){try{e.dispatchEvent(new MouseEvent("click"))}catch{var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}function WK(e,t){if(t===void 0&&(t="download"),!!e)if("download"in HTMLAnchorElement.prototype){var r=document.createElement("a");r.download=t,r.rel="noopener",typeof e=="string"?(r.href=e,Y9(r)):(r.href=URL.createObjectURL(e),setTimeout(function(){return URL.revokeObjectURL(r.href)},4e4),setTimeout(function(){return Y9(r)}))}else if(typeof navigator<"u"&&navigator.msSaveOrOpenBlob)navigator.msSaveOrOpenBlob(e,t);else{var n=window.navigator.userAgent,a=/Safari/i.test(n),i=/CriOS\/[\d]+/.test(n),o=function(l){nFe(i?l:l.replace(/^data:[^;]*;/,"data:attachment/file;"))};if((a||i)&&FileReader)if(e instanceof Blob){var s=new FileReader;s.onloadend=function(){return o(s.result)},s.readAsDataURL(e)}else o(e);else{var u=URL.createObjectURL(e);location.href=u,setTimeout(function(){return URL.revokeObjectURL(u)},4e4)}}}function w_(e,t){return""+e+(e[e.length-1]==="/"||t[0]==="/"?"":"/")+t}var aFe=function(){function e(t,r){this.key=t,this.defaultValue=r}return e.prototype.toString=function(){return this.key},e.prototype.valueOf=function(){return this.key},e}();function ya(e,t){return new aFe(e,t)}var Qn={item:ya,General:{IsBusyTimeoutMs:ya("plugin-config.is-busy-timeout",750),DisableAntialiasing:ya("plugin-config.disable-antialiasing",!1),DisablePreserveDrawingBuffer:ya("plugin-config.disable-preserve-drawing-buffer",!1),PixelScale:ya("plugin-config.pixel-scale",1),PickScale:ya("plugin-config.pick-scale",.25),EnableWboit:ya("plugin-config.enable-wboit",!0)},State:{DefaultServer:ya("plugin-state.server","https://webchem.ncbr.muni.cz/molstar-state"),CurrentServer:ya("plugin-state.server","https://webchem.ncbr.muni.cz/molstar-state"),HistoryCapacity:ya("history-capacity.server",5)},VolumeStreaming:{Enabled:ya("volume-streaming.enabled",!0),DefaultServer:ya("volume-streaming.server","https://ds.litemol.org"),CanStream:ya("volume-streaming.can-stream",function(e,t){return e.models.length===1&&rr.probablyHasDensityMap(e.models[0])}),EmdbHeaderServer:ya("volume-streaming.emdb-header-server","https://ftp.wwpdb.org/pub/emdb/structures")},Viewport:{ShowExpand:ya("viewer.show-expand-button",!0),ShowControls:ya("viewer.show-controls-button",!0),ShowSettings:ya("viewer.show-settings-button",!0),ShowSelectionMode:ya("viewer.show-selection-model-button",!0),ShowAnimation:ya("viewer.show-animation-button",!0)},Download:{DefaultPdbProvider:ya("download.default-pdb-provider","pdbe"),DefaultEmdbProvider:ya("download.default-emdb-provider","pdbe")},Structure:{SizeThresholds:ya("structure.size-thresholds",$e.DefaultSizeThresholds),DefaultRepresentationPresetParams:ya("structure.default-representation-preset-params",{})}},iFe=function(){function e(t){var r=this;this._config=new Map,t&&t.forEach(function(n){var a=n[0],i=n[1];return r._config.set(a,i)})}return e.prototype.get=function(t){return this._config.has(t)?this._config.get(t):t.defaultValue},e.prototype.set=function(t,r){this._config.set(t,r)},e.prototype.delete=function(t){this._config.delete(t)},e}();function oFe(e){XK(e),YK(e),KK(e),$K(e),QK(e),ZK(e),JK(e),e$(e),t$(e),r$(e)}function XK(e){e.state.events.object.created.subscribe(function(t){!be.isBehavior(t.obj)||t.obj.data.register(t.ref)}),e.state.events.object.removed.subscribe(function(t){!be.isBehavior(t.obj)||t.obj.data.unregister()}),e.state.events.object.updated.subscribe(function(t){t.action==="recreate"&&(t.oldObj&&be.isBehavior(t.oldObj)&&t.oldObj.data.unregister(),t.obj&&be.isBehavior(t.obj)&&t.obj.data.register(t.ref))})}function YK(e){Rt.State.SetCurrentObject.subscribe(e,function(t){var r=t.state,n=t.ref;return r.setCurrent(n)})}function KK(e){Rt.State.Update.subscribe(e,function(t){var r=t.state,n=t.tree,a=t.options;return e.runTask(r.updateTree(n,a))})}function $K(e){Rt.State.ApplyAction.subscribe(e,function(t){var r=t.state,n=t.action,a=t.ref;return e.runTask(r.applyAction(n.action,n.params,a))})}function QK(e){function t(r,n){var a=r.build().delete(n);return e.runTask(r.updateTree(a))}Rt.State.RemoveObject.subscribe(e,function(r){var n=r.state,a=r.ref,i=r.removeParentGhosts;if(i){var o=n.tree,s=o.transforms.get(a);if(s.parent===a)return t(n,a);for(;;){var u=o.children.get(s.parent);if(s.parent===s.ref||u.size>1)return t(n,s.ref);var l=o.transforms.get(s.parent);if(!l.state.isGhost)return t(n,s.ref);s=l}}else return t(n,a)})}function ZK(e){Rt.State.ToggleExpanded.subscribe(e,function(t){var r=t.state,n=t.ref;return r.updateCellState(n,function(a){var i=a.isCollapsed;return{isCollapsed:!i}})})}function JK(e){Rt.State.ToggleVisibility.subscribe(e,function(t){var r=t.state,n=t.ref;return pm(r,n,!r.cells.get(n).state.isHidden)})}function pm(e,t,r){xa.doPreOrder(e.tree,e.transforms.get(t),{state:e,value:r},sFe)}function sFe(e,t,r){r.state.updateCellState(e.ref,{isHidden:r.value})}function e$(e){Rt.Interactivity.Object.Highlight.subscribe(e,function(t){var r=t.state,n=t.ref;if(!(!e.canvas3d||e.isBusy)){e.managers.interactivity.lociHighlights.clearHighlights();for(var a=typeof n=="string"?[n]:n,i=0,o=a;i<o.length;i++){var s=o[i],u=r.cells.get(s);if(!!u){if(be.Molecule.Structure.is(u.obj))e.managers.interactivity.lociHighlights.highlight({loci:$e.Loci(u.obj.data)},!1);else if(u&&be.isRepresentation3D(u.obj)){var l=u.obj.data.repr;e.managers.interactivity.lociHighlights.highlight({loci:l.getLoci(),repr:l},!1)}else if(be.Molecule.Structure.Selections.is(u.obj))for(var c=0,d=u.obj.data;c<d.length;c++){var f=d[c];e.managers.interactivity.lociHighlights.highlight({loci:f.loci},!1)}}}}})}function t$(e){Rt.Interactivity.ClearHighlights.subscribe(e,function(){e.managers.interactivity.lociHighlights.clearHighlights()})}function r$(e){var t=this;e.config.set(Qn.State.CurrentServer,e.config.get(Qn.State.DefaultServer)),Rt.State.Snapshots.Clear.subscribe(e,function(){e.managers.snapshot.clear()}),Rt.State.Snapshots.Remove.subscribe(e,function(r){var n=r.id;e.managers.snapshot.remove(n)}),Rt.State.Snapshots.Add.subscribe(e,function(r){var n=r.name,a=r.description,i=r.params,o=t3.Entry(e.state.getSnapshot(i),{name:n,description:a});e.managers.snapshot.add(o)}),Rt.State.Snapshots.Replace.subscribe(e,function(r){var n=r.id,a=r.params;e.managers.snapshot.replace(n,e.state.getSnapshot(a))}),Rt.State.Snapshots.Move.subscribe(e,function(r){var n=r.id,a=r.dir;e.managers.snapshot.move(n,a)}),Rt.State.Snapshots.Apply.subscribe(e,function(r){var n=r.id,a=e.managers.snapshot.setCurrent(n);if(!!a)return e.state.setSnapshot(a)}),Rt.State.Snapshots.Upload.subscribe(e,function(r){var n=r.name,a=r.description,i=r.playOnLoad,o=r.serverUrl;return r.params,fetch(w_(o,"set?name="+encodeURIComponent(n||"")+"&description="+encodeURIComponent(a||"")),{method:"POST",mode:"cors",referrer:"no-referrer",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify(e.managers.snapshot.getStateSnapshot({name:n,description:a,playOnLoad:i}))})}),Rt.State.Snapshots.Fetch.subscribe(e,function(r){var n=r.url;return pe(t,void 0,void 0,function(){var a;return he(this,function(i){switch(i.label){case 0:return[4,e.runTask(e.fetch({url:n,type:"json"}))];case 1:return a=i.sent(),[4,e.managers.snapshot.setStateSnapshot(a.data)];case 2:return i.sent(),[2]}})})}),Rt.State.Snapshots.DownloadToFile.subscribe(e,function(r){var n=r.name,a=r.type,i=r.params;return pe(t,void 0,void 0,function(){var o,s;return he(this,function(u){switch(u.label){case 0:return o="mol-star_state_"+(n||rFe())+"."+(a==="json"?"molj":"molx"),[4,e.managers.snapshot.serialize({type:a,params:i})];case 1:return s=u.sent(),WK(s,""+o),[2]}})})}),Rt.State.Snapshots.OpenFile.subscribe(e,function(r){var n=r.file;return e.managers.snapshot.open(n)}),Rt.State.Snapshots.OpenUrl.subscribe(e,function(r){var n=r.url,a=r.type;return pe(t,void 0,void 0,function(){var i;return he(this,function(o){switch(o.label){case 0:return[4,e.runTask(e.fetch({url:n,type:"binary"}))];case 1:return i=o.sent(),[2,e.managers.snapshot.open(new File([i],"state."+a))]}})})})}var uFe=Object.freeze({__proto__:null,registerDefault:oFe,SyncBehaviors:XK,SetCurrentObject:YK,Update:KK,ApplyAction:$K,RemoveObject:QK,ToggleExpanded:ZK,ToggleVisibility:JK,setSubtreeVisibility:pm,Highlight:e$,ClearHighlights:t$,Snapshots:r$});function lFe(e){n$(e),a$(e),i$(e)}function n$(e){var t=e.state.data.events;t.object.created.subscribe(function(r){var n;!be.isRepresentation3D(r.obj)||(rI(r.state.cells.get(r.ref),r.obj.data.repr),r.obj.data.repr.setState({syncManually:!0}),(n=e.canvas3d)===null||n===void 0||n.add(r.obj.data.repr))}),t.object.updated.subscribe(function(r){var n,a;r.oldObj&&be.isRepresentation3D(r.oldObj)&&((n=e.canvas3d)===null||n===void 0||n.remove(r.oldObj.data.repr),r.oldObj.data.repr.destroy()),be.isRepresentation3D(r.obj)&&(rI(r.state.cells.get(r.ref),r.obj.data.repr),r.action==="recreate"&&r.obj.data.repr.setState({syncManually:!0}),(a=e.canvas3d)===null||a===void 0||a.add(r.obj.data.repr))}),t.object.removed.subscribe(function(r){var n;!be.isRepresentation3D(r.obj)||((n=e.canvas3d)===null||n===void 0||n.remove(r.obj.data.repr),r.obj.data.repr.destroy())})}function a$(e){var t=e.state.data.events;t.object.created.subscribe(function(r){var n;if(!!be.Molecule.Structure.Representation3DState.is(r.obj)){var a=r.obj.data;a.repr.setState(a.state),(n=e.canvas3d)===null||n===void 0||n.update(a.repr)}}),t.object.updated.subscribe(function(r){var n;if(!!be.Molecule.Structure.Representation3DState.is(r.obj)){var a=r.obj.data;a.repr.setState(a.state),(n=e.canvas3d)===null||n===void 0||n.update(a.repr)}}),t.object.removed.subscribe(function(r){var n;if(!!be.Molecule.Structure.Representation3DState.is(r.obj)){var a=r.obj.data;a.repr.setState(a.initialState),(n=e.canvas3d)===null||n===void 0||n.update(a.repr)}})}function i$(e){e.state.data.events.cell.stateUpdated.subscribe(function(t){var r,n=t.state.cells.get(t.ref);!be.isRepresentation3D(n.obj)||rI(n,n.obj.data.repr)&&((r=e.canvas3d)===null||r===void 0||r.syncVisibility())})}function rI(e,t){return t.state.visible===e.state.isHidden?(t.setState({visible:!e.state.isHidden}),!0):!1}var cFe=Object.freeze({__proto__:null,registerDefault:lFe,SyncRepresentationToCanvas:n$,SyncStructureRepresentation3DState:a$,UpdateRepresentationVisibility:i$});function dFe(e){o$(e),u$(e),s$(e)}function o$(e){Rt.Camera.Reset.subscribe(e,function(t){e.managers.camera.reset(t?.snapshot,t?.durationMs)})}function s$(e){Rt.Camera.SetSnapshot.subscribe(e,function(t){var r=t.snapshot,n=t.durationMs;e.managers.camera.setSnapshot(r,n)})}function u$(e){Rt.Camera.Focus.subscribe(e,function(t){var r=t.center,n=t.radius,a=t.durationMs;e.managers.camera.focusSphere({center:r,radius:n},{durationMs:a}),e.events.canvas3d.settingsUpdated.next()})}var fFe=Object.freeze({__proto__:null,registerDefault:dFe,Reset:o$,SetSnapshot:s$,Focus:u$});function Dh(e){if(typeof e=="object"){if("buttons"in e)return e.buttons;if("which"in e){var t=e.which;if(t===2)return 4;if(t===3)return 2;if(t>0)return 1<<t-1}}return 0}function Ov(e){if(typeof e=="object"&&"button"in e){var t=e.button;if(t===1)return 4;if(t===2)return 2;if(t>=0)return 1<<t}return 0}function ix(e){return{alt:"altKey"in e?e.altKey:!1,shift:"shiftKey"in e?e.shiftKey:!1,control:"ctrlKey"in e?e.ctrlKey:!1,meta:"metaKey"in e?e.metaKey:!1}}var K9={noScroll:!0,noMiddleClickScroll:!0,noContextMenu:!0,noPinchZoom:!0,noTextSelect:!0,mask:function(e,t){return!0},pixelScale:1},$u;(function(e){e.None=n();function t(a,i){return a.shift===i.shift&&a.alt===i.alt&&a.control===i.control&&a.meta===i.meta}e.areEqual=t;function r(a){if(!a)return 0;var i=0;return a.shift&&i++,a.alt&&i++,a.control&&i++,a.meta&&i++,i}e.size=r;function n(a){return a===void 0&&(a={}),{shift:!!a.shift,alt:!!a.alt,control:!!a.control,meta:!!a.meta}}e.create=n})($u||($u={}));var hm;(function(e){e.has=Oi.has,e.create=Oi.create})(hm||(hm={}));function $9(){return{drag:new ha,interactionEnd:new ha,click:new ha,move:new ha,wheel:new ha,pinch:new ha,resize:new ha,leave:new ha,enter:new ha,modifiers:new ha,key:new ha}}var pFe=["Backspace","Delete"],nI;(function(e){function t(n){n===void 0&&(n={});var a=T(T({},K9),n),i=a.noScroll,o=a.noContextMenu;return T(T({noScroll:i,noContextMenu:o,width:0,height:0,pixelRatio:1},$9()),{dispose:Df})}e.create=t;function r(n,a){a===void 0&&(a={});var i=T(T({},K9),a),o=i.noScroll,s=i.noMiddleClickScroll,u=i.noContextMenu,l=i.noPinchZoom,c=i.noTextSelect,d=i.mask,f=i.pixelScale,p=n.clientWidth*C(),h=n.clientHeight*C(),m=0,v=Xe(),g=Xe(),y=Xe(),b=Xe(),S=Xe(),x={shift:!1,alt:!1,control:!1,meta:!1};function C(){return window.devicePixelRatio*f}function w(){return T({},x)}var _=0,E=!1,P=hm.create(0),D=0,k=!1,F=$9(),X=F.drag,U=F.interactionEnd,j=F.wheel,te=F.pinch,q=F.click,W=F.move,V=F.leave,ee=F.enter,ue=F.resize,$=F.modifiers,Q=F.key;return R(),T(T({get noScroll(){return o},set noScroll(Re){o=Re},get noContextMenu(){return u},set noContextMenu(Re){u=Re},get width(){return p},get height(){return h},get pixelRatio(){return C()}},F),{dispose:Y});function R(){n.addEventListener("contextmenu",re,!1),n.addEventListener("wheel",Je,!1),n.addEventListener("mousedown",O,!1),window.addEventListener("mousemove",G,!1),window.addEventListener("mouseup",ve,!1),n.addEventListener("mouseenter",st,!1),n.addEventListener("mouseleave",ze,!1),n.addEventListener("touchstart",Se,!1),n.addEventListener("touchmove",le,!1),n.addEventListener("touchend",ie,!1),window.addEventListener("blur",L),window.addEventListener("keyup",Z,!1),window.addEventListener("keydown",H,!1),window.addEventListener("keypress",fe,!1),window.addEventListener("resize",et,!1)}function Y(){E||(E=!0,n.removeEventListener("contextmenu",re,!1),n.removeEventListener("wheel",Je,!1),n.removeEventListener("mousedown",O,!1),window.removeEventListener("mousemove",G,!1),window.removeEventListener("mouseup",ve,!1),n.removeEventListener("mouseenter",st,!1),n.removeEventListener("mouseleave",ze,!1),n.removeEventListener("touchstart",Se,!1),n.removeEventListener("touchmove",le,!1),n.removeEventListener("touchend",ie,!1),window.removeEventListener("blur",L),window.removeEventListener("keyup",Z,!1),window.removeEventListener("keydown",H,!1),window.removeEventListener("keypress",fe,!1),window.removeEventListener("resize",et,!1))}function re(Re){!d(Re.clientX,Re.clientY)||u&&Re.preventDefault()}function K(Re){x.alt=Re.altKey,x.shift=Re.shiftKey,x.control=Re.ctrlKey,x.meta=Re.metaKey}function L(){(P||x.shift||x.alt||x.meta||x.control)&&(P=0,x.shift=x.alt=x.control=x.meta=!1)}function H(Re){var it=!1;!x.alt&&Re.altKey&&(it=!0,x.alt=!0),!x.shift&&Re.shiftKey&&(it=!0,x.shift=!0),!x.control&&Re.ctrlKey&&(it=!0,x.control=!0),!x.meta&&Re.metaKey&&(it=!0,x.meta=!0),it&&k&&$.next(w())}function Z(Re){var it=!1;x.alt&&!Re.altKey&&(it=!0,x.alt=!1),x.shift&&!Re.shiftKey&&(it=!0,x.shift=!1),x.control&&!Re.ctrlKey&&(it=!0,x.control=!1),x.meta&&!Re.metaKey&&(it=!0,x.meta=!1),it&&k&&$.next(w()),pFe.includes(Re.key)&&fe(Re)}function fe(Re){Q.next({key:Re.key,modifiers:w()})}function me(Re){var it=Re.touches[0],Fe=Re.touches[1];return{clientX:(it.clientX+Fe.clientX)/2,clientY:(it.clientY+Fe.clientY)/2,pageX:(it.pageX+Fe.pageX)/2,pageY:(it.pageY+Fe.pageY)/2}}function xe(Re){var it=Re.touches[0].pageX-Re.touches[1].pageX,Fe=Re.touches[0].pageY-Re.touches[1].pageY;return Math.sqrt(it*it+Fe*Fe)}function Se(Re){if(Re.touches.length===1)P=D=1,Te(Re.touches[0]);else if(Re.touches.length===2){P=0,D=2,Te(me(Re));var it=xe(Re);m=it,te.next({distance:it,fraction:1,delta:0,isStart:!0,buttons:P,button:D,modifiers:w()})}else Re.touches.length===3&&(P=D=8,Te(me(Re)))}function ie(Re){we()}function le(Re){if(D=0,l&&(Re.preventDefault(),Re.stopPropagation(),Re.originalEvent&&(Re.originalEvent.preventDefault(),Re.originalEvent.stopPropagation())),Re.touches.length===1)P=1,Ge(Re.touches[0]);else if(Re.touches.length===2){var it=xe(Re),Fe=m-it;Math.abs(Fe)<4?(P=2,Ge(me(Re))):(P=4,K(Re),te.next({delta:Fe,fraction:m/it,distance:it,isStart:!1,buttons:P,button:D,modifiers:w()})),m=it}else Re.touches.length===3&&(P=8,Ge(me(Re)))}function O(Re){K(Re),P=Dh(Re),D=Ov(Re),s&&P===4&&Re.preventDefault,Te(Re)}function G(Re){K(Re),P=Dh(Re),D=0,Ge(Re)}function ve(Re){K(Re),P=Dh(Re),D=Ov(Re),Ue(Re),we()}function we(){U.next()}function Te(Re){!d(Re.clientX,Re.clientY)||(ht(g,Re),Xe.copy(v,g),ut(g)&&(_=1))}function Ue(Re){if(_=0,!!d(Re.clientX,Re.clientY)&&(ht(y,Re),Xe.distance(y,v)<4)){var it=Re.pageX,Fe=Re.pageY,tt=y[0],wt=y[1];q.next({x:tt,y:wt,pageX:it,pageY:Fe,buttons:P,button:D,modifiers:w()})}}function Ge(Re){var it;ht(y,Re);var Fe=Re.pageX,tt=Re.pageY,wt=y[0],dt=y[1],Et=ut(y);if(W.next({x:wt,y:dt,pageX:Fe,pageY:tt,buttons:P,button:D,modifiers:w(),inside:Et}),_!==0&&(c&&((it=Re.preventDefault)===null||it===void 0||it.call(Re)),Xe.div(b,Xe.sub(b,y,g),pt(S)),!(Xe.magnitude(b)<jn))){var oe=_===1;if(!(oe&&!d(Re.clientX,Re.clientY))){var ge=b[0],Ee=b[1];X.next({x:wt,y:dt,dx:ge,dy:Ee,pageX:Fe,pageY:tt,buttons:P,button:D,modifiers:w(),isStart:oe}),Xe.copy(g,y),_=2}}}function Je(Re){if(!!d(Re.clientX,Re.clientY)){ht(y,Re);var it=Re.pageX,Fe=Re.pageY,tt=y[0],wt=y[1];o&&Re.preventDefault();var dt=1;switch(Re.deltaMode){case 0:dt=1;break;case 1:dt=40;break;case 2:dt=800;break}var Et=(Re.deltaX||0)*dt,oe=(Re.deltaY||0)*dt,ge=(Re.deltaZ||0)*dt;P=D=4,(Et||oe||ge)&&j.next({x:tt,y:wt,pageX:it,pageY:Fe,dx:Et,dy:oe,dz:ge,buttons:P,button:D,modifiers:w()})}}function st(Re){k=!0,ee.next()}function ze(Re){k=!1,V.next()}function et(Re){ue.next()}function ut(Re){if(n instanceof Window||n instanceof Document||n===document.body)return!0;var it=n.getBoundingClientRect();return Re[0]>=0&&Re[1]>=0&&Re[0]<it.width&&Re[1]<it.height}function pt(Re){return Re[0]=n.clientWidth,Re[1]=n.clientHeight,Re}function ht(Re,it){p=n.clientWidth*C(),h=n.clientHeight*C();var Fe=it.clientX||0,tt=it.clientY||0,wt=n.getBoundingClientRect();return Re[0]=Fe-wt.left,Re[1]=tt-wt.top,Re}}e.fromElement=r})(nI||(nI={}));function ai(){return ai.zero()}(function(e){function t(){return{x:0,y:0,width:0,height:0}}e.zero=t;function r(u,l,c,d){return{x:u,y:l,width:c,height:d}}e.create=r;function n(u){return T({},u)}e.clone=n;function a(u,l){return Object.assign(u,l)}e.copy=a;function i(u,l,c,d,f){return u.x=l,u.y=c,u.width=d,u.height=f,u}e.set=i;function o(u,l){return u[0]=l.x,u[1]=l.y,u[2]=l.width,u[3]=l.height,u}e.toVec4=o;function s(u,l){return u.x===l.x&&u.y===l.y&&u.width===l.width&&u.height===l.height}e.equals=s})(ai||(ai={}));var Q9=0,Z9=1,wl=Mr();function hFe(e,t,r,n){var a=r.x,i=r.y,o=r.width,s=r.height;Mr.set(wl,t[0],t[1],t[2],1),Mr.transformMat4(wl,wl,n);var u=wl[3];return u!==0&&(wl[0]/=u,wl[1]/=u,wl[2]/=u),e[0]=a+o/2*wl[0]+(0+o/2),e[1]=i+s/2*wl[1]+(0+s/2),e[2]=(Z9-Q9)/2*wl[2]+(Z9+Q9)/2,e[3]=u===0?0:1/u,e}function vS(e,t,r,n){var a=r.x,i=r.y,o=r.width,s=r.height,u=t[0]-a,l=s-t[1]-1-i,c=t[2];return e[0]=2*u/o-1,e[1]=2*l/s-1,e[2]=2*c-1,A.transformMat4(e,e,n)}var aI={backgroundColor:M.Color(vt(0),{description:"Background color of the 3D canvas"}),pickingAlphaThreshold:M.Numeric(.5,{min:0,max:1,step:.01},{description:"The minimum opacity value needed for an object to be pickable."}),interiorDarkening:M.Numeric(.5,{min:0,max:1,step:.01}),interiorColorFlag:M.Boolean(!0,{label:"Use Interior Color"}),interiorColor:M.Color(vt.fromNormalizedRgb(.3,.3,.3)),highlightColor:M.Color(vt.fromNormalizedRgb(1,.4,.6)),selectColor:M.Color(vt.fromNormalizedRgb(.2,1,.1)),xrayEdgeFalloff:M.Numeric(1,{min:0,max:3,step:.1}),style:M.MappedStatic("matte",{custom:M.Group({lightIntensity:M.Numeric(.6,{min:0,max:1,step:.01}),ambientIntensity:M.Numeric(.4,{min:0,max:1,step:.01}),metalness:M.Numeric(0,{min:0,max:1,step:.01}),roughness:M.Numeric(1,{min:0,max:1,step:.01}),reflectivity:M.Numeric(.5,{min:0,max:1,step:.01})},{isExpanded:!0}),flat:M.Group({}),matte:M.Group({}),glossy:M.Group({}),metallic:M.Group({}),plastic:M.Group({})},{label:"Lighting",description:"Style in which the 3D scene is rendered/lighted"}),clip:M.Group({variant:M.Select("instance",M.arrayToOptions(["instance","pixel"])),objects:M.ObjectList({type:M.Select("plane",M.objectToOptions(cn.Type,function(e){return vs(e)})),invert:M.Boolean(!1),position:M.Vec3(A()),rotation:M.Group({axis:M.Vec3(A.create(1,0,0)),angle:M.Numeric(0,{min:-180,max:180,step:1},{description:"Angle in Degrees"})},{isExpanded:!0}),scale:M.Vec3(A.create(1,1,1))},function(e){return vs(e.type)})})};function J9(e){switch(e.name){case"custom":return e.params;case"flat":return{lightIntensity:0,ambientIntensity:1,metalness:0,roughness:.4,reflectivity:.5};case"matte":return{lightIntensity:.7,ambientIntensity:.3,metalness:0,roughness:1,reflectivity:.5};case"glossy":return{lightIntensity:.7,ambientIntensity:.3,metalness:0,roughness:.4,reflectivity:.5};case"metallic":return{lightIntensity:.7,ambientIntensity:.7,metalness:.6,roughness:.6,reflectivity:.5};case"plastic":return{lightIntensity:.7,ambientIntensity:.3,metalness:0,roughness:.2,reflectivity:.5}}}var mFe=aa();function eN(e,t){for(var r=t?.objects||{type:new Array(5).fill(1),invert:new Array(5).fill(!1),position:new Array(15).fill(0),rotation:new Array(20).fill(0),scale:new Array(15).fill(1)},n=r.type,a=r.invert,i=r.position,o=r.rotation,s=r.scale,u=0,l=e.objects.length;u<l;++u){var c=e.objects[u];n[u]=cn.Type[c.type],a[u]=c.invert,A.toArray(c.position,i,u*3),aa.toArray(aa.setAxisAngle(mFe,c.rotation.axis,rn(c.rotation.angle)),o,u*4),A.toArray(c.scale,s,u*3)}return{variant:e.variant,objects:{count:e.objects.length,type:n,invert:a,position:i,rotation:o,scale:s}}}var iI;(function(e){function t(r,n){n===void 0&&(n={});var a=r.gl,i=r.state,o=r.stats,s=r.extensions.fragDepth,u=M.merge(aI,M.getDefaultValues(aI),n),l=J9(u.style),c=eN(u.clip),d=ai(),f=Xe.create(a.drawingBufferWidth,a.drawingBufferHeight),p=vt.toVec3Normalized(A(),u.backgroundColor),h=!1,m=$w(a),v=[["tDepth",m]],g=de(),y=de(),b=de(),S=de(),x=de(),C=de(),w=de(),_=A(),E=Xe(),P={uModel:N.create(de.identity()),uView:N.create(g),uInvView:N.create(y),uModelView:N.create(b),uInvModelView:N.create(S),uInvProjection:N.create(x),uProjection:N.create(de()),uModelViewProjection:N.create(C),uInvModelViewProjection:N.create(w),uIsOrtho:N.create(1),uViewOffset:N.create(E),uPixelRatio:N.create(r.pixelRatio),uViewportHeight:N.create(d.height),uViewport:N.create(ai.toVec4(Mr(),d)),uDrawingBufferSize:N.create(f),uCameraPosition:N.create(A()),uCameraDir:N.create(_),uNear:N.create(1),uFar:N.create(1e4),uFogNear:N.create(1),uFogFar:N.create(1e4),uFogColor:N.create(p),uRenderWboit:N.create(!1),uTransparentBackground:N.create(!1),uClipObjectType:N.create(c.objects.type),uClipObjectInvert:N.create(c.objects.invert),uClipObjectPosition:N.create(c.objects.position),uClipObjectRotation:N.create(c.objects.rotation),uClipObjectScale:N.create(c.objects.scale),uLightIntensity:N.create(l.lightIntensity),uAmbientIntensity:N.create(l.ambientIntensity),uMetalness:N.create(l.metalness),uRoughness:N.create(l.roughness),uReflectivity:N.create(l.reflectivity),uPickingAlphaThreshold:N.create(u.pickingAlphaThreshold),uInteriorDarkening:N.create(u.interiorDarkening),uInteriorColorFlag:N.create(u.interiorColorFlag),uInteriorColor:N.create(vt.toVec3Normalized(A(),u.interiorColor)),uHighlightColor:N.create(vt.toVec3Normalized(A(),u.highlightColor)),uSelectColor:N.create(vt.toVec3Normalized(A(),u.selectColor)),uXrayEdgeFalloff:N.create(u.xrayEdgeFalloff)},D=Object.entries(P),k=!0,F=function(R,Y){if(!(R.state.disposed||!R.state.visible||!R.state.pickable&&Y[0]==="p")){var re=!1;R.state.noClip?R.values.dClipObjectCount.ref.value!==0&&(N.update(R.values.dClipObjectCount,0),re=!0):(R.values.dClipObjectCount.ref.value!==c.objects.count&&(N.update(R.values.dClipObjectCount,c.objects.count),re=!0),R.values.dClipVariant.ref.value!==c.variant&&(N.update(R.values.dClipVariant,c.variant),re=!0)),re&&R.update();var K=R.getProgram(Y);i.currentProgramId!==K.id&&(k=!0,K.use()),k&&(K.setUniforms(D),k=!1),R.values.dRenderMode?(i.disable(a.CULL_FACE),i.frontFace(a.CCW),Y==="colorBlended"&&(R.values.dRenderMode.ref.value==="volume"||!s?(i.disable(a.DEPTH_TEST),i.depthMask(!1)):(i.enable(a.DEPTH_TEST),i.depthMask(R.values.uAlpha.ref.value===1)))):(R.values.dDoubleSided?R.values.dDoubleSided.ref.value||R.values.hasReflection.ref.value?i.disable(a.CULL_FACE):i.enable(a.CULL_FACE):i.disable(a.CULL_FACE),R.values.dFlipSided&&R.values.dFlipSided.ref.value?(i.frontFace(a.CW),i.cullFace(a.FRONT)):(i.frontFace(a.CCW),i.cullFace(a.BACK))),R.render(Y,v)}},X=function(R){N.update(P.uView,R.view),N.update(P.uInvView,de.invert(y,R.view)),N.update(P.uProjection,R.projection),N.update(P.uInvProjection,de.invert(x,R.projection)),N.updateIfChanged(P.uIsOrtho,R.state.mode==="orthographic"?1:0),N.update(P.uViewOffset,R.viewOffset.enabled?Xe.set(E,R.viewOffset.offsetX*16,R.viewOffset.offsetY*16):Xe.set(E,0,0)),N.update(P.uCameraPosition,R.state.position),N.update(P.uCameraDir,A.normalize(_,A.sub(_,R.state.target,R.state.position))),N.updateIfChanged(P.uFar,R.far),N.updateIfChanged(P.uNear,R.near),N.updateIfChanged(P.uFogFar,R.fogFar),N.updateIfChanged(P.uFogNear,R.fogNear),N.updateIfChanged(P.uTransparentBackground,h)},U=function(R,Y,re,K){$ye(v,"tDepth",re||m),N.update(P.uModel,R.view),N.update(P.uModelView,de.mul(b,R.view,Y.view)),N.update(P.uInvModelView,de.invert(S,b)),N.update(P.uModelViewProjection,de.mul(C,b,Y.projection)),N.update(P.uInvModelViewProjection,de.invert(w,C)),N.updateIfChanged(P.uRenderWboit,K),i.enable(a.SCISSOR_TEST),i.colorMask(!0,!0,!0,!0);var L=d.x,H=d.y,Z=d.width,fe=d.height;a.viewport(L,H,Z,fe),a.scissor(L,H,Z,fe),k=!0,i.currentRenderItemId=-1},j=function(R,Y,re,K){i.disable(a.BLEND),i.enable(a.DEPTH_TEST),i.depthMask(!0),U(R,Y,K,!1);for(var L=R.renderables,H=0,Z=L.length;H<Z;++H)L[H].state.colorOnly||F(L[H],re)},te=function(R,Y,re){i.disable(a.BLEND),i.enable(a.DEPTH_TEST),i.depthMask(!0),U(R,Y,re,!1);for(var K=R.renderables,L=0,H=K.length;L<H;++L)F(K[L],"depth")},q=function(R,Y,re){W(R,Y,re),V(R,Y,re)},W=function(R,Y,re){i.disable(a.BLEND),i.enable(a.DEPTH_TEST),i.depthMask(!0),U(R,Y,re,!1);for(var K=R.renderables,L=0,H=K.length;L<H;++L){var Z=K[L];Z.state.opaque&&F(Z,"colorBlended")}},V=function(R,Y,re){i.enable(a.DEPTH_TEST),U(R,Y,re,!1);var K=R.renderables;h?i.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA):i.blendFuncSeparate(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA),i.enable(a.BLEND),i.depthMask(!0);for(var L=0,H=K.length;L<H;++L){var Z=K[L];!Z.state.opaque&&Z.state.writeDepth&&F(Z,"colorBlended")}i.depthMask(!1);for(var L=0,H=K.length;L<H;++L){var Z=K[L];!Z.state.opaque&&!Z.state.writeDepth&&F(Z,"colorBlended")}},ee=function(R,Y,re){var K;i.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA),i.enable(a.BLEND),U(R,Y,re,!1);for(var L=R.renderables,H=0,Z=L.length;H<Z;++H){var fe=L[H],me=$i(fe.values.alpha.ref.value*fe.state.alphaFactor,0,1);me===1&&fe.values.transparencyAverage.ref.value!==1&&!(!((K=fe.values.dXrayShaded)===null||K===void 0)&&K.ref.value)&&F(fe,"colorBlended")}},ue=function(R,Y,re){var K;i.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA),i.enable(a.BLEND),U(R,Y,re,!1);for(var L=R.renderables,H=0,Z=L.length;H<Z;++H){var fe=L[H],me=$i(fe.values.alpha.ref.value*fe.state.alphaFactor,0,1);(me<1||fe.values.transparencyAverage.ref.value>0||((K=fe.values.dXrayShaded)===null||K===void 0?void 0:K.ref.value))&&F(fe,"colorBlended")}},$=function(R,Y,re){var K,L,H;i.disable(a.BLEND),i.enable(a.DEPTH_TEST),i.depthMask(!0),U(R,Y,re,!1);for(var Z=R.renderables,fe=0,me=Z.length;fe<me;++fe){var xe=Z[fe],Se=$i(xe.values.alpha.ref.value*xe.state.alphaFactor,0,1);Se===1&&xe.values.transparencyAverage.ref.value!==1&&((K=xe.values.dRenderMode)===null||K===void 0?void 0:K.ref.value)!=="volume"&&!(!((L=xe.values.dPointFilledCircle)===null||L===void 0)&&L.ref.value)&&!(!((H=xe.values.dXrayShaded)===null||H===void 0)&&H.ref.value)&&F(xe,"colorWboit")}},Q=function(R,Y,re){var K,L,H;U(R,Y,re,!0);for(var Z=R.renderables,fe=0,me=Z.length;fe<me;++fe){var xe=Z[fe],Se=$i(xe.values.alpha.ref.value*xe.state.alphaFactor,0,1);(Se<1||xe.values.transparencyAverage.ref.value>0||((K=xe.values.dRenderMode)===null||K===void 0?void 0:K.ref.value)==="volume"||((L=xe.values.dPointFilledCircle)===null||L===void 0?void 0:L.ref.value)||!!xe.values.uBackgroundColor||((H=xe.values.dXrayShaded)===null||H===void 0?void 0:H.ref.value))&&F(xe,"colorWboit")}};return{clear:function(R){i.enable(a.SCISSOR_TEST),i.enable(a.DEPTH_TEST),i.colorMask(!0,!0,!0,!0),i.depthMask(!0),h?i.clearColor(0,0,0,0):R?i.clearColor(p[0],p[1],p[2],1):i.clearColor(1,1,1,1),a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT)},clearDepth:function(){i.enable(a.SCISSOR_TEST),i.enable(a.DEPTH_TEST),i.depthMask(!0),a.clear(a.DEPTH_BUFFER_BIT)},update:X,renderPick:j,renderDepth:te,renderBlended:q,renderBlendedOpaque:W,renderBlendedTransparent:V,renderBlendedVolumeOpaque:ee,renderBlendedVolumeTransparent:ue,renderWboitOpaque:$,renderWboitTransparent:Q,setProps:function(R){R.backgroundColor!==void 0&&R.backgroundColor!==u.backgroundColor&&(u.backgroundColor=R.backgroundColor,vt.toVec3Normalized(p,u.backgroundColor),N.update(P.uFogColor,A.copy(P.uFogColor.ref.value,p))),R.pickingAlphaThreshold!==void 0&&R.pickingAlphaThreshold!==u.pickingAlphaThreshold&&(u.pickingAlphaThreshold=R.pickingAlphaThreshold,N.update(P.uPickingAlphaThreshold,u.pickingAlphaThreshold)),R.interiorDarkening!==void 0&&R.interiorDarkening!==u.interiorDarkening&&(u.interiorDarkening=R.interiorDarkening,N.update(P.uInteriorDarkening,u.interiorDarkening)),R.interiorColorFlag!==void 0&&R.interiorColorFlag!==u.interiorColorFlag&&(u.interiorColorFlag=R.interiorColorFlag,N.update(P.uInteriorColorFlag,u.interiorColorFlag)),R.interiorColor!==void 0&&R.interiorColor!==u.interiorColor&&(u.interiorColor=R.interiorColor,N.update(P.uInteriorColor,vt.toVec3Normalized(P.uInteriorColor.ref.value,u.interiorColor))),R.highlightColor!==void 0&&R.highlightColor!==u.highlightColor&&(u.highlightColor=R.highlightColor,N.update(P.uHighlightColor,vt.toVec3Normalized(P.uHighlightColor.ref.value,u.highlightColor))),R.selectColor!==void 0&&R.selectColor!==u.selectColor&&(u.selectColor=R.selectColor,N.update(P.uSelectColor,vt.toVec3Normalized(P.uSelectColor.ref.value,u.selectColor))),R.xrayEdgeFalloff!==void 0&&R.xrayEdgeFalloff!==u.xrayEdgeFalloff&&(u.xrayEdgeFalloff=R.xrayEdgeFalloff,N.update(P.uXrayEdgeFalloff,u.xrayEdgeFalloff)),R.style!==void 0&&(u.style=R.style,Object.assign(l,J9(R.style)),N.updateIfChanged(P.uLightIntensity,l.lightIntensity),N.updateIfChanged(P.uAmbientIntensity,l.ambientIntensity),N.updateIfChanged(P.uMetalness,l.metalness),N.updateIfChanged(P.uRoughness,l.roughness),N.updateIfChanged(P.uReflectivity,l.reflectivity)),R.clip!==void 0&&!dd(R.clip,u.clip)&&(u.clip=R.clip,Object.assign(c,eN(R.clip,c)),N.update(P.uClipObjectPosition,c.objects.position),N.update(P.uClipObjectRotation,c.objects.rotation),N.update(P.uClipObjectScale,c.objects.scale),N.update(P.uClipObjectType,c.objects.type))},setViewport:function(R,Y,re,K){a.viewport(R,Y,re,K),a.scissor(R,Y,re,K),(R!==d.x||Y!==d.y||re!==d.width||K!==d.height)&&(ai.set(d,R,Y,re,K),N.update(P.uViewportHeight,K),N.update(P.uViewport,Mr.set(P.uViewport.ref.value,R,Y,re,K)))},setTransparentBackground:function(R){h=R},setDrawingBufferSize:function(R,Y){(R!==f[0]||Y!==f[1])&&N.update(P.uDrawingBufferSize,Xe.set(f,R,Y))},props:u,get stats(){return{programCount:r.stats.resourceCounts.program,shaderCount:r.stats.resourceCounts.shader,attributeCount:r.stats.resourceCounts.attribute,elementsCount:r.stats.resourceCounts.elements,framebufferCount:r.stats.resourceCounts.framebuffer,renderbufferCount:r.stats.resourceCounts.renderbuffer,textureCount:r.stats.resourceCounts.texture,vertexArrayCount:r.stats.resourceCounts.vertexArray,drawCount:o.drawCount,instanceCount:o.instanceCount,instancedDrawCount:o.instancedDrawCount}},dispose:function(){}}}e.create=t})(iI||(iI={}));function yr(e,t,r){return t===void 0&&(t=""),r===void 0&&(r=""),yr.create(e,t,r)}(function(e){function t(s,u,l){return u===void 0&&(u=""),l===void 0&&(l=""),{triggers:s,action:u,description:l}}e.create=t,e.Empty={triggers:[],action:"",description:""};function r(s){return s.triggers.length===0||s.triggers.every(function(u){return u.buttons===void 0&&u.modifiers===void 0})}e.isEmpty=r;function n(s,u,l){return s.triggers.some(function(c){return o.match(c,u,l)})}e.match=n;function a(s){return s.triggers.map(o.format).join(" or ")}e.formatTriggers=a;function i(s,u){u===void 0&&(u="");var l=s.description||vs(u);return _ge(l,{triggers:"<i>"+a(s)+"</i>"})}e.format=i;function o(s,u){return o.create(s,u)}e.Trigger=o,function(s){function u(d,f){return{buttons:d,modifiers:f}}s.create=u,s.Empty={};function l(d,f,p){var h=d.buttons,m=d.modifiers;return h!==void 0&&(h===f||hm.has(h,f))&&(!m||$u.areEqual(m,p))}s.match=l;function c(d){var f=[],p=vFe(d.buttons);p&&f.push(p);var h=gFe(d.modifiers);return h&&f.push(h),f.join(" + ")}s.format=c}(o=e.Trigger||(e.Trigger={}))})(yr||(yr={}));var ox=hm;function vFe(e){var t=[];return e===void 0?t.push("any mouse button"):e===0?t.push("mouse hover"):(ox.has(e,1)&&t.push("left mouse button"),ox.has(e,2)&&t.push("right mouse button"),ox.has(e,4)&&t.push("wheel/middle mouse button"),ox.has(e,8)&&t.push("three fingers")),t.join(" + ")}function gFe(e,t){var r=[];return e?(e.alt&&r.push("alt key"),e.control&&r.push("control key"),e.meta&&r.push("meta/command key"),e.shift&&r.push("shift key"),t&&r.length===0&&r.push("no key")):t&&r.push("any key"),r.join(" + ")}var sf=$u,uf=yr.Trigger,yFe={dragRotate:yr([uf(1,sf.create())],"Rotate","Drag using ${triggers}"),dragRotateZ:yr([uf(1,sf.create({shift:!0}))],"Rotate around z-axis","Drag using ${triggers}"),dragPan:yr([uf(2,sf.create()),uf(1,sf.create({control:!0}))],"Pan","Drag using ${triggers}"),dragZoom:yr.Empty,dragFocus:yr([uf(8,sf.create())],"Focus","Drag using ${triggers}"),dragFocusZoom:yr([uf(4,sf.create())],"Focus and zoom","Drag using ${triggers}"),scrollZoom:yr([uf(4,sf.create())],"Zoom","Scroll using ${triggers}"),scrollFocus:yr([uf(4,sf.create({shift:!0}))],"Clip","Scroll using ${triggers}"),scrollFocusZoom:yr.Empty},l$={noScroll:M.Boolean(!0,{isHidden:!0}),rotateSpeed:M.Numeric(5,{min:1,max:10,step:1}),zoomSpeed:M.Numeric(7,{min:1,max:15,step:1}),panSpeed:M.Numeric(1,{min:.1,max:5,step:.1}),spin:M.Boolean(!1,{description:"Spin the 3D scene around the x-axis in view space"}),spinSpeed:M.Numeric(1,{min:-20,max:20,step:1}),staticMoving:M.Boolean(!0,{isHidden:!0}),dynamicDampingFactor:M.Numeric(.2,{},{isHidden:!0}),minDistance:M.Numeric(.01,{},{isHidden:!0}),maxDistance:M.Numeric(1e150,{},{isHidden:!0}),bindings:M.Value(yFe,{isHidden:!0}),autoAdjustMinMaxDistance:M.MappedStatic("on",{off:M.EmptyGroup(),on:M.Group({minDistanceFactor:M.Numeric(0),minDistancePadding:M.Numeric(5),maxDistanceFactor:M.Numeric(10),maxDistanceMin:M.Numeric(20)})},{isHidden:!0})},oI;(function(e){function t(r,n,a){a===void 0&&(a={});var i=T(T({},M.getDefaultValues(l$)),a),o=ai.clone(n.viewport),s=!1,u=r.drag.subscribe(G),l=r.interactionEnd.subscribe(ve),c=r.wheel.subscribe(we),d=r.pinch.subscribe(Te),f=!1,p=A(),h=A(),m=Xe(),v=Xe(),g=A(),y=0,b=Xe(),S=Xe(),x=0,C=Xe(),w=Xe(),_=Xe(),E=Xe(),P=Xe(),D=Xe(),k=A.clone(n.target),F=A.clone(n.position),X=A.clone(n.up),U=Xe();function j(ze,et){return Xe.set(U,(ze-o.x)/o.width,(et-o.y)/o.height)}var te=Xe();function q(ze,et){return Xe.set(te,(ze-o.width*.5-o.x)/(o.width*.5),(o.height+2*(o.y-et))/o.width)}var W=A(),V=aa(),ee=A(),ue=A(),$=A(),Q=A();function R(){var ze=v[0]-m[0],et=v[1]-m[1];A.set(Q,ze,et,0);var ut=r.width/r.height,pt=A.magnitude(Q)*i.rotateSpeed*r.pixelRatio*ut;pt?(A.sub(h,n.position,n.target),A.normalize(ee,h),A.normalize(ue,n.up),A.normalize($,A.cross($,ue,ee)),A.setMagnitude(ue,ue,et),A.setMagnitude($,$,ze),A.add(Q,ue,$),A.normalize(W,A.cross(W,Q,h)),aa.setAxisAngle(V,W,pt),A.transformQuat(h,h,V),A.transformQuat(n.up,n.up,V),A.copy(g,W),y=pt):!i.staticMoving&&y&&(y*=Math.sqrt(1-i.dynamicDampingFactor),A.sub(h,n.position,n.target),aa.setAxisAngle(V,g,y),A.transformQuat(h,h,V),A.transformQuat(n.up,n.up,V)),Xe.copy(m,v)}var Y=aa();function re(){var ze=S[0]-b[0],et=S[1]-b[1],ut=i.rotateSpeed*(-ze+et)*-.05;ut?(A.sub(h,n.position,n.target),aa.setAxisAngle(Y,h,ut),A.transformQuat(n.up,n.up,Y),x=ut):!i.staticMoving&&x&&(x*=Math.sqrt(1-i.dynamicDampingFactor),A.sub(h,n.position,n.target),aa.setAxisAngle(Y,h,x),A.transformQuat(n.up,n.up,Y)),Xe.copy(b,S)}function K(){var ze=1+(w[1]-C[1])*i.zoomSpeed;ze!==1&&ze>0&&A.scale(h,h,ze),i.staticMoving?Xe.copy(C,w):C[1]+=(w[1]-C[1])*i.dynamicDampingFactor}function L(){var ze=(E[1]-_[1])*i.zoomSpeed;if(ze!==0){var et=Math.max(1,n.state.radius+n.state.radius*ze);n.setState({radius:et})}i.staticMoving?Xe.copy(_,E):_[1]+=(E[1]-_[1])*i.dynamicDampingFactor}var H=Xe(),Z=A(),fe=A();function me(){if(Xe.sub(H,Xe.copy(H,D),P),Xe.squaredMagnitude(H)){var ze=r.pixelRatio*i.panSpeed;H[0]*=1/n.zoom*n.viewport.width*ze,H[1]*=1/n.zoom*n.viewport.height*ze,A.cross(fe,A.copy(fe,h),n.up),A.setMagnitude(fe,fe,H[0]),A.setMagnitude(Z,n.up,H[1]),A.add(fe,fe,Z),A.add(n.position,n.position,fe),A.add(n.target,n.target,fe),i.staticMoving?Xe.copy(P,D):(Xe.sub(H,D,P),Xe.scale(H,H,i.dynamicDampingFactor),Xe.add(P,P,H))}}function xe(){var ze=Math.min(Math.max(n.state.radiusMax*1e3,.01),i.maxDistance);A.squaredMagnitude(h)>ze*ze&&(A.setMagnitude(h,h,ze),A.add(n.position,n.target,h),Xe.copy(C,w),Xe.copy(_,E)),A.squaredMagnitude(h)<i.minDistance*i.minDistance&&(A.setMagnitude(h,h,i.minDistance),A.add(n.position,n.target,h),Xe.copy(C,w),Xe.copy(_,E))}function Se(ze,et){return ze*=r.pixelRatio,et*=r.pixelRatio,ze>o.x+o.width||r.height-et>o.y+o.height||ze<o.x||r.height-et<o.y}var ie=-1;function le(ze){ie!==ze&&(i.spin&&ie>0&&Je(ze-ie),A.sub(h,n.position,n.target),R(),re(),K(),L(),me(),A.add(n.position,n.target,h),xe(),A.squaredDistance(p,n.position)>jn&&A.copy(p,n.position),ie=ze)}function O(){A.copy(n.target,k),A.copy(n.position,F),A.copy(n.up,X),A.sub(h,n.position,n.target),A.copy(p,n.position)}function G(ze){var et=ze.x,ut=ze.y,pt=ze.pageX,ht=ze.pageY,Re=ze.buttons,it=ze.modifiers,Fe=ze.isStart,tt=Se(et,ut);if(!(Fe&&tt)&&!(!Fe&&!f)){f=!0;var wt=yr.match(i.bindings.dragRotate,Re,it),dt=yr.match(i.bindings.dragRotateZ,Re,it),Et=yr.match(i.bindings.dragPan,Re,it),oe=yr.match(i.bindings.dragZoom,Re,it),ge=yr.match(i.bindings.dragFocus,Re,it),Ee=yr.match(i.bindings.dragFocusZoom,Re,it);if(q(pt,ht),j(pt,ht),Fe&&(wt&&(Xe.copy(v,te),Xe.copy(m,v)),dt&&(Xe.copy(S,te),Xe.copy(b,S)),(oe||Ee)&&(Xe.copy(C,U),Xe.copy(w,C)),ge&&(Xe.copy(_,U),Xe.copy(E,_)),Et&&(Xe.copy(P,U),Xe.copy(D,P))),wt&&Xe.copy(v,te),dt&&Xe.copy(S,te),(oe||Ee)&&Xe.copy(w,U),ge&&Xe.copy(E,U),Ee){var Ze=A.distance(n.state.position,n.state.target);n.setState({radius:Ze/5})}Et&&Xe.copy(D,U)}}function ve(){f=!1}function we(ze){var et=ze.x,ut=ze.y,pt=ze.dx,ht=ze.dy,Re=ze.dz,it=ze.buttons,Fe=ze.modifiers;if(!Se(et,ut)){var tt=pge(pt,ht,Re);yr.match(i.bindings.scrollZoom,it,Fe)&&(w[1]+=tt*1e-4),yr.match(i.bindings.scrollFocus,it,Fe)&&(E[1]+=tt*1e-4)}}function Te(ze){var et=ze.fraction,ut=ze.buttons,pt=ze.modifiers;yr.match(i.bindings.scrollZoom,ut,pt)&&(f=!0,w[1]+=(et-1)*.1)}function Ue(){s||(s=!0,u.unsubscribe(),c.unsubscribe(),d.unsubscribe(),l.unsubscribe())}var Ge=Xe.create(.005,0);function Je(ze){if(i.spinSpeed!==0){var et=(i.spinSpeed||0)/1e3;Ge[0]=60*Math.min(Math.abs(ze),1e3/8)/1e3*et,f||Xe.add(v,m,Ge)}}function st(ze){ie=-1,le(ze)}return{viewport:o,get props(){return i},setProps:function(ze){Object.assign(i,ze)},start:st,update:le,reset:O,dispose:Ue}}e.create=t})(oI||(oI={}));var r3;(function(e){function t(){return{view:de.identity(),position:A.create(0,0,0),direction:A.create(0,0,-1),up:A.create(0,1,0)}}e.create=t;var r=A.zero();function n(a){A.add(r,a.position,a.direction),de.lookAt(a.view,a.position,r,a.up)}e.update=n})(r3||(r3={}));var bFe=function(){function e(){this.removeList=KP(),this.removeMap=new Map,this.addList=KP(),this.addMap=new Map}return Object.defineProperty(e.prototype,"isEmpty",{get:function(){return this.removeList.count===0&&this.addList.count===0},enumerable:!1,configurable:!0}),e.prototype.add=function(t){if(this.removeMap.has(t)){var r=this.removeMap.get(t);this.removeMap.delete(t),this.removeList.remove(r)}if(!this.addMap.has(t)){var n=this.addList.addLast(t);this.addMap.set(t,n)}},e.prototype.remove=function(t){if(this.addMap.has(t)){var r=this.addMap.get(t);this.addMap.delete(t),this.addList.remove(r)}if(!this.removeMap.has(t)){var n=this.removeList.addLast(t);this.removeMap.set(t,n)}},e.prototype.tryGetRemove=function(){var t=this.removeList.removeFirst();return t&&this.removeMap.delete(t),t},e.prototype.tryGetAdd=function(){var t=this.addList.removeFirst();return t&&this.addMap.delete(t),t},e}(),Ig=new Ms("98");function tN(e,t,r){Ig.reset();for(var n=0,a=e.length;n<a;++n)if(!(r&&!e[n].state.visible)){var i=e[n].values.boundingSphere.ref.value;!i.radius||Ig.includeSphere(i)}Ig.finishedIncludeStep();for(var n=0,a=e.length;n<a;++n)if(!(r&&!e[n].state.visible)){var o=e[n].values.boundingSphere.ref.value;!o.radius||Ig.radiusSphere(o)}return Ig.getSphere(t)}function xFe(e,t){var r=e.getProgram("colorBlended").id,n=t.getProgram("colorBlended").id,a=e.materialId,i=t.materialId;return r!==n?r-n:a!==i?a-i:e.id-t.id}var w0;(function(e){function t(r){var n=new Map,a=[],i=He(),o=He(),s=[],u=[],l=!0,c=!0,d=r3.create(),f=d.view,p=d.position,h=d.direction,m=d.up;function v(_){if(n.has(_))return console.warn("RenderObject with id '"+_.id+"' already present"),n.get(_);var E=sTe(r,_);return a.push(E),_.type==="direct-volume"?u.push(E):s.push(E),n.set(_,E),l=!0,c=!0,E}function g(_){var E=n.get(_);E&&(E.dispose(),Uh(a,E),Uh(s,E),Uh(u,E),n.delete(_),l=!0,c=!0)}var y=100;function b(_){for(var E=Gn(),P=0;;){var D=S.tryGetRemove();if(!D)break;if(g(D),++P%y===0&&Gn()-E>_)return!1}for(;;){var D=S.tryGetAdd();if(!D)break;if(v(D),++P%y===0&&Gn()-E>_)return!1}return a.sort(xFe),!0}var S=new bFe,x=-1;function C(){for(var _=23,E=0,P=a.length;E<P;++E)!a[E].state.visible||(_=31*_+a[E].id|0);return _=gq(_),_===-1&&(_=0),_}function w(){var _=C();return _!==x?(c=!0,!0):!1}return{view:f,position:p,direction:h,up:m,renderables:a,primitives:{view:f,position:p,direction:h,up:m,renderables:s},volumes:{view:f,position:p,direction:h,up:m,renderables:u},syncVisibility:w,update:function(_,E){var P;if(r3.update(d),_)for(var D=0,k=_.length;D<k;++D)(P=n.get(_[D]))===null||P===void 0||P.update();else for(var D=0,k=a.length;D<k;++D)a[D].update();E?w():(l=!0,c=!0)},add:function(_){return S.add(_)},remove:function(_){return S.remove(_)},commit:function(_){return _===void 0&&(_=Number.MAX_VALUE),b(_)},get needsCommit(){return!S.isEmpty},has:function(_){return n.has(_)},clear:function(){for(var _=0,E=a.length;_<E;++_)a[_].dispose();a.length=0,n.clear(),l=!0,c=!0},forEach:function(_){n.forEach(_)},get count(){return a.length},get boundingSphere(){return l&&(tN(a,i,!1),l=!1),i},get boundingSphereVisible(){return c&&(tN(a,o,!0),c=!1,x=C()),o}}}e.create=t})(w0||(w0={}));var sI=function(){function e(t){this.camera=t,this.t=0,this.func=e.defaultTransition,this.start=0,this.inTransition=!1,this.durationMs=0,this._source=Sa.createDefaultSnapshot(),this._target=Sa.createDefaultSnapshot(),this._current=Sa.createDefaultSnapshot()}return Object.defineProperty(e.prototype,"source",{get:function(){return this._source},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){return this._target},enumerable:!1,configurable:!0}),e.prototype.apply=function(t,r,n){if(r===void 0&&(r=0),(!this.inTransition||r>0)&&Sa.copySnapshot(this._source,this.camera.state),this.inTransition||Sa.copySnapshot(this._target,this.camera.state),Sa.copySnapshot(this._target,t),this._target.radius>this._target.radiusMax&&(this._target.radius=this._target.radiusMax),this._target.radius<.01&&(this._target.radius=.01),this._target.radiusMax<.01&&(this._target.radiusMax=.01),!this.inTransition&&r<=0||typeof t.mode<"u"&&t.mode!==this.camera.state.mode){this.finish(this._target);return}this.inTransition=!0,this.func=n||e.defaultTransition,(!this.inTransition||r>0)&&(this.start=this.t,this.durationMs=r)},e.prototype.tick=function(t){this.t=t,this.update()},e.prototype.finish=function(t){Sa.copySnapshot(this.camera.state,t),this.inTransition=!1},e.prototype.update=function(){if(!!this.inTransition){var t=Math.min((this.t-this.start)/this.durationMs,1);if(t===1){this.finish(this._target);return}this.func(this._current,t,this._source,this._target),Sa.copySnapshot(this.camera.state,this._current)}},e}();(function(e){var t=aa.identity();function r(n,a,i,o){Sa.copySnapshot(n,o),aa.slerp(t,aa.Identity,aa.rotationTo(t,i.up,o.up),a),A.transformQuat(n.up,i.up,t),A.lerp(n.target,i.target,o.target,a),A.lerp(n.position,i.position,o.position,a),n.radius=fs(i.radius,o.radius,a),n.radiusMax=fs(i.radiusMax,o.radiusMax,a),n.fov=fs(i.fov,o.fov,a),n.fog=fs(i.fog,o.fog,a)}e.defaultTransition=r})(sI||(sI={}));var Sa=function(){function e(t,r,n){r===void 0&&(r=ai.create(0,0,128,128)),n===void 0&&(n={}),this.view=de.identity(),this.projection=de.identity(),this.projectionView=de.identity(),this.inverseProjectionView=de.identity(),this.state=e.createDefaultSnapshot(),this.viewOffset=e.ViewOffset(),this.near=1,this.far=1e4,this.fogNear=5e3,this.fogFar=1e4,this.zoom=1,this.transition=new sI(this),this.stateChanged=new Wf(this.state),this.prevProjection=de.identity(),this.prevView=de.identity(),this.deltaDirection=A(),this.newPosition=A(),this.viewport=r,this.pixelScale=n.pixelScale||1,e.copySnapshot(this.state,t)}return Object.defineProperty(e.prototype,"pixelRatio",{get:function(){var t=typeof window<"u"?window.devicePixelRatio:1;return t*this.pixelScale},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"position",{get:function(){return this.state.position},set:function(t){A.copy(this.state.position,t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"up",{get:function(){return this.state.up},set:function(t){A.copy(this.state.up,t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){return this.state.target},set:function(t){A.copy(this.state.target,t)},enumerable:!1,configurable:!0}),e.prototype.update=function(){var t=this.state;if(t.radiusMax===0)return!1;var r=2*Math.tan(t.fov/2)*A.distance(t.position,t.target);switch(this.zoom=this.viewport.height/r,wFe(this),this.state.mode){case"orthographic":SFe(this);break;case"perspective":CFe(this);break;default:throw new Error("unknown camera mode")}var n=!de.areEqual(this.projection,this.prevProjection,jn)||!de.areEqual(this.view,this.prevView,jn);if(n){if(de.mul(this.projectionView,this.projection,this.view),!de.tryInvert(this.inverseProjectionView,this.projectionView))return de.copy(this.view,this.prevView),de.copy(this.projection,this.prevProjection),de.mul(this.projectionView,this.projection,this.view),!1;de.copy(this.prevView,this.view),de.copy(this.prevProjection,this.projection)}return n},e.prototype.setState=function(t,r){this.transition.apply(t,r),this.stateChanged.next(t)},e.prototype.getSnapshot=function(){return e.copySnapshot(e.createDefaultSnapshot(),this.state)},e.prototype.getTargetDistance=function(t){return e.targetDistance(t,this.state.fov,this.viewport.width,this.viewport.height)},e.prototype.getFocus=function(t,r,n,a){var i=Math.max(r,.01),o=this.getTargetDistance(i);A.sub(this.deltaDirection,this.target,this.position),a&&A.matchDirection(this.deltaDirection,a,this.deltaDirection),A.setMagnitude(this.deltaDirection,this.deltaDirection,o),A.sub(this.newPosition,t,this.deltaDirection);var s=e.copySnapshot(e.createDefaultSnapshot(),this.state);return s.target=A.clone(t),s.radius=i,s.position=A.clone(this.newPosition),n&&A.matchDirection(s.up,n,s.up),s},e.prototype.getInvariantFocus=function(t,r,n,a){var i=Math.max(r,.01),o=this.getTargetDistance(i);A.copy(this.deltaDirection,a),A.setMagnitude(this.deltaDirection,this.deltaDirection,o),A.sub(this.newPosition,t,this.deltaDirection);var s=e.copySnapshot(e.createDefaultSnapshot(),this.state);return s.target=A.clone(t),s.radius=i,s.position=A.clone(this.newPosition),A.copy(s.up,n),s},e.prototype.focus=function(t,r,n,a,i){r>0&&this.setState(this.getFocus(t,r,a,i),n)},e.prototype.project=function(t,r){return hFe(t,r,this.viewport,this.projectionView)},e.prototype.unproject=function(t,r){return vS(t,r,this.viewport,this.inverseProjectionView)},e}();(function(e){function t(){return{enabled:!1,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}}e.ViewOffset=t;function r(u,l,c,d,f,p,h){u.fullWidth=l,u.fullHeight=c,u.offsetX=d,u.offsetY=f,u.width=p,u.height=h}e.setViewOffset=r;function n(u,l){u.enabled=l.enabled,u.fullWidth=l.fullWidth,u.fullHeight=l.fullHeight,u.offsetX=l.offsetX,u.offsetY=l.offsetY,u.width=l.width,u.height=l.height}e.copyViewOffset=n;function a(u,l,c,d){var f=Math.max(u,.01),p=c/d,h=d<c?1:p;return Math.abs(f/h/Math.sin(l/2))}e.targetDistance=a;function i(){return{mode:"perspective",fov:Math.PI/4,position:A.create(0,0,100),up:A.create(0,1,0),target:A.create(0,0,0),radius:0,radiusMax:10,fog:50,clipFar:!0}}e.createDefaultSnapshot=i;function o(u,l){return l&&(typeof l.mode<"u"&&(u.mode=l.mode),typeof l.fov<"u"&&(u.fov=l.fov),typeof l.position<"u"&&A.copy(u.position,l.position),typeof l.up<"u"&&A.copy(u.up,l.up),typeof l.target<"u"&&A.copy(u.target,l.target),typeof l.radius<"u"&&(u.radius=l.radius),typeof l.radiusMax<"u"&&(u.radiusMax=l.radiusMax),typeof l.fog<"u"&&(u.fog=l.fog),typeof l.clipFar<"u"&&(u.clipFar=l.clipFar)),u}e.copySnapshot=o;function s(u,l){return u.mode===l.mode&&u.fov===l.fov&&u.radius===l.radius&&u.radiusMax===l.radiusMax&&u.fog===l.fog&&u.clipFar===l.clipFar&&A.exactEquals(u.position,l.position)&&A.exactEquals(u.up,l.up)&&A.exactEquals(u.target,l.target)}e.areSnapshotsEqual=s})(Sa||(Sa={}));function SFe(e){var t=e.viewport,r=e.zoom,n=e.near,a=e.far,i=e.viewOffset,o=-t.width/2,s=t.width/2,u=t.height/2,l=-t.height/2,c=(s-o)/(2*r),d=(u-l)/(2*r),f=(s+o)/2,p=(u+l)/2,h=f-c,m=f+c,v=p+d,g=p-d;if(i.enabled){var y=r/(i.width/i.fullWidth),b=r/(i.height/i.fullHeight),S=(s-o)/i.width,x=(u-l)/i.height;h+=S*(i.offsetX/y),m=h+S*(i.width/y),v-=x*(i.offsetY/b),g=v-x*(i.height/b)}de.ortho(e.projection,h,m,v,g,n,a),de.lookAt(e.view,e.position,e.target,e.up)}function CFe(e){var t=e.viewport.width/e.viewport.height,r=e.near,n=e.far,a=e.viewOffset,i=r*Math.tan(.5*e.state.fov),o=2*i,s=t*o,u=-.5*s;a.enabled&&(u+=a.offsetX*s/a.fullWidth,i-=a.offsetY*o/a.fullHeight,s*=a.width/a.fullWidth,o*=a.height/a.fullHeight),de.perspective(e.projection,u,u+s,i,i-o,r,n),de.lookAt(e.view,e.position,e.target,e.up)}function wFe(e){var t=e.state,r=t.radius,n=t.radiusMax,a=t.mode,i=t.fog,o=t.clipFar;r<.01&&(r=.01);var s=o?r:n,u=A.distance(e.position,e.target),l=u-r,c=u+s,d=-(50-i)/50,f=u-s*d,p=c;a==="perspective"?(l=Math.max(Math.min(n,5),l),c=Math.max(5,c)):(l=Math.max(0,l),c=Math.max(0,c)),l===c&&(c=l+.01),e.near=l,e.far=2*c,e.fogNear=f,e.fogFar=p}var Yk={sceneBoundingSpheres:M.Boolean(!1,{description:"Show full scene bounding spheres."}),visibleSceneBoundingSpheres:M.Boolean(!1,{description:"Show visible scene bounding spheres."}),objectBoundingSpheres:M.Boolean(!1,{description:"Show bounding spheres of visible render objects."}),instanceBoundingSpheres:M.Boolean(!1,{description:"Show bounding spheres of visible instances."})},_Fe=function(){function e(t,r,n){this.objectsData=new Map,this.instancesData=new Map,this.scene=w0.create(t),this.parent=r,this._props=T(T({},M.getDefaultValues(Yk)),n)}return e.prototype.update=function(){var t=this,r=sx(this.scene,this.parent.boundingSphere,this.sceneData,gr.lightgrey,TFe);r&&(this.sceneData=r);var n=sx(this.scene,this.parent.boundingSphereVisible,this.visibleSceneData,gr.black,EFe);n&&(this.visibleSceneData=n),this.parent.forEach(function(a,i){var o=t.objectsData.get(i),s=sx(t.scene,a.values.boundingSphere.ref.value,o,gr.tomato,PFe);s&&t.objectsData.set(i,s);var u=t.instancesData.get(i),l=sx(t.scene,a.values.invariantBoundingSphere.ref.value,u,gr.skyblue,IFe,{aTransform:i.values.aTransform,matrix:i.values.matrix,transform:i.values.transform,extraTransform:i.values.extraTransform,uInstanceCount:i.values.uInstanceCount,instanceCount:i.values.instanceCount,aInstance:i.values.aInstance,hasReflection:i.values.hasReflection});l&&t.instancesData.set(i,l)}),this.objectsData.forEach(function(a,i){t.parent.has(i)||(t.scene.remove(a.renderObject),t.objectsData.delete(i))}),this.instancesData.forEach(function(a,i){t.parent.has(i)||(t.scene.remove(a.renderObject),t.instancesData.delete(i))}),this.scene.update(void 0,!1),this.scene.commit()},e.prototype.syncVisibility=function(){var t=this;this.sceneData&&(this.sceneData.renderObject.state.visible=this._props.sceneBoundingSpheres),this.visibleSceneData&&(this.visibleSceneData.renderObject.state.visible=this._props.visibleSceneBoundingSpheres),this.parent.forEach(function(r,n){var a=t.objectsData.get(n);a&&(a.renderObject.state.visible=n.state.visible&&t._props.objectBoundingSpheres);var i=t.instancesData.get(n);i&&(i.renderObject.state.visible=n.state.visible&&t._props.instanceBoundingSpheres)})},e.prototype.clear=function(){this.sceneData=void 0,this.objectsData.clear(),this.scene.clear()},Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this._props.sceneBoundingSpheres||this._props.visibleSceneBoundingSpheres||this._props.objectBoundingSpheres||this._props.instanceBoundingSpheres},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"props",{get:function(){return this._props},enumerable:!1,configurable:!0}),e.prototype.setProps=function(t){Object.assign(this._props,t),this.isEnabled&&this.update()},e}();function sx(e,t,r,n,a,i){if(!r||!He.equals(r.boundingSphere,t)){var o=AFe(t,r&&r.mesh),s=r?r.renderObject:MFe(o,n,a,i);return r?N.updateIfChanged(s.values.drawCount,xi.getDrawCount(o)):e.add(s),{boundingSphere:He.clone(t),renderObject:s,mesh:o}}}function AFe(e,t){var r=2,n=xk(r),a=kt.createState(n,n/2,t);if(e.radius&&(ti(a,e.center,e.radius,r),He.hasExtrema(e)))for(var i=0,o=e.extrema;i<o.length;i++){var s=o[i];ti(a,s,1,0)}return kt.getMesh(a)}var TFe=Vd(),EFe=Vd(),PFe=Vd(),IFe=Vd();function MFe(e,t,r,n){var a=Wt.Utils.createValuesSimple(e,{alpha:.1,doubleSided:!1},t,1,n);return U0("mesh",a,{disposed:!1,visible:!0,alphaFactor:1,pickable:!1,colorOnly:!1,opaque:!1,writeDepth:!1,noClip:!1},r)}var DFe=function(){function e(t,r,n,a,i){var o=this;i===void 0&&(i=30),this.canvasIdentify=t,this.getLoci=r,this.input=n,this.camera=a,this.maxFps=i,this.ev=pd.create(),this.events={hover:this.ev(),drag:this.ev(),click:this.ev()},this.startX=-1,this.startY=-1,this.endX=-1,this.endY=-1,this.id=void 0,this.position=void 0,this.currentIdentifyT=0,this.isInteracting=!1,this.prevLoci=mr.Loci.Empty,this.prevT=0,this.inside=!1,this.buttons=hm.create(0),this.button=hm.create(0),this.modifiers=$u.None,n.drag.subscribe(function(s){var u=s.x,l=s.y,c=s.buttons,d=s.button,f=s.modifiers;o.isInteracting=!0,o.drag(u,l,c,d,f)}),n.move.subscribe(function(s){var u=s.x,l=s.y,c=s.inside,d=s.buttons,f=s.button,p=s.modifiers;!c||o.isInteracting||o.move(u,l,d,f,p)}),n.leave.subscribe(function(){o.leave()}),n.click.subscribe(function(s){var u=s.x,l=s.y,c=s.buttons,d=s.button,f=s.modifiers;o.outsideViewport(u,l)||o.click(u,l,c,d,f)}),n.interactionEnd.subscribe(function(){o.isInteracting=!1}),n.modifiers.subscribe(function(s){o.modify(s)})}return e.prototype.identify=function(t,r){var n=this.startX!==this.endX||this.startY!==this.endY;if(t===2){n&&!mr.Loci.isEmpty(this.prevLoci)&&(this.events.drag.next({current:this.prevLoci,buttons:this.buttons,button:this.button,modifiers:this.modifiers,pageStart:Xe.create(this.startX,this.startY),pageEnd:Xe.create(this.endX,this.endY)}),this.startX=this.endX,this.startY=this.endY);return}if(n){var a=this.canvasIdentify(this.endX,this.endY);this.id=a?.id,this.position=a?.position,this.startX=this.endX,this.startY=this.endY}if(t===1){var i=this.getLoci(this.id);this.events.click.next({current:i,buttons:this.buttons,button:this.button,modifiers:this.modifiers,page:Xe.create(this.endX,this.endY),position:this.position}),this.prevLoci=i;return}if(!(!this.inside||this.currentIdentifyT!==r||!n||this.outsideViewport(this.endX,this.endY))){var o=this.getLoci(this.id);this.events.hover.next({current:o,buttons:this.buttons,button:this.button,modifiers:this.modifiers,page:Xe.create(this.endX,this.endY),position:this.position}),this.prevLoci=o}},e.prototype.tick=function(t){this.inside&&t-this.prevT>1e3/this.maxFps&&(this.prevT=t,this.currentIdentifyT=t,this.identify(this.isInteracting?2:0,t))},e.prototype.leave=function(){this.inside=!1,mr.Loci.isEmpty(this.prevLoci)||(this.prevLoci=mr.Loci.Empty,this.events.hover.next({current:this.prevLoci,buttons:this.buttons,button:this.button,modifiers:this.modifiers}))},e.prototype.move=function(t,r,n,a,i){this.inside=!0,this.buttons=n,this.button=a,this.modifiers=i,this.endX=t,this.endY=r},e.prototype.click=function(t,r,n,a,i){this.endX=t,this.endY=r,this.buttons=n,this.button=a,this.modifiers=i,this.identify(1,0)},e.prototype.drag=function(t,r,n,a,i){this.endX=t,this.endY=r,this.buttons=n,this.button=a,this.modifiers=i,this.identify(2,0)},e.prototype.modify=function(t){$u.areEqual(t,this.modifiers)||(this.modifiers=t,this.events.hover.next({current:this.prevLoci,buttons:this.buttons,button:this.button,modifiers:this.modifiers,page:Xe.create(this.endX,this.endY),position:this.position}))},e.prototype.outsideViewport=function(t,r){var n=this,a=n.input,i=n.camera.viewport;return t*=a.pixelRatio,r*=a.pixelRatio,t>i.x+i.width||a.height-r>i.y+i.height||t<i.x||a.height-r<i.y},e.prototype.dispose=function(){this.ev.dispose()},e}(),Yo=`
precision highp float;

attribute vec2 aPosition;
uniform vec2 uQuadScale;

void main(void) {
    vec2 position = aPosition * uQuadScale - vec2(1.0, 1.0) + uQuadScale;
    gl_Position = vec4(position, 0.0, 1.0);
}
`,kFe=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tDepth;
uniform vec2 uTexSize;

uniform float uNear;
uniform float uFar;

uniform float uMaxPossibleViewZDiff;

#include common

float getViewZ(const in float depth) {
    #if dOrthographic == 1
        return orthographicDepthToViewZ(depth, uNear, uFar);
    #else
        return perspectiveDepthToViewZ(depth, uNear, uFar);
    #endif
}

float getDepth(const in vec2 coords) {
    return unpackRGBAToDepth(texture2D(tDepth, coords));
}

bool isBackground(const in float depth) {
    return depth == 1.0;
}

void main(void) {
    float backgroundViewZ = uFar + 3.0 * uMaxPossibleViewZDiff;

    vec2 coords = gl_FragCoord.xy / uTexSize;
    vec2 invTexSize = 1.0 / uTexSize;

    float selfDepth = getDepth(coords);
    float selfViewZ = isBackground(selfDepth) ? backgroundViewZ : getViewZ(getDepth(coords));

    float outline = 1.0;
    float bestDepth = 1.0;

    for (int y = -1; y <= 1; y++) {
        for (int x = -1; x <= 1; x++) {
            vec2 sampleCoords = coords + vec2(float(x), float(y)) * invTexSize;
            float sampleDepth = getDepth(sampleCoords);
            float sampleViewZ = isBackground(sampleDepth) ? backgroundViewZ : getViewZ(sampleDepth);

            if (abs(selfViewZ - sampleViewZ) > uMaxPossibleViewZDiff && selfDepth > sampleDepth && sampleDepth <= bestDepth) {
                outline = 0.0;
                bestDepth = sampleDepth;
            }
        }
    }

    gl_FragColor = vec4(outline, packUnitIntervalToRG(bestDepth), 0.0);
}
`,RFe=`
precision highp float;
precision highp int;
precision highp sampler2D;

#include common

uniform sampler2D tDepth;
uniform vec2 uTexSize;
uniform vec4 uBounds;

uniform vec3 uSamples[dNSamples];

uniform mat4 uProjection;
uniform mat4 uInvProjection;

uniform float uRadius;
uniform float uBias;

float smootherstep(float edge0, float edge1, float x) {
    x = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);
    return x * x * x * (x * (x * 6.0 - 15.0) + 10.0);
}

float noise(const in vec2 coords) {
    float a = 12.9898;
    float b = 78.233;
    float c = 43758.5453;
    float dt = dot(coords, vec2(a,b));
    float sn = mod(dt, PI);
    return abs(fract(sin(sn) * c)); // is abs necessary?
}

vec2 getNoiseVec2(const in vec2 coords) {
    return vec2(noise(coords), noise(coords + vec2(PI, 2.71828)));
}

bool isBackground(const in float depth) {
    return depth == 1.0;
}

bool outsideBounds(const in vec2 p) {
    return p.x < uBounds.x || p.y < uBounds.y || p.x > uBounds.z || p.y > uBounds.w;
}

float getDepth(const in vec2 coords) {
    return outsideBounds(coords) ? 1.0 : unpackRGBAToDepth(texture2D(tDepth, coords));
}

vec3 normalFromDepth(const in float depth, const in float depth1, const in float depth2, vec2 offset1, vec2 offset2) {
    vec3 p1 = vec3(offset1, depth1 - depth);
    vec3 p2 = vec3(offset2, depth2 - depth);

    vec3 normal = cross(p1, p2);
    normal.z = -normal.z;

    return normalize(normal);
}

// StarCraft II Ambient Occlusion by [Filion and McNaughton 2008]
void main(void) {
    vec2 invTexSize = 1.0 / uTexSize;
    vec2 selfCoords = gl_FragCoord.xy * invTexSize;

    float selfDepth = getDepth(selfCoords);
    vec2 selfPackedDepth = packUnitIntervalToRG(selfDepth);

    if (isBackground(selfDepth)) {
        gl_FragColor = vec4(packUnitIntervalToRG(0.0), selfPackedDepth);
        return;
    }

    vec2 offset1 = vec2(0.0, invTexSize.y);
    vec2 offset2 = vec2(invTexSize.x, 0.0);

    float selfDepth1 = getDepth(selfCoords + offset1);
    float selfDepth2 = getDepth(selfCoords + offset2);

    vec3 selfViewNormal = normalFromDepth(selfDepth, selfDepth1, selfDepth2, offset1, offset2);
    vec3 selfViewPos = screenSpaceToViewSpace(vec3(selfCoords, selfDepth), uInvProjection);

    vec3 randomVec = normalize(vec3(getNoiseVec2(selfCoords) * 2.0 - 1.0, 0.0));

    vec3 tangent = normalize(randomVec - selfViewNormal * dot(randomVec, selfViewNormal));
    vec3 bitangent = cross(selfViewNormal, tangent);
    mat3 TBN = mat3(tangent, bitangent, selfViewNormal);

    float occlusion = 0.0;
    for(int i = 0; i < dNSamples; i++){
        vec3 sampleViewPos = TBN * uSamples[i];
        sampleViewPos = selfViewPos + sampleViewPos * uRadius;

        vec4 offset = vec4(sampleViewPos, 1.0);
        offset = uProjection * offset;
        offset.xyz = (offset.xyz / offset.w) * 0.5 + 0.5;

        float sampleViewZ = screenSpaceToViewSpace(vec3(offset.xy, getDepth(offset.xy)), uInvProjection).z;

        occlusion += step(sampleViewPos.z + 0.025, sampleViewZ) * smootherstep(0.0, 1.0, uRadius / abs(selfViewPos.z - sampleViewZ));
    }
    occlusion = 1.0 - (uBias * occlusion / float(dNSamples));

    vec2 packedOcclusion = packUnitIntervalToRG(occlusion);

    gl_FragColor = vec4(packedOcclusion, selfPackedDepth);
}
`,OFe=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tSsaoDepth;
uniform vec2 uTexSize;
uniform vec4 uBounds;

uniform float uKernel[dOcclusionKernelSize];

uniform float uBlurDirectionX;
uniform float uBlurDirectionY;

uniform float uMaxPossibleViewZDiff;

uniform float uNear;
uniform float uFar;

#include common

float getViewZ(const in float depth) {
    #if dOrthographic == 1
        return orthographicDepthToViewZ(depth, uNear, uFar);
    #else
        return perspectiveDepthToViewZ(depth, uNear, uFar);
    #endif
}

bool isBackground(const in float depth) {
    return depth == 1.0;
}

bool outsideBounds(const in vec2 p) {
    return p.x < uBounds.x || p.y < uBounds.y || p.x > uBounds.z || p.y > uBounds.w;
}

void main(void) {
    vec2 coords = gl_FragCoord.xy / uTexSize;

    vec2 packedDepth = texture2D(tSsaoDepth, coords).zw;

    if (outsideBounds(coords)) {
        gl_FragColor = vec4(packUnitIntervalToRG(1.0), packedDepth);
        return;
    }

    float selfDepth = unpackRGToUnitInterval(packedDepth);
    // if background and if second pass
    if (isBackground(selfDepth) && uBlurDirectionY != 0.0) {
        gl_FragColor = vec4(packUnitIntervalToRG(1.0), packedDepth);
        return;
    }

    float selfViewZ = getViewZ(selfDepth);

    vec2 offset = vec2(uBlurDirectionX, uBlurDirectionY) / uTexSize;

    float sum = 0.0;
    float kernelSum = 0.0;
    // only if kernelSize is odd
    for (int i = -dOcclusionKernelSize / 2; i <= dOcclusionKernelSize / 2; i++) {
        vec2 sampleCoords = coords + float(i) * offset;
        if (outsideBounds(sampleCoords)) {
            continue;
        }

        vec4 sampleSsaoDepth = texture2D(tSsaoDepth, sampleCoords);

        float sampleDepth = unpackRGToUnitInterval(sampleSsaoDepth.zw);
        if (isBackground(sampleDepth)) {
            continue;
        }

        if (abs(float(i)) > 1.0) { // abs is not defined for int in webgl1
            float sampleViewZ = getViewZ(sampleDepth);
            if (abs(selfViewZ - sampleViewZ) > uMaxPossibleViewZDiff) {
                continue;
            }
        }

        float kernel = uKernel[int(abs(float(i)))]; // abs is not defined for int in webgl1
        float sampleValue = unpackRGToUnitInterval(sampleSsaoDepth.xy);

        sum += kernel * sampleValue;
        kernelSum += kernel;
    }

    gl_FragColor = vec4(packUnitIntervalToRG(sum / kernelSum), packedDepth);
}
`,BFe=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tSsaoDepth;
uniform sampler2D tColor;
uniform sampler2D tDepth;
uniform sampler2D tOutlines;
uniform vec2 uTexSize;

uniform float uNear;
uniform float uFar;
uniform float uFogNear;
uniform float uFogFar;
uniform vec3 uFogColor;
uniform bool uTransparentBackground;

uniform float uOcclusionBias;
uniform float uOcclusionRadius;

uniform float uOutlineScale;
uniform float uOutlineThreshold;

uniform float uMaxPossibleViewZDiff;

const vec3 occlusionColor = vec3(0.0);

#include common

float getViewZ(const in float depth) {
    #if dOrthographic == 1
        return orthographicDepthToViewZ(depth, uNear, uFar);
    #else
        return perspectiveDepthToViewZ(depth, uNear, uFar);
    #endif
}

float getDepth(const in vec2 coords) {
    return unpackRGBAToDepth(texture2D(tDepth, coords));
}

bool isBackground(const in float depth) {
    return depth == 1.0;
}

float getOutline(const in vec2 coords, out float closestTexel) {
    float backgroundViewZ = uFar + 3.0 * uMaxPossibleViewZDiff;
    vec2 invTexSize = 1.0 / uTexSize;

    float selfDepth = getDepth(coords);
    float selfViewZ = isBackground(selfDepth) ? backgroundViewZ : getViewZ(selfDepth);

    float outline = 1.0;
    closestTexel = 1.0;
    for (int y = -dOutlineScale; y <= dOutlineScale; y++) {
        for (int x = -dOutlineScale; x <= dOutlineScale; x++) {
            if (x * x + y * y > dOutlineScale * dOutlineScale) {
                continue;
            }

            vec2 sampleCoords = coords + vec2(float(x), float(y)) * invTexSize;

            vec4 sampleOutlineCombined = texture2D(tOutlines, sampleCoords);
            float sampleOutline = sampleOutlineCombined.r;
            float sampleOutlineDepth = unpackRGToUnitInterval(sampleOutlineCombined.gb);

            if (sampleOutline == 0.0 && sampleOutlineDepth < closestTexel && abs(selfViewZ - sampleOutlineDepth) > uMaxPossibleViewZDiff) {
                outline = 0.0;
                closestTexel = sampleOutlineDepth;
            }
        }
    }
    return outline;
}

float getSsao(vec2 coords) {
    float rawSsao = unpackRGToUnitInterval(texture2D(tSsaoDepth, coords).xy);
    if (rawSsao > 0.999) {
        return 1.0;
    } else if (rawSsao > 0.001) {
        return rawSsao;
    }
    // treat values close to 0.0 as errors and return no occlusion
    return 1.0;
}

void main(void) {
    vec2 coords = gl_FragCoord.xy / uTexSize;
    vec4 color = texture2D(tColor, coords);

    float viewDist;
    float fogFactor;

    #ifdef dOcclusionEnable
        float depth = getDepth(coords);
        if (!isBackground(depth)) {
            viewDist = abs(getViewZ(depth));
            fogFactor = smoothstep(uFogNear, uFogFar, viewDist);
            float occlusionFactor = getSsao(coords);
            if (!uTransparentBackground) {
                color.rgb = mix(mix(occlusionColor, uFogColor, fogFactor), color.rgb, occlusionFactor);
            } else {
                color.rgb = mix(occlusionColor * (1.0 - fogFactor), color.rgb, occlusionFactor);
            }
        }
    #endif

    // outline needs to be handled after occlusion to keep them clean
    #ifdef dOutlineEnable
        float closestTexel;
        float outline = getOutline(coords, closestTexel);

        if (outline == 0.0) {
            color.rgb *= outline;
            viewDist = abs(getViewZ(closestTexel));
            fogFactor = smoothstep(uFogNear, uFogFar, viewDist);
            if (!uTransparentBackground) {
                color.rgb = mix(color.rgb, uFogColor, fogFactor);
            } else {
                color.a = 1.0 - fogFactor;
            }
        }
    #endif

    gl_FragColor = color;
}
`,FFe=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tColor;
uniform vec2 uTexSizeInv;

// adapted from https://github.com/kosua20/Rendu
// MIT License Copyright (c) 2017 Simon Rodriguez

#define QUALITY(q) ((q) < 5 ? 1.0 : ((q) > 5 ? ((q) < 10 ? 2.0 : ((q) < 11 ? 4.0 : 8.0)) : 1.5))

float rgb2luma(vec3 rgb){
    return sqrt(dot(rgb, vec3(0.299, 0.587, 0.114)));
}

float sampleLuma(vec2 uv) {
    return rgb2luma(texture2D(tColor, uv).rgb);
}

float sampleLuma(vec2 uv, float uOffset, float vOffset) {
    uv += uTexSizeInv * vec2(uOffset, vOffset);
    return sampleLuma(uv);
}

void main(void) {
    vec2 coords = gl_FragCoord.xy * uTexSizeInv;
    vec2 inverseScreenSize = uTexSizeInv;

    vec4 colorCenter = texture2D(tColor, coords);

    // Luma at the current fragment
    float lumaCenter = rgb2luma(colorCenter.rgb);

    // Luma at the four direct neighbours of the current fragment.
    float lumaDown = sampleLuma(coords, 0.0, -1.0);
    float lumaUp = sampleLuma(coords, 0.0, 1.0);
    float lumaLeft = sampleLuma(coords, -1.0, 0.0);
    float lumaRight = sampleLuma(coords, 1.0, 0.0);

    // Find the maximum and minimum luma around the current fragment.
    float lumaMin = min(lumaCenter, min(min(lumaDown, lumaUp), min(lumaLeft, lumaRight)));
    float lumaMax = max(lumaCenter, max(max(lumaDown, lumaUp), max(lumaLeft, lumaRight)));

    // Compute the delta.
    float lumaRange = lumaMax - lumaMin;

    // If the luma variation is lower that a threshold (or if we are in a really dark area),
    // we are not on an edge, don't perform any AA.
    if (lumaRange < max(dEdgeThresholdMin, lumaMax * dEdgeThresholdMax)) {
        gl_FragColor = colorCenter;
        return;
    }

    // Query the 4 remaining corners lumas.
    float lumaDownLeft = sampleLuma(coords, -1.0, -1.0);
    float lumaUpRight = sampleLuma(coords, 1.0, 1.0);
    float lumaUpLeft = sampleLuma(coords, -1.0, 1.0);
    float lumaDownRight = sampleLuma(coords, 1.0, -1.0);

    // Combine the four edges lumas (using intermediary variables for future computations
    // with the same values).
    float lumaDownUp = lumaDown + lumaUp;
    float lumaLeftRight = lumaLeft + lumaRight;

    // Same for corners
    float lumaLeftCorners = lumaDownLeft + lumaUpLeft;
    float lumaDownCorners = lumaDownLeft + lumaDownRight;
    float lumaRightCorners = lumaDownRight + lumaUpRight;
    float lumaUpCorners = lumaUpRight + lumaUpLeft;

    // Compute an estimation of the gradient along the horizontal and vertical axis.
    float edgeHorizontal = abs(-2.0 * lumaLeft + lumaLeftCorners) + abs(-2.0 * lumaCenter + lumaDownUp) * 2.0 + abs(-2.0 * lumaRight + lumaRightCorners);
    float edgeVertical = abs(-2.0 * lumaUp + lumaUpCorners) + abs(-2.0 * lumaCenter + lumaLeftRight) * 2.0 + abs(-2.0 * lumaDown + lumaDownCorners);

    // Is the local edge horizontal or vertical ?
    bool isHorizontal = (edgeHorizontal >= edgeVertical);

    // Choose the step size (one pixel) accordingly.
    float stepLength = isHorizontal ? inverseScreenSize.y : inverseScreenSize.x;

    // Select the two neighboring texels lumas in the opposite direction to the local edge.
    float luma1 = isHorizontal ? lumaDown : lumaLeft;
    float luma2 = isHorizontal ? lumaUp : lumaRight;
    // Compute gradients in this direction.
    float gradient1 = luma1 - lumaCenter;
    float gradient2 = luma2 - lumaCenter;

    // Which direction is the steepest ?
    bool is1Steepest = abs(gradient1) >= abs(gradient2);

    // Gradient in the corresponding direction, normalized.
    float gradientScaled = 0.25 * max(abs(gradient1), abs(gradient2));

    // Average luma in the correct direction.
    float lumaLocalAverage = 0.0;
    if(is1Steepest){
        // Switch the direction
        stepLength = -stepLength;
        lumaLocalAverage = 0.5 * (luma1 + lumaCenter);
    } else {
        lumaLocalAverage = 0.5 * (luma2 + lumaCenter);
    }

    // Shift UV in the correct direction by half a pixel.
    vec2 currentUv = coords;
    if(isHorizontal){
        currentUv.y += stepLength * 0.5;
    } else {
        currentUv.x += stepLength * 0.5;
    }

    // Compute offset (for each iteration step) in the right direction.
    vec2 offset = isHorizontal ? vec2(inverseScreenSize.x, 0.0) : vec2(0.0, inverseScreenSize.y);
    // Compute UVs to explore on each side of the edge, orthogonally.
    // The QUALITY allows us to step faster.
    vec2 uv1 = currentUv - offset * QUALITY(0);
    vec2 uv2 = currentUv + offset * QUALITY(0);

    // Read the lumas at both current extremities of the exploration segment,
    // and compute the delta wrt to the local average luma.
    float lumaEnd1 = sampleLuma(uv1);
    float lumaEnd2 = sampleLuma(uv2);
    lumaEnd1 -= lumaLocalAverage;
    lumaEnd2 -= lumaLocalAverage;

    // If the luma deltas at the current extremities is larger than the local gradient,
    // we have reached the side of the edge.
    bool reached1 = abs(lumaEnd1) >= gradientScaled;
    bool reached2 = abs(lumaEnd2) >= gradientScaled;
    bool reachedBoth = reached1 && reached2;

    // If the side is not reached, we continue to explore in this direction.
    if(!reached1){
        uv1 -= offset * QUALITY(1);
    }
    if(!reached2){
        uv2 += offset * QUALITY(1);
    }

    // If both sides have not been reached, continue to explore.
    if(!reachedBoth){
        for(int i = 2; i < dIterations; i++){
            // If needed, read luma in 1st direction, compute delta.
            if(!reached1){
                lumaEnd1 = sampleLuma(uv1);
                lumaEnd1 = lumaEnd1 - lumaLocalAverage;
            }
            // If needed, read luma in opposite direction, compute delta.
            if(!reached2){
                lumaEnd2 = sampleLuma(uv2);
                lumaEnd2 = lumaEnd2 - lumaLocalAverage;
            }
            // If the luma deltas at the current extremities is larger than the local gradient,
            // we have reached the side of the edge.
            reached1 = abs(lumaEnd1) >= gradientScaled;
            reached2 = abs(lumaEnd2) >= gradientScaled;
            reachedBoth = reached1 && reached2;

            // If the side is not reached, we continue to explore in this direction,
            // with a variable quality.
            if(!reached1){
                uv1 -= offset * QUALITY(i);
            }
            if(!reached2){
                uv2 += offset * QUALITY(i);
            }

            // If both sides have been reached, stop the exploration.
            if(reachedBoth){
                break;
            }
        }
    }

    // Compute the distances to each side edge of the edge (!).
    float distance1 = isHorizontal ? (coords.x - uv1.x) : (coords.y - uv1.y);
    float distance2 = isHorizontal ? (uv2.x - coords.x) : (uv2.y - coords.y);

    // In which direction is the side of the edge closer ?
    bool isDirection1 = distance1 < distance2;
    float distanceFinal = min(distance1, distance2);

    // Thickness of the edge.
    float edgeThickness = (distance1 + distance2);

    // Is the luma at center smaller than the local average ?
    bool isLumaCenterSmaller = lumaCenter < lumaLocalAverage;

    // If the luma at center is smaller than at its neighbour,
    // the delta luma at each end should be positive (same variation).
    bool correctVariation1 = (lumaEnd1 < 0.0) != isLumaCenterSmaller;
    bool correctVariation2 = (lumaEnd2 < 0.0) != isLumaCenterSmaller;

    // Only keep the result in the direction of the closer side of the edge.
    bool correctVariation = isDirection1 ? correctVariation1 : correctVariation2;

    // UV offset: read in the direction of the closest side of the edge.
    float pixelOffset = - distanceFinal / edgeThickness + 0.5;

    // If the luma variation is incorrect, do not offset.
    float finalOffset = correctVariation ? pixelOffset : 0.0;

    // Sub-pixel shifting
    // Full weighted average of the luma over the 3x3 neighborhood.
    float lumaAverage = (1.0 / 12.0) * (2.0 * (lumaDownUp + lumaLeftRight) + lumaLeftCorners + lumaRightCorners);
    // Ratio of the delta between the global average and the center luma,
    // over the luma range in the 3x3 neighborhood.
    float subPixelOffset1 = clamp(abs(lumaAverage - lumaCenter) / lumaRange, 0.0, 1.0);
    float subPixelOffset2 = (-2.0 * subPixelOffset1 + 3.0) * subPixelOffset1 * subPixelOffset1;
    // Compute a sub-pixel offset based on this delta.
    float subPixelOffsetFinal = subPixelOffset2 * subPixelOffset2 * float(dSubpixelQuality);

    // Pick the biggest of the two offsets.
    finalOffset = max(finalOffset, subPixelOffsetFinal);

    // Compute the final UV coordinates.
    vec2 finalUv = coords;
    if(isHorizontal){
        finalUv.y += finalOffset * stepLength;
    } else {
        finalUv.x += finalOffset * stepLength;
    }

    // Read the color at the new UV coordinates, and use it.
    gl_FragColor = texture2D(tColor, finalUv);
}
`,LFe={edgeThresholdMin:M.Numeric(.0312,{min:.0312,max:.0833,step:1e-4},{description:"Trims the algorithm from processing darks."}),edgeThresholdMax:M.Numeric(.063,{min:.063,max:.333,step:.001},{description:"The minimum amount of local contrast required to apply algorithm."}),iterations:M.Numeric(12,{min:0,max:16,step:1},{description:"Number of edge exploration steps."}),subpixelQuality:M.Numeric(.3,{min:0,max:1,step:.01},{description:"Choose the amount of sub-pixel aliasing removal."})},NFe=function(){function e(t,r){this.webgl=t,this.renderable=VFe(t,r)}return e.prototype.updateState=function(t){var r=this.webgl,n=r.gl,a=r.state;a.enable(n.SCISSOR_TEST),a.disable(n.BLEND),a.disable(n.DEPTH_TEST),a.depthMask(!1);var i=t.x,o=t.y,s=t.width,u=t.height;n.viewport(i,o,s,u),n.scissor(i,o,s,u),a.clearColor(0,0,0,1),n.clear(n.COLOR_BUFFER_BIT)},e.prototype.setSize=function(t,r){N.update(this.renderable.values.uTexSizeInv,Xe.set(this.renderable.values.uTexSizeInv.ref.value,1/t,1/r))},e.prototype.update=function(t,r){var n=this.renderable.values,a=r.edgeThresholdMin,i=r.edgeThresholdMax,o=r.iterations,s=r.subpixelQuality,u=!1;n.tColor.ref.value!==t&&(N.update(this.renderable.values.tColor,t),u=!0),n.dEdgeThresholdMin.ref.value!==a&&(u=!0),N.updateIfChanged(n.dEdgeThresholdMin,a),n.dEdgeThresholdMax.ref.value!==i&&(u=!0),N.updateIfChanged(n.dEdgeThresholdMax,i),n.dIterations.ref.value!==o&&(u=!0),N.updateIfChanged(n.dIterations,o),n.dSubpixelQuality.ref.value!==s&&(u=!0),N.updateIfChanged(n.dSubpixelQuality,s),u&&this.renderable.update()},e.prototype.render=function(t,r){r?r.bind():this.webgl.unbindFramebuffer(),this.updateState(t),this.renderable.render()},e}(),zFe=T(T({},Ni),{tColor:hr("texture","rgba","ubyte","linear"),uTexSizeInv:Ye("v2"),dEdgeThresholdMin:nr("number"),dEdgeThresholdMax:nr("number"),dIterations:nr("number"),dSubpixelQuality:nr("number")}),UFe=Wn("fxaa",Yo,FFe);function VFe(e,t){var r=t.getWidth(),n=t.getHeight(),a=T(T({},zi),{tColor:N.create(t),uTexSizeInv:N.create(Xe.create(1/r,1/n)),dEdgeThresholdMin:N.create(.0312),dEdgeThresholdMax:N.create(.125),dIterations:N.create(12),dSubpixelQuality:N.create(.3)}),i=T({},zFe),o=li(e,"triangles",UFe,i,a);return ui(o,a)}var HFe=`
precision highp float;

attribute vec2 aPosition;
uniform vec2 uQuadScale;

uniform vec2 uTexSizeInv;
uniform vec4 uViewport;

varying vec2 vUv;
varying vec4 vOffset[2];

void SMAANeighborhoodBlendingVS(vec2 texCoord) {
    vOffset[0] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-1.0, 0.0, 0.0, 1.0); // WebGL port note: Changed sign in W component
    vOffset[1] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(1.0, 0.0, 0.0, -1.0); // WebGL port note: Changed sign in W component
}

void main() {
    vec2 scale = uViewport.zw * uTexSizeInv;
    vec2 shift = uViewport.xy * uTexSizeInv;
    vUv = (aPosition + 1.0) * 0.5 * scale + shift;
    SMAANeighborhoodBlendingVS(vUv);
    vec2 position = aPosition * uQuadScale - vec2(1.0, 1.0) + uQuadScale;
    gl_Position = vec4(position, 0.0, 1.0);
}
`,jFe=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tWeights;
uniform sampler2D tColor;
uniform vec2 uTexSizeInv;

varying vec2 vUv;
varying vec4 vOffset[2];

vec4 SMAANeighborhoodBlendingPS(vec2 texCoord, vec4 offset[2], sampler2D colorTex, sampler2D blendTex) {
    // Fetch the blending weights for current pixel:
    vec4 a;
    a.xz = texture2D(blendTex, texCoord).xz;
    a.y = texture2D(blendTex, offset[1].zw).g;
    a.w = texture2D(blendTex, offset[1].xy).a;

    // Is there any blending weight with a value greater than 0.0?
    if (dot(a, vec4(1.0, 1.0, 1.0, 1.0)) < 1e-5) {
        return texture2D(colorTex, texCoord, 0.0);
    } else {
        // Up to 4 lines can be crossing a pixel (one through each edge). We
        // favor blending by choosing the line with the maximum weight for each
        // direction:
        vec2 offset;
        offset.x = a.a > a.b ? a.a : -a.b; // left vs. right
        offset.y = a.g > a.r ? -a.g : a.r; // top vs. bottom // WebGL port note: Changed signs

        // Then we go in the direction that has the maximum weight:
        if (abs(offset.x) > abs(offset.y)) { // horizontal vs. vertical
            offset.y = 0.0;
        } else {
            offset.x = 0.0;
        }

        // Fetch the opposite color and lerp by hand:
        vec4 C = texture2D(colorTex, texCoord, 0.0);
        texCoord += sign(offset) * uTexSizeInv;
        vec4 Cop = texture2D(colorTex, texCoord, 0.0);
        float s = abs(offset.x) > abs(offset.y) ? abs(offset.x) : abs(offset.y);

        // WebGL port note: Added gamma correction
        C.xyz = pow(C.xyz, vec3(2.2));
        Cop.xyz = pow(Cop.xyz, vec3(2.2));
        vec4 mixed = mix(C, Cop, s);
        mixed.xyz = pow(mixed.xyz, vec3(1.0 / 2.2));

        return mixed;
    }
}

void main() {
    gl_FragColor = SMAANeighborhoodBlendingPS(vUv, vOffset, tColor, tWeights);
}
`,GFe=`
precision highp float;

attribute vec2 aPosition;
uniform vec2 uQuadScale;

uniform vec2 uTexSizeInv;
uniform vec4 uViewport;

varying vec2 vUv;
varying vec4 vOffset[3];
varying vec2 vPixCoord;

void SMAABlendingWeightCalculationVS(vec2 texCoord) {
    vPixCoord = texCoord / uTexSizeInv;

    // We will use these offsets for the searches later on (see @PSEUDO_GATHER4):
    vOffset[0] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-0.25, 0.125, 1.25, 0.125); // WebGL port note: Changed sign in Y and W components
    vOffset[1] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-0.125, 0.25, -0.125, -1.25); // WebGL port note: Changed sign in Y and W components

    // And these for the searches, they indicate the ends of the loops:
    vOffset[2] = vec4(vOffset[0].xz, vOffset[1].yw) + vec4(-2.0, 2.0, -2.0, 2.0) * uTexSizeInv.xxyy * float(dMaxSearchSteps);
}

void main() {
    vec2 scale = uViewport.zw * uTexSizeInv;
    vec2 shift = uViewport.xy * uTexSizeInv;
    vUv = (aPosition + 1.0) * 0.5 * scale + shift;
    SMAABlendingWeightCalculationVS(vUv);
    vec2 position = aPosition * uQuadScale - vec2(1.0, 1.0) + uQuadScale;
    gl_Position = vec4(position, 0.0, 1.0);
}
`,qFe=`
precision highp float;
precision highp int;
precision highp sampler2D;

#define SMAASampleLevelZeroOffset(tex, coord, offset) texture2D(tex, coord + float(offset) * uTexSizeInv, 0.0)

#define SMAA_AREATEX_MAX_DISTANCE 16
#define SMAA_AREATEX_PIXEL_SIZE (1.0 / vec2(160.0, 560.0))
#define SMAA_AREATEX_SUBTEX_SIZE (1.0 / 7.0)

uniform sampler2D tEdges;
uniform sampler2D tArea;
uniform sampler2D tSearch;
uniform vec2 uTexSizeInv;

varying vec2 vUv;
varying vec4 vOffset[3];
varying vec2 vPixCoord;

#if __VERSION__ == 100
    vec2 round(vec2 x) {
        return sign(x) * floor(abs(x) + 0.5);
    }
#endif

float SMAASearchLength(sampler2D searchTex, vec2 e, float bias, float scale) {
    // Not required if searchTex accesses are set to point:
    // float2 SEARCH_TEX_PIXEL_SIZE = 1.0 / float2(66.0, 33.0);
    // e = float2(bias, 0.0) + 0.5 * SEARCH_TEX_PIXEL_SIZE +
    //     e * float2(scale, 1.0) * float2(64.0, 32.0) * SEARCH_TEX_PIXEL_SIZE;
    e.r = bias + e.r * scale;
    return 255.0 * texture2D(searchTex, e, 0.0).r;
}

float SMAASearchXLeft(sampler2D edgesTex, sampler2D searchTex, vec2 texCoord, float end) {
    /**
     * @PSEUDO_GATHER4
     * This texCoord has been offset by (-0.25, -0.125) in the vertex shader to
     * sample between edge, thus fetching four edges in a row.
     * Sampling with different offsets in each direction allows to disambiguate
     * which edges are active from the four fetched ones.
     */
    vec2 e = vec2(0.0, 1.0);

    for (int i = 0; i < dMaxSearchSteps; i++) { // WebGL port note: Changed while to for
        e = texture2D( edgesTex, texCoord, 0.0).rg;
        texCoord -= vec2(2.0, 0.0) * uTexSizeInv;
        if (!(texCoord.x > end && e.g > 0.8281 && e.r == 0.0)) break;
    }

    // We correct the previous (-0.25, -0.125) offset we applied:
    texCoord.x += 0.25 * uTexSizeInv.x;

    // The searches are bias by 1, so adjust the coords accordingly:
    texCoord.x += uTexSizeInv.x;

    // Disambiguate the length added by the last step:
    texCoord.x += 2.0 * uTexSizeInv.x; // Undo last step
    texCoord.x -= uTexSizeInv.x * SMAASearchLength(searchTex, e, 0.0, 0.5);

    return texCoord.x;
}

float SMAASearchXRight(sampler2D edgesTex, sampler2D searchTex, vec2 texCoord, float end) {
    vec2 e = vec2( 0.0, 1.0 );

    for (int i = 0; i < dMaxSearchSteps; i++) { // WebGL port note: Changed while to for
        e = texture2D(edgesTex, texCoord, 0.0).rg;
        texCoord += vec2(2.0, 0.0) * uTexSizeInv;
        if (!(texCoord.x < end && e.g > 0.8281 && e.r == 0.0)) break;
    }

    texCoord.x -= 0.25 * uTexSizeInv.x;
    texCoord.x -= uTexSizeInv.x;
    texCoord.x -= 2.0 * uTexSizeInv.x;
    texCoord.x += uTexSizeInv.x * SMAASearchLength( searchTex, e, 0.5, 0.5 );

    return texCoord.x;
}

float SMAASearchYUp(sampler2D edgesTex, sampler2D searchTex, vec2 texCoord, float end) {
    vec2 e = vec2( 1.0, 0.0 );

    for (int i = 0; i < dMaxSearchSteps; i++) { // WebGL port note: Changed while to for
        e = texture2D(edgesTex, texCoord, 0.0).rg;
        texCoord += vec2(0.0, 2.0) * uTexSizeInv; // WebGL port note: Changed sign
        if (!(texCoord.y > end && e.r > 0.8281 && e.g == 0.0)) break;
    }

    texCoord.y -= 0.25 * uTexSizeInv.y; // WebGL port note: Changed sign
    texCoord.y -= uTexSizeInv.y; // WebGL port note: Changed sign
    texCoord.y -= 2.0 * uTexSizeInv.y; // WebGL port note: Changed sign
    texCoord.y += uTexSizeInv.y * SMAASearchLength(searchTex, e.gr, 0.0, 0.5); // WebGL port note: Changed sign

    return texCoord.y;
}

float SMAASearchYDown(sampler2D edgesTex, sampler2D searchTex, vec2 texCoord, float end) {
    vec2 e = vec2( 1.0, 0.0 );

    for (int i = 0; i < dMaxSearchSteps; i++) { // WebGL port note: Changed while to for
        e = texture2D(edgesTex, texCoord, 0.0).rg;
        texCoord -= vec2( 0.0, 2.0 ) * uTexSizeInv; // WebGL port note: Changed sign
        if (!(texCoord.y < end && e.r > 0.8281 && e.g == 0.0)) break;
    }

    texCoord.y += 0.25 * uTexSizeInv.y; // WebGL port note: Changed sign
    texCoord.y += uTexSizeInv.y; // WebGL port note: Changed sign
    texCoord.y += 2.0 * uTexSizeInv.y; // WebGL port note: Changed sign
    texCoord.y -= uTexSizeInv.y * SMAASearchLength(searchTex, e.gr, 0.5, 0.5); // WebGL port note: Changed sign

    return texCoord.y;
}

vec2 SMAAArea(sampler2D areaTex, vec2 dist, float e1, float e2, float offset) {
    // Rounding prevents precision errors of bilinear filtering:
    vec2 texCoord = float(SMAA_AREATEX_MAX_DISTANCE) * round(4.0 * vec2(e1, e2)) + dist;

    // We do a scale and bias for mapping to texel space:
    texCoord = SMAA_AREATEX_PIXEL_SIZE * texCoord + (0.5 * SMAA_AREATEX_PIXEL_SIZE);

    // Move to proper place, according to the subpixel offset:
    texCoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;

    return texture2D(areaTex, texCoord, 0.0).rg;
}

vec4 SMAABlendingWeightCalculationPS(vec2 texCoord, vec2 pixCoord, vec4 offset[3], sampler2D edgesTex, sampler2D areaTex, sampler2D searchTex, ivec4 subsampleIndices) {
    vec4 weights = vec4(0.0, 0.0, 0.0, 0.0);

    vec2 e = texture2D(edgesTex, texCoord).rg;

    if (e.g > 0.0) { // Edge at north
        vec2 d;

        // Find the distance to the left:
        vec2 coords;
        coords.x = SMAASearchXLeft(edgesTex, searchTex, offset[0].xy, offset[2].x );
        coords.y = offset[1].y; // offset[1].y = texCoord.y - 0.25 * uTexSizeInv.y (@CROSSING_OFFSET)
        d.x = coords.x;

        // Now fetch the left crossing edges, two at a time using bilinear
        // filtering. Sampling at -0.25 (see @CROSSING_OFFSET) enables to
        // discern what value each edge has:
        float e1 = texture2D(edgesTex, coords, 0.0).r;

        // Find the distance to the right:
        coords.x = SMAASearchXRight(edgesTex, searchTex, offset[0].zw, offset[2].y);
        d.y = coords.x;

        // We want the distances to be in pixel units (doing this here allow to
        // better interleave arithmetic and memory accesses):
        d = d / uTexSizeInv.x - pixCoord.x;

        // SMAAArea below needs a sqrt, as the areas texture is compressed
        // quadratically:
        vec2 sqrt_d = sqrt(abs(d));

        // Fetch the right crossing edges:
        coords.y -= 1.0 * uTexSizeInv.y; // WebGL port note: Added
        float e2 = SMAASampleLevelZeroOffset(edgesTex, coords, ivec2(1, 0)).r;

        // Ok, we know how this pattern looks like, now it is time for getting
        // the actual area:
        weights.rg = SMAAArea(areaTex, sqrt_d, e1, e2, float(subsampleIndices.y));
    }

    if (e.r > 0.0) { // Edge at west
        vec2 d;

        // Find the distance to the top:
        vec2 coords;

        coords.y = SMAASearchYUp(edgesTex, searchTex, offset[1].xy, offset[2].z );
        coords.x = offset[0].x; // offset[1].x = texCoord.x - 0.25 * uTexSizeInv.x;
        d.x = coords.y;

        // Fetch the top crossing edges:
        float e1 = texture2D(edgesTex, coords, 0.0).g;

        // Find the distance to the bottom:
        coords.y = SMAASearchYDown(edgesTex, searchTex, offset[1].zw, offset[2].w);
        d.y = coords.y;

        // We want the distances to be in pixel units:
        d = d / uTexSizeInv.y - pixCoord.y;

        // SMAAArea below needs a sqrt, as the areas texture is compressed
        // quadratically:
        vec2 sqrt_d = sqrt(abs(d));

        // Fetch the bottom crossing edges:
        coords.y -= 1.0 * uTexSizeInv.y; // WebGL port note: Added
        float e2 = SMAASampleLevelZeroOffset(edgesTex, coords, ivec2(0, 1)).g;

        // Get the area for this direction:
        weights.ba = SMAAArea(areaTex, sqrt_d, e1, e2, float(subsampleIndices.x));
    }

    return weights;
}

void main() {
    gl_FragColor = SMAABlendingWeightCalculationPS(vUv, vPixCoord, vOffset, tEdges, tArea, tSearch, ivec4(0.0));
}
`,WFe=`
precision highp float;

attribute vec2 aPosition;
uniform vec2 uQuadScale;

uniform vec2 uTexSizeInv;
uniform vec4 uViewport;

varying vec2 vUv;
varying vec4 vOffset[3];

void SMAAEdgeDetectionVS(vec2 texCoord) {
    vOffset[0] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-1.0, 0.0, 0.0, 1.0); // WebGL port note: Changed sign in W component
    vOffset[1] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(1.0, 0.0, 0.0, -1.0); // WebGL port note: Changed sign in W component
    vOffset[2] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-2.0, 0.0, 0.0, 2.0); // WebGL port note: Changed sign in W component
}

void main() {
    vec2 scale = uViewport.zw * uTexSizeInv;
    vec2 shift = uViewport.xy * uTexSizeInv;
    vUv = (aPosition + 1.0) * 0.5 * scale + shift;
    SMAAEdgeDetectionVS(vUv);
    vec2 position = aPosition * uQuadScale - vec2(1.0, 1.0) + uQuadScale;
    gl_Position = vec4(position, 0.0, 1.0);
}
`,XFe=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tColor;
uniform vec2 uTexSizeInv;

varying vec2 vUv;
varying vec4 vOffset[3];

vec4 SMAAColorEdgeDetectionPS(vec2 texcoord, vec4 offset[3], sampler2D colorTex) {
    vec2 threshold = vec2(dEdgeThreshold, dEdgeThreshold);

    // Calculate color deltas:
    vec4 delta;
    vec3 C = texture2D(colorTex, texcoord).rgb;

    vec3 Cleft = texture2D(colorTex, offset[0].xy).rgb;
    vec3 t = abs(C - Cleft);
    delta.x = max(max(t.r, t.g), t.b);

    vec3 Ctop = texture2D(colorTex, offset[0].zw).rgb;
    t = abs(C - Ctop);
    delta.y = max(max(t.r, t.g), t.b);

    // We do the usual threshold:
    vec2 edges = step(threshold, delta.xy);

    // Then discard if there is no edge:
    if (dot(edges, vec2(1.0, 1.0 )) == 0.0)
        discard;

    // Calculate right and bottom deltas:
    vec3 Cright = texture2D(colorTex, offset[1].xy).rgb;
    t = abs( C - Cright );
    delta.z = max(max(t.r, t.g), t.b);

    vec3 Cbottom  = texture2D(colorTex, offset[1].zw).rgb;
    t = abs(C - Cbottom);
    delta.w = max(max(t.r, t.g), t.b);

    // Calculate the maximum delta in the direct neighborhood:
    float maxDelta = max(max(max(delta.x, delta.y), delta.z), delta.w );

    // Calculate left-left and top-top deltas:
    vec3 Cleftleft  = texture2D(colorTex, offset[2].xy).rgb;
    t = abs( C - Cleftleft );
    delta.z = max(max(t.r, t.g), t.b);

    vec3 Ctoptop = texture2D(colorTex, offset[2].zw).rgb;
    t = abs(C - Ctoptop);
    delta.w = max(max(t.r, t.g), t.b);

    // Calculate the final maximum delta:
    maxDelta = max(max(maxDelta, delta.z), delta.w);

    // Local contrast adaptation in action:
    edges.xy *= step(0.5 * maxDelta, delta.xy);

    return vec4(edges, 0.0, 0.0);
}

void main() {
    gl_FragColor = SMAAColorEdgeDetectionPS(vUv, vOffset, tColor);
}
`,YFe={edgeThreshold:M.Numeric(.1,{min:.05,max:.15,step:.01}),maxSearchSteps:M.Numeric(16,{min:0,max:32,step:1})},KFe=function(){function e(t,r){if(this.webgl=t,this._supported=!1,typeof HTMLImageElement>"u"){Fr&&console.log('Missing "HTMLImageElement" required for "SMAA"');return}var n=r.getWidth(),a=r.getHeight();this.edgesTarget=t.createRenderTarget(n,a,!1,"uint8","linear"),this.weightsTarget=t.createRenderTarget(n,a,!1,"uint8","linear"),this.edgesRenderable=ZFe(t,r),this.weightsRenderable=tLe(t,this.edgesTarget.texture),this.blendRenderable=aLe(t,r,this.weightsTarget.texture),this._supported=!0}return Object.defineProperty(e.prototype,"supported",{get:function(){return this._supported},enumerable:!1,configurable:!0}),e.prototype.updateState=function(t){var r=this.webgl,n=r.gl,a=r.state;a.enable(n.SCISSOR_TEST),a.disable(n.BLEND),a.disable(n.DEPTH_TEST),a.depthMask(!1);var i=t.x,o=t.y,s=t.width,u=t.height;n.viewport(i,o,s,u),n.scissor(i,o,s,u),a.clearColor(0,0,0,1),n.clear(n.COLOR_BUFFER_BIT),N.update(this.edgesRenderable.values.uViewport,ai.toVec4(this.edgesRenderable.values.uViewport.ref.value,t)),N.update(this.weightsRenderable.values.uViewport,ai.toVec4(this.weightsRenderable.values.uViewport.ref.value,t)),N.update(this.blendRenderable.values.uViewport,ai.toVec4(this.blendRenderable.values.uViewport.ref.value,t))},e.prototype.setSize=function(t,r){var n=this.edgesTarget.getWidth(),a=this.edgesTarget.getHeight();(t!==n||r!==a)&&(this.edgesTarget.setSize(t,r),this.weightsTarget.setSize(t,r),N.update(this.edgesRenderable.values.uTexSizeInv,Xe.set(this.edgesRenderable.values.uTexSizeInv.ref.value,1/t,1/r)),N.update(this.weightsRenderable.values.uTexSizeInv,Xe.set(this.weightsRenderable.values.uTexSizeInv.ref.value,1/t,1/r)),N.update(this.blendRenderable.values.uTexSizeInv,Xe.set(this.blendRenderable.values.uTexSizeInv.ref.value,1/t,1/r)))},e.prototype.update=function(t,r){var n=!1;this.edgesRenderable.values.tColor.ref.value!==t&&(N.update(this.edgesRenderable.values.tColor,t),n=!0),this.edgesRenderable.values.dEdgeThreshold.ref.value!==r.edgeThreshold&&(N.update(this.edgesRenderable.values.dEdgeThreshold,r.edgeThreshold),n=!0),n&&this.edgesRenderable.update(),this.weightsRenderable.values.dMaxSearchSteps.ref.value!==r.maxSearchSteps&&(N.update(this.weightsRenderable.values.dMaxSearchSteps,r.maxSearchSteps),this.weightsRenderable.update()),this.blendRenderable.values.tColor.ref.value!==t&&(N.update(this.blendRenderable.values.tColor,t),this.blendRenderable.update())},e.prototype.render=function(t,r){this.edgesTarget.bind(),this.updateState(t),this.edgesRenderable.render(),this.weightsTarget.bind(),this.updateState(t),this.weightsRenderable.render(),r?r.bind():this.webgl.unbindFramebuffer(),this.updateState(t),this.blendRenderable.render()},e}(),$Fe=T(T({},Ni),{tColor:hr("texture","rgba","ubyte","linear"),uTexSizeInv:Ye("v2"),uViewport:Ye("v4"),dEdgeThreshold:nr("number")}),QFe=Wn("smaa-edges",WFe,XFe);function ZFe(e,t){var r=t.getWidth(),n=t.getHeight(),a=T(T({},zi),{tColor:N.create(t),uTexSizeInv:N.create(Xe.create(1/r,1/n)),uViewport:N.create(Mr()),dEdgeThreshold:N.create(.1)}),i=T({},$Fe),o=li(e,"triangles",QFe,i,a);return ui(o,a)}var JFe=T(T({},Ni),{tEdges:hr("texture","rgba","ubyte","linear"),tArea:hr("texture","rgb","ubyte","linear"),tSearch:hr("texture","rgba","ubyte","nearest"),uTexSizeInv:Ye("v2"),uViewport:Ye("v4"),dMaxSearchSteps:nr("number")}),eLe=Wn("smaa-weights",GFe,qFe);function tLe(e,t){var r=t.getWidth(),n=t.getHeight(),a=d5(e.gl,e.extensions,"image-uint8","rgb","ubyte","linear"),i=d5(e.gl,e.extensions,"image-uint8","rgba","ubyte","nearest"),o=T(T({},zi),{tEdges:N.create(t),tArea:N.create(a),tSearch:N.create(i),uTexSizeInv:N.create(Xe.create(1/r,1/n)),uViewport:N.create(Mr()),dMaxSearchSteps:N.create(8)});xL(iLe(),o.tArea,a),xL(oLe(),o.tSearch,i);var s=T({},JFe),u=li(e,"triangles",eLe,s,o);return ui(u,o)}var rLe=T(T({},Ni),{tColor:hr("texture","rgba","ubyte","linear"),tWeights:hr("texture","rgba","ubyte","linear"),uTexSizeInv:Ye("v2"),uViewport:Ye("v4")}),nLe=Wn("smaa-blend",HFe,jFe);function aLe(e,t,r){var n=t.getWidth(),a=t.getHeight(),i=T(T({},zi),{tColor:N.create(t),tWeights:N.create(r),uTexSizeInv:N.create(Xe.create(1/n,1/a)),uViewport:N.create(Mr())}),o=T({},rLe),s=li(e,"triangles",nLe,o,i);return ui(s,i)}function iLe(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKAAAAIwCAIAAACOVPcQAACBeklEQVR42u39W4xlWXrnh/3WWvuciIzMrKxrV8/0rWbY0+SQFKcb4owIkSIFCjY9AC1BT/LYBozRi+EX+cV+8IMsYAaCwRcBwjzMiw2jAWtgwC8WR5Q8mDFHZLNHTarZGrLJJllt1W2qKrsumZWZcTvn7L3W54e1vrXX3vuciLPPORFR1XE2EomorB0nVuz//r71re/y/1eMvb4Cb3N11xV/PP/2v4UBAwJG/7H8urx6/25/Gf8O5hypMQ0EEEQwAqLfoN/Z+97f/SW+/NvcgQk4sGBJK6H7N4PFVL+K+e0N11yNfkKvwUdwdlUAXPHHL38oa15f/i/46Ih6SuMSPmLAYAwyRKn7dfMGH97jaMFBYCJUgotIC2YAdu+LyW9vvubxAP8kAL8H/koAuOKP3+q6+xGnd5kdYCeECnGIJViwGJMAkQKfDvB3WZxjLKGh8VSCCzhwEWBpMc5/kBbjawT4HnwJfhr+pPBIu7uu+OOTo9vsmtQcniMBGkKFd4jDWMSCRUpLjJYNJkM+IRzQ+PQvIeAMTrBS2LEiaiR9b/5PuT6Ap/AcfAFO4Y3dA3DFH7/VS+M8k4baEAQfMI4QfbVDDGIRg7GKaIY52qAjTAgTvGBAPGIIghOCYAUrGFNgzA7Q3QhgCwfwAnwe5vDejgG44o/fbm1C5ZlYQvQDARPAIQGxCWBM+wWl37ZQESb4gImexGMDouhGLx1Cst0Saa4b4AqO4Hk4gxo+3DHAV/nx27p3JziPM2pVgoiia5MdEzCGULprIN7gEEeQ5IQxEBBBQnxhsDb5auGmAAYcHMA9eAAz8PBol8/xij9+C4Djlim4gJjWcwZBhCBgMIIYxGAVIkH3ZtcBuLdtRFMWsPGoY9rN+HoBji9VBYdwD2ZQg4cnO7OSq/z4rU5KKdwVbFAjNojCQzTlCLPFSxtamwh2jMUcEgg2Wm/6XgErIBhBckQtGN3CzbVacERgCnfgLswhnvqf7QyAq/z4rRZm1YglYE3affGITaZsdIe2FmMIpnOCap25I6jt2kCwCW0D1uAD9sZctNGXcQIHCkINDQgc78aCr+zjtw3BU/ijdpw3zhCwcaONwBvdeS2YZKkJNJsMPf2JKEvC28RXxxI0ASJyzQCjCEQrO4Q7sFArEzjZhaFc4cdv+/JFdKULM4px0DfUBI2hIsy06BqLhGTQEVdbfAIZXYMPesq6VoCHICzUyjwInO4Y411//LYLs6TDa9wvg2CC2rElgAnpTBziThxaL22MYhzfkghz6GAs2VHbbdM91VZu1MEEpupMMwKyVTb5ij9+u4VJG/5EgEMMmFF01cFai3isRbKbzb+YaU/MQbAm2XSMoUPAmvZzbuKYRIFApbtlrfFuUGd6vq2hXNnH78ZLh/iFhsQG3T4D1ib7k5CC6vY0DCbtrohgLEIClXiGtl10zc0CnEGIhhatLBva7NP58Tvw0qE8yWhARLQ8h4+AhQSP+I4F5xoU+VilGRJs6wnS7ruti/4KvAY/CfdgqjsMy4pf8fodQO8/gnuX3f/3xi3om1/h7THr+co3x93PP9+FBUfbNUjcjEmhcrkT+8K7ml7V10Jo05mpIEFy1NmCJWx9SIKKt+EjAL4Ez8EBVOB6havuT/rByPvHXK+9zUcfcbb254+9fydJknYnRr1oGfdaiAgpxu1Rx/Rek8KISftx3L+DfsLWAANn8Hvw0/AFeAGO9DFV3c6D+CcWbL8Dj9e7f+T1k8AZv/d7+PXWM/Z+VvdCrIvuAKO09RpEEQJM0Ci6+B4xhTWr4cZNOvhktabw0ta0rSJmqz3Yw5/AKXwenod7cAhTmBSPKf6JBdvH8IP17h95pXqw50/+BFnj88fev4NchyaK47OPhhtI8RFSvAfDSNh0Ck0p2gLxGkib5NJj/JWCr90EWQJvwBzO4AHcgztwAFN1evHPUVGwfXON+0debT1YeGON9Yy9/63X+OguiwmhIhQhD7l4sMqlG3D86Suc3qWZ4rWjI1X7u0Ytw6x3rIMeIOPDprfe2XzNgyj6PahhBjO4C3e6puDgXrdg+/5l948vF3bqwZetZ+z9Rx9zdIY5pInPK4Nk0t+l52xdK2B45Qd87nM8fsD5EfUhIcJcERw4RdqqH7Yde5V7m1vhNmtedkz6EDzUMF/2jJYWbC+4fzzA/Y+/8PPH3j9dcBAPIRP8JLXd5BpAu03aziOL3VVHZzz3CXWDPWd+SH2AnxIqQoTZpo9Ckc6HIrFbAbzNmlcg8Ag8NFDDAhbJvTBZXbC94P7t68EXfv6o+21gUtPETU7bbkLxvNKRFG2+KXzvtObonPP4rBvsgmaKj404DlshFole1Glfh02fE7bYR7dZ82oTewIBGn1Md6CG6YUF26X376oevOLzx95vhUmgblI6LBZwTCDY7vMq0op5WVXgsObOXJ+1x3qaBl9j1FeLxbhU9w1F+Wiba6s1X/TBz1LnUfuYDi4r2C69f1f14BWfP+p+W2GFKuC9phcELMYRRLur9DEZTUdEH+iEqWdaM7X4WOoPGI+ZYD2+wcQ+y+ioHUZ9dTDbArzxmi/bJI9BND0Ynd6lBdve/butBw8+f/T9D3ABa3AG8W3VPX4hBin+bj8dMMmSpp5pg7fJ6xrBFE2WQQEWnV8Qg3FbAWzYfM1rREEnmvkN2o1+acG2d/9u68GDzx91v3mAjb1zkpqT21OipPKO0b9TO5W0nTdOmAQm0TObts3aBKgwARtoPDiCT0gHgwnbArzxmtcLc08HgF1asN0C4Ms/fvD5I+7PhfqyXE/b7RbbrGyRQRT9ARZcwAUmgdoz0ehJ9Fn7QAhUjhDAQSw0bV3T3WbNa59jzmiP6GsWbGXDX2ytjy8+f9T97fiBPq9YeLdBmyuizZHaqXITnXiMUEEVcJ7K4j3BFPurtB4bixW8wTpweL8DC95szWMOqucFYGsWbGU7p3TxxxefP+r+oTVktxY0v5hbq3KiOKYnY8ddJVSBxuMMVffNbxwIOERShst73HZ78DZrHpmJmH3K6sGz0fe3UUj0eyRrSCGTTc+rjVNoGzNSv05srAxUBh8IhqChiQgVNIIBH3AVPnrsnXQZbLTm8ammv8eVXn/vWpaTem5IXRlt+U/LA21zhSb9cye6jcOfCnOwhIAYXAMVTUNV0QhVha9xjgA27ODJbLbmitt3tRN80lqG6N/khgot4ZVlOyO4WNg3OIMzhIZQpUEHieg2im6F91hB3I2tubql6BYNN9Hj5S7G0G2tahslBWKDnOiIvuAEDzakDQKDNFQT6gbn8E2y4BBubM230YIpBnDbMa+y3dx0n1S0BtuG62lCCXwcY0F72T1VRR3t2ONcsmDjbmzNt9RFs2LO2hQNyb022JisaI8rAWuw4HI3FuAIhZdOGIcdjLJvvObqlpqvWTJnnQbyi/1M9O8UxWhBs//H42I0q1Yb/XPGONzcmm+ri172mHKvZBpHkJaNJz6v9jxqiklDj3U4CA2ugpAaYMWqNXsdXbmJNd9egCnJEsphXNM+MnK3m0FCJ5S1kmJpa3DgPVbnQnPGWIDspW9ozbcO4K/9LkfaQO2KHuqlfFXSbdNzcEcwoqNEFE9zcIXu9/6n/ym/BC/C3aJLzEKPuYVlbFnfhZ8kcWxV3dbv4bKl28566wD+8C53aw49lTABp9PWbsB+knfc/Li3eVizf5vv/xmvnPKg5ihwKEwlrcHqucuVcVOxEv8aH37E3ZqpZypUulrHEtIWKUr+txHg+ojZDGlwnqmkGlzcVi1dLiNSJiHjfbRNOPwKpx9TVdTn3K05DBx4psIk4Ei8aCkJahRgffk4YnEXe07T4H2RR1u27E6wfQsBDofUgjFUFnwC2AiVtA+05J2zpiDK2Oa0c5fmAecN1iJzmpqFZxqYBCYhFTCsUNEmUnIcZ6aEA5rQVhEywG6w7HSW02XfOoBlQmjwulOFQAg66SvJblrTEX1YtJ3uG15T/BH1OfOQeuR8g/c0gdpT5fx2SKbs9EfHTKdM8A1GaJRHLVIwhcGyydZsbifAFVKl5EMKNU2Hryo+06BeTgqnxzYjThVySDikbtJPieco75lYfKAJOMEZBTjoITuWHXXZVhcUDIS2hpiXHV9Ku4u44bN5OYLDOkJo8w+xJSMbhBRHEdEs9JZUCkQrPMAvaHyLkxgkEHxiNkx/x2YB0mGsQ8EUWj/stW5YLhtS5SMu+/YBbNPDCkGTUybN8krRLBGPlZkVOA0j+a1+rkyQKWGaPHPLZOkJhioQYnVZ2hS3zVxMtgC46KuRwbJNd9nV2PHgb36F194ecf/Yeu2vAFe5nm/bRBFrnY4BauE8ERmZRFUn0k8hbftiVYSKMEme2dJCJSCGYAlNqh87bXOPdUkGy24P6d1ll21MBqqx48Fvv8ZHH8HZFY7j/uAq1xMJUFqCSUlJPmNbIiNsmwuMs/q9CMtsZsFO6SprzCS1Z7QL8xCQClEelpjTduDMsmWD8S1PT152BtvmIGvUeDA/yRn83u/x0/4qxoPHjx+PXY9pqX9bgMvh/Nz9kpP4pOe1/fYf3axUiMdHLlPpZCNjgtNFAhcHEDxTumNONhHrBduW+vOyY++70WWnPXj98eA4kOt/mj/5E05l9+O4o8ePx67HFqyC+qSSnyselqjZGaVK2TadbFLPWAQ4NBhHqDCCV7OTpo34AlSSylPtIdd2AJZlyzYQrDJ5lcWGNceD80CunPLGGzsfD+7wRb95NevJI5docQ3tgCyr5bGnyaPRlmwNsFELViOOx9loebGNq2moDOKpHLVP5al2cymWHbkfzGXL7kfRl44H9wZy33tvt+PB/Xnf93e+nh5ZlU18wCiRUa9m7kib9LYuOk+hudQNbxwm0AQqbfloimaB2lM5fChex+ylMwuTbfmXQtmWlenZljbdXTLuOxjI/fDDHY4Hjx8/Hrse0zXfPFxbUN1kKqSCCSk50m0Ajtx3ub9XHBKHXESb8iO6E+qGytF4nO0OG3SXzbJlhxBnKtKyl0NwybjvYCD30aMdjgePHz8eu56SVTBbgxJMliQ3Oauwg0QHxXE2Ez/EIReLdQj42Gzb4CLS0YJD9xUx7bsi0vJi5mUbW1QzL0h0PFk17rtiIPfJk52MB48fPx67npJJwyrBa2RCCQRTbGZSPCxTPOiND4G2pYyOQ4h4jINIJh5wFU1NFZt+IsZ59LSnDqBjZ2awbOku+yInunLcd8VA7rNnOxkPHj9+PGY9B0MWJJNozOJmlglvDMXDEozdhQWbgs/U6oBanGzLrdSNNnZFjOkmbi5bNt1lX7JLLhn3vXAg9/h4y/Hg8ePHI9dzQMEkWCgdRfYykYKnkP7D4rIujsujaKPBsB54vE2TS00ccvFY/Tth7JXeq1hz+qgVy04sAJawTsvOknHfCwdyT062HA8eP348Zj0vdoXF4pilKa2BROed+9fyw9rWRXeTFXESMOanvDZfJuJaSXouQdMdDJZtekZcLLvEeK04d8m474UDuaenW44Hjx8/Xns9YYqZpszGWB3AN/4VHw+k7WSFtJ3Qicuqb/NlVmgXWsxh570xg2UwxUw3WfO6B5nOuO8aA7lnZxuPB48fPx6znm1i4bsfcbaptF3zNT78eFPtwi1OaCNOqp1x3zUGcs/PN++AGD1+fMXrSVm2baTtPhPahbPhA71wIHd2bXzRa69nG+3CraTtPivahV/55tXWg8fyRY/9AdsY8VbSdp8V7cKrrgdfM//z6ILQFtJ2nxHtwmuoB4/kf74+gLeRtvvMaBdeSz34+vifx0YG20jbfTa0C6+tHrwe//NmOG0L8EbSdp8R7cLrrQe/996O+ai3ujQOskpTNULa7jOjXXj99eCd8lHvoFiwsbTdZ0a78PrrwTvlo966pLuRtB2fFe3Cm6oHP9kNH/W2FryxtN1nTLvwRurBO+Kj3pWXHidtx2dFu/Bm68Fb81HvykuPlrb7LGkX3mw9eGs+6h1Y8MbSdjegXcguQLjmevDpTQLMxtJ2N6NdyBZu9AbrwVvwUW+LbteULUpCdqm0HTelXbhNPe8G68Gb8lFvVfYfSNuxvrTdTWoXbozAzdaDZzfkorOj1oxVxlIMlpSIlpLrt8D4hrQL17z+c3h6hU/wv4Q/utps4+bm+6P/hIcf0JwQ5oQGPBL0eKPTYEXTW+eL/2DKn73J9BTXYANG57hz1cEMviVf/4tf5b/6C5pTQkMIWoAq7hTpOJjtAM4pxKu5vg5vXeUrtI09/Mo/5H+4z+Mp5xULh7cEm2QbRP2tFIKR7WM3fPf/jZ3SWCqLM2l4NxID5zB72HQXv3jj/8mLR5xXNA5v8EbFQEz7PpRfl1+MB/hlAN65qgDn3wTgH13hK7T59bmP+NIx1SHHU84nLOITt3iVz8mNO+lPrjGAnBFqmioNn1mTyk1ta47R6d4MrX7tjrnjYUpdUbv2rVr6YpVfsGG58AG8Ah9eyUN8CX4WfgV+G8LVWPDGb+Zd4cU584CtqSbMKxauxTg+dyn/LkVgA+IR8KHtejeFKRtTmLLpxN6mYVLjYxwXf5x2VofiZcp/lwKk4wGOpYDnoIZPdg/AAbwMfx0+ge9dgZvYjuqKe4HnGnykYo5TvJbG0Vj12JagRhwKa44H95ShkZa5RyLGGdfYvG7aw1TsF6iapPAS29mNS3NmsTQZCmgTzFwgL3upCTgtBTRwvGMAKrgLn4evwin8+afJRcff+8izUGUM63GOOuAs3tJkw7J4kyoNreqrpO6cYLQeFUd7TTpr5YOTLc9RUUogUOVJQ1GYJaFLAW0oTmKyYS46ZooP4S4EON3xQ5zC8/CX4CnM4c1PE8ApexpoYuzqlP3d4S3OJP8ZDK7cKWNaTlqmgDiiHwl1YsE41w1zT4iRTm3DBqxvOUsbMKKDa/EHxagtnta072ejc3DOIh5ojvh8l3tk1JF/AV6FU6jh3U8HwEazLgdCLYSQ+MYiAI2ltomkzttUb0gGHdSUUgsIYjTzLG3mObX4FBRaYtpDVNZrih9TgTeYOBxsEnN1gOCTM8Bsw/ieMc75w9kuAT6A+/AiHGvN/+Gn4KRkiuzpNNDYhDGFndWRpE6SVfm8U5bxnSgVV2jrg6JCKmneqey8VMFgq2+AM/i4L4RUbfSi27lNXZ7R7W9RTcq/q9fk4Xw3AMQd4I5ifAZz8FcVtm9SAom/dyN4lczJQW/kC42ZrHgcCoIf1oVMKkVItmMBi9cOeNHGLqOZk+QqQmrbc5YmYgxELUUN35z2iohstgfLIFmcMV7s4CFmI74L9+EFmGsi+tGnAOD4Yk9gIpo01Y4cA43BWGygMdr4YZekG3OBIUXXNukvJS8tqa06e+lSDCtnqqMFu6hWHXCF+WaYt64m9QBmNxi7Ioy7D+fa1yHw+FMAcPt7SysFLtoG4PXAk7JOA3aAxBRqUiAdU9Yp5lK3HLSRFtOim0sa8euEt08xvKjYjzeJ2GU7YawexrnKI9tmobInjFXCewpwriY9+RR4aaezFhMhGCppKwom0ChrgFlKzyPKkGlTW1YQrE9HJqu8hKGgMc6hVi5QRq0PZxNfrYNgE64utmRv6KKHRpxf6VDUaOvNP5jCEx5q185My/7RKz69UQu2im5k4/eownpxZxNLwiZ1AZTO2ZjWjkU9uaB2HFn6Q3u0JcsSx/qV9hTEApRzeBLDJQXxYmTnq7bdLa3+uqFrxLJ5w1TehnNHx5ECvCh2g2c3hHH5YsfdaSKddztfjQ6imKFGSyFwlLzxEGPp6r5IevVjk1AMx3wMqi1NxDVjLBiPs9tbsCkIY5we5/ML22zrCScFxnNtzsr9Wcc3CnD+pYO+4VXXiDE0oc/vQQ/fDK3oPESJMYXNmJa/DuloJZkcTpcYE8lIH8Dz8DJMiynNC86Mb2lNaaqP/+L7f2fcE/yP7/Lde8xfgSOdMxvOixZf/9p3+M4hT1+F+zApxg9XfUvYjc8qX2lfOOpK2gNRtB4flpFu9FTKCp2XJRgXnX6olp1zyYjTKJSkGmLE2NjUr1bxFM4AeAAHBUFIeSLqXR+NvH/M9fOnfHzOD2vCSyQJKzfgsCh+yi/Mmc35F2fUrw7miW33W9hBD1vpuUojFphIyvg7aTeoymDkIkeW3XLHmguMzbIAJejN6B5MDrhipE2y6SoFRO/AK/AcHHZHNIfiWrEe/C6cr3f/yOvrQKB+zMM55/GQdLDsR+ifr5Fiuu+/y+M78LzOE5dsNuXC3PYvYWd8NXvphLSkJIasrlD2/HOqQ+RjcRdjKTGWYhhVUm4yxlyiGPuMsZR7sMCHUBeTuNWA7if+ifXgc/hovftHXs/DV+Fvwe+f8shzMiMcweFgBly3//vwJfg5AN4450fn1Hd1Rm1aBLu22Dy3y3H2+OqMemkbGZ4jozcDjJf6596xOLpC0eMTHbKnxLxH27uZ/bMTGs2jOaMOY4m87CfQwF0dw53oa1k80JRuz/XgS+8fX3N9Af4qPIMfzKgCp4H5TDGe9GGeFPzSsZz80SlPTxXjgwJmC45njzgt2vbQ4b4OAdUK4/vWhO8d8v6EE8fMUsfakXbPpFJeLs2ubM/qdm/la3WP91uWhxXHjoWhyRUq2iJ/+5mA73zwIIo+LoZ/SgvIRjAd1IMvvn98PfgOvAJfhhm8scAKVWDuaRaK8aQ9f7vuPDH6Bj47ZXau7rqYJ66mTDwEDU6lLbCjCK0qTXyl5mnDoeNRxanj3FJbaksTk0faXxHxLrssgPkWB9LnA/MFleXcJozzjwsUvUG0X/QCve51qkMDXp9mtcyOy3rwBfdvVJK7D6/ACSzg3RoruIq5UDeESfEmVclDxnniU82vxMLtceD0hGZWzBNPMM/jSPne2OVatiTKUpY5vY7gc0LdUAWeWM5tH+O2I66AOWw9xT2BuyRVLGdoDHUsVRXOo/c+ZdRXvFfnxWyIV4upFLCl9eAL7h8Zv0QH8Ry8pA2cHzQpGesctVA37ZtklBTgHjyvdSeKY/RZw/kJMk0Y25cSNRWSigQtlULPTw+kzuJPeYEkXjQRpoGZobYsLF79pyd1dMRHInbgFTZqNLhDqiIsTNpoex2WLcy0/X6rHcdMMQvFSd5dWA++4P7xv89deACnmr36uGlL69bRCL6BSZsS6c0TU2TKK5gtWCzgAOOwQcurqk9j8whvziZSMLcq5hbuwBEsYjopUBkqw1yYBGpLA97SRElEmx5MCInBY5vgLk94iKqSWmhIGmkJ4Bi9m4L645J68LyY4wsFYBfUg5feP/6gWWm58IEmKQM89hq7KsZNaKtP5TxxrUZZVkNmMJtjbKrGxLNEbHPJxhqy7lAmbC32ZqeF6lTaknRWcYaFpfLUBh/rwaQycCCJmW15Kstv6jRHyJFry2C1ahkkIW0LO75s61+owxK1y3XqweX9m5YLM2DPFeOjn/iiqCKJ+yKXF8t5Yl/kNsqaSCryxPq5xWTFIaP8KSW0RYxqupaUf0RcTNSSdJZGcKYdYA6kdtrtmyBckfKXwqk0pHpUHlwWaffjNRBYFPUDWa8e3Lt/o0R0CdisKDM89cX0pvRHEfM8ca4t0s2Xx4kgo91MPQJ/0c9MQYq0co8MBh7bz1fio0UUHLR4aAIOvOmoYO6kwlEVODSSTliWtOtH6sPkrtctF9ZtJ9GIerBskvhdVS5cFNv9s1BU0AbdUgdK4FG+dRnjFmDTzniRMdZO1QhzMK355vigbdkpz9P6qjUGE5J2qAcXmwJ20cZUiAD0z+pGMx6xkzJkmEf40Hr4qZfVg2XzF9YOyoV5BjzVkUJngKf8lgNYwKECEHrCNDrWZzMlflS3yBhr/InyoUgBc/lKT4pxVrrC6g1YwcceK3BmNxZcAtz3j5EIpqguh9H6wc011YN75cKDLpFDxuwkrPQmUwW4KTbj9mZTwBwLq4aQMUZbHm1rylJ46dzR0dua2n3RYCWZsiHROeywyJGR7mXKlpryyCiouY56sFkBWEnkEB/raeh/Sw4162KeuAxMQpEkzy5alMY5wamMsWKKrtW2WpEWNnReZWONKWjrdsKZarpFjqCslq773PLmEhM448Pc3+FKr1+94vv/rfw4tEcu+lKTBe4kZSdijBrykwv9vbCMPcLQTygBjzVckSLPRVGslqdunwJ4oegtFOYb4SwxNgWLCmD7T9kVjTv5YDgpo0XBmN34Z/rEHp0sgyz7lngsrm4lvMm2Mr1zNOJYJ5cuxuQxwMGJq/TP5emlb8fsQBZviK4t8hFL+zbhtlpwaRSxQRWfeETjuauPsdGxsBVdO7nmP4xvzSoT29pRl7kGqz+k26B3Oy0YNV+SXbbQas1ctC/GarskRdFpKczVAF1ZXnLcpaMuzVe6lZ2g/1ndcvOVgRG3sdUAY1bKD6achijMPdMxV4muKVorSpiDHituH7rSTs7n/4y5DhRXo4FVBN4vO/zbAcxhENzGbHCzU/98Mcx5e7a31kWjw9FCe/zNeYyQjZsWb1uc7U33pN4Mji6hCLhivqfa9Ss6xLg031AgfesA/l99m9fgvnaF9JoE6bYKmkGNK3aPbHB96w3+DnxFm4hs0drLsk7U8kf/N/CvwQNtllna0rjq61sH8L80HAuvwH1tvBy2ChqWSCaYTaGN19sTvlfzFD6n+iKTbvtayfrfe9ueWh6GJFoxLdr7V72a5ZpvHcCPDzma0wTO4EgbLyedxstO81n57LYBOBzyfsOhUKsW1J1BB5vr/tz8RyqOFylQP9Tvst2JALsC5lsH8PyQ40DV4ANzYa4dedNiKNR1s+x2wwbR7q4/4cTxqEk4LWDebfisuo36JXLiWFjOtLrlNWh3K1rRS4xvHcDNlFnNmWBBAl5SWaL3oPOfnvbr5pdjVnEaeBJSYjuLEkyLLsWhKccadmOphZkOPgVdalj2QpSmfOsADhMWE2ZBu4+EEJI4wKTAuCoC4xwQbWXBltpxbjkXJtKxxabo9e7tyhlgb6gNlSbUpMh+l/FaqzVwewGu8BW1Zx7pTpQDJUjb8tsUTW6+GDXbMn3mLbXlXJiGdggxFAoUrtPS3wE4Nk02UZG2OOzlk7fRs7i95QCLo3E0jtrjnM7SR3uS1p4qtS2nJ5OwtQVHgOvArLBFijZUV9QtSl8dAY5d0E0hM0w3HS2DpIeB6m/A1+HfhJcGUq4sOxH+x3f5+VO+Ds9rYNI7zPXOYWPrtf8bYMx6fuOAX5jzNR0PdsuON+X1f7EERxMJJoU6GkTEWBvVolVlb5lh3tKCg6Wx1IbaMDdJ+9sUCc5KC46hKGCk3IVOS4TCqdBNfUs7Kd4iXf2RjnT/LLysJy3XDcHLh/vde3x8DoGvwgsa67vBk91G5Pe/HbOe7xwym0NXbtiuuDkGO2IJDh9oQvJ4cY4vdoqLDuoH9Zl2F/ofsekn8lkuhIlhQcffUtSjytFyp++p6NiE7Rqx/lodgKVoceEp/CP4FfjrquZaTtj2AvH5K/ywpn7M34K/SsoYDAdIN448I1/0/wveW289T1/lX5xBzc8N5IaHr0XMOQdHsIkDuJFifj20pBm5jzwUv9e2FhwRsvhAbalCIuIw3bhJihY3p6nTFFIZgiSYjfTf3aXuOjmeGn4bPoGvwl+CFzTRczBIuHBEeImHc37/lGfwZR0cXzVDOvaKfNHvwe+suZ771K/y/XcBlsoN996JpBhoE2toYxOznNEOS5TJc6Id5GEXLjrWo+LEWGNpPDU4WAwsIRROu+1vM+0oW37z/MBN9kqHnSArwPfgFJ7Cq/Ai3Ie7g7ncmI09v8sjzw9mzOAEXoIHxURueaAce5V80f/DOuuZwHM8vsMb5wBzOFWM7wymTXPAEvm4vcFpZ2ut0VZRjkiP2MlmLd6DIpbGSiHOjdnUHN90hRYmhTnmvhzp1iKDNj+b7t5hi79lWGwQ+HN9RsfFMy0FXbEwhfuczKgCbyxYwBmcFhhvo/7a44v+i3XWcwDP86PzpGQYdWh7csP5dBvZ1jNzdxC8pBGuxqSW5vw40nBpj5JhMwvOzN0RWqERHMr4Lv1kWX84xLR830G3j6yqZ1a8UstTlW+qJPOZ+sZ7xZPKTJLhiNOAFd6tk+jrTH31ncLOxid8+nzRb128HhUcru/y0Wn6iT254YPC6FtVSIMoW2sk727AhvTtrWKZTvgsmckfXYZWeNRXx/3YQ2OUxLDrbHtN11IwrgXT6c8dATDwLniYwxzO4RzuQqTKSC5gAofMZ1QBK3zQ4JWobFbcvJm87FK+6JXrKahLn54m3p+McXzzYtP8VF/QpJuh1OwieElEoI1pRxPS09FBrkq2tWCU59+HdhNtTIqKm8EBrw2RTOEDpG3IKo2Y7mFdLm3ZeVjYwVw11o/oznceMve4CgMfNym/utA/d/ILMR7gpXzRy9eDsgLcgbs8O2Va1L0zzIdwGGemTBuwROHeoMShkUc7P+ISY3KH5ZZeWqO8mFTxQYeXTNuzvvK5FGPdQfuu00DwYFY9dyhctEt+OJDdnucfpmyhzUJzfsJjr29l8S0bXBfwRS9ZT26tmMIdZucch5ZboMz3Nio3nIOsYHCGoDT4kUA9MiXEp9Xsui1S8th/kbWIrMBxDGLodWUQIWcvnXy+9M23xPiSMOiRPqM+YMXkUN3gXFrZJwXGzUaMpJfyRS9ZT0lPe8TpScuRlbMHeUmlaKDoNuy62iWNTWNFYjoxFzuJs8oR+RhRx7O4SVNSXpa0ZJQ0K1LAHDQ+D9IepkMXpcsq5EVCvClBUIzDhDoyKwDw1Lc59GbTeORivugw1IcuaEOaGWdNm+Ps5fQ7/tm0DjMegq3yM3vb5j12qUId5UZD2oxDSEWOZMSqFl/W+5oynWDa/aI04tJRQ2eTXusg86SQVu/nwSYwpW6wLjlqIzwLuxGIvoAvul0PS+ZNz0/akp/pniO/8JDnGyaCkzbhl6YcqmK/69prxPqtpx2+Km9al9sjL+rwMgHw4jE/C8/HQ3m1vBuL1fldbzd8mOueVJ92syqdEY4KJjSCde3mcRw2TA6szxedn+zwhZMps0XrqEsiUjnC1hw0TELC2Ek7uAAdzcheXv1BYLagspxpzSAoZZUsIzIq35MnFQ9DOrlNB30jq3L4pkhccKUAA8/ocvN1Rzx9QyOtERs4CVsJRK/DF71kPYrxYsGsm6RMh4cps5g1DOmM54Ly1ii0Hd3Y/BMk8VWFgBVmhqrkJCPBHAolwZaWzLR9Vb7bcWdX9NyUYE+uB2BKfuaeBUcjDljbYVY4DdtsVWvzRZdWnyUzDpjNl1Du3aloAjVJTNDpcIOVVhrHFF66lLfJL1zJr9PQ2nFJSBaKoDe+sAvLufZVHVzYh7W0h/c6AAZ+7Tvj6q9j68G/cTCS/3n1vLKHZwNi+P+pS0WkZNMBMUl+LDLuiE4omZy71r3UFMwNJV+VJ/GC5ixVUkBStsT4gGKh0Gm4Oy3qvq7Lbmq24nPdDuDR9deR11XzP4vFu3TYzfnIyiSVmgizUYGqkIXNdKTY9pgb9D2Ix5t0+NHkVzCdU03suWkkVZAoCONCn0T35gAeW38de43mf97sMOpSvj4aa1KYUm58USI7Wxxes03bAZdRzk6UtbzMaCQ6IxO0dy7X+XsjoD16hpsBeGz9dfzHj+R/Hp8nCxZRqkEDTaCKCSywjiaoMJ1TITE9eg7Jqnq8HL6gDwiZb0u0V0Rr/rmvqjxKuaLCX7ZWXTvAY+uvm3z8CP7nzVpngqrJpZKwWnCUjIviYVlirlGOzPLI3SMVyp/elvBUjjDkNhrtufFFErQ8pmdSlbK16toBHlt/HV8uHMX/vEGALkV3RJREiSlopxwdMXOZPLZ+ix+kAHpMKIk8UtE1ygtquttwxNhphrIZ1IBzjGF3IIGxGcBj6q8bHJBG8T9vdsoWrTFEuebEZuVxhhClH6P5Zo89OG9fwHNjtNQTpD0TG9PJLEYqvEY6Rlxy+ZZGfL0Aj62/bnQCXp//eeM4KzfQVJbgMQbUjlMFIm6TpcfWlZje7NBSV6IsEVmumWIbjiloUzQX9OzYdo8L1wjw2PrrpimONfmfNyzKklrgnEkSzT5QWYQW40YShyzqsRmMXbvVxKtGuYyMKaU1ugenLDm5Ily4iT14fP11Mx+xJv+zZ3MvnfdFqxU3a1W/FTB4m3Qfsyc1XUcdVhDeUDZXSFHHLQj/Y5jtC7ZqM0CXGwB4bP11i3LhOvzPGygYtiUBiwQV/4wFO0majijGsafHyRLu0yG6q35cL1rOpVxr2s5cM2jJYMCdc10Aj6q/blRpWJ//+dmm5psMl0KA2+AFRx9jMe2WbC4jQxnikd4DU8TwUjRVacgdlhmr3bpddzuJ9zXqr2xnxJfzP29RexdtjDVZqzkqa6PyvcojGrfkXiJ8SEtml/nYskicv0ivlxbqjemwUjMw5evdg8fUX9nOiC/lf94Q2i7MURk9nW1MSj5j8eAyV6y5CN2S6qbnw3vdA1Iwq+XOSCl663udN3IzLnrt+us25cI1+Z83SXQUldqQq0b5XOT17bGpLd6ssN1VMPf8c+jG8L3NeCnMdF+Ra3fRa9dft39/LuZ/3vwHoHrqGmQFafmiQw6eyzMxS05K4bL9uA+SKUQzCnSDkqOGokXyJvbgJ/BHI+qvY69//4rl20NsmK2ou2dTsyIALv/91/8n3P2Aao71WFGi8KKv1fRC5+J67Q/507/E/SOshqN5TsmYIjVt+kcjAx98iz/4SaojbIV1rexE7/C29HcYD/DX4a0rBOF5VTu7omsb11L/AWcVlcVZHSsqGuXLLp9ha8I//w3Mv+T4Ew7nTBsmgapoCrNFObIcN4pf/Ob/mrvHTGqqgAupL8qWjWPS9m/31jAe4DjA+4+uCoQoT/zOzlrNd3qd4SdphFxsUvYwGWbTWtISc3wNOWH+kHBMfc6kpmpwPgHWwqaSUG2ZWWheYOGQGaHB+eQ/kn6b3pOgLV+ODSn94wDvr8Bvb70/LLuiPPEr8OGVWfDmr45PZyccEmsVXZGe1pRNX9SU5+AVQkNTIVPCHF/jGmyDC9j4R9LfWcQvfiETmgMMUCMN1uNCakkweZsowdYobiMSlnKA93u7NzTXlSfe+SVbfnPQXmg9LpYAQxpwEtONyEyaueWM4FPjjyjG3uOaFmBTWDNgBXGEiQpsaWhnAqIijB07Dlsy3fUGeP989xbWkyf+FF2SNEtT1E0f4DYYVlxFlbaSMPIRMk/3iMU5pME2SIWJvjckciebkQuIRRyhUvkHg/iUljG5kzVog5hV7vIlCuBrmlhvgPfNHQM8lCf+FEGsYbMIBC0qC9a0uuy2wLXVbLBaP5kjHokCRxapkQyzI4QEcwgYHRZBp+XEFTqXFuNVzMtjXLJgX4gAid24Hjwc4N3dtVSe+NNiwTrzH4WVUOlDobUqr1FuAgYllc8pmzoVrELRHSIW8ViPxNy4xwjBpyR55I6J220qQTZYR4guvUICJiSpr9gFFle4RcF/OMB7BRiX8sSfhpNSO3lvEZCQfLUVTKT78Ek1LRLhWN+yLyTnp8qWUZ46b6vxdRGXfHVqx3eI75YaLa4iNNiK4NOW7wPW6lhbSOF9/M9qw8e/aoB3d156qTzxp8pXx5BKAsYSTOIIiPkp68GmTq7sZtvyzBQaRLNxIZ+paozHWoLFeExIhRBrWitHCAHrCF7/thhD8JhYz84wg93QRV88wLuLY8zF8sQ36qF1J455bOlgnELfshKVxYOXKVuKx0jaj22sczTQqPqtV/XDgpswmGTWWMSDw3ssyUunLLrVPGjYRsH5ggHeHSWiV8kT33ycFSfMgkoOK8apCye0J6VW6GOYvffgU9RWsukEi2kUV2nl4dOYUzRik9p7bcA4ggdJ53LxKcEe17B1R8eqAd7dOepV8sTXf5lhejoL85hUdhDdknPtKHFhljOT+bdq0hxbm35p2nc8+Ja1Iw+tJykgp0EWuAAZYwMVwac5KzYMslhvgHdHRrxKnvhTYcfKsxTxtTETkjHO7rr3zjoV25lAQHrqpV7bTiy2aXMmUhTBnKS91jhtR3GEoF0oLnWhWNnYgtcc4N0FxlcgT7yz3TgNIKkscx9jtV1ZKpWW+Ub1tc1eOv5ucdgpx+FJy9pgbLE7xDyXb/f+hLHVGeitHOi6A7ybo3sF8sS7w7cgdk0nJaOn3hLj3uyD0Zp5pazFIUXUpuTTU18d1EPkDoX8SkmWTnVIozEdbTcZjoqxhNHf1JrSS/AcvHjZ/SMHhL/7i5z+POsTUh/8BvNfYMTA8n+yU/MlTZxSJDRStqvEuLQKWwDctMTQogUDyQRoTQG5Kc6oQRE1yV1jCA7ri7jdZyK0sYTRjCR0Hnnd+y7nHxNgTULqw+8wj0mQKxpYvhjm9uSUxg+TTy7s2GtLUGcywhXSKZN275GsqlclX90J6bRI1aouxmgL7Q0Nen5ziM80SqMIo8cSOo+8XplT/5DHNWsSUr/6lLN/QQ3rDyzLruEW5enpf7KqZoShEduuSFOV7DLX7Ye+GmXb6/hnNNqKsVXuMDFpb9Y9eH3C6NGEzuOuI3gpMH/I6e+zDiH1fXi15t3vA1czsLws0TGEtmPEJdiiFPwlwKbgLHAFk4P6ZyPdymYYHGE0dutsChQBl2JcBFlrEkY/N5bQeXQ18gjunuMfMfsBlxJSx3niO485fwO4fGD5T/+3fPQqkneWVdwnw/3bMPkW9Wbqg+iC765Zk+xcT98ibKZc2EdgHcLoF8cSOo/Oc8fS+OyEULF4g4sJqXVcmfMfsc7A8v1/yfGXmL9I6Fn5pRwZhsPv0TxFNlAfZCvG+Oohi82UC5f/2IsJo0cTOm9YrDoKhFPEUr/LBYTUNht9zelHXDqwfPCIw4owp3mOcIQcLttWXFe3VZ/j5H3cIc0G6oPbCR+6Y2xF2EC5cGUm6wKC5tGEzhsWqw5hNidUiKX5gFWE1GXh4/Qplw4sVzOmx9QxU78g3EF6wnZlEN4FzJ1QPSLEZz1KfXC7vd8ssGdIbNUYpVx4UapyFUHzJoTOo1McSkeNn1M5MDQfs4qQuhhX5vQZFw8suwWTcyYTgioISk2YdmkhehG4PkE7w51inyAGGaU+uCXADabGzJR1fn3lwkty0asIo8cROm9Vy1g0yDxxtPvHDAmpu+PKnM8Ix1wwsGw91YJqhteaWgjYBmmQiebmSpwKKzE19hx7jkzSWOm66oPbzZ8Yj6kxVSpYjVAuvLzYMCRo3oTQecOOjjgi3NQ4l9K5/hOGhNTdcWVOTrlgYNkEXINbpCkBRyqhp+LdRB3g0OU6rMfW2HPCFFMV9nSp+uB2woepdbLBuJQyaw/ZFysXrlXwHxI0b0LovEkiOpXGA1Ijagf+KUNC6rKNa9bQnLFqYNkEnMc1uJrg2u64ELPBHpkgWbmwKpJoDhMwNbbGzAp7Yg31wS2T5rGtzit59PrKhesWG550CZpHEzpv2NGRaxlNjbMqpmEIzygJqQfjypycs2pg2cS2RY9r8HUqkqdEgKTWtWTKoRvOBPDYBltja2SO0RGjy9UHtxwRjA11ujbKF+ti5cIR9eCnxUg6owidtyoU5tK4NLji5Q3HCtiyF2IqLGYsHViOXTXOYxucDqG0HyttqYAKqYo3KTY1ekyDXRAm2AWh9JmsVh/ccg9WJ2E8YjG201sPq5ULxxX8n3XLXuMInbft2mk80rRGjCGctJ8/GFdmEQ9Ug4FlE1ll1Y7jtiraqm5Fe04VV8lvSVBL8hiPrfFVd8+7QH3Qbu2ipTVi8cvSGivc9cj8yvH11YMHdNSERtuOslM97feYFOPKzGcsI4zW0YGAbTAOaxCnxdfiYUmVWslxiIblCeAYr9VYR1gM7GmoPrilunSxxeT3DN/2eBQ9H11+nk1adn6VK71+5+Jfct4/el10/7KBZfNryUunWSCPxPECk1rdOv1WVSrQmpC+Tl46YD3ikQYcpunSQgzVB2VHFhxHVGKDgMEY5GLlQnP7FMDzw7IacAWnO6sBr12u+XanW2AO0wQ8pknnFhsL7KYIqhkEPmEXFkwaN5KQphbkUmG72wgw7WSm9RiL9QT925hkjiVIIhphFS9HKI6/8QAjlpXqg9W2C0apyaVDwKQwrwLY3j6ADR13ZyUNByQXHQu6RY09Hu6zMqXRaNZGS/KEJs0cJEe9VH1QdvBSJv9h09eiRmy0V2uJcqHcShcdvbSNg5fxkenkVprXM9rDVnX24/y9MVtncvbKY706anNl3ASll9a43UiacVquXGhvq4s2FP62NGKfQLIQYu9q1WmdMfmUrDGt8eDS0cXozH/fjmUH6Jruvm50hBDSaEU/2Ru2LEN/dl006TSc/g7tfJERxGMsgDUEr104pfWH9lQaN+M4KWQjwZbVc2rZVNHsyHal23wZtIs2JJqtIc/WLXXRFCpJkfE9jvWlfFbsNQ9pP5ZBS0zKh4R0aMFj1IjTcTnvi0Zz2rt7NdvQb2mgbju1plsH8MmbnEk7KbK0b+wC2iy3aX3szW8xeZvDwET6hWZYwqTXSSG+wMETKum0Dq/q+x62gt2ua2ppAo309TRk9TPazfV3qL9H8z7uhGqGqxNVg/FKx0HBl9OVUORn8Q8Jx9gFttGQUDr3tzcXX9xGgN0EpzN9mdZ3GATtPhL+CjxFDmkeEU6x56kqZRusLzALXVqkCN7zMEcqwjmywDQ6OhyUe0Xao1Qpyncrg6wKp9XfWDsaZplElvQ/b3sdweeghorwBDlHzgk1JmMc/wiERICVy2VJFdMjFuLQSp3S0W3+sngt2njwNgLssFGVQdJ0tu0KH4ky1LW4yrbkuaA6Iy9oz/qEMMXMMDWyIHhsAyFZc2peV9hc7kiKvfULxCl9iddfRK1f8kk9qvbdOoBtOg7ZkOZ5MsGrSHsokgLXUp9y88smniwWyuFSIRVmjplga3yD8Uij5QS1ZiM4U3Qw5QlSm2bXjFe6jzzBFtpg+/YBbLAWG7OPynNjlCw65fukGNdkJRf7yM1fOxVzbxOJVocFoYIaGwH22mIQkrvu1E2nGuebxIgW9U9TSiukPGU+Lt++c3DJPKhyhEEbXCQLUpae2exiKy6tMPe9mDRBFCEMTWrtwxN8qvuGnt6MoihKWS5NSyBhbH8StXoAz8PLOrRgLtOT/+4vcu+7vDLnqNvztOq7fmd8sMmY9Xzn1zj8Dq8+XVdu2Nv0IIySgEdQo3xVHps3Q5i3fLFsV4aiqzAiBhbgMDEd1uh8qZZ+lwhjkgokkOIv4xNJmyncdfUUzgB4oFMBtiu71Xumpz/P+cfUP+SlwFExwWW62r7b+LSPxqxn/gvMZ5z9C16t15UbNlq+jbGJtco7p8wbYlL4alSyfWdeuu0j7JA3JFNuVAwtst7F7FhWBbPFNKIUORndWtLraFLmMu7KFVDDOzqkeaiN33YAW/r76wR4XDN/yN1z7hejPau06EddkS/6XThfcz1fI/4K736fO48vlxt2PXJYFaeUkFS8U15XE3428xdtn2kc8GQlf1vkIaNRRnOMvLTWrZbElEHeLWi1o0dlKPAh1MVgbbVquPJ5+Cr8LU5/H/+I2QlHIU2ClXM9G8v7Rr7oc/hozfUUgsPnb3D+I+7WF8kNO92GY0SNvuxiE+2Bt8prVJTkzE64sfOstxuwfxUUoyk8VjcTlsqe2qITSFoSj6Epd4KsT6BZOWmtgE3hBfir8IzZDwgV4ZTZvD8VvPHERo8v+vL1DASHTz/i9OlKueHDjK5Rnx/JB1Vb1ioXdBra16dmt7dgik10yA/FwJSVY6XjA3oy4SqM2frqDPPSRMex9qs3XQtoWxMj7/Er8GWYsXgjaVz4OYumP2+9kbxvny/6kvWsEBw+fcb5bInc8APdhpOSs01tEqIkoiZjbAqKMruLbJYddHuHFRIyJcbdEdbl2sVLaySygunutBg96Y2/JjKRCdyHV+AEFtTvIpbKIXOamknYSiB6KV/0JetZITgcjjk5ZdaskBtWO86UF0ap6ozGXJk2WNiRUlCPFir66lzdm/SLSuK7EUdPz8f1z29Skq6F1fXg8+5UVR6bszncP4Tn4KUkkdJ8UFCY1zR1i8RmL/qQL3rlei4THG7OODlnKko4oI01kd3CaM08Ia18kC3GNoVaO9iDh+hWxSyTXFABXoau7Q6q9OxYg/OVEMw6jdbtSrJ9cBcewGmaZmg+bvkUnUUaGr+ZfnMH45Ivevl61hMcXsxYLFTu1hTm2zViCp7u0o5l+2PSUh9bDj6FgYypufBDhqK2+oXkiuHFHR3zfj+9PtA8oR0xnqX8qn+sx3bFODSbbF0X8EUvWQ8jBIcjo5bRmLOljDNtcqNtOe756h3l0VhKa9hDd2l1eqmsnh0MNMT/Cqnx6BInumhLT8luljzQ53RiJeA/0dxe5NK0o2fA1+GLXr6eNQWHNUOJssQaTRlGpLHKL9fD+IrQzTOMZS9fNQD4AnRNVxvTdjC+fJdcDDWQcyB00B0t9BDwTxXgaAfzDZ/DBXzRnfWMFRwuNqocOmX6OKNkY63h5n/fFcB28McVHqnXZVI27K0i4rDLNE9lDKV/rT+udVbD8dFFu2GGZ8mOt0kAXcoX3ZkIWVtw+MNf5NjR2FbivROHmhV1/pj2egv/fMGIOWTIWrV3Av8N9imV9IWml36H6cUjqEWNv9aNc+veb2sH46PRaHSuMBxvtW+twxctq0z+QsHhux8Q7rCY4Ct8lqsx7c6Sy0dl5T89rIeEuZKoVctIk1hNpfavER6yyH1Vvm3MbsUHy4ab4hWr/OZPcsRBphnaV65/ZcdYPNNwsjN/djlf9NqCw9U5ExCPcdhKxUgLSmfROpLp4WSUr8ojdwbncbvCf+a/YzRaEc6QOvXcGO256TXc5Lab9POvB+AWY7PigWYjzhifbovuunzRawsO24ZqQQAqguBtmpmPB7ysXJfyDDaV/aPGillgz1MdQg4u5MYaEtBNNHFjkRlSpd65lp4hd2AVPTfbV7FGpyIOfmNc/XVsPfg7vzaS/3nkvLL593ANLvMuRMGpQIhiF7kUEW9QDpAUbTWYBcbp4WpacHHY1aacqQyjGZS9HI3yCBT9kUZJhVOD+zUDvEH9ddR11fzPcTDQ5TlgB0KwqdXSavk9BC0pKp0WmcuowSw07VXmXC5guzSa4p0UvRw2lbDiYUx0ExJJRzWzi6Gm8cnEkfXXsdcG/M/jAJa0+bmCgdmQ9CYlNlSYZOKixmRsgiFxkrmW4l3KdFKv1DM8tk6WxPYJZhUUzcd8Kdtgrw/gkfXXDT7+avmfVak32qhtkg6NVdUS5wgkru1YzIkSduTW1FDwVWV3JQVJVuieTc0y4iDpFwc7/BvSalvKdQM8sv662cevz/+8sQVnjVAT0W2wLllw1JiMhJRxgDjCjLQsOzSFSgZqx7lAW1JW0e03yAD3asC+GD3NbQhbe+mN5GXH1F83KDOM4n/e5JIuH4NpdQARrFPBVptUNcjj4cVMcFSRTE2NpR1LEYbYMmfWpXgP9KejaPsLUhuvLCsVXznAG9dfx9SR1ud/3hZdCLHb1GMdPqRJgqDmm76mHbvOXDtiO2QPUcKo/TWkQ0i2JFXpBoo7vij1i1Lp3ADAo+qvG3V0rM//vFnnTE4hxd5Ka/Cor5YEdsLVJyKtDgVoHgtW11pWSjolPNMnrlrVj9Fv2Qn60twMwKPqr+N/wvr8z5tZcDsDrv06tkqyzESM85Ycv6XBWA2birlNCXrI6VbD2lx2L0vQO0QVTVVLH4SE67fgsfVXv8n7sz7/85Z7cMtbE6f088wSaR4kCkCm10s6pKbJhfqiUNGLq+0gLWC6eUAZFPnLjwqtKd8EwGvWX59t7iPW4X/eAN1svgRVSY990YZg06BD1ohLMtyFTI4pKTJsS9xREq9EOaPWiO2gpms7397x6nQJkbh+Fz2q/rqRROX6/M8bJrqlVW4l6JEptKeUFuMYUbtCQ7CIttpGc6MY93x1r1vgAnRXvY5cvwWPqb9uWQm+lP95QxdNMeWhOq1x0Db55C7GcUv2ZUuN6n8iKzsvOxibC//Yfs9Na8r2Rlz02vXXDT57FP/zJi66/EJSmsJKa8QxnoqW3VLQ+jZVUtJwJ8PNX1NQCwfNgdhhHD9on7PdRdrdGPF28rJr1F+3LBdeyv+8yYfLoMYet1vX4upNAjVvwOUWnlNXJXlkzk5Il6kqeoiL0C07qno+/CYBXq/+utlnsz7/Mzvy0tmI4zm4ag23PRN3t/CWryoUVJGm+5+K8RJ0V8Hc88/XHUX/HfiAq7t+BH+x6v8t438enWmdJwFA6ZINriLGKv/95f8lT9/FnyA1NMVEvQyaXuu+gz36f/DD73E4pwqpLcvm/o0Vle78n//+L/NPvoefp1pTJye6e4A/D082FERa5/opeH9zpvh13cNm19/4v/LDe5xMWTi8I0Ta0qKlK27AS/v3/r+/x/2GO9K2c7kVMonDpq7//jc5PKCxeNPpFVzaRr01wF8C4Pu76hXuX18H4LduTr79guuFD3n5BHfI+ZRFhY8w29TYhbbLi/bvBdqKE4fUgg1pBKnV3FEaCWOWyA+m3WpORZr/j+9TKJtW8yBTF2/ZEODI9/QavHkVdGFp/Pjn4Q+u5hXapsP5sOH+OXXA1LiKuqJxiMNbhTkbdJTCy4llEt6NnqRT4dhg1V3nbdrm6dYMecA1yTOL4PWTE9L5VzPFlLBCvlG58AhehnN4uHsAYinyJ+AZ/NkVvELbfOBUuOO5syBIEtiqHU1k9XeISX5bsimrkUUhnGDxourN8SgUsCZVtKyGbyGzHXdjOhsAvOAswSRyIBddRdEZWP6GZhNK/yjwew9ehBo+3jEADu7Ay2n8mDc+TS7awUHg0OMzR0LABhqLD4hJEh/BEGyBdGlSJoXYXtr+3HS4ijzVpgi0paWXtdruGTknXBz+11qT1Q2inxaTzQCO46P3lfLpyS4fou2PH/PupwZgCxNhGlj4IvUuWEsTkqMWm6i4xCSMc9N1RDQoCVcuGItJ/MRWefais+3synowi/dESgJjkilnWnBTGvRWmaw8oR15257t7CHmCf8HOn7cwI8+NQBXMBEmAa8PMRemrNCEhLGEhDQKcGZWS319BX9PFBEwGTbRBhLbDcaV3drFcDqk5kCTd2JF1Wp0HraqBx8U0wwBTnbpCadwBA/gTH/CDrcCs93LV8E0YlmmcyQRQnjBa8JESmGUfIjK/7fkaDJpmD2QptFNVJU1bbtIAjjWQizepOKptRjbzR9Kag6xZmMLLjHOtcLT3Tx9o/0EcTT1XN3E45u24AiwEypDJXihKjQxjLprEwcmRKclaDNZCVqr/V8mYWyFADbusiY5hvgFoU2vio49RgJLn5OsReRFN6tabeetiiy0V7KFHT3HyZLx491u95sn4K1QQSPKM9hNT0wMVvAWbzDSVdrKw4zRjZMyJIHkfq1VAVCDl/bUhNKlGq0zGr05+YAceXVPCttVk0oqjVwMPt+BBefx4yPtGVkUsqY3CHDPiCM5ngupUwCdbkpd8kbPrCWHhkmtIKLEetF2499eS1jZlIPGYnlcPXeM2KD9vLS0bW3ktYNqUllpKLn5ZrsxlIzxvDu5eHxzGLctkZLEY4PgSOg2IUVVcUONzUDBEpRaMoXNmUc0tFZrTZquiLyKxrSm3DvIW9Fil+AkhXu5PhEPx9mUNwqypDvZWdKlhIJQY7vn2OsnmBeOWnYZ0m1iwbbw1U60by5om47iHRV6fOgzjMf/DAZrlP40Z7syxpLK0lJ0gqaAK1c2KQKu7tabTXkLFz0sCftuwX++MyNeNn68k5Buq23YQhUh0SNTJa1ioQ0p4nUG2y0XilF1JqODqdImloPS4Bp111DEWT0jJjVv95uX9BBV7eB3bUWcu0acSVM23YZdd8R8UbQUxJ9wdu3oMuhdt929ME+mh6JXJ8di2RxbTi6TbrDquqV4aUKR2iwT6aZbyOwEXN3DUsWr8Hn4EhwNyHuXHh7/pdaUjtR7vnDh/d8c9xD/s5f501eQ1+CuDiCvGhk1AN/4Tf74RfxPwD3toLarR0zNtsnPzmS64KIRk861dMWCU8ArasG9T9H0ZBpsDGnjtAOM2+/LuIb2iIUGXNgl5ZmKD/Tw8TlaAuihaFP5yrw18v4x1898zIdP+DDAX1bM3GAMvPgRP/cJn3zCW013nrhHkrITyvYuwOUkcHuKlRSW5C6rzIdY4ppnF7J8aAJbQepgbJYBjCY9usGXDKQxq7RZfh9eg5d1UHMVATRaD/4BHK93/1iAgYZ/+jqPn8Dn4UExmWrpa3+ZOK6MvM3bjwfzxNWA2dhs8+51XHSPJiaAhGSpWevEs5xHLXcEGFXYiCONySH3fPWq93JIsBiSWvWyc3CAN+EcXoT7rCSANloPPoa31rt/5PUA/gp8Q/jDD3hyrjzlR8VkanfOvB1XPubt17vzxAfdSVbD1pzAnfgyF3ycadOTOTXhpEUoLC1HZyNGW3dtmjeXgr2r56JNmRwdNNWaQVBddd6rh4MhviEB9EFRD/7RGvePvCbwAL4Mx/D6M541hHO4D3e7g6PafdcZVw689z7NGTwo5om7A8sPhccT6qKcl9NJl9aM/9kX+e59Hh1yPqGuCCZxuITcsmNaJ5F7d0q6J3H48TO1/+M57085q2icdu2U+W36Ldllz9Agiv4YGljoEN908EzvDOrBF98/vtJwCC/BF2AG75xxEmjmMIcjxbjoaxqOK3/4hPOZzhMPBpYPG44CM0dTVm1LjLtUWWVz1Bcf8tEx0zs8O2A2YVHRxKYOiy/aOVoAaMu0i7ubu43njjmd4ibMHU1sIDHaQNKrZND/FZYdk54oCXetjq7E7IVl9eAL7t+oHnwXXtLx44czzoRFHBztYVwtH1d+NOMkupZ5MTM+gUmq90X+Bh9zjRlmaQ+m7YMqUL/veemcecAtOJ0yq1JnVlN27di2E0+Klp1tAJ4KRw1eMI7aJjsO3R8kPSI3fUFXnIOfdQe86sIIVtWDL7h//Ok6vj8vwDk08NEcI8zz7OhBy+WwalzZeZ4+0XniRfst9pAJqQHDGLzVQ2pheZnnv1OWhwO43/AgcvAEXEVVpa4db9sGvNK8wjaENHkfFQ4Ci5i7dqnQlPoLQrHXZDvO3BIXZbJOBrOaEbML6sFL798I4FhKihjHMsPjBUZYCMFr6nvaArxqXPn4lCa+cHfSa2cP27g3Z3ziYTRrcbQNGLQmGF3F3cBdzzzX7AILx0IB9rbwn9kx2G1FW3Inic+ZLIsVvKR8Zwfj0l1fkqo8LWY1M3IX14OX3r9RKTIO+d9XzAI8qRPGPn/4NC2n6o4rN8XJ82TOIvuVA8zLKUHRFgBCetlDZlqR1gLKjS39xoE7Bt8UvA6BxuEDjU3tFsEijgA+615tmZkXKqiEENrh41iLDDZNq4pKTWR3LZfnos81LOuNa15cD956vLMsJd1rqYp51gDUQqMYm2XsxnUhD2jg1DM7SeuJxxgrmpfISSXVIJIS5qJJSvJPEQ49DQTVIbYWJ9QWa/E2+c/oPK1drmC7WSfJRNKBO5Yjvcp7Gc3dmmI/Xh1kDTEuiSnWqQf37h+fTMhGnDf6dsS8SQfQWlqqwXXGlc/PEZ/SC5mtzIV0nAshlQdM/LvUtYutrEZ/Y+EAFtq1k28zQhOwLr1AIeANzhF8t9qzTdZf2qRKO6MWE9ohBYwibbOmrFtNmg3mcS+tB28xv2uKd/agYCvOP+GkSc+0lr7RXzyufL7QbkUpjLjEWFLqOIkAGu2B0tNlO9Eau2W1qcOUvVRgKzypKIQZ5KI3q0MLzqTNRYqiZOqmtqloIRlmkBHVpHmRYV6/HixbO6UC47KOFJnoMrVyr7wYz+SlW6GUaghYbY1I6kkxA2W1fSJokUdSh2LQ1GAimRGm0MT+uu57H5l7QgOWxERpO9moLRPgTtquWCfFlGlIjQaRly9odmzMOWY+IBO5tB4sW/0+VWGUh32qYk79EidWKrjWuiLpiVNGFWFRJVktyeXWmbgBBzVl8anPuXyNJlBJOlKLTgAbi/EYHVHxWiDaVR06GnHQNpJcWcK2jJtiCfG2sEHLzuI66sGrMK47nPIInPnu799935aOK2cvmvubrE38ZzZjrELCmXM2hM7UcpXD2oC3+ECVp7xtIuxptJ0jUr3sBmBS47TVxlvJ1Sqb/E0uLdvLj0lLr29ypdd/eMX3f6lrxGlKwKQxEGvw0qHbkbwrF3uHKwVENbIV2wZ13kNEF6zD+x24aLNMfDTCbDPnEikZFyTNttxWBXDaBuM8KtI2rmaMdUY7cXcUPstqTGvBGSrFWIpNMfbdea990bvAOC1YX0qbc6smDS1mPxSJoW4fwEXvjMmhlijDRq6qale6aJEuFGoppYDoBELQzLBuh/mZNx7jkinv0EtnUp50lO9hbNK57lZaMAWuWR5Yo9/kYwcYI0t4gWM47Umnl3YmpeBPqSyNp3K7s2DSAS/39KRuEN2bS4xvowV3dFRMx/VFcp2Yp8w2nTO9hCXtHG1kF1L4KlrJr2wKfyq77R7MKpFKzWlY9UkhYxyHWW6nBWPaudvEAl3CGcNpSXPZ6R9BbBtIl6cHL3gIBi+42CYXqCx1gfGWe7Ap0h3luyXdt1MKy4YUT9xSF01G16YEdWsouW9mgDHd3veyA97H+Ya47ZmEbqMY72oPztCGvK0onL44AvgC49saZKkWRz4veWljE1FHjbRJaWv6ZKKtl875h4CziFCZhG5rx7tefsl0aRT1bMHZjm8dwL/6u7wCRysaQblQoG5yAQN5zpatMNY/+yf8z+GLcH/Qn0iX2W2oEfXP4GvwQHuIL9AYGnaO3zqAX6946nkgqZNnUhx43DIdQtMFeOPrgy/y3Yd85HlJWwjLFkU3kFwq28xPnuPhMWeS+tDLV9Otllq7pQCf3uXJDN9wFDiUTgefHaiYbdfi3b3u8+iY6TnzhgehI1LTe8lcd7s1wJSzKbahCRxKKztTLXstGAiu3a6rPuQs5pk9TWAan5f0BZmGf7Ylxzzk/A7PAs4QPPPAHeFQ2hbFHszlgZuKZsJcUmbDC40sEU403cEjczstOEypa+YxevL4QBC8oRYqWdK6b7sK25tfE+oDZgtOQ2Jg8T41HGcBE6fTWHn4JtHcu9S7uYgU5KSCkl/mcnq+5/YBXOEr6lCUCwOTOM1taOI8mSxx1NsCXBEmLKbMAg5MkwbLmpBaFOPrNSlO2HnLiEqW3tHEwd8AeiQLmn+2gxjC3k6AxREqvKcJbTEzlpLiw4rNZK6oJdidbMMGX9FULKr0AkW+2qDEPBNNm5QAt2Ik2nftNWHetubosHLo2nG4vQA7GkcVCgVCgaDixHqo9UUn1A6OshapaNR/LPRYFV8siT1cCtJE0k/3WtaNSuUZYKPnsVIW0xXWnMUxq5+En4Kvw/MqQmVXnAXj9Z+9zM98zM/Agy7F/qqj2Nh67b8HjFnPP3iBn/tkpdzwEJX/whIcQUXOaikeliCRGUk7tiwF0rItwMEhjkZ309hikFoRAmLTpEXWuHS6y+am/KB/fM50aLEhGnSMwkpxzOov4H0AvgovwJ1iGzDLtJn/9BU+fAINfwUe6FHSLhu83viV/+/HrOePX+STT2B9uWGbrMHHLldRBlhS/CJQmcRxJFqZica01XixAZsYiH1uolZxLrR/SgxVIJjkpQP4PE9sE59LKLr7kltSBogS5tyszzH8Fvw8/AS8rNOg0xUS9fIaHwb+6et8Q/gyvKRjf5OusOzGx8evA/BP4IP11uN/grca5O0lcsPLJ5YjwI4QkJBOHa0WdMZYGxPbh2W2nR9v3WxEWqgp/G3+6VZbRLSAAZ3BhdhAaUL33VUSw9yjEsvbaQ9u4A/gGXwZXoEHOuU1GSj2chf+Mo+f8IcfcAxfIKVmyunRbYQVnoevwgfw3TXXcw++xNuP4fhyueEUNttEduRVaDttddoP0eSxLe2LENk6itYxlrxBNBYrNNKSQmeaLcm9c8UsaB5WyO6675yyQIAWSDpBVoA/gxmcwEvwoDv0m58UE7gHn+fJOa8/Ywan8EKRfjsopF83eCglX/Sfr7OeaRoQfvt1CGvIDccH5BCvw1sWIzRGC/66t0VTcLZQZtm6PlAasbOJ9iwWtUo7biktTSIPxnR24jxP1ZKaqq+2RcXM9OrBAm/AAs7hDJ5bNmGb+KIfwCs8a3jnjBrOFeMjHSCdbKr+2uOLfnOd9eiA8Hvvwwq54VbP2OqwkB48Ytc4YEOiH2vTXqodabfWEOzso4qxdbqD5L6tbtNPECqbhnA708DZH4QOJUXqScmUlks7Ot6FBuZw3n2mEbaUX7kDzxHOOQk8nKWMzAzu6ZZ8sOFw4RK+6PcuXo9tB4SbMz58ApfKDXf3szjNIIbGpD5TKTRxGkEMLjLl+K3wlWXBsCUxIDU+jbOiysESqAy1MGUJpXgwbTWzNOVEziIXZrJ+VIztl1PUBxTSo0dwn2bOmfDRPD3TRTGlfbCJvO9KvuhL1hMHhB9wPuPRLGHcdOWG2xc0U+5bQtAJT0nRTewXL1pgk2+rZAdeWmz3jxAqfNQQdzTlbF8uJ5ecEIWvTkevAHpwz7w78QujlD/Lr491bD8/1vhM2yrUQRrWXNQY4fGilfctMWYjL72UL/qS9eiA8EmN88nbNdour+PBbbAjOjIa4iBhfFg6rxeKdEGcL6p3EWR1Qq2Qkhs2DrnkRnmN9tG2EAqmgPw6hoL7Oza7B+3SCrR9tRftko+Lsf2F/mkTndN2LmzuMcKTuj/mX2+4Va3ki16+nnJY+S7MefpkidxwnV+4wkXH8TKnX0tsYzYp29DOOoSW1nf7nTh2akYiWmcJOuTidSaqESrTYpwjJJNVGQr+rLI7WsqerHW6Kp/oM2pKuV7T1QY9gjqlZp41/WfKpl56FV/0kvXQFRyeQ83xaTu5E8p5dNP3dUF34ihyI3GSpeCsywSh22ZJdWto9winhqifb7VRvgktxp13vyjrS0EjvrRfZ62uyqddSWaWYlwTPAtJZ2oZ3j/Sgi/mi+6vpzesfAcWNA0n8xVyw90GVFGuZjTXEQy+6GfLGLMLL523f5E0OmxVjDoOuRiH91RKU+vtoCtH7TgmvBLvtFXWLW15H9GTdVw8ow4IlRLeHECN9ym1e9K0I+Cbnhgv4Yu+aD2HaQJ80XDqOzSGAV4+4yCqBxrsJAX6ZTIoX36QnvzhhzzMfFW2dZVLOJfo0zbce5OvwXMFaZ81mOnlTVXpDZsQNuoYWveketKb5+6JOOsgX+NTm7H49fUTlx+WLuWL7qxnOFh4BxpmJx0p2gDzA/BUARuS6phR+pUsY7MMboAHx5xNsSVfVZcYSwqCKrqon7zM+8ecCkeS4nm3rINuaWvVNnMRI1IRpxTqx8PZUZ0Br/UEduo3B3hNvmgZfs9gQPj8vIOxd2kndir3awvJ6BLvoUuOfFWNYB0LR1OQJoUySKb9IlOBx74q1+ADC2G6rOdmFdJcD8BkfualA+BdjOOzP9uUhGUEX/TwhZsUduwRr8wNuXKurCixLBgpQI0mDbJr9dIqUuV+92ngkJZ7xduCk2yZKbfWrH1VBiTg9VdzsgRjW3CVXCvAwDd+c1z9dWw9+B+8MJL/eY15ZQ/HqvTwVdsZn5WQsgRRnMaWaecu3jFvMBEmgg+FJFZsnSl0zjB9OqPYaBD7qmoVyImFvzi41usesV0julaAR9dfR15Xzv9sEruRDyk1nb+QaLU67T885GTls6YgcY+UiMa25M/pwGrbCfzkvR3e0jjtuaFtnwuagHTSb5y7boBH119HXhvwP487jJLsLJ4XnUkHX5sLbS61dpiAXRoZSCrFJ+EjpeU3puVfitngYNo6PJrAigKktmwjyQdZpfq30mmtulaAx9Zfx15Xzv+cyeuiBFUs9zq8Kq+XB9a4PVvph3GV4E3y8HENJrN55H1X2p8VyqSKwVusJDKzXOZzplWdzBUFK9e+B4+uv468xvI/b5xtSAkBHQaPvtqWzllVvEOxPbuiE6+j2pvjcKsbvI7txnRErgfH7LdXqjq0IokKzga14GzQ23SSbCQvO6r+Or7SMIr/efOkkqSdMnj9mBx2DRsiY29Uj6+qK9ZrssCKaptR6HKURdwUYeUWA2kPzVKQO8ku2nU3Anhs/XWkBx3F/7wJtCTTTIKftthue1ty9xvNYLY/zo5KSbIuKbXpbEdSyeRyYdAIwKY2neyoc3+k1XUaufYga3T9daMUx/r8z1s10ITknIO0kuoMt+TB8jK0lpayqqjsJ2qtXAYwBU932zinimgmd6mTRDnQfr88q36NAI+tv24E8Pr8zxtasBqx0+xHH9HhlrwsxxNUfKOHQaZBITNf0uccj8GXiVmXAuPEAKSdN/4GLHhs/XWj92dN/uetNuBMnVR+XWDc25JLjo5Mg5IZIq226tmCsip2zZliL213YrTlL2hcFjpCduyim3M7/eB16q/blQsv5X/esDRbtJeabLIosWy3ycavwLhtxdWzbMmHiBTiVjJo6lCLjXZsi7p9PEPnsq6X6wd4bP11i0rD5fzPm/0A6brrIsllenZs0lCJlU4abakR59enZKrKe3BZihbTxlyZ2zl1+g0wvgmA166/bhwDrcn/7Ddz0eWZuJvfSESug6NzZsox3Z04FIxz0mUjMwVOOVTq1CQ0AhdbBGVdjG/CgsfUX7esJl3K/7ytWHRv683praW/8iDOCqWLLhpljDY1ZpzK75QiaZoOTpLKl60auHS/97oBXrv+umU9+FL+5+NtLFgjqVLCdbmj7pY5zPCPLOHNCwXGOcLquOhi8CmCWvbcuO73XmMUPab+ug3A6/A/78Bwe0bcS2+tgHn4J5pyS2WbOck0F51Vq3LcjhLvZ67p1ABbaL2H67bg78BfjKi/jr3+T/ABV3ilLmNXTI2SpvxWBtt6/Z//D0z/FXaGbSBgylzlsEGp+5//xrd4/ae4d8DUUjlslfIYS3t06HZpvfQtvv0N7AHWqtjP2pW08QD/FLy//da38vo8PNlKHf5y37Dxdfe/oj4kVIgFq3koLReSR76W/bx//n9k8jonZxzWTANVwEniDsg87sOSd/z7//PvMp3jQiptGVWFX2caezzAXwfgtzYUvbr0iozs32c3Uge7varH+CNE6cvEYmzbPZ9hMaYDdjK4V2iecf6EcEbdUDVUARda2KzO/JtCuDbNQB/iTeL0EG1JSO1jbXS+nLxtPMDPw1fh5+EPrgSEKE/8Gry5A73ui87AmxwdatyMEBCPNOCSKUeRZ2P6Myb5MRvgCHmA9ywsMifU+AYXcB6Xa5GibUC5TSyerxyh0j6QgLVpdyhfArRTTLqQjwe4HOD9s92D4Ap54odXAPBWLAwB02igG5Kkc+piN4lvODIFGAZgT+EO4Si1s7fjSR7vcQETUkRm9O+MXyo9OYhfe4xt9STQ2pcZRLayCV90b4D3jR0DYAfyxJ+eywg2IL7NTMXna7S/RpQ63JhWEM8U41ZyQGjwsVS0QBrEKLu8xwZsbi4wLcCT+OGidPIOCe1PiSc9Qt+go+vYqB7cG+B9d8cAD+WJPz0Am2gxXgU9IneOqDpAAXOsOltVuMzpdakJXrdPCzXiNVUpCeOos5cxnpQT39G+XVLhs1osQVvJKPZyNq8HDwd4d7pNDuWJPxVX7MSzqUDU6gfadKiNlUFTzLeFHHDlzO4kpa7aiKhBPGKwOqxsBAmYkOIpipyXcQSPlRTf+Tii0U3EJGaZsDER2qoB3h2hu0qe+NNwUooYU8y5mILbJe6OuX+2FTKy7bieTDAemaQyQ0CPthljSWO+xmFDIYiESjM5xKd6Ik5lvLq5GrQ3aCMLvmCA9wowLuWJb9xF59hVVP6O0CrBi3ZjZSNOvRy+I6klNVRJYRBaEzdN+imiUXQ8iVF8fsp+W4JXw7WISW7fDh7lptWkCwZ4d7QTXyBPfJMYK7SijjFppGnlIVJBJBYj7eUwtiP1IBXGI1XCsjNpbjENVpSAJ2hq2LTywEly3hUYazt31J8w2+aiLx3g3fohXixPfOMYm6zCGs9LVo9MoW3MCJE7R5u/WsOIjrqBoHUO0bJE9vxBpbhsd3+Nb4/vtPCZ4oZYCitNeYuC/8UDvDvy0qvkiW/cgqNqRyzqSZa/s0mqNGjtKOoTm14zZpUauiQgVfqtQiZjq7Q27JNaSK5ExRcrGCXO1FJYh6jR6CFqK7bZdQZ4t8g0rSlPfP1RdBtqaa9diqtzJkQ9duSryi2brQXbxDwbRUpFMBHjRj8+Nt7GDKgvph9okW7LX47gu0SpGnnFQ1S1lYldOsC7hYteR574ZuKs7Ei1lBsfdz7IZoxzzCVmmVqaSySzQbBVAWDek+N4jh9E/4VqZrJjPwiv9BC1XcvOWgO8275CVyBPvAtTVlDJfZkaZGU7NpqBogAj/xEHkeAuJihWYCxGN6e8+9JtSegFXF1TrhhLGP1fak3pebgPz192/8gB4d/6WT7+GdYnpH7hH/DJzzFiYPn/vjW0SgNpTNuPIZoAEZv8tlGw4+RLxy+ZjnKa5NdFoC7UaW0aduoYse6+bXg1DLg6UfRYwmhGEjqPvF75U558SANrElK/+MdpXvmqBpaXOa/MTZaa1DOcSiLaw9j0NNNst3c+63c7EKTpkvKHzu6bPbP0RkuHAVcbRY8ijP46MIbQeeT1mhA+5PV/inyDdQipf8LTvMXbwvoDy7IruDNVZKTfV4CTSRUYdybUCnGU7KUTDxLgCknqUm5aAW6/1p6eMsOYsphLzsHrE0Y/P5bQedx1F/4yPHnMB3/IOoTU9+BL8PhtjuFKBpZXnYNJxTuv+2XqolKR2UQgHhS5novuxVySJhBNRF3SoKK1XZbbXjVwWNyOjlqWJjrWJIy+P5bQedyldNScP+HZ61xKSK3jyrz+NiHG1hcOLL/+P+PDF2gOkekKGiNWKgJ+8Z/x8Iv4DdQHzcpZyF4v19I27w9/yPGDFQvmEpKtqv/TLiWMfn4sofMm9eAH8Ao0zzh7h4sJqYtxZd5/D7hkYPneDzl5idlzNHcIB0jVlQ+8ULzw/nc5/ojzl2juE0apD7LRnJxe04dMz2iOCFNtGFpTuXA5AhcTRo8mdN4kz30nVjEC4YTZQy4gpC7GlTlrePKhGsKKgeXpCYeO0MAd/GH7yKQUlXPLOasOH3FnSphjHuDvEu4gB8g66oNbtr6eMbFIA4fIBJkgayoXriw2XEDQPJrQeROAlY6aeYOcMf+IVYTU3XFlZufMHinGywaW3YLpObVBAsbjF4QJMsVUSayjk4voPsHJOQfPWDhCgDnmDl6XIRerD24HsGtw86RMHOLvVSHrKBdeVE26gKB5NKHzaIwLOmrqBWJYZDLhASG16c0Tn+CdRhWDgWXnqRZUTnPIHuMJTfLVpkoYy5CzylHVTGZMTwkGAo2HBlkQplrJX6U+uF1wZz2uwS1SQ12IqWaPuO4baZaEFBdukksJmkcTOm+YJSvoqPFzxFA/YUhIvWxcmSdPWTWwbAKVp6rxTtPFUZfKIwpzm4IoMfaYQLWgmlG5FME2gdBgm+J7J+rtS/XBbaVLsR7bpPQnpMFlo2doWaVceHk9+MkyguZNCJ1He+kuHTWyQAzNM5YSUg/GlTk9ZunAsg1qELVOhUSAK0LABIJHLKbqaEbHZLL1VA3VgqoiOKXYiS+HRyaEKgsfIqX64HYWbLRXy/qWoylIV9gudL1OWBNgBgTNmxA6b4txDT4gi3Ri7xFSLxtXpmmYnzAcWDZgY8d503LFogz5sbonDgkKcxGsWsE1OI+rcQtlgBBCSOKD1mtqYpIU8cTvBmAT0yZe+zUzeY92fYjTtGipXLhuR0ePoHk0ofNWBX+lo8Z7pAZDk8mEw5L7dVyZZoE/pTewbI6SNbiAL5xeygW4xPRuLCGbhcO4RIeTMFYHEJkYyEO9HmJfXMDEj/LaH781wHHZEtqSQ/69UnGpzH7LKIAZEDSPJnTesJTUa+rwTepI9dLJEawYV+ZkRn9g+QirD8vF8Mq0jFQ29js6kCS3E1+jZIhgPNanHdHFqFvPJLHqFwQqbIA4jhDxcNsOCCQLDomaL/dr5lyJaJU6FxPFjO3JOh3kVMcROo8u+C+jo05GjMF3P3/FuDLn5x2M04xXULPwaS6hBYki+MrMdZJSgPHlcB7nCR5bJ9Kr5ACUn9jk5kivdd8tk95SOGrtqu9lr2IhK65ZtEl7ZKrp7DrqwZfRUSN1el7+7NJxZbywOC8neNKTch5vsTEMNsoCCqHBCqIPRjIPkm0BjvFODGtto99rCl+d3wmHkW0FPdpZtC7MMcVtGFQjJLX5bdQ2+x9ypdc313uj8xlsrfuLgWXz1cRhZvJYX0iNVBRcVcmCXZs6aEf3RQF2WI/TcCbKmGU3IOoDJGDdDub0+hYckt6PlGu2BcxmhbTdj/klhccLGJMcqRjMJP1jW2ETqLSWJ/29MAoORluJ+6LPffBZbi5gqi5h6catQpmOT7/OFf5UorRpLzCqcMltBLhwd1are3kztrSzXO0LUbXRQcdLh/RdSZ+swRm819REDrtqzC4es6Gw4JCKlSnjYVpo0xeq33PrADbFLL3RuCmObVmPN+24kfa+AojDuM4umKe2QwCf6EN906HwjujaitDs5o0s1y+k3lgbT2W2i7FJdnwbLXhJUBq/9liTctSmFC/0OqUinb0QddTWamtjbHRFuWJJ6NpqZ8vO3fZJ37Db+2GkaPYLGHs7XTTdiFQJ68SkVJFVmY6McR5UycflNCsccHFaV9FNbR4NttLxw4pQ7wJd066Z0ohVbzihaxHVExd/ay04oxUKWt+AsdiQ9OUyZ2krzN19IZIwafSTFgIBnMV73ADj7V/K8u1MaY2sJp2HWm0f41tqwajEvdHWOJs510MaAqN4aoSiPCXtN2KSi46dUxHdaMquar82O1x5jqhDGvqmoE9LfxcY3zqA7/x3HA67r9ZG4O6Cuxu12/+TP+eLP+I+HErqDDCDVmBDO4larujNe7x8om2rMug0MX0rL1+IWwdwfR+p1TNTyNmVJ85ljWzbWuGv8/C7HD/izjkHNZNYlhZcUOKVzKFUxsxxN/kax+8zPWPSFKw80rJr9Tizyj3o1gEsdwgWGoxPezDdZ1TSENE1dLdNvuKL+I84nxKesZgxXVA1VA1OcL49dFlpFV5yJMhzyCmNQ+a4BqusPJ2bB+xo8V9u3x48VVIEPS/mc3DvAbXyoYr6VgDfh5do5hhHOCXMqBZUPhWYbWZECwVJljLgMUWOCB4MUuMaxGNUQDVI50TQ+S3kFgIcu2qKkNSHVoM0SHsgoZxP2d5HH8B9woOk4x5bPkKtAHucZsdykjxuIpbUrSILgrT8G7G5oCW+K0990o7E3T6AdW4TilH5kDjds+H64kS0mz24grtwlzDHBJqI8YJQExotPvoC4JBq0lEjjQkyBZ8oH2LnRsQ4Hu1QsgDTJbO8fQDnllitkxuVskoiKbRF9VwzMDvxHAdwB7mD9yCplhHFEyUWHx3WtwCbSMMTCUCcEmSGlg4gTXkHpZXWQ7kpznK3EmCHiXInqndkQjunG5kxTKEeGye7jWz9cyMR2mGiFQ15ENRBTbCp+Gh86vAyASdgmJq2MC6hoADQ3GosP0QHbnMHjyBQvQqfhy/BUbeHd5WY/G/9LK/8Ka8Jd7UFeNWEZvzPb458Dn8DGLOe3/wGL/4xP+HXlRt+M1PE2iLhR8t+lfgxsuh7AfO2AOf+owWhSZRYQbd622hbpKWKuU+XuvNzP0OseRDa+mObgDHJUSc/pKx31QdKffQ5OIJpt8GWjlgTwMc/w5MPCR/yl1XC2a2Yut54SvOtMev55Of45BOat9aWG27p2ZVORRvnEk1hqWMVUmqa7S2YtvlIpspuF1pt0syuZS2NV14mUidCSfzQzg+KqvIYCMljIx2YK2AO34fX4GWdu5xcIAb8MzTw+j/lyWM+Dw/gjs4GD6ehNgA48kX/AI7XXM/XAN4WHr+9ntywqoCakCqmKP0rmQrJJEErG2Upg1JObr01lKQy4jskWalKYfJ/EDLMpjNSHFEUAde2fltaDgmrNaWQ9+AAb8I5vKjz3L1n1LriB/BXkG/wwR9y/oRX4LlioHA4LzP2inzRx/DWmutRweFjeP3tNeSGlaE1Fde0OS11yOpmbIp2u/jF1n2RRZviJM0yBT3IZl2HWImKjQOxIyeU325b/qWyU9Moj1o07tS0G7qJDoGHg5m8yeCxMoEH8GU45tnrNM84D2l297DQ9t1YP7jki/7RmutRweEA77/HWXOh3HCxkRgldDQkAjNTMl2Iloc1qN5JfJeeTlyTRzxURTdn1Ixv2uKjs12AbdEWlBtmVdk2k7FFwj07PCZ9XAwW3dG+8xKzNFr4EnwBZpy9Qzhh3jDXebBpYcpuo4fQ44u+fD1dweEnHzI7v0xuuOALRUV8rXpFyfSTQYkhd7IHm07jpyhlkCmI0ALYqPTpUxXS+z4jgDj1Pflvmz5ecuItpIBxyTHpSTGWd9g1ApfD/bvwUhL4nT1EzqgX7cxfCcNmb3mPL/qi9SwTHJ49oj5ZLjccbTG3pRmlYi6JCG0mQrAt1+i2UXTZ2dv9IlQpN5naMYtviaXlTrFpoMsl3bOAFEa8sqPj2WCMrx3Yjx99qFwO59Aw/wgx+HlqNz8oZvA3exRDvuhL1jMQHPaOJ0+XyA3fp1OfM3qObEVdhxjvynxNMXQV4+GJyvOEFqeQBaIbbO7i63rpxCltdZShPFxkjM2FPVkn3TG+Rp9pO3l2RzFegGfxGDHIAh8SteR0C4HopXzRF61nheDw6TFN05Ebvq8M3VKKpGjjO6r7nhudTEGMtYM92HTDaR1FDMXJ1eThsbKfywyoWwrzRSXkc51flG3vIid62h29bIcFbTGhfV+faaB+ohj7dPN0C2e2lC96+XouFByen9AsunLDJZ9z7NExiUc0OuoYW6UZkIyx2YUR2z6/TiRjyKMx5GbbjLHvHuf7YmtKghf34LJfx63Yg8vrvN2zC7lY0x0tvKezo4HmGYDU+Gab6dFL+KI761lDcNifcjLrrr9LWZJctG1FfU1uwhoQE22ObjdfkSzY63CbU5hzs21WeTddH2BaL11Gi7lVdlxP1nkxqhnKhVY6knS3EPgVGg1JpN5cP/hivujOelhXcPj8HC/LyI6MkteVjlolBdMmF3a3DbsuAYhL44dxzthWSN065xxUd55Lmf0wRbOYOqH09/o9WbO2VtFdaMb4qBgtFJoT1SqoN8wPXMoXLb3p1PUEhxfnnLzGzBI0Ku7FxrKsNJj/8bn/H8fPIVOd3rfrklUB/DOeO+nkghgSPzrlPxluCMtOnDL4Yml6dK1r3vsgMxgtPOrMFUZbEUbTdIzii5beq72G4PD0DKnwjmBULUVFmy8t+k7fZ3pKc0Q4UC6jpVRqS9Umv8bxw35flZVOU1X7qkjnhZlsMbk24qQ6Hz7QcuL6sDC0iHHki96Uh2UdvmgZnjIvExy2TeJdMDZNSbdZyAHe/Yd1xsQhHiKzjh7GxQ4yqMPaywPkjMamvqrYpmO7Knad+ZQC5msCuAPWUoxrxVhrGv7a+KLXFhyONdTMrZ7ke23qiO40ZJUyzgYyX5XyL0mV7NiUzEs9mjtbMN0dERqwyAJpigad0B3/zRV7s4PIfXSu6YV/MK7+OrYe/JvfGMn/PHJe2fyUdtnFrKRNpXV0Y2559aWPt/G4BlvjTMtXlVIWCnNyA3YQBDmYIodFz41PvXPSa6rq9lWZawZ4dP115HXV/M/tnFkkrBOdzg6aP4pID+MZnTJ1SuuB6iZlyiox4HT2y3YBtkUKWooacBQUDTpjwaDt5poBHl1/HXltwP887lKKXxNUEyPqpGTyA699UqY/lt9yGdlUKra0fFWS+36iylVWrAyd7Uw0CZM0z7xKTOduznLIjG2Hx8cDPLb+OvK6Bv7n1DYci4CxUuRxrjBc0bb4vD3rN5Zz36ntLb83eVJIB8LiIzCmn6SMPjlX+yNlTjvIGjs+QzHPf60Aj62/jrzG8j9vYMFtm1VoRWCJdmw7z9N0t+c8cxZpPeK4aTRicS25QhrVtUp7U578chk4q04Wx4YoQSjFryUlpcQ1AbxZ/XVMknIU//OGl7Q6z9Zpxi0+3yFhSkjUDpnCIUhLWVX23KQ+L9vKvFKI0ZWFQgkDLvBoylrHNVmaw10zwCPrr5tlodfnf94EWnQ0lFRWy8pW9LbkLsyUVDc2NSTHGDtnD1uMtchjbCeb1mpxFP0YbcClhzdLu6lfO8Bj6q+bdT2sz/+8SZCV7VIxtt0DUn9L7r4cLYWDSXnseEpOGFuty0qbOVlS7NNzs5FOGJUqQpl2Q64/yBpZf90sxbE+//PGdZ02HSipCbmD6NItmQ4Lk5XUrGpDMkhbMm2ZVheNYV+VbUWTcv99+2NyX1VoafSuC+AN6q9bFIMv5X/eagNWXZxEa9JjlMwNWb00akGUkSoepp1/yRuuqHGbUn3UdBSTxBU6SEVklzWRUkPndVvw2PrrpjvxOvzPmwHc0hpmq82npi7GRro8dXp0KXnUQmhZbRL7NEVp1uuZmO45vuzKsHrktS3GLWXODVjw+vXXLYx4Hf7njRPd0i3aoAGX6W29GnaV5YdyDj9TFkakje7GHYzDoObfddHtOSpoi2SmzJHrB3hM/XUDDEbxP2/oosszcRlehWXUvzHv4TpBVktHqwenFo8uLVmy4DKLa5d3RtLrmrM3aMFr1183E4sewf+85VWeg1c5ag276NZrM9IJVNcmLEvDNaV62aq+14IAOGFsBt973Ra8Xv11YzXwNfmft7Jg2oS+XOyoC8/cwzi66Dhmgk38kUmP1CUiYWOX1bpD2zWXt2FCp7uq8703APAa9dfNdscR/M/bZLIyouVxqJfeWvG9Je+JVckHQ9+CI9NWxz+blX/KYYvO5n2tAP/vrlZ7+8/h9y+9qeB/Hnt967e5mevX10rALDWK//FaAT5MXdBXdP0C/BAes792c40H+AiAp1e1oH8HgH94g/Lttx1gp63op1eyoM/Bvw5/G/7xFbqJPcCXnmBiwDPb/YKO4FX4OjyCb289db2/Noqicw4i7N6TVtoz8tNwDH+8x/i6Ae7lmaQVENzJFb3Di/BFeAwz+Is9SjeQySpPqbLFlNmyz47z5a/AF+AYFvDmHqibSXTEzoT4Gc3OALaqAP4KPFUJ6n+1x+rGAM6Zd78bgJ0a8QN4GU614vxwD9e1Amy6CcskNrczLx1JIp6HE5UZD/DBHrFr2oNlgG4Odv226BodoryjGJ9q2T/AR3vQrsOCS0ctXZi3ruLlhpFDJYl4HmYtjQCP9rhdn4suySLKDt6wLcC52h8xPlcjju1fn+yhuw4LZsAGUuo2b4Fx2UwQu77uqRHXGtg92aN3tQCbFexc0uk93vhTXbct6y7MulLycoUljx8ngDMBg1tvJjAazpEmOtxlzclvj1vQf1Tx7QlPDpGpqgtdSKz/d9/hdy1vTfFHSmC9dGDZbLiezz7Ac801HirGZsWjydfZyPvHXL/Y8Mjzg8BxTZiuwKz4Eb8sBE9zznszmjvFwHKPIWUnwhqfVRcd4Ck0K6ate48m1oOfrX3/yOtvAsJ8zsPAM89sjnddmuLuDPjX9Bu/L7x7xpMzFk6nWtyQfPg278Gn4Aekz2ZgOmU9eJ37R14vwE/BL8G3aibCiWMWWDQ0ZtkPMnlcGeAu/Ag+8ZyecU5BPuy2ILD+sQqyZhAKmn7XZd+jIMTN9eBL7x95xVLSX4On8EcNlXDqmBlqS13jG4LpmGbkF/0CnOi3H8ETOIXzmnmtb0a16Tzxj1sUvQCBiXZGDtmB3KAefPH94xcUa/6vwRn80GOFyjEXFpba4A1e8KQfFF+259tx5XS4egYn8fQsLGrqGrHbztr+uByTahWuL1NUGbDpsnrwBfePPwHHIf9X4RnM4Z2ABWdxUBlqQ2PwhuDxoS0vvqB1JzS0P4h2nA/QgTrsJFn+Y3AOjs9JFC07CGWX1oNX3T/yHOzgDjwPn1PM3g9Jk9lZrMEpxnlPmBbjyo2+KFXRU52TJM/2ALcY57RUzjObbjqxVw++4P6RAOf58pcVsw9Daje3htriYrpDOonre3CudSe6bfkTEgHBHuDiyu5MCsc7BHhYDx7ePxLjqigXZsw+ijMHFhuwBmtoTPtOxOrTvYJDnC75dnUbhfwu/ZW9AgYd+peL68HD+0emKquiXHhWjJg/UrkJYzuiaL3E9aI/ytrCvAd4GcYZMCkSQxfUg3v3j8c4e90j5ZTPdvmJJGHnOCI2nHS8081X013pHuBlV1gB2MX1YNmWLHqqGN/TWmG0y6clJWthxNUl48q38Bi8vtMKyzzpFdSDhxZ5WBA5ZLt8Jv3895DduBlgbPYAj8C4B8hO68FDkoh5lydC4FiWvBOVqjYdqjiLv92t8yPDjrDaiHdUD15qkSURSGmXJwOMSxWAXYwr3zaAufJ66l+94vv3AO+vPcD7aw/w/toDvL/2AO+vPcD7aw/wHuD9tQd4f+0B3l97gPfXHuD9tQd4f+0B3l97gG8LwP8G/AL8O/A5OCq0Ys2KIdv/qOIXG/4mvFAMF16gZD+2Xvu/B8as5+8bfllWyg0zaNO5bfXj6vfhhwD86/Aq3NfRS9t9WPnhfnvCIw/CT8GLcFTMnpntdF/z9V+PWc/vWoIH+FL3Znv57PitcdGP4R/C34avw5fgRVUInCwbsn1yyA8C8zm/BH8NXoXnVE6wVPjdeCI38kX/3+Ct9dbz1pTmHFRu+Hm4O9Ch3clr99negxfwj+ER/DR8EV6B5+DuQOnTgUw5rnkY+FbNU3gNXh0o/JYTuWOvyBf9FvzX663HH/HejO8LwAl8Hl5YLTd8q7sqA3wbjuExfAFegQdwfyDoSkWY8swzEf6o4Qyewefg+cHNbqMQruSL/u/WWc+E5g7vnnEXgDmcDeSGb/F4cBcCgT+GGRzDU3hZYburAt9TEtHgbM6JoxJ+6NMzzTcf6c2bycv2+KK/f+l6LBzw5IwfqZJhA3M472pWT/ajKxnjv4AFnMEpnBTPND6s2J7qHbPAqcMK74T2mZ4VGB9uJA465It+/eL1WKhYOD7xHOkr1ajK7d0C4+ke4Hy9qXZwpgLr+Znm/uNFw8xQOSy8H9IzjUrd9+BIfenYaylf9FsXr8fBAadnPIEDna8IBcwlxnuA0/Wv6GAWPd7dDIKjMdSWueAsBj4M7TOd06qBbwDwKr7oleuxMOEcTuEZTHWvDYUO7aHqAe0Bbq+HEFRzOz7WVoTDQkVds7A4sIIxfCQdCefFRoIOF/NFL1mPab/nvOakSL/Q1aFtNpUb/nFOVX6gzyg/1nISyDfUhsokIzaBR9Kxm80s5mK+6P56il1jXic7nhQxsxSm3OwBHl4fFdLqi64nDQZvqE2at7cWAp/IVvrN6/BFL1mPhYrGMBfOi4PyjuSGf6wBBh7p/FZTghCNWGgMzlBbrNJoPJX2mW5mwZfyRffXo7OFi5pZcS4qZUrlViptrXtw+GQoyhDPS+ANjcGBNRiLCQDPZPMHuiZfdFpPSTcQwwKYdRNqpkjm7AFeeT0pJzALgo7g8YYGrMHS0iocy+YTm2vyRUvvpXCIpQ5pe666TJrcygnScUf/p0NDs/iAI/nqDHC8TmQT8x3NF91l76oDdQGwu61Z6E0ABv7uO1dbf/37Zlv+Zw/Pbh8f1s4Avur6657/+YYBvur6657/+YYBvur6657/+YYBvur6657/+aYBvuL6657/+VMA8FXWX/f8zzcN8BXXX/f8zzcNMFdbf93zP38KLPiK6697/uebtuArrr/u+Z9vGmCusP6653/+1FjwVdZf9/zPN7oHX339dc//fNMu+irrr3v+50+Bi+Zq6697/uebA/jz8Pudf9ht/fWv517J/XUzAP8C/BAeX9WCDrUpZ3/dEMBxgPcfbtTVvsYV5Yn32u03B3Ac4P3b8I+vxNBKeeL9dRMAlwO83959qGO78sT769oB7g3w/vGVYFzKE++v6wV4OMD7F7tckFkmT7y/rhHgpQO8b+4Y46XyxPvrugBeNcB7BRiX8sT767oAvmCA9woAHsoT76+rBJjLBnh3txOvkifeX1dswZcO8G6N7sXyxPvr6i340gHe3TnqVfLE++uKAb50gHcXLnrX8sR7gNdPRqwzwLu7Y/FO5Yn3AK9jXCMGeHdgxDuVJ75VAI8ljP7PAb3/RfjcZfePHBB+79dpfpH1CanN30d+mT1h9GqAxxJGM5LQeeQ1+Tb+EQJrElLb38VHQ94TRq900aMIo8cSOo+8Dp8QfsB8zpqE1NO3OI9Zrj1h9EV78PqE0WMJnUdeU6E+Jjyk/hbrEFIfeWbvId8H9oTRFwdZaxJGvziW0Hn0gqYB/wyZ0PwRlxJST+BOw9m77Amj14ii1yGM/txYQudN0qDzGe4EqfA/5GJCagsHcPaEPWH0esekSwmjRxM6b5JEcZ4ww50ilvAOFxBSx4yLW+A/YU8YvfY5+ALC6NGEzhtmyZoFZoarwBLeZxUhtY4rc3bKnjB6TKJjFUHzJoTOozF2YBpsjcyxDgzhQ1YRUse8+J4wenwmaylB82hC5w0zoRXUNXaRBmSMQUqiWSWkLsaVqc/ZE0aPTFUuJWgeTei8SfLZQeMxNaZSIzbII4aE1Nmr13P2hNHjc9E9guYNCZ032YlNwESMLcZiLQHkE4aE1BFg0yAR4z1h9AiAGRA0jyZ03tyIxWMajMPWBIsxYJCnlITU5ShiHYdZ94TR4wCmSxg9jtB5KyPGYzymAYexWEMwAPIsAdYdV6aObmNPGD0aYLoEzaMJnTc0Ygs+YDw0GAtqxBjkuP38bMRWCHn73xNGjz75P73WenCEJnhwyVe3AEe8TtKdJcYhBl97wuhNAObK66lvD/9J9NS75v17wuitAN5fe4D31x7g/bUHeH/tAd5fe4D3AO+vPcD7aw/w/toDvL/2AO+vPcD7aw/w/toDvAd4f/24ABzZ8o+KLsSLS+Pv/TqTb3P4hKlQrTGh+fbIBT0Axqznnb+L/V2mb3HkN5Mb/nEHeK7d4IcDld6lmDW/iH9E+AH1MdOw/Jlu2T1xNmY98sv4wHnD7D3uNHu54WUuOsBTbQuvBsPT/UfzNxGYzwkP8c+Yz3C+r/i6DcyRL/rZ+utRwWH5PmfvcvYEt9jLDS/bg0/B64DWKrQM8AL8FPwS9beQCe6EMKNZYJol37jBMy35otdaz0Bw2H/C2Smc7+WGB0HWDELBmOByA3r5QONo4V+DpzR/hFS4U8wMW1PXNB4TOqYz9urxRV++ntWCw/U59Ty9ebdWbrgfRS9AYKKN63ZokZVygr8GZ/gfIhZXIXPsAlNjPOLBby5c1eOLvmQ9lwkOy5x6QV1j5TYqpS05JtUgUHUp5toHGsVfn4NX4RnMCe+AxTpwmApTYxqMxwfCeJGjpXzRF61nbcHhUBPqWze9svwcHJ+S6NPscKrEjug78Dx8Lj3T8D4YxGIdxmJcwhi34fzZUr7olevZCw5vkOhoClq5zBPZAnygD/Tl9EzDh6kl3VhsHYcDEb+hCtJSvuiV69kLDm+WycrOTArHmB5/VYyP6jOVjwgGawk2zQOaTcc1L+aLXrKeveDwZqlKrw8U9Y1p66uK8dEzdYwBeUQAY7DbyYNezBfdWQ97weEtAKYQg2xJIkuveAT3dYeLGH+ShrWNwZgN0b2YL7qznr3g8JYAo5bQBziPjx7BPZ0d9RCQp4UZbnFdzBddor4XHN4KYMrB2qHFRIzzcLAHQZ5the5ovui94PCWAPefaYnxIdzRwdHCbuR4B+tbiy96Lzi8E4D7z7S0mEPd+eqO3cT53Z0Y8SV80XvB4Z0ADJi/f7X113f+7p7/+UYBvur6657/+YYBvur6657/+aYBvuL6657/+aYBvuL6657/+aYBvuL6657/+aYBvuL6657/+VMA8FXWX/f8z58OgK+y/rrnf75RgLna+uue//lTA/CV1V/3/M837aKvvv6653++UQvmauuve/7nTwfAV1N/3fM/fzr24Cuuv+75nz8FFnxl9dc9//MOr/8/glixwRuUfM4AAAAASUVORK5CYII="}function oLe(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAAAhCAAAAABIXyLAAAAAOElEQVRIx2NgGAWjYBSMglEwEICREYRgFBZBqDCSLA2MGPUIVQETE9iNUAqLR5gIeoQKRgwXjwAAGn4AtaFeYLEAAAAASUVORK5CYII="}var sLe=T(T({},Ni),{tDepth:hr("texture","rgba","ubyte","nearest"),uTexSize:Ye("v2"),dOrthographic:nr("number"),uNear:Ye("f"),uFar:Ye("f"),uMaxPossibleViewZDiff:Ye("f")});function uLe(e,t){var r=T(T({},zi),{tDepth:N.create(t),uTexSize:N.create(Xe.create(t.getWidth(),t.getHeight())),dOrthographic:N.create(0),uNear:N.create(1),uFar:N.create(1e4),uMaxPossibleViewZDiff:N.create(.5)}),n=T({},sLe),a=Wn("outlines",Yo,kFe),i=li(e,"triangles",a,n,r);return ui(i,r)}var lLe=T(T({},Ni),{tDepth:hr("texture","rgba","ubyte","nearest"),uSamples:Ye("v3[]"),dNSamples:nr("number"),uProjection:Ye("m4"),uInvProjection:Ye("m4"),uBounds:Ye("v4"),uTexSize:Ye("v2"),uRadius:Ye("f"),uBias:Ye("f")});function cLe(e,t){var r=T(T({},zi),{tDepth:N.create(t),uSamples:N.create([0,0,1]),dNSamples:N.create(1),uProjection:N.create(de.identity()),uInvProjection:N.create(de.identity()),uBounds:N.create(Mr()),uTexSize:N.create(Xe.create(e.gl.drawingBufferWidth,e.gl.drawingBufferHeight)),uRadius:N.create(8),uBias:N.create(.025)}),n=T({},lLe),a=Wn("ssao",Yo,RFe),i=li(e,"triangles",a,n,r);return ui(i,r)}var dLe=T(T({},Ni),{tSsaoDepth:hr("texture","rgba","ubyte","nearest"),uTexSize:Ye("v2"),uKernel:Ye("f[]"),dOcclusionKernelSize:nr("number"),uBlurDirectionX:Ye("f"),uBlurDirectionY:Ye("f"),uMaxPossibleViewZDiff:Ye("f"),uNear:Ye("f"),uFar:Ye("f"),uBounds:Ye("v4"),dOrthographic:nr("number")});function rN(e,t,r){var n=T(T({},zi),{tSsaoDepth:N.create(t),uTexSize:N.create(Xe.create(t.getWidth(),t.getHeight())),uKernel:N.create([0]),dOcclusionKernelSize:N.create(1),uBlurDirectionX:N.create(r==="horizontal"?1:0),uBlurDirectionY:N.create(r==="vertical"?1:0),uMaxPossibleViewZDiff:N.create(.5),uNear:N.create(0),uFar:N.create(1e4),uBounds:N.create(Mr()),dOrthographic:N.create(0)}),a=T({},dLe),i=Wn("ssao_blur",Yo,OFe),o=li(e,"triangles",i,a,n);return ui(o,n)}function fLe(e){for(var t=e/3,r=Math.floor((e+1)/2),n=[],a=0;a<r;a++)n.push(1/(Math.sqrt(2*Math.PI)*t)*Math.exp(-a*a/(2*t*t)));return n}function pLe(e,t){for(var r=[],n=0;n<t;n++){var a=(n*n+2*n+1)/(t*t);a=.1+a*(1-.1),r.push(e[n][0]*a),r.push(e[n][1]*a),r.push(e[n][2]*a)}return r}var hLe=T(T({},Ni),{tSsaoDepth:hr("texture","rgba","ubyte","nearest"),tColor:hr("texture","rgba","ubyte","nearest"),tDepth:hr("texture","rgba","ubyte","nearest"),tOutlines:hr("texture","rgba","ubyte","nearest"),uTexSize:Ye("v2"),dOrthographic:nr("number"),uNear:Ye("f"),uFar:Ye("f"),uFogNear:Ye("f"),uFogFar:Ye("f"),uFogColor:Ye("v3"),uTransparentBackground:Ye("b"),uMaxPossibleViewZDiff:Ye("f"),dOcclusionEnable:nr("boolean"),dOutlineEnable:nr("boolean"),dOutlineScale:nr("number"),uOutlineThreshold:Ye("f")});function mLe(e,t,r,n,a){var i=T(T({},zi),{tSsaoDepth:N.create(a),tColor:N.create(t),tDepth:N.create(r),tOutlines:N.create(n),uTexSize:N.create(Xe.create(t.getWidth(),t.getHeight())),dOrthographic:N.create(0),uNear:N.create(1),uFar:N.create(1e4),uFogNear:N.create(1e4),uFogFar:N.create(1e4),uFogColor:N.create(A.create(1,1,1)),uTransparentBackground:N.create(!1),uMaxPossibleViewZDiff:N.create(.5),dOcclusionEnable:N.create(!1),dOutlineEnable:N.create(!1),dOutlineScale:N.create(1),uOutlineThreshold:N.create(.33)}),o=T({},hLe),s=Wn("postprocessing",Yo,BFe),u=li(e,"triangles",s,o,i);return ui(u,i)}var c$={occlusion:M.MappedStatic("on",{on:M.Group({samples:M.Numeric(32,{min:1,max:256,step:1}),radius:M.Numeric(5,{min:0,max:10,step:.1},{description:"Final radius is 2^x."}),bias:M.Numeric(.8,{min:0,max:3,step:.1}),blurKernelSize:M.Numeric(15,{min:1,max:25,step:2})}),off:M.Group({})},{cycle:!0,description:"Darken occluded crevices with the ambient occlusion effect"}),outline:M.MappedStatic("off",{on:M.Group({scale:M.Numeric(1,{min:1,max:5,step:1}),threshold:M.Numeric(.33,{min:.01,max:1,step:.01})}),off:M.Group({})},{cycle:!0,description:"Draw outline around 3D objects"}),antialiasing:M.MappedStatic("smaa",{fxaa:M.Group(LFe),smaa:M.Group(YFe),off:M.Group({})},{options:[["fxaa","FXAA"],["smaa","SMAA"],["off","Off"]],description:"Smooth pixel edges"})},Nc=function(){function e(t,r){this.webgl=t,this.ssaoScale=this.calcSsaoScale();var n=r.colorTarget,a=r.depthTexture,i=n.getWidth(),o=n.getHeight();this.nSamples=1,this.blurKernelSize=1,this.target=t.createRenderTarget(i,o,!1,"uint8","nearest"),this.outlinesTarget=t.createRenderTarget(i,o,!1),this.outlinesRenderable=uLe(t,a),this.randomHemisphereVector=[];for(var s=0;s<256;s++){var u=A();u[0]=Math.random()*2-1,u[1]=Math.random()*2-1,u[2]=Math.random(),A.normalize(u,u),A.scale(u,u,Math.random()),this.randomHemisphereVector.push(u)}this.ssaoFramebuffer=t.resources.framebuffer(),this.ssaoBlurFirstPassFramebuffer=t.resources.framebuffer(),this.ssaoBlurSecondPassFramebuffer=t.resources.framebuffer();var l=Math.floor(i*this.ssaoScale),c=Math.floor(o*this.ssaoScale);this.ssaoDepthTexture=t.resources.texture("image-uint8","rgba","ubyte","nearest"),this.ssaoDepthTexture.define(l,c),this.ssaoDepthTexture.attachFramebuffer(this.ssaoFramebuffer,"color0"),this.ssaoDepthBlurProxyTexture=t.resources.texture("image-uint8","rgba","ubyte","nearest"),this.ssaoDepthBlurProxyTexture.define(l,c),this.ssaoDepthBlurProxyTexture.attachFramebuffer(this.ssaoBlurFirstPassFramebuffer,"color0"),this.ssaoDepthTexture.attachFramebuffer(this.ssaoBlurSecondPassFramebuffer,"color0"),this.ssaoRenderable=cLe(t,a),this.ssaoBlurFirstPassRenderable=rN(t,this.ssaoDepthTexture,"horizontal"),this.ssaoBlurSecondPassRenderable=rN(t,this.ssaoDepthBlurProxyTexture,"vertical"),this.renderable=mLe(t,n.texture,a,this.outlinesTarget.texture,this.ssaoDepthTexture)}return e.isEnabled=function(t){return t.occlusion.name==="on"||t.outline.name==="on"},e.prototype.calcSsaoScale=function(){return Math.min(1,1/this.webgl.pixelRatio)},e.prototype.setSize=function(t,r){var n=this.renderable.values.uTexSize.ref.value,a=n[0],i=n[1],o=this.calcSsaoScale();if(t!==a||r!==i||this.ssaoScale!==o){this.ssaoScale=o;var s=Math.floor(t*this.ssaoScale),u=Math.floor(r*this.ssaoScale);this.target.setSize(t,r),this.outlinesTarget.setSize(t,r),this.ssaoDepthTexture.define(s,u),this.ssaoDepthBlurProxyTexture.define(s,u),N.update(this.renderable.values.uTexSize,Xe.set(this.renderable.values.uTexSize.ref.value,t,r)),N.update(this.outlinesRenderable.values.uTexSize,Xe.set(this.outlinesRenderable.values.uTexSize.ref.value,t,r)),N.update(this.ssaoRenderable.values.uTexSize,Xe.set(this.ssaoRenderable.values.uTexSize.ref.value,s,u)),N.update(this.ssaoBlurFirstPassRenderable.values.uTexSize,Xe.set(this.ssaoBlurFirstPassRenderable.values.uTexSize.ref.value,s,u)),N.update(this.ssaoBlurSecondPassRenderable.values.uTexSize,Xe.set(this.ssaoBlurSecondPassRenderable.values.uTexSize.ref.value,s,u))}},e.prototype.updateState=function(t,r,n,a){var i=!1,o=!1,s=!1,u=t.state.mode==="orthographic"?1:0,l=a.outline.name==="on",c=a.occlusion.name==="on",d=de.identity();if(de.invert(d,t.projection),a.occlusion.name==="on"){N.update(this.ssaoRenderable.values.uProjection,t.projection),N.update(this.ssaoRenderable.values.uInvProjection,d);var f=this.renderable.values.uTexSize.ref.value,p=f[0],h=f[1],m=this.ssaoRenderable.values.uBounds,v=t.viewport,g=this.ssaoScale;if(Mr.set(m.ref.value,Math.floor(v.x*g)/(p*g),Math.floor(v.y*g)/(h*g),Math.ceil((v.x+v.width)*g)/(p*g),Math.ceil((v.y+v.height)*g)/(h*g)),N.update(m,m.ref.value),N.update(this.ssaoBlurFirstPassRenderable.values.uBounds,m.ref.value),N.update(this.ssaoBlurSecondPassRenderable.values.uBounds,m.ref.value),N.updateIfChanged(this.ssaoBlurFirstPassRenderable.values.uNear,t.near),N.updateIfChanged(this.ssaoBlurSecondPassRenderable.values.uNear,t.near),N.updateIfChanged(this.ssaoBlurFirstPassRenderable.values.uFar,t.far),N.updateIfChanged(this.ssaoBlurSecondPassRenderable.values.uFar,t.far),this.ssaoBlurFirstPassRenderable.values.dOrthographic.ref.value!==u&&(s=!0),N.updateIfChanged(this.ssaoBlurFirstPassRenderable.values.dOrthographic,u),N.updateIfChanged(this.ssaoBlurSecondPassRenderable.values.dOrthographic,u),this.nSamples!==a.occlusion.params.samples&&(o=!0,this.nSamples=a.occlusion.params.samples,N.update(this.ssaoRenderable.values.uSamples,pLe(this.randomHemisphereVector,this.nSamples)),N.updateIfChanged(this.ssaoRenderable.values.dNSamples,this.nSamples)),N.updateIfChanged(this.ssaoRenderable.values.uRadius,Math.pow(2,a.occlusion.params.radius)),N.updateIfChanged(this.ssaoRenderable.values.uBias,a.occlusion.params.bias),this.blurKernelSize!==a.occlusion.params.blurKernelSize){s=!0,this.blurKernelSize=a.occlusion.params.blurKernelSize;var y=fLe(this.blurKernelSize);N.update(this.ssaoBlurFirstPassRenderable.values.uKernel,y),N.update(this.ssaoBlurSecondPassRenderable.values.uKernel,y),N.updateIfChanged(this.ssaoBlurFirstPassRenderable.values.dOcclusionKernelSize,this.blurKernelSize),N.updateIfChanged(this.ssaoBlurSecondPassRenderable.values.dOcclusionKernelSize,this.blurKernelSize)}}if(a.outline.name==="on"){var b=Math.pow(1e3,a.outline.params.threshold)/1e3,S=b*(t.far-t.near),x=a.outline.params.scale-1;N.updateIfChanged(this.outlinesRenderable.values.uNear,t.near),N.updateIfChanged(this.outlinesRenderable.values.uFar,t.far),N.updateIfChanged(this.outlinesRenderable.values.uMaxPossibleViewZDiff,S),N.updateIfChanged(this.renderable.values.uMaxPossibleViewZDiff,S),N.updateIfChanged(this.renderable.values.uOutlineThreshold,a.outline.params.threshold),this.renderable.values.dOutlineScale.ref.value!==x&&(i=!0),N.updateIfChanged(this.renderable.values.dOutlineScale,x)}N.updateIfChanged(this.renderable.values.uFar,t.far),N.updateIfChanged(this.renderable.values.uNear,t.near),N.updateIfChanged(this.renderable.values.uFogFar,t.fogFar),N.updateIfChanged(this.renderable.values.uFogNear,t.fogNear),N.update(this.renderable.values.uFogColor,vt.toVec3Normalized(this.renderable.values.uFogColor.ref.value,n)),N.updateIfChanged(this.renderable.values.uTransparentBackground,r),this.renderable.values.dOrthographic.ref.value!==u&&(i=!0),N.updateIfChanged(this.renderable.values.dOrthographic,u),this.renderable.values.dOutlineEnable.ref.value!==l&&(i=!0),N.updateIfChanged(this.renderable.values.dOutlineEnable,l),this.renderable.values.dOcclusionEnable.ref.value!==c&&(i=!0),N.updateIfChanged(this.renderable.values.dOcclusionEnable,c),o&&this.ssaoRenderable.update(),s&&(this.ssaoBlurFirstPassRenderable.update(),this.ssaoBlurSecondPassRenderable.update()),i&&this.renderable.update();var C=this.webgl,w=C.gl,_=C.state;_.enable(w.SCISSOR_TEST),_.disable(w.BLEND),_.disable(w.DEPTH_TEST),_.depthMask(!1);var E=t.viewport,P=E.x,D=E.y,k=E.width,F=E.height;w.viewport(P,D,k,F),w.scissor(P,D,k,F)},e.prototype.render=function(t,r,n,a,i){if(this.updateState(t,n,a,i),i.outline.name==="on"&&(this.outlinesTarget.bind(),this.outlinesRenderable.render()),i.occlusion.name==="on"){var o=t.viewport,s=o.x,u=o.y,l=o.width,c=o.height,d=Math.floor(s*this.ssaoScale),f=Math.floor(u*this.ssaoScale),p=Math.ceil(l*this.ssaoScale),h=Math.ceil(c*this.ssaoScale);this.webgl.gl.viewport(d,f,p,h),this.webgl.gl.scissor(d,f,p,h),this.ssaoFramebuffer.bind(),this.ssaoRenderable.render(),this.ssaoBlurFirstPassFramebuffer.bind(),this.ssaoBlurFirstPassRenderable.render(),this.ssaoBlurSecondPassFramebuffer.bind(),this.ssaoBlurSecondPassRenderable.render(),this.webgl.gl.viewport(s,u,l,c),this.webgl.gl.scissor(s,u,l,c)}r?this.webgl.unbindFramebuffer():this.target.bind();var m=this.webgl,v=m.gl,g=m.state;g.clearColor(0,0,0,1),v.clear(v.COLOR_BUFFER_BIT),this.renderable.render()},e}(),nT=function(){function e(t,r){this.drawPass=r;var n=r.colorTarget,a=n.getWidth(),i=n.getHeight();this.target=t.createRenderTarget(a,i,!1),this.fxaa=new NFe(t,this.target.texture),this.smaa=new KFe(t,this.target.texture)}return e.isEnabled=function(t){return t.antialiasing.name!=="off"},e.prototype.setSize=function(t,r){var n=this.target.texture.getWidth(),a=this.target.texture.getHeight();(t!==n||r!==a)&&(this.target.setSize(t,r),this.fxaa.setSize(t,r),this.smaa.supported&&this.smaa.setSize(t,r))},e.prototype._renderFxaa=function(t,r,n){if(n.antialiasing.name==="fxaa"){var a=Nc.isEnabled(n)?this.drawPass.postprocessing.target.texture:this.drawPass.colorTarget.texture;this.fxaa.update(a,n.antialiasing.params),this.fxaa.render(t.viewport,r?void 0:this.target)}},e.prototype._renderSmaa=function(t,r,n){if(n.antialiasing.name==="smaa"){var a=Nc.isEnabled(n)?this.drawPass.postprocessing.target.texture:this.drawPass.colorTarget.texture;this.smaa.update(a,n.antialiasing.params),this.smaa.render(t.viewport,r?void 0:this.target)}},e.prototype.render=function(t,r,n){if(n.antialiasing.name!=="off"){if(n.antialiasing.name==="fxaa")this._renderFxaa(t,r,n);else if(n.antialiasing.name==="smaa"){if(!this.smaa.supported)throw new Error('SMAA not supported, missing "HTMLImageElement"');this._renderSmaa(t,r,n)}}},e}(),vLe=`
precision highp float;
precision highp sampler2D;

uniform sampler2D tColor;
uniform vec2 uTexSize;
uniform float uWeight;

void main() {
    vec2 coords = gl_FragCoord.xy / uTexSize;
    gl_FragColor = texture2D(tColor, coords) * uWeight;
}
`,gLe=T(T({},Ni),{tColor:hr("texture","rgba","ubyte","nearest"),uTexSize:Ye("v2"),uWeight:Ye("f")}),yLe=Wn("compose",Yo,vLe);function bLe(e,t){var r=T(T({},zi),{tColor:N.create(t),uTexSize:N.create(Xe.create(t.getWidth(),t.getHeight())),uWeight:N.create(1)}),n=T({},gLe),a=li(e,"triangles",yLe,n,r);return ui(a,r)}var d$={mode:M.Select("off",[["off","Off"],["on","On"],["temporal","Temporal"]]),sampleLevel:M.Numeric(2,{min:0,max:5,step:1})},n3=function(){function e(t,r){this.webgl=t,this.drawPass=r;var n=t.extensions,a=n.colorBufferFloat,i=n.textureFloat,o=n.colorBufferHalfFloat,s=n.textureHalfFloat,u=r.colorTarget.getWidth(),l=r.colorTarget.getHeight();this.colorTarget=t.createRenderTarget(u,l,!1);var c=o&&s?"fp16":a&&i?"float32":"uint8";this.composeTarget=t.createRenderTarget(u,l,!1,c),this.holdTarget=t.createRenderTarget(u,l,!1),this.compose=bLe(t,r.colorTarget.texture)}return e.isEnabled=function(t){return t.mode!=="off"},e.prototype.syncSize=function(){var t=this.drawPass.colorTarget.getWidth(),r=this.drawPass.colorTarget.getHeight(),n=this.compose.values.uTexSize.ref.value,a=n[0],i=n[1];(t!==a||r!==i)&&(this.colorTarget.setSize(t,r),this.composeTarget.setSize(t,r),this.holdTarget.setSize(t,r),N.update(this.compose.values.uTexSize,Xe.set(this.compose.values.uTexSize.ref.value,t,r)))},e.prototype.render=function(t,r,n,a,i,o,s,u){return u.multiSample.mode==="temporal"?this.renderTemporalMultiSample(t,r,n,a,i,o,s,u):(this.renderMultiSample(r,n,a,i,o,s,u),t)},e.prototype.bindOutputTarget=function(t){t?this.webgl.unbindFramebuffer():this.colorTarget.bind()},e.prototype.renderMultiSample=function(t,r,n,a,i,o,s){var u=this,l=u.compose,c=u.composeTarget,d=u.drawPass,f=u.webgl,p=f.gl,h=f.state,m=uI[Math.max(0,Math.min(s.multiSample.sampleLevel,5))],v=r.viewport,g=v.x,y=v.y,b=v.width,S=v.height,x=1/m.length,C=1/32;r.viewOffset.enabled=!0,N.update(l.values.tColor,d.getColorTarget(s.postprocessing).texture),l.update();for(var w=0;w<m.length;++w){var _=m[w];Sa.setViewOffset(r.viewOffset,b,S,_[0],_[1],b,S),r.update();var E=-.5+(w+.5)/m.length,P=x+C*E;N.update(l.values.uWeight,P),d.render(t,r,n,a,!1,o,s.postprocessing),c.bind(),h.enable(p.BLEND),h.blendEquationSeparate(p.FUNC_ADD,p.FUNC_ADD),h.blendFuncSeparate(p.ONE,p.ONE,p.ONE,p.ONE),h.disable(p.DEPTH_TEST),h.depthMask(!1),p.viewport(g,y,b,S),p.scissor(g,y,b,S),w===0&&(h.clearColor(0,0,0,0),p.clear(p.COLOR_BUFFER_BIT)),l.render()}N.update(l.values.uWeight,1),N.update(l.values.tColor,c.texture),l.update(),this.bindOutputTarget(i),p.viewport(g,y,b,S),p.scissor(g,y,b,S),h.disable(p.BLEND),l.render(),r.viewOffset.enabled=!1,r.update()},e.prototype.renderTemporalMultiSample=function(t,r,n,a,i,o,s,u){var l=this,c=l.compose,d=l.composeTarget,f=l.holdTarget,p=l.drawPass,h=l.webgl,m=h.gl,v=h.state,g=uI[Math.max(0,Math.min(u.multiSample.sampleLevel,5))];if(t===-2||t>=g.length)return-2;var y=n.viewport,b=y.x,S=y.y,x=y.width,C=y.height,w=1/g.length;if(t===-1)p.render(r,n,a,i,!1,s,u.postprocessing),N.update(c.values.uWeight,1),N.update(c.values.tColor,p.getColorTarget(u.postprocessing).texture),c.update(),f.bind(),v.disable(m.BLEND),v.disable(m.DEPTH_TEST),v.depthMask(!1),m.viewport(b,S,x,C),m.scissor(b,S,x,C),c.render(),t+=1;else{n.viewOffset.enabled=!0,N.update(c.values.tColor,p.getColorTarget(u.postprocessing).texture),N.update(c.values.uWeight,w),c.update();for(var _=Math.pow(2,Math.max(0,u.multiSample.sampleLevel-2)),E=0;E<_;++E){var P=g[t];if(Sa.setViewOffset(n.viewOffset,x,C,P[0],P[1],x,C),n.update(),p.render(r,n,a,i,!1,s,u.postprocessing),d.bind(),v.enable(m.BLEND),v.blendEquationSeparate(m.FUNC_ADD,m.FUNC_ADD),v.blendFuncSeparate(m.ONE,m.ONE,m.ONE,m.ONE),v.disable(m.DEPTH_TEST),v.depthMask(!1),m.viewport(b,S,x,C),m.scissor(b,S,x,C),t===0&&(v.clearColor(0,0,0,0),m.clear(m.COLOR_BUFFER_BIT)),c.render(),t+=1,t>=g.length)break}}this.bindOutputTarget(o),m.viewport(b,S,x,C),m.scissor(b,S,x,C);var D=t*w;return D>0&&(N.update(c.values.uWeight,1),N.update(c.values.tColor,d.texture),c.update(),v.disable(m.BLEND),c.render()),D<1&&(N.update(c.values.uWeight,1-D),N.update(c.values.tColor,f.texture),c.update(),D===0?v.disable(m.BLEND):v.enable(m.BLEND),c.render()),n.viewOffset.enabled=!1,n.update(),t>=g.length?-2:t},e}(),uI=[[[0,0]],[[4,4],[-4,-4]],[[-2,-6],[6,-2],[-6,2],[2,6]],[[1,-3],[-1,3],[5,1],[-3,-5],[-5,5],[-7,-1],[3,7],[7,-7]],[[1,1],[-1,-3],[-3,2],[4,-1],[-5,-2],[2,5],[5,3],[3,-5],[-2,6],[0,-7],[-4,-6],[-6,4],[-8,0],[7,-4],[6,7],[-7,-8]],[[-4,-7],[-7,-5],[-3,-5],[-5,-4],[-1,-4],[-2,-2],[-6,-1],[-4,0],[-7,1],[-1,2],[-6,3],[-3,3],[-7,6],[-3,6],[-5,7],[-1,7],[5,-7],[1,-6],[6,-5],[4,-4],[2,-3],[7,-2],[1,-1],[4,-1],[2,1],[6,2],[0,4],[4,4],[2,5],[7,5],[5,6],[3,7]]];uI.forEach(function(e){e.forEach(function(t){t[0]*=.0625,t[1]*=.0625})});var f$=function(){function e(t){this.multiSamplePass=t,this.sampleIndex=-2}return e.prototype.update=function(t,r){return t&&(this.sampleIndex=-1),r.mode==="temporal"?this.sampleIndex!==-2:!1},e.prototype.render=function(t,r,n,a,i,o,s){this.sampleIndex=this.multiSamplePass.render(this.sampleIndex,t,r,n,a,i,o,s)},e}(),p$={eyeSeparation:M.Numeric(.064,{min:.01,max:.5,step:.001}),focus:M.Numeric(10,{min:1,max:100,step:.01})},xLe=M.getDefaultValues(p$),_0=function(){function e(t,r){r===void 0&&(r={}),this.parent=t,this.left=new nN,this.right=new nN,this.props=T(T({},xLe),r)}return Object.defineProperty(e.prototype,"viewport",{get:function(){return this.parent.viewport},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"viewOffset",{get:function(){return this.parent.viewOffset},enumerable:!1,configurable:!0}),e.prototype.setProps=function(t){Object.assign(this.props,t)},e.prototype.update=function(){this.parent.update(),SLe(this.parent,this.props,this.left,this.right)},e}();(function(e){function t(r){return"left"in r&&"right"in r}e.is=t})(_0||(_0={}));var nN=function(){function e(){this.viewport=ai.create(0,0,0,0),this.view=de(),this.projection=de(),this.projectionView=de(),this.inverseProjectionView=de(),this.state=Sa.createDefaultSnapshot(),this.viewOffset=Sa.ViewOffset(),this.far=0,this.near=0,this.fogFar=0,this.fogNear=0}return e}(),aN=de.identity(),iN=de.identity();function SLe(e,t,r,n){ai.copy(r.viewport,e.viewport),de.copy(r.view,e.view),de.copy(r.projection,e.projection),Sa.copySnapshot(r.state,e.state),Sa.copyViewOffset(r.viewOffset,e.viewOffset),r.far=e.far,r.near=e.near,r.fogFar=e.fogFar,r.fogNear=e.fogNear,ai.copy(n.viewport,e.viewport),de.copy(n.view,e.view),de.copy(n.projection,e.projection),Sa.copySnapshot(n.state,e.state),Sa.copyViewOffset(n.viewOffset,e.viewOffset),n.far=e.far,n.near=e.near,n.fogFar=e.fogFar,n.fogNear=e.fogNear;var a=Math.floor(e.viewport.width/2),i=a/e.viewport.height;r.viewport.width=a,n.viewport.x+=a,n.viewport.width-=a;var o=t.eyeSeparation/2,s=o*e.near/t.focus,u=e.near*Math.tan(e.state.fov*.5),l,c;aN[12]=-o,iN[12]=o,l=-u*i+s,c=u*i+s,r.projection[0]=2*e.near/(c-l),r.projection[8]=(c+l)/(c-l),de.mul(r.view,r.view,aN),de.mul(r.projectionView,r.projection,r.view),de.invert(r.inverseProjectionView,r.projectionView),l=-u*i-s,c=u*i-s,n.projection[0]=2*e.near/(c-l),n.projection[8]=(c+l)/(c-l),de.mul(n.view,n.view,iN),de.mul(n.projectionView,n.projection,n.view),de.invert(n.inverseProjectionView,n.projectionView)}var aT=Math.pow(2,24)-2,CLe=function(){function e(t,r,n){this.webgl=t,this.drawPass=r,this.pickBaseScale=n;var a=n/t.pixelRatio;this.pickWidth=Math.ceil(r.colorTarget.getWidth()*a),this.pickHeight=Math.ceil(r.colorTarget.getHeight()*a),this.objectPickTarget=t.createRenderTarget(this.pickWidth,this.pickHeight),this.instancePickTarget=t.createRenderTarget(this.pickWidth,this.pickHeight),this.groupPickTarget=t.createRenderTarget(this.pickWidth,this.pickHeight),this.depthPickTarget=t.createRenderTarget(this.pickWidth,this.pickHeight)}return Object.defineProperty(e.prototype,"drawingBufferHeight",{get:function(){return this.drawPass.colorTarget.getHeight()},enumerable:!1,configurable:!0}),e.prototype.syncSize=function(){var t=this.pickBaseScale/this.webgl.pixelRatio,r=Math.ceil(this.drawPass.colorTarget.getWidth()*t),n=Math.ceil(this.drawPass.colorTarget.getHeight()*t);(r!==this.pickWidth||n!==this.pickHeight)&&(this.pickWidth=r,this.pickHeight=n,this.objectPickTarget.setSize(this.pickWidth,this.pickHeight),this.instancePickTarget.setSize(this.pickWidth,this.pickHeight),this.groupPickTarget.setSize(this.pickWidth,this.pickHeight),this.depthPickTarget.setSize(this.pickWidth,this.pickHeight))},e.prototype.renderVariant=function(t,r,n,a,i){var o=this.drawPass.depthTexturePrimitives;t.clear(!1),t.update(r),t.renderPick(n.primitives,r,i,null),t.renderPick(n.volumes,r,i,o),t.renderPick(a.handle.scene,r,i,null),a.camera.isEnabled&&(a.camera.update(r),t.update(a.camera.camera),t.renderPick(a.camera.scene,a.camera.camera,i,null))},e.prototype.render=function(t,r,n,a){this.objectPickTarget.bind(),this.renderVariant(t,r,n,a,"pickObject"),this.instancePickTarget.bind(),this.renderVariant(t,r,n,a,"pickInstance"),this.groupPickTarget.bind(),this.renderVariant(t,r,n,a,"pickGroup"),this.depthPickTarget.bind(),this.renderVariant(t,r,n,a,"depth")},e}(),wLe=function(){function e(t,r,n,a,i,o){this.webgl=t,this.renderer=r,this.scene=n,this.helper=a,this.pickPass=i,this.dirty=!0,this.viewport=ai(),this.setViewport(o.x,o.y,o.width,o.height)}return e.prototype.setupBuffers=function(){var t=this.pickWidth*this.pickHeight*4;(!this.objectBuffer||this.objectBuffer.length!==t)&&(this.objectBuffer=new Uint8Array(t),this.instanceBuffer=new Uint8Array(t),this.groupBuffer=new Uint8Array(t),this.depthBuffer=new Uint8Array(t))},e.prototype.setViewport=function(t,r,n,a){ai.set(this.viewport,t,r,n,a),this.pickScale=this.pickPass.pickBaseScale/this.webgl.pixelRatio,this.pickX=Math.ceil(t*this.pickScale),this.pickY=Math.ceil(r*this.pickScale);var i=Math.floor(n*this.pickScale),o=Math.floor(a*this.pickScale);(i!==this.pickWidth||o!==this.pickHeight)&&(this.pickWidth=i,this.pickHeight=o,this.halfPickWidth=Math.floor(this.pickWidth/2),this.setupBuffers())},e.prototype.syncBuffers=function(){var t=this,r=t.pickX,n=t.pickY,a=t.pickWidth,i=t.pickHeight;this.pickPass.objectPickTarget.bind(),this.webgl.readPixels(r,n,a,i,this.objectBuffer),this.pickPass.instancePickTarget.bind(),this.webgl.readPixels(r,n,a,i,this.instanceBuffer),this.pickPass.groupPickTarget.bind(),this.webgl.readPixels(r,n,a,i,this.groupBuffer),this.pickPass.depthPickTarget.bind(),this.webgl.readPixels(r,n,a,i,this.depthBuffer)},e.prototype.getBufferIdx=function(t,r){return(r*this.pickWidth+t)*4},e.prototype.getDepth=function(t,r){var n=this.getBufferIdx(t,r),a=this.depthBuffer;return b3e(a[n],a[n+1],a[n+2],a[n+3])},e.prototype.getId=function(t,r,n){var a=this.getBufferIdx(t,r);return uk(n[a],n[a+1],n[a+2])},e.prototype.render=function(t){var r=this,n=r.pickX,a=r.pickY,i=r.pickWidth,o=r.pickHeight,s=r.halfPickWidth,u=this,l=u.renderer,c=u.scene,d=u.helper;l.setTransparentBackground(!1),l.setDrawingBufferSize(this.pickPass.objectPickTarget.getWidth(),this.pickPass.objectPickTarget.getHeight()),_0.is(t)?(l.setViewport(n,a,s,o),this.pickPass.render(l,t.left,c,d),l.setViewport(n+s,a,i-s,o),this.pickPass.render(l,t.right,c,d)):(l.setViewport(n,a,i,o),this.pickPass.render(l,t,c,d)),this.dirty=!1},e.prototype.identify=function(t,r,n){var a=this,i=a.webgl,o=a.pickScale;if(!i.isContextLost){t*=i.pixelRatio,r*=i.pixelRatio,r=this.pickPass.drawingBufferHeight-r;var s=this.viewport;if(!(t<s.x||r<s.y||t>s.x+s.width||r>s.y+s.height)){this.dirty&&(this.render(n),this.syncBuffers());var u=t-s.x,l=r-s.y,c=Math.floor(u*o),d=Math.floor(l*o),f=this.getId(c,d,this.objectBuffer);if(!(f===-1||f===aT)){var p=this.getId(c,d,this.instanceBuffer);if(!(p===-1||p===aT)){var h=this.getId(c,d,this.groupBuffer);if(!(h===-1||h===aT)){var m=this.getDepth(c,d),v=A.create(t,s.height-r,m);if(_0.is(n)){var g=Math.floor(s.width/2);t>s.x+g?(v[0]=s.x+(u-g)*2,vS(v,v,s,n.right.inverseProjectionView)):(v[0]=s.x+u*2,vS(v,v,s,n.left.inverseProjectionView))}else vS(v,v,s,n.inverseProjectionView);return{id:{objectId:f,instanceId:p,groupId:h},position:v}}}}}}},e}(),_Le=`
precision highp float;
precision highp sampler2D;

uniform sampler2D tDepthPrimitives;
uniform sampler2D tDepthVolumes;
uniform vec2 uTexSize;

#include common

float getDepth(const in vec2 coords, sampler2D tDepth) {
    #ifdef dPackedDepth
        return unpackRGBAToDepth(texture2D(tDepth, coords));
    #else
        return texture2D(tDepth, coords).r;
    #endif
}

void main() {
    vec2 coords = gl_FragCoord.xy / uTexSize;
    float depth = min(getDepth(coords, tDepthPrimitives), getDepth(coords, tDepthVolumes));
    gl_FragColor = packDepthToRGBA(depth);
}
`,ALe=`
precision highp float;
precision highp sampler2D;

uniform sampler2D tColor;
uniform vec2 uTexSize;

void main() {
    vec2 coords = gl_FragCoord.xy / uTexSize;
    gl_FragColor = texture2D(tColor, coords);
}
`,TLe=`
precision highp float;

uniform sampler2D tWboitA;
uniform sampler2D tWboitB;
uniform vec2 uTexSize;

void main() {
    vec2 coords = gl_FragCoord.xy / uTexSize;

    vec4 accum = texture2D(tWboitA, coords);
    float r = 1.0 - accum.a;

    accum.a = texture2D(tWboitB, coords).r;
    // divisor needs to allow very small values for nice fading
    gl_FragColor = vec4(accum.rgb / clamp(accum.a, 0.00000001, 50000.0), r);
}
`,ELe=T(T({},Ni),{tWboitA:hr("texture","rgba","float","nearest"),tWboitB:hr("texture","rgba","float","nearest"),uTexSize:Ye("v2")}),PLe=Wn("evaluate-wboit",Yo,TLe);function ILe(e,t,r){var n=T(T({},zi),{tWboitA:N.create(t),tWboitB:N.create(r),uTexSize:N.create(Xe.create(t.getWidth(),t.getHeight()))}),a=T({},ELe),i=li(e,"triangles",PLe,a,n);return ui(i,n)}var MLe=function(){function e(t,r,n){if(this.webgl=t,this._supported=!1,!!e.isSupported(t)){var a=t.resources;this.textureA=a.texture("image-float32","rgba","float","nearest"),this.textureA.define(r,n),this.textureB=a.texture("image-float32","rgba","float","nearest"),this.textureB.define(r,n),this.renderable=ILe(t,this.textureA,this.textureB),this.framebuffer=a.framebuffer(),this._supported=!0,this._init()}}return Object.defineProperty(e.prototype,"supported",{get:function(){return this._supported},enumerable:!1,configurable:!0}),e.prototype.bind=function(){var t=this.webgl,r=t.state,n=t.gl;this.framebuffer.bind(),r.clearColor(0,0,0,1),n.clear(n.COLOR_BUFFER_BIT),r.disable(n.DEPTH_TEST),r.blendFuncSeparate(n.ONE,n.ONE,n.ZERO,n.ONE_MINUS_SRC_ALPHA),r.enable(n.BLEND)},e.prototype.render=function(){var t=this.webgl,r=t.state,n=t.gl;r.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA),r.enable(n.BLEND),this.renderable.update(),this.renderable.render()},e.prototype.setSize=function(t,r){var n=this.renderable.values.uTexSize.ref.value,a=n[0],i=n[1];(t!==a||r!==i)&&(this.textureA.define(t,r),this.textureB.define(t,r),N.update(this.renderable.values.uTexSize,Xe.set(this.renderable.values.uTexSize.ref.value,t,r)))},e.prototype.reset=function(){this._supported&&this._init()},e.prototype._init=function(){var t=this.webgl.extensions.drawBuffers;this.framebuffer.bind(),t.drawBuffers([t.COLOR_ATTACHMENT0,t.COLOR_ATTACHMENT1]),this.textureA.attachFramebuffer(this.framebuffer,"color0"),this.textureB.attachFramebuffer(this.framebuffer,"color1")},e.isSupported=function(t){var r=t.extensions,n=r.drawBuffers,a=r.textureFloat,i=r.colorBufferFloat,o=r.depthTexture;if(!a||!i||!o||!n){if(Fr){var s=[];a||s.push("textureFloat"),i||s.push("colorBufferFloat"),o||s.push("depthTexture"),n||s.push("drawBuffers"),console.log('Missing "'+s.join('", "')+'" extensions required for "wboit"')}return!1}else return!0},e}(),DLe=T(T({},Ni),{tDepthPrimitives:hr("texture","depth","ushort","nearest"),tDepthVolumes:hr("texture","depth","ushort","nearest"),uTexSize:Ye("v2"),dPackedDepth:nr("boolean")}),kLe=Wn("depth-merge",Yo,_Le);function RLe(e,t,r,n){var a=T(T({},zi),{tDepthPrimitives:N.create(t),tDepthVolumes:N.create(r),uTexSize:N.create(Xe.create(t.getWidth(),t.getHeight())),dPackedDepth:N.create(n)}),i=T({},DLe),o=li(e,"triangles",kLe,i,a);return ui(o,a)}var OLe=T(T({},Ni),{tColor:hr("texture","rgba","ubyte","nearest"),uTexSize:Ye("v2")}),BLe=Wn("copy",Yo,ALe);function oN(e,t){var r=T(T({},zi),{tColor:N.create(t),uTexSize:N.create(Xe.create(t.getWidth(),t.getHeight()))}),n=T({},OLe),a=li(e,"triangles",BLe,n,r);return ui(a,r)}var h$=function(){function e(t,r,n,a){this.webgl=t;var i=t.extensions,o=t.resources,s=t.isWebGL2;this.drawTarget=f4e(t.gl),this.colorTarget=t.createRenderTarget(r,n,!0,"uint8","linear"),this.packedDepth=!i.depthTexture,this.depthTarget=t.createRenderTarget(r,n),this.depthTexture=this.depthTarget.texture,this.depthTargetPrimitives=this.packedDepth?t.createRenderTarget(r,n):null,this.depthTargetVolumes=this.packedDepth?t.createRenderTarget(r,n):null,this.depthTexturePrimitives=this.depthTargetPrimitives?this.depthTargetPrimitives.texture:o.texture("image-depth","depth",s?"float":"ushort","nearest"),this.depthTextureVolumes=this.depthTargetVolumes?this.depthTargetVolumes.texture:o.texture("image-depth","depth",s?"float":"ushort","nearest"),this.packedDepth||(this.depthTexturePrimitives.define(r,n),this.depthTextureVolumes.define(r,n)),this.depthMerge=RLe(t,this.depthTexturePrimitives,this.depthTextureVolumes,this.packedDepth),this.wboit=a?new MLe(t,r,n):void 0,this.postprocessing=new Nc(t,this),this.antialiasing=new nT(t,this),this.copyFboTarget=oN(t,this.colorTarget.texture),this.copyFboPostprocessing=oN(t,this.postprocessing.target.texture)}return Object.defineProperty(e.prototype,"wboitEnabled",{get:function(){var t;return!!(!((t=this.wboit)===null||t===void 0)&&t.supported)},enumerable:!1,configurable:!0}),e.prototype.reset=function(){var t;(t=this.wboit)===null||t===void 0||t.reset()},e.prototype.setSize=function(t,r){var n,a=this.colorTarget.getWidth(),i=this.colorTarget.getHeight();(t!==a||r!==i)&&(this.colorTarget.setSize(t,r),this.depthTarget.setSize(t,r),this.depthTargetPrimitives?this.depthTargetPrimitives.setSize(t,r):this.depthTexturePrimitives.define(t,r),this.depthTargetVolumes?this.depthTargetVolumes.setSize(t,r):this.depthTextureVolumes.define(t,r),N.update(this.depthMerge.values.uTexSize,Xe.set(this.depthMerge.values.uTexSize.ref.value,t,r)),N.update(this.copyFboTarget.values.uTexSize,Xe.set(this.copyFboTarget.values.uTexSize.ref.value,t,r)),N.update(this.copyFboPostprocessing.values.uTexSize,Xe.set(this.copyFboPostprocessing.values.uTexSize.ref.value,t,r)),!((n=this.wboit)===null||n===void 0)&&n.supported&&this.wboit.setSize(t,r),this.postprocessing.setSize(t,r),this.antialiasing.setSize(t,r))},e.prototype._depthMerge=function(){var t=this.webgl,r=t.state,n=t.gl;this.depthMerge.update(),this.depthTarget.bind(),r.disable(n.BLEND),r.disable(n.DEPTH_TEST),r.disable(n.CULL_FACE),r.depthMask(!1),r.clearColor(1,1,1,1),n.clear(n.COLOR_BUFFER_BIT),this.depthMerge.render()},e.prototype._renderWboit=function(t,r,n,a,i){var o;if(!(!((o=this.wboit)===null||o===void 0)&&o.supported))throw new Error("expected wboit to be supported");this.colorTarget.bind(),t.clear(!0),this.depthTexturePrimitives.attachFramebuffer(this.colorTarget.framebuffer,"depth"),this.colorTarget.bind(),t.clearDepth(),t.renderWboitOpaque(n.primitives,r,null),this.depthTextureVolumes.attachFramebuffer(this.colorTarget.framebuffer,"depth"),this.colorTarget.bind(),t.clearDepth(),t.renderWboitOpaque(n.volumes,r,this.depthTexturePrimitives),this._depthMerge(),Nc.isEnabled(i)&&this.postprocessing.render(r,!1,a,t.props.backgroundColor,i),this.wboit.bind(),t.renderWboitTransparent(n.primitives,r,this.depthTexture),t.renderWboitTransparent(n.volumes,r,this.depthTexture),Nc.isEnabled(i)?(this.depthTexturePrimitives.attachFramebuffer(this.postprocessing.target.framebuffer,"depth"),this.postprocessing.target.bind()):(this.depthTexturePrimitives.attachFramebuffer(this.colorTarget.framebuffer,"depth"),this.colorTarget.bind()),this.wboit.render()},e.prototype._renderBlended=function(t,r,n,a,i,o){if(a?this.drawTarget.bind():(this.colorTarget.bind(),this.packedDepth||this.depthTexturePrimitives.attachFramebuffer(this.colorTarget.framebuffer,"depth")),t.clear(!0),t.renderBlendedOpaque(n.primitives,r,null),!a){this.depthTargetPrimitives&&(this.depthTargetPrimitives.bind(),t.clear(!1),t.renderDepth(n.primitives,r,null),this.colorTarget.bind()),this.packedDepth||(this.depthTextureVolumes.attachFramebuffer(this.colorTarget.framebuffer,"depth"),t.clearDepth()),t.renderBlendedVolumeOpaque(n.volumes,r,this.depthTexturePrimitives),this.depthTargetVolumes&&(this.depthTargetVolumes.bind(),t.clear(!1),t.renderDepth(n.volumes,r,this.depthTexturePrimitives),this.colorTarget.bind()),this._depthMerge(),this.colorTarget.bind(),Nc.isEnabled(o)&&this.postprocessing.render(r,!1,i,t.props.backgroundColor,o),t.renderBlendedVolumeTransparent(n.volumes,r,this.depthTexturePrimitives);var s=Nc.isEnabled(o)?this.postprocessing.target:this.colorTarget;this.packedDepth||this.depthTexturePrimitives.attachFramebuffer(s.framebuffer,"depth"),s.bind()}t.renderBlendedTransparent(n.primitives,r,null)},e.prototype._render=function(t,r,n,a,i,o,s){var u=n.volumes.renderables.length>0,l=Nc.isEnabled(s),c=nT.isEnabled(s),d=r.viewport,f=d.x,p=d.y,h=d.width,m=d.height;t.setViewport(f,p,h,m),t.update(r),o&&!c&&i&&(this.drawTarget.bind(),t.clear(!1)),this.wboitEnabled?this._renderWboit(t,r,n,o,s):this._renderBlended(t,r,n,!u&&!l&&!c&&i,o,s),l?this.postprocessing.target.bind():!i||u||this.wboitEnabled?this.colorTarget.bind():this.drawTarget.bind(),a.debug.isEnabled&&(a.debug.syncVisibility(),t.renderBlended(a.debug.scene,r,null)),a.handle.isEnabled&&t.renderBlended(a.handle.scene,r,null),a.camera.isEnabled&&(a.camera.update(r),t.update(a.camera.camera),t.renderBlended(a.camera.scene,a.camera.camera,null)),c?this.antialiasing.render(r,i,s):i&&(this.drawTarget.bind(),this.webgl.state.disable(this.webgl.gl.DEPTH_TEST),l?this.copyFboPostprocessing.render():(u||this.wboitEnabled)&&this.copyFboTarget.render()),this.webgl.gl.flush()},e.prototype.render=function(t,r,n,a,i,o,s){t.setTransparentBackground(o),t.setDrawingBufferSize(this.colorTarget.getWidth(),this.colorTarget.getHeight()),_0.is(r)?(this._render(t,r.left,n,a,i,o,s),this._render(t,r.right,n,a,i,o,s)):this._render(t,r,n,a,i,o,s)},e.prototype.getColorTarget=function(t){return nT.isEnabled(t)?this.antialiasing.target:Nc.isEnabled(t)?this.postprocessing.target:this.colorTarget},e}(),FLe=T(T({},Wt.Params),{alpha:T(T({},Wt.Params.alpha),{defaultValue:.51}),ignoreLight:T(T({},Wt.Params.ignoreLight),{defaultValue:!0}),colorX:M.Color(gr.red,{isEssential:!0}),colorY:M.Color(gr.green,{isEssential:!0}),colorZ:M.Color(gr.blue,{isEssential:!0}),scale:M.Numeric(.33,{min:.1,max:2,step:.1},{isEssential:!0})}),Cb={axes:M.MappedStatic("on",{on:M.Group(FLe),off:M.Group({})},{cycle:!0,description:"Show camera orientation axes"})},m$=function(){function e(t,r){var n=this;r===void 0&&(r={}),this.webgl=t,this.props={axes:{name:"off",params:{}}},this.eachGroup=function(a,i){if(!n.renderObject||!lI(a))return!1;for(var o=!1,s=n.renderObject.values.uGroupCount.ref.value,u=a.elements,l=0,c=u;l<c.length;l++){var d=c[l],f=d.groupId,p=d.instanceId,h=p*s+f;i(Me.ofSingleton(h))&&(o=!0)}return o},this.scene=w0.create(t),this.camera=new Sa,A.set(this.camera.up,0,1,0),A.set(this.camera.target,0,0,0),this.setProps(r)}return e.prototype.setProps=function(t){var r=this;this.props=hd(this.props,function(n){if(t.axes!==void 0&&(n.axes.name=t.axes.name,t.axes.name==="on")){r.scene.clear();var a=T(T({},t.axes.params),{scale:t.axes.params.scale*r.webgl.pixelRatio});r.renderObject=HLe(a),r.renderObject.state.noClip=!0,r.scene.add(r.renderObject),r.scene.commit(),A.set(r.camera.position,0,0,a.scale*200),de.lookAt(r.camera.view,r.camera.position,r.camera.target,r.camera.up),n.axes.params=T({},t.axes.params)}})},Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this.props.axes.name==="on"},enumerable:!1,configurable:!0}),e.prototype.getLoci=function(t){var r=t.objectId,n=t.groupId,a=t.instanceId;return!this.renderObject||r!==this.renderObject.id||n===0?zr:NLe(this,n,a)},e.prototype.mark=function(t,r){return!Wo.is(Wo.Highlighting,r)||!lI(t)||t.data!==this?!1:Pr.mark(this.renderObject,t,r,this.eachGroup)},e.prototype.update=function(t){if(!!this.renderObject){zLe(this.camera,t.viewport,t.viewOffset),de.extractRotation(this.scene.view,t.view);var r=this.renderObject.values.boundingSphere.ref.value.radius;de.setTranslation(this.scene.view,A.create(-t.viewport.width/2+r,-t.viewport.height/2+r,0))}},e}();function LLe(e){switch(e){case 1:return"X Axis";case 2:return"Y Axis";case 3:return"Z Axis";case 4:return"XY Plane";case 5:return"XZ Plane";case 6:return"YZ Plane";default:return"Axes"}}function NLe(e,t,r){return p_("camera-axes",e,[{groupId:t,instanceId:r}],void 0,function(){return LLe(t)})}function lI(e){return e.kind==="data-loci"&&e.tag==="camera-axes"}function zLe(e,t,r){var n=e.near,a=e.far,i=-t.width/2,o=t.width/2,s=t.height/2,u=-t.height/2,l=(o-i)/2,c=(s-u)/2,d=(o+i)/2,f=(s+u)/2,p=d-l,h=d+l,m=f+c,v=f-c;if(r.enabled){var g=(o-i)/r.width,y=(s-u)/r.height;p+=g*r.offsetX,h=p+g*r.width,m-=y*r.offsetY,v=m-y*r.height}de.ortho(e.projection,p,h,m,v,n,a)}function ULe(e,t){var r=kt.createState(512,256,t),n=.075*e,a=A.scale(A(),A.unitX,e),i=A.scale(A(),A.unitY,e),o=A.scale(A(),A.unitZ,e),s={radiusTop:n,radiusBottom:n,radialSegments:32};r.currentGroup=0,ti(r,A.origin,n,2),r.currentGroup=1,ti(r,a,n,2),gs(r,A.origin,a,1,s),r.currentGroup=2,ti(r,i,n,2),gs(r,A.origin,i,1,s),r.currentGroup=3,ti(r,o,n,2),gs(r,A.origin,o,1,s),A.scale(a,a,.5),A.scale(i,i,.5),A.scale(o,o,.5),r.currentGroup=4,kt.addTriangle(r,A.origin,a,i),kt.addTriangle(r,A.origin,i,a);var u=A.add(A(),a,i);kt.addTriangle(r,u,a,i),kt.addTriangle(r,u,i,a),r.currentGroup=5,kt.addTriangle(r,A.origin,a,o),kt.addTriangle(r,A.origin,o,a);var l=A.add(A(),a,o);kt.addTriangle(r,l,a,o),kt.addTriangle(r,l,o,a),r.currentGroup=6,kt.addTriangle(r,A.origin,i,o),kt.addTriangle(r,A.origin,o,i);var c=A.add(A(),i,o);return kt.addTriangle(r,c,i,o),kt.addTriangle(r,c,o,i),kt.getMesh(r)}function VLe(e,t){var r=100*e.scale,n=ULe(r,t?.geometry);n.setBoundingSphere(He.create(A.create(r/2,r/2,r/2),r+r/4));var a=function(i){switch(i){case 1:return e.colorX;case 2:return e.colorY;case 3:return e.colorZ;default:return gr.grey}};return Nr.create("axes",{},n,a,function(){return 1},function(){return""})}function HLe(e){var t=VLe(e);return Nr.createRenderObject(t,e)}var jLe={transparentBackground:M.Boolean(!1),multiSample:M.Group(d$),postprocessing:M.Group(c$),cameraHelper:M.Group(Cb)},GLe=function(){function e(t,r,n,a,i,o,s){this.webgl=t,this.renderer=r,this.scene=n,this.camera=a,this._width=0,this._height=0,this._camera=new Sa,this.props=T(T({},M.getDefaultValues(jLe)),s),this.drawPass=new h$(t,128,128,o),this.multiSamplePass=new n3(t,this.drawPass),this.multiSampleHelper=new f$(this.multiSamplePass),this.helper={camera:new m$(t,this.props.cameraHelper),debug:i.debug,handle:i.handle},this.setSize(1024,768)}return Object.defineProperty(e.prototype,"colorTarget",{get:function(){return this._colorTarget},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),e.prototype.setSize=function(t,r){t===this._width&&r===this._height||(this._width=t,this._height=r,this.drawPass.setSize(t,r),this.multiSamplePass.syncSize())},e.prototype.setProps=function(t){t===void 0&&(t={}),Object.assign(this.props,t),t.cameraHelper&&this.helper.camera.setProps(t.cameraHelper)},e.prototype.render=function(){Sa.copySnapshot(this._camera.state,this.camera.state),ai.set(this._camera.viewport,0,0,this._width,this._height),this._camera.update(),n3.isEnabled(this.props.multiSample)?(this.multiSampleHelper.render(this.renderer,this._camera,this.scene,this.helper,!1,this.props.transparentBackground,this.props),this._colorTarget=this.multiSamplePass.colorTarget):(this.drawPass.render(this.renderer,this._camera,this.scene,this.helper,!1,this.props.transparentBackground,this.props.postprocessing),this._colorTarget=this.drawPass.getColorTarget(this.props.postprocessing))},e.prototype.getImageData=function(t,r,n){var a,i;this.setSize(t,r),this.render(),this.colorTarget.bind();var o=(a=n?.width)!==null&&a!==void 0?a:t,s=(i=n?.height)!==null&&i!==void 0?i:r,u=new Uint8Array(o*s*4);n?this.webgl.readPixels(n.x,r-n.y-n.height,o,s,u):this.webgl.readPixels(0,0,o,s,u);var l=jh.create(u,o,s);return jh.flipY(l),jh.divideByAlpha(l),new ImageData(new Uint8ClampedArray(u),o,s)},e}(),qLe=T(T({},Wt.Params),{alpha:T(T({},Wt.Params.alpha),{defaultValue:1}),ignoreLight:T(T({},Wt.Params.ignoreLight),{defaultValue:!0}),colorX:M.Color(gr.red,{isEssential:!0}),colorY:M.Color(gr.green,{isEssential:!0}),colorZ:M.Color(gr.blue,{isEssential:!0}),scale:M.Numeric(.33,{min:.1,max:2,step:.1},{isEssential:!0})}),v$={handle:M.MappedStatic("off",{on:M.Group(qLe),off:M.Group({})},{cycle:!0,description:"Show handle tool"})},WLe=function(){function e(t,r){var n=this;r===void 0&&(r={}),this.webgl=t,this.props={handle:{name:"off",params:{}}},this._transform=de(),this.eachGroup=function(a,i){if(!n.renderObject||!sN(a))return!1;for(var o=!1,s=n.renderObject.values.uGroupCount.ref.value,u=a.elements,l=0,c=u;l<c.length;l++){var d=c[l],f=d.groupId,p=d.instanceId,h=p*s+f;i(Me.ofSingleton(h))&&(o=!0)}return o},this.scene=w0.create(t),this.setProps(r)}return e.prototype.getBoundingSphere=function(t,r){return this.renderObject&&(He.copy(t,this.renderObject.values.invariantBoundingSphere.ref.value),de.fromArray(this._transform,this.renderObject.values.aTransform.ref.value,r*16),He.transform(t,t,this._transform)),t},e.prototype.setProps=function(t){var r=this;this.props=hd(this.props,function(n){if(t.handle!==void 0&&(n.handle.name=t.handle.name,t.handle.name==="on")){r.scene.clear();var a=T(T({},t.handle.params),{scale:t.handle.params.scale*r.webgl.pixelRatio});r.renderObject=$Le(a),r.renderObject.state.noClip=!0,r.scene.add(r.renderObject),r.scene.commit(),n.handle.params=T({},t.handle.params)}})},Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this.props.handle.name==="on"},enumerable:!1,configurable:!0}),e.prototype.update=function(t,r,n){!this.renderObject||(de.setTranslation(this.renderObject.values.aTransform.ref.value,r),de.fromMat3(this.renderObject.values.aTransform.ref.value,n),N.update(this.renderObject.values.aTransform,this.renderObject.values.aTransform.ref.value),this.scene.update([this.renderObject],!0))},e.prototype.getLoci=function(t){var r=t.objectId,n=t.groupId,a=t.instanceId;return!this.renderObject||r!==this.renderObject.id?zr:YLe(this,n,a)},e.prototype.mark=function(t,r){return!Wo.is(Wo.Highlighting,r)||!sN(t)||t.data!==this?!1:Pr.mark(this.renderObject,t,r,this.eachGroup)},e}();function XLe(e,t){var r=kt.createState(512,256,t),n=.05*e,a=A.scale(A(),A.unitX,e),i=A.scale(A(),A.unitY,e),o=A.scale(A(),A.unitZ,e),s={radiusTop:n,radiusBottom:n,radialSegments:32};return r.currentGroup=kh.TranslateScreenXY,ti(r,A.origin,n*3,2),r.currentGroup=kh.TranslateObjectX,ti(r,a,n,2),gs(r,A.origin,a,1,s),r.currentGroup=kh.TranslateObjectY,ti(r,i,n,2),gs(r,A.origin,i,1,s),r.currentGroup=kh.TranslateObjectZ,ti(r,o,n,2),gs(r,A.origin,o,1,s),kt.getMesh(r)}var kh={None:0,TranslateScreenXY:1,TranslateObjectX:3,TranslateObjectY:4,TranslateObjectZ:5};function YLe(e,t,r){return p_("handle",e,[{groupId:t,instanceId:r}],function(n){return e.getBoundingSphere(n,r)},function(){return"Handle Helper | Group Id "+t+" | Instance Id "+r})}function sN(e){return e.kind==="data-loci"&&e.tag==="handle"}function KLe(e,t){var r=10*e.scale,n=XLe(r,t?.geometry);n.setBoundingSphere(He.create(A.create(r/2,r/2,r/2),r+r/4));var a=function(i){switch(i){case kh.TranslateObjectX:return e.colorX;case kh.TranslateObjectY:return e.colorY;case kh.TranslateObjectZ:return e.colorZ;default:return gr.grey}};return Nr.create("handle",{},n,a,function(){return 1},function(){return""})}function $Le(e){var t=KLe(e);return Nr.createRenderObject(t,e)}var QLe={debug:M.Group(Yk),camera:M.Group({helper:M.Group(Cb)}),handle:M.Group(v$)},ZLe=M.getDefaultValues(QLe),JLe=function(){function e(t,r,n){n===void 0&&(n={});var a=T(T({},ZLe),n);this.debug=new _Fe(t,r,a.debug),this.camera=new m$(t,a.camera.helper),this.handle=new WLe(t,a.handle)}return e}(),e7e=function(){function e(t,r){r===void 0&&(r={}),this.webgl=t;var n=t.gl;this.draw=new h$(t,n.drawingBufferWidth,n.drawingBufferHeight,r.enableWboit||!1),this.pick=new CLe(t,this.draw,r.pickScale||.25),this.multiSample=new n3(t,this.draw)}return e.prototype.updateSize=function(){var t=this.webgl.gl;this.draw.setSize(t.drawingBufferWidth,t.drawingBufferHeight),this.pick.syncSize(),this.multiSample.syncSize()},e}(),Xs={camera:M.Group({mode:M.Select("perspective",M.arrayToOptions(["perspective","orthographic"]),{label:"Camera"}),helper:M.Group(Cb,{isFlat:!0}),stereo:M.MappedStatic("off",{on:M.Group(p$),off:M.Group({})},{cycle:!0,hideIf:function(e){return e?.mode!=="perspective"}}),manualReset:M.Boolean(!1,{isHidden:!0})},{pivot:"mode"}),cameraFog:M.MappedStatic("on",{on:M.Group({intensity:M.Numeric(15,{min:1,max:100,step:1})}),off:M.Group({})},{cycle:!0,description:"Show fog in the distance"}),cameraClipping:M.Group({radius:M.Numeric(100,{min:0,max:99,step:1},{label:"Clipping",description:"How much of the scene to show."}),far:M.Boolean(!0,{description:"Hide scene in the distance"})},{pivot:"radius"}),viewport:M.MappedStatic("canvas",{canvas:M.Group({}),"static-frame":M.Group({x:M.Numeric(0),y:M.Numeric(0),width:M.Numeric(128),height:M.Numeric(128)}),"relative-frame":M.Group({x:M.Numeric(.33,{min:0,max:1,step:.01}),y:M.Numeric(.33,{min:0,max:1,step:.01}),width:M.Numeric(.5,{min:.01,max:1,step:.01}),height:M.Numeric(.5,{min:.01,max:1,step:.01})})}),cameraResetDurationMs:M.Numeric(250,{min:0,max:1e3,step:1},{description:"The time it takes to reset the camera."}),transparentBackground:M.Boolean(!1),multiSample:M.Group(d$),postprocessing:M.Group(c$),renderer:M.Group(aI),trackball:M.Group(l$),debug:M.Group(Yk),handle:M.Group(v$)},Kk=M.getDefaultValues(Xs),cI;(function(e){e.DefaultAttribs={antialias:!0,preserveDrawingBuffer:!0,pixelScale:1,pickScale:.25,enableWboit:!0};function t(r,n){n===void 0&&(n={});var a=T(T({},e.DefaultAttribs),n),i=a.antialias,o=a.preserveDrawingBuffer,s=a.pixelScale,u=p4e(r,{antialias:i,preserveDrawingBuffer:o,alpha:!0,depth:!0,premultipliedAlpha:!0});if(u===null)throw new Error("Could not create a WebGL rendering context");var l=nI.fromElement(r,{pixelScale:s}),c=y4e(u,{pixelScale:s}),d=new e7e(c,n);if(Fr){var f=u.getExtension("WEBGL_lose_context");f&&r.addEventListener("mousedown",function(v){c.isContextLost||!v.shiftKey||!v.ctrlKey||!v.altKey||(Fr&&console.log("lose context"),f.loseContext(),setTimeout(function(){!c.isContextLost||(Fr&&console.log("restore context"),f.restoreContext())},1e3))},!1)}var p=new Wf(0),h=function(v){c.setContextLost(),v.preventDefault(),Fr&&console.log("context lost"),p.next(Gn())},m=function(){!c.isContextLost||(c.handleContextRestored(function(){d.draw.reset()}),Fr&&console.log("context restored"))};return r.addEventListener("webglcontextlost",h,!1),r.addEventListener("webglcontextrestored",m,!1),{canvas:r,webgl:c,input:l,passes:d,attribs:a,contextLost:p,contextRestored:c.contextRestored,dispose:function(v){l.dispose(),r.removeEventListener("webglcontextlost",h,!1),r.removeEventListener("webglcontextrestored",m,!1),c.destroy(v)}}}e.fromCanvas=t})(cI||(cI={}));var t7e=typeof window<"u"?window.requestAnimationFrame:function(e){return setImmediate(function(){return e(Date.now())})},r7e=typeof window<"u"?window.cancelAnimationFrame:function(e){return clearImmediate(e)},dI;(function(e){function t(r,n){var a=r.webgl,i=r.input,o=r.passes,s=r.attribs;n===void 0&&(n={});var u=T(T({},Kk),n),l=new Map,c=new Map,d=new Wf(0),f=Gn(),p=new Wf(0),h=new Wf(0),m=a.gl,v=a.contextRestored,g=0,y=0,b=128,S=128;Re();var x=w0.create(a),C=new Sa({position:A.create(0,0,100),mode:u.camera.mode,fog:u.cameraFog.name==="on"?u.cameraFog.params.intensity:0,clipFar:u.cameraClipping.far},{x:g,y,width:b,height:S},{pixelScale:s.pixelScale}),w=new _0(C,u.camera.stereo.params),_=oI.create(i,C,u.trackball),E=iI.create(a,u.renderer),P=new JLe(a,x,u),D=new wLe(a,E,x,P,o.pick,{x:g,y,width:b,height:S}),k=new DFe(Se,V,i,C),F=new f$(o.multiSample),X=!1,U=!1,j=void 0,te=void 0,q=!1,W=!0;function V(Fe){var tt=zr,wt=mr.Empty;if(Fe){var dt=P.camera.getLoci(Fe);if(dt!==zr)return{loci:dt,repr:wt};tt=P.handle.getLoci(Fe),l.forEach(function(Et,oe){var ge=oe.getLoci(Fe);Ku(ge)||(Ku(tt)||console.warn("found another loci, this should not happen"),tt=ge,wt=oe)})}return{loci:tt,repr:wt}}function ee(Fe,tt){var wt=Fe.repr,dt=Fe.loci,Et=!1;if(wt?Et=wt.mark(dt,tt):(Et=P.handle.mark(dt,tt),Et=P.camera.mark(dt,tt)||Et,l.forEach(function(ge,Ee){Et=Ee.mark(dt,tt)||Et})),Et){x.update(void 0,!0),P.handle.scene.update(void 0,!0),P.camera.scene.update(void 0,!0);var oe=D.dirty;re(!0),D.dirty=oe}}function ue(Fe){if(a.isContextLost)return!1;var tt=!1;if(q&&(ht(!1),q=!1,tt=!0),g>m.drawingBufferWidth||g+b<0||y>m.drawingBufferHeight||y+S<0)return!1;var wt=!1;_.update(R);var dt=C.update(),Et=F.update(Fe||dt,u.multiSample);if(tt||Fe||dt||Et){var oe=C;u.camera.stereo.name==="on"&&(w.update(),oe=w),n3.isEnabled(u.multiSample)?F.render(E,oe,x,P,!0,u.transparentBackground,u):o.draw.render(E,oe,x,P,!0,u.transparentBackground,u.postprocessing),D.dirty=!0,wt=!0}return wt}var $=!1,Q=!1,R=0,Y=!1;function re(Fe){Y||(ue(!!Fe||$)&&W&&p.next(Gn()-f),$=!1,X=!1)}function K(Fe){X||(X=!0,$=!!Fe)}var L=0;function H(Fe,tt){R=Fe,ie(tt?.isSynchronous),C.transition.tick(R),!tt?.manualDraw&&(re(!1),!C.transition.inTransition&&!a.isContextLost&&k.tick(R))}function Z(){H(Gn()),L=t7e(Z)}function fe(Fe){f=Fe,_.start(Fe)}function me(){Y=!1,_.start(Gn()),L===0&&Z()}function xe(Fe){Fe===void 0&&(Fe=!1),Y=Fe,r7e(L),L=0}function Se(Fe,tt){var wt=u.camera.stereo.name==="on"?w:C;return a.isContextLost?void 0:D.identify(Fe,tt,wt)}function ie(Fe){Fe===void 0&&(Fe=!1);var tt=Te(Fe);tt&&(le(),Q&&(P.debug.isEnabled&&P.debug.update(),re(!0),Q=!1),h.next(Gn()))}function le(){if(!!U){var Fe=x.boundingSphereVisible,tt=Fe.center,wt=Fe.radius,dt=_.props.autoAdjustMinMaxDistance;if(dt.name==="on"){var Et=dt.params.minDistanceFactor*wt+dt.params.minDistancePadding,oe=Math.max(dt.params.maxDistanceFactor*wt,dt.params.maxDistanceMin);_.setProps({minDistance:Et,maxDistance:oe})}if(wt>0){var ge=j===void 0?u.cameraResetDurationMs:j,Ee=C.getFocus(tt,wt),Ze=typeof te=="function"?te(x,C):te,xt=Ze?T(T({},Ee),Ze):Ee;C.setState(T(T({},xt),{radiusMax:x.boundingSphere.radius}),ge)}j=void 0,te=void 0,U=!1}}var O=He(),G=He();function ve(){if(C.state.radiusMax===0)return!0;if(C.transition.inTransition||te)return!1;var Fe=!0;He.set(G,C.state.target,C.state.radius);for(var tt=0,wt=x.renderables;tt<wt.length;tt++){var dt=wt[tt];if(!!dt.state.visible){var Et=dt.values.boundingSphere.ref.value;if(!!Et.radius){var oe=A.distance(G.center,Et.center);if((oe>G.radius||oe>Et.radius||Et.radius>C.state.radiusMax)&&!He.includes(O,Et))return!0;He.overlaps(G,Et)&&(Fe=!1)}}}return Fe}var we=250;function Te(Fe){return x.needsCommit?(He.copy(O,x.boundingSphereVisible),x.commit(Fe?void 0:we)?(P.debug.isEnabled&&P.debug.update(),!u.camera.manualReset&&(d.value===0||ve())&&(U=!0),O.radius===0&&(j=0),C.setState({radiusMax:x.boundingSphere.radius},0),d.next(l.size),Fr&&Ue(),!0):!1):!0}function Ue(){console.table(x.renderables.map(function(Et){return{drawCount:Et.values.drawCount.ref.value,instanceCount:Et.values.instanceCount.ref.value,materialId:Et.materialId,renderItemId:Et.id}})),console.log(a.stats);var Fe=a.resources.getByteCounts(),tt=Fe.texture,wt=Fe.attribute,dt=Fe.elements;console.log({texture:(tt/1024/1024).toFixed(3)+" MiB",attribute:(wt/1024/1024).toFixed(3)+" MiB",elements:(dt/1024/1024).toFixed(3)+" MiB"})}function Ge(Fe){st(Fe);var tt=l.get(Fe),wt=new Set;Fe.renderObjects.forEach(function(dt){return wt.add(dt)}),tt?Aa.areEqual(wt,tt)||(wt.forEach(function(dt){tt.has(dt)||x.add(dt)}),tt.forEach(function(dt){wt.has(dt)||x.remove(dt)})):Fe.renderObjects.forEach(function(dt){return x.add(dt)}),l.set(Fe,wt),x.update(Fe.renderObjects,!1),Q=!0,Fr&&Ue()}function Je(Fe){ze(Fe);var tt=l.get(Fe);tt&&(tt.forEach(function(wt){return x.remove(wt)}),l.delete(Fe),Q=!0,Fr&&Ue())}function st(Fe){c.has(Fe)||c.set(Fe,Fe.updated.subscribe(function(tt){Fe.state.syncManually||Ge(Fe)}))}function ze(Fe){var tt=c.get(Fe);tt&&(tt.unsubscribe(),c.delete(Fe))}function et(){var Fe=x.boundingSphere.radius>0?100-Math.round(C.transition.target.radius/x.boundingSphere.radius*100):0;return{camera:{mode:C.state.mode,helper:T({},P.camera.props),stereo:T({},u.camera.stereo),manualReset:!!u.camera.manualReset},cameraFog:C.state.fog>0?{name:"on",params:{intensity:C.state.fog}}:{name:"off",params:{}},cameraClipping:{far:C.state.clipFar,radius:Fe},cameraResetDurationMs:u.cameraResetDurationMs,transparentBackground:u.transparentBackground,viewport:u.viewport,postprocessing:T({},u.postprocessing),multiSample:T({},u.multiSample),renderer:T({},E.props),trackball:T({},_.props),debug:T({},P.debug.props),handle:T({},P.handle.props)}}var ut=v.subscribe(function(){D.dirty=!0,re(!0),re(!0)}),pt=new Wf(0);function ht(Fe){Fe===void 0&&(Fe=!0),o.updateSize(),Re(),it(),Fe&&K(!0),pt.next(+new Date)}return{webgl:a,add:Ge,remove:Je,commit:ie,update:function(Fe,tt){if(Fe){if(!l.has(Fe))return;x.update(Fe.renderObjects,!!tt)}else x.update(void 0,!!tt);Q=!0},clear:function(){c.forEach(function(Fe){return Fe.unsubscribe()}),c.clear(),l.clear(),x.clear(),P.debug.clear(),K(!0),d.next(l.size)},syncVisibility:function(){C.state.radiusMax===0&&(U=!0,j=0),x.syncVisibility()&&P.debug.isEnabled&&P.debug.update(),K(!0)},requestDraw:K,tick:H,animate:me,resetTime:fe,pause:xe,identify:Se,mark:ee,getLoci:V,handleResize:ht,requestResize:function(){q=!0},requestCameraReset:function(Fe){j=Fe?.durationMs,te=Fe?.snapshot,U=!0},camera:C,boundingSphere:x.boundingSphere,boundingSphereVisible:x.boundingSphereVisible,get notifyDidDraw(){return W},set notifyDidDraw(Fe){W=Fe},didDraw:p,commited:h,reprCount:d,resized:pt,setProps:function(Fe,tt){var wt,dt,Et;tt===void 0&&(tt=!1);var oe=typeof Fe=="function"?hd(et(),Fe):Fe,ge=Object.create(null);if(oe.camera&&oe.camera.mode!==void 0&&oe.camera.mode!==C.state.mode&&(ge.mode=oe.camera.mode),oe.cameraFog!==void 0&&oe.cameraFog.params){var Ee=oe.cameraFog.name==="on"?oe.cameraFog.params.intensity:0;Ee!==C.state.fog&&(ge.fog=Ee)}if(oe.cameraClipping!==void 0&&(oe.cameraClipping.far!==void 0&&oe.cameraClipping.far!==C.state.clipFar&&(ge.clipFar=oe.cameraClipping.far),oe.cameraClipping.radius!==void 0)){var Ze=x.boundingSphere.radius/100*(100-oe.cameraClipping.radius);Ze>0&&Ze!==ge.radius&&(ge.radius=Math.max(Ze,.01))}if(Object.keys(ge).length>0&&C.setState(ge),!((wt=oe.camera)===null||wt===void 0)&&wt.helper&&P.camera.setProps(oe.camera.helper),((dt=oe.camera)===null||dt===void 0?void 0:dt.manualReset)!==void 0&&(u.camera.manualReset=oe.camera.manualReset),((Et=oe.camera)===null||Et===void 0?void 0:Et.stereo)!==void 0&&Object.assign(u.camera.stereo,oe.camera.stereo),oe.cameraResetDurationMs!==void 0&&(u.cameraResetDurationMs=oe.cameraResetDurationMs),oe.transparentBackground!==void 0&&(u.transparentBackground=oe.transparentBackground),oe.viewport!==void 0){var xt=u.viewport===oe.viewport||u.viewport.name===oe.viewport.name&&mC(u.viewport.params,oe.viewport.params);xt||(u.viewport=oe.viewport,Re(),it())}oe.postprocessing&&Object.assign(u.postprocessing,oe.postprocessing),oe.multiSample&&Object.assign(u.multiSample,oe.multiSample),oe.renderer&&E.setProps(oe.renderer),oe.trackball&&_.setProps(oe.trackball),oe.debug&&P.debug.setProps(oe.debug),oe.handle&&P.handle.setProps(oe.handle),ge.mode==="orthographic"&&(u.camera.stereo.name="off"),tt||K(!0)},getImagePass:function(Fe){return Fe===void 0&&(Fe={}),new GLe(a,E,x,C,P,o.draw.wboitEnabled,Fe)},getRenderObjects:function(){var Fe=[];return x.forEach(function(tt,wt){return Fe.push(wt)}),Fe},get props(){return et()},get input(){return i},get stats(){return E.stats},get interaction(){return k.events},dispose:function(){ut.unsubscribe(),x.clear(),P.debug.clear(),_.dispose(),E.dispose(),k.dispose()}};function Re(){u.viewport.name==="canvas"?(g=0,y=0,b=m.drawingBufferWidth,S=m.drawingBufferHeight):u.viewport.name==="static-frame"?(g=u.viewport.params.x*a.pixelRatio,S=u.viewport.params.height*a.pixelRatio,y=m.drawingBufferHeight-S-u.viewport.params.y*a.pixelRatio,b=u.viewport.params.width*a.pixelRatio):u.viewport.name==="relative-frame"&&(g=Math.round(u.viewport.params.x*m.drawingBufferWidth),S=Math.round(u.viewport.params.height*m.drawingBufferHeight),y=Math.round(m.drawingBufferHeight-S-u.viewport.params.y*m.drawingBufferHeight),b=Math.round(u.viewport.params.width*m.drawingBufferWidth))}function it(){D.setViewport(g,y,b,S),E.setViewport(g,y,b,S),ai.set(C.viewport,g,y,b,S),ai.set(_.viewport,g,y,b,S)}}e.create=t})(dI||(dI={}));function n7e(e){g$(e)}function g$(e){Rt.Canvas3D.ResetSettings.subscribe(e,function(){var t;(t=e.canvas3d)===null||t===void 0||t.setProps(Kk),e.events.canvas3d.settingsUpdated.next()}),Rt.Canvas3D.SetSettings.subscribe(e,function(t){var r;!e.canvas3d||((r=e.canvas3d)===null||r===void 0||r.setProps(t.settings),e.events.canvas3d.settingsUpdated.next())})}var a7e=Object.freeze({__proto__:null,registerDefault:n7e,Canvas3DSetSettings:g$}),cp=$u,Kh=yr.Trigger,i7e={hoverHighlightOnly:yr([Kh(0)],"Highlight","Hover element using ${triggers}"),hoverHighlightOnlyExtend:yr([Kh(0,cp.create({shift:!0}))],"Extend highlight","From selected to hovered element along polymer using ${triggers}")},o7e={bindings:M.Value(i7e,{isHidden:!0}),ignore:M.Value([],{isHidden:!0}),mark:M.Boolean(!0)},s7e=Ur.create({name:"representation-highlight-loci",category:"interaction",ctor:function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.lociMarkProvider=function(n,a){!r.ctx.canvas3d||!r.params.mark||r.ctx.canvas3d.mark(n,a)},r}return t.prototype.register=function(){var r=this;this.subscribeObservable(this.ctx.behaviors.interaction.hover,function(n){var a,i=n.current,o=n.buttons,s=n.modifiers;if(!(!r.ctx.canvas3d||r.ctx.isBusy)){if(((a=r.params.ignore)===null||a===void 0?void 0:a.indexOf(i.loci.kind))>=0){r.ctx.managers.interactivity.lociHighlights.highlightOnly({repr:i.repr,loci:zr});return}var u=!1;yr.match(r.params.bindings.hoverHighlightOnly,o,s)&&(r.ctx.managers.interactivity.lociHighlights.highlightOnly({loci:i.loci}),u=!0),yr.match(r.params.bindings.hoverHighlightOnlyExtend,o,s)&&(r.ctx.managers.interactivity.lociHighlights.highlightOnlyExtend({loci:i.loci}),u=!0),u||r.ctx.managers.interactivity.lociHighlights.highlightOnly({repr:i.repr,loci:zr})}}),this.ctx.managers.interactivity.lociHighlights.addProvider(this.lociMarkProvider)},t.prototype.unregister=function(){this.ctx.managers.interactivity.lociHighlights.removeProvider(this.lociMarkProvider)},t}(Ur.Handler),params:function(){return o7e},display:{name:"Highlight Loci on Canvas"}}),u7e={clickSelect:yr.Empty,clickToggleExtend:yr([Kh(1,cp.create({shift:!0}))],"Toggle extended selection","${triggers} to extend selection along polymer"),clickSelectOnly:yr.Empty,clickToggle:yr([Kh(1,cp.create())],"Toggle selection","${triggers} on element"),clickDeselect:yr.Empty,clickDeselectAllOnEmpty:yr([Kh(1,cp.create())],"Deselect all","Click on nothing using ${triggers}")},l7e={bindings:M.Value(u7e,{isHidden:!0}),ignore:M.Value([],{isHidden:!0}),mark:M.Boolean(!0)},y$=Ur.create({name:"representation-select-loci",category:"interaction",ctor:function(e){Le(t,e);function t(r,n){var a=e.call(this,r,n)||this;return a.lociMarkProvider=function(i,o){!a.ctx.canvas3d||!a.params.mark||a.ctx.canvas3d.mark({loci:i.loci},o)},a.spine=new I1.Impl(r.state.data.cells),a}return t.prototype.applySelectMark=function(r,n){var a=this.ctx.state.data.cells.get(r);if(a&&be.isRepresentation3D(a.obj)){this.spine.current=a;var i=this.spine.getRootOfType(be.Molecule.Structure);if(i){n&&this.lociMarkProvider({loci:$e.Loci(i.data)},sr.Deselect);var o=this.ctx.managers.structure.selection.getLoci(i.data);this.lociMarkProvider({loci:o},sr.Select)}}},t.prototype.register=function(){var r=this,n=function(o){return cr.isEmpty(o.loci)},a=function(o){return!cr.isEmpty(o.loci)},i=[["clickSelect",function(o){return r.ctx.managers.interactivity.lociSelects.select(o)},a],["clickToggle",function(o){return r.ctx.managers.interactivity.lociSelects.toggle(o)},a],["clickToggleExtend",function(o){return r.ctx.managers.interactivity.lociSelects.toggleExtend(o)},a],["clickSelectOnly",function(o){return r.ctx.managers.interactivity.lociSelects.selectOnly(o)},a],["clickDeselect",function(o){return r.ctx.managers.interactivity.lociSelects.deselect(o)},a],["clickDeselectAllOnEmpty",function(){return r.ctx.managers.interactivity.lociSelects.deselectAll()},n]];i.sort(function(o,s){var u=r.params.bindings[o[0]],l=r.params.bindings[s[0]],c=u.triggers.length===0?0:nc(u.triggers.map(function(f){return cp.size(f.modifiers)})),d=l.triggers.length===0?0:nc(l.triggers.map(function(f){return cp.size(f.modifiers)}));return d-c}),this.subscribeObservable(this.ctx.behaviors.interaction.click,function(o){var s,u=o.current,l=o.button,c=o.modifiers;if(!(!r.ctx.canvas3d||r.ctx.isBusy||!r.ctx.selectionMode)&&!(((s=r.params.ignore)===null||s===void 0?void 0:s.indexOf(u.loci.kind))>=0))for(var d=0,f=i;d<f.length;d++){var p=f[d],h=p[0],m=p[1],v=p[2];if(yr.match(r.params.bindings[h],l,c)&&(!v||v(u))){m(u);break}}}),this.ctx.managers.interactivity.lociSelects.addProvider(this.lociMarkProvider),this.subscribeObservable(this.ctx.state.events.object.created,function(o){var s=o.ref;return r.applySelectMark(s)}),this.subscribeObservable(this.ctx.state.events.object.updated,function(o){var s=o.ref,u=o.obj,l=o.oldObj,c=o.oldData,d=o.action,f=r.ctx.state.data.cells.get(s);if(f&&be.Molecule.Structure.is(f.obj)){var p=u.data,h=d==="recreate"?l?.data:d==="in-place"?c:void 0;if(h&&$e.areEquivalent(p,h)&&$e.areHierarchiesEqual(p,h))return;for(var m=r.ctx.state.data.select(lr.Generators.ofType(be.Molecule.Structure.Representation3D,s)),v=0,g=m;v<g.length;v++){var y=g[v];r.applySelectMark(y.transform.ref,!0)}}})},t.prototype.unregister=function(){this.ctx.managers.interactivity.lociSelects.removeProvider(this.lociMarkProvider)},t}(Ur.Handler),params:function(){return l7e},display:{name:"Select Loci on Canvas"}}),c7e=Ur.create({name:"default-loci-label-provider",category:"interaction",ctor:function(){function e(t){this.ctx=t,this.f={label:function(r){var n=[];if(Oe.is(r)&&r.elements.length===1){var a=r.elements[0].unit,i=ot.create(r.structure,a,a.elements[0]),o=mt.entity.pdbx_description(i).join(", ");n.push(o)}return n.push(wp(r)),n.filter(function(s){return!!s}).join("</br>")},group:function(r){return r.toString().replace(/Model [0-9]+/g,"Models")},priority:100}}return e.prototype.register=function(){this.ctx.managers.lociLabels.addProvider(this.f)},e.prototype.unregister=function(){this.ctx.managers.lociLabels.removeProvider(this.f)},e}(),display:{name:"Provide Default Loci Label"}}),d7e={clickFocus:yr([Kh(1,cp.create())],"Representation Focus","Click element using ${triggers}"),clickFocusAdd:yr([Kh(1,cp.create({shift:!0}))],"Representation Focus Add","Click element using ${triggers}"),clickFocusSelectMode:yr([],"Representation Focus","Click element using ${triggers}"),clickFocusAddSelectMode:yr([],"Representation Focus Add","Click element using ${triggers}")},f7e={bindings:M.Value(d7e,{isHidden:!0})},__=Ur.create({name:"representation-focus-loci",category:"interaction",ctor:function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.register=function(){var r=this;this.subscribeObservable(this.ctx.behaviors.interaction.click,function(n){var a,i=n.current,o=n.button,s=n.modifiers,u=r.params.bindings,l=u.clickFocus,c=u.clickFocusAdd,d=u.clickFocusSelectMode,f=u.clickFocusAddSelectMode,p=r.ctx.managers.interactivity.props.granularity;if(!(p!=="residue"&&p!=="element")){var h=r.ctx.selectionMode?d:l,m=yr.match(h,o,s),v=r.ctx.selectionMode?f:c,g=yr.match(v,o,s);if(!(!m&&!g)){var y=cr.normalize(i.loci,"residue"),b=r.ctx.managers.structure.focus.current;if(b&&cr.areEqual(b.loci,y))r.ctx.managers.structure.focus.clear();else if(m)r.ctx.managers.structure.focus.setFromLoci(y);else{r.ctx.managers.structure.focus.addFromLoci(y);var S=(a=r.ctx.managers.structure.focus.current)===null||a===void 0?void 0:a.loci;S&&r.ctx.managers.camera.focusLoci(S)}}}})},t}(Ur.Handler),params:function(){return f7e},display:{name:"Representation Focus Loci on Canvas"}}),p7e=Object.freeze({__proto__:null,HighlightLoci:s7e,SelectLoci:y$,DefaultLociLabelProvider:c7e,FocusLoci:__}),Mg=$u,Dg=yr.Trigger,h7e={clickCenterFocus:yr([Dg(1,Mg.create()),Dg(2,Mg.create()),Dg(1,Mg.create({control:!0}))],"Camera center and focus","Click element using ${triggers}"),clickCenterFocusSelectMode:yr([Dg(2,Mg.create()),Dg(1,Mg.create({control:!0}))],"Camera center and focus","Click element using ${triggers}")},m7e={minRadius:M.Numeric(8,{min:1,max:50,step:1}),extraRadius:M.Numeric(4,{min:1,max:50,step:1},{description:"Value added to the bounding-sphere radius of the Loci"}),durationMs:M.Numeric(250,{min:0,max:1e3,step:1},{description:"Camera transition duration"}),bindings:M.Value(h7e,{isHidden:!0})},v7e=Ur.create({name:"camera-focus-loci",category:"interaction",ctor:function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.register=function(){var r=this;this.subscribeObservable(this.ctx.behaviors.interaction.click,function(n){var a=n.current,i=n.button,o=n.modifiers;if(!!r.ctx.canvas3d){var s=r.ctx.selectionMode?r.params.bindings.clickCenterFocusSelectMode:r.params.bindings.clickCenterFocus;if(yr.match(s,i,o)){if(cr.isEmpty(a.loci)){Rt.Camera.Reset(r.ctx,{});return}var u=cr.normalize(a.loci,r.ctx.managers.interactivity.props.granularity);r.ctx.managers.camera.focusLoci(u,r.params)}}})},t}(Ur.Handler),params:function(){return m7e},display:{name:"Camera Focus Loci on Canvas"}}),g7e=Ur.create({name:"camera-axis-helper",category:"interaction",ctor:function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.register=function(){var r=this,n=0,a=0;this.subscribeObservable(this.ctx.behaviors.interaction.click,function(i){var o=i.current;if(!(!r.ctx.canvas3d||!lI(o.loci))){var s=o.loci.elements[0].groupId;if(s===0){n=0,a=0;return}var u=r.ctx.canvas3d.camera,l,c;if(s>=1&&s<=3){n=0,a=0;var d=A.sub(A(),u.target,u.position),f=A.cross(A(),d,u.up);c=A(),c[s-1]=1,l=A.cross(A(),c,f),A.magnitude(l)===0&&(l=d)}else n===s?a=(a+1)%2:(n=s,a=0),s===4?(c=a?A.unitX:A.unitY,l=A.negUnitZ):s===5?(c=a?A.unitX:A.unitZ,l=A.negUnitY):(c=a?A.unitY:A.unitZ,l=A.negUnitX);r.ctx.canvas3d.requestCameraReset({snapshot:function(p,h){return h.getInvariantFocus(p.boundingSphereVisible.center,p.boundingSphereVisible.radius,c,l)}})}})},t}(Ur.Handler),params:function(){return{}},display:{name:"Camera Axis Helper"}}),y7e=Object.freeze({__proto__:null,FocusLoci:v7e,CameraAxisHelper:g7e}),b7e=Ur.create({name:"structure-info-prop",category:"custom-props",display:{name:"Structure Info"},ctor:function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return Object.defineProperty(t.prototype,"maxModelIndex",{get:function(){for(var r,n,a=-1,i=this.ctx.state.data.select(lr.Generators.rootsOfType(be.Molecule.Model)),o=0,s=i;o<s.length;o++){var u=s[o],l=((r=u.obj)===null||r===void 0?void 0:r.data)&&rr.Index.get((n=u.obj)===null||n===void 0?void 0:n.data).value;l!==void 0&&l>a&&(a=l)}return a},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxStructureIndex",{get:function(){for(var r,n,a=-1,i=this.ctx.state.data.select(lr.Generators.rootsOfType(be.Molecule.Structure)),o=0,s=i;o<s.length;o++){var u=s[o],l=((r=u.obj)===null||r===void 0?void 0:r.data)&&$e.Index.get((n=u.obj)===null||n===void 0?void 0:n.data).value;l!==void 0&&l>a&&(a=l)}return a},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"asymIdOffset",{get:function(){for(var r,n=0,a=0,i=this.ctx.state.data.select(lr.Generators.rootsOfType(be.Molecule.Model)),o=0,s=i;o<s.length;o++){var u=s[o],l=(r=u.obj)===null||r===void 0?void 0:r.data;if(l){var c=rr.AsymIdCount.get(l),d=rr.AsymIdOffset.get(l).value;c!==void 0&&d!==void 0&&(n=Math.max(n,d.auth+c.auth),a=Math.max(a,d.label+c.label))}}return{auth:n,label:a}},enumerable:!1,configurable:!0}),t.prototype.handleModel=function(r,n){if(rr.Index.get(r).value===void 0){var a=n&&rr.Index.get(n).value,i=a??this.maxModelIndex+1;rr.Index.set(r,{value:i})}if(rr.AsymIdOffset.get(r).value===void 0){var o=n&&rr.AsymIdOffset.get(n).value,i=o??T({},this.asymIdOffset);rr.AsymIdOffset.set(r,{value:i})}},t.prototype.handleStructure=function(r,n){if(r.parent===void 0&&$e.Index.get(r).value===void 0){var a=n&&$e.Index.get(n).value,i=a??this.maxStructureIndex+1;$e.Index.set(r,{value:i})}},t.prototype.handle=function(r,n,a){if(be.Molecule.Structure.is(n)){var i=this.ctx.state.data.tree.transforms.get(r);!i.transformer.definition.isDecorator&&n.data.parent===void 0&&this.handleStructure(n.data,a?.data)}else if(be.Molecule.Model.is(n)){var i=this.ctx.state.data.tree.transforms.get(r);i.transformer.definition.isDecorator||this.handleModel(n.data,a?.data)}},t.prototype.register=function(){var r=this;this.ctx.customModelProperties.register(rr.AsymIdOffset,!0),this.ctx.customModelProperties.register(rr.Index,!0),this.ctx.customStructureProperties.register($e.Index,!0),this.subscribeObservable(this.ctx.state.data.events.object.created,function(n){r.handle(n.ref,n.obj)}),this.subscribeObservable(this.ctx.state.data.events.object.updated,function(n){r.handle(n.ref,n.obj,n.oldObj)})},t.prototype.unregister=function(){this.ctx.customModelProperties.unregister(rr.AsymIdOffset.descriptor.name),this.ctx.customModelProperties.unregister(rr.Index.descriptor.name),this.ctx.customStructureProperties.unregister($e.Index.descriptor.name)},t}(Ur.Handler)}),$f=[-1,1.76,1.87,1.65,1.5,1.4,1.85,1.8,1.6,1.4],b$={ALA:121,ARG:265,ASN:187,ASP:187,CYS:148,GLU:214,GLN:214,GLY:97,HIS:216,ILE:195,LEU:191,LYS:230,MET:203,PHE:228,PRO:154,SER:143,THR:163,TRP:264,TYR:255,VAL:165},x7e=121;function S7e(e){var t=mt.residue.key,r=mt.atom,n=r.type_symbol,a=r.label_atom_id,i=r.label_comp_id,o=e.structure,s=e.atomRadiusType,u=e.serialResidueIndex,l=ot.create(o),c=0,d=0,f=-1;l.structure=o;for(var p=0,h=0,m=o.units.length;p<m;++p){var v=o.units[p],g=v.elements;l.unit=v,c=-1;for(var y=0,b=g.length;y<b;++y){var S=g[y],x=h+y;l.element=S,d=t(l),c!==d&&++f,c=d;var C=n(l),w=g0(C);if(N1(w)){s[x]=0,u[x]=-1;continue}var _=a(l),E=Mk(v,S);if(E===2||!e.nonPolymer&&!Tk(E)){s[x]=0,u[x]=-1;continue}var P=i(l);if(e.traceOnly&&(_!=="CA"&&_!=="BB"||!b$[P])){s[x]=0,u[x]=f;continue}kp(E)?s[x]=w7e(_,C):E===5?s[x]=C7e(_,C,P):s[x]=$k(C),u[x]=f}h+=g.length}}function C7e(e,t,r){switch(t){case"O":return 5;case"S":return 6;case"N":return e==="NZ"?4:3;case"C":switch(e){case"C":case"CE1":case"CE2":case"CE3":case"CH2":case"CZ":case"CZ2":case"CZ3":return 1;case"CA":case"CB":case"CE":case"CG1":case"CG2":return 2;default:switch(r){case"PHE":case"TRP":case"TYR":case"HIS":case"ASP":case"ASN":return 1;case"PRO":case"LYS":case"ARG":case"MET":case"ILE":case"LEU":return 2;case"GLU":case"GLN":return e==="CD"?1:2}}}return $k(t)}function w7e(e,t,r){switch(t){case"C":return 7;case"N":return 8;case"P":return 9;case"O":return 5}return $k(t)}function $k(e){var t=yb(e),r=$f.indexOf(t);return r===-1&&(r=$f.length,$f[r]=t),r}var uN=5e3;function _7e(e,t){return pe(this,void 0,void 0,function(){var r,n;return he(this,function(a){switch(a.label){case 0:r=t.atomRadiusType,n=0,a.label=1;case 1:return n<r.length?e.shouldUpdate?[4,e.update({message:"Computing per residue surface accessibility...",current:n,max:r.length})]:[3,3]:[3,5];case 2:a.sent(),a.label=3;case 3:A7e(t,n,Math.min(n+uN,r.length)),a.label=4;case 4:return n+=uN,[3,1];case 5:return[2]}})})}function A7e(e,t,r){for(var n=e.structure,a=e.atomRadiusType,i=e.serialResidueIndex,o=e.area,s=e.spherePoints,u=e.scalingConstant,l=e.maxLookupRadius,c=e.probeSize,d=n.lookup3d,f=n.serialMapping,p=n.unitIndexMap,h=n.units,m=f.cumulativeUnitElementCount,v=f.elementIndices,g=f.unitIndices,y=t;y<r;++y){var b=$f[a[y]];if(b===$f[0])continue;for(var S=h[g[y]],x=v[y],C=S.conformation.x(x),w=S.conformation.y(x),_=S.conformation.z(x),E=d.find(C,w,_,l),P=E.count,D=E.units,k=E.indices,F=E.squaredDistances,X=c+b,U=c+X,j=[],te=0;te<P;++te){var q=D[te],W=m[p.get(q.id)]+k[te],V=v[W],ee=$f[a[W]];if(!(S===q&&x===V||ee===$f[0])){var ue=c+ee;if(F[te]<(U+ee)*(U+ee)){var $=v[W];j[j.length]=[F[te],(F[te]+X*X-ue*ue)/(2*X),q.conformation.x($)-C,q.conformation.y($)-w,q.conformation.z($)-_]}}}j.sort(function(le,O){return le[0]-O[0]});var Q=0;e:for(var R=0;R<s.length;++R){for(var Y=s[R],re=Y[0],K=Y[1],L=Y[2],H=0;H<j.length;++H){var Z=j[H],fe=Z[1],me=Z[2],xe=Z[3],Se=Z[4],ie=re*me+K*xe+L*Se;if(ie>fe)continue e}++Q}o[i[y]]+=u*Q*X*X}}var x$={numberOfSpherePoints:M.Numeric(92,{min:12,max:360,step:1},{description:"Number of sphere points to sample per atom: 92 (original paper), 960 (BioJava), 3000 (EPPIC) - see Shrake A, Rupley JA: Environment and exposure to solvent of protein atoms. Lysozyme and insulin. J Mol Biol 1973."}),probeSize:M.Numeric(1.4,{min:.1,max:4,step:.01},{description:"Corresponds to the size of a water molecule: 1.4 (original paper), 1.5 (occassionally used)"}),nonPolymer:M.Boolean(!1,{description:"Include non-polymer atoms as occluders."}),traceOnly:M.Boolean(!1,{description:"Compute only using alpha-carbons, if true increase probeSize accordingly (e.g., 4 A). Considers only canonical amino acids."})},A0;(function(e){function t(l,c){var d=this;c===void 0&&(c={});var f=T(T({},M.getDefaultValues(x$)),c);return Qe.create("Compute Accessible Surface Area",function(p){return pe(d,void 0,void 0,function(){return he(this,function(h){switch(h.label){case 0:return[4,r(p,l,f)];case 1:return[2,h.sent()]}})})})}e.compute=t;function r(l,c,d){return pe(this,void 0,void 0,function(){var f,p,h;return he(this,function(m){switch(m.label){case 0:return f=n(c,d),S7e(f),[4,_7e(l,f)];case 1:return m.sent(),p=f.area,h=f.serialResidueIndex,[2,{area:p,serialResidueIndex:h}]}})})}function n(l,c){var d=l.elementCount,f=l.atomicResidueCount,p=c.probeSize,h=c.nonPolymer,m=c.traceOnly,v=c.numberOfSpherePoints;return{structure:l,probeSize:p,nonPolymer:h,traceOnly:m,spherePoints:a(v),scalingConstant:4*Math.PI/v,maxLookupRadius:2*c.probeSize+2*$f[2],atomRadiusType:new Int8Array(d),serialResidueIndex:new Int32Array(d),area:new Float32Array(f)}}function a(l){for(var c=[],d=Math.PI*(3-Math.sqrt(5)),f=2/l,p=0;p<l;++p){var h=p*f-1+f/2,m=Math.sqrt(1-h*h),v=p*d;c[c.length]=A.create(Math.cos(v)*m,h,Math.sin(v)*m)}return c}function i(l,c){var d=b$[l]||x7e;return c/d}e.normalize=i;function o(l,c){var d=c.area,f=c.serialResidueIndex,p=f[nt.indexOf(nt.ofSortedArray(l.structure.root.serialMapping.elementIndices),l.element)];return p===-1?-1:d[p]}e.getValue=o;function s(l,c){var d=o(l,c);return d===-1?-1:i(mt.atom.label_comp_id(l),d)}e.getNormalizedValue=s;function u(l,c){var d=s(l,c);return d===-1?0:d<.16?1:2}e.getFlag=u})(A0||(A0={}));var iT=T({},x$),Qk={isBuried:S0.Dynamic(qL("computed","accessible-surface-area.is-buried",De.Bool),function(e){if(!We.isAtomic(e.element.unit))return!1;var t=nu.get(e.element.structure).value;return t?A0.getFlag(e.element,t)===1:!1}),isAccessible:S0.Dynamic(qL("computed","accessible-surface-area.is-accessible",De.Bool),function(e){if(!We.isAtomic(e.element.unit))return!1;var t=nu.get(e.element.structure).value;return t?A0.getFlag(e.element,t)===2:!1})},nu=Cp.createProvider({label:"Accessible Surface Area",descriptor:vu({name:"molstar_accessible_surface_area",symbols:Qk}),type:"root",defaultParams:iT,getParams:function(e){return iT},isApplicable:function(e){return!0},obtain:function(e,t,r){return pe(void 0,void 0,void 0,function(){var n,a;return he(this,function(i){switch(i.label){case 0:return n=T(T({},M.getDefaultValues(iT)),r),a={},[4,A0.compute(t,n).runInContext(e.runtime)];case 1:return[2,(a.value=i.sent(),a)]}})})}}),oT=vt(16448250),T7e="Assigns a color based on the relative accessible surface area of a residue.",S$={list:M.ColorList("rainbow",{presetKind:"scale"})};function E7e(e){return S$}function C$(e,t){var r,n=nl.create({listOrName:t.list.colors,minLabel:"buried",maxLabel:"exposed",domain:[0,1]}),a=e.structure&&nu.get(e.structure),i=a?wm(a.id,a.version):-1;if(a?.value&&e.structure){var o=ot.create(e.structure),s=a.value,u=function(l){var c=A0.getNormalizedValue(l,s);return c===-1?oT:n.color(c)};r=function(l){return ot.is(l)&&We.isAtomic(l.unit)?u(l):$t.isLocation(l)?(o.unit=l.aUnit,o.element=l.aUnit.elements[l.aIndex],u(o)):oT}}else r=function(){return oT};return{factory:C$,granularity:"group",preferSmoothing:!0,color:r,props:t,contextHash:i,description:T7e,legend:n?n.legend:void 0}}var lN={name:"accessible-surface-area",label:"Accessible Surface Area",category:"Residue Property",factory:C$,getParams:E7e,defaultValues:M.getDefaultValues(S$),isApplicable:function(e){return!!e.structure},ensureCustomProperties:{attach:function(e,t){return t.structure?nu.attach(e,t.structure,void 0,!0):Promise.resolve()},detach:function(e){return e.structure&&nu.ref(e.structure,!1)}}},P7e=Ur.create({name:"computed-accessible-surface-area-prop",category:"custom-props",display:{name:"Accessible Surface Area"},ctor:function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.provider=nu,r.labelProvider={label:function(n){if(!!r.params.showTooltip)return I7e(n)}},r}return t.prototype.update=function(r){var n=this.params.autoAttach!==r.autoAttach||this.params.showTooltip!==r.showTooltip;return this.params.autoAttach=r.autoAttach,this.params.showTooltip=r.showTooltip,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),n},t.prototype.register=function(){KC.addCustomProp(this.provider.descriptor),this.ctx.customStructureProperties.register(this.provider,this.params.autoAttach),this.ctx.representation.structure.themes.colorThemeRegistry.add(lN),this.ctx.managers.lociLabels.addProvider(this.labelProvider),this.ctx.query.structure.registry.add(cN),this.ctx.query.structure.registry.add(dN)},t.prototype.unregister=function(){KC.removeCustomProp(this.provider.descriptor),this.ctx.customStructureProperties.unregister(this.provider.descriptor.name),this.ctx.representation.structure.themes.colorThemeRegistry.remove(lN),this.ctx.managers.lociLabels.removeProvider(this.labelProvider),this.ctx.query.structure.registry.remove(cN),this.ctx.query.structure.registry.remove(dN)},t}(Ur.Handler),params:function(){return{autoAttach:M.Boolean(!1),showTooltip:M.Boolean(!0)}}});function I7e(e){if(e.kind==="element-loci"){if(e.elements.length===0)return;var t=nu.get(e.structure).value;if(!t||e.structure.customPropertyDescriptors.hasReference(nu.descriptor))return;for(var r=e.structure.root.serialMapping.getSerialIndex,n=t.area,a=t.serialResidueIndex,i=new Set,o=0,s=function(h,m){var v=m.elements;Ne.forEach(h,function(g){var y=a[r(m,v[g])];y!==-1&&!i.has(y)&&(o+=n[y],i.add(y))})},u=0,l=e.elements;u<l.length;u++){var c=l[u],d=c.indices,f=c.unit;s(d,f)}if(i.size===0)return;var p="<small>("+i.size+" "+(i.size>1?"Residues sum":"Residue")+")</small>";return"Accessible Surface Area "+p+": "+o.toFixed(2)+" \u212B<sup>2</sup>"}else if(e.kind==="structure-loci"){var t=nu.get(e.structure).value;return!t||e.structure.customPropertyDescriptors.hasReference(nu.descriptor)?void 0:"Accessible Surface Area <small>(Whole Structure)</small>: "+Ly(t.area).toFixed(2)+" \u212B<sup>2</sup>"}}var cN=qr("Buried Protein Residues",ce.struct.modifier.union([ce.struct.modifier.wholeResidues([ce.struct.modifier.union([ce.struct.generator.atomGroups({"chain-test":ce.core.rel.eq([ce.ammp("objectPrimitive"),"atomistic"]),"residue-test":Qk.isBuried.symbol()})])])]),{description:"Select buried protein residues.",category:Gr.Residue,ensureCustomProperties:function(e,t){return nu.attach(e,t)}}),dN=qr("Accessible Protein Residues",ce.struct.modifier.union([ce.struct.modifier.wholeResidues([ce.struct.modifier.union([ce.struct.generator.atomGroups({"chain-test":ce.core.rel.eq([ce.ammp("objectPrimitive"),"atomistic"]),"residue-test":Qk.isAccessible.symbol()})])])]),{description:"Select accessible protein residues.",category:Gr.Residue,ensureCustomProperties:function(e,t){return nu.attach(e,t)}});function Vr(e,t){return e.model.atomicHierarchy.atoms.type_symbol.value(e.elements[t])}function w$(e,t){return e.model.atomicHierarchy.atoms.pdbx_formal_charge.value(e.elements[t])}function G1(e,t){return e.model.atomicHierarchy.atoms.label_atom_id.value(e.elements[t])}function a3(e,t){return e.model.atomicHierarchy.atoms.label_alt_id.value(e.elements[t])}function Zk(e,t){return e.model.atomicHierarchy.atoms.label_comp_id.value(e.elements[t])}function M7e(e,t,r){for(var n=0,a=e.interUnitBonds.getEdgeIndices(r,t.id),i=0,o=a.length;i<o;++i){var s=e.interUnitBonds.edges[a[i]];$r.isCovalent(s.props.flag)&&(n+=1)}return n}function D7e(e,t){for(var r=0,n=e.bonds,a=n.offset,i=n.edgeProps.flags,o=a[t],s=a[t+1];o<s;++o)$r.isCovalent(i[o])&&(r+=1);return r}function Cd(e,t,r){return M7e(e,t,r)+D7e(t,r)}function go(e,t,r,n){var a=0;return gu(e,t,r,function(i,o){Vr(i,o)===n&&(a+=1)}),a}function k7e(e,t,r){var n=e.bonds,a=n.offset,i=n.b,o=n.edgeProps.flags;$r.is;for(var s=a[t],u=a[t+1];s<u;++s)if(i[s]===r&&$r.isCovalent(o[s]))return!0;return!1}function R7e(e,t,r,n,a){var i=e.interUnitBonds.getEdge(r,t.id,a,n.id);return i&&$r.isCovalent(i.props.flag)}function O7e(e,t,r,n,a){return t===n?k7e(t,r,a):R7e(e,t,r,n,a)}function B7e(e,t,r,n){for(var a=e.interUnitBonds.getEdgeIndices(r,t.id),i=0,o=a.length;i<o;++i){var s=e.interUnitBonds.edges[a[i]],u=e.unitMap.get(s.unitB);$r.isCovalent(s.props.flag)&&n(u,s.indexB)}}function F7e(e,t,r){for(var n=e.bonds,a=n.offset,i=n.b,o=n.edgeProps.flags,s=a[t],u=a[t+1];s<u;++s)$r.isCovalent(o[s])&&r(e,i[s])}function gu(e,t,r,n){B7e(e,t,r,n),F7e(t,r,n)}function L7e(e){switch(e){case 0:return"Spherical";case 1:return"Terminal";case 2:return"Linear";case 3:return"Trigonal";case 4:return"Tetrahedral";case 5:return"Trigonal Bi-Pyramidal";case 6:return"Octahedral";case 7:return"Square Planar";case 8:return"Unknown"}}function rv(e){switch(e){case 0:return 0;case 1:return 1;case 2:return 2;case 3:return 3;case 4:return 4;default:return 8}}var fN=new Map([[2,rn(180)],[3,rn(120)],[4,rn(109.4721)],[6,rn(90)]]),i3=A(),o3=A(),Rh=A(),s3=A(),Bv=A();function u3(e,t,r,n,a){var i=[];return t.conformation.position(t.elements[r],Rh),n.conformation.position(n.elements[a],s3),A.sub(i3,s3,Rh),gu(e,t,r,function(o,s){Vr(o,s)!=="H"&&(o.conformation.position(o.elements[s],Bv),A.sub(o3,Bv,Rh),i.push(A.angle(i3,o3)))}),i}function pN(e,t,r,n,a){t.conformation.position(t.elements[r],Rh),n.conformation.position(n.elements[a],s3),A.sub(i3,s3,Rh);var i=[A(),A()],o=0,s,u;if(gu(e,t,r,function(l,c){o>1||Vr(l,c)!=="H"&&(s=l,u=c,l.conformation.position(l.elements[c],Bv),A.sub(i[o++],Bv,Rh))}),o===1&&s&&u&&gu(e,s,u,function(l,c){o>1||l===t&&c===r||Vr(l,c)!=="H"&&(l.conformation.position(l.elements[c],Bv),A.sub(i[o++],Bv,Rh))}),o===2)return A.cross(o3,i[0],i[1]),Math.abs(Math.PI/2-A.angle(o3,i3))}var sT=new $t.ElementBondIterator,uT=new $t.ElementBondIterator;function N7e(e,t,r){var n=Vr(t,r),a=n==="O"||n==="N";if(a&&Cd(e,t,r)===4)return!1;for(sT.setElement(e,t,r);sT.hasNext;){var i=sT.move();if(i.order>1)return!0;if(a){var o=Vr(i.otherUnit,i.otherIndex);for(uT.setElement(e,i.otherUnit,i.otherIndex);uT.hasNext;){var s=uT.move();if(s.order>1){if((o==="P"||o==="S")&&Vr(s.otherUnit,s.otherIndex)==="O")continue;return!0}}}}return!1}function z7e(e,t,r){for(var n=0,a=t.bonds,i=a.offset,o=a.edgeProps,s=o.flags,u=o.order,l=i[r],c=i[r+1];l<c;++l)$r.isCovalent(s[l])&&(n+=u[l]);return e.interUnitBonds.getEdgeIndices(r,t.id).forEach(function(d){var f=e.interUnitBonds.edges[d];$r.isCovalent(f.props.flag)&&(n+=f.props.order)}),n}var nv=new $t.ElementBondIterator,lT=new $t.ElementBondIterator;function U7e(e,t,r,n){var a=go(e,t,r,"H"),i=Vr(t,r),o=w$(t,r),s=n.assignCharge==="always"||n.assignCharge==="auto"&&o===0,u=n.assignH==="always"||n.assignH==="auto"&&a===0,l=Cd(e,t,r),c=z7e(e,t,r),d=N7e(e,t,r),f=c-l>0,p=0,h=8;switch(i){case"H":s&&(l===0?(o=1,h=0):l===1&&(o=0,h=1));break;case"C":s&&(o=0),u&&(p=Math.max(0,4-c-Math.abs(o))),h=rv(l+p+Math.max(0,-o));break;case"N":if(s)if(!u)o=c-3;else if(d&&c<4)l-a===1&&c-a===2?o=1:o=0;else for(nv.setElement(e,t,r);nv.hasNext;){var m=nv.move(),v=Vr(m.otherUnit,m.otherIndex);if(v==="S"||eke(v)){o=0;break}else o=1}u&&(p=Math.max(0,3-c+o)),d&&!f?h=rv(l+p-o):h=rv(l+p+1-o);break;case"O":if(s&&(u||(o=c-2),c===1)){nv.setElement(e,t,r);e:for(;nv.hasNext;){var g=nv.move();for(lT.setElement(e,g.otherUnit,g.otherIndex);lT.hasNext;){var y=lT.move();if(!(y.otherUnit===t&&y.otherIndex===r)&&Vr(y.otherUnit,y.otherIndex)==="O"&&y.order===2){o=-1;break e}}}}u&&(p=Math.max(0,2-c+o)),d&&!f?h=rv(l+p-o+1):h=rv(l+p-o+2);break;case"S":s&&(u||(c<=3&&go(e,t,r,"O")===0?o=c-2:o=0)),u&&c<2&&(p=Math.max(0,2-c+o)),c<=3&&(h=rv(l+p-o+2));break;case"F":case"CL":case"BR":case"I":case"AT":s&&(o=c-1);break;case"LI":case"NA":case"K":case"RB":case"CS":case"FR":s&&(o=1-c);break;case"BE":case"MG":case"CA":case"SR":case"BA":case"RA":s&&(o=2-c);break;default:Fr&&console.warn("Requested charge, protonation for an unhandled element",i)}return[o,p,p+a,h]}function V7e(e,t,r){var n=t.elements.length,a=new Int8Array(n),i=new Int8Array(n),o=new Int8Array(n),s=new Int8Array(n),u=!!e.parent,l;if(u){var c=e.root.unitMap.get(t.id);if(l=nt.indicesOf(c.elements,t.elements),l.length!==t.elements.length)throw new Error("expected to find an index for every element");t=c,e=e.root}for(var d=0;d<n;++d){var f=u?l[d]:d,p=U7e(e,t,f,r),h=p[0],m=p[1],v=p[2],g=p[3];a[d]=h,i[d]=m,o[d]=v,s[d]=g}return{charge:a,implicitH:i,totalH:o,idealGeometry:s}}var _$={assignCharge:M.Select("auto",[["always","always"],["auto","auto"],["never","never"]]),assignH:M.Select("auto",[["always","always"],["auto","auto"],["never","never"]])};function H7e(e,t,r){return pe(this,void 0,void 0,function(){var n,a,i,o,s,u;return he(this,function(l){for(n=T(T({},M.getDefaultValues(_$)),r),a=new Map,i=0,o=t.units.length;i<o;++i)s=t.units[i],We.isAtomic(s)&&(u=V7e(t,s,n),a.set(s.id,u));return[2,a]})})}var cT=T({},_$),wb=Cp.createProvider({label:"Valence Model",descriptor:vu({name:"molstar_computed_valence_model"}),type:"local",defaultParams:cT,getParams:function(e){return cT},isApplicable:function(e){return!0},obtain:function(e,t,r){return pe(void 0,void 0,void 0,function(){var n,a;return he(this,function(i){switch(i.label){case 0:return n=T(T({},M.getDefaultValues(cT)),r),a={},[4,H7e(e.runtime,t,n)];case 1:return[2,(a.value=i.sent(),a)]}})})}}),Ln;(function(e){function t(d,f,p,h){return A.set(d,h.x[p],h.y[p],h.z[p]),A.transformMat4(d,d,f.conformation.operator.matrix),d}e.setPosition=t;function r(d,f){for(var p=new Int32Array(f+1),h=new Int32Array(f),m=new Int32Array(f),v=d.members,g=d.count,y=d.offsets,b=0,S=y[g];b<S;++b)++m[v[b]];for(var x=0,b=0;b<f;b++)p[b]=x,x+=m[b];p[f]=x;for(var C=new Int32Array(x),b=0;b<g;++b)for(var w=y[b],_=y[b+1];w<_;++w){var E=v[w],P=p[E]+h[E];C[P]=b,++h[E]}return{indices:C,offsets:p}}e.createElementsIndex=r;function n(d,f){var p,h;return T(T({},f),{get lookup3d(){if(!p){var m={x:f.x,y:f.y,z:f.z,indices:Ne.ofBounds(0,f.count)};p=nm(m,y0(m))}return p},get elementsIndex(){return h||(h=r(f,d))},subset:function(m){return a(f,m)}})}e.create=n;function a(d,f){for(var p,h=d.count,m=d.types,v=[],g=0;g<h;++g)f.has(m[g])&&v.push(g);var y=nt.ofSortedArray(v);return{indices:y,get lookup3d(){if(!p){var b={x:d.x,y:d.y,z:d.z,indices:y};p=nm(b,y0(b))}return p}}}e.createSubset=a;function i(d,f,p){var h=wb.get(d).value;if(!h||!h.has(f.id))throw new Error("valence model required");return{unit:f,types:p.types,feature:-1,x:p.x,y:p.y,z:p.z,members:p.members,offsets:p.offsets,idealGeometry:h.get(f.id).idealGeometry}}e.Info=i;function o(d,f){return A.set(d,f.x[f.feature],f.y[f.feature],f.z[f.feature]),A.transformMat4(d,d,f.unit.conformation.operator.matrix),d}e.position=o;var s=A(),u=A();function l(d,f){var p=d.members[d.offsets[d.feature]],h=f.members[f.offsets[f.feature]];return d.unit.conformation.position(d.unit.elements[p],s),f.unit.conformation.position(f.unit.elements[h],u),A.distance(s,u)}e.distance=l;function c(d,f){return{types:new Set(d),add:f}}e.Provider=c})(Ln||(Ln={}));var fI;(function(e){function t(r,n,a){r===void 0&&(r=2048),n===void 0&&(n=1024);var i=Ke.create(Float32Array,1,n,a?a.x:r),o=Ke.create(Float32Array,1,n,a?a.y:r),s=Ke.create(Float32Array,1,n,a?a.z:r),u=Ke.create(Uint8Array,1,n,a?a.types:r),l=Ke.create(Uint8Array,1,n,a?a.groups:r),c=Ke.create(Uint32Array,1,n,a?a.offsets:r),d=Ke.create(Uint32Array,1,n,a?a.members:r),f={x:0,y:0,z:0,offset:0,count:0};return{startState:function(){f.x=0,f.y=0,f.z=0,f.offset=d.elementCount,f.count=0},pushMember:function(p,h,m,v){Ke.add(d,v),f.x+=p,f.y+=h,f.z+=m,f.count+=1},finishState:function(p,h){var m=f.count;m!==0&&(Ke.add(u,p),Ke.add(l,h),Ke.add(i,f.x/m),Ke.add(o,f.y/m),Ke.add(s,f.z/m),Ke.add(c,f.offset))},add:function(p,h,m,v,g,y){Ke.add(u,p),Ke.add(l,h),Ke.add(i,m),Ke.add(o,v),Ke.add(s,g),Ke.add(c,d.elementCount),Ke.add(d,y)},getFeatures:function(p){Ke.add(c,d.elementCount);var h=Ke.compact(i,!0),m=Ke.compact(o,!0),v=Ke.compact(s,!0),g=i.elementCount;return Ln.create(p,{x:h,y:m,z:v,count:g,types:Ke.compact(u,!0),groups:Ke.compact(l,!0),offsets:Ke.compact(c,!0),members:Ke.compact(d,!0)})}}}e.create=t})(fI||(fI={}));var pI;(function(e){function t(r,n,a){for(var i=new Int32Array(a+1),o=new Int32Array(a),s=new Int32Array(a),u=n.members,l=n.offsets,c=0,d=r.edgeCount*2;c<d;++c){var f=r.a[c],p=r.b[c];if(!(f>p)){for(var h=l[f],m=l[f+1];h<m;++h)++s[u[h]];for(var h=l[p],m=l[p+1];h<m;++h)++s[u[h]]}}for(var v=0,c=0;c<a;c++)i[c]=v,v+=s[c];i[a]=v;for(var g=new Int32Array(v),c=0,d=r.edgeCount*2;c<d;++c){var f=r.a[c],p=r.b[c];if(!(f>p)){for(var h=l[f],m=l[f+1];h<m;++h){var y=u[h],b=i[y]+o[y];g[b]=c,++o[y]}for(var h=l[p],m=l[p+1];h<m;++h){var y=u[h],b=i[y]+o[y];g[b]=c,++o[y]}}}return{indices:g,offsets:i}}e.createElementsIndex=t})(pI||(pI={}));var j7e=function(e){Le(t,e);function t(r,n){var a=e.call(this,r)||this,i=0,o=new Map,s=function(u,l){var c=a.getElementKey(u,l),d=o.get(c);d===void 0?o.set(c,[i]):d.push(i)};return a.map.forEach(function(u){u.forEach(function(l){var c=l.unitA,d=l.connectedIndices;d.forEach(function(f){for(var p=n.get(c),h=p.offsets,m=p.members,v=h[f],g=h[f+1];v<g;++v)s(m[v],c);i+=1})})}),a.elementKeyIndex=o,a}return t.prototype.getContactIndicesForElement=function(r,n){return this.elementKeyIndex.get(this.getElementKey(r,n.id))||[]},t.prototype.getElementKey=function(r,n){return r+"|"+n},t}(sm);function hN(e){switch(e){case 4:return"Hydrogen Bond";case 6:return"Hydrophobic Contact";case 5:return"Halogen Bond";case 1:return"Ionic Interaction";case 7:return"Metal Coordination";case 2:return"Cation-Pi Interaction";case 3:return"Pi Stacking";case 8:return"Weak Hydrogen Bond";case 0:return"Unknown Interaction"}}function G7e(e){switch(e){case 0:return"None";case 1:return"Positive Charge";case 2:return"Negative Charge";case 3:return"Aromatic Ring";case 4:return"Hydrogen Donor";case 5:return"Hydrogen Acceptor";case 6:return"Halogen Donor";case 7:return"Halogen Acceptor";case 8:return"HydrophobicAtom";case 9:return"Weak Hydrogen Donor";case 10:return"Ionic Type Partner";case 11:return"Dative Bond Partner";case 12:return"Transition Metal";case 13:return"Ionic Type Metal"}}function q7e(e){switch(e){case 0:return"None";case 1:return"Quaternary Amine";case 2:return"Tertiary Amine";case 3:return"Sulfonium";case 4:return"Sulfonic Acid";case 5:return"Sulfate";case 6:return"Phosphate";case 7:return"Halocarbon";case 8:return"Guanidine";case 9:return"Acetamidine";case 10:return"Carboxylate"}}var hI;(function(e){function t(r,n){var a=[],i=[],o=[];return{add:function(s,u,l){a[a.length]=s,i[i.length]=u,o[o.length]=l},getContacts:function(){for(var s=new qo.EdgeBuilder(r.count,a,i),u=new Int8Array(s.slotCount),l=new Int8Array(s.slotCount),c=0,d=s.edgeCount;c<d;c++)s.addNextEdge(),s.assignProperty(u,o[c]);var f=s.createGraph({type:u,flag:l}),p,h=Object.defineProperty(f,"elementsIndex",{get:function(){return p||(p=pI.createElementsIndex(f,r,n))}});return h}}}e.create=t})(hI||(hI={}));var mI;(function(e){function t(){var r=new sm.Builder;return{startUnitPair:function(n,a){r.startUnitPair(n.id,a.id)},finishUnitPair:function(){r.finishUnitPair()},add:function(n,a,i){r.add(n,a,{type:i,flag:0})},getContacts:function(n){return new j7e(r.getMap(),n)}}}e.create=t})(mI||(mI={}));var W7e={lineOfSightDistFactor:M.Numeric(1,{min:0,max:3,step:.1})},X7e=3;function A$(e,t,r){var n=t.members[t.offsets[t.feature]],a=r.members[r.offsets[r.feature]];if(n===a&&t.unit===r.unit)return!1;var i=a3(t.unit,n),o=a3(r.unit,a);return!(i&&o&&i!==o||t.unit.residueIndex[t.unit.elements[n]]===r.unit.residueIndex[r.unit.elements[a]]&&t.unit===r.unit||O7e(e,t.unit,n,r.unit,a))}function mN(e,t,r,n){var a=a3(e,t),i=a3(r,n);return a&&i&&a!==i}function vN(e,t){for(var r=t.feature,n=t.offsets,a=t.members,i=n[r],o=n[r+1];i<o;++i)if(a[i]===e)return!0;return!1}var lf=A(),dT=A(),fT=A(),Y7e=VX();function T$(e,t,r,n){var a=t.feature,i=r.feature,o=t.members[t.offsets[a]],s=r.members[r.offsets[i]];Ln.position(dT,t),Ln.position(fT,r),A.scale(lf,A.add(lf,dT,fT),.5);var u=n*X7e,l=e.lookup3d.find(lf[0],lf[1],lf[2],u,Y7e),c=l.count,d=l.indices,f=l.units,p=l.squaredDistances;if(c===0)return!0;for(var h=0;h<c;++h){var m=d[h],v=f[h];if(!!We.isAtomic(v)){var g=Vr(v,m);if(g!=="H"){var y=yb(g);if(!(y*y*n*n<=p[h])&&!(mN(v,m,t.unit,o)||mN(v,m,r.unit,s))&&!(t.unit===v&&vN(m,t)||r.unit===v&&vN(m,r))&&(v.conformation.position(v.elements[m],lf),!(A.squaredDistance(lf,dT)<1||A.squaredDistance(lf,fT)<1)))return!1}}}return!0}function K7e(e,t,r,n,a,i){for(var o=0,s=a;o<s.length;o++){var u=s[o];$7e(e,t,r,n,u,i)}}function $7e(e,t,r,n,a,i){for(var o=r.x,s=r.y,u=r.z,l=r.subset(a.requiredFeatures),c=l.lookup3d,d=l.indices,f=Ln.Info(e,t,r),p=T({},f),h=i.lineOfSightDistFactor,m=0,v=Ne.size(d);m<v;++m){var g=Ne.getAt(d,m),y=c.find(o[g],s[g],u[g],a.maxDistance),b=y.count,S=y.indices,x=y.squaredDistances;if(b!==0){f.feature=g;for(var C=0;C<b;++C){var w=Ne.getAt(d,S[C]);if(!(w<=g)&&(p.feature=w,!!A$(e,f,p))){var _=a.getType(e,f,p,x[C]);_&&T$(e,f,p,h)&&n.add(g,w,_)}}}}}var Q7e=de();function Z7e(e,t,r,n,a,i,o,s){var u=r.count,l=r.x,c=r.y,d=r.z,f=a.lookup3d,p=de.mul(Q7e,n.conformation.operator.inverse,t.conformation.operator.matrix),h=!de.isIdentity(p),m=A(),v=Math.max.apply(Math,o.map(function(V){return V.maxDistance})),g=f.boundary.sphere,y=g.center,b=g.radius,S=(b+v)*(b+v),x=s.lineOfSightDistFactor,C=Ln.Info(e,t,r),w=Ln.Info(e,n,a);i.startUnitPair(t,n);for(var _=0;_<u;++_)if(A.set(m,l[_],c[_],d[_]),h&&A.transformMat4(m,m,p),!(A.squaredDistance(m,y)>S)){var E=f.find(m[0],m[1],m[2],v),P=E.indices,D=E.count,k=E.squaredDistances;if(D!==0){C.feature=_;for(var F=0;F<D;++F){var X=P[F];if(w.feature=X,!!A$(e,C,w))for(var U=k[F],j=0,te=o;j<te.length;j++){var q=te[j];if(U<q.maxDistance*q.maxDistance){var W=q.getType(e,C,w,U);if(W&&T$(e,C,w,x)){i.add(_,X,W);break}}}}}}i.finishUnitPair()}var J7e={distanceMax:M.Numeric(4,{min:1,max:5,step:.1}),angleMax:M.Numeric(30,{min:0,max:60,step:1})},e9e=["CL","BR","I","AT"];function t9e(e,t,r){for(var n=t.elements,a=t.model.atomicConformation,i=a.x,o=a.y,s=a.z,u=0,l=n.length;u<l;++u){var c=Vr(t,u);e9e.includes(c)&&r.add(6,0,i[n[u]],o[n[u]],s[n[u]],u)}}var r9e=["N","O","S"],n9e=["C","N","P","S"];function a9e(e,t,r){for(var n=t.elements,a=t.model.atomicConformation,i=a.x,o=a.y,s=a.z,u=function(d,f){var p=Vr(t,d);if(r9e.includes(p)){var h=!1;gu(e,t,d,function(m,v){n9e.includes(Vr(m,v))&&(h=!0)}),h&&r.add(7,0,i[n[d]],o[n[d]],s[n[d]],d)}},l=0,c=n.length;l<c;++l)u(l)}function i9e(e,t){return e===7&&t===6||e===6&&t===7}var o9e=rn(180),s9e=rn(120);function u9e(e){return{angleMax:rn(e.angleMax)}}function l9e(e,t,r,n){var a=t.types[t.feature],i=r.types[r.feature];if(!!i9e(a,i)){var o=a===6?[t,r]:[r,t],s=o[0],u=o[1],l=s.members[s.offsets[s.feature]],c=u.members[u.offsets[u.feature]],d=u3(e,s.unit,l,u.unit,c);if(d.length===1&&!(o9e-d[0]>n.angleMax)){var f=u3(e,u.unit,c,s.unit,l);if(f.length!==0&&!f.some(function(p){return s9e-p>n.angleMax}))return 5}}}var c9e=Ln.Provider([6],t9e),d9e=Ln.Provider([7],a9e),f9e={name:"halogen-bonds",params:J7e,createTester:function(e){var t=u9e(e);return{maxDistance:e.distanceMax,requiredFeatures:new Set([6,7]),getType:function(r,n,a){return l9e(r,n,a,t)}}}},E$={distanceMax:M.Numeric(3.5,{min:1,max:5,step:.1}),backbone:M.Boolean(!0,{description:"Include backbone-to-backbone hydrogen bonds"}),accAngleDevMax:M.Numeric(45,{min:0,max:180,step:1},{description:"Max deviation from ideal acceptor angle"}),donAngleDevMax:M.Numeric(45,{min:0,max:180,step:1},{description:"Max deviation from ideal donor angle"}),accOutOfPlaneAngleMax:M.Numeric(90,{min:0,max:180,step:1}),donOutOfPlaneAngleMax:M.Numeric(45,{min:0,max:180,step:1})},p9e=T(T({},E$),{water:M.Boolean(!1,{description:"Include water-to-water hydrogen bonds"}),sulfurDistanceMax:M.Numeric(4.1,{min:1,max:5,step:.1})}),h9e=T({},E$);function Jk(e,t){var r=wb.get(e).value;if(!r)throw Error("expected valence model to be available");var n=r.get(t.id);if(!n)throw Error("expected valence model for unit to be available");return n}function m9e(e,t,r){for(var n=Jk(e,t).totalH,a=t.elements,i=t.model.atomicConformation,o=i.x,s=i.y,u=i.z,l=t.rings.elementAromaticRingIndices,c=0,d=a.length;c<d;++c)if(!l.has(c)){var f=Vr(t,c);(P$(t,c)||n[c]>0&&(f==="N"||f==="O"||f==="S"))&&r.add(4,0,o[a[c]],s[a[c]],u[a[c]],c)}}function v9e(e,t,r){for(var n=Jk(e,t).totalH,a=t.elements,i=t.model.atomicConformation,o=i.x,s=i.y,u=i.z,l=0,c=a.length;l<c;++l)Vr(t,l)==="C"&&n[l]>0&&(go(e,t,l,"N")>0||go(e,t,l,"O")>0||g9e(t,l))&&r.add(9,0,o[a[l]],s[a[l]],u[a[l]],l)}function g9e(e,t){var r=e.rings,n=r.elementAromaticRingIndices,a=r.all,i=n.get(t);if(i===void 0)return!1;for(var o=0,s=i.length;o<s;++o)for(var u=a[i[o]],l=0,c=u.length;l<c;++l){var d=Vr(e,u[l]);if(d==="N"||d==="O")return!0}return!1}function y9e(e,t,r){for(var n=Jk(e,t),a=n.charge,i=n.implicitH,o=n.idealGeometry,s=t.elements,u=t.model.atomicConformation,l=u.x,c=u.y,d=u.z,f=t.rings.elementAromaticRingIndices,p=function(S){r.add(5,0,l[s[S]],c[s[S]],d[s[S]],S)},h=0,m=s.length;h<m;++h)if(!f.has(h)){var v=Vr(t,h);if(v==="O")p(h);else if(v==="N"){if(P$(t,h))p(h);else if(a[h]<1){var g=Cd(e,t,h)+i[h],y=o[h];(y===4&&g<4||y===3&&g<3||y===2&&g<2)&&p(h)}}else if(v==="S"){var b=Zk(t,h);(b==="CYS"||b==="MET"||w$(t,h)===-1)&&p(h)}}}function gN(e,t){return e.model.atomicHierarchy.derived.residue.moleculeType[e.residueIndex[e.elements[t]]]===2}function yN(e,t){return bd.has(G1(e,t))}function b9e(e,t){return e.rings.elementRingIndices.has(t)}function P$(e,t){return Zk(e,t)==="HIS"&&Vr(e,t)==="N"&&b9e(e,t)}function x9e(e,t,r,n){return yN(e,t)&&yN(r,n)}function S9e(e,t,r,n){return gN(e,t)&&gN(r,n)}function C9e(e,t){return e===5&&t===4||e===4&&t===5}function w9e(e,t){return e===9&&t===5||e===5&&t===9}function I$(e){return{includeBackbone:e.backbone,maxAccAngleDev:rn(e.accAngleDevMax),maxDonAngleDev:rn(e.donAngleDevMax),maxAccOutOfPlaneAngle:rn(e.accOutOfPlaneAngleMax),maxDonOutOfPlaneAngle:rn(e.donOutOfPlaneAngleMax)}}function _9e(e){return T(T({},I$(e)),{includeWater:e.water,maxSulfurDistSq:e.sulfurDistanceMax*e.sulfurDistanceMax,maxDistSq:e.distanceMax*e.distanceMax})}var bN=rn(120);function M$(e,t,r,n){var a=t.members[t.offsets[t.feature]],i=r.members[r.offsets[r.feature]];if(!(!n.includeBackbone&&x9e(t.unit,a,r.unit,i))){var o=u3(e,t.unit,a,r.unit,i),s=fN.get(t.idealGeometry[a])||bN;if(!o.some(function(d){return Math.abs(s-d)>n.maxDonAngleDev})){if(t.idealGeometry[a]===3){var u=pN(e,t.unit,a,r.unit,i);if(u!==void 0&&u>n.maxDonOutOfPlaneAngle)return}var l=u3(e,r.unit,i,t.unit,a),c=fN.get(r.idealGeometry[i])||bN;if(!l.some(function(d){return c-d>n.maxAccAngleDev})){if(r.idealGeometry[i]===3){var u=pN(e,r.unit,i,t.unit,a);if(u!==void 0&&u>n.maxAccOutOfPlaneAngle)return}return!0}}}}function A9e(e,t,r,n,a){var i=t.types[t.feature],o=r.types[r.feature];if(!!C9e(i,o)){var s=o===5?[t,r]:[r,t],u=s[0],l=s[1],c=u.members[u.offsets[u.feature]],d=l.members[l.offsets[l.feature]],f=Vr(u.unit,c)==="S"||Vr(l.unit,d)==="S"?a.maxSulfurDistSq:a.maxDistSq;if(!(n>f)&&!(!a.includeWater&&S9e(u.unit,c,l.unit,d))&&!!M$(e,u,l,a))return 4}}function T9e(e,t,r,n,a){var i=t.types[t.feature],o=r.types[r.feature];if(!!w9e(i,o)){var s=o===5?[t,r]:[r,t],u=s[0],l=s[1];if(!!M$(e,u,l,a))return 8}}var E9e=Ln.Provider([4],m9e),P9e=Ln.Provider([9],v9e),I9e=Ln.Provider([5],y9e),M9e={name:"hydrogen-bonds",params:p9e,createTester:function(e){var t=Math.max(e.distanceMax,e.sulfurDistanceMax),r=_9e(e);return{maxDistance:t,requiredFeatures:new Set([4,5]),getType:function(n,a,i,o){return A9e(n,a,i,o,r)}}}},D9e={name:"weak-hydrogen-bonds",params:h9e,createTester:function(e){var t=I$(e);return{maxDistance:e.distanceMax,requiredFeatures:new Set([9,5]),getType:function(r,n,a,i){return T9e(r,n,a,i,t)}}}};function k9e(e,t,r){return Vr(t,r)==="S"&&go(e,t,r,"O")===3}function R9e(e,t,r){return Vr(t,r)==="S"&&go(e,t,r,"O")===4}function xN(e,t,r){return Vr(t,r)==="P"&&go(e,t,r,"O")===Cd(e,t,r)}function O9e(e,t,r){var n=0;return Vr(t,r)==="C"&&go(e,t,r,"O")===2&&go(e,t,r,"C")===1&&gu(e,t,r,function(a,i){Vr(a,i)==="O"&&Cd(e,a,i)-go(e,a,i,"H")===1&&(n+=1)}),n===2}function B9e(e,t,r){var n=0;return Vr(t,r)==="C"&&Cd(e,t,r)===3&&go(e,t,r,"N")===3&&gu(e,t,r,function(a,i){Cd(e,a,i)-go(e,a,i,"H")===1&&(n+=1)}),n===2}function F9e(e,t,r){var n=0;return Vr(t,r)==="C"&&Cd(e,t,r)===3&&go(e,t,r,"N")===2&&go(e,t,r,"C")===1&&gu(e,t,r,function(a,i){Cd(e,a,i)-go(e,a,i,"H")===1&&(n+=1)}),n===2}var L9e={distanceMax:M.Numeric(5,{min:0,max:8,step:.1})},N9e={distanceMax:M.Numeric(5.5,{min:1,max:8,step:.1}),offsetMax:M.Numeric(2,{min:0,max:4,step:.1}),angleDevMax:M.Numeric(30,{min:0,max:180,step:1})},z9e={distanceMax:M.Numeric(6,{min:1,max:8,step:.1}),offsetMax:M.Numeric(2,{min:0,max:4,step:.1})},U9e=["ARG","HIS","LYS"],V9e=["GLU","ASP"];function D$(e,t){var r=wb.get(e).value;if(!r)throw Error("expected valence model to be available");var n=r.get(t.id);if(!n)throw Error("expected valence model for unit to be available");return n}function H9e(e,t,r){for(var n=D$(e,t).charge,a=t.elements,i=t.model.atomicConformation,o=i.x,s=i.y,u=i.z,l=new Set,c=t.model.atomicHierarchy.atoms.label_comp_id,d=pr.transientSegments(t.model.atomicHierarchy.residueAtomSegments,a);d.hasNext;){var f=d.move(),p=f.index,h=f.start,m=f.end,v=c.value(t.model.atomicHierarchy.residueAtomSegments.offsets[p]);if(U9e.includes(v)){r.startState();for(var g=h;g<m;++g)Vr(t,g)==="N"&&!bd.has(G1(t,g))&&r.pushMember(o[a[g]],s[a[g]],u[a[g]],g);r.finishState(1,0)}else if(!gb.has(v)){l.clear();for(var g=h;g<m;++g){var y=0;B9e(e,t,g)?y=8:F9e(e,t,g)&&(y=9),y&&(r.startState(),gu(e,t,g,function(S,x){Vr(t,x)==="N"&&(l.add(x),r.pushMember(o[a[x]],s[a[x]],u[a[x]],x))}),r.finishState(1,y))}for(var g=h;g<m;++g)n[g]>0&&!l.has(g)&&r.add(1,0,o[a[g]],s[a[g]],u[a[g]],g)}}}function j9e(e,t,r){for(var n=D$(e,t).charge,a=t.elements,i=t.model.atomicConformation,o=i.x,s=i.y,u=i.z,l=new Set,c=t.model.atomicHierarchy.atoms.label_comp_id,d=pr.transientSegments(t.model.atomicHierarchy.residueAtomSegments,a);d.hasNext;){var f=d.move(),p=f.index,h=f.start,m=f.end,v=c.value(t.model.atomicHierarchy.residueAtomSegments.offsets[p]);if(V9e.includes(v)){r.startState();for(var g=h;g<m;++g)Vr(t,g)==="O"&&!bd.has(G1(t,g))&&r.pushMember(o[a[g]],s[a[g]],u[a[g]],g);r.finishState(2,0)}else if(n_.has(v))for(var g=h;g<m;++g)xN(e,t,g)&&(r.startState(),gu(e,t,g,function(S,x){Vr(t,x)==="O"&&r.pushMember(o[a[x]],s[a[x]],u[a[x]],x)}),r.finishState(2,6));else if(!gb.has(v)){for(var g=h;g<m;++g){r.startState(),Vr(t,g)==="N"&&!bd.has(G1(t,g))&&r.pushMember(o[a[g]],s[a[g]],u[a[g]],g),r.finishState(2,0);var y=0;k9e(e,t,g)?y=4:xN(e,t,g)?y=6:R9e(e,t,g)?y=5:O9e(e,t,g)&&(y=10),y&&(r.startState(),gu(e,t,g,function(S,x){Vr(t,x)==="O"&&(l.add(x),r.pushMember(o[a[x]],s[a[x]],u[a[x]],x))}),r.finishState(2,y))}for(var g=h;g<m;++g)n[g]<0&&!l.has(g)&&r.add(2,0,o[a[g]],s[a[g]],u[a[g]],g)}}}function G9e(e,t,r){for(var n=t.elements,a=t.model.atomicConformation,i=a.x,o=a.y,s=a.z,u=0,l=t.rings.aromaticRings;u<l.length;u++){var c=l[u],d=t.rings.all[c];r.startState();for(var f=0,p=d.length;f<p;++f){var h=d[f];r.pushMember(i[n[h]],o[n[h]],s[n[h]],h)}r.finishState(3,0)}}function q9e(e,t){return e===2&&t===1||e===1&&t===2}function W9e(e,t){return e===3&&t===3}function X9e(e,t){return e===3&&t===1||e===1&&t===3}var SN=A(),CN=A();function Y9e(e,t,r){for(var n=e.feature,a=e.offsets,i=e.members,o=t.feature,s=t.offsets,u=t.members,l=a[n],c=a[n+1];l<c;++l){var d=i[l];e.unit.conformation.position(e.unit.elements[d],SN);for(var f=s[o],p=s[o+1];f<p;++f){var h=u[f];if(t.unit.conformation.position(t.unit.elements[h],CN),A.squaredDistance(SN,CN)<r)return!0}}return!1}var l3=A(),Fv=A(),c3=A(),ux=A();function vI(e,t){var r=t.unit,n=t.feature,a=t.offsets,i=t.members,o=r.elements,s=a[n];return t.unit.conformation.position(o[i[s]],l3),t.unit.conformation.position(o[i[s+1]],Fv),t.unit.conformation.position(o[i[s+2]],c3),A.triangleNormal(e,l3,Fv,c3)}var gI=function(e,t,r){return Ln.position(l3,e),Ln.position(Fv,t),A.sub(c3,l3,Fv),A.projectOnPlane(ux,c3,r),A.add(ux,ux,Fv),A.distance(ux,Fv)};function K9e(e){return{distanceMaxSq:e.distanceMax*e.distanceMax}}function $9e(e){return{offsetMax:e.offsetMax,angleDevMax:rn(e.angleDevMax)}}function Q9e(e){return{offsetMax:e.offsetMax}}var Z9e=rn(180),wN=rn(90),jy=A(),pT=A();function J9e(e,t,r,n,a){var i=t.types[t.feature],o=r.types[r.feature];if(q9e(i,o)&&Y9e(t,r,a.distanceMaxSq))return 1}function eNe(e,t,r,n,a){var i=t.types[t.feature],o=r.types[r.feature];if(W9e(i,o)){vI(jy,t),vI(pT,r);var s=A.angle(jy,pT),u=Math.min(gI(t,r,pT),gI(r,t,jy));if(u<=a.offsetMax){if(s<=a.angleDevMax||s>=Z9e-a.angleDevMax)return 3;if(s<=a.angleDevMax+wN&&s>=wN-a.angleDevMax)return 3}}}function tNe(e,t,r,n,a){var i=t.types[t.feature],o=r.types[r.feature];if(X9e(i,o)){var s=i===3?[t,r]:[r,t],u=s[0],l=s[1];vI(jy,u);var c=gI(l,u,jy);if(c<=a.offsetMax)return 2}}var rNe=Ln.Provider([2],j9e),nNe=Ln.Provider([1],H9e),aNe=Ln.Provider([3],G9e),iNe={name:"ionic",params:L9e,createTester:function(e){var t=K9e(e);return{maxDistance:e.distanceMax,requiredFeatures:new Set([2,1]),getType:function(r,n,a,i){return J9e(r,n,a,i,t)}}}},oNe={name:"pi-stacking",params:N9e,createTester:function(e){var t=$9e(e);return{maxDistance:e.distanceMax,requiredFeatures:new Set([3]),getType:function(r,n,a,i){return eNe(r,n,a,i,t)}}}},sNe={name:"cation-pi",params:z9e,createTester:function(e){var t=Q9e(e);return{maxDistance:e.distanceMax,requiredFeatures:new Set([3,1]),getType:function(r,n,a,i){return tNe(r,n,a,i,t)}}}},uNe={distanceMax:M.Numeric(4,{min:1,max:5,step:.1})};function lNe(e,t,r){for(var n=t.elements,a=t.model.atomicConformation,i=a.x,o=a.y,s=a.z,u=function(d,f){var p=Vr(t,d),h=!1;p==="C"?(h=!0,gu(e,t,d,function(m,v){var g=Vr(m,v);g!=="C"&&g!=="H"&&(h=!1)})):p==="F"&&(h=!0),h&&r.add(8,0,i[n[d]],o[n[d]],s[n[d]],d)},l=0,c=n.length;l<c;++l)u(l)}function cNe(e,t){return e===8&&t===8}function dNe(e,t,r,n){var a=t.types[t.feature],i=r.types[r.feature];if(!!cNe(a,i)){var o=t.members[t.offsets[t.feature]],s=r.members[r.offsets[r.feature]];if(!(Vr(t.unit,o)==="F"&&Vr(r.unit,s)==="F"))return 6}}var fNe=Ln.Provider([8],lNe),pNe={name:"hydrophobic",params:uNe,createTester:function(e){return{maxDistance:e.distanceMax,requiredFeatures:new Set([8]),getType:function(t,r,n,a){return dNe(t,r,n)}}}},hNe={distanceMax:M.Numeric(3,{min:1,max:5,step:.1})},mNe=["LI","NA","K","RB","CS","MG","CA","SR","BA","AL","GA","IN","TL","SC","SN","PB","BI","SB","HG"];function vNe(e,t,r){for(var n=t.elements,a=t.model.atomicConformation,i=a.x,o=a.y,s=a.z,u=0,l=n.length;u<l;++u){var c=Vr(t,u),d=0;mNe.includes(c)?d=13:(dY(c)||c==="ZN"||c==="CD")&&(d=12),d&&r.add(d,0,i[n[u]],o[n[u]],s[n[u]],u)}}function _N(e){return!bd.has(e)}function gNe(e){return bd.has(e)}function yNe(e){return Zw.has(e)}function bNe(e,t,r){for(var n=t.elements,a=t.model.atomicConformation,i=a.x,o=a.y,s=a.z,u=0,l=n.length;u<l;++u){var c=Vr(t,u),d=Zk(t,u),f=G1(t,u),p=!1,h=!1,m=e_.has(d),v=n_.has(d);!m&&!v?QDe(c)||c==="O"||c==="S"?(p=!0,h=!0):c==="N"&&(p=!0):m?c==="O"?(["ASP","GLU","SER","THR","TYR","ASN","GLN"].includes(d)&&_N(f)||gNe(f))&&(p=!0,h=!0):c==="S"&&(d==="CYS"||d==="MET")?(p=!0,h=!0):c==="N"&&d==="HIS"&&_N(f)&&(p=!0):v&&(c==="O"&&yNe(f)?(p=!0,h=!0):["N3","N4","N7"].includes(f)?p=!0:["O2","O4","O6"].includes(f)&&(p=!0,h=!0)),p&&r.add(11,0,i[n[u]],o[n[u]],s[n[u]],u),h&&r.add(10,0,i[n[u]],o[n[u]],s[n[u]],u)}}function AN(e,t){if(e===12)return t===11||t===12;if(e===13)return t===10}function xNe(e,t,r,n){var a=t.types[t.feature],i=r.types[r.feature];if(!(!AN(a,i)&&!AN(i,a)))return 7}var SNe=Ln.Provider([13,12],vNe),CNe=Ln.Provider([10,11],bNe),wNe={name:"metal-coordination",params:hNe,createTester:function(e){return{maxDistance:e.distanceMax,requiredFeatures:new Set([13,12,10,11]),getType:function(t,r,n,a){return xNe(t,r,n)}}}};function _Ne(e,t){for(var r=t.contacts,n=t.unitsContacts,a=t.unitsFeatures,i=[ANe(e,t),TNe(e,t),ENe(e,t),PNe(e,t),INe(e,t)],o=0,s=r.edgeCount;o<s;++o){var u=r.edges[o],l=e.unitMap.get(u.unitA),c=e.unitMap.get(u.unitB),d=Ln.Info(e,l,a.get(u.unitA));d.feature=u.indexA;var f=Ln.Info(e,c,a.get(u.unitB));f.feature=u.indexB;for(var p=0,h=i;p<h.length;p++){var m=h[p];m.isApplicable(u.props.type)&&m.handleInterContact(o,d,f)}}for(var v=n.keys();;){var g=v.next(),y=g.done,b=g.value;if(y)break;var S=n.get(b),x=a.get(b),C=e.unitMap.get(b);if(!!We.isAtomic(C)){for(var d=Ln.Info(e,C,x),f=Ln.Info(e,C,x),w=0,_=i;w<_.length;w++){var m=_[w];m.startUnit(C,S,x)}for(var o=0,s=S.edgeCount*2;o<s;++o){d.feature=S.a[o],f.feature=S.b[o];for(var E=0,P=i;E<P.length;E++){var m=P[E];m.isApplicable(S.edgeProps.type[o])&&m.handleIntraContact(o,d,f)}}}}}function ANe(e,t){var r=t.contacts,n=function(l,c,d,f,p){var h=f.get(d)||[1/0,-1],m=h[0],v=h[1];l<m?(v!==-1&&p(v),f.set(d,[l,c])):p(c)};function a(l,c,d,f,p){var h=c.members[c.offsets[c.feature]],m=d.members[d.offsets[d.feature]],v=c.unit.getResidueIndex(h),g=d.unit.getResidueIndex(m),y=h+"|"+c.unit.id+"|"+g+"|"+d.unit.id+"|A",b=m+"|"+d.unit.id+"|"+v+"|"+c.unit.id+"|B",S=Ln.distance(c,d);n(S,l,y,f,p),n(S,l,b,f,p)}var i=new Map,o=function(l){return r.edges[l].props.flag=1},s,u;return{isApplicable:function(l){return l===6},handleInterContact:function(l,c,d){a(l,c,d,i,o)},startUnit:function(l,c,d){s=new Map,u=function(f){return c.edgeProps.flag[f]=1}},handleIntraContact:function(l,c,d){a(l,c,d,s,u)}}}function TNe(e,t){var r=t.contacts,n=function(a,i){for(var o=a.types[a.feature]===9?i:a,s=o.members[o.offsets[o.feature]],u=t.unitsContacts.get(o.unit.id),l=u.edgeProps.type,c=u.elementsIndex,d=c.offsets,f=c.indices,p=d[s],h=d[s+1];p<h;++p)if(l[f[p]]===4)return!0;for(var m=r.getEdgeIndices(o.feature,o.unit.id),p=0,h=m.length;p<h;++p)if(r.edges[m[p]].props.type===4)return!0;return!1};return{isApplicable:function(a){return a===8},handleInterContact:function(a,i,o){n(i,o)&&(r.edges[a].props.flag=1)},startUnit:function(){},handleIntraContact:function(a,i,o){if(n(i,o)){var s=t.unitsContacts.get(i.unit.id).edgeProps.flag;s[a]=1}}}}function eR(e,t,r,n,a){for(var i=r.offsets,o=r.feature,s=n.offsets,u=n.feature,l=i[o],c=i[o+1];l<c;++l)for(var d=r.members[l],f=a.getContactIndicesForElement(d,r.unit),p=0,h=f.length;p<h;++p){var m=f[p];if(e.includes(a.edges[m].props.type))for(var v=s[u],g=s[u+1];v<g;++v){var y=n.members[v];if(a.getContactIndicesForElement(y,n.unit).includes(m)){a.edges[t].props.flag=1;return}}}}function tR(e,t,r,n,a){for(var i=a.edgeProps,o=i.type,s=i.flag,u=a.elementsIndex,l=u.offsets,c=u.indices,d=r.offsets,f=r.feature,p=n.offsets,h=n.feature,m=d[f],v=d[f+1];m<v;++m)for(var g=r.members[m],y=l[g],b=l[g+1];y<b;++y){var S=c[y];if(e.includes(o[S])){for(var x=p[h],C=p[h+1];x<C;++x)for(var w=n.members[x],_=l[w],E=l[w+1];_<E;++_)if(S===c[_]){s[t]=1;return}}}}function ENe(e,t){var r=t.contacts;return{isApplicable:function(n){return n===1},handleInterContact:function(n,a,i){eR([4,8],n,a,i,r)},startUnit:function(){},handleIntraContact:function(n,a,i){tR([4,8],n,a,i,t.unitsContacts.get(a.unit.id))}}}function PNe(e,t){var r=t.contacts;return{isApplicable:function(n){return n===6||n===2},handleInterContact:function(n,a,i){eR([3],n,a,i,r)},startUnit:function(){},handleIntraContact:function(n,a,i){tR([3],n,a,i,t.unitsContacts.get(a.unit.id))}}}function INe(e,t){var r=t.contacts;return{isApplicable:function(n){return n===1},handleInterContact:function(n,a,i){eR([7],n,a,i,r)},startUnit:function(){},handleIntraContact:function(n,a,i){tR([7],n,a,i,t.unitsContacts.get(a.unit.id))}}}var wd;(function(e){function t(c,d,f,p,h,m){return DW("interactions",{structure:d,interactions:c},{unitA:f,indexA:p,unitB:h,indexB:m})}e.Location=t;function r(c){return!!c&&c.kind==="data-location"&&c.tag==="interactions"}e.isLocation=r;function n(c,d){return c.data.structure===d.data.structure&&c.data.interactions===d.data.interactions&&c.element.indexA===d.element.indexA&&c.element.indexB===d.element.indexB&&c.element.unitA===d.element.unitA&&c.element.unitB===d.element.unitB}e.areLocationsEqual=n;function a(c,d){var f=d.unitA,p=d.indexA,h=d.unitB,m=d.indexB,v=c.contacts,g=c.unitsContacts;if(f===h){var y=g.get(f.id),b=y.getDirectedEdgeIndex(p,m);return hN(y.edgeProps.type[b])}else{var b=v.getEdgeIndex(p,f.id,m,h.id);return hN(v.edges[b].props.type)}}function i(c){return a(c.data.interactions,c.element)}e.locationLabel=i;function o(c,d,f){return p_("interactions",{structure:c,interactions:d},f,function(p){return u(d,f,p)},function(){return l(c,d,f)})}e.Loci=o;function s(c){return!!c&&c.kind==="data-loci"&&c.tag==="interactions"}e.isLoci=s;function u(c,d,f){var p=c.unitsFeatures;return gd.fromPairProvider(d.length,function(h,m,v){var g=d[h];Ln.setPosition(m,g.unitA,g.indexA,p.get(g.unitA.id)),Ln.setPosition(v,g.unitB,g.indexB,p.get(g.unitB.id))},f)}e.getBoundingSphere=u;function l(c,d,f){var p=f[0];if(p===void 0)return"";var h=p.unitA,m=p.indexA,v=p.unitB,g=p.indexB,y=d.unitsFeatures,b=y.get(h.id),S=b.members,x=b.offsets,C=y.get(v.id),w=C.members,_=C.offsets,E={granularity:"element"};return(x[m+1]-x[m]>1||_[g+1]-_[g]>1)&&(E.granularity="residue"),[a(d,p),Hk($t.Location(c,h,S[x[m]],c,v,w[_[g]]),E)].join("</br>")}e.getLabel=l})(wd||(wd={}));var MNe=[E9e,P9e,I9e,rNe,nNe,aNe,c9e,d9e,fNe,SNe,CNe],d3={ionic:iNe,"pi-stacking":oNe,"cation-pi":sNe,"halogen-bonds":f9e,"hydrogen-bonds":M9e,"weak-hydrogen-bonds":D9e,hydrophobic:pNe,"metal-coordination":wNe};function DNe(e){e===void 0&&(e=[]);var t=Object.create(null);return Object.keys(d3).forEach(function(r){t[r]=M.MappedStatic(e.includes(r)?"on":"off",{on:M.Group(d3[r].params),off:M.Group({})},{cycle:!0})}),t}var kNe=DNe(["cation-pi","pi-stacking","hydrogen-bonds","halogen-bonds","metal-coordination"]),k$={providers:M.Group(kNe,{isFlat:!0}),contacts:M.Group(W7e,{label:"Advanced Options"})};function RNe(e,t,r){return pe(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d,f,p,h,m,v,g,y;return he(this,function(b){switch(b.label){case 0:return n=T(T({},M.getDefaultValues(k$)),r),[4,wb.attach(e,t)];case 1:b.sent(),a=[],f_(d3).forEach(function(S){var x=n.providers[S],C=x.name,w=x.params;C==="on"&&a.push(d3[S].createTester(w))}),i=new Set,a.forEach(function(S){return Aa.add(i,S.requiredFeatures)}),o=MNe.filter(function(S){return Aa.areIntersecting(i,S.types)}),s=hu.Mutable(),u=hu.Mutable(),l=0,c=t.unitSymmetryGroups.length,b.label=2;case 2:return l<c?(d=t.unitSymmetryGroups[l],e.runtime.shouldUpdate?[4,e.runtime.update({message:"computing interactions",current:l,max:c})]:[3,4]):[3,6];case 3:b.sent(),b.label=4;case 4:for(f=ONe(t,d.units[0],o),p=BNe(t,d.units[0],f,a,n.contacts),h=0,m=d.units.length;h<m;++h)v=d.units[h],s.set(v.id,f),u.set(v.id,p);b.label=5;case 5:return++l,[3,2];case 6:return g=FNe(t,s,a,n.contacts),y={unitsFeatures:s,unitsContacts:u,contacts:g},_Ne(t,y),[2,y]}})})}function ONe(e,t,r){var n=t.elements.length,a=fI.create(n,n/2);if(We.isAtomic(t))for(var i=0,o=r;i<o.length;i++){var s=o[i];s.add(e,t,a)}return a.getFeatures(n)}function BNe(e,t,r,n,a){var i=hI.create(r,t.elements.length);return We.isAtomic(t)&&K7e(e,t,r,i,n,a),i.getContacts()}function FNe(e,t,r,n){var a=mI.create();return $e.eachUnitPair(e,function(i,o){var s=t.get(i.id),u=t.get(o.id);Z7e(e,i,s,o,u,a,r,n)},{maxRadius:Math.max.apply(Math,r.map(function(i){return i.maxDistance})),validUnit:function(i){return We.isAtomic(i)},validUnitPair:function(i,o){return $e.validUnitPair(e,i,o)}}),a.getContacts(t)}var hT=T({},k$),oa=Cp.createProvider({label:"Interactions",descriptor:vu({name:"molstar_computed_interactions"}),type:"local",defaultParams:hT,getParams:function(e){return hT},isApplicable:function(e){return!e.isCoarseGrained},obtain:function(e,t,r){return pe(void 0,void 0,void 0,function(){var n,a;return he(this,function(i){switch(i.label){case 0:return n=T(T({},M.getDefaultValues(hT)),r),a={},[4,RNe(e,t,n)];case 1:return[2,(a.value=i.sent(),a)]}})})}}),yI=vt(13421772),LNe="Assigns colors according the interaction type of a link.",Xi={HydrogenBond:2851770,Hydrophobic:8421504,HalogenBond:4259775,Ionic:15779860,MetalCoordination:9191577,CationPi:16744448,PiStacking:9220966,WeakHydrogenBond:12967404},NNe=[["Hydrogen Bond",Xi.HydrogenBond],["Hydrophobic",Xi.Hydrophobic],["Halogen Bond",Xi.HalogenBond],["Ionic",Xi.Ionic],["Metal Coordination",Xi.MetalCoordination],["Cation Pi",Xi.CationPi],["Pi Stacking",Xi.PiStacking],["Weak HydrogenBond",Xi.WeakHydrogenBond]];function TN(e){switch(e){case 4:return Xi.HydrogenBond;case 6:return Xi.Hydrophobic;case 5:return Xi.HalogenBond;case 1:return Xi.Ionic;case 7:return Xi.MetalCoordination;case 2:return Xi.CationPi;case 3:return Xi.PiStacking;case 8:return Xi.WeakHydrogenBond;case 0:return yI}}var R$={};function zNe(e){return R$}function O$(e,t){var r,n=e.structure?oa.get(e.structure):void 0,a=n?wm(n.id,n.version):-1;return n&&n.value?r=function(i){if(wd.isLocation(i)){var o=i.data.interactions,s=o.unitsContacts,u=o.contacts,l=i.element,c=l.unitA,d=l.unitB,f=l.indexA,p=l.indexB;if(c===d){var h=s.get(c.id),m=h.getDirectedEdgeIndex(f,p);return TN(h.edgeProps.type[m])}else{var m=u.getEdgeIndex(f,c.id,p,d.id);return TN(u.edges[m].props.type)}}return yI}:r=function(){return yI},{factory:O$,granularity:"group",color:r,props:t,contextHash:a,description:LNe,legend:Dp(NNe)}}var bI={name:"interaction-type",label:"Interaction Type",category:"Miscellaneous",factory:O$,getParams:zNe,defaultValues:M.getDefaultValues(R$),isApplicable:function(e){return!!e.structure},ensureCustomProperties:{attach:function(e,t){return t.structure?oa.attach(e,t.structure,void 0,!0):Promise.resolve()},detach:function(e){return e.structure&&oa.ref(e.structure,!1)}}};function Qu(e,t,r,n){var a=0,i=t.webgl,o=new ha,s=Vd(),u=[],l=si.create(),c,d,f,p,h=Ia.createEmpty();function m(x,C){var w=this;return x===void 0&&(x={}),C&&C!==d&&(f=r(t,C),d=C,p||(p=M.getDefaultValues(f))),p=Object.assign({},p,x),Qe.create("Creating or updating ComplexRepresentation",function(_){return pe(w,void 0,void 0,function(){var E,P,D;return he(this,function(k){switch(k.label){case 0:return E=!1,c?!((D=c.mustRecreate)===null||D===void 0)&&D.call(c,d,p,i)&&(c.destroy(),c=n(s,d,p,i),E=!0):(c=n(s,d,p,i),E=!0),P=c.createOrUpdate({webgl:i,runtime:_},h,p,C),P?[4,P]:[3,2];case 1:k.sent(),k.label=2;case 2:return E&&y(l),u.length=0,c&&c.renderObject&&u.push(c.renderObject),o.next(a++),[2]}})})})}function v(x){return x===void 0?$e.Loci(d.target):c?c.getLoci(x):zr}function g(x,C){if(!d||!Wo.is(l.markerActions,C))return!1;if($e.isLoci(x)||Oe.is(x)||$t.isLoci(x)){if(!$e.areRootsEquivalent(x.structure,d))return!1;x=cr.remap(x,d)}else if(!uu(x)&&!Hy(x))return!1;return cr.isEmpty(x)?!1:c?c.mark(x,C):!1}function y(x){if(si.update(l,x),x.visible!==void 0&&c&&c.setVisibility(x.visible&&(l.unitTransforms===null||l.unitTransforms.isIdentity)),x.alphaFactor!==void 0&&c&&c.setAlphaFactor(x.alphaFactor),x.pickable!==void 0&&c&&c.setPickable(x.pickable),x.overpaint!==void 0&&c){var C=ri.remap(x.overpaint,d);c.setOverpaint(C)}if(x.transparency!==void 0&&c){var w=ni.remap(x.transparency,d);c.setTransparency(w)}if(x.clipping!==void 0&&c){var _=cn.remap(x.clipping,d);c.setClipping(_)}x.transform!==void 0&&c&&c.setTransform(x.transform),x.unitTransforms!==void 0&&c&&c.setVisibility(l.visible&&(x.unitTransforms===null||x.unitTransforms.isIdentity))}function b(x){h=x}function S(){c&&c.destroy()}return{label:e,get groupCount(){return c?c.groupCount:0},get props(){return p},get params(){return f},get state(){return l},get theme(){return h},renderObjects:u,updated:o,createOrUpdate:m,setState:y,setTheme:b,getLoci:v,mark:g,destroy:S}}function B$(e,t,r){var n=t.elements,a=t.model;if(Ne.indexOf(n,r)!==-1){for(var i=a.atomicHierarchy.residueAtomSegments,o=i.index,s=i.offsets,u=o[r],l=[],c=s[u],d=s[u+1];c<d;++c){var f=Ne.indexOf(n,c);f!==-1&&l.push(f)}var p=Ne.ofSortedArray(nt.ofSortedArray(l));return Oe(e,[{unit:t,indices:p}])}return zr}function UNe(e,t,r){var n=t.elements,a=t.model,i=a.atomicHierarchy.atoms.label_alt_id,o=i.value(r);if(Ne.indexOf(n,r)!==-1){var s=a.atomicHierarchy.residueAtomSegments.index,u=s[r];return q1(e,t,u,o)}return Oe(e,[])}function q1(e,t,r,n){for(var a=t.elements,i=t.model,o=i.atomicHierarchy.atoms.label_alt_id,s=i.atomicHierarchy.residueAtomSegments.offsets,u=[],l=s[r],c=s[r+1];l<c;++l){var d=Ne.indexOf(a,l);if(d!==-1){var f=o.value(l);(n===f||f==="")&&u.push(d)}}var p=Ne.ofSortedArray(nt.ofSortedArray(u));return Oe(e,[{unit:t,indices:p}])}function F$(e,t){for(var r=e.units,n=r.length,a=n*16,i=t&&t.aTransform.ref.value.length>=a?t.aTransform.ref.value:new Float32Array(a),o=0;o<n;o++)de.toArray(r[o].conformation.operator.matrix,i,o*16);return ck(i,n,t)}var VNe={atomic:{},spheres:{},gaussians:{}},HNe=M.objectToOptions(VNe);function jNe(e,t){for(var r=0,n=e.length;r<n;++r)if(We.isAtomic(t)&&e[r]==="atomic"||We.isSpheres(t)&&e[r]==="spheres"||We.isGaussians(t)&&e[r]==="gaussians")return!0;return!1}var L$=5e8;function N$(e,t,r){r===void 0&&(r=L$);var n=tr.size(A(),e);A.ceil(n,n),n.sort(function(s,u){return u-s});var a=Math.floor(Math.cbrt(r)*Math.cbrt(r)),i=n[0]*n[1],o=Math.ceil(i/(t*t));return{area:i,areaCells:o,maxAreaCells:a}}function Mm(e,t,r){r===void 0&&(r=L$);var n=N$(e,t.resolution,r),a=n.area,i=n.areaCells,o=n.maxAreaCells,s=i>o?Math.sqrt(a/o):t.resolution;return T(T({},t),{resolution:s})}function GNe(e){switch(e.kind){case 0:return e.model.atomicConformation;case 1:return e.model.coarseConformation.spheres;case 2:return e.model.coarseConformation.gaussians}}var A_={ignoreHydrogens:M.Boolean(!1,{description:"Whether or not to include hydrogen atoms in the surface calculation."}),traceOnly:M.Boolean(!1,{description:"Whether or not to only use trace atoms in the surface calculation."}),includeParent:M.Boolean(!1,{description:"Include elements of the parent structure in surface calculation to get a surface patch of the current structure."})};M.getDefaultValues(A_);var qNe=A();function WNe(e,t,r,n){return A.squaredDistance(A.set(qNe,e,t,r),n)}function XNe(e,t,r){for(var n=0,a=t.length,i=0,o=r.length;i<o;++i){var s=nt.indexOfInRange(t,r[i],n,a);s===-1?e[i]=-2:(e[i]=s,n=s)}}function T_(e,t,r){var n=r.ignoreHydrogens,a=r.traceOnly,i=r.includeParent,o=i?e.root.unitMap.get(t.id):t,s=GNe(o),u=s.x,l=s.y,c=s.z,d=o.elements,f=t.boundary.sphere,p=f.center,h=f.radius,m=(2+1.5)*2,v=(h+m)*(h+m),g,y;if(n||a||i&&o!==t){for(var b=[],S=[],x=0,C=d.length;x<C;++x){var w=d[x];n&&f3(o,w)||a&&!nR(o,w)||i&&WNe(u[w],l[w],c[w],p)>v||(b.push(w),S.push(x))}g=nt.ofSortedArray(b),y=S}else g=d,y=pu(new Int32Array(g.length));i&&o!==t&&XNe(y,t.elements,g);var _={indices:g,x:u,y:l,z:c,id:y},E=t===o?t.boundary:y0(_),P=ot.create(e,o),D=xb({},{scale:1}),k=function(F){return P.element=F,D.size(P)};return{position:_,boundary:E,radius:k}}function rR(e,t,r){var n=ot.create(e),a=xb({},{scale:1}),i,o,s,u,l;if(t||r){for(var c=[],d=[],f=[],p=[],h=[],m=0,v=0,g=e.units.length;m<g;++m){var y=e.units[m],b=y.elements,S=y.conformation,x=S.x,C=S.y,w=S.z;n.unit=y;for(var _=0,E=b.length;_<E;++_){var P=b[_];t&&f3(y,P)||r&&!nR(y,P)||(c.push(x(P)),d.push(C(P)),f.push(w(P)),n.element=P,p.push(a.size(n)),h.push(v+_))}v+=b.length}i=c,o=d,s=f,u=p,l=h}else{for(var D=e.elementCount,c=new Float32Array(D),d=new Float32Array(D),f=new Float32Array(D),p=new Float32Array(D),m=0,v=0,g=e.units.length;m<g;++m){var y=e.units[m],b=y.elements,k=y.conformation,x=k.x,C=k.y,w=k.z;n.unit=y;for(var _=0,E=b.length;_<E;++_){var P=b[_],F=v+_;c[F]=x(P),d[F]=C(P),f[F]=w(P),n.element=P,p[F]=a.size(n)}v+=b.length}i=c,o=d,s=f,u=p,l=pu(new Uint32Array(D))}var X={indices:Ne.ofRange(0,l.length),x:i,y:o,z:s,id:l},U=function(j){return u[j]};return{position:X,radius:U}}var z$=s_.H;function f3(e,t){return We.isCoarse(e)?!1:e.model.atomicHierarchy.derived.atom.atomicNumber[t]===z$}function p3(e,t){return e[t]===z$}function nR(e,t){if(We.isCoarse(e))return!0;var r=e.model.atomicHierarchy.atoms.label_atom_id.value(t);return r==="CA"||r==="BB"||r==="P"}function q0(e){if(We.isAtomic(e))return 4;for(var t=0,r=e.elements,n=e.conformation.r,a=0,i=r.length;a<i;a++){var o=n(r[a]);o>t&&(t=o)}return t+1}function E_(e){for(var t=0,r=0,n=e.unitSymmetryGroups;r<n.length;r++){var a=n[r],i=q0(a.units[0]);i>t&&(t=i)}return t}function _b(e){return M.MultiSelect(e,HNe,{description:"For which kinds of units/chains to show the representation visuals."})}var Ko={unitKinds:_b(["atomic","spheres"])},U$=T({},Wt.Params),YNe=T({},om.Params),V$=T({},su.Params),KNe=T({},im.Params),H$=T({},Mn.Params),j$=T({},mu.Params),G$=T({},bo.Params),q$=T({},il.Params);function $Ne(e,t,r,n,a,i){var o=xi.getUtils(t),s=o.createValues,u=o.createRenderableState,l=fk(),c=s(t,l,r,n,a),d=u(a);return U0(t.kind,c,d,i)}function W0(e,t){var r=e.defaultProps,n=e.createGeometry,a=e.createLocationIterator,i=e.getLoci,o=e.eachLocation,s=e.setUpdateState,u=e.mustRecreate,l=e.processValues,c=e.dispose,d=e.geometryUtils,f=d.updateValues,p=d.updateBoundingSphere,h=d.updateRenderableState,m=d.createPositionIterator,v=lc.create(),g,y,b,S,x=Object.assign({},r),C=Ia.createEmpty(),w,_,E,P;function D(j,te,q){if(!q&&!w)throw new Error("missing structure");if(y=Object.assign({},x,te),b=j,S=q,lc.reset(v),!g||!w){v.createNew=!0,v.createGeometry=!0;return}s(v,y,x,b,C,S,w),$e.areEquivalent(S,w)||(v.createGeometry=!0),$e.areHierarchiesEqual(S,w)||(v.updateTransform=!0,v.createGeometry=!0),xd.areEqual(j.color,C.color)||(v.updateColor=!0),dd(y.unitKinds,x.unitKinds)||(v.createGeometry=!0),v.updateSize&&!("uSize"in g.values)&&(v.createGeometry=!0),v.createGeometry&&(v.updateColor=!0,v.updateSize=!0)}function k(j){if(v.createNew)if(E=a(S),j)g=$Ne(S,j,E,b,y,t),P=m(j,g.values);else throw new Error("expected geometry to be given");else{if(!g)throw new Error("expected renderObject to be available");if(v.updateTransform){E=a(S);var te=E.instanceCount,q=E.groupCount;xu(te*q,g.values)}if(v.createGeometry)if(j)N.updateIfChanged(g.values.drawCount,xi.getDrawCount(j)),N.updateIfChanged(g.values.uVertexCount,xi.getVertexCount(j));else throw new Error("expected geometry to be given");(v.updateTransform||v.createGeometry)&&(p(g.values,j||_),P=m(_,g.values)),v.updateSize&&"uSize"in g.values&&Dd(E,b.size,g.values),v.updateColor&&Ds(E,P,b.color,g.values),f(g.values,y),h(g.state,y)}x=y,C=b,w=S,j&&(_=j)}function F(j){return!!(uu(j)||$e.isLoci(j)&&$e.areRootsEquivalent(j.structure,w)||Oe.is(j)&&$e.areRootsEquivalent(j.structure,w)&&Oe.isWholeStructure(j))}function X(j,te,q){return F(j)?te(Me.ofBounds(0,E.groupCount*E.instanceCount)):o(j,w,te,q)}function U(j){g&&l?.(g.values,_,x,C,j.webgl)}return{get groupCount(){return E?E.count:0},get renderObject(){return E&&E.count?g:void 0},createOrUpdate:function(j,te,q,W){if(q===void 0&&(q={}),D(te,q,W||w),v.createGeometry){var V=n(j,S,b,y,_);if(Vk(V))return V.then(function(ee){k(ee),U(j)});k(V)}else k();U(j)},getLoci:function(j){return g?i(j,w,g.id):zr},mark:function(j,te){return Pr.mark(g,j,te,X)},setVisibility:function(j){Pr.setVisibility(g,j)},setAlphaFactor:function(j){Pr.setAlphaFactor(g,j)},setPickable:function(j){Pr.setPickable(g,j)},setColorOnly:function(j){Pr.setColorOnly(g,j)},setTransform:function(j,te){Pr.setTransform(g,j,te)},setOverpaint:function(j){Pr.setOverpaint(g,j,X,!0)},setTransparency:function(j){Pr.setTransparency(g,j,X,!0)},setClipping:function(j){Pr.setClipping(g,j,X,!0)},destroy:function(){c?.(_),g&&(g.state.disposed=!0,g=void 0)},mustRecreate:u}}var Ab=T(T({},U$),Ko);function Dm(e,t){return W0(T(T({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),oi.areEqual(i.size,o.size)||(r.createGeometry=!0)},geometryUtils:Wt.Utils}),t)}var QNe=T(T({},V$),Ko);function ZNe(e,t){return W0(T(T({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),oi.areEqual(i.size,o.size)||(r.updateSize=!0)},geometryUtils:su.Utils}),t)}var JNe=T(T({},H$),Ko);function eze(e,t){return W0(T(T({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),oi.areEqual(i.size,o.size)||(r.updateSize=!0)},geometryUtils:Mn.Utils}),t)}var tze=T(T({},j$),Ko);function rze(e,t){return W0(T(T({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),oi.areEqual(i.size,o.size)||(r.updateSize=!0),n.background!==a.background&&(r.createGeometry=!0),n.backgroundMargin!==a.backgroundMargin&&(r.createGeometry=!0),n.tether!==a.tether&&(r.createGeometry=!0),n.tetherLength!==a.tetherLength&&(r.createGeometry=!0),n.tetherBaseWidth!==a.tetherBaseWidth&&(r.createGeometry=!0),n.attachment!==a.attachment&&(r.createGeometry=!0),n.fontFamily!==a.fontFamily&&(r.createGeometry=!0),n.fontQuality!==a.fontQuality&&(r.createGeometry=!0),n.fontStyle!==a.fontStyle&&(r.createGeometry=!0),n.fontVariant!==a.fontVariant&&(r.createGeometry=!0),n.fontWeight!==a.fontWeight&&(r.createGeometry=!0)},geometryUtils:mu.Utils}),t)}var nze=T(T({},G$),Ko);function aze(e,t){return W0(T(T({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),oi.areEqual(i.size,o.size)||(r.createGeometry=!0)},geometryUtils:bo.Utils}),t)}var ize=T(T({},q$),Ko);function oze(e,t){return W0(T(T({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),oi.areEqual(i.size,o.size)||(r.createGeometry=!0)},geometryUtils:il.Utils}),t)}function Ba(e,t,r,n){var a=0,i=t.webgl,o=new ha,s=Vd(),u=[],l=si.create(),c=new Map,d,f,p,h,m=Ia.createEmpty();function v(w,_){var E=this;return w===void 0&&(w={}),_&&_!==d&&(p=r(t,_),h||(h=M.getDefaultValues(p))),h=Object.assign({},h,w),Qe.create("Creating or updating UnitsRepresentation",function(P){return pe(E,void 0,void 0,function(){var U,W,q,V,D,U,W,F,q,V,V,k,q,V,U,W,F,q,V,V,X,U,j,te,q,W,V,V,ee,ue,$;return he(this,function(Q){switch(Q.label){case 0:if(!(!d&&!_))return[3,1];throw new Error("missing structure");case 1:if(!(_&&!d))return[3,8];f=_.unitSymmetryGroups,U=0,Q.label=2;case 2:return U<f.length?(W=f[U],q=n(s,_,h,i),V=q.createOrUpdate({webgl:i,runtime:P},m,h,{group:W,structure:_}),V?[4,V]:[3,4]):[3,7];case 3:Q.sent(),Q.label=4;case 4:return b(q,W,l),c.set(W.hashCode,{visual:q,group:W}),P.shouldUpdate?[4,P.update({message:"Creating or updating UnitsVisual",current:U,max:f.length})]:[3,6];case 5:Q.sent(),Q.label=6;case 6:return U++,[3,2];case 7:return[3,43];case 8:if(!(_&&!$e.areUnitIdsAndIndicesEqual(_,d)))return[3,22];f=_.unitSymmetryGroups,D=c,c=new Map,U=0,Q.label=9;case 9:return U<f.length?(W=f[U],F=D.get(W.hashCode),F?(q=F.visual,!((ee=q.mustRecreate)===null||ee===void 0)&&ee.call(q,{group:W,structure:_},h,i)?(q.destroy(),q=n(s,_,h,i),V=q.createOrUpdate({webgl:i,runtime:P},m,h,{group:W,structure:_}),V?[4,V]:[3,11]):[3,12]):[3,15]):[3,21];case 10:Q.sent(),Q.label=11;case 11:return b(q,W,l),[3,14];case 12:return V=q.createOrUpdate({webgl:i,runtime:P},m,h,{group:W,structure:_}),V?[4,V]:[3,14];case 13:Q.sent(),Q.label=14;case 14:return c.set(W.hashCode,{visual:q,group:W}),D.delete(W.hashCode),q.renderObject&&(k=q.renderObject.values.tMarker.ref.value.array,sl(k,Me.ofBounds(0,k.length),sr.RemoveHighlight)),[3,18];case 15:return q=n(s,_,h,i),V=q.createOrUpdate({webgl:i,runtime:P},m,h,{group:W,structure:_}),V?[4,V]:[3,17];case 16:Q.sent(),Q.label=17;case 17:b(q,W,l),c.set(W.hashCode,{visual:q,group:W}),Q.label=18;case 18:return P.shouldUpdate?[4,P.update({message:"Creating or updating UnitsVisual",current:U,max:f.length})]:[3,20];case 19:Q.sent(),Q.label=20;case 20:return U++,[3,9];case 21:return D.forEach(function(R){var Y=R.visual;Y.destroy()}),[3,43];case 22:if(!(_&&_!==d&&$e.areUnitIdsAndIndicesEqual(_,d)))return[3,34];f=_.unitSymmetryGroups,U=0,Q.label=23;case 23:return U<f.length?(W=f[U],F=c.get(W.hashCode),F?(q=F.visual,!((ue=q.mustRecreate)===null||ue===void 0)&&ue.call(q,{group:W,structure:_},h,t.webgl)?(q.destroy(),q=n(s,_,h,t.webgl),F.visual=q,V=q.createOrUpdate({webgl:i,runtime:P},m,h,{group:W,structure:_}),V?[4,V]:[3,25]):[3,26]):[3,29]):[3,33];case 24:Q.sent(),Q.label=25;case 25:return b(q,W,l),[3,28];case 26:return V=q.createOrUpdate({webgl:i,runtime:P},m,h,{group:W,structure:_}),V?[4,V]:[3,28];case 27:Q.sent(),Q.label=28;case 28:return F.group=W,[3,30];case 29:throw new Error("expected to find visual for hashCode "+W.hashCode);case 30:return P.shouldUpdate?[4,P.update({message:"Creating or updating UnitsVisual",current:U,max:f.length})]:[3,32];case 31:Q.sent(),Q.label=32;case 32:return U++,[3,23];case 33:return[3,43];case 34:X=[],c.forEach(function(R){return X.push(R)}),U=0,j=X.length,Q.label=35;case 35:return U<j?(te=X[U],q=te.visual,W=te.group,!(($=q.mustRecreate)===null||$===void 0)&&$.call(q,{group:W,structure:d},h,t.webgl)?(q.destroy(),q=n(s,d,h,i),X[U].visual=q,V=q.createOrUpdate({webgl:i,runtime:P},m,h,{group:W,structure:d}),V?[4,V]:[3,37]):[3,38]):[3,43];case 36:Q.sent(),Q.label=37;case 37:return b(q,W,l),[3,40];case 38:return V=q.createOrUpdate({webgl:i,runtime:P},m,h),V?[4,V]:[3,40];case 39:Q.sent(),Q.label=40;case 40:return P.shouldUpdate?[4,P.update({message:"Creating or updating UnitsVisual",current:U,max:j})]:[3,42];case 41:Q.sent(),Q.label=42;case 42:return++U,[3,35];case 43:return u.length=0,c.forEach(function(R){var Y=R.visual;Y.renderObject&&u.push(Y.renderObject)}),_&&(d=_),o.next(a++),[2]}})})})}function g(w){if(w===void 0)return $e.Loci(d.target);var _=zr;return c.forEach(function(E){var P=E.visual,D=P.getLoci(w);Ku(D)||(_=D)}),_}function y(w,_){if(!d||!Wo.is(l.markerActions,_))return!1;if($e.isLoci(w)||Oe.is(w)||$t.isLoci(w)){if(!$e.areRootsEquivalent(w.structure,d))return!1;w=cr.remap(w,d)}else if(!uu(w)&&!Hy(w))return!1;if(cr.isEmpty(w))return!1;var E=!1;return c.forEach(function(P){var D=P.visual;E=D.mark(w,_)||E}),E}function b(w,_,E){var P=E.visible,D=E.alphaFactor,k=E.pickable,F=E.overpaint,X=E.transparency,U=E.clipping,j=E.transform,te=E.unitTransforms;P!==void 0&&w.setVisibility(P),D!==void 0&&w.setAlphaFactor(D),k!==void 0&&w.setPickable(k),F!==void 0&&w.setOverpaint(F),X!==void 0&&w.setTransparency(X),U!==void 0&&w.setClipping(U),j!==void 0&&w.setTransform(j),te!==void 0&&(te?w.setTransform(void 0,te.getSymmetryGroupTransforms(_)):w.setTransform(void 0,null))}function S(w){var _=w.visible,E=w.alphaFactor,P=w.pickable,D=w.overpaint,k=w.transparency,F=w.clipping,X=w.transform,U=w.unitTransforms,j=w.syncManually,te=w.markerActions,q={};_!==l.visible&&(q.visible=_),E!==l.alphaFactor&&(q.alphaFactor=E),P!==l.pickable&&(q.pickable=P),D!==void 0&&!ri.areEqual(D,l.overpaint)&&d&&(q.overpaint=ri.remap(D,d)),k!==void 0&&!ni.areEqual(k,l.transparency)&&d&&(q.transparency=ni.remap(k,d)),F!==void 0&&!cn.areEqual(F,l.clipping)&&d&&(q.clipping=cn.remap(F,d)),X!==void 0&&!de.areEqual(X,l.transform,jn)&&(q.transform=X),(U!==l.unitTransforms||U?.version!==w.unitTransformsVersion)&&(q.unitTransforms=U,l.unitTransformsVersion=U?U?.version:-1),j!==l.syncManually&&(q.syncManually=j),te!==l.markerActions&&(q.markerActions=te),c.forEach(function(W){var V=W.visual,ee=W.group;return b(V,ee,q)}),si.update(l,q)}function x(w){m=w}function C(){c.forEach(function(w){var _=w.visual;return _.destroy()}),c.clear()}return{label:e,get groupCount(){var w=0;return c.forEach(function(_){var E=_.visual;E.renderObject&&(w+=E.groupCount)}),w},get props(){return h},get params(){return p},get state(){return l},get theme(){return m},renderObjects:u,updated:o,createOrUpdate:v,setState:S,setTheme:x,getLoci:g,mark:y,destroy:C}}function sze(e,t,r,n,a,i){var o=xi.getUtils(t),s=o.createValues,u=o.createRenderableState,l=F$(e),c=s(t,l,r,n,a),d=u(a);return U0(t.kind,c,d,i)}function km(e,t){var r=e.defaultProps,n=e.createGeometry,a=e.createLocationIterator,i=e.getLoci,o=e.eachLocation,s=e.setUpdateState,u=e.mustRecreate,l=e.processValues,c=e.dispose,d=e.geometryUtils,f=d.createEmpty,p=d.updateValues,h=d.updateBoundingSphere,m=d.updateRenderableState,v=d.createPositionIterator,g=lc.create(),y,b=Object.assign({},r),S=Ia.createEmpty(),x,C,w,_,E,P,D;function k(q,W,V){if(!V&&!_)throw new Error("missing structureGroup");if(b=W,S=q,x=V,lc.reset(g),!y||!_){g.createNew=!0,g.createGeometry=!0;return}s(g,b,C,S,w,x,_),$e.areHierarchiesEqual(_.structure,x.structure)||(g.updateTransform=!0,g.updateColor=!0,g.updateSize=!0),xd.areEqual(S.color,w.color)||(g.updateColor=!0),dd(b.unitKinds,C.unitKinds)||(g.createGeometry=!0),x.group.transformHash!==_.group.transformHash&&(x.group.units.length!==_.group.units.length||g.updateColor?g.updateTransform=!0:g.updateMatrix=!0);var ee=x.group.units[0],ue=_.group.units[0];We.areOperatorsEqual(ee,ue)||(g.updateTransform=!0),We.areConformationsEqual(ee,ue)||(g.createGeometry=!0),g.updateTransform&&(g.updateMatrix=!0),g.updateSize&&!("uSize"in y.values)&&(g.createGeometry=!0),(g.createGeometry||g.updateTransform)&&(_.structure.hashCode!==x.structure.hashCode&&(g.updateColor=!0,g.updateSize=!0),(S.color.granularity.startsWith("vertex")||y.values.dColorType.ref.value.startsWith("vertex")||S.color.granularity.startsWith("volume")||y.values.dColorType.ref.value.startsWith("volume"))&&(g.updateColor=!0))}function F(q){if(g.createNew)if(P=a(x),q)y=sze(x.group,q,P,S,b,t),D=v(q,y.values);else throw new Error("expected geometry to be given");else{if(!y)throw new Error("expected renderObject to be available");if(g.updateTransform){P=a(x);var W=P.instanceCount,V=P.groupCount;xu(W*V,y.values)}if(g.updateMatrix&&F$(x.group,y.values),g.createGeometry)if(q)N.updateIfChanged(y.values.drawCount,xi.getDrawCount(q)),N.updateIfChanged(y.values.uVertexCount,xi.getVertexCount(q));else throw new Error("expected geometry to be given");(g.updateTransform||g.createGeometry)&&(h(y.values,q||E),D=v(q||E,y.values)),g.updateSize&&"uSize"in y.values&&Dd(P,S.size,y.values),g.updateColor&&Ds(P,D,S.color,y.values),p(y.values,b),m(y.state,b)}C=b,w=S,_=x,q&&(E=q)}function X(q,W,V,ee,ue,$){return jNe(ue.unitKinds,W)?n(q,W,V,ee,ue,$):f($)}function U(q){return!!(uu(q)||$e.isLoci(q)&&$e.areRootsEquivalent(q.structure,_.structure)||Oe.is(q)&&$e.areRootsEquivalent(q.structure,_.structure)&&Oe.isWholeStructure(q))}function j(q,W,V){return U(q)?W(Me.ofBounds(0,P.groupCount*P.instanceCount)):o(q,_,W,V)}function te(q){y&&l?.(y.values,E,C,w,q.webgl)}return{get groupCount(){return P?P.count:0},get renderObject(){return P&&P.count?y:void 0},createOrUpdate:function(q,W,V,ee){if(k(W,V,ee||_),g.createGeometry){var ue=X(q,x.group.units[0],x.structure,S,b,E);if(Vk(ue))return ue.then(function($){F($),te(q)});F(ue)}else F();te(q)},getLoci:function(q){return y?i(q,_,y.id):zr},mark:function(q,W){return Pr.mark(y,q,W,j)},setVisibility:function(q){Pr.setVisibility(y,q)},setAlphaFactor:function(q){Pr.setAlphaFactor(y,q)},setPickable:function(q){Pr.setPickable(y,q)},setColorOnly:function(q){Pr.setColorOnly(y,q)},setTransform:function(q,W){Pr.setTransform(y,q,W)},setOverpaint:function(q){Pr.setOverpaint(y,q,j,!0)},setTransparency:function(q){Pr.setTransparency(y,q,j,!0)},setClipping:function(q){Pr.setClipping(y,q,j,!0)},destroy:function(){c?.(E),y&&(y.state.disposed=!0,y=void 0)},mustRecreate:u}}var wo=T(T({},U$),Ko);function Rs(e,t){return km(T(T({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),oi.areEqual(i.size,o.size)||(r.createGeometry=!0)},geometryUtils:Wt.Utils}),t)}var uze=T(T({},YNe),Ko);function lze(e,t){return km(T(T({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),oi.areEqual(i.size,o.size)||(r.updateSize=!0)},geometryUtils:om.Utils}),t)}var cze=T(T({},V$),Ko);function dze(e,t){return km(T(T({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),oi.areEqual(i.size,o.size)||(r.updateSize=!0)},geometryUtils:su.Utils}),t)}var fze=T(T({},KNe),Ko);function pze(e,t){return km(T(T({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),oi.areEqual(i.size,o.size)||(r.updateSize=!0)},geometryUtils:im.Utils}),t)}var aR=T(T({},H$),Ko);function iR(e,t){return km(T(T({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),oi.areEqual(i.size,o.size)||(r.updateSize=!0)},geometryUtils:Mn.Utils}),t)}T(T({},j$),Ko);var hze=T(T({},G$),Ko);function mze(e,t){return km(T(T({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),oi.areEqual(i.size,o.size)||(r.createGeometry=!0)},geometryUtils:bo.Utils}),t)}var vze=T(T({},q$),Ko);function gze(e,t){return km(T(T({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),oi.areEqual(i.size,o.size)||(r.createGeometry=!0)},geometryUtils:il.Utils}),t)}var si={create:function(){return T(T({},mr.createState()),{unitTransforms:null,unitTransformsVersion:-1})},update:function(e,t){mr.updateState(e,t),t.unitTransforms!==void 0&&(e.unitTransforms=t.unitTransforms)}};var lx=A(),cx=A(),nh=A(),mT=Ke.add,EN=Ke.add3,xI;(function(e){function t(r,n,a){r===void 0&&(r=2048),n===void 0&&(n=1024);var i=Ke.create(Float32Array,1,n,a?a.groupBuffer.ref.value:r),o=Ke.create(Float32Array,3,n,a?a.startBuffer.ref.value:r),s=Ke.create(Float32Array,3,n,a?a.endBuffer.ref.value:r),u=Ke.create(Float32Array,1,n,a?a.scaleBuffer.ref.value:r),l=Ke.create(Float32Array,1,n,a?a.capBuffer.ref.value:r),c=function(f,p,h,m,v,g,y,b,S,x){for(var C=0;C<6;++C)EN(o,f,p,h),EN(s,m,v,g),mT(i,x),mT(u,y),mT(l,(b?1:0)+(S?2:0))},d=function(f,p,h,m,v,g,y){var b=A.distance(f,p),S=Math.floor(h/2),x=1/h;A.sub(nh,p,f);for(var C=0;C<S;++C){var w=x*(C*2+1);A.setMagnitude(nh,nh,b*w),A.add(lx,f,nh),A.setMagnitude(nh,nh,b*x*((C+1)*2)),A.add(cx,f,nh),c(lx[0],lx[1],lx[2],cx[0],cx[1],cx[2],m,v,g,y)}};return{add:c,addFixedCountDashes:d,addFixedLengthDashes:function(f,p,h,m,v,g,y){var b=A.distance(f,p);d(f,p,b/h,m,v,g,y)},getCylinders:function(){var f=i.elementCount/6,p=Ke.compact(i,!0),h=Ke.compact(o,!0),m=Ke.compact(s,!0),v=Ke.compact(u,!0),g=Ke.compact(l,!0),y=a&&f<=a.cylinderCount?a.mappingBuffer.ref.value:new Float32Array(f*18),b=a&&f<=a.cylinderCount?a.indexBuffer.ref.value:new Uint32Array(f*12);return(!a||f>a.cylinderCount)&&yze(f,y,b),su.create(y,b,p,h,m,v,g,f,a)}}}e.create=t})(xI||(xI={}));function yze(e,t,r){for(var n=0;n<e;++n){var a=n*18;t[a]=-1,t[a+1]=1,t[a+2]=-1,t[a+3]=-1,t[a+4]=-1,t[a+5]=-1,t[a+6]=1,t[a+7]=1,t[a+8]=-1,t[a+9]=1,t[a+10]=1,t[a+11]=1,t[a+12]=1,t[a+13]=-1,t[a+14]=-1,t[a+15]=1,t[a+16]=-1,t[a+17]=1}for(var n=0;n<e;++n){var i=n*6,o=n*12;r[o]=i,r[o+1]=i+1,r[o+2]=i+2,r[o+3]=i+1,r[o+4]=i+4,r[o+5]=i+2,r[o+6]=i+2,r[o+7]=i+4,r[o+8]=i+3,r[o+9]=i+4,r[o+10]=i+5,r[o+11]=i+3}}var Rm={linkScale:M.Numeric(.4,{min:0,max:1,step:.1}),linkSpacing:M.Numeric(1,{min:0,max:2,step:.01}),linkCap:M.Boolean(!1),dashCount:M.Numeric(4,{min:2,max:10,step:2}),dashScale:M.Numeric(.8,{min:0,max:2,step:.1}),dashCap:M.Boolean(!0),stubCap:M.Boolean(!0),radialSegments:M.Numeric(16,{min:2,max:56,step:2},Dt.CustomQualityParamInfo)};M.getDefaultValues(Rm);var W$={linkScale:M.Numeric(.5,{min:0,max:1,step:.1}),linkSpacing:M.Numeric(.1,{min:0,max:2,step:.01}),dashCount:M.Numeric(4,{min:2,max:10,step:2})};M.getDefaultValues(W$);var qa=A(),cf=A(),Vs=A(),bze=A.create(0,1,0);function oR(e,t,r,n){A.normalize(cf,A.sub(cf,t,r)),n!==null?A.sub(Vs,t,n):A.copy(Vs,t),A.normalize(Vs,Vs);var a=A.dot(cf,Vs);return 1-Math.abs(a)<1e-5&&(A.set(Vs,1,0,0),a=A.dot(cf,Vs),1-Math.abs(a)<1e-5&&(A.set(Vs,0,1,0),a=A.dot(cf,Vs))),A.setMagnitude(cf,cf,a),A.sub(Vs,Vs,cf),A.normalize(e,Vs)}var $c=A.scale,$h=A.add,ql=A.sub,sR=A.setMagnitude,xze=A.dot;function Om(e,t,r,n){var a=t.linkCount,i=t.referencePosition,o=t.position,s=t.style,u=t.radius,l=t.ignore,c=t.stub;if(!a)return Wt.createEmpty(n);for(var d=r.linkScale,f=r.linkSpacing,p=r.radialSegments,h=r.linkCap,m=r.dashCount,v=r.dashScale,g=r.dashCap,y=r.stubCap,b=p*2*a*2,S=kt.createState(b,b/4,n),x=A(),C=A(),w=A(),_={radiusTop:1,radiusBottom:1,radialSegments:p,topCap:h,bottomCap:h},E=m+1,P=0,D=a;P<D;++P)if(!(l&&l(P))){o(x,C,P),ql(qa,C,x);var k=u(P),F=s?s(P):0,X=y&&(c?c(P):!1),U=xze(qa,bze)>0?[X,h]:[h,X],j=U[0],te=U[1];if(S.currentGroup=P,F===0)_.radiusTop=_.radiusBottom=k,_.topCap=j,_.bottomCap=te,gs(S,x,C,.5,_);else if(F===1)_.radiusTop=_.radiusBottom=k*v,_.topCap=_.bottomCap=g,f5(S,x,C,.5,E,_);else if(F===2||F===3){var q=F===2?2:3,W=k*(d/(.5*q)),V=(k-W)*f;oR(w,x,C,i?i(P):null),sR(w,w,V),_.radiusTop=_.radiusBottom=W,_.topCap=j,_.bottomCap=te,q===3&&gs(S,x,C,.5,_),_Ae(S,x,C,.5,w,_)}else F===4&&($c(qa,qa,.475),$h(x,x,qa),ql(C,C,qa),_.radiusTop=_.radiusBottom=k,_.topCap=j,_.bottomCap=te,gs(S,x,C,.5,_))}return kt.getMesh(S)}function X$(e,t,r,n){var a=t.linkCount,i=t.referencePosition,o=t.position,s=t.style,u=t.radius,l=t.ignore,c=t.stub;if(!a)return su.createEmpty(n);for(var d=r.linkScale,f=r.linkSpacing,p=r.linkCap,h=r.dashCount,m=r.dashScale,v=r.dashCap,g=r.stubCap,y=a*2,b=xI.create(y,y/4,n),S=A(),x=A(),C=A(),w=h%2===1?h:h+1,_=.5-.5/2/w,E=0,P=a;E<P;++E)if(!(l&&l(E))){o(S,x,E);var D=u(E),k=s?s(E):0,F=g&&(c?c(E):!1);if(k===0)$c(x,$h(x,S,x),.5),b.add(S[0],S[1],S[2],x[0],x[1],x[2],1,p,F,E);else if(k===1)$c(qa,ql(qa,x,S),_),ql(x,x,qa),b.addFixedCountDashes(S,x,w,m,v,v,E);else if(k===2||k===3){$c(x,$h(x,S,x),.5);var X=k===2?2:3,U=d/(.5*X),j=(D-U*D)*f;oR(C,S,x,i?i(E):null),sR(C,C,j),X===3&&b.add(S[0],S[1],S[2],x[0],x[1],x[2],U,p,!1,E),b.add(S[0]+C[0],S[1]+C[1],S[2]+C[2],x[0]+C[0],x[1]+C[1],x[2]+C[2],U,p,F,E),b.add(S[0]-C[0],S[1]-C[1],S[2]-C[2],x[0]-C[0],x[1]-C[1],x[2]-C[2],U,p,F,E)}else k===4&&($c(qa,ql(qa,x,S),.475),$h(S,S,qa),ql(x,x,qa),b.add(S[0],S[1],S[2],x[0],x[1],x[2],1,p,F,E))}return b.getCylinders()}function Y$(e,t,r,n){var a=t.linkCount,i=t.referencePosition,o=t.position,s=t.style,u=t.ignore;if(!a)return Mn.createEmpty(n);for(var l=r.linkScale,c=r.linkSpacing,d=r.dashCount,f=a*2,p=_s.create(f,f/4,n),h=A(),m=A(),v=A(),g=d%2===1?d:d+1,y=.5-.5/2/g,b=0,S=a;b<S;++b)if(!(u&&u(b))){o(h,m,b);var x=s?s(b):0;if(x===0)$c(m,$h(m,h,m),.5),p.add(h[0],h[1],h[2],m[0],m[1],m[2],b);else if(x===1)$c(qa,ql(qa,m,h),y),ql(m,m,qa),p.addFixedCountDashes(h,m,g,b);else if(x===2||x===3){$c(m,$h(m,h,m),.5);var C=x===2?2:3,w=1*(l/(.5*C)),_=(1-w)*c;oR(v,h,m,i?i(b):null),sR(v,v,_),C===3&&p.add(h[0],h[1],h[2],m[0],m[1],m[2],b),p.add(h[0]+v[0],h[1]+v[1],h[2]+v[2],m[0]+v[0],m[1]+v[1],m[2]+v[2],b),p.add(h[0]-v[0],h[1]-v[1],h[2]-v[2],m[0]-v[0],m[1]-v[1],m[2]-v[2],b)}else x===4&&($c(qa,ql(qa,m,h),.475),$h(h,h,qa),ql(m,m,qa),p.add(h[0],h[1],h[2],m[0],m[1],m[2],b))}return p.getLines()}function Sze(e,t,r,n,a,i){return pe(this,void 0,void 0,function(){var o,s,u,l,c,d,f,p,h,m,v,g,y,b,S,x,C,w,_;return he(this,function(E){return We.isAtomic(t)?(o=r.child,s=o?.unitMap.get(t.id),o&&!s?[2,Wt.createEmpty(i)]:(u=ot.create(r,t),l=oa.get(r).value,c=l.unitsFeatures.get(t.id),d=l.unitsContacts.get(t.id),f=c.x,p=c.y,h=c.z,m=c.members,v=c.offsets,g=d.edgeCount,y=d.a,b=d.b,S=d.edgeProps.flag,x=a.sizeFactor,g?(C={linkCount:g*2,position:function(P,D,k){A.set(P,f[y[k]],p[y[k]],h[y[k]]),A.set(D,f[b[k]],p[b[k]],h[b[k]])},style:function(P){return 1},radius:function(P){u.element=t.elements[m[v[y[P]]]];var D=n.size.size(u);u.element=t.elements[m[v[b[P]]]];var k=n.size.size(u);return Math.min(D,k)*x},ignore:function(P){return S[P]===1||!!s&&!nt.has(s.elements,t.elements[m[v[y[P]]]])}},w=Om(e,C,a,i),_=He.expand(He(),(s??t).boundary.sphere,1*x),w.setBoundingSphere(_),[2,w]):[2,Wt.createEmpty(i)])):[2,Wt.createEmpty(i)]})})}var K$=T(T(T({},wo),Rm),{sizeFactor:M.Numeric(.3,{min:0,max:10,step:.01}),dashCount:M.Numeric(6,{min:2,max:10,step:2}),dashScale:M.Numeric(.4,{min:0,max:2,step:.1}),includeParent:M.Boolean(!1)});function Cze(e){return Rs({defaultProps:M.getDefaultValues(K$),createGeometry:Sze,createLocationIterator:Aze,getLoci:wze,eachLocation:_ze,setUpdateState:function(t,r,n,a,i,o,s){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.radialSegments!==n.radialSegments;var u=oa.get(o.structure).version;t.info.interactionsHash!==u&&(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.info.interactionsHash=u)}},e)}function wze(e,t,r){var n=e.objectId,a=e.instanceId,i=e.groupId;if(r===n){var o=t.structure,s=t.group,u=o.unitMap.get(s.units[a].id),l=oa.get(o).value,c=l.unitsContacts.get(u.id),d=c.a,f=c.b;return wd.Loci(o,l,[{unitA:u,indexA:d[i],unitB:u,indexB:f[i]},{unitA:u,indexA:f[i],unitB:u,indexB:d[i]}])}return zr}function _ze(e,t,r,n){var a=!1;if(wd.isLoci(e)){var i=t.structure,o=t.group;if(!$e.areEquivalent(e.data.structure,i))return!1;var s=oa.get(i).value;if(e.data.interactions!==s)return!1;for(var u=o.units[0],l=s.unitsContacts.get(u.id),c=l.edgeCount*2,d=0,f=e.elements;d<f.length;d++){var p=f[d];if(p.unitA===p.unitB){var h=o.unitIndexMap.get(p.unitA.id);if(h!==void 0){var m=l.getDirectedEdgeIndex(p.indexA,p.indexB);m!==-1&&r(Me.ofSingleton(h*c+m))&&(a=!0)}}}}else if(Oe.is(e)){var i=t.structure,o=t.group;if(!$e.areEquivalent(e.structure,i))return!1;var s=oa.get(i).value;if(!s)return!1;for(var u=o.units[0],l=s.unitsContacts.get(u.id),v=s.unitsFeatures.get(u.id),g=l.edgeCount*2,y=l.offset,b=v.elementsIndex,S=b.offsets,x=b.indices,C=function(X){var U=o.unitIndexMap.get(X.unit.id);if(U!==void 0||n&&Ne.size(X.indices)===1)return"continue";Ne.forEach(X.indices,function(j){for(var te=S[j],q=S[j+1];te<q;++te)for(var W=x[te],V=y[W],ee=y[W+1];V<ee;++V)r(Me.ofSingleton(U*g+V))&&(a=!0)})},w=0,_=e.elements;w<_.length;w++){var p=_[w];C(p)}}return a}function Aze(e){var t=e.structure,r=e.group,n=r.units[0],a=oa.get(t).value,i=a.unitsContacts.get(n.id),o=i.edgeCount*2,s=r.units.length,u=wd.Location(a,t),l=u.element,c=function(d,f){var p=r.units[f];return l.unitA=p,l.indexA=i.a[d],l.unitB=p,l.indexB=i.b[d],u};return Tn(o,s,1,c)}function Tze(e,t,r,n,a){if(!t.hasAtomic)return Wt.createEmpty(a);var i=ot.create(t),o=oa.get(t).value,s=o.contacts,u=o.unitsFeatures,l=s.edgeCount,c=s.edges,d=n.sizeFactor;if(!l)return Wt.createEmpty(a);var f=t.child,p={linkCount:l,position:function(v,g,y){var b=c[y],S=b.unitA,x=b.indexA,C=b.unitB,w=b.indexB,_=u.get(S),E=u.get(C),P=t.unitMap.get(S),D=t.unitMap.get(C);A.set(v,_.x[x],_.y[x],_.z[x]),A.transformMat4(v,v,P.conformation.operator.matrix),A.set(g,E.x[w],E.y[w],E.z[w]),A.transformMat4(g,g,D.conformation.operator.matrix)},style:function(v){return 1},radius:function(v){var g=c[v],y=u.get(g.unitA);i.unit=t.unitMap.get(g.unitA),i.element=i.unit.elements[y.members[y.offsets[g.indexA]]];var b=r.size.size(i),S=u.get(g.unitB);i.unit=t.unitMap.get(g.unitB),i.element=i.unit.elements[S.members[S.offsets[g.indexB]]];var x=r.size.size(i);return Math.min(b,x)*d},ignore:function(v){if(c[v].props.flag===1)return!0;if(f){var g=c[v],y=f.unitMap.get(g.unitA);if(!y)return!0;var b=t.unitMap.get(g.unitA),S=u.get(g.unitA),x=b.elements[S.members[S.offsets[g.indexA]]];if(!nt.has(y.elements,x))return!0}return!1}},h=Om(e,p,n,a),m=He.expand(He(),(f??t).boundary.sphere,1*d);return h.setBoundingSphere(m),h}var $$=T(T(T({},Ab),Rm),{sizeFactor:M.Numeric(.3,{min:0,max:10,step:.01}),dashCount:M.Numeric(6,{min:2,max:10,step:2}),dashScale:M.Numeric(.4,{min:0,max:2,step:.1}),includeParent:M.Boolean(!1)});function Eze(e){return Dm({defaultProps:M.getDefaultValues($$),createGeometry:Tze,createLocationIterator:Mze,getLoci:Pze,eachLocation:Ize,setUpdateState:function(t,r,n,a,i,o,s){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.radialSegments!==n.radialSegments;var u=oa.get(o).version;t.info.interactionsHash!==u&&(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.info.interactionsHash=u)}},e)}function Pze(e,t,r){var n=e.objectId,a=e.groupId;if(r===n){var i=oa.get(t).value,o=i.contacts.edges[a],s=t.unitMap.get(o.unitA),u=t.unitMap.get(o.unitB);return wd.Loci(t,i,[{unitA:s,indexA:o.indexA,unitB:u,indexB:o.indexB},{unitA:u,indexA:o.indexB,unitB:s,indexB:o.indexA}])}return zr}function Ize(e,t,r,n){var a,i=!1;if(wd.isLoci(e)){if(!$e.areEquivalent(e.data.structure,t))return!1;var o=oa.get(t).value;if(e.data.interactions!==o)return!1;for(var s=o.contacts,u=0,l=e.elements;u<l.length;u++){var c=l[u],d=s.getEdgeIndex(c.indexA,c.unitA.id,c.indexB,c.unitB.id);d!==-1&&r(Me.ofSingleton(d))&&(i=!0)}}else if(Oe.is(e)){if(!$e.areEquivalent(e.structure,t)||n&&e.elements.length===1)return!1;var f=(a=oa.get(t).value)===null||a===void 0?void 0:a.contacts;if(!f)return!1;for(var p=function(g){var y=g.unit;if(!We.isAtomic(y)||n&&Ne.size(g.indices)===1)return"continue";Ne.forEach(g.indices,function(b){for(var S=0,x=f.getContactIndicesForElement(b,y);S<x.length;S++){var C=x[S];r(Me.ofSingleton(C))&&(i=!0)}})},h=0,m=e.elements;h<m.length;h++){var v=m[h];p(v)}}return i}function Mze(e){var t=oa.get(e).value,r=t.contacts,n=r.edgeCount,a=1,i=wd.Location(t,e),o=i.element,s=function(u){var l=r.edges[u];return o.unitA=e.unitMap.get(l.unitA),o.indexA=l.indexA,o.unitB=e.unitMap.get(l.unitB),o.indexB=l.indexB,i};return Tn(n,a,1,s,!0)}var Q$={"intra-unit":function(e,t){return Ba("Intra-unit interactions cylinder",e,t,Cze)},"inter-unit":function(e,t){return Qu("Inter-unit interactions cylinder",e,t,Eze)}},Z$=T(T(T({},K$),$$),{unitKinds:_b(["atomic"]),sizeFactor:M.Numeric(.2,{min:.01,max:1,step:.01}),visuals:M.MultiSelect(["intra-unit","inter-unit"],M.objectToOptions(Q$))});function Dze(e,t){return M.clone(Z$)}function kze(e,t){return mr.createMulti("Interactions",e,t,si,Q$)}var h3={name:"interactions",label:"Non-covalent Interactions",description:"Displays non-covalent interactions as dashed cylinders.",factory:kze,getParams:Dze,defaultValues:M.getDefaultValues(Z$),defaultColorTheme:{name:"interaction-type"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.elementCount>0&&oa.isApplicable(e)},ensureCustomProperties:{attach:function(e,t){return oa.attach(e,t,void 0,!0)},detach:function(e){return oa.ref(e,!1)}},getData:function(e,t){return t.includeParent?e.asParent():e},mustRecreate:function(e,t){return e.includeParent!==t.includeParent}},Rze=Ur.create({name:"computed-interactions-prop",category:"custom-props",display:{name:"Interactions"},ctor:function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.provider=oa,r.labelProvider={label:function(n){if(!!r.params.showTooltip)switch(n.kind){case"element-loci":if(n.elements.length===0)return;for(var a=[],i=r.getStructures(n.structure),o=0,s=i;o<s.length;o++){var u=s[o],l=r.provider.get(u).value;if(!!l){var c=Oe.remap(n,u);if(c.elements.length===1){var d=c.elements[0];if(Ne.size(d.indices)===1){var f=l.unitsFeatures.get(d.unit.id);if(!!f){for(var p=[],h=[],m=[],v=Ne.start(d.indices),g=f.types,y=f.groups,b=f.elementsIndex,S=b.indices,x=b.offsets,C=x[v],w=x[v+1];C<w;++C){var _=S[C],E=g[_],P=y[_];E&&p.push(G7e(E)),P&&h.push(q7e(P))}p.length&&m.push("<small>Types</small> "+p.join(", ")),h.length&&m.push("<small>Groups</small> "+h.join(", ")),m.length&&a.push("Interaction Feature: "+m.join(" | "))}}}}}return a.length?a.join("<br/>"):void 0;default:return}}},r}return t.prototype.getStructures=function(r){var n=[],a=this.ctx.helpers.substructureParent.get(r);if(a)for(var i=this.ctx.state.data,o=i.select(lr.Generators.ofType(be.Molecule.Structure,a.transform.ref)),s=0,u=o;s<u.length;s++){var l=u[s];l.obj&&ho(n,l.obj.data)}return n},t.prototype.update=function(r){var n=this.params.autoAttach!==r.autoAttach||this.params.showTooltip!==r.showTooltip;return this.params.autoAttach=r.autoAttach,this.params.showTooltip=r.showTooltip,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),n},t.prototype.register=function(){this.ctx.customStructureProperties.register(this.provider,this.params.autoAttach),this.ctx.representation.structure.themes.colorThemeRegistry.add(bI),this.ctx.managers.lociLabels.addProvider(this.labelProvider),this.ctx.representation.structure.registry.add(h3)},t.prototype.unregister=function(){this.ctx.customStructureProperties.unregister(this.provider.descriptor.name),this.ctx.representation.structure.themes.colorThemeRegistry.remove(bI),this.ctx.managers.lociLabels.removeProvider(this.labelProvider),this.ctx.representation.structure.registry.remove(h3)},t}(Ur.Handler),params:function(){return{autoAttach:M.Boolean(!1),showTooltip:M.Boolean(!0)}}}),Oze=Ur.create({name:"computed-secondary-structure-prop",category:"custom-props",display:{name:"Secondary Structure"},ctor:function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.provider=sc,r}return t.prototype.update=function(r){var n=this.params.autoAttach!==r.autoAttach;return this.params.autoAttach=r.autoAttach,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),n},t.prototype.register=function(){this.ctx.customStructureProperties.register(this.provider,this.params.autoAttach)},t.prototype.unregister=function(){this.ctx.customStructureProperties.unregister(this.provider.descriptor.name)},t}(Ur.Handler),params:function(){return{autoAttach:M.Boolean(!1)}}}),Bze=Ur.create({name:"computed-valence-model-prop",category:"custom-props",display:{name:"Valence Model"},ctor:function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.provider=wb,r.labelProvider={label:function(n){if(!!r.params.showTooltip)switch(n.kind){case"element-loci":if(n.elements.length===0)return;for(var a=[],i=r.getStructures(n.structure),o=0,s=i;o<s.length;o++){var u=s[o],l=r.provider.get(u).value;if(!!l){var c=Oe.remap(n,u);if(c.elements.length===1){var d=c.elements[0];if(Ne.size(d.indices)===1){var f=l.get(d.unit.id);if(!!f){var p=Ne.start(d.indices),h=f.charge[p],m=f.idealGeometry[p],v=f.implicitH[p],g=f.totalH[p];a.push("Valence Model: <small>Charge</small> "+h+" | <small>Ideal Geometry</small> "+L7e(m)+" | <small>Implicit H</small> "+v+" | <small>Total H</small> "+g)}}}}}return a.length?a.join("<br/>"):void 0;default:return}}},r}return t.prototype.getStructures=function(r){var n=[],a=this.ctx.helpers.substructureParent.get(r);if(a)for(var i=this.ctx.state.data,o=i.select(lr.Generators.ofType(be.Molecule.Structure,a.transform.ref)),s=0,u=o;s<u.length;s++){var l=u[s];l.obj&&ho(n,l.obj.data)}return n},t.prototype.update=function(r){var n=this.params.autoAttach!==r.autoAttach||this.params.showTooltip!==r.showTooltip;return this.params.autoAttach=r.autoAttach,this.params.showTooltip=r.showTooltip,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),n},t.prototype.register=function(){this.ctx.customStructureProperties.register(this.provider,this.params.autoAttach),this.ctx.managers.lociLabels.addProvider(this.labelProvider)},t.prototype.unregister=function(){this.ctx.customStructureProperties.unregister(this.provider.descriptor.name),this.ctx.managers.lociLabels.removeProvider(this.labelProvider)},t}(Ur.Handler),params:function(){return{autoAttach:M.Boolean(!1),showTooltip:M.Boolean(!0)}}}),Zu;(function(e){var t=this;e.Provider=H1.createProvider({label:"Best Database Sequence Mapping",descriptor:vu({name:"molstar_best_database_sequence_mapping"}),type:"static",defaultParams:{},getParams:function(){return{}},isApplicable:function(i){var o,s;return xn.is(i.sourceData)&&((s=(o=i.sourceData.data.frame.categories)===null||o===void 0?void 0:o.atom_site)===null||s===void 0?void 0:s.fieldNames.indexOf("db_name"))>=0},obtain:function(i,o){return pe(t,void 0,void 0,function(){return he(this,function(s){return[2,{value:a(o)}]})})}});function r(i){var o=i.unit.model,s=e.Provider.get(o).value;if(!s)return"";var u=i.unit.elements[i.element],l=o.atomicHierarchy.residueAtomSegments.offsets[u];return s.accession[l]}e.getKey=r;function n(i){var o=i.unit.model,s=e.Provider.get(o).value;if(!!s){var u=i.unit.elements[i.element],l=o.atomicHierarchy.residueAtomSegments.offsets[u],c=s.dbName[l];if(!!c)return c+" "+s.accession[l]+" "+s.num[l]+" "+s.residue[l]}}e.getLabel=n;function a(i){if(!!xn.is(i.sourceData)){var o=i.sourceData.data.frame.categories.atom_site,s=o.getField("db_name"),u=o.getField("db_acc"),l=o.getField("db_num"),c=o.getField("db_res");if(!(!s||!u||!l||!c)){for(var d=i.atomicHierarchy.atomSourceIndex,f=i.atomicHierarchy.residueAtomSegments,p=f.count,h=f.offsets,m=new Array(p),v=new Array(p),g=new Array(p),y=new Array(p),b=0;b<p;b++){var S=d.value(h[b]);if(s.valueKind(S)!==0){m[S]="",v[S]="",g[S]=0,y[S]="";continue}m[S]=s.str(S),v[S]=u.str(S),g[S]=l.int(S),y[S]=c.str(S)}return{dbName:m,accession:v,num:g,residue:y}}}}})(Zu||(Zu={}));var vT=vt(16448250),Fze="Assigns a color based on best dababase sequence mapping.",kg=new Map,J$=T({},ks({type:"colors",colorList:"set-1"}));function Lze(e){return J$}function eQ(e,t){var r;if(e.structure){for(var n=0,a=e.structure.models;n<a.length;n++){var i=a[n],o=Zu.Provider.get(i).value;if(!!o)for(var s=0,u=o.accession;s<u.length;s++){var l=u[s];!l||kg.has(l)||kg.set(l,kg.size)}}var c=ot.create(e.structure),d=Su(kg.size+1,t,{valueLabel:function(h){return""+h}}),f=new Map,p=function(h){var m=Zu.getKey(h);if(!m)return vT;if(f.has(m))return f.get(m);var v=d.color(kg.get(m));return f.set(m,v),v};r=function(h){return ot.is(h)&&We.isAtomic(h.unit)?p(h):$t.isLocation(h)?(c.unit=h.aUnit,c.element=h.aUnit.elements[h.aIndex],p(c)):vT}}else r=function(){return vT};return{factory:eQ,granularity:"group",preferSmoothing:!0,color:r,props:t,description:Fze}}var PN={name:"best-sequence-database-mapping",label:"Best Database Sequence Mapping",category:"Residue Property",factory:eQ,getParams:Lze,defaultValues:M.getDefaultValues(J$),isApplicable:function(e){var t;return!!(!((t=e.structure)===null||t===void 0)&&t.models.some(function(r){return Zu.Provider.isApplicable(r)}))},ensureCustomProperties:{attach:function(e,t){return pe(void 0,void 0,void 0,function(){var r,n,a;return he(this,function(i){switch(i.label){case 0:if(!t.structure)return[2];r=0,n=t.structure.models,i.label=1;case 1:return r<n.length?(a=n[r],[4,Zu.Provider.attach(e,a,void 0,!0)]):[3,4];case 2:i.sent(),i.label=3;case 3:return r++,[3,1];case 4:return[2]}})})},detach:function(e){if(!!e.structure)for(var t=0,r=e.structure.models;t<r.length;t++){var n=r[t];Zu.Provider.ref(n,!1)}}}},Nze=Ur.create({name:"best-sequence-database-mapping-prop",category:"custom-props",display:{name:"Best Database Sequence Mapping"},ctor:function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.provider=Zu.Provider,r.labelProvider={label:function(n){if(!!r.params.showTooltip)return zze(n)}},r}return t.prototype.update=function(r){var n=this.params.autoAttach!==r.autoAttach||this.params.showTooltip!==r.showTooltip;return this.params.autoAttach=r.autoAttach,this.params.showTooltip=r.showTooltip,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),n},t.prototype.register=function(){this.ctx.customModelProperties.register(this.provider,this.params.autoAttach),this.ctx.representation.structure.themes.colorThemeRegistry.add(PN),this.ctx.managers.lociLabels.addProvider(this.labelProvider)},t.prototype.unregister=function(){this.ctx.customModelProperties.unregister(this.provider.descriptor.name),this.ctx.representation.structure.themes.colorThemeRegistry.remove(PN),this.ctx.managers.lociLabels.removeProvider(this.labelProvider)},t}(Ur.Handler),params:function(){return{autoAttach:M.Boolean(!0),showTooltip:M.Boolean(!0)}}});function zze(e){if(e.kind==="element-loci"){if(e.elements.length===0)return;var t=e.elements[0],r=t.unit,n=ot.create(e.structure,r,r.elements[Ne.getAt(t.indices,0)]);return Zu.getLabel(n)}}var _d;(function(e){e.Descriptor={name:"ihm_cross_link_restraint"},e.Provider=ol.create(e.Descriptor);function t(r,n){var a={entity_id:r.entity_id_1,asym_id:r.asym_id_1,seq_id:r.seq_id_1,atom_id:r.atom_id_1},i={entity_id:r.entity_id_2,asym_id:r.asym_id_2,seq_id:r.seq_id_2,atom_id:r.atom_id_2};function o(h,m,v){var g=h.get(m);g?g.push(v):h.set(m,[v])}function s(h,m){var v=m.entity_id.value(h),g=m.asym_id.value(h),y=m.seq_id.value(h);if(r.model_granularity.value(h)==="by-atom"){var b=n.atomicHierarchy.index.findAtom({auth_seq_id:y,label_asym_id:g,label_atom_id:m.atom_id.value(h),label_entity_id:v});b>=0&&o(l,b,h)}else if(n.coarseHierarchy.isDefined){var S=n.coarseHierarchy.spheres.findSequenceKey(v,g,y);if(S>=0)o(c,S,h);else{var x=n.coarseHierarchy.gaussians.findSequenceKey(v,g,y);x>=0&&o(d,x,h)}}}function u(h){switch(h){case 0:return l;case 1:return c;case 2:return d}}for(var l=new Map,c=new Map,d=new Map,f=[],p=0;p<r._rowCount;++p)s(p,a),s(p,i);return{getIndicesByElement:function(h,m){var v=u(m),g=v.get(h);return g!==void 0?g:f},data:r}}e.fromTable=t})(_d||(_d={}));var Uze=[];function IN(e,t,r,n){return e+"|"+t.id+"|"+r+"|"+n.id}var MN=function(){function e(t){this.pairs=t;var r=new Map;this.pairs.forEach(function(n,a){var i=IN(n.indexA,n.unitA,n.indexB,n.unitB),o=r.get(i);o?o.push(a):r.set(i,[a])}),this.count=t.length,this.pairKeyIndices=r}return e.prototype.getPairIndices=function(t,r,n,a){var i=IN(t,r,n,a);return this.pairKeyIndices.get(i)||Uze},e.prototype.getPairs=function(t,r,n,a){var i=this,o=this.getPairIndices(t,r,n,a);return o.map(function(s){return i.pairs[s]})},e}(),Ad=Cp.createProvider({label:"Cross Link Restraint",descriptor:vu({name:"integrative-cross-link-restraint"}),type:"local",defaultParams:{},getParams:function(e){return{}},isApplicable:function(e){return e.models.some(function(t){return!!_d.Provider.get(t)})},obtain:function(e,t,r){return pe(void 0,void 0,void 0,function(){return he(this,function(n){return[2,{value:jze(t)}]})})}}),Ju;(function(e){(function(h){h.CrossLinkRestraint="cross-link-restraint"})(e.Tag||(e.Tag={}));function t(h){return h.models.some(function(m){return!!_d.Provider.get(m)})}e.isApplicable=t;var r=A(),n=A();function a(h){return h.unitA.conformation.position(h.unitA.elements[h.indexA],r),h.unitB.conformation.position(h.unitB.elements[h.indexB],n),A.distance(r,n)}e.distance=a;function i(h,m,v){return DW("cross-link-restraints",{structure:m,crossLinkRestraints:h},v)}e.Location=i;function o(h){return!!h&&h.kind==="data-location"&&h.tag==="cross-link-restraints"}e.isLocation=o;function s(h,m){return h.data.structure===m.data.structure&&h.data.crossLinkRestraints===m.data.crossLinkRestraints&&h.element===m.element}e.areLocationsEqual=s;function u(h,m){var v=h.pairs[m];return"Cross Link Restraint | Type: "+v.restraintType+" | Threshold: "+v.distanceThreshold+" \u212B | Psi: "+v.psi+" | Sigma 1: "+v.sigma1+" | Sigma 2: "+v.sigma2+" | Distance: "+a(v).toFixed(2)+" \u212B"}function l(h){return u(h.data.crossLinkRestraints,h.element)}e.locationLabel=l;function c(h,m,v){return p_("cross-link-restraints",{structure:h,crossLinkRestraints:m},v,function(g){return f(m,v,g)},function(){return p(h,m,v)})}e.Loci=c;function d(h){return!!h&&h.kind==="data-loci"&&h.tag==="interactions"}e.isLoci=d;function f(h,m,v){return gd.fromPairProvider(m.length,function(g,y,b){var S=h.pairs[m[g]];S.unitA.conformation.position(S.unitA.elements[S.indexA],y),S.unitB.conformation.position(S.unitB.elements[S.indexB],b)},v)}e.getBoundingSphere=f;function p(h,m,v){var g=v[0];if(g===void 0)return"";var y=m.pairs[g];return[u(m,g),Hk($t.Location(h,y.unitA,y.indexA,h,y.unitB,y.indexB))].join("</br>")}e.getLabel=p})(Ju||(Ju={}));function DN(e,t,r){for(var n=t.elements,a=n.length,i=t.kind,o=function(u){var l=n[u];r.getIndicesByElement(l,i).forEach(function(c){return e.set(c,u)})},s=0;s<a;s++)o(s)}function Vze(e,t,r){if(t.model===r.model&&t.model.sourceData.kind==="mmCIF"){var n=_d.Provider.get(t.model);if(!!n){var a=new Map,i=new Map;DN(a,t,n),DN(i,r,n),a.forEach(function(o,s){var u=i.get(s);u!==void 0&&e.push(m3(t,o,r,u,n,s),m3(r,u,t,o,n,s))})}}}function Hze(e,t){if(t.model.sourceData.kind==="mmCIF"){var r=_d.Provider.get(t.model);if(!!r){for(var n=t.elements,a=n.length,i=t.kind,o=new Map,s=function(l){var c=n[l];r.getIndicesByElement(c,i).forEach(function(d){var f=o.get(d);f?f.push(l):o.set(d,[l])})},u=0;u<a;u++)s(u);o.forEach(function(l,c){if(!(l.length<2)){var d=l[0],f=l[1];e.push(m3(t,d,t,f,r,c),m3(t,f,t,d,r,c))}})}}}function m3(e,t,r,n,a,i){return{unitA:e,indexA:t,unitB:r,indexB:n,restraintType:a.data.restraint_type.value(i),distanceThreshold:a.data.distance_threshold.value(i),psi:a.data.psi.value(i),sigma1:a.data.sigma_1.value(i),sigma2:a.data.sigma_2.value(i)}}function jze(e){var t=[];if(!e.models.some(function(s){return _d.Provider.get(s)}))return new MN(t);for(var r=e.units.length,n=0;n<r;++n){var a=e.units[n];Hze(t,a);for(var i=n+1;i<r;++i){var o=e.units[i];a.model===o.model&&Vze(t,a,o)}}return new MN(t)}function Gze(e,t,r,n,a){var i=Ad.get(t).value;if(!i.count)return Wt.createEmpty(a);var o=n.sizeFactor,s=ot.create(t),u={linkCount:i.count,position:function(l,c,d){var f=i.pairs[d],p=f.unitA,h=f.unitB;p.conformation.position(p.elements[f.indexA],l),h.conformation.position(h.elements[f.indexB],c)},radius:function(l){var c=i.pairs[l];return s.unit=c.unitA,s.element=c.unitA.elements[c.indexA],r.size.size(s)*o}};return Om(e,u,n,a)}var tQ=T(T(T({},Ab),Rm),{sizeFactor:M.Numeric(.5,{min:0,max:10,step:.1})});function qze(e){return Dm({defaultProps:M.getDefaultValues(tQ),createGeometry:Gze,createLocationIterator:Wze,getLoci:Xze,eachLocation:Yze,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.radialSegments!==n.radialSegments||r.linkCap!==n.linkCap}},e)}function Wze(e){var t=Ad.get(e).value,r=t.pairs,n=r.length,a=1,i=Ju.Location(t,e),o=function(s){return i.element=s,i};return Tn(n,a,1,o,!0)}function Xze(e,t,r){var n=e.objectId,a=e.groupId;if(r===n){var i=Ad.get(t).value,o=i.pairs[a];if(o)return Ju.Loci(t,i,[a])}return zr}function Yze(e,t,r){var n=!1;if(Ju.isLoci(e)){if(!$e.areEquivalent(e.data.structure,t))return!1;var a=Ad.get(t).value;if(e.data.crossLinkRestraints!==a)return!1;for(var i=0,o=e.elements;i<o.length;i++){var s=o[i];r(Me.ofSingleton(s))&&(n=!0)}}return n}var Kze={"cross-link-restraint":function(e,t){return Qu("Cross-link restraint",e,t,qze)}},rQ=T({},tQ);function $ze(e,t){return M.clone(rQ)}function Qze(e,t){return mr.createMulti("CrossLinkRestraint",e,t,si,Kze)}var kN={name:Ju.Tag.CrossLinkRestraint,label:"Cross Link Restraint",description:"Displays cross-link restraints.",factory:Qze,getParams:$ze,defaultValues:M.getDefaultValues(rQ),defaultColorTheme:{name:Ju.Tag.CrossLinkRestraint},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return Ju.isApplicable(e)},ensureCustomProperties:{attach:function(e,t){return Ad.attach(e,t,void 0,!0)},detach:function(e){return Ad.ref(e,!1)}}},RN=vt(13421772),Zze="Colors cross-links by the deviation of the observed distance versus the modeled distance (e.g. modeled / `ihm_cross_link_restraint.distance_threshold`).",nQ={domain:M.Interval([.5,1.5],{step:.01}),list:M.ColorList("red-grey",{presetKind:"scale"})};function Jze(e){return nQ}function aQ(e,t){var r,n=void 0,a=e.structure&&Ad.get(e.structure).value;if(a){n=nl.create({domain:t.domain,listOrName:t.list.colors});var i=n.color;r=function(o){if(Ju.isLocation(o)){var s=a.pairs[o.element];if(s)return i(Ju.distance(s)/s.distanceThreshold)}return RN}}else r=function(){return RN};return{factory:aQ,granularity:"group",color:r,props:t,description:Zze,legend:n?n.legend:void 0}}var ON={name:"cross-link",label:"Cross Link",category:"Miscellaneous",factory:aQ,getParams:Jze,defaultValues:M.getDefaultValues(nQ),isApplicable:function(e){return!!e.structure&&Ju.isApplicable(e.structure)},ensureCustomProperties:{attach:function(e,t){return t.structure?Ad.attach(e,t.structure,void 0,!0):Promise.resolve()},detach:function(e){return e.structure&&Ad.ref(e.structure,!1)}}},eUe=Ur.create({name:"integrative-cross-link-restraint",category:"custom-props",display:{name:"Cross Link Restraint"},ctor:function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.provider=_d.Provider,r}return t.prototype.register=function(){this.provider.formatRegistry.add("mmCIF",tUe),this.ctx.representation.structure.themes.colorThemeRegistry.add(ON),this.ctx.representation.structure.registry.add(kN)},t.prototype.unregister=function(){this.provider.formatRegistry.remove("mmCIF"),this.ctx.representation.structure.themes.colorThemeRegistry.remove(ON),this.ctx.representation.structure.registry.remove(kN)},t}(Ur.Handler)});function tUe(e){if(!!xn.is(e.sourceData)){var t=e.sourceData.data.db.ihm_cross_link_restraint;if(t._rowCount!==0)return _d.fromTable(t,e)}}var rUe=Object.freeze({__proto__:null,StructureInfo:b7e,AccessibleSurfaceArea:P7e,Interactions:Rze,SecondaryStructure:Oze,ValenceModel:Bze,BestDatabaseSequenceMapping:Nze,CrossLinkRestraint:eUe}),dx={State:uFe,Representation:cFe,Camera:fFe,Misc:a7e},is={Representation:p7e,Camera:y7e,CustomProps:rUe};function gS(e,t,r){r===void 0&&(r={});var n=r;return typeof n.type=="string"||typeof n.color=="string"||typeof n.size=="string"?aUe(e,t||$e.Empty,r):iQ(e,t||$e.Empty,r)}function nUe(e,t){var r=e.representation.structure.themes;return t?r.colorThemeRegistry.getApplicableTypes({structure:t}):r.colorThemeRegistry.types}function SI(e,t,r,n,a){var i=e.representation.structure,o=i.registry,s=i.themes,u=o.get(r||o.default.name),l=s.colorThemeRegistry.get(n||u.defaultColorTheme.name),c=M.getDefaultValues(l.getParams({structure:t||$e.Empty}));return l.name===u.defaultColorTheme.name&&Object.assign(c,u.defaultColorTheme.props),{name:l.name,params:Object.assign(c,a)}}function BN(e,t,r,n,a){var i=e.representation.structure,o=i.registry,s=i.themes,u=o.get(r||o.default.name),l=s.sizeThemeRegistry.get(n||u.defaultSizeTheme.name),c=M.getDefaultValues(l.getParams({structure:t||$e.Empty}));return l.name===u.defaultSizeTheme.name&&Object.assign(c,u.defaultSizeTheme.props),{name:l.name,params:Object.assign(c,a)}}function aUe(e,t,r){var n=r.type&&e.representation.structure.registry.get(r.type)||e.representation.structure.registry.default.provider,a=r.color&&e.representation.structure.themes.colorThemeRegistry.get(r.color)||e.representation.structure.themes.colorThemeRegistry.get(n.defaultColorTheme.name),i=r.size&&e.representation.structure.themes.sizeThemeRegistry.get(r.size)||e.representation.structure.themes.sizeThemeRegistry.get(n.defaultSizeTheme.name);return iQ(e,t,{type:n,typeParams:r.typeParams,color:a,colorParams:r.colorParams,size:i,sizeParams:r.sizeParams})}function iQ(e,t,r){r===void 0&&(r={});var n=e.representation.structure.themes,a={structure:t},i=r.type||e.representation.structure.registry.default.provider,o=M.getDefaultValues(i.getParams(n,t)),s=Object.assign(o,r.typeParams),u=r.color||n.colorThemeRegistry.get(i.defaultColorTheme.name),l=M.getDefaultValues(u.getParams(a));u.name===i.defaultColorTheme.name&&Object.assign(l,i.defaultColorTheme.props);var c=Object.assign(l,r.colorParams),d=r.size||n.sizeThemeRegistry.get(i.defaultSizeTheme.name),f=M.getDefaultValues(d.getParams(a));d.name===i.defaultSizeTheme.name&&Object.assign(f,i.defaultSizeTheme.props);var p=Object.assign(f,r.sizeParams);return{type:{name:i.name,params:s},colorTheme:{name:u.name,params:c},sizeTheme:{name:d.name,params:p}}}var iUe=function(e){var t=lt.Representation.StructureRepresentation3D.definition.params(void 0,e);return{expandRadius:M.Numeric(5,{min:1,max:10,step:1}),targetParams:M.Group(t,{label:"Target",customDefault:gS(e,void 0,{type:"ball-and-stick",size:"physical",typeParams:{sizeFactor:.26,alpha:.51}})}),surroundingsParams:M.Group(t,{label:"Surroundings",customDefault:gS(e,void 0,{type:"ball-and-stick",size:"physical",typeParams:{sizeFactor:.16}})}),nciParams:M.Group(t,{label:"Non-covalent Int.",customDefault:gS(e,void 0,{type:h3,color:bI,size:oi.BuiltIn.uniform})}),components:M.MultiSelect(FN,M.arrayToOptions(FN)),excludeTargetFromSurroundings:M.Boolean(!1,{label:"Exclude Target",description:'Exclude the focus "target" from the surroudings component.'}),ignoreHydrogens:M.Boolean(!1)}},FN=["target","surroundings","interactions"],hn;(function(e){e.TargetSel="structure-focus-target-sel",e.TargetRepr="structure-focus-target-repr",e.SurrSel="structure-focus-surr-sel",e.SurrRepr="structure-focus-surr-repr",e.SurrNciRepr="structure-focus-surr-nci-repr"})(hn||(hn={}));var oUe=new Set([hn.TargetSel,hn.TargetRepr,hn.SurrSel,hn.SurrRepr,hn.SurrNciRepr]),sUe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.currentSource=void 0,r}return Object.defineProperty(t.prototype,"surrLabel",{get:function(){return"[Focus] Surroundings ("+this.params.expandRadius+" \xC5)"},enumerable:!1,configurable:!0}),t.prototype.getReprParams=function(r){return T(T({},this.params.targetParams),{type:{name:r.type.name,params:T(T({},r.type.params),{ignoreHydrogens:this.params.ignoreHydrogens})}})},t.prototype.ensureShape=function(r){var n,a=this.plugin.state.data,i=a.tree,o=a.build(),s=lr.findUniqueTagsInSubtree(i,r.transform.ref,oUe);s[hn.TargetSel]||(s[hn.TargetSel]=o.to(r).apply(lt.Model.StructureSelectionFromBundle,{bundle:sn.Empty,label:"[Focus] Target"},{tags:hn.TargetSel}).ref),s[hn.SurrSel]||(s[hn.SurrSel]=o.to(r).apply(lt.Model.StructureSelectionFromExpression,{expression:ce.struct.generator.empty(),label:this.surrLabel},{tags:hn.SurrSel}).ref);var u=this.params.components;return u.indexOf("target")>=0&&!s[hn.TargetRepr]&&(s[hn.TargetRepr]=o.to(s[hn.TargetSel]).apply(lt.Representation.StructureRepresentation3D,this.getReprParams(this.params.targetParams),{tags:hn.TargetRepr}).ref),u.indexOf("surroundings")>=0&&!s[hn.SurrRepr]&&(s[hn.SurrRepr]=o.to(s[hn.SurrSel]).apply(lt.Representation.StructureRepresentation3D,this.getReprParams(this.params.surroundingsParams),{tags:hn.SurrRepr}).ref),u.indexOf("interactions")>=0&&!s[hn.SurrNciRepr]&&r.obj&&h3.isApplicable((n=r.obj)===null||n===void 0?void 0:n.data)&&(s[hn.SurrNciRepr]=o.to(s[hn.SurrSel]).apply(lt.Representation.StructureRepresentation3D,this.params.nciParams,{tags:hn.SurrNciRepr}).ref),{state:a,builder:o,refs:s}},t.prototype.clear=function(r){var n=this.plugin.state.data;this.currentSource=void 0;var a=n.select(lr.Generators.byRef(r).subtree().withTag(hn.TargetSel)),i=n.select(lr.Generators.byRef(r).subtree().withTag(hn.SurrSel));if(!(a.length===0&&i.length===0)){for(var o=n.build(),s=sn.Empty,u=0,l=a;u<l.length;u++){var c=l[u];o.to(c).update(lt.Model.StructureSelectionFromBundle,function(m){return T(T({},m),{bundle:s})})}for(var d=ce.struct.generator.empty(),f=0,p=i;f<p.length;f++){var h=p[f];o.to(h).update(lt.Model.StructureSelectionFromExpression,function(m){return T(T({},m),{expression:d})})}return Rt.State.Update(this.plugin,{state:n,tree:o,options:{doNotLogTiming:!0,doNotUpdateCurrent:!0}})}},t.prototype.focus=function(r){return pe(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d,f,p=this;return he(this,function(h){switch(h.label){case 0:return n=this.plugin.helpers.substructureParent.get(r.structure),!n||!n.obj?[2]:(this.currentSource=r,a=Oe.remap(r,n.obj.data),i=Oe.extendToWholeResidues(a),o=sn.fromLoci(i),s=sn.toExpression(o),u=ce.struct.modifier.includeSurroundings({0:s,radius:this.params.expandRadius,"as-whole-residues":!0}),this.params.excludeTargetFromSurroundings&&(u=ce.struct.modifier.exceptBy({0:u,by:s})),l=this.ensureShape(n),c=l.state,d=l.builder,f=l.refs,d.to(f[hn.TargetSel]).update(lt.Model.StructureSelectionFromBundle,function(m){return T(T({},m),{bundle:o})}),d.to(f[hn.SurrSel]).update(lt.Model.StructureSelectionFromExpression,function(m){return T(T({},m),{expression:u,label:p.surrLabel})}),[4,Rt.State.Update(this.plugin,{state:c,tree:d,options:{doNotLogTiming:!0,doNotUpdateCurrent:!0}})]);case 1:return h.sent(),[2]}})})},t.prototype.register=function(r){var n=this;this.subscribeObservable(this.plugin.managers.structure.focus.behaviors.current,function(a){a?n.focus(a.loci):n.clear(vr.RootRef)})},t.prototype.update=function(r){return pe(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,m,d,f,m,p,h,m;return he(this,function(v){switch(v.label){case 0:if(n=this.params,this.params=r,n.excludeTargetFromSurroundings!==r.excludeTargetFromSurroundings)return this.currentSource&&this.focus(this.currentSource),[2,!0];for(a=this.plugin.state.data,i=a.build(),o=lr.Generators.root.subtree(),s=this.params.components,u=s.indexOf("target")>=0,l=0,c=a.select(o.withTag(hn.TargetRepr));l<c.length;l++)m=c[l],u?i.to(m).update(this.getReprParams(this.params.targetParams)):i.delete(m.transform.ref);for(u=s.indexOf("surroundings")>=0,d=0,f=a.select(o.withTag(hn.SurrRepr));d<f.length;d++)m=f[d],u?i.to(m).update(this.getReprParams(this.params.surroundingsParams)):i.delete(m.transform.ref);for(u=s.indexOf("interactions")>=0,p=0,h=a.select(o.withTag(hn.SurrNciRepr));p<h.length;p++)m=h[p],u?i.to(m).update(this.params.nciParams):i.delete(m.transform.ref);return[4,Rt.State.Update(this.plugin,{state:a,tree:i,options:{doNotLogTiming:!0,doNotUpdateCurrent:!0}})];case 1:return v.sent(),r.expandRadius!==n.expandRadius?(this.currentSource&&this.focus(this.currentSource),[2,!0]):[2,!0]}})})},t}(Ur.WithSubscribers),uR=Ur.create({name:"create-structure-focus-representation",display:{name:"Structure Focus Representation"},category:"interaction",ctor:sUe,params:function(e,t){return iUe(t)}});function xo(e){return e}(function(e){e.CommonParams={ignoreHydrogens:M.Optional(M.Boolean(!1)),quality:M.Optional(M.Select("auto",mk)),theme:M.Optional(M.Group({globalName:M.Optional(M.Text("")),carbonColor:M.Optional(M.Select("chain-id",M.arrayToOptions(["chain-id","operator-name","element-symbol"]))),symmetryColor:M.Optional(M.Text("")),focus:M.Optional(M.Group({name:M.Optional(M.Text("")),params:M.Optional(M.Value({}))}))}))};function t(i){return i==="chain-id"?{name:i,params:RY.defaultValues}:i==="operator-name"?{name:i,params:Uk.defaultValues}:{name:i,params:{}}}function r(i){return i.units.some(function(o){return!o.conformation.operator.assembly&&o.conformation.operator.spgrOp>=0})}function n(i,o,s){var u,l,c,d,f,p,h=i.state.data.build(),m=i.builders.structure.representation,v={quality:i.managers.structure.component.state.options.visualQuality,ignoreHydrogens:!i.managers.structure.component.state.options.showHydrogens};o.quality&&o.quality!=="auto"&&(v.quality=o.quality),o.ignoreHydrogens!==void 0&&(v.ignoreHydrogens=!!o.ignoreHydrogens);var g=!((u=o.theme)===null||u===void 0)&&u.globalName?(l=o.theme)===null||l===void 0?void 0:l.globalName:void 0,y=((c=o.theme)===null||c===void 0?void 0:c.carbonColor)!==void 0?{carbonColor:t((d=o.theme)===null||d===void 0?void 0:d.carbonColor)}:{},b=s&&((f=o.theme)===null||f===void 0?void 0:f.symmetryColor)&&r(s)?(p=o.theme)===null||p===void 0?void 0:p.symmetryColor:g;return{update:h,builder:m,color:g,symmetryColor:b,typeParams:v,ballAndStickColor:y}}e.reprBuilder=n;function a(i,o,s,u){return i.state.updateBehavior(uR,function(l){var c=SI(i,o,"ball-and-stick",s||"element-symbol",u);l.surroundingsParams.colorTheme=c,l.targetParams.colorTheme=c})}e.updateFocusRepr=a})(xo||(xo={}));var X0=xo.CommonParams,Tb=xo.reprBuilder,P_=xo.updateFocusRepr,uUe=xo({id:"preset-structure-representation-auto",display:{name:"Automatic",description:"Show representations based on the size of the structure. Smaller structures are shown with more detail than larger ones, ranging from atomistic display to coarse surfaces."},params:function(){return X0},apply:function(e,t,r){var n,a,i=(a=(n=Ka.resolveAndCheck(r.state.data,e))===null||n===void 0?void 0:n.obj)===null||a===void 0?void 0:a.data;if(!i)return{};var o=r.config.get(Qn.Structure.SizeThresholds)||$e.DefaultSizeThresholds,s=$e.getSize(i,o),u=i.polymerResidueCount/i.polymerGapCount;switch(s){case $e.Size.Gigantic:case $e.Size.Huge:return sQ.apply(e,t,r);case $e.Size.Large:return uQ.apply(e,t,r);case $e.Size.Medium:if(u>3)return oQ.apply(e,t,r);case $e.Size.Small:return lQ.apply(e,T(T({},t),{showCarbohydrateSymbol:!0}),r);default:J5()}}}),lUe=xo({id:"preset-structure-representation-empty",display:{name:"Empty",description:"Removes all existing representations."},apply:function(e,t,r){return pe(this,void 0,void 0,function(){return he(this,function(n){return[2,{}]})})}}),Eb="Basic",oQ=xo({id:"preset-structure-representation-polymer-and-ligand",display:{name:"Polymer & Ligand",group:Eb,description:"Shows polymers as Cartoon, ligands as Ball & Stick, carbohydrates as 3D-SNFG and water molecules semi-transparent."},params:function(){return X0},apply:function(e,t,r){var n,a,i,o,s,u,l,c,d,f;return pe(this,void 0,void 0,function(){var p,h,m,v,g,y,b,S,x,C,w,_,E,P,D;return he(this,function(k){switch(k.label){case 0:return p=Ka.resolveAndCheck(r.state.data,e),p?(D={},[4,ls(r,p,"polymer")]):[2,{}];case 1:return D.polymer=k.sent(),[4,ls(r,p,"ligand")];case 2:return D.ligand=k.sent(),[4,ls(r,p,"non-standard")];case 3:return D.nonStandard=k.sent(),[4,ls(r,p,"branched",{label:"Carbohydrate"})];case 4:return D.branched=k.sent(),[4,ls(r,p,"water")];case 5:return D.water=k.sent(),[4,ls(r,p,"ion")];case 6:return D.ion=k.sent(),[4,ls(r,p,"lipid")];case 7:return D.lipid=k.sent(),[4,ls(r,p,"coarse")];case 8:return h=(D.coarse=k.sent(),D),m=p.obj.data,v={sizeFactor:m.isCoarseGrained?.8:.2},g=(((i=(a=(n=h.water)===null||n===void 0?void 0:n.obj)===null||a===void 0?void 0:a.data)===null||i===void 0?void 0:i.elementCount)||0)>5e4?"line":"ball-and-stick",y=(((u=(s=(o=h.lipid)===null||o===void 0?void 0:o.obj)===null||s===void 0?void 0:s.data)===null||u===void 0?void 0:u.elementCount)||0)>2e4?"line":"ball-and-stick",b=Tb(r,t,m),S=b.update,x=b.builder,C=b.typeParams,w=b.color,_=b.symmetryColor,E=b.ballAndStickColor,P={polymer:x.buildRepresentation(S,h.polymer,{type:"cartoon",typeParams:T(T({},C),v),color:_},{tag:"polymer"}),ligand:x.buildRepresentation(S,h.ligand,{type:"ball-and-stick",typeParams:C,color:w,colorParams:E},{tag:"ligand"}),nonStandard:x.buildRepresentation(S,h.nonStandard,{type:"ball-and-stick",typeParams:C,color:w,colorParams:E},{tag:"non-standard"}),branchedBallAndStick:x.buildRepresentation(S,h.branched,{type:"ball-and-stick",typeParams:T(T({},C),{alpha:.3}),color:w,colorParams:E},{tag:"branched-ball-and-stick"}),branchedSnfg3d:x.buildRepresentation(S,h.branched,{type:"carbohydrate",typeParams:C,color:w},{tag:"branched-snfg-3d"}),water:x.buildRepresentation(S,h.water,{type:g,typeParams:T(T({},C),{alpha:.6}),color:w,colorParams:{carbonColor:{name:"element-symbol",params:{}}}},{tag:"water"}),ion:x.buildRepresentation(S,h.ion,{type:"ball-and-stick",typeParams:C,color:w,colorParams:{carbonColor:{name:"element-symbol",params:{}}}},{tag:"ion"}),lipid:x.buildRepresentation(S,h.lipid,{type:y,typeParams:T(T({},C),{alpha:.6}),color:w,colorParams:{carbonColor:{name:"element-symbol",params:{}}}},{tag:"lipid"}),coarse:x.buildRepresentation(S,h.coarse,{type:"spacefill",typeParams:C,color:w||"chain-id"},{tag:"coarse"})},[4,S.commit({revertOnError:!1})];case 9:return k.sent(),[4,P_(r,m,(c=(l=t.theme)===null||l===void 0?void 0:l.focus)===null||c===void 0?void 0:c.name,(f=(d=t.theme)===null||d===void 0?void 0:d.focus)===null||f===void 0?void 0:f.params)];case 10:return k.sent(),[2,{components:h,representations:P}]}})})}}),cUe=xo({id:"preset-structure-representation-protein-and-nucleic",display:{name:"Protein & Nucleic",group:Eb,description:"Shows proteins as Cartoon and RNA/DNA as Gaussian Surface."},params:function(){return X0},apply:function(e,t,r){var n,a,i,o;return pe(this,void 0,void 0,function(){var s,u,l,c,d,f,p,h,m,v,g,y;return he(this,function(b){switch(b.label){case 0:return s=Ka.resolveAndCheck(r.state.data,e),s?(y={},[4,LN(r,s,"protein")]):[2,{}];case 1:return y.protein=b.sent(),[4,LN(r,s,"nucleic")];case 2:return u=(y.nucleic=b.sent(),y),l=s.obj.data,c={sizeFactor:l.isCoarseGrained?.8:.2},d={radiusOffset:l.isCoarseGrained?2:0,smoothness:l.isCoarseGrained?1:1.5},f=Tb(r,t,l),p=f.update,h=f.builder,m=f.typeParams,v=f.symmetryColor,g={protein:h.buildRepresentation(p,u.protein,{type:"cartoon",typeParams:T(T({},m),c),color:v},{tag:"protein"}),nucleic:h.buildRepresentation(p,u.nucleic,{type:"gaussian-surface",typeParams:T(T({},m),d),color:v},{tag:"nucleic"})},[4,p.commit({revertOnError:!0})];case 3:return b.sent(),[4,P_(r,l,(a=(n=t.theme)===null||n===void 0?void 0:n.focus)===null||a===void 0?void 0:a.name,(o=(i=t.theme)===null||i===void 0?void 0:i.focus)===null||o===void 0?void 0:o.params)];case 4:return b.sent(),[2,{components:u,representations:g}]}})})}}),sQ=xo({id:"preset-structure-representation-coarse-surface",display:{name:"Coarse Surface",group:Eb,description:"Shows polymers and lipids as coarse Gaussian Surface."},params:function(){return X0},apply:function(e,t,r){var n,a,i,o;return pe(this,void 0,void 0,function(){var s,u,l,c,d,f,p,h,m,v,g,y;return he(this,function(b){switch(b.label){case 0:return s=Ka.resolveAndCheck(r.state.data,e),s?(y={},[4,ls(r,s,"polymer")]):[2,{}];case 1:return y.polymer=b.sent(),[4,ls(r,s,"lipid")];case 2:return u=(y.lipid=b.sent(),y),l=s.obj.data,c=$e.getSize(l),d=Object.create(null),c===$e.Size.Gigantic?Object.assign(d,{traceOnly:!l.isCoarseGrained,radiusOffset:2,smoothness:1,visuals:["structure-gaussian-surface-mesh"]}):c===$e.Size.Huge?Object.assign(d,{radiusOffset:l.isCoarseGrained?2:0,smoothness:1}):l.isCoarseGrained&&Object.assign(d,{radiusOffset:2,smoothness:1}),f=Tb(r,t,l),p=f.update,h=f.builder,m=f.typeParams,v=f.symmetryColor,g={polymer:h.buildRepresentation(p,u.polymer,{type:"gaussian-surface",typeParams:T(T({},m),d),color:v},{tag:"polymer"}),lipid:h.buildRepresentation(p,u.lipid,{type:"gaussian-surface",typeParams:T(T({},m),d),color:v},{tag:"lipid"})},[4,p.commit({revertOnError:!0})];case 3:return b.sent(),[4,P_(r,l,(a=(n=t.theme)===null||n===void 0?void 0:n.focus)===null||a===void 0?void 0:a.name,(o=(i=t.theme)===null||i===void 0?void 0:i.focus)===null||o===void 0?void 0:o.params)];case 4:return b.sent(),[2,{components:u,representations:g}]}})})}}),uQ=xo({id:"preset-structure-representation-polymer-cartoon",display:{name:"Polymer Cartoon",group:Eb,description:"Shows polymers as Cartoon."},params:function(){return X0},apply:function(e,t,r){var n,a,i,o;return pe(this,void 0,void 0,function(){var s,u,l,c,d,f,p,h,m,v,g;return he(this,function(y){switch(y.label){case 0:return s=Ka.resolveAndCheck(r.state.data,e),s?(g={},[4,ls(r,s,"polymer")]):[2,{}];case 1:return u=(g.polymer=y.sent(),g),l=s.obj.data,c={sizeFactor:l.isCoarseGrained?.8:.2},d=Tb(r,t,l),f=d.update,p=d.builder,h=d.typeParams,m=d.symmetryColor,v={polymer:p.buildRepresentation(f,u.polymer,{type:"cartoon",typeParams:T(T({},h),c),color:m},{tag:"polymer"})},[4,f.commit({revertOnError:!0})];case 2:return y.sent(),[4,P_(r,l,(a=(n=t.theme)===null||n===void 0?void 0:n.focus)===null||a===void 0?void 0:a.name,(o=(i=t.theme)===null||i===void 0?void 0:i.focus)===null||o===void 0?void 0:o.params)];case 3:return y.sent(),[2,{components:u,representations:v}]}})})}}),lQ=xo({id:"preset-structure-representation-atomic-detail",display:{name:"Atomic Detail",group:Eb,description:"Shows everything in atomic detail with Ball & Stick."},params:function(){return T(T({},X0),{showCarbohydrateSymbol:M.Boolean(!1)})},apply:function(e,t,r){return pe(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d,f,p,h,m,v,g,y,b,S,x,C,w,_;return he(this,function(E){switch(E.label){case 0:return n=Ka.resolveAndCheck(r.state.data,e),n?(w={},[4,ls(r,n,"all")]):[2,{}];case 1:return a=(w.all=E.sent(),w.branched=void 0,w),i=n.obj.data,o=i.elementCount>1e5,s=i.atomicResidueCount&&i.elementCount>1e3&&i.atomicResidueCount/i.elementCount<3,u=i.models[0],l=!!Bi.Provider.get(u)||oc.isExhaustive(u),c="ball-and-stick",i.isCoarseGrained?c=i.elementCount>1e6?"point":"spacefill":s&&!l?c="spacefill":o&&(c="line"),d=t.showCarbohydrateSymbol&&!o&&!s,d?(p=(f=Object).assign,h=[a],_={},[4,ls(r,n,"branched",{label:"Carbohydrate"})]):[3,3];case 2:p.apply(f,h.concat([(_.branched=E.sent(),_)])),E.label=3;case 3:return m=Tb(r,t,i),v=m.update,g=m.builder,y=m.typeParams,b=m.color,S=m.ballAndStickColor,x=s&&!l?{carbonColor:{name:"element-symbol",params:{}}}:S,C={all:g.buildRepresentation(v,a.all,{type:c,typeParams:y,color:b,colorParams:x},{tag:"all"})},d&&Object.assign(C,{snfg3d:g.buildRepresentation(v,a.branched,{type:"carbohydrate",typeParams:T(T({},y),{alpha:.4,visuals:["carbohydrate-symbol"]}),color:b},{tag:"snfg-3d"})}),[4,v.commit({revertOnError:!0})];case 4:return E.sent(),[2,{components:a,representations:C}]}})})}});function ls(e,t,r,n){return e.builders.structure.tryCreateComponentStatic(t,r,n)}function LN(e,t,r,n){return e.builders.structure.tryCreateComponentFromSelection(t,Ea[r],"selection-"+r,n)}var $v={empty:lUe,auto:uUe,"atomic-detail":lQ,"polymer-cartoon":uQ,"polymer-and-ligand":oQ,"protein-and-nucleic":cUe,"coarse-surface":sQ};function lR(e,t){if(e.ext==="bcif")try{if(oW(t).encoder.startsWith("VolumeServer"))return"dscif"}catch{}else if(e.ext==="cif"){var r=t;if(r.startsWith(`data_SERVER
#
_density_server_result`))return"dscif";if(r.includes("atom_site_fract_x")||r.includes("atom_site.fract_x"))return"coreCif"}return-1}var qd="Trajectory";function Wd(e,t){return e.builders.structure.hierarchy.applyPreset(t.trajectory,"default")}var dUe={label:"mmCIF",description:"mmCIF",category:qd,stringExtensions:["cif","mmcif","mcif"],binaryExtensions:["bcif"],isApplicable:function(e,t){return e.ext==="mmcif"||e.ext==="mcif"?!0:e.ext==="cif"||e.ext==="bcif"?lR(e,t)===-1:!1},parse:function(e,t,r){return pe(void 0,void 0,void 0,function(){var n,a,i,o,s;return he(this,function(u){switch(u.label){case 0:return n=e.state.data,a=n.build().to(t).apply(lt.Data.ParseCif,void 0,{state:{isGhost:!0}}),[4,a.apply(lt.Model.TrajectoryFromMmCif,void 0,{tags:r?.trajectoryTags}).commit({revertOnError:!0})];case 1:return i=u.sent(),(((s=(o=a.selector.cell)===null||o===void 0?void 0:o.obj)===null||s===void 0?void 0:s.data.blocks.length)||0)>1&&e.state.data.updateCellState(a.ref,{isGhost:!1}),[2,{trajectory:i}]}})})},visuals:Wd},fUe={label:"cifCore",description:"CIF Core",category:qd,stringExtensions:["cif"],isApplicable:function(e,t){return e.ext==="cif"?lR(e,t)==="coreCif":!1},parse:function(e,t,r){return pe(void 0,void 0,void 0,function(){var n,a,i,o,s;return he(this,function(u){switch(u.label){case 0:return n=e.state.data,a=n.build().to(t).apply(lt.Data.ParseCif,void 0,{state:{isGhost:!0}}),[4,a.apply(lt.Model.TrajectoryFromCifCore,void 0,{tags:r?.trajectoryTags}).commit({revertOnError:!0})];case 1:return i=u.sent(),(((s=(o=a.selector.cell)===null||o===void 0?void 0:o.obj)===null||s===void 0?void 0:s.data.blocks.length)||0)>1&&e.state.data.updateCellState(a.ref,{isGhost:!1}),[2,{trajectory:i}]}})})},visuals:Wd};function Bm(e,t){var r=this;return function(n,a,i){return pe(r,void 0,void 0,function(){var o,s;return he(this,function(u){switch(u.label){case 0:return o=n.state.data,[4,o.build().to(a).apply(e,t,{tags:i?.trajectoryTags}).commit({revertOnError:!0})];case 1:return s=u.sent(),[2,{trajectory:s}]}})})}}var pUe={label:"PDB",description:"PDB",category:qd,stringExtensions:["pdb","ent"],parse:Bm(lt.Model.TrajectoryFromPDB),visuals:Wd},hUe={label:"PDBQT",description:"PDBQT",category:qd,stringExtensions:["pdbqt"],parse:Bm(lt.Model.TrajectoryFromPDB,{isPdbqt:!0}),visuals:Wd},mUe={label:"XYZ",description:"XYZ",category:qd,stringExtensions:["xyz"],parse:Bm(lt.Model.TrajectoryFromXYZ),visuals:Wd},vUe={label:"GRO",description:"GRO",category:qd,stringExtensions:["gro"],binaryExtensions:[],parse:Bm(lt.Model.TrajectoryFromGRO),visuals:Wd},gUe={label:"MOL",description:"MOL",category:qd,stringExtensions:["mol"],parse:Bm(lt.Model.TrajectoryFromMOL),visuals:Wd},yUe={label:"SDF",description:"SDF",category:qd,stringExtensions:["sdf","sd"],parse:Bm(lt.Model.TrajectoryFromSDF),visuals:Wd},bUe={label:"MOL2",description:"MOL2",category:qd,stringExtensions:["mol2"],parse:Bm(lt.Model.TrajectoryFromMOL2),visuals:Wd},cQ=[["mmcif",dUe],["cifCore",fUe],["pdb",pUe],["pdbqt",hUe],["gro",vUe],["xyz",mUe],["mol",gUe],["sdf",yUe],["mol2",bUe]],xUe=function(e){return M.Group({type:Yh.getParams(void 0,"auto").type,representation:M.Select($v.auto.id,e.builders.structure.representation.getPresets().map(function(t){return[t.id,t.display.name,t.display.group]}),{description:"Which representation preset to use."}),representationParams:M.Group(xo.CommonParams,{isHidden:!0}),asTrajectory:M.Optional(M.Boolean(!1,{description:"Load all entries into a single trajectory."}))},{isExpanded:!1})},dQ={rcsb:M.Group({encoding:M.Select("bcif",[["cif","cif"],["bcif","bcif"]])},{label:"RCSB PDB",isFlat:!0}),pdbe:M.Group({variant:M.Select("updated-bcif",[["updated-bcif","Updated (bcif)"],["updated","Updated"],["archival","Archival"]])},{label:"PDBe",isFlat:!0})},SUe=jo.build({from:be.Root,display:{name:"Download Structure",description:"Load a structure from the provided source and create its representation."},params:function(e,t){var r=xUe(t),n=t.config.get(Qn.Download.DefaultPdbProvider)||"pdbe";return{source:M.MappedStatic("pdb",{pdb:M.Group({provider:M.Group({id:M.Text("1tqn",{label:"PDB Id(s)",description:"One or more comma/space separated PDB ids."}),server:M.MappedStatic(n,dQ)},{pivot:"id"}),options:r},{isFlat:!0,label:"PDB"}),"pdb-dev":M.Group({provider:M.Group({id:M.Text("PDBDEV_00000001",{label:"PDBDev Id(s)",description:"One or more comma/space separated ids."}),encoding:M.Select("bcif",[["cif","cif"],["bcif","bcif"]])},{pivot:"id"}),options:r},{isFlat:!0,label:"PDBDEV"}),swissmodel:M.Group({id:M.Text("Q9Y2I8",{label:"UniProtKB AC(s)",description:"One or more comma/space separated ACs."}),options:r},{isFlat:!0,label:"SWISS-MODEL",description:"Loads the best homology model or experimental structure"}),pubchem:M.Group({id:M.Text("2244,2245",{label:"PubChem ID",description:"One or more comma/space separated IDs."}),options:r},{isFlat:!0,label:"PubChem",description:"Loads 3D conformer from PubChem."}),url:M.Group({url:M.Url(""),format:M.Select("mmcif",M.arrayToOptions(cQ.map(function(a){return a[0]}),function(a){return a})),isBinary:M.Boolean(!1),options:r},{isFlat:!0,label:"URL"})})}}})(function(e,t){var r=e.params,n=e.state;return Qe.create("Download Structure",function(a){return pe(void 0,void 0,void 0,function(){var i,o,s,u,l,c,d;return he(this,function(f){switch(f.label){case 0:switch(t.behaviors.layout.leftPanelTabName.next("data"),i=r.source,s=!1,u="mmcif",i.name){case"url":o=[{url:i.params.url,isBinary:i.params.isBinary}],u=i.params.format;break;case"pdb":o=i.params.provider.server.name==="pdbe"?i.params.provider.server.params.variant==="updated"?df(i.params.provider.id,function(p){return"https://www.ebi.ac.uk/pdbe/static/entry/"+p.toLowerCase()+"_updated.cif"},function(p){return"PDBe: "+p+" (updated cif)"},!1):i.params.provider.server.params.variant==="updated-bcif"?df(i.params.provider.id,function(p){return"https://www.ebi.ac.uk/pdbe/entry-files/download/"+p.toLowerCase()+".bcif"},function(p){return"PDBe: "+p+" (updated cif)"},!0):df(i.params.provider.id,function(p){return"https://www.ebi.ac.uk/pdbe/static/entry/"+p.toLowerCase()+".cif"},function(p){return"PDBe: "+p+" (cif)"},!1):i.params.provider.server.params.encoding==="cif"?df(i.params.provider.id,function(p){return"https://files.rcsb.org/download/"+p.toUpperCase()+".cif"},function(p){return"RCSB: "+p+" (cif)"},!1):df(i.params.provider.id,function(p){return"https://models.rcsb.org/"+p.toUpperCase()+".bcif"},function(p){return"RCSB: "+p+" (bcif)"},!0),s=!!i.params.options.asTrajectory;break;case"pdb-dev":o=df(i.params.provider.id,function(p){var h=p.toUpperCase().startsWith("PDBDEV_")?p:"PDBDEV_"+p.padStart(8,"0");return i.params.provider.encoding==="bcif"?"https://pdb-dev.wwpdb.org/bcif/"+h.toUpperCase()+".bcif":"https://pdb-dev.wwpdb.org/cif/"+h.toUpperCase()+".cif"},function(p){return p.toUpperCase().startsWith("PDBDEV_")?p:"PDBDEV_"+p.padStart(8,"0")},i.params.provider.encoding==="bcif"),s=!!i.params.options.asTrajectory;break;case"swissmodel":o=df(i.params.id,function(p){return"https://swissmodel.expasy.org/repository/uniprot/"+p.toUpperCase()+".pdb"},function(p){return"SWISS-MODEL: "+p},!1),s=!!i.params.options.asTrajectory,u="pdb";break;case"pubchem":o=df(i.params.id,function(p){return"https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/CID/"+p.trim()+"/record/SDF/?record_type=3d"},function(p){return"PubChem: "+p},!1),s=!!i.params.options.asTrajectory,u="mol";break;default:throw new Error(i.name+" not supported.")}return l=r.source.params.options.representation||$v.auto.id,c=l!==$v.empty.id,d=i.params.options.type.name==="auto"?void 0:i.params.options.type,[4,n.transaction(function(){return pe(void 0,void 0,void 0,function(){var p,y,h,m,v,g,y;return he(this,function(b){switch(b.label){case 0:return o.length>0&&s?[4,t.builders.data.downloadBlob({sources:o.map(function(S,x){return{id:""+x,url:S.url,isBinary:S.isBinary}}),maxConcurrency:6},{state:{isGhost:!0}})]:[3,4];case 1:return p=b.sent(),[4,t.builders.structure.parseTrajectory(p,{formats:o.map(function(S,x){return{id:""+x,format:"cif"}})})];case 2:return y=b.sent(),[4,t.builders.structure.hierarchy.applyPreset(y,"default",{structure:d,showUnitcell:c,representationPreset:l,representationPresetParams:r.source.params.options.representationParams})];case 3:return b.sent(),[3,10];case 4:h=0,m=o,b.label=5;case 5:return h<m.length?(v=m[h],[4,t.builders.data.download(v,{state:{isGhost:!0}})]):[3,10];case 6:return g=b.sent(),[4,t.builders.structure.parseTrajectory(g,u)];case 7:return y=b.sent(),[4,t.builders.structure.hierarchy.applyPreset(y,"default",{structure:d,showUnitcell:c,representationPreset:l,representationPresetParams:r.source.params.options.representationParams})];case 8:b.sent(),b.label=9;case 9:return h++,[3,5];case 10:return[2]}})})}).runInContext(a)];case 1:return f.sent(),[2]}})})})});function df(e,t,r,n){for(var a=e.split(/[,\s]/).map(function(l){return l.trim()}).filter(function(l){return!!l&&(l.length>=4||/^[1-9][0-9]*$/.test(l))}),i=[],o=0,s=a;o<s.length;o++){var u=s[o];i.push({url:Fn.Url(t(u)),isBinary:n,label:r(u)})}return i}var yS=jo.build({display:{name:"Update Trajectory"},params:{action:M.Select("advance",[["advance","Advance"],["reset","Reset"]]),by:M.Optional(M.Numeric(1,{min:-1,max:1,step:1}))}})(function(e){var t=e.params,r=e.state,n=r.selectQ(function(d){return d.ofTransformer(lt.Model.ModelFromTrajectory)}),a=r.build();if(t.action==="reset")for(var i=0,o=n;i<o.length;i++){var s=o[i];a.to(s).update({modelIndex:0})}else for(var u=function(d){var f=lr.findAncestorOfType(r.tree,r.cells,d.transform.ref,be.Molecule.Trajectory);if(!f||!f.obj)return"continue";var p=f.obj;a.to(d).update(function(h){var m=(h.modelIndex+t.by)%p.data.frameCount;return m<0&&(m+=p.data.frameCount),{modelIndex:m}})},l=0,c=n;l<c.length;l++){var s=c[l];u(s)}return r.updateTree(a)}),CUe=jo.build({display:{name:"Custom Model Properties",description:"Enable parameters for custom properties of the model."},from:be.Molecule.Model,params:function(e,t){return t.customModelProperties.getParams(e?.data)},isApplicable:function(e,t,r){return t.transformer!==_Y}})(function(e,t){var r=e.ref,n=e.params;return t.builders.structure.insertModelProperties(r,n)}),wUe=jo.build({display:{name:"Custom Structure Properties",description:"Enable parameters for custom properties of the structure."},from:be.Molecule.Structure,params:function(e,t){return t.customStructureProperties.getParams(e?.data)},isApplicable:function(e,t,r){return t.transformer!==AY}})(function(e,t){var r=e.ref,n=e.params;return t.builders.structure.insertStructureProperties(r,n)}),_Ue=jo.build({display:{name:"Add Trajectory",description:"Add trajectory from existing model/topology and coordinates."},from:be.Root,params:function(e,t){var r=t.state.data,n=Gt(Gt([],r.selectQ(function(s){return s.rootsOfType(be.Molecule.Model)})),r.selectQ(function(s){return s.rootsOfType(be.Molecule.Topology)})),a=n.map(function(s){return[s.transform.ref,s.obj.label]}),i=r.selectQ(function(s){return s.rootsOfType(be.Molecule.Coordinates)}),o=i.map(function(s){return[s.transform.ref,s.obj.label]});return{model:M.Select(a.length?a[0][0]:"",a),coordinates:M.Select(o.length?o[0][0]:"",o)}}})(function(e,t){var r=e.params,n=e.state;return Qe.create("Add Trajectory",function(a){return n.transaction(function(){return pe(void 0,void 0,void 0,function(){var i,o,s;return he(this,function(u){switch(u.label){case 0:return i=[r.model,r.coordinates],o=n.build().toRoot().apply(CY,{modelRef:r.model,coordinatesRef:r.coordinates},{dependsOn:i}).apply(lt.Model.ModelFromTrajectory,{modelIndex:0}),[4,n.updateTree(o).runInContext(a)];case 1:return u.sent(),[4,t.builders.structure.createStructure(o.selector)];case 2:return s=u.sent(),[4,t.builders.structure.representation.applyPreset(s,"auto")];case 3:return u.sent(),[2]}})})}).runInContext(a)})}),AUe=Object.freeze({__proto__:null,PdbDownloadProvider:dQ,DownloadStructure:SUe,UpdateTrajectory:yS,EnableModelCustomProps:CUe,EnableStructureCustomProps:wUe,AddTrajectory:_Ue}),TUe=["gz","zip"],EUe=["bcif","ccp4","dcd"];function cR(e){var t,r,n="";e instanceof File?t=e.name:e instanceof Blob?t="":t=e;var a=t.lastIndexOf("?"),i=a!==-1?t.substring(a):"";t=t.substring(0,a===-1?t.length:a);var o=t.replace(/^.*[\\/]/,""),s=o.substring(0,o.lastIndexOf(".")),u=o.split("."),l=u.length>1?(u.pop()||"").toLowerCase():"",c=t.match(/^(.+):\/\/(.+)$/);c&&(n=c[1].toLowerCase(),t=c[2]||"");var d=t.substring(0,t.lastIndexOf("/")+1);if(TUe.includes(l)){r=l;var f=t.length-l.length-1;l=(t.substr(0,f).split(".").pop()||"").toLowerCase();var p=s.length-l.length-1;s=s.substr(0,p)}else r=!1;var h=EUe.includes(l);return{path:t,name:o,ext:l,base:s,dir:d,compressed:r,binary:h,protocol:n,query:i,src:e}}var PUe=jo.build({from:be.Root,display:{name:"Download Density",description:"Load a density from the provided source and create its default visual."},params:function(e,t){var r=t.dataFormats.options;return{source:M.MappedStatic("pdb-xray",{"pdb-xray":M.Group({provider:M.Group({id:M.Text("1tqn",{label:"Id"}),server:M.Select("rcsb",[["pdbe","PDBe"],["rcsb","RCSB PDB"]])},{pivot:"id"}),type:M.Select("2fofc",[["2fofc","2Fo-Fc"],["fofc","Fo-Fc"]])},{isFlat:!0}),"pdb-xray-ds":M.Group({provider:M.Group({id:M.Text("1tqn",{label:"Id"}),server:M.Select("pdbe",[["pdbe","PDBe"],["rcsb","RCSB PDB"]])},{pivot:"id"}),detail:M.Numeric(3,{min:0,max:6,step:1},{label:"Detail"})},{isFlat:!0}),"pdb-emd-ds":M.Group({provider:M.Group({id:M.Text("emd-8004",{label:"Id"}),server:M.Select("pdbe",[["pdbe","PDBe"],["rcsb","RCSB PDB"]])},{pivot:"id"}),detail:M.Numeric(3,{min:0,max:6,step:1},{label:"Detail"})},{isFlat:!0}),url:M.Group({url:M.Url(""),isBinary:M.Boolean(!1),format:M.Select("auto",r)},{isFlat:!0})},{options:[["pdb-xray","PDB X-ray maps"],["pdb-emd-ds","PDB EMD Density Server"],["pdb-xray-ds","PDB X-ray Density Server"],["url","URL"]]})}}})(function(e,t){var r=e.params;return Qe.create("Download Density",function(n){return pe(void 0,void 0,void 0,function(){var a,i,o,s,u,l,c,d;return he(this,function(f){switch(f.label){case 0:switch(a=r.source,a.name){case"url":i=a.params;break;case"pdb-xray":i=a.params.provider.server==="pdbe"?{url:Fn.Url(a.params.type==="2fofc"?"http://www.ebi.ac.uk/pdbe/coordinates/files/"+a.params.provider.id.toLowerCase()+".ccp4":"http://www.ebi.ac.uk/pdbe/coordinates/files/"+a.params.provider.id.toLowerCase()+"_diff.ccp4"),isBinary:!0,label:"PDBe X-ray map: "+a.params.provider.id}:{url:Fn.Url(a.params.type==="2fofc"?"https://edmaps.rcsb.org/maps/"+a.params.provider.id.toLowerCase()+"_2fofc.dsn6":"https://edmaps.rcsb.org/maps/"+a.params.provider.id.toLowerCase()+"_fofc.dsn6"),isBinary:!0,label:"RCSB X-ray map: "+a.params.provider.id};break;case"pdb-emd-ds":i=a.params.provider.server==="pdbe"?{url:Fn.Url("https://www.ebi.ac.uk/pdbe/densities/emd/"+a.params.provider.id.toLowerCase()+"/cell?detail="+a.params.detail),isBinary:!0,label:"PDBe EMD Density Server: "+a.params.provider.id}:{url:Fn.Url("https://maps.rcsb.org/em/"+a.params.provider.id.toLowerCase()+"/cell?detail="+a.params.detail),isBinary:!0,label:"RCSB PDB EMD Density Server: "+a.params.provider.id};break;case"pdb-xray-ds":i=a.params.provider.server==="pdbe"?{url:Fn.Url("https://www.ebi.ac.uk/pdbe/densities/x-ray/"+a.params.provider.id.toLowerCase()+"/cell?detail="+a.params.detail),isBinary:!0,label:"PDBe X-ray Density Server: "+a.params.provider.id}:{url:Fn.Url("https://maps.rcsb.org/x-ray/"+a.params.provider.id.toLowerCase()+"/cell?detail="+a.params.detail),isBinary:!0,label:"RCSB PDB X-ray Density Server: "+a.params.provider.id};break;default:throw new Error(a.name+" not supported.")}return[4,t.builders.data.download(i)];case 1:switch(s=f.sent(),u=void 0,a.name){case"url":i=a.params,o=a.params.format==="auto"?t.dataFormats.auto(cR(Fn.getUrl(i.url)),(c=s.cell)===null||c===void 0?void 0:c.obj):t.dataFormats.get(a.params.format);break;case"pdb-xray":u=a.params.provider.id,o=a.params.provider.server==="pdbe"?t.dataFormats.get("ccp4"):t.dataFormats.get("dsn6");break;case"pdb-emd-ds":case"pdb-xray-ds":u=a.params.provider.id,o=t.dataFormats.get("dscif");break;default:throw new Error(a.name+" not supported.")}return o?[4,o.parse(t,s,{entryId:u})]:(t.log.warn("DownloadDensity: Format provider not found."),[2]);case 2:return l=f.sent(),[4,(d=o.visuals)===null||d===void 0?void 0:d.call(o,t,l)];case 3:return f.sent(),[2]}})})})}),fQ=jo.build({display:{name:"Assign Volume Colors",description:"Assigns another volume to be available for coloring."},from:be.Volume.Data,isApplicable:function(e){return!e.data.colorVolume},params:function(e,t){var r=t.state.data.select(lr.Generators.root.subtree().ofType(be.Volume.Data).filter(function(n){var a;return!!n.obj&&!(!((a=n.obj)===null||a===void 0)&&a.data.colorVolume)&&n.obj!==e}));return r.length===0?{ref:M.Text("",{isHidden:!0,label:"Volume"})}:{ref:M.Select(r[0].transform.ref,r.map(function(n){return[n.transform.ref,n.obj.label]}),{label:"Volume"})}}})(function(e,t){var r=e.ref,n=e.params;return e.state,t.build().to(r).apply(lt.Volume.AssignColorVolume,{ref:n.ref},{dependsOn:[n.ref]}).commit()}),IUe=Object.freeze({__proto__:null,DownloadDensity:PUe,AssignColorVolume:fQ}),MUe=jo.build({display:{name:"Open Files",description:"Load one or more files and optionally create default visuals"},from:be.Root,params:function(e,t){var r=t.dataFormats,n=r.extensions,a=r.options;return{files:M.FileList({accept:Array.from(n.values()).map(function(i){return"."+i}).join(",")+",.gz,.zip",multiple:!0}),format:M.MappedStatic("auto",{auto:M.EmptyGroup(),specific:M.Select(a[0][0],a)}),visuals:M.Boolean(!0,{description:"Add default visuals"})}}})(function(e,t){var r=e.params,n=e.state;return Qe.create("Open Files",function(a){return pe(void 0,void 0,void 0,function(){return he(this,function(i){switch(i.label){case 0:return t.behaviors.layout.leftPanelTabName.next("data"),[4,n.transaction(function(){return pe(void 0,void 0,void 0,function(){var o,s,u,l,c,d,f,p,h,m,v;return he(this,function(g){switch(g.label){case 0:if(r.files===null)return t.log.error("No file(s) selected"),[2];o=0,s=r.files,g.label=1;case 1:if(!(o<s.length))return[3,9];u=s[o],g.label=2;case 2:return g.trys.push([2,7,,8]),l=cR(u.file),c=t.dataFormats.binaryExtensions.has(l.ext),[4,t.builders.data.readFile({file:u,isBinary:c})];case 3:return d=g.sent().data,f=r.format.name==="auto"?t.dataFormats.auto(l,(m=d.cell)===null||m===void 0?void 0:m.obj):t.dataFormats.get(r.format.params),f?[4,f.parse(t,d)]:(t.log.warn("OpenFiles: could not find data provider for '"+l.name+"."+l.ext+"'"),[3,8]);case 4:return p=g.sent(),r.visuals?[4,(v=f.visuals)===null||v===void 0?void 0:v.call(f,t,p)]:[3,6];case 5:g.sent(),g.label=6;case 6:return[3,8];case 7:return h=g.sent(),t.log.error(h),[3,8];case 8:return o++,[3,1];case 9:return[2]}})})}).runInContext(a)];case 1:return i.sent(),[2]}})})})}),DUe=jo.build({display:{name:"Download File",description:"Load one or more file from an URL"},from:be.Root,params:function(e,t){var r=t.dataFormats.options;return{url:M.Url(""),format:M.Select(r[0][0],r),isBinary:M.Boolean(!1),visuals:M.Boolean(!0,{description:"Add default visuals"})}}})(function(e,t){var r=e.params,n=e.state;return Qe.create("Open Files",function(a){return pe(void 0,void 0,void 0,function(){return he(this,function(i){switch(i.label){case 0:return t.behaviors.layout.leftPanelTabName.next("data"),[4,n.transaction(function(){return pe(void 0,void 0,void 0,function(){var o,s,u,l,c;return he(this,function(d){switch(d.label){case 0:return d.trys.push([0,5,,6]),o=t.dataFormats.get(r.format),o?[4,t.builders.data.download({url:r.url,isBinary:r.isBinary})]:(t.log.warn("DownloadFile: could not find data provider for '"+r.format+"'"),[2]);case 1:return s=d.sent(),[4,o.parse(t,s)];case 2:return u=d.sent(),r.visuals?[4,(c=o.visuals)===null||c===void 0?void 0:c.call(o,t,u)]:[3,4];case 3:d.sent(),d.label=4;case 4:return[3,6];case 5:return l=d.sent(),t.log.error(l),[3,6];case 6:return[2]}})})}).runInContext(a)];case 1:return i.sent(),[2]}})})})}),kUe=Object.freeze({__proto__:null,OpenFiles:MUe,DownloadFile:DUe}),ah={Structure:AUe,Volume:IUe,DataFormat:kUe},CI=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t}(be.Create({name:"Volume Streaming",typeClass:"Object"})),NN;(function(e){(function(t){t.Float32="float32",t.Int8="int8"})(e.ValueType||(e.ValueType={}))})(NN||(NN={}));function RUe(e,t){if(t===void 0&&(t="x-ray"),!e)return t;var r=e.models[0];return xn.is(r.sourceData)?rr.hasEmMap(r)?"em":rr.hasXrayMap(r)?"x-ray":rr.isFromEm(r)?"em":rr.isFromXray(r)?"x-ray":t:t}function OUe(e){var t=[];if(!xn.is(e.sourceData))return[e.entryId];var r=e.sourceData.data.db.pdbx_database_related,n=r.db_id,a=r.db_name,i=r.content_type;if(!a.isDefined)return[e.entryId];for(var o=0,s=a.rowCount;o<s;++o)a.value(o).toUpperCase()==="EMDB"&&i.value(o)==="associated EM volume"&&t.push(n.value(o));return t}function BUe(e){return[e.entryId]}function FUe(e,t){if(!t||!t.models.length)return[];var r=t.models[0];switch(e){case"em":return OUe(r);case"x-ray":return BUe(r)}}function zN(e,t,r,n){return pe(this,void 0,void 0,function(){return he(this,function(a){switch(e){case"emdb":return[2,pQ(t,r,n)];case"pdbe":return[2,LUe(t,r,n)]}return[2]})})}function pQ(e,t,r){return pe(this,void 0,void 0,function(){var n,a,i,o;return he(this,function(s){switch(s.label){case 0:return n=e.config.get(Qn.VolumeStreaming.EmdbHeaderServer),[4,e.fetch({url:n+"/"+r.toUpperCase()+"/header/"+r.toLowerCase()+".xml",type:"xml"}).runInContext(t)];case 1:return a=s.sent(),i=a.getElementsByTagName("map")[0],o=parseFloat(i.getElementsByTagName("contourLevel")[0].textContent),[2,o]}})})}function LUe(e,t,r){var n,a,i;return pe(this,void 0,void 0,function(){var o,s,u;return he(this,function(l){switch(l.label){case 0:return r=r.toUpperCase(),[4,e.fetch({url:"https://www.ebi.ac.uk/pdbe/api/emdb/entry/map/"+r,type:"json"}).runInContext(t)];case 1:return o=l.sent(),s=o?.[r],u=void 0,((i=(a=(n=s?.[0])===null||n===void 0?void 0:n.map)===null||a===void 0?void 0:a.contour_level)===null||i===void 0?void 0:i.value)!==void 0&&(u=+s[0].map.contour_level.value),[2,u]}})})}function NUe(e,t,r){var n;return pe(this,void 0,void 0,function(){var a,i,o,s;return he(this,function(u){switch(u.label){case 0:return[4,e.fetch({url:"https://www.ebi.ac.uk/pdbe/api/pdb/entry/summary/"+r,type:"json"}).runInContext(t)];case 1:if(a=u.sent(),i=a?.[r],o=[],!((n=i?.[0])===null||n===void 0)&&n.related_structures){if(s=i[0].related_structures.filter(function(l){return l.resource==="EMDB"&&l.relationship==="associated EM volume"}),!s.length)throw new Error("No related EMDB entry found for '"+r+"'.");o.push.apply(o,s.map(function(l){return l.accession}))}else throw new Error("No related EMDB entry found for '"+r+"'.");return[2,o]}})})}var Gy;(function(e){function t(i,o){return{key:i,data:o}}function r(i){return{entries:KP(),capacity:Math.max(1,i)}}e.create=r;function n(i,o){for(var s=i.entries.first;s;s=s.next)if(s.value.key===o)return i.entries.remove(s),i.entries.addLast(s.value),s.value.data}e.get=n;function a(i,o,s){var u=void 0;if(i.entries.count>=i.capacity){var l=i.entries.first;u=l.value.data,i.entries.remove(l)}return i.entries.addLast(t(o,s)),u}e.set=a})(Gy||(Gy={}));var Qi=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t}(be.CreateBehavior({name:"Volume Streaming"}));(function(e){e.RootTag="volume-streaming-info";function t(o,s,u,l,c){var d,f,p,h;return c===void 0&&(c={}),M.Group({isoValue:It.createIsoValueParam((d=c.isoValue)!==null&&d!==void 0?d:u,l),color:M.Color((f=c.color)!==null&&f!==void 0?f:s),wireframe:M.Boolean((p=c.wireframe)!==null&&p!==void 0?p:!1),opacity:M.Numeric((h=c.opacity)!==null&&h!==void 0?h:.3,{min:0,max:1,step:.01})},{label:o,isExpanded:!0})}var r={byteOffset:0,rate:1,sampleCount:[1,1,1],valuesInfo:[{mean:0,min:-1,max:1,sigma:.1},{mean:0,min:-1,max:1,sigma:.1}]};function n(o){o===void 0&&(o={});var s=o.data,u=o.defaultView,l=o.channelParams,c=new Map;s&&s.entries.forEach(function(p){return c.set(p.dataId,p)});var d=s?s.entries.map(function(p){return[p.dataId,p.dataId]}):[],f=s?s.entries[0].dataId:"";return{entry:M.Mapped(f,d,function(p){return M.Group(a({entryData:c.get(p),defaultView:u,structure:s&&s.structure,channelParams:l}))})}}e.createParams=n;function a(o){var s=o.entryData,u=o.defaultView,l=o.structure,c=o.channelParams,d=c===void 0?{}:c,f=s||{kind:"em",header:{sampling:[r],availablePrecisions:[{precision:0,maxVoxels:0}]},emDefaultContourLevel:It.IsoValue.relative(0)},p=l&&l.boundary.box||tr();return{view:M.MappedStatic(u||(f.kind==="em"?"cell":"selection-box"),{off:M.Group({}),box:M.Group({bottomLeft:M.Vec3(p.min),topRight:M.Vec3(p.max)},{description:"Static box defined by cartesian coords.",isFlat:!0}),"selection-box":M.Group({radius:M.Numeric(5,{min:0,max:50,step:.5},{description:"Radius in \u212B within which the volume is shown."}),bottomLeft:M.Vec3(A.create(0,0,0),{},{isHidden:!0}),topRight:M.Vec3(A.create(0,0,0),{},{isHidden:!0})},{description:"Box around focused element.",isFlat:!0}),cell:M.Group({}),auto:M.Group({radius:M.Numeric(5,{min:0,max:50,step:.5},{description:"Radius in \u212B within which the volume is shown."}),selectionDetailLevel:M.Select(Math.min(6,f.header.availablePrecisions.length-1),f.header.availablePrecisions.map(function(h,m){return[m,m+1+" [ "+(Math.pow(h.maxVoxels,1/3)|0)+"^3 cells ]"]}),{label:"Selection Detail",description:"Determines the maximum number of voxels. Depending on the size of the volume options are in the range from 0 (0.52M voxels) to 6 (25.17M voxels)."}),isSelection:M.Boolean(!1,{isHidden:!0}),bottomLeft:M.Vec3(p.min,{},{isHidden:!0}),topRight:M.Vec3(p.max,{},{isHidden:!0})},{description:"Box around focused element.",isFlat:!0})},{options:e.ViewTypeOptions,description:'Controls what of the volume is displayed. "Off" hides the volume alltogether. "Bounded box" shows the volume inside the given box. "Around Interaction" shows the volume around the focused element/atom. "Whole Structure" shows the volume for the whole structure.'}),detailLevel:M.Select(Math.min(3,f.header.availablePrecisions.length-1),f.header.availablePrecisions.map(function(h,m){return[m,m+1+" [ "+(Math.pow(h.maxVoxels,1/3)|0)+"^3 cells ]"]}),{description:"Determines the maximum number of voxels. Depending on the size of the volume options are in the range from 0 (0.52M voxels) to 6 (25.17M voxels)."}),channels:f.kind==="em"?M.Group({em:t("EM",vt(6524815),f.emDefaultContourLevel||It.IsoValue.relative(1),f.header.sampling[0].valuesInfo[0],d.em)},{isFlat:!0}):M.Group({"2fo-fc":t("2Fo-Fc",vt(3367602),It.IsoValue.relative(1.5),f.header.sampling[0].valuesInfo[0],d["2fo-fc"]),"fo-fc(+ve)":t("Fo-Fc(+ve)",vt(3390259),It.IsoValue.relative(3),f.header.sampling[0].valuesInfo[1],d["fo-fc(+ve)"]),"fo-fc(-ve)":t("Fo-Fc(-ve)",vt(12268339),It.IsoValue.relative(-3),f.header.sampling[0].valuesInfo[1],d["fo-fc(-ve)"])},{isFlat:!0})}}e.createEntryParams=a,e.ViewTypeOptions=[["off","Off"],["box","Bounded Box"],["selection-box","Around Focus"],["cell","Whole Structure"],["auto","Auto"]],e.ChannelTypeOptions=[["em","em"],["2fo-fc","2fo-fc"],["fo-fc(+ve)","fo-fc(+ve)"],["fo-fc(-ve)","fo-fc(-ve)"]];var i=function(o){Le(s,o);function s(u,l){var c=o.call(this,u,{})||this;return c.plugin=u,c.data=l,c.cache=Gy.create(25),c.params={},c.lastLoci=zr,c.ref="",c.channels={},c._invTransform=de(),c.infoMap=new Map,c.data.entries.forEach(function(d){return c.infoMap.set(d.dataId,d)}),c}return Object.defineProperty(s.prototype,"info",{get:function(){return this.infoMap.get(this.params.entry.name)},enumerable:!1,configurable:!0}),s.prototype.queryData=function(u){return pe(this,void 0,void 0,function(){var l,c,d,f,p,h,m,v,g;return he(this,function(y){switch(y.label){case 0:return l=w_(this.data.serverUrl,this.info.kind+"/"+this.info.dataId.toLowerCase()),u?(c=u.min,d=u.max,l+="/box"+("/"+c.map(function(b){return Math.round(1e3*b)/1e3}).join(","))+("/"+d.map(function(b){return Math.round(1e3*b)/1e3}).join(","))):l+="/cell",f=this.params.entry.params.detailLevel,this.params.entry.params.view.name==="auto"&&this.params.entry.params.view.params.isSelection&&(f=this.params.entry.params.view.params.selectionDetailLevel),l+="?detail="+f,p=Gy.get(this.cache,l),p?[2,p.data]:(h=Fn.getUrlAsset(this.plugin.managers.asset,l),[4,this.plugin.runTask(this.plugin.managers.asset.resolve(h,"binary"))]);case 1:return m=y.sent(),[4,this.parseCif(m.data)];case 2:return v=y.sent(),v?(g=Gy.set(this.cache,l,{data:v,asset:m}),g&&g.asset.dispose(),[2,v]):[2]}})})},s.prototype.parseCif=function(u){return pe(this,void 0,void 0,function(){var l,c,d,f,p,h;return he(this,function(m){switch(m.label){case 0:return[4,this.plugin.runTask(md.parseBinary(u))];case 1:if(l=m.sent(),l.isError)return this.plugin.log.error("VolumeStreaming, parsing CIF: "+l.toString()),[2];if(l.result.blocks.length<2)return this.plugin.log.error("VolumeStreaming: Invalid data."),[2];c={},d=1,m.label=2;case 2:return d<l.result.blocks.length?(f=l.result.blocks[d],p=md.schema.densityServer(f),[4,this.plugin.runTask(TY(p))]):[3,5];case 3:h=m.sent(),c[f.header]=h,m.label=4;case 4:return d++,[3,2];case 5:return[2,c]}})})},s.prototype.updateSelectionBoxParams=function(u){if(this.params.entry.params.view.name==="selection-box"){var l=this.plugin.state.data,c=T(T({},this.params),{entry:{name:this.params.entry.name,params:T(T({},this.params.entry.params),{view:{name:"selection-box",params:{radius:this.params.entry.params.view.params.radius,bottomLeft:u.min,topRight:u.max}}})}}),d=l.build().to(this.ref).update(c);Rt.State.Update(this.plugin,{state:l,tree:d,options:{doNotUpdateCurrent:!0}})}},s.prototype.updateAutoParams=function(u,l){if(this.params.entry.params.view.name==="auto"){var c=this.plugin.state.data,d=T(T({},this.params),{entry:{name:this.params.entry.name,params:T(T({},this.params.entry.params),{view:{name:"auto",params:{radius:this.params.entry.params.view.params.radius,selectionDetailLevel:this.params.entry.params.view.params.selectionDetailLevel,isSelection:l,bottomLeft:u?.min||A.zero(),topRight:u?.max||A.zero()}}})}}),f=c.build().to(this.ref).update(d);Rt.State.Update(this.plugin,{state:c,tree:f,options:{doNotUpdateCurrent:!0}})}},s.prototype.getStructureRoot=function(){return this.plugin.state.data.select(lr.Generators.byRef(this.ref).rootOfType(be.Molecule.Structure))[0]},s.prototype.register=function(u){var l=this;this.ref=u,this.subscribeObservable(this.plugin.state.events.object.removed,function(c){!be.Molecule.Structure.is(c.obj)||!Oe.is(l.lastLoci)||l.lastLoci.structure===c.obj.data&&(l.lastLoci=zr)}),this.subscribeObservable(this.plugin.state.events.object.updated,function(c){!be.Molecule.Structure.is(c.oldObj)||!Oe.is(l.lastLoci)||l.lastLoci.structure===c.oldObj.data&&(l.lastLoci=zr)}),this.subscribeObservable(this.plugin.managers.structure.focus.behaviors.current,function(c){if(!!l.plugin.state.data.tree.children.has(l.ref)){var d=c?c.loci:zr;switch(l.params.entry.params.view.name){case"auto":l.updateAuto(d);break;case"selection-box":l.updateSelectionBox(d);break;default:l.lastLoci=d;break}}})},s.prototype.unregister=function(){for(var u=this.cache.entries.first;u;)u.value.data.asset.dispose(),u=u.next},s.prototype.getBoxFromLoci=function(u){var l,c,d;if(cr.isEmpty(u))return tr();var f=this.plugin.helpers.substructureParent.get(u.structure,!0);if(!f)return tr();var p=this.getStructureRoot();if(!p||((l=p.obj)===null||l===void 0?void 0:l.data)!==((c=f.obj)===null||c===void 0?void 0:c.data))return tr();var h=Wh.get((d=p.obj)===null||d===void 0?void 0:d.data.models[0]);h&&de.invert(this._invTransform,h);var m=Oe.extendToWholeResidues(u),v=Oe.getBoundary(m,h&&!Number.isNaN(this._invTransform[0])?this._invTransform:void 0).box;return Oe.size(m)===1&&tr.expand(v,v,A.create(1,1,1)),v},s.prototype.updateAuto=function(u){if(this.lastLoci=u,Ku(u)){this.updateAutoParams(this.info.kind==="x-ray"?this.data.structure.boundary.box:void 0,!1);return}var l=this.getBoxFromLoci(u);this.updateAutoParams(l,!0)},s.prototype.updateSelectionBox=function(u){if(cr.areEqual(this.lastLoci,u)){this.lastLoci=zr,this.updateSelectionBoxParams(tr());return}if(this.lastLoci=u,Ku(u)){this.updateSelectionBoxParams(tr());return}var l=this.getBoxFromLoci(u);this.updateSelectionBoxParams(l)},s.prototype.update=function(u){return pe(this,void 0,void 0,function(){var l,c,d,f,f,p,h,m;return he(this,function(v){switch(v.label){case 0:switch(l=u.entry.params.view.name==="selection-box"&&this.params&&this.params.entry&&this.params.entry.params&&this.params.entry.params.view&&this.params.entry.params.view.name!=="selection-box",this.params=u,c=void 0,d=!1,u.entry.params.view.name){case"off":d=!0;break;case"box":c=tr.create(u.entry.params.view.params.bottomLeft,u.entry.params.view.params.topRight),d=tr.volume(c)<1e-4;break;case"selection-box":{l?c=this.getBoxFromLoci(this.lastLoci)||tr():c=tr.create(A.clone(u.entry.params.view.params.bottomLeft),A.clone(u.entry.params.view.params.topRight)),f=u.entry.params.view.params.radius,d=tr.volume(c)<1e-4,tr.expand(c,c,A.create(f,f,f));break}case"cell":c=this.info.kind==="x-ray"?this.data.structure.boundary.box:void 0;break;case"auto":c=u.entry.params.view.params.isSelection||this.info.kind==="x-ray"?tr.create(A.clone(u.entry.params.view.params.bottomLeft),A.clone(u.entry.params.view.params.topRight)):void 0,c&&(d=tr.volume(c)<1e-4,u.entry.params.view.params.isSelection&&(f=u.entry.params.view.params.radius,tr.expand(c,c,A.create(f,f,f))));break}return d?(h={},[3,3]):[3,1];case 1:return[4,this.queryData(c)];case 2:h=v.sent(),v.label=3;case 3:return p=h,p?(m=u.entry.params.channels,this.info.kind==="x-ray"?(this.channels["2fo-fc"]=this.createChannel(p["2FO-FC"]||It.One,m["2fo-fc"],this.info.header.sampling[0].valuesInfo[0]),this.channels["fo-fc(+ve)"]=this.createChannel(p["FO-FC"]||It.One,m["fo-fc(+ve)"],this.info.header.sampling[0].valuesInfo[1]),this.channels["fo-fc(-ve)"]=this.createChannel(p["FO-FC"]||It.One,m["fo-fc(-ve)"],this.info.header.sampling[0].valuesInfo[1])):this.channels.em=this.createChannel(p.EM||It.One,m.em,this.info.header.sampling[0].valuesInfo[0]),[2,!0]):[2,!1]}})})},s.prototype.createChannel=function(u,l,c){var d=l;return{data:u,color:d.color,wireframe:d.wireframe,opacity:d.opacity,isoValue:d.isoValue.kind==="relative"?d.isoValue:It.IsoValue.toRelative(d.isoValue,c)}},s.prototype.getDescription=function(){return this.params.entry.params.view.name==="selection-box"?"Selection":this.params.entry.params.view.name==="box"?"Static Box":this.params.entry.params.view.name==="cell"?"Cell":""},s}(Ur.WithSubscribers);e.Behavior=i})(Qi||(Qi={}));function ff(e,t,r){return{i:e,j:t,k:r}}function Hs(e,t){return{a:e,b:t}}var pa=[ff(0,0,0),ff(1,0,0),ff(1,1,0),ff(0,1,0),ff(0,0,1),ff(1,0,1),ff(1,1,1),ff(0,1,1)],zUe=[Hs(pa[0],pa[1]),Hs(pa[1],pa[2]),Hs(pa[2],pa[3]),Hs(pa[3],pa[0]),Hs(pa[4],pa[5]),Hs(pa[5],pa[6]),Hs(pa[6],pa[7]),Hs(pa[7],pa[4]),Hs(pa[0],pa[4]),Hs(pa[1],pa[5]),Hs(pa[2],pa[6]),Hs(pa[3],pa[7])],UUe=[{i:0,j:0,k:0,e:0},{i:1,j:0,k:0,e:1},{i:0,j:1,k:0,e:0},{i:0,j:0,k:0,e:1},{i:0,j:0,k:1,e:0},{i:1,j:0,k:1,e:1},{i:0,j:1,k:1,e:0},{i:0,j:0,k:1,e:1},{i:0,j:0,k:0,e:2},{i:1,j:0,k:0,e:2},{i:1,j:1,k:0,e:2},{i:0,j:1,k:0,e:2}],VUe=[0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0],Qv=[[],[0,8,3],[0,1,9],[1,8,3,9,8,1],[1,2,10],[0,8,3,1,2,10],[9,2,10,0,2,9],[2,8,3,2,10,8,10,9,8],[3,11,2],[0,11,2,8,11,0],[1,9,0,2,3,11],[1,11,2,1,9,11,9,8,11],[3,10,1,11,10,3],[0,10,1,0,8,10,8,11,10],[3,9,0,3,11,9,11,10,9],[9,8,10,10,8,11],[4,7,8],[4,3,0,7,3,4],[0,1,9,8,4,7],[4,1,9,4,7,1,7,3,1],[1,2,10,8,4,7],[3,4,7,3,0,4,1,2,10],[9,2,10,9,0,2,8,4,7],[2,10,9,2,9,7,2,7,3,7,9,4],[8,4,7,3,11,2],[11,4,7,11,2,4,2,0,4],[9,0,1,8,4,7,2,3,11],[4,7,11,9,4,11,9,11,2,9,2,1],[3,10,1,3,11,10,7,8,4],[1,11,10,1,4,11,1,0,4,7,11,4],[4,7,8,9,0,11,9,11,10,11,0,3],[4,7,11,4,11,9,9,11,10],[9,5,4],[9,5,4,0,8,3],[0,5,4,1,5,0],[8,5,4,8,3,5,3,1,5],[1,2,10,9,5,4],[3,0,8,1,2,10,4,9,5],[5,2,10,5,4,2,4,0,2],[2,10,5,3,2,5,3,5,4,3,4,8],[9,5,4,2,3,11],[0,11,2,0,8,11,4,9,5],[0,5,4,0,1,5,2,3,11],[2,1,5,2,5,8,2,8,11,4,8,5],[10,3,11,10,1,3,9,5,4],[4,9,5,0,8,1,8,10,1,8,11,10],[5,4,0,5,0,11,5,11,10,11,0,3],[5,4,8,5,8,10,10,8,11],[9,7,8,5,7,9],[9,3,0,9,5,3,5,7,3],[0,7,8,0,1,7,1,5,7],[1,5,3,3,5,7],[9,7,8,9,5,7,10,1,2],[10,1,2,9,5,0,5,3,0,5,7,3],[8,0,2,8,2,5,8,5,7,10,5,2],[2,10,5,2,5,3,3,5,7],[7,9,5,7,8,9,3,11,2],[9,5,7,9,7,2,9,2,0,2,7,11],[2,3,11,0,1,8,1,7,8,1,5,7],[11,2,1,11,1,7,7,1,5],[9,5,8,8,5,7,10,1,3,10,3,11],[5,7,0,5,0,9,7,11,0,1,0,10,11,10,0],[11,10,0,11,0,3,10,5,0,8,0,7,5,7,0],[11,10,5,7,11,5],[10,6,5],[0,8,3,5,10,6],[9,0,1,5,10,6],[1,8,3,1,9,8,5,10,6],[1,6,5,2,6,1],[1,6,5,1,2,6,3,0,8],[9,6,5,9,0,6,0,2,6],[5,9,8,5,8,2,5,2,6,3,2,8],[2,3,11,10,6,5],[11,0,8,11,2,0,10,6,5],[0,1,9,2,3,11,5,10,6],[5,10,6,1,9,2,9,11,2,9,8,11],[6,3,11,6,5,3,5,1,3],[0,8,11,0,11,5,0,5,1,5,11,6],[3,11,6,0,3,6,0,6,5,0,5,9],[6,5,9,6,9,11,11,9,8],[5,10,6,4,7,8],[4,3,0,4,7,3,6,5,10],[1,9,0,5,10,6,8,4,7],[10,6,5,1,9,7,1,7,3,7,9,4],[6,1,2,6,5,1,4,7,8],[1,2,5,5,2,6,3,0,4,3,4,7],[8,4,7,9,0,5,0,6,5,0,2,6],[7,3,9,7,9,4,3,2,9,5,9,6,2,6,9],[3,11,2,7,8,4,10,6,5],[5,10,6,4,7,2,4,2,0,2,7,11],[0,1,9,4,7,8,2,3,11,5,10,6],[9,2,1,9,11,2,9,4,11,7,11,4,5,10,6],[8,4,7,3,11,5,3,5,1,5,11,6],[5,1,11,5,11,6,1,0,11,7,11,4,0,4,11],[0,5,9,0,6,5,0,3,6,11,6,3,8,4,7],[6,5,9,6,9,11,4,7,9,7,11,9],[10,4,9,6,4,10],[4,10,6,4,9,10,0,8,3],[10,0,1,10,6,0,6,4,0],[8,3,1,8,1,6,8,6,4,6,1,10],[1,4,9,1,2,4,2,6,4],[3,0,8,1,2,9,2,4,9,2,6,4],[0,2,4,4,2,6],[8,3,2,8,2,4,4,2,6],[10,4,9,10,6,4,11,2,3],[0,8,2,2,8,11,4,9,10,4,10,6],[3,11,2,0,1,6,0,6,4,6,1,10],[6,4,1,6,1,10,4,8,1,2,1,11,8,11,1],[9,6,4,9,3,6,9,1,3,11,6,3],[8,11,1,8,1,0,11,6,1,9,1,4,6,4,1],[3,11,6,3,6,0,0,6,4],[6,4,8,11,6,8],[7,10,6,7,8,10,8,9,10],[0,7,3,0,10,7,0,9,10,6,7,10],[10,6,7,1,10,7,1,7,8,1,8,0],[10,6,7,10,7,1,1,7,3],[1,2,6,1,6,8,1,8,9,8,6,7],[2,6,9,2,9,1,6,7,9,0,9,3,7,3,9],[7,8,0,7,0,6,6,0,2],[7,3,2,6,7,2],[2,3,11,10,6,8,10,8,9,8,6,7],[2,0,7,2,7,11,0,9,7,6,7,10,9,10,7],[1,8,0,1,7,8,1,10,7,6,7,10,2,3,11],[11,2,1,11,1,7,10,6,1,6,7,1],[8,9,6,8,6,7,9,1,6,11,6,3,1,3,6],[0,9,1,11,6,7],[7,8,0,7,0,6,3,11,0,11,6,0],[7,11,6],[7,6,11],[3,0,8,11,7,6],[0,1,9,11,7,6],[8,1,9,8,3,1,11,7,6],[10,1,2,6,11,7],[1,2,10,3,0,8,6,11,7],[2,9,0,2,10,9,6,11,7],[6,11,7,2,10,3,10,8,3,10,9,8],[7,2,3,6,2,7],[7,0,8,7,6,0,6,2,0],[2,7,6,2,3,7,0,1,9],[1,6,2,1,8,6,1,9,8,8,7,6],[10,7,6,10,1,7,1,3,7],[10,7,6,1,7,10,1,8,7,1,0,8],[0,3,7,0,7,10,0,10,9,6,10,7],[7,6,10,7,10,8,8,10,9],[6,8,4,11,8,6],[3,6,11,3,0,6,0,4,6],[8,6,11,8,4,6,9,0,1],[9,4,6,9,6,3,9,3,1,11,3,6],[6,8,4,6,11,8,2,10,1],[1,2,10,3,0,11,0,6,11,0,4,6],[4,11,8,4,6,11,0,2,9,2,10,9],[10,9,3,10,3,2,9,4,3,11,3,6,4,6,3],[8,2,3,8,4,2,4,6,2],[0,4,2,4,6,2],[1,9,0,2,3,4,2,4,6,4,3,8],[1,9,4,1,4,2,2,4,6],[8,1,3,8,6,1,8,4,6,6,10,1],[10,1,0,10,0,6,6,0,4],[4,6,3,4,3,8,6,10,3,0,3,9,10,9,3],[10,9,4,6,10,4],[4,9,5,7,6,11],[0,8,3,4,9,5,11,7,6],[5,0,1,5,4,0,7,6,11],[11,7,6,8,3,4,3,5,4,3,1,5],[9,5,4,10,1,2,7,6,11],[6,11,7,1,2,10,0,8,3,4,9,5],[7,6,11,5,4,10,4,2,10,4,0,2],[3,4,8,3,5,4,3,2,5,10,5,2,11,7,6],[7,2,3,7,6,2,5,4,9],[9,5,4,0,8,6,0,6,2,6,8,7],[3,6,2,3,7,6,1,5,0,5,4,0],[6,2,8,6,8,7,2,1,8,4,8,5,1,5,8],[9,5,4,10,1,6,1,7,6,1,3,7],[1,6,10,1,7,6,1,0,7,8,7,0,9,5,4],[4,0,10,4,10,5,0,3,10,6,10,7,3,7,10],[7,6,10,7,10,8,5,4,10,4,8,10],[6,9,5,6,11,9,11,8,9],[3,6,11,0,6,3,0,5,6,0,9,5],[0,11,8,0,5,11,0,1,5,5,6,11],[6,11,3,6,3,5,5,3,1],[1,2,10,9,5,11,9,11,8,11,5,6],[0,11,3,0,6,11,0,9,6,5,6,9,1,2,10],[11,8,5,11,5,6,8,0,5,10,5,2,0,2,5],[6,11,3,6,3,5,2,10,3,10,5,3],[5,8,9,5,2,8,5,6,2,3,8,2],[9,5,6,9,6,0,0,6,2],[1,5,8,1,8,0,5,6,8,3,8,2,6,2,8],[1,5,6,2,1,6],[1,3,6,1,6,10,3,8,6,5,6,9,8,9,6],[10,1,0,10,0,6,9,5,0,5,6,0],[0,3,8,5,6,10],[10,5,6],[11,5,10,7,5,11],[11,5,10,11,7,5,8,3,0],[5,11,7,5,10,11,1,9,0],[10,7,5,10,11,7,9,8,1,8,3,1],[11,1,2,11,7,1,7,5,1],[0,8,3,1,2,7,1,7,5,7,2,11],[9,7,5,9,2,7,9,0,2,2,11,7],[7,5,2,7,2,11,5,9,2,3,2,8,9,8,2],[2,5,10,2,3,5,3,7,5],[8,2,0,8,5,2,8,7,5,10,2,5],[9,0,1,5,10,3,5,3,7,3,10,2],[9,8,2,9,2,1,8,7,2,10,2,5,7,5,2],[1,3,5,3,7,5],[0,8,7,0,7,1,1,7,5],[9,0,3,9,3,5,5,3,7],[9,8,7,5,9,7],[5,8,4,5,10,8,10,11,8],[5,0,4,5,11,0,5,10,11,11,3,0],[0,1,9,8,4,10,8,10,11,10,4,5],[10,11,4,10,4,5,11,3,4,9,4,1,3,1,4],[2,5,1,2,8,5,2,11,8,4,5,8],[0,4,11,0,11,3,4,5,11,2,11,1,5,1,11],[0,2,5,0,5,9,2,11,5,4,5,8,11,8,5],[9,4,5,2,11,3],[2,5,10,3,5,2,3,4,5,3,8,4],[5,10,2,5,2,4,4,2,0],[3,10,2,3,5,10,3,8,5,4,5,8,0,1,9],[5,10,2,5,2,4,1,9,2,9,4,2],[8,4,5,8,5,3,3,5,1],[0,4,5,1,0,5],[8,4,5,8,5,3,9,0,5,0,3,5],[9,4,5],[4,11,7,4,9,11,9,10,11],[0,8,3,4,9,7,9,11,7,9,10,11],[1,10,11,1,11,4,1,4,0,7,4,11],[3,1,4,3,4,8,1,10,4,7,4,11,10,11,4],[4,11,7,9,11,4,9,2,11,9,1,2],[9,7,4,9,11,7,9,1,11,2,11,1,0,8,3],[11,7,4,11,4,2,2,4,0],[11,7,4,11,4,2,8,3,4,3,2,4],[2,9,10,2,7,9,2,3,7,7,4,9],[9,10,7,9,7,4,10,2,7,8,7,0,2,0,7],[3,7,10,3,10,2,7,4,10,1,10,0,4,0,10],[1,10,2,8,7,4],[4,9,1,4,1,7,7,1,3],[4,9,1,4,1,7,0,8,1,8,7,1],[4,0,3,7,4,3],[4,8,7],[9,10,8,10,11,8],[3,0,9,3,9,11,11,9,10],[0,1,10,0,10,8,8,10,11],[3,1,10,11,3,10],[1,2,11,1,11,9,9,11,8],[3,0,9,3,9,11,1,2,9,2,11,9],[0,2,11,8,0,11],[3,2,11],[2,3,8,2,8,10,10,8,9],[9,10,2,0,9,2],[2,3,8,2,8,10,0,1,8,1,10,8],[1,10,2],[1,3,8,9,1,8],[0,9,1],[0,3,8],[]],gT=[[0,4,4,4,2,0,0,0,2,2,0,0],[4,0,4,4,0,8,0,0,0,8,8,0],[4,4,0,4,0,0,8,0,0,0,8,8],[4,4,4,0,0,0,0,1,1,0,0,1],[2,0,0,0,0,8,8,8,2,2,0,0],[0,8,0,0,8,0,8,8,0,8,8,0],[0,0,8,0,8,8,0,8,0,0,8,8],[0,0,0,1,8,8,8,0,1,0,0,1],[2,0,0,1,2,0,0,1,0,2,0,1],[2,8,0,0,2,8,0,0,2,0,8,0],[0,8,8,0,0,8,8,0,0,8,0,8],[0,0,8,1,0,0,8,1,1,0,8,0]];function HUe(e,t){var r=Math.min(65536,e*4),n=Ke.create(Float32Array,3,e,t&&t.vertexBuffer.ref.value),a=Ke.create(Float32Array,3,e,t&&t.normalBuffer.ref.value),i=Ke.create(Float32Array,1,e,t&&t.groupBuffer.ref.value),o=Ke.create(Uint32Array,3,r,t&&t.indexBuffer.ref.value),s=0,u=0;return{addVertex:function(l,c,d){return++s,Ke.add3(n,l,c,d)},addNormal:function(l,c,d){Ke.add3(a,l,c,d)},addGroup:function(l){Ke.add(i,l)},addTriangle:function(l,c,d,f){var p=l[c],h=l[d],m=l[f];p>=0&&h>=0&&m>=0&&(++u,Ke.add3(o,p,h,m))},get:function(){var l=Ke.compact(n,!0),c=Ke.compact(a,!0),d=Ke.compact(o,!0),f=Ke.compact(i,!0);return Wt.create(l,d,c,f,s,u,t)}}}function jUe(e,t){var r=Ke.create(Float32Array,3,e),n=Ke.create(Float32Array,1,e),a=Ke.create(Float32Array,2,e),i=0;return{addVertex:function(o,s,u){return Ke.add3(r,o,s,u)},addNormal:function(){return Df},addGroup:function(o){Ke.add(n,o)},addTriangle:function(o,s,u,l,c){var d=o[s],f=o[u],p=o[l];d>=0&&f>=0&&p>=0&&(gT[s][u]&c&&(++i,Ke.add2(a,o[s],o[u])),gT[u][l]&c&&(++i,Ke.add2(a,o[u],o[l])),gT[s][l]&c&&(++i,Ke.add2(a,o[s],o[l])))},get:function(){for(var o=Ke.compact(r,!0),s=Ke.compact(a,!0),u=Ke.compact(n,!0),l=_s.create(i,i/10,t),c=0;c<i;++c){var d=s[c*2],f=s[c*2+1];l.add(o[d*3],o[d*3+1],o[d*3+2],o[f*3],o[f*3+1],o[f*3+2],u[d])}return l.getLines()}}}function hQ(e){return T(T({},e),{bottomLeft:ja(e.bottomLeft,[0,0,0]),topRight:ja(e.topRight,e.scalarField.space.dimensions)})}function mQ(e){return{dX:e.topRight[0]-e.bottomLeft[0],dY:e.topRight[1]-e.bottomLeft[1],dZ:e.topRight[2]-e.bottomLeft[2]}}function I_(e,t){var r=this;return Qe.create("Marching Cubes Mesh",function(n){return pe(r,void 0,void 0,function(){var a,i,o,s,u,l,c;return he(this,function(d){switch(d.label){case 0:return a=hQ(e),i=mQ(a),o=i.dX,s=i.dY,u=i.dZ,l=Math.min(262144,Math.max(o*s*u/32,1024)),c=HUe(l,t),[4,new vQ(n,c,a).run()];case 1:return d.sent(),[2,c.get()]}})})})}function dR(e,t){var r=this;return Qe.create("Marching Cubes Lines",function(n){return pe(r,void 0,void 0,function(){var a,i,o,s,u,l,c;return he(this,function(d){switch(d.label){case 0:return a=hQ(e),i=mQ(a),o=i.dX,s=i.dY,u=i.dZ,l=Math.min(262144,Math.max(o*s*u/32,1024)),c=jUe(l,t),[4,new vQ(n,c,a).run()];case 1:return d.sent(),[2,c.get()]}})})})}var vQ=function(){function e(t,r,n){this.ctx=t,this.minX=0,this.minY=0,this.minZ=0,this.maxX=0,this.maxY=0,this.maxZ=0,this.state=new GUe(r,n),this.minX=n.bottomLeft[0],this.minY=n.bottomLeft[1],this.minZ=n.bottomLeft[2],this.maxX=n.topRight[0]-1,this.maxY=n.topRight[1]-1,this.maxZ=n.topRight[2]-1,this.size=(this.maxX-this.minX)*(this.maxY-this.minY)*(this.maxZ-this.minZ),this.sliceSize=(this.maxX-this.minX)*(this.maxY-this.minY)}return e.prototype.doSlices=function(){return pe(this,void 0,void 0,function(){var t,r;return he(this,function(n){switch(n.label){case 0:t=0,this.edgeFilter=15,r=this.minZ,n.label=1;case 1:return r<this.maxZ?(this.slice(r),t+=this.sliceSize,this.ctx.shouldUpdate?[4,this.ctx.update({message:"Computing surface...",current:t,max:this.size})]:[3,3]):[3,4];case 2:n.sent(),n.label=3;case 3:return r++,this.edgeFilter&=-5,[3,1];case 4:return[2]}})})},e.prototype.slice=function(t){this.edgeFilter|=2;for(var r=this.minY;r<this.maxY;r++,this.edgeFilter&=-3){this.edgeFilter|=1;for(var n=this.minX;n<this.maxX;n++,this.edgeFilter&=-2)this.state.processCell(n,r,t,this.edgeFilter)}this.state.clearEdgeVertexIndexSlice(t)},e.prototype.run=function(){return pe(this,void 0,void 0,function(){return he(this,function(t){switch(t.label){case 0:return[4,this.doSlices()];case 1:return t.sent(),[2]}})})},e}(),GUe=function(){function e(t,r){this.builder=t,this.vertList=[0,0,0,0,0,0,0,0,0,0,0,0],this.i=0,this.j=0,this.k=0;var n=r.scalarField.space.dimensions;this.nX=n[0],this.nY=n[1],this.nZ=n[2],this.isoLevel=r.isoLevel,this.scalarFieldGet=r.scalarField.space.get,this.scalarField=r.scalarField.data,r.idField&&(this.idField=r.idField.data,this.idFieldGet=r.idField.space.get),this.verticesOnEdges=new Int32Array(3*this.nX*this.nY*2)}return e.prototype.get3dOffsetFromEdgeInfo=function(t){return this.nX*((this.k+t.k)%2*this.nY+this.j+t.j)+this.i+t.i},e.prototype.clearEdgeVertexIndexSlice=function(t){var r=t%2===0?0:3*this.nX*this.nY,n=t%2===0?3*this.nX*this.nY:this.verticesOnEdges.length;this.verticesOnEdges.fill(0,r,n)},e.prototype.interpolate=function(t){var r=UUe[t],n=3*this.get3dOffsetFromEdgeInfo(r)+r.e,a=this.verticesOnEdges[n];if(a>0)return a-1;var i=this.scalarField,o=this.scalarFieldGet,s=zUe[t],u=s.a,l=s.b,c=u.i+this.i,d=u.j+this.j,f=u.k+this.k,p=l.i+this.i,h=l.j+this.j,m=l.k+this.k,v=o(i,c,d,f),g=o(i,p,h,m),y=(this.isoLevel-v)/(v-g);if(this.idField){var b=this.idFieldGet(this.idField,c,d,f),S=this.idFieldGet(this.idField,p,h,m),x=y<.5?b:S;if(x===-1&&(x=y<.5?S:b),x===-2)return-1;this.builder.addGroup(x)}else this.builder.addGroup(0);var C=this.builder.addVertex(c+y*(c-p),d+y*(d-h),f+y*(f-m));this.verticesOnEdges[n]=C+1;var w=o(i,Math.max(0,c-1),d,f)-o(i,Math.min(this.nX-1,c+1),d,f),_=o(i,c,Math.max(0,d-1),f)-o(i,c,Math.min(this.nY-1,d+1),f),E=o(i,c,d,Math.max(0,f-1))-o(i,c,d,Math.min(this.nZ,f+1)),P=o(i,Math.max(0,p-1),h,m)-o(i,Math.min(this.nX-1,p+1),h,m),D=o(i,p,Math.max(0,h-1),m)-o(i,p,Math.min(this.nY-1,h+1),m),k=o(i,p,h,Math.max(0,m-1))-o(i,p,h,Math.min(this.nZ-1,m+1)),F=w+y*(w-P),X=_+y*(_-D),U=E+y*(E-k);return this.isoLevel>=0?this.builder.addNormal(F,X,U):this.builder.addNormal(-F,-X,-U),C},e.prototype.get=function(t,r,n){return this.scalarFieldGet(this.scalarField,t,r,n)},e.prototype.processCell=function(t,r,n,a){var i=0;if(this.get(t,r,n)<this.isoLevel&&(i|=1),this.get(t+1,r,n)<this.isoLevel&&(i|=2),this.get(t+1,r+1,n)<this.isoLevel&&(i|=4),this.get(t,r+1,n)<this.isoLevel&&(i|=8),this.get(t,r,n+1)<this.isoLevel&&(i|=16),this.get(t+1,r,n+1)<this.isoLevel&&(i|=32),this.get(t+1,r+1,n+1)<this.isoLevel&&(i|=64),this.get(t,r+1,n+1)<this.isoLevel&&(i|=128),!(i===0||i===255)){this.i=t,this.j=r,this.k=n;var o=VUe[i];(o&1)>0&&(this.vertList[0]=this.interpolate(0)),(o&2)>0&&(this.vertList[1]=this.interpolate(1)),(o&4)>0&&(this.vertList[2]=this.interpolate(2)),(o&8)>0&&(this.vertList[3]=this.interpolate(3)),(o&16)>0&&(this.vertList[4]=this.interpolate(4)),(o&32)>0&&(this.vertList[5]=this.interpolate(5)),(o&64)>0&&(this.vertList[6]=this.interpolate(6)),(o&128)>0&&(this.vertList[7]=this.interpolate(7)),(o&256)>0&&(this.vertList[8]=this.interpolate(8)),(o&512)>0&&(this.vertList[9]=this.interpolate(9)),(o&1024)>0&&(this.vertList[10]=this.interpolate(10)),(o&2048)>0&&(this.vertList[11]=this.interpolate(11));for(var s=Qv[i],u=0;u<s.length;u+=3){var l=s[u],c=s[u+1],d=s[u+2];this.isoLevel>=0?this.builder.addTriangle(this.vertList,l,c,d,a):this.builder.addTriangle(this.vertList,d,c,l,a)}}},e}();function qUe(e,t,r,n,a,i){var o=xi.getUtils(t),s=o.createValues,u=o.createRenderableState,l=fk(),c=s(t,l,r,n,a),d=u(a);return U0(t.kind,c,d,i)}function Pb(e,t){var r=e.defaultProps,n=e.createGeometry,a=e.createLocationIterator,i=e.getLoci,o=e.eachLocation,s=e.setUpdateState,u=e.mustRecreate,l=e.dispose,c=e.geometryUtils,d=c.updateValues,f=c.updateBoundingSphere,p=c.updateRenderableState,h=c.createPositionIterator,m=lc.create(),v,g,y,b,S=Object.assign({},r),x=Ia.createEmpty(),C,w,_,E;function P(F,X,U){if(!U&&!C)throw new Error("missing volume");if(g=Object.assign({},S,X),y=F,b=U,lc.reset(m),v?(!C||!It.areEquivalent(b,C))&&(m.createNew=!0):m.createNew=!0,m.createNew){m.createGeometry=!0;return}s(m,U,g,S,y,x),xd.areEqual(F.color,x.color)||(m.updateColor=!0),m.createGeometry&&(m.updateColor=!0)}function D(F){if(m.createNew)if(_=a(b),F)v=qUe(b,F,_,y,g,t),E=h(F,v.values);else throw new Error("expected geometry to be given");else{if(!v)throw new Error("expected renderObject to be available");if(_.reset(),m.createGeometry)if(F)N.updateIfChanged(v.values.drawCount,xi.getDrawCount(F)),N.updateIfChanged(v.values.uVertexCount,xi.getVertexCount(F));else throw new Error("expected geometry to be given");(m.updateTransform||m.createGeometry)&&(f(v.values,F||w),E=h(F||w,v.values)),m.updateSize&&"uSize"in v.values&&Dd(_,y.size,v.values),m.updateColor&&Ds(_,E,y.color,v.values),d(v.values,g),p(v.state,g)}S=g,x=y,C=b,F&&(w=F)}function k(F,X){return uu(F)?X(Me.ofBounds(0,_.groupCount*_.instanceCount)):o(F,C,S,X)}return{get groupCount(){return _?_.count:0},get renderObject(){return v},createOrUpdate:function(F,X,U,j){return U===void 0&&(U={}),pe(this,void 0,void 0,function(){var te;return he(this,function(q){return P(X,U,j||C),m.createGeometry?(te=n(F,b,y,g,w),[2,Vk(te)?te.then(D):D(te)]):(D(),[2])})})},getLoci:function(F){return v?i(F,C,S,v.id):zr},mark:function(F,X){return Pr.mark(v,F,X,k)},setVisibility:function(F){Pr.setVisibility(v,F)},setAlphaFactor:function(F){Pr.setAlphaFactor(v,F)},setPickable:function(F){Pr.setPickable(v,F)},setColorOnly:function(F){Pr.setColorOnly(v,F)},setTransform:function(F,X){Pr.setTransform(v,F,X)},setOverpaint:function(F){return Pr.setOverpaint(v,F,k,!0)},setTransparency:function(F){return Pr.setTransparency(v,F,k,!0)},setClipping:function(F){return Pr.setClipping(v,F,k,!0)},destroy:function(){l?.(w),v&&(v.state.disposed=!0,v=void 0)},mustRecreate:u}}T({},Dt.Params);function v3(e,t,r,n,a){var i=0,o=t.webgl,s=new ha,u=Vd(),l=[],c=mr.createState(),d,f,p,h,m=Ia.createEmpty();function v(x,C){var w=this;x===void 0&&(x={}),C&&C!==f&&(p=r(t,C),f=C,h||(h=M.getDefaultValues(p)));var _=eI(Object.assign({},h,x),f);return Object.assign(h,x,_),Qe.create("Creating or updating VolumeRepresentation",function(E){return pe(w,void 0,void 0,function(){var P,D;return he(this,function(k){switch(k.label){case 0:return d?!((D=d.mustRecreate)===null||D===void 0)&&D.call(d,f,h,o)&&(d.destroy(),d=n(u,f,h,o)):d=n(u,f,h,o),P=d.createOrUpdate({webgl:o,runtime:E},m,h,C),P?[4,P]:[3,2];case 1:k.sent(),k.label=2;case 2:return l.length=0,d&&d.renderObject&&l.push(d.renderObject),s.next(i++),[2]}})})})}function g(x,C){return d?d.mark(x,C):!1}function y(x){x.visible!==void 0&&d&&d.setVisibility(x.visible),x.alphaFactor!==void 0&&d&&d.setAlphaFactor(x.alphaFactor),x.pickable!==void 0&&d&&d.setPickable(x.pickable),x.overpaint!==void 0&&d&&d.setOverpaint(x.overpaint),x.transparency!==void 0&&d&&d.setTransparency(x.transparency),x.transform!==void 0&&d&&d.setTransform(x.transform),mr.updateState(c,x)}function b(x){m=x}function S(){d&&d.destroy()}return{label:e,get groupCount(){return d?d.groupCount:0},get props(){return h},get params(){return p},get state(){return c},get theme(){return m},renderObjects:l,updated:s,createOrUpdate:v,setState:y,setTheme:b,getLoci:function(x){return x===void 0?a(f,h):d?d.getLoci(x):zr},mark:g,destroy:S}}var g3=A.set,gQ=A.normalize,yQ=A.sub,bQ=A.addScalar,y3=A.scale,xQ=A.toArray;function fR(e,t,r,n){var a=!1;if(It.isLoci(e)){if(!It.areEquivalent(e.volume,t))return!1;n(Me.ofLength(t.grid.cells.data.length))&&(a=!0)}else if(It.Isosurface.isLoci(e)){if(!It.areEquivalent(e.volume,t))return!1;if(r){if(!It.IsoValue.areSame(e.isoValue,r,t.grid.stats))return!1;n(Me.ofLength(t.grid.cells.data.length))&&(a=!0)}else for(var i=t.grid,o=i.stats,s=i.cells.data,u=o.sigma,l=It.IsoValue.toAbsolute(e.isoValue,o).absoluteValue,c=0,d=s.length;c<d;++c)Hn(l,s[c],u)&&n(Me.ofSingleton(c))&&(a=!0)}else if(It.Cell.isLoci(e)){if(!It.areEquivalent(e.volume,t))return!1;Me.is(e.indices)?n(e.indices)&&(a=!0):Ne.forEach(e.indices,function(f){n(Me.ofSingleton(f))&&(a=!0)})}return a}function Ib(e,t){t===void 0&&(t=0);var r=e[0]*e[1]*e[2],n=Math.sqrt(r),a=Math.pow(2,Math.ceil(Math.log(n)/Math.log(2))),i=e[0]+t,o=e[1]+t,s=1,u=i;return a<i*e[2]?(u=Math.floor(a/i),s=Math.ceil(e[2]/u),i*=u,o*=s):i*=e[2],{width:i,height:o,columns:u,rows:s,powerOfTwoSize:o<a?a:a*2}}function SQ(e,t,r){r===void 0&&(r=0);for(var n=e.grid,a=n.cells,i=a.space,o=a.data,s=n.stats,u=s.max,l=s.min,c=i.dimensions,d=i.dataOffset,f=Ib(c,r),p=f.width,h=f.height,m=t==="data"?1:4,v=new Uint8Array(p*h*m),g={array:v,width:p,height:h},y=u-l,b=c[0],S=c[1],x=c[2],C=b+r,w=S+r,_=A(),E=A(),P=b-1,D=S-1,k=x-1,F=0;F<x;++F)for(var X=0;X<S;++X)for(var U=0;U<b;++U){var j=Math.floor(F*C%p/C),te=Math.floor(F*C/p),q=j*C+U,W=m*(te*w*p+X*p+q),V=d(U,X,F);t==="data"?v[W]=Math.round((o[V]-l)/y*255):(t==="groups"?hb(V,v,W):(g3(_,o[d(Math.max(0,U-1),X,F)],o[d(U,Math.max(0,X-1),F)],o[d(U,X,Math.max(0,F-1))]),g3(E,o[d(Math.min(P,U+1),X,F)],o[d(U,Math.min(D,X+1),F)],o[d(U,X,Math.min(k,F+1))]),gQ(_,yQ(_,_,E)),bQ(_,y3(_,_,.5),.5),xQ(y3(_,_,255),v,W)),v[W+3]=Math.round((o[V]-l)/y*255))}return g}function WUe(e){for(var t=e.grid,r=t.cells,n=r.space,a=r.data,i=t.stats,o=i.max,s=i.min,u=n.dimensions,l=u[0],c=u[1],d=u[2],f=n.dataOffset,p=new Uint8Array(l*c*d*4),h={array:p,width:l,height:c,depth:d},m=o-s,v=A(),g=A(),y=l-1,b=c-1,S=d-1,x=0,C=0;C<d;++C)for(var w=0;w<c;++w)for(var _=0;_<l;++_){var E=f(_,w,C);g3(v,a[f(Math.max(0,_-1),w,C)],a[f(_,Math.max(0,w-1),C)],a[f(_,w,Math.max(0,C-1))]),g3(g,a[f(Math.min(y,_+1),w,C)],a[f(_,Math.min(b,w+1),C)],a[f(_,w,Math.min(S,C+1))]),gQ(v,yQ(v,v,g)),bQ(v,y3(v,v,.5),.5),xQ(y3(v,v,255),p,x),p[x+3]=Math.round((a[E]-s)/m*255),x+=4}return h}var XUe=`
precision highp float;
precision highp int;

#if __VERSION__ == 100
    precision highp sampler2D;
    uniform sampler2D tTexture;
#else
    precision highp isampler2D;
    uniform isampler2D tTexture;
#endif

void main(void) {
    #if __VERSION__ == 100
        gl_FragColor = texture2D(tTexture, vec2(0.5));
    #else
        gl_FragColor = ivec4(texture2D(tTexture, vec2(0.5)).r);
    #endif
}
`,YUe=T(T({},Ni),{tTexture:hr("texture","rgba","float","nearest")}),Zs="histopyramid-sum";function KUe(e,t){if(e.namedComputeRenderables[Zs]){var r=e.namedComputeRenderables[Zs].values;N.update(r.tTexture,t),e.namedComputeRenderables[Zs].update()}else e.namedComputeRenderables[Zs]=$Ue(e,t);return e.namedComputeRenderables[Zs]}function $Ue(e,t){var r=T(T({},zi),{tTexture:N.create(t)}),n=T({},YUe),a=Wn("sum",Yo,XUe,{},{0:"ivec4"}),i=li(e,"triangles",a,n,r);return ui(i,r)}function QUe(e){var t=e.gl,r=e.state;r.disable(t.CULL_FACE),r.disable(t.BLEND),r.disable(t.DEPTH_TEST),r.disable(t.SCISSOR_TEST),r.depthMask(!1),r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,0)}var fx=new Uint8Array(4),UN=new Int32Array(4);function ZUe(e,t){var r=e.gl,n=e.resources,a=KUe(e,t);e.state.currentRenderItemId=-1,e.namedFramebuffers[Zs]||(e.namedFramebuffers[Zs]=n.framebuffer());var i=e.namedFramebuffers[Zs];e.namedTextures[Zs]||(e.namedTextures[Zs]=Dr(r)?n.texture("image-int32","rgba","int","nearest"):n.texture("image-uint8","rgba","ubyte","nearest"),e.namedTextures[Zs].define(1,1));var o=e.namedTextures[Zs];return o.attachFramebuffer(i,0),QUe(e),r.viewport(0,0,1,1),a.render(),r.finish(),e.readPixels(0,0,1,1,Dr(r)?UN:fx),e.unbindFramebuffer(),Dr(r)?UN[0]:uk(fx[0],fx[1],fx[2])}var JUe=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tInputLevel;

// previous level used to evaluate the new level
#if __VERSION__ == 100
    uniform sampler2D tPreviousLevel;
#else
    precision highp isampler2D;
    uniform isampler2D tPreviousLevel;
#endif

// inverted size of the previous level texture.
uniform float uSize;
uniform float uTexSize;
uniform bool uFirst;

#include common

void main(void) {
    float k = 0.5 * uSize;
    vec2 position = floor((gl_FragCoord.xy / uTexSize) / uSize) * uSize;

    #if __VERSION__ == 100
        float a, b, c, d;

        if (uFirst) {
            a = texture2D(tInputLevel, position).r * 255.0;
            b = texture2D(tInputLevel, position + vec2(k, 0.0)).r * 255.0;
            c = texture2D(tInputLevel, position + vec2(0.0, k)).r * 255.0;
            d = texture2D(tInputLevel, position + vec2(k, k)).r * 255.0;
        } else {
            a = decodeFloatRGB(texture2D(tPreviousLevel, position).rgb);
            b = decodeFloatRGB(texture2D(tPreviousLevel, position + vec2(k, 0.0)).rgb);
            c = decodeFloatRGB(texture2D(tPreviousLevel, position + vec2(0.0, k)).rgb);
            d = decodeFloatRGB(texture2D(tPreviousLevel, position + vec2(k, k)).rgb);
        }
        gl_FragColor = vec4(encodeFloatRGB(a + b + c + d), 1.0);
    #else
        int a, b, c, d;

        if (uFirst) {
            a = int(texture2D(tInputLevel, position).r * 255.0);
            b = int(texture2D(tInputLevel, position + vec2(k, 0.0)).r * 255.0);
            c = int(texture2D(tInputLevel, position + vec2(0.0, k)).r * 255.0);
            d = int(texture2D(tInputLevel, position + vec2(k, k)).r * 255.0);
        } else {
            a = texture2D(tPreviousLevel, position).r;
            b = texture2D(tPreviousLevel, position + vec2(k, 0.0)).r;
            c = texture2D(tPreviousLevel, position + vec2(0.0, k)).r;
            d = texture2D(tPreviousLevel, position + vec2(k, k)).r;
        }
        gl_FragColor = ivec4(a + b + c + d);
    #endif
}
`,eVe=T(T({},Ni),{tInputLevel:hr("texture","rgba","float","nearest"),tPreviousLevel:hr("texture","rgba","float","nearest"),uSize:Ye("f"),uTexSize:Ye("f"),uFirst:Ye("b")}),Ch="histogram-pyramid";function tVe(e,t,r){if(e.namedComputeRenderables[Ch]){var n=e.namedComputeRenderables[Ch].values;N.update(n.tInputLevel,t),N.update(n.tPreviousLevel,r),e.namedComputeRenderables[Ch].update()}else e.namedComputeRenderables[Ch]=rVe(e,t,r);return e.namedComputeRenderables[Ch]}function rVe(e,t,r){var n=T(T({},zi),{tInputLevel:N.create(t),tPreviousLevel:N.create(r),uSize:N.create(0),uTexSize:N.create(0),uFirst:N.create(!0)}),a=T({},eVe),i=Wn("reduction",Yo,JUe,{},{0:"ivec4"}),o=li(e,"triangles",i,a,n);return ui(o,n)}var VN=[];function nVe(e,t){var r=VN[t],n=Math.pow(2,t);if(r===void 0){var a=e.isWebGL2?b3("level"+t,e,"image-int32","alpha","int","nearest"):b3("level"+t,e,"image-uint8","rgba","ubyte","nearest");a.define(n,n);var i=CQ("level"+t,e);a.attachFramebuffer(i,0),r={texture:a,framebuffer:i},VN[t]=r}return r}function aVe(e){var t=e.gl,r=e.state;r.disable(t.CULL_FACE),r.disable(t.BLEND),r.disable(t.DEPTH_TEST),r.enable(t.SCISSOR_TEST),r.depthMask(!1),r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,0)}function CQ(e,t){var r=Ch+"-"+e;return t.namedFramebuffers[r]||(t.namedFramebuffers[r]=t.resources.framebuffer()),t.namedFramebuffers[r]}function b3(e,t,r,n,a,i){var o=Ch+"-"+e;return t.namedTextures[o]||(t.namedTextures[o]=t.resources.texture(r,n,a,i)),t.namedTextures[o]}function iVe(e,t,r,n){var a=e.gl,i=t.getWidth(),o=t.getHeight();if(i!==o||!fge(i))throw new Error("inputTexture must be of square power-of-two size");var s=Math.ceil(Math.log(i)/Math.log(2)),u=Math.pow(2,s),l=Math.pow(2,s),c=Math.pow(2,s-1),d=e.isWebGL2?b3("pyramid",e,"image-int32","alpha","int","nearest"):b3("pyramid",e,"image-uint8","rgba","ubyte","nearest");d.define(l,c);var f=CQ("pyramid",e);d.attachFramebuffer(f,0),a.viewport(0,0,l,c),Dr(a)?a.clearBufferiv(a.COLOR,0,[0,0,0,0]):a.clear(a.COLOR_BUFFER_BIT);for(var p=[],h=0;h<s;++h)p.push(nVe(e,h));var m=tVe(e,t,p[0].texture);e.state.currentRenderItemId=-1,aVe(e);for(var v=0,h=0;h<s;h++){var g=s-1-h,y=p[g];y.framebuffer.bind();var b=Math.pow(2,g);N.update(m.values.uSize,Math.pow(2,h+1)/u),N.update(m.values.uTexSize,b),N.updateIfChanged(m.values.uFirst,h===0),h>0&&(N.update(m.values.tPreviousLevel,p[s-h].texture),m.update()),e.state.currentRenderItemId=-1,a.viewport(0,0,b,b),a.scissor(0,0,b,b),Dr(a)?a.clearBufferiv(a.COLOR,0,[0,0,0,0]):a.clear(a.COLOR_BUFFER_BIT),a.scissor(0,0,n[0],n[1]),m.render(),d.bind(0),a.copyTexSubImage2D(a.TEXTURE_2D,0,v,0,0,0,b,b),d.unbind(0),v+=b}a.finish();var S=Math.max(1,ZUe(e,p[0].texture)),x=Math.ceil(S/Math.pow(2,s));return{pyramidTex:d,count:S,height:x,levels:s,scale:r}}var Rg;function oVe(){if(Rg!==void 0)return Rg;Rg=Li(16*16,1,Uint8Array);for(var e=Rg.array,t=0,r=Qv.length;t<r;++t)e[t]=Qv[t].length/3;return Rg}var Og;function sVe(){if(Og!==void 0)return Og;Og=Li(64*64,1,Uint8Array);for(var e=Og.array,t=0,r=Qv.length;t<r;++t)for(var n=0;n<16;++n)n<Qv[t].length?e[t*16+n]=Qv[t][n]:e[t*16+n]=255;return Og}var uVe=`
precision highp float;
precision highp int;
precision highp sampler2D;

#if __VERSION__ == 100
    uniform sampler2D tActiveVoxelsPyramid;
#else
    precision highp isampler2D;
    uniform isampler2D tActiveVoxelsPyramid;
#endif

uniform sampler2D tActiveVoxelsBase;
uniform sampler2D tVolumeData;
uniform sampler2D tTriIndices;

uniform float uIsoValue;
uniform float uLevels;
uniform float uSize;
uniform float uCount;
uniform bool uInvert;

uniform vec3 uGridDim;
uniform vec3 uGridTexDim;
uniform mat4 uGridTransform;

// scale to volume data coord
uniform vec2 uScale;

#include common

// cube corners (excluding origin)
const vec3 c1 = vec3(1., 0., 0.);
const vec3 c2 = vec3(1., 1., 0.);
const vec3 c3 = vec3(0., 1., 0.);
const vec3 c4 = vec3(0., 0., 1.);
const vec3 c5 = vec3(1., 0., 1.);
const vec3 c6 = vec3(1., 1., 1.);
const vec3 c7 = vec3(0., 1., 1.);

vec3 index3dFrom2d(vec2 coord) {
    vec2 gridTexPos = coord * uGridTexDim.xy;
    vec2 columnRow = ivec2Div(gridTexPos, uGridDim.xy);
    vec2 posXY = gridTexPos - columnRow * uGridDim.xy;
    float posZ = columnRow.y * intDiv(uGridTexDim.x, uGridDim.x) + columnRow.x;
    return vec3(posXY, posZ);
}

vec4 texture3dFrom2dNearest(sampler2D tex, vec3 pos, vec3 gridDim, vec2 texDim) {
    float zSlice = floor(pos.z * gridDim.z + 0.5); // round to nearest z-slice
    float column = intDiv(intMod(zSlice * gridDim.x, texDim.x), gridDim.x);
    float row = intDiv(zSlice * gridDim.x, texDim.x);
    vec2 coord = (vec2(column * gridDim.x, row * gridDim.y) + (pos.xy * gridDim.xy)) / (texDim / uScale);
    return texture2D(tex, coord + 0.5 / (texDim / uScale));
}

vec4 voxel(vec3 pos) {
    pos = min(max(vec3(0.0), pos), uGridDim - vec3(1.0));
    return texture3dFrom2dNearest(tVolumeData, pos / uGridDim, uGridDim, uGridTexDim.xy);
}

vec4 voxelPadded(vec3 pos) {
    pos = min(max(vec3(0.0), pos), uGridDim - vec3(vec2(2.0), 1.0)); // remove xy padding
    return texture3dFrom2dNearest(tVolumeData, pos / uGridDim, uGridDim, uGridTexDim.xy);
}

int idot2(const in ivec2 a, const in ivec2 b) {
    return a.x * b.x + a.y * b.y;
}

int idot4(const in ivec4 a, const in ivec4 b) {
    return a.x * b.x + a.y * b.y + a.z * b.z + a.w * b.w;
}

#if __VERSION__ == 100
    int pyramidVoxel(vec2 pos) {
        return int(decodeFloatRGB(texture2D(tActiveVoxelsPyramid, pos / (vec2(1.0, 0.5) * uSize)).rgb));
    }
#else
    int pyramidVoxel(vec2 pos) {
        return texture2D(tActiveVoxelsPyramid, pos / (vec2(1.0, 0.5) * uSize)).r;
    }
#endif

vec4 baseVoxel(vec2 pos) {
    return texture2D(tActiveVoxelsBase, pos / uSize);
}

void main(void) {
    // get 1D index
    int vI = int(gl_FragCoord.x) + int(gl_FragCoord.y) * int(uSize);

    // ignore 1D indices outside of the grid
    if(vI >= int(uCount)) discard;

    ivec2 offset = ivec2(int(uSize) - 2, 0);

    int start = 0;
    ivec4 starts = ivec4(0);
    ivec4 ends = ivec4(0);
    int diff = 2;
    ivec4 m = ivec4(0);
    ivec2 position = ivec2(0);
    ivec4 vI4 = ivec4(vI);

    ivec2 relativePosition = ivec2(0);
    int end = 0;
    ivec2 pos1 = ivec2(0);
    ivec2 pos2 = ivec2(0);
    ivec2 pos3 = ivec2(0);
    ivec2 pos4 = ivec2(0);
    ivec3 vI3 = ivec3(vI);
    ivec3 mask = ivec3(0);

    // traverse the different levels of the pyramid
    for(int i = 1; i < 14; i++) {
        if(float(i) >= uLevels) break;

        offset.x -= diff;
        diff *= 2;
        relativePosition = position + offset;

        end = start + pyramidVoxel(vec2(relativePosition));
        pos1 = ivec2(relativePosition);
        starts.x = start;
        ends.x = end;
        pos2 = ivec2(relativePosition + ivec2(1, 0));
        starts.y = ends.x;
        ends.y = ends.x + pyramidVoxel(vec2(pos2));
        pos3 = relativePosition + ivec2(0, 1);
        starts.z = ends.y;
        ends.z = ends.y + pyramidVoxel(vec2(pos3));
        pos4 = relativePosition + ivec2(1, 1);
        starts.w = ends.z;
        mask = ivec3(greaterThanEqual(vI3, starts.rgb)) * ivec3(lessThan(vI3, ends.rgb));
        m = ivec4(mask, 1 - int(any(bvec3(mask))));

        relativePosition = m.x * pos1 + m.y * pos2 + m.z * pos3 + m.w * pos4;
        start = idot4(m, starts);
        position = 2 * (relativePosition - offset);
    }

    end = start + int(baseVoxel(vec2(position)).r * 255.0);
    pos1 = position;
    starts.x = start;
    ends.x = end;
    pos2 = position + ivec2(1, 0);
    starts.y = ends.x;
    ends.y = ends.x + int(baseVoxel(vec2(pos2)).r * 255.0);
    pos3 = position + ivec2(0, 1);
    starts.z = ends.y;
    ends.z = ends.y + int(baseVoxel(vec2(pos3)).r * 255.0);
    pos4 = position + ivec2(1, 1);
    starts.w = ends.z;
    mask = ivec3(greaterThanEqual(vI3, starts.rgb)) * ivec3(lessThan(vI3, ends.rgb));
    m = ivec4(mask, 1 - int(any(bvec3(mask))));
    position = m.x * pos1 + m.y * pos2 + m.z * pos3 + m.w * pos4;

    vec2 coord2d = (vec2(position) / uSize) / uScale;
    vec3 coord3d = floor(index3dFrom2d(coord2d) + 0.5);

    float edgeIndex = floor(baseVoxel(vec2(position)).a * 255.0 + 0.5);

    // current vertex for the up to 15 MC cases
    int currentVertex = vI - idot4(m, starts);

    // ensure winding-order is the same for negative and positive iso-levels
    if (uInvert) {
        int v = imod(currentVertex + 1, 3);
        if (v == 1) currentVertex += 2;
        else if (v == 0) currentVertex -= 2;
    }

    // get index into triIndices table
    int mcIndex = 16 * int(edgeIndex) + currentVertex;
    vec4 mcData = texture2D(tTriIndices, vec2(imod(mcIndex, 64), mcIndex / 64) / 64.);

    // bit mask to avoid conditionals (see comment below) for getting MC case corner
    vec4 m0 = vec4(floor(mcData.a * 255.0 + 0.5));

    // get edge value masks
    vec4 m1 = vec4(equal(m0, vec4(0., 1., 2., 3.)));
    vec4 m2 = vec4(equal(m0, vec4(4., 5., 6., 7.)));
    vec4 m3 = vec4(equal(m0, vec4(8., 9., 10., 11.)));

    // apply bit masks
    vec3 b0 = coord3d +
                m1.y * c1 +
                m1.z * c2 +
                m1.w * c3 +
                m2.x * c4 +
                m2.y * c5 +
                m2.z * c6 +
                m2.w * c7 +
                m3.y * c1 +
                m3.z * c2 +
                m3.w * c3;
    vec3 b1 = coord3d +
                m1.x * c1 +
                m1.y * c2 +
                m1.z * c3 +
                m2.x * c5 +
                m2.y * c6 +
                m2.z * c7 +
                m2.w * c4 +
                m3.x * c4 +
                m3.y * c5 +
                m3.z * c6 +
                m3.w * c7;

    // the conditionals that are avoided by above bitmasks
    // vec3 b0 = coord3d;
    // vec3 b1 = coord3d;
    // if (mcIndex == 0.0) {
    //     b1 += c1;
    // } else if (mcIndex == 1.0) {
    //     b0 += c1; b1 += c2;
    // } else if (mcIndex == 2.0) {
    //     b0 += c2; b1 += c3;
    // } else if (mcIndex == 3.0) {
    //     b0 += c3;
    // } else if (mcIndex == 4.0) {
    //     b0 += c4; b1 += c5;
    // } else if (mcIndex == 5.0) {
    //     b0 += c5; b1 += c6;
    // } else if (mcIndex == 6.0) {
    //     b0 += c6; b1 += c7;
    // } else if (mcIndex == 7.0) {
    //     b0 += c7; b1 += c4;
    // } else if (mcIndex == 8.0) {
    //     b1 += c4;
    // } else if (mcIndex == 9.0) {
    //     b0 += c1; b1 += c5;
    // } else if (mcIndex == 10.0) {
    //     b0 += c2; b1 += c6;
    // } else if (mcIndex == 11.0) {
    //     b0 += c3; b1 += c7;
    // }
    // b0 = floor(b0 + 0.5);
    // b1 = floor(b1 + 0.5);

    vec4 d0 = voxel(b0);
    vec4 d1 = voxel(b1);

    float v0 = d0.a;
    float v1 = d1.a;

    float t = (uIsoValue - v0) / (v0 - v1);
    gl_FragData[0].xyz = (uGridTransform * vec4(b0 + t * (b0 - b1), 1.0)).xyz;

    // group id
    #if __VERSION__ == 100
        // webgl1 does not support 'flat' interpolation (i.e. no interpolation)
        // so we ensure a constant group id per triangle here
        #ifdef dPackedGroup
            gl_FragData[1] = vec4(voxel(coord3d).rgb, 1.0);
        #else
            vec3 gridDim = uGridDim - vec3(1.0, 1.0, 0.0); // remove xy padding
            float group = coord3d.z + coord3d.y * gridDim.z + coord3d.x * gridDim.z * gridDim.y;
            gl_FragData[1] = vec4(group > 16777215.5 ? vec3(1.0) : encodeFloatRGB(group), 1.0);
        #endif
    #else
        #ifdef dPackedGroup
            gl_FragData[1] = vec4(t < 0.5 ? d0.rgb : d1.rgb, 1.0);
        #else
            vec3 b = t < 0.5 ? b0 : b1;
            vec3 gridDim = uGridDim - vec3(1.0, 1.0, 0.0); // remove xy padding
            float group = b.z + b.y * gridDim.z + b.x * gridDim.z * gridDim.y;
            gl_FragData[1] = vec4(group > 16777215.5 ? vec3(1.0) : encodeFloatRGB(group), 1.0);
        #endif
    #endif

    // normals from gradients
    vec3 n0 = -normalize(vec3(
        voxelPadded(b0 - c1).a - voxelPadded(b0 + c1).a,
        voxelPadded(b0 - c3).a - voxelPadded(b0 + c3).a,
        voxelPadded(b0 - c4).a - voxelPadded(b0 + c4).a
    ));
    vec3 n1 = -normalize(vec3(
        voxelPadded(b1 - c1).a - voxelPadded(b1 + c1).a,
        voxelPadded(b1 - c3).a - voxelPadded(b1 + c3).a,
        voxelPadded(b1 - c4).a - voxelPadded(b1 + c4).a
    ));
    gl_FragData[2].xyz = -vec3(
        n0.x + t * (n0.x - n1.x),
        n0.y + t * (n0.y - n1.y),
        n0.z + t * (n0.z - n1.z)
    );

    // ensure normal-direction is the same for negative and positive iso-levels
    if (uInvert) {
        gl_FragData[2].xyz *= -1.0;
    }

    // apply normal matrix
    gl_FragData[2].xyz *= transpose3(inverse3(mat3(uGridTransform)));
}
`,lVe=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tTriCount;
uniform sampler2D tVolumeData;

uniform float uIsoValue;
uniform vec3 uGridDim;
uniform vec3 uGridTexDim;
uniform vec2 uScale;

#include common

// cube corners (excluding origin)
const vec3 c1 = vec3(1., 0., 0.);
const vec3 c2 = vec3(1., 1., 0.);
const vec3 c3 = vec3(0., 1., 0.);
const vec3 c4 = vec3(0., 0., 1.);
const vec3 c5 = vec3(1., 0., 1.);
const vec3 c6 = vec3(1., 1., 1.);
const vec3 c7 = vec3(0., 1., 1.);

vec3 index3dFrom2d(vec2 coord) {
    vec2 gridTexPos = coord * uGridTexDim.xy;
    vec2 columnRow = ivec2Div(gridTexPos, uGridDim.xy);
    vec2 posXY = gridTexPos - columnRow * uGridDim.xy;
    float posZ = columnRow.y * intDiv(uGridTexDim.x, uGridDim.x) + columnRow.x;
    return vec3(posXY, posZ);
}

vec4 texture3dFrom2dNearest(sampler2D tex, vec3 pos, vec3 gridDim, vec2 texDim) {
    float zSlice = floor(pos.z * gridDim.z + 0.5); // round to nearest z-slice
    float column = intDiv(intMod(zSlice * gridDim.x, texDim.x), gridDim.x);
    float row = intDiv(zSlice * gridDim.x, texDim.x);
    vec2 coord = (vec2(column * gridDim.x, row * gridDim.y) + (pos.xy * gridDim.xy)) / (texDim / uScale);
    return texture2D(tex, coord);
}

vec4 voxel(vec3 pos) {
    pos = min(max(vec3(0.0), pos), uGridDim - vec3(1.0));
    return texture3dFrom2dNearest(tVolumeData, pos / uGridDim, uGridDim, uGridTexDim.xy);
}

void main(void) {
    vec2 uv = gl_FragCoord.xy / uGridTexDim.xy;
    vec3 posXYZ = index3dFrom2d(uv);

    // get MC case as the sum of corners that are below the given iso level
    float c = step(voxel(posXYZ).a, uIsoValue)
        + 2. * step(voxel(posXYZ + c1).a, uIsoValue)
        + 4. * step(voxel(posXYZ + c2).a, uIsoValue)
        + 8. * step(voxel(posXYZ + c3).a, uIsoValue)
        + 16. * step(voxel(posXYZ + c4).a, uIsoValue)
        + 32. * step(voxel(posXYZ + c5).a, uIsoValue)
        + 64. * step(voxel(posXYZ + c6).a, uIsoValue)
        + 128. * step(voxel(posXYZ + c7).a, uIsoValue);
    c *= step(c, 254.);

    // handle out of bounds positions
    posXYZ += 1.0;
    posXYZ.xy += 1.0; // pixel padding (usually ok even if the texture has no padding)
    if (posXYZ.x >= uGridDim.x || posXYZ.y >= uGridDim.y || posXYZ.z >= uGridDim.z)
        c = 0.0;

    // get total triangles to generate for calculated MC case from triCount texture
    float totalTrianglesToGenerate = texture2D(tTriCount, vec2(intMod(c, 16.), floor(c / 16.)) / 16.).a;
    gl_FragColor = vec4(vec3(totalTrianglesToGenerate * 3.0), c / 255.0);
}
`,cVe=T(T({},Ni),{tTriCount:hr("image-uint8","alpha","ubyte","nearest"),tVolumeData:hr("texture","rgba","ubyte","nearest"),uIsoValue:Ye("f"),uGridDim:Ye("v3"),uGridTexDim:Ye("v3"),uScale:Ye("v2")}),Nu="active-voxels";function dVe(e,t,r,n,a,i){if(e.namedComputeRenderables[Nu]){var o=e.namedComputeRenderables[Nu].values;N.update(o.uQuadScale,i),N.update(o.tVolumeData,t),N.updateIfChanged(o.uIsoValue,a),N.update(o.uGridDim,r),N.update(o.uGridTexDim,n),N.update(o.uScale,i),e.namedComputeRenderables[Nu].update()}else e.namedComputeRenderables[Nu]=fVe(e,t,r,n,a,i);return e.namedComputeRenderables[Nu]}function fVe(e,t,r,n,a,i){var o=T(T({},zi),{tTriCount:N.create(oVe()),uQuadScale:N.create(i),tVolumeData:N.create(t),uIsoValue:N.create(a),uGridDim:N.create(r),uGridTexDim:N.create(n),uScale:N.create(i)}),s=T({},cVe),u=Wn("active-voxels",Yo,lVe),l=li(e,"triangles",u,s,o);return ui(l,o)}function pVe(e){var t=e.gl,r=e.state;r.disable(t.CULL_FACE),r.disable(t.BLEND),r.disable(t.DEPTH_TEST),r.enable(t.SCISSOR_TEST),r.depthMask(!1),r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,0)}function hVe(e,t,r,n,a,i){var o=e.gl,s=e.resources,u=t.getWidth(),l=t.getHeight();e.namedFramebuffers[Nu]||(e.namedFramebuffers[Nu]=s.framebuffer());var c=e.namedFramebuffers[Nu];c.bind(),e.namedTextures[Nu]||(e.namedTextures[Nu]=s.texture("image-uint8","rgba","ubyte","nearest"));var d=e.namedTextures[Nu];d.define(u,l);var f=dVe(e,t,r,n,a,i);return e.state.currentRenderItemId=-1,d.attachFramebuffer(c,0),pVe(e),o.viewport(0,0,u,l),o.scissor(0,0,u,l),o.clear(o.COLOR_BUFFER_BIT),o.scissor(0,0,n[0],n[1]),f.render(),o.finish(),d}var mVe=T(T({},Ni),{tTriIndices:hr("image-uint8","alpha","ubyte","nearest"),tActiveVoxelsPyramid:hr("texture","rgba","float","nearest"),tActiveVoxelsBase:hr("texture","rgba","float","nearest"),tVolumeData:hr("texture","rgba","ubyte","nearest"),uIsoValue:Ye("f"),uSize:Ye("f"),uLevels:Ye("f"),uCount:Ye("f"),uInvert:Ye("b"),uGridDim:Ye("v3"),uGridTexDim:Ye("v3"),uGridTransform:Ye("m4"),uScale:Ye("v2"),dPackedGroup:nr("boolean")}),Lf="isosurface";function vVe(e,t,r,n,a,i,o,s,u,l,c,d,f){if(e.namedComputeRenderables[Lf]){var p=e.namedComputeRenderables[Lf].values;N.update(p.tActiveVoxelsPyramid,t),N.update(p.tActiveVoxelsBase,r),N.update(p.tVolumeData,n),N.updateIfChanged(p.uIsoValue,s),N.updateIfChanged(p.uSize,Math.pow(2,u)),N.updateIfChanged(p.uLevels,u),N.updateIfChanged(p.uCount,c),N.updateIfChanged(p.uInvert,d),N.update(p.uGridDim,a),N.update(p.uGridTexDim,i),N.update(p.uGridTransform,o),N.update(p.uScale,l),N.update(p.dPackedGroup,f),e.namedComputeRenderables[Lf].update()}else e.namedComputeRenderables[Lf]=gVe(e,t,r,n,a,i,o,s,u,l,c,d,f);return e.namedComputeRenderables[Lf]}function gVe(e,t,r,n,a,i,o,s,u,l,c,d,f){var p=T(T({},zi),{tTriIndices:N.create(sVe()),tActiveVoxelsPyramid:N.create(t),tActiveVoxelsBase:N.create(r),tVolumeData:N.create(n),uIsoValue:N.create(s),uSize:N.create(Math.pow(2,u)),uLevels:N.create(u),uCount:N.create(c),uInvert:N.create(d),uGridDim:N.create(a),uGridTexDim:N.create(i),uGridTransform:N.create(o),uScale:N.create(l),dPackedGroup:N.create(f)}),h=T({},mVe),m=Wn("isosurface",Yo,uVe,{drawBuffers:"required"}),v=li(e,"triangles",m,h,p);return ui(v,p)}function yVe(e){var t=e.gl,r=e.state;r.disable(t.CULL_FACE),r.disable(t.BLEND),r.disable(t.DEPTH_TEST),r.disable(t.SCISSOR_TEST),r.depthMask(!1),r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,0)}function bVe(e,t,r,n,a,i,o,s,u,l,c,d,f){var p=e.gl,h=e.resources,m=e.extensions,v=n.pyramidTex,g=n.height,y=n.levels,b=n.scale,S=n.count,x=v.getWidth();e.namedFramebuffers[Lf]||(e.namedFramebuffers[Lf]=h.framebuffer());var C=e.namedFramebuffers[Lf];Dr(p)?(c||(c=m.colorBufferHalfFloat&&m.textureHalfFloat?h.texture("image-float16","rgba","fp16","nearest"):h.texture("image-float32","rgba","float","nearest")),d||(d=h.texture("image-uint8","rgba","ubyte","nearest")),f||(f=m.colorBufferHalfFloat&&m.textureHalfFloat?h.texture("image-float16","rgba","fp16","nearest"):h.texture("image-float32","rgba","float","nearest"))):(c||(c=h.texture("image-float32","rgba","float","nearest")),d||(d=h.texture("image-float32","rgba","float","nearest")),f||(f=h.texture("image-float32","rgba","float","nearest"))),c.define(x,g),d.define(x,g),f.define(x,g),c.attachFramebuffer(C,0),d.attachFramebuffer(C,1),f.attachFramebuffer(C,2);var w=vVe(e,v,t,r,a,i,o,s,y,b,S,u,l);e.state.currentRenderItemId=-1;var _=e.extensions.drawBuffers;if(!_)throw new Error("need WebGL draw buffers");return C.bind(),_.drawBuffers([_.COLOR_ATTACHMENT0,_.COLOR_ATTACHMENT1,_.COLOR_ATTACHMENT2]),yVe(e),p.viewport(0,0,x,g),p.clear(p.COLOR_BUFFER_BIT),w.render(),p.finish(),{vertexTexture:c,groupTexture:d,normalTexture:f,vertexCount:S}}function pR(e,t,r,n,a,i,o,s,u,l,c,d){var f=hVe(e,t,r,n,o,a),p=iVe(e,f,a,n),h=bVe(e,f,t,p,r,n,i,o,s,u,l,c,d);return h}var wQ={isoValue:It.IsoValueParam};function xVe(e){return e.extensions.colorBufferFloat&&e.extensions.textureFloat&&e.extensions.drawBuffers}var oy=1;function hR(e,t){var r=e.grid.cells.space.dimensions,n=Ib(r,oy).powerOfTwoSize;return n<=t.maxTextureSize/2}function SVe(e,t,r,n){return r.tryUseGpu&&n&&xVe(n)&&hR(t,n)?AVe(e):wVe(e)}function HN(e,t){return It.Isosurface.Loci(e,t.isoValue)}function mR(e,t,r,n){var a=e.objectId,i=e.groupId;return n===a?It.Cell.Loci(t,Me.ofSingleton(i)):zr}function vR(e,t,r,n){return fR(e,t,r.isoValue,n)}function CVe(e,t,r,n,a){return pe(this,void 0,void 0,function(){var i,o,s;return he(this,function(u){switch(u.label){case 0:return e.runtime.update({message:"Marching cubes..."}),i=pu(new Int32Array(t.grid.cells.data.length)),[4,I_({isoLevel:It.IsoValue.toAbsolute(n.isoValue,t.grid.stats).absoluteValue,scalarField:t.grid.cells,idField:Rr.create(t.grid.cells.space,Rr.Data1(i))},a).runAsChild(e.runtime)];case 1:return o=u.sent(),s=qi.getGridToCartesianTransform(t.grid),Wt.transform(o,s),e.webgl&&!e.webgl.isWebGL2&&Wt.uniformTriangleGroup(o,!1),o.setBoundingSphere(It.getBoundingSphere(t)),[2,o]}})})}var gR=T(T(T(T({},Wt.Params),il.Params),wQ),{quality:T(T({},Wt.Params.quality),{isEssential:!1}),tryUseGpu:M.Boolean(!0)});function wVe(e){return Pb({defaultProps:M.getDefaultValues(gR),createGeometry:CVe,createLocationIterator:function(t){return Tn(t.grid.cells.data.length,1,1,function(){return ws})},getLoci:mR,eachLocation:vR,setUpdateState:function(t,r,n,a){It.IsoValue.areSame(n.isoValue,a.isoValue,r.grid.stats)||(t.createGeometry=!0)},geometryUtils:Wt.Utils,mustRecreate:function(t,r,n){return r.tryUseGpu&&!!n&&hR(t,n)}},e)}var wI;(function(e){var t="volume-isosurface-texture";e.descriptor=vu({name:t});function r(n,a){var i=a.resources,o=qi.getGridToCartesianTransform(n.grid),s=A.clone(n.grid.cells.space.dimensions),u=Ib(s,oy),l=u.width,c=u.height,d=u.powerOfTwoSize,f=A.create(l,c,0),p=Xe.create(l/d,c/d);if(d>a.maxTextureSize/2)throw new Error("volume too large for gpu isosurface extraction");if(!n._propertyData[t]){n._propertyData[t]=i.texture("image-uint8","alpha","ubyte","linear");var h=n._propertyData[t];h.define(d,d),h.load(SQ(n,"data",oy),!0),n.customProperties.add(e.descriptor),n.customProperties.assets(e.descriptor,[{dispose:function(){return h.destroy()}}])}return s[0]+=oy,s[1]+=oy,{texture:n._propertyData[t],transform:o,gridDimension:s,gridTexDim:f,gridTexScale:p}}e.get=r})(wI||(wI={}));function _Ve(e,t,r,n,a){return pe(this,void 0,void 0,function(){var i,o,s,u,l,c,d,f,p,h,m,v,g,y,b;return he(this,function(S){if(!e.webgl)throw new Error("webgl context required to create volume isosurface texture-mesh");return i=t.grid.stats,o=i.max,s=i.min,u=o-s,l=It.IsoValue.toAbsolute(n.isoValue,t.grid.stats).absoluteValue,c=(l-s)/u,d=wI.get(t,e.webgl),f=d.texture,p=d.gridDimension,h=d.gridTexDim,m=d.gridTexScale,v=d.transform,g=a?.doubleBuffer.get(),y=pR(e.webgl,f,p,h,m,v,c,l<0,!1,g?.vertex,g?.group,g?.normal),b=il.create(y.vertexCount,1,y.vertexTexture,y.groupTexture,y.normalTexture,It.getBoundingSphere(t),a),[2,b]})})}function AVe(e){return Pb({defaultProps:M.getDefaultValues(gR),createGeometry:_Ve,createLocationIterator:function(t){return Tn(t.grid.cells.data.length,1,1,function(){return ws})},getLoci:mR,eachLocation:vR,setUpdateState:function(t,r,n,a){It.IsoValue.areSame(n.isoValue,a.isoValue,r.grid.stats)||(t.createGeometry=!0)},geometryUtils:il.Utils,mustRecreate:function(t,r,n){return!r.tryUseGpu||!n||!hR(t,n)},dispose:function(t){t.vertexTexture.ref.value.destroy(),t.groupTexture.ref.value.destroy(),t.normalTexture.ref.value.destroy(),t.doubleBuffer.destroy()}},e)}function TVe(e,t,r,n,a){return pe(this,void 0,void 0,function(){var i,o,s;return he(this,function(u){switch(u.label){case 0:return e.runtime.update({message:"Marching cubes..."}),i=pu(new Int32Array(t.grid.cells.data.length)),[4,dR({isoLevel:It.IsoValue.toAbsolute(n.isoValue,t.grid.stats).absoluteValue,scalarField:t.grid.cells,idField:Rr.create(t.grid.cells.space,Rr.Data1(i))},a).runAsChild(e.runtime)];case 1:return o=u.sent(),s=qi.getGridToCartesianTransform(t.grid),Mn.transform(o,s),o.setBoundingSphere(It.getBoundingSphere(t)),[2,o]}})})}var _Q=T(T(T({},Mn.Params),wQ),{quality:T(T({},Mn.Params.quality),{isEssential:!1}),sizeFactor:M.Numeric(3,{min:0,max:10,step:.1})});function EVe(e){return Pb({defaultProps:M.getDefaultValues(_Q),createGeometry:TVe,createLocationIterator:function(t){return Tn(t.grid.cells.data.length,1,1,function(){return ws})},getLoci:mR,eachLocation:vR,setUpdateState:function(t,r,n,a){It.IsoValue.areSame(n.isoValue,a.isoValue,r.grid.stats)||(t.createGeometry=!0)},geometryUtils:Mn.Utils},e)}var AQ={solid:function(e,t){return v3("Isosurface mesh",e,t,SVe,HN)},wireframe:function(e,t){return v3("Isosurface wireframe",e,t,EVe,HN)}},TQ=T(T(T({},gR),_Q),{visuals:M.MultiSelect(["solid"],M.objectToOptions(AQ))});function PVe(e,t){var r=M.clone(TQ);return r.isoValue=It.createIsoValueParam(It.IsoValue.relative(2),t.grid.stats),r}function IVe(e,t){return mr.createMulti("Isosurface",e,t,mr.StateBuilder,AQ)}var MVe={name:"isosurface",label:"Isosurface",description:"Displays a triangulated isosurface of volumetric data.",factory:IVe,getParams:PVe,defaultValues:M.getDefaultValues(TQ),defaultColorTheme:{name:"uniform"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return!It.isEmpty(e)}};function DVe(e,t,r,n,a){return pe(this,void 0,void 0,function(){var i,o,s,u,l,c,d,f,p,h,m,v,g,y,b,S,x,C,w,_,E,P,D,k,F,X,U,j,te,q,W,V,ee,ue,$,Q,R,Y;return he(this,function(re){for(i=n.dimension.name,o=n.isoValue,s=t.grid.cells,u=s.space,l=s.data,c=t.grid.stats,d=c.min,f=c.max,p=It.IsoValue.toAbsolute(o,t.grid.stats).absoluteValue,h=r.color.color(ws,!1),m=vt.toRgbNormalized(h),v=m[0],g=m[1],y=m[2],b=yR(t.grid,n),S=b.width,x=b.height,C=b.x,w=b.y,_=b.z,E=b.x0,P=b.y0,D=b.z0,k=b.nx,F=b.ny,X=b.nz,U=new Float32Array(i==="x"?[C,0,0,C,w,0,C,0,_,C,w,_]:i==="y"?[0,w,0,C,w,0,0,w,_,C,w,_]:[0,0,_,0,w,_,C,0,_,C,w,_]),j=new Uint8Array(S*x*4),te=kVe(t.grid,n),q=0,W=P;W<F;++W)for(V=E;V<k;++V)for(ee=D;ee<X;++ee)ue=u.get(l,V,W,ee),$=(ue-d)/(f-d),j[q]=v*$*2*255,j[q+1]=g*$*2*255,j[q+2]=y*$*2*255,j[q+3]=ue>=p?255:0,q+=4;return Q={width:S,height:x,array:j,flipY:!0},R={width:S,height:x,array:te,flipY:!0},Y=qi.getGridToCartesianTransform(t.grid),am(Y,U,0,4),[2,yd.create(Q,U,R,a)]})})}function yR(e,t){var r=t.dimension,n=r.name,a=r.params,i=e.cells.space,o,s,u,l,c,d=0,f=0,p=0,h=i.dimensions,m=h[0],v=h[1],g=h[2];return n==="x"?(u=a,l=v-1,c=g-1,o=g,s=v,d=u,m=d+1):n==="y"?(u=m-1,l=a,c=g-1,o=g,s=m,f=l,v=f+1):(u=m-1,l=v-1,c=a,o=m,s=v,p=c,g=p+1),{width:o,height:s,x:u,y:l,z:c,x0:d,y0:f,z0:p,nx:m,ny:v,nz:g}}function kVe(e,t){for(var r=e.cells.space,n=yR(e,t),a=n.width,i=n.height,o=n.x0,s=n.y0,u=n.z0,l=n.nx,c=n.ny,d=n.nz,f=new Uint8Array(a*i*4),p=0,h=s;h<c;++h)for(var m=o;m<l;++m)for(var v=u;v<d;++v)hb(r.dataOffset(m,h,v),f,p),p+=4;return f}function RVe(e,t){for(var r=e.cells.space,n=yR(e,t),a=n.width,i=n.height,o=n.x0,s=n.y0,u=n.z0,l=n.nx,c=n.ny,d=n.nz,f=new Uint32Array(a*i),p=0,h=s;h<c;++h)for(var m=o;m<l;++m)for(var v=u;v<d;++v)f[p]=r.dataOffset(m,h,v),p+=1;return f}function OVe(e,t){var r=RVe(e.grid,t);return It.Cell.Loci(e,nt.ofUnsortedArray(r))}function BVe(e,t,r,n){var a=e.objectId,i=e.groupId;return n===a?It.Cell.Loci(t,Me.ofSingleton(i)):zr}function FVe(e,t,r,n){return fR(e,t,void 0,n)}var bR=T(T({},yd.Params),{quality:T(T({},yd.Params.quality),{isEssential:!1}),dimension:M.MappedStatic("x",{x:M.Numeric(0,{min:0,max:0,step:1}),y:M.Numeric(0,{min:0,max:0,step:1}),z:M.Numeric(0,{min:0,max:0,step:1})},{isEssential:!0}),isoValue:It.IsoValueParam});function LVe(e,t){var r=M.clone(bR),n=t.grid.cells.space.dimensions;return r.dimension=M.MappedStatic("x",{x:M.Numeric(0,{min:0,max:n[0]-1,step:1}),y:M.Numeric(0,{min:0,max:n[1]-1,step:1}),z:M.Numeric(0,{min:0,max:n[2]-1,step:1})},{isEssential:!0}),r.isoValue=It.createIsoValueParam(It.IsoValue.absolute(t.grid.stats.min),t.grid.stats),r}function NVe(e){return Pb({defaultProps:M.getDefaultValues(bR),createGeometry:DVe,createLocationIterator:function(t){return Tn(t.grid.cells.data.length,1,1,function(){return ws})},getLoci:BVe,eachLocation:FVe,setUpdateState:function(t,r,n,a,i,o){t.createGeometry=n.dimension.name!==a.dimension.name||n.dimension.params!==a.dimension.params||!It.IsoValue.areSame(n.isoValue,a.isoValue,r.grid.stats)||!xd.areEqual(i.color,o.color)},geometryUtils:T(T({},yd.Utils),{createRenderableState:function(t){var r=yd.Utils.createRenderableState(t);return jN(r,t),r},updateRenderableState:jN})},e)}function jN(e,t){yd.Utils.updateRenderableState(e,t),e.opaque=!1,e.writeDepth=!0}function zVe(e,t){return v3("Slice",e,t,NVe,OVe)}var UVe={name:"slice",label:"Slice",description:"Slice of volume rendered as image with interpolation.",factory:zVe,getParams:LVe,defaultValues:M.getDefaultValues(bR),defaultColorTheme:{name:"uniform"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return!It.isEmpty(e)}};function EQ(e,t){var r=tr();return tr.add(r,e),tr.transform(r,r,t),r}function VVe(e,t,r,n){var a=r.grid.cells.space.dimensions,i=Ib(a),o=i.width,s=i.height;if(Math.max(o,s)>t.maxTextureSize/2)throw new Error("volume too large for direct-volume rendering");var u=SQ(r,"normals"),l=qi.getGridToCartesianTransform(r.grid),c=EQ(a,l),d=n?n.gridTexture.ref.value:t.resources.texture("image-uint8","rgba","ubyte","linear");d.load(u);var f=PQ(r.grid),p=f.unitToCartn,h=f.cellDim;return bo.create(c,a,l,p,h,d,r.grid.stats,!1,n)}function PQ(e){if(e.transform.kind==="matrix")return{unitToCartn:de.mul(de(),e.transform.matrix,de.fromScaling(de(),e.cells.space.dimensions)),cellDim:de.getScaling(A(),e.transform.matrix)};var t=e.transform.fractionalBox,r=tr.size(A(),t);return{unitToCartn:de.mul3(de(),e.transform.cell.fromFractional,de.fromTranslation(de(),t.min),de.fromScaling(de(),r)),cellDim:A.div(A(),e.transform.cell.size,e.cells.space.dimensions)}}function HVe(e,t,r,n){var a=r.grid.cells.space.dimensions;if(Math.max.apply(Math,a)>t.max3dTextureSize/2)throw new Error("volume too large for direct-volume rendering");var i=WUe(r),o=qi.getGridToCartesianTransform(r.grid),s=EQ(a,o),u=n?n.gridTexture.ref.value:t.resources.texture("volume-uint8","rgba","ubyte","linear");u.load(i);var l=PQ(r.grid),c=l.unitToCartn,d=l.cellDim;return bo.create(s,a,o,c,d,u,r.grid.stats,!1,n)}function jVe(e,t,r,n,a){return pe(this,void 0,void 0,function(){var i,o;return he(this,function(s){if(i=e.runtime,o=e.webgl,o===void 0)throw new Error("DirectVolumeVisual requires `webgl` in props");return[2,o.isWebGL2?HVe(i,o,t,a):VVe(i,o,t,a)]})})}function GVe(e,t){return t.renderMode.name==="isosurface"?It.Isosurface.Loci(e,t.renderMode.params.isoValue):It.Loci(e)}function qVe(e,t,r,n){var a=e.objectId,i=e.groupId;return n===a?It.Cell.Loci(t,Me.ofSingleton(i)):zr}function WVe(e,t,r,n){var a=r.renderMode.name==="isosurface"?r.renderMode.params.isoValue:void 0;return fR(e,t,a,n)}var xR=T(T({},bo.Params),{quality:T(T({},bo.Params.quality),{isEssential:!1})});function XVe(e,t){var r=M.clone(xR);return r.renderMode=bo.createRenderModeParam(t.grid.stats),r}function YVe(e){return Pb({defaultProps:M.getDefaultValues(xR),createGeometry:jVe,createLocationIterator:function(t){return Tn(t.grid.cells.data.length,1,1,function(){return ws})},getLoci:qVe,eachLocation:WVe,setUpdateState:function(t,r,n,a){},geometryUtils:bo.Utils,dispose:function(t){t.gridTexture.ref.value.destroy()}},e)}function KVe(e,t){return v3("Direct Volume",e,t,YVe,GVe)}var $Ve={name:"direct-volume",label:"Direct Volume",description:"Direct rendering of volumetric data.",factory:KVe,getParams:XVe,defaultValues:M.getDefaultValues(xR),defaultColorTheme:{name:"uniform"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return!It.isEmpty(e)}},x3=function(e){Le(t,e);function t(){var r=e.call(this)||this;return rl(t.BuiltIn,function(n,a){if(n.name!==a)throw new Error("Fix BuiltInVolumeRepresentations to have matching names. "+n.name+" "+a);r.add(n)}),r}return t}(IK);(function(e){e.BuiltIn={isosurface:MVe,slice:UVe,"direct-volume":$Ve}})(x3||(x3={}));function GN(e,t,r,n){e.push({source:t==="em"?{name:"em",params:{isoValue:It.IsoValue.absolute(n||0)}}:{name:"x-ray",params:{}},dataId:r})}var _I=jo.build({display:{name:"Volume Streaming"},from:be.Molecule.Structure,params:function(e,t){var r=RUe(e&&e.data),n=FUe(r,e&&e.data);return{method:M.Select(r,[["em","EM"],["x-ray","X-Ray"]]),entries:M.ObjectList({id:M.Text(n[0]||"")},function(a){var i=a.id;return i},{defaultValue:n.map(function(a){return{id:a}})}),defaultView:M.Select(r==="em"?"cell":"selection-box",Qi.ViewTypeOptions),options:M.Group({serverUrl:M.Text(t.config.get(Qn.VolumeStreaming.DefaultServer)||"https://ds.litemol.org"),behaviorRef:M.Text("",{isHidden:!0}),emContourProvider:M.Select("emdb",[["emdb","EMDB"],["pdbe","PDBe"]],{isHidden:!0}),channelParams:M.Value({},{isHidden:!0})})}},isApplicable:function(e,t,r){var n=r.config.get(Qn.VolumeStreaming.CanStream);return n?n(e.data,r):e.data.models.length===1&&rr.probablyHasDensityMap(e.data.models[0])}})(function(e,t){var r=e.ref,n=e.state,a=e.params;return Qe.create("Volume Streaming",function(i){return pe(void 0,void 0,void 0,function(){var o,s,u,l,c,d,f,p,h,m,v,g,y,b,S,x,C;return he(this,function(w){switch(w.label){case 0:o=[],s=0,u=a.entries.length,w.label=1;case 1:return s<u?(l=a.entries[s].id.toLowerCase(),c=void 0,a.method!=="em"?[3,14]:l.toUpperCase().startsWith("EMD")?[3,11]:[4,i.update("Getting EMDB info...")]):[3,16];case 2:return w.sent(),[4,NUe(t,i,l)];case 3:d=w.sent(),f=0,p=d.length,w.label=4;case 4:if(!(f<p))return[3,10];h=d[f],m=void 0,w.label=5;case 5:return w.trys.push([5,7,,8]),[4,zN(a.options.emContourProvider,t,i,h)];case 6:return m=w.sent(),[3,8];case 7:return v=w.sent(),console.info("Could not get map info for "+h+": "+v),[3,9];case 8:GN(o,a.method,h,m||0),w.label=9;case 9:return++f,[3,4];case 10:return[3,15];case 11:return w.trys.push([11,13,,14]),[4,zN(a.options.emContourProvider,t,i,l)];case 12:return c=w.sent(),[3,14];case 13:return g=w.sent(),console.info("Could not get map info for "+l+": "+g),[3,15];case 14:GN(o,a.method,l,c||0),w.label=15;case 15:return++s,[3,1];case 16:return y=n.build().to(r).applyOrUpdateTagged(Qi.RootTag,JVe,{serverUrl:a.options.serverUrl,entries:o}),[4,y.commit()];case 17:return w.sent(),b=y.selector,b.isOk?(S=n.tree.children.get(b.ref),S?.size>0?[4,t.managers.structure.hierarchy.remove(S?.toArray())]:[3,19]):[2];case 18:w.sent(),w.label=19;case 19:return x=b.cell.obj,C=n.build().to(y.ref).apply(SR,M.getDefaultValues(Qi.createParams({data:x.data,defaultView:a.defaultView,channelParams:a.options.channelParams})),{ref:a.options.behaviorRef?a.options.behaviorRef:void 0}),a.method==="em"?C.apply(px,{channel:"em"},{state:{isGhost:!0},tags:"em"}):(C.apply(px,{channel:"2fo-fc"},{state:{isGhost:!0},tags:"2fo-fc"}),C.apply(px,{channel:"fo-fc(+ve)"},{state:{isGhost:!0},tags:"fo-fc(+ve)"}),C.apply(px,{channel:"fo-fc(-ve)"},{state:{isGhost:!0},tags:"fo-fc(-ve)"})),[4,n.updateTree(C).runInContext(i)];case 20:return w.sent(),[2]}})})})}),QVe=jo.build({display:{name:"Boxify Volume Streaming",description:"Make the current box permanent."},from:Qi,isApplicable:function(e){return e.data.params.entry.params.view.name==="selection-box"}})(function(e,t){var r=e.a,n=e.ref,a=e.state,i=r.data.params;if(i.entry.params.view.name==="selection-box"){var o=tr.create(A.clone(i.entry.params.view.params.bottomLeft),A.clone(i.entry.params.view.params.topRight)),s=i.entry.params.view.params.radius;tr.expand(o,o,A.create(s,s,s));var u=T(T({},i),{entry:{name:i.entry.name,params:T(T({},i.entry.params),{view:{name:"box",params:{bottomLeft:o.min,topRight:o.max}}})}});return a.updateTree(a.build().to(n).update(u))}}),ZVe={dataId:M.Text(""),source:M.MappedStatic("x-ray",{em:M.Group({isoValue:It.createIsoValueParam(It.IsoValue.relative(1))}),"x-ray":M.Group({})})},JVe=Ut.BuiltIn({name:"create-volume-streaming-info",display:{name:"Volume Streaming Info"},from:be.Molecule.Structure,to:CI,params:function(e){return{serverUrl:M.Text("https://ds.litemol.org"),entries:M.ObjectList(ZVe,function(t){var r=t.dataId;return r},{defaultValue:[{dataId:"",source:{name:"x-ray",params:{}}}]})}}})({apply:function(e,t){var r=e.a,n=e.params;return Qe.create("",function(a){return pe(void 0,void 0,void 0,function(){var i,o,s,u,l,c,d,f;return he(this,function(p){switch(p.label){case 0:i=[],o=0,s=n.entries.length,p.label=1;case 1:return o<s?(u=n.entries[o],l=u.dataId,c=u.source.name==="em"?u.source.params.isoValue:It.IsoValue.relative(1),[4,a.update("Getting server header...")]):[3,5];case 2:return p.sent(),[4,t.fetch({url:w_(n.serverUrl,u.source.name+"/"+l.toLocaleLowerCase()),type:"json"}).runInContext(a)];case 3:d=p.sent(),i.push({dataId:l,kind:u.source.name,header:d,emDefaultContourLevel:c}),p.label=4;case 4:return++o,[3,1];case 5:return f={serverUrl:n.serverUrl,entries:i,structure:r.data},[2,new CI(f,{label:"Volume Server",description:""+i.map(function(h){return h.dataId}).join(", ")})]}})})})}}),SR=Ut.BuiltIn({name:"create-volume-streaming-behavior",display:{name:"Volume Streaming Behavior"},from:CI,to:Qi,params:function(e){return Qi.createParams({data:e&&e.data})}})({canAutoUpdate:function(e){var t=e.oldParams,r=e.newParams;return t.entry.params.view===r.entry.params.view||r.entry.params.view.name==="selection-box"||r.entry.params.view.name==="off"},apply:function(e,t){var r=e.a,n=e.params;return Qe.create("Volume streaming",function(a){return pe(void 0,void 0,void 0,function(){var i;return he(this,function(o){switch(o.label){case 0:return i=new Qi.Behavior(t,r.data),[4,i.update(n)];case 1:return o.sent(),[2,new Qi(i,{label:"Volume Streaming",description:i.getDescription()})]}})})})},update:function(e){var t=this;e.a;var r=e.b,n=e.oldParams,a=e.newParams;return Qe.create("Update Volume Streaming",function(i){return pe(t,void 0,void 0,function(){var o,s;return he(this,function(u){switch(u.label){case 0:return n.entry.name!==a.entry.name&&"em"in a.entry.params.channels&&(o=r.data.infoMap.get(a.entry.name).emDefaultContourLevel,o&&(a.entry.params.channels.em.isoValue=o)),[4,r.data.update(a)];case 1:return s=u.sent()?gt.UpdateResult.Updated:gt.UpdateResult.Unchanged,r.description=r.data.getDescription(),[2,s]}})})})}}),px=Ut.BuiltIn({name:"create-volume-streaming-visual",display:{name:"Volume Streaming Visual"},from:Qi,to:be.Volume.Representation3D,params:{channel:M.Select("em",Qi.ChannelTypeOptions,{isHidden:!0})}})({apply:function(e,t){var r=e.a,n=e.params,a=e.spine;return Qe.create("Volume Representation",function(i){return pe(void 0,void 0,void 0,function(){var o,s,u,l,c,d,f,p,h;return he(this,function(m){switch(m.label){case 0:return o=r.data.channels[n.channel],o?(s=qN(r.data,n.channel),u=x3.BuiltIn.isosurface,l=s.type.params||{},c=u.factory(T({webgl:(p=t.canvas3d)===null||p===void 0?void 0:p.webgl},t.representation.volume.themes),u.getParams),c.setTheme(Ia.create(t.representation.volume.themes,{volume:o.data},s)),d=(h=a.getAncestorOfType(be.Molecule.Structure))===null||h===void 0?void 0:h.data,f=d?.models.length===0?void 0:Wh.get(d?.models[0]),[4,c.createOrUpdate(l,o.data).runInContext(i)]):[2,qn.Null];case 1:return m.sent(),f&&c.setState({transform:f}),[2,new be.Volume.Representation3D({repr:c,sourceData:o.data},{label:Math.round(o.isoValue.relativeValue*100)/100+" \u03C3 ["+n.channel+"]"})]}})})})},update:function(e,t){var r=e.a,n=e.b,a=e.newParams;return e.spine,Qe.create("Volume Representation",function(i){return pe(void 0,void 0,void 0,function(){var o,s,u,l;return he(this,function(c){switch(c.label){case 0:return o=r.data.channels[a.channel],o?(s=n.data.repr.state.visible,u=qN(r.data,a.channel),l=T(T({},n.data.repr.props),u.type.params),n.data.repr.setTheme(Ia.create(t.representation.volume.themes,{volume:o.data},u)),[4,n.data.repr.createOrUpdate(l,o.data).runInContext(i)]):[2,gt.UpdateResult.Unchanged];case 1:return c.sent(),n.data.repr.setState({visible:s}),n.data.sourceData=o.data,[2,gt.UpdateResult.Updated]}})})})}});function qN(e,t){var r=e.channels[t];return nd.getDefaultParamsStatic(e.plugin,"isosurface",{isoValue:r.isoValue,alpha:r.opacity,visuals:r.wireframe?["wireframe"]:["solid"]},"uniform",{value:r.color})}var eHe=pp.create({name:"built-in.animate-state-interpolation",display:{name:"Animate State (experimental)"},params:function(){return{transtionDurationInMs:M.Numeric(2e3,{min:100,max:3e4,step:10})}},canApply:function(e){return{canApply:e.managers.snapshot.state.entries.size>1}},initialState:function(){return{}},apply:function(e,t,r){return pe(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d,f,p,h,m,v,g,y,b,S,x,C;return he(this,function(w){switch(w.label){case 0:if(n=r.plugin.managers.snapshot.state.entries,n.size<2)return[2,{kind:"finished"}];if(a=t.current%r.params.transtionDurationInMs/r.params.transtionDurationInMs,i=Math.floor(t.current/r.params.transtionDurationInMs)%n.size,o=Math.ceil(t.current/r.params.transtionDurationInMs),o===i&&o++,o=o%n.size,s=n.get(i).snapshot,u=n.get(o).snapshot,!s.data||!u.data)return[2,{kind:"skip"}];for(l=s.data.tree.transforms,c=u.data.tree.transforms,d=r.plugin.state.data,f=d.build(),p=0,h=l;p<h.length;p++)for(m=h[p],v=0,g=c;v<g.length;v++)y=g[v],y.ref===m.ref&&y.version!==m.version&&(b=vr.fromJSON(m),S=vr.fromJSON(y),x=d.cells.get(m.ref),x&&(C=void 0,b.transformer.definition.interpolate?C=b.transformer.definition.interpolate(b.params,S.params,a,r.plugin):C=a<=.5?b.params:S.params,mC(x,C)||f.to(m.ref).update(C)));return[4,Rt.State.Update(r.plugin,{state:d,tree:f,options:{doNotLogTiming:!0}})];case 1:return w.sent(),[2,{kind:"next",state:{}}]}})})}}),tHe=pp.create({name:"built-in.animate-structure-spin",display:{name:"Spin Structure"},isExportable:!0,params:function(){return{durationInMs:M.Numeric(3e3,{min:100,max:1e4,step:100})}},initialState:function(){return{t:0}},getDuration:function(e){return{kind:"fixed",durationMs:e.durationInMs}},setup:function(e,t,r){return pe(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c;return he(this,function(d){for(n=r.state.data,a=n.select(lr.Generators.ofType(be.Molecule.Structure.Representation3D)),i=n.build(),o=!1,s=0,u=a;s<u.length;s++)l=u[s],c=n.select(lr.Generators.ofTransformer(lt.Representation.SpinStructureRepresentation3D,l.transform.ref)),!(c.length>0)&&(o=!0,i.to(l.transform.ref).apply(lt.Representation.SpinStructureRepresentation3D,{t:0},{tags:"animate-structure-spin"}));return o?[2,i.commit({doNotUpdateCurrent:!0})]:[2]})})},teardown:function(e,t,r){var n=r.state.data,a=n.select(lr.Generators.ofType(be.Molecule.Structure.Representation3DState).withTag("animate-structure-spin"));if(a.length!==0){for(var i=n.build(),o=0,s=a;o<s.length;o++){var u=s[o];i.delete(u.transform.ref)}return i.commit()}},apply:function(e,t,r){var n;return pe(this,void 0,void 0,function(){var a,i,o,s,u,l,c,d;return he(this,function(f){switch(f.label){case 0:if(a=r.plugin.state.data,i=a.select(lr.Generators.ofTransformer(lt.Representation.SpinStructureRepresentation3D)),i.length===0)return[2,{kind:"finished"}];for(o=a.build(),s=(t.current-t.lastApplied)/r.params.durationInMs,u=(e.t+s)%1,l=0,c=i;l<c.length;l++)d=c[l],o.to(d).update(T(T({},(n=d.params)===null||n===void 0?void 0:n.values),{t:u}));return[4,Rt.State.Update(r.plugin,{state:a,tree:o,options:{doNotLogTiming:!0}})];case 1:return f.sent(),[2,{kind:"next",state:{t:u}}]}})})}}),or;(function(e){function t(n,a){return{action:n,customControl:a&&a.customControl,autoUpdate:a&&a.autoUpdate}}e.Action=t;function r(n,a){return a===void 0&&(a={}),{transformer:n,defaultParams:a}}e.Behavior=r})(or||(or={}));var IQ=function(){return{actions:[or.Action(ah.Structure.DownloadStructure),or.Action(ah.Structure.AddTrajectory),or.Action(ah.Volume.DownloadDensity),or.Action(ah.DataFormat.DownloadFile),or.Action(ah.DataFormat.OpenFiles),or.Action(ah.Structure.EnableModelCustomProps),or.Action(ah.Structure.EnableStructureCustomProps),or.Action(_I),or.Action(QVe),or.Action(SR),or.Action(lt.Data.Download),or.Action(lt.Data.ParseCif),or.Action(lt.Data.ParseCcp4),or.Action(lt.Data.ParseDsn6),or.Action(lt.Model.TrajectoryFromMmCif),or.Action(lt.Model.TrajectoryFromCifCore),or.Action(lt.Model.TrajectoryFromPDB),or.Action(lt.Model.TransformStructureConformation),or.Action(lt.Model.StructureFromModel),or.Action(lt.Model.StructureFromTrajectory),or.Action(lt.Model.ModelFromTrajectory),or.Action(lt.Model.StructureSelectionFromScript),or.Action(lt.Representation.StructureRepresentation3D),or.Action(lt.Representation.StructureSelectionsDistance3D),or.Action(lt.Representation.StructureSelectionsAngle3D),or.Action(lt.Representation.StructureSelectionsDihedral3D),or.Action(lt.Representation.StructureSelectionsLabel3D),or.Action(lt.Representation.StructureSelectionsOrientation3D),or.Action(lt.Representation.ModelUnitcell3D),or.Action(lt.Representation.StructureBoundingBox3D),or.Action(lt.Representation.ExplodeStructureRepresentation3D),or.Action(lt.Representation.SpinStructureRepresentation3D),or.Action(lt.Representation.UnwindStructureAssemblyRepresentation3D),or.Action(lt.Representation.OverpaintStructureRepresentation3DFromScript),or.Action(lt.Representation.TransparencyStructureRepresentation3DFromScript),or.Action(fQ),or.Action(lt.Volume.VolumeFromCcp4),or.Action(lt.Volume.VolumeFromDsn6),or.Action(lt.Volume.VolumeFromCube),or.Action(lt.Volume.VolumeFromDx),or.Action(lt.Representation.VolumeRepresentation3D)],behaviors:[or.Behavior(is.Representation.HighlightLoci),or.Behavior(is.Representation.SelectLoci),or.Behavior(is.Representation.DefaultLociLabelProvider),or.Behavior(is.Representation.FocusLoci),or.Behavior(is.Camera.FocusLoci),or.Behavior(is.Camera.CameraAxisHelper),or.Behavior(uR),or.Behavior(is.CustomProps.StructureInfo),or.Behavior(is.CustomProps.AccessibleSurfaceArea),or.Behavior(is.CustomProps.BestDatabaseSequenceMapping),or.Behavior(is.CustomProps.Interactions),or.Behavior(is.CustomProps.SecondaryStructure),or.Behavior(is.CustomProps.ValenceModel),or.Behavior(is.CustomProps.CrossLinkRestraint)],animations:[JBe,ZBe,eFe,QBe,tHe,eHe]}};function dn(e){return e.svg?B("span",T({className:"msp-icon msp-material-icon"+(e.inline?" msp-icon-inline":""),title:e.title,style:e.style},{children:B(e.svg,{},void 0)}),void 0):null}var M_=B("circle",{r:"6px",id:"circle-left",cy:"12px",cx:"8px",strokeWidth:"1px"},void 0),D_=B("circle",{r:"6px",id:"circle-right",cy:"12px",cx:"16px",strokeWidth:"1px"},void 0),rHe=Pe("svg",T({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:[Pe("defs",{children:[M_,D_]},void 0),Pe("g",{children:[B("use",{href:"#circle-left",className:"msp-shape-filled"},void 0),B("use",{href:"#circle-right",className:"msp-shape-filled"},void 0),B("use",{href:"#circle-left",className:"msp-shape-empty"},void 0)]},void 0)]}),void 0);function AI(){return rHe}var nHe=Pe("svg",T({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:[Pe("defs",{children:[M_,D_,Pe("mask",T({id:"mask-left"},{children:[B("use",{href:"#circle-left",fill:"white",stroke:"white"},void 0),B("use",{href:"#circle-right",fill:"black",strokeWidth:"0px",stroke:"white"},void 0)]}),void 0)]},void 0),Pe("g",{children:[B("use",{href:"#circle-left",className:"msp-shape-filled",mask:"url(#mask-left)"},void 0),B("use",{href:"#circle-right",className:"msp-shape-empty"},void 0)]},void 0)]}),void 0);function TI(){return nHe}var aHe=Pe("svg",T({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:[Pe("defs",{children:[M_,D_,B("clipPath",T({id:"clip-left"},{children:B("use",{href:"#circle-right"},void 0)}),void 0)]},void 0),Pe("g",{children:[B("use",{href:"#circle-left",className:"msp-shape-filled",clipPath:"url(#clip-left)"},void 0),B("use",{href:"#circle-left",className:"msp-shape-empty"},void 0),B("use",{href:"#circle-right",className:"msp-shape-empty"},void 0)]},void 0)]}),void 0);function EI(){return aHe}var iHe=Pe("svg",T({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:[Pe("defs",{children:[M_,D_]},void 0),Pe("g",{children:[B("use",{href:"#circle-left",className:"msp-shape-empty"},void 0),B("use",{href:"#circle-right",className:"msp-shape-filled"},void 0)]},void 0)]}),void 0);function S3(){return iHe}var oHe=B("svg",T({width:"17px",height:"17px",viewBox:"0 0 299.463 299.463",strokeWidth:"6px"},{children:B("g",{children:B("path",{d:"M256.851,173.832v-48.201c22.916-4.918,34.151-30.668,22.556-50.771c-11.547-20.004-39.486-23.251-55.242-5.844 l-41.746-24.106C189.618,22.603,172.861,0,149.734,0c-23.132,0-39.881,22.609-32.685,44.911L75.305,69.016 C59.522,51.586,31.597,54.88,20.061,74.863c-11.63,20.163-0.298,45.862,22.557,50.769v48.2 c-22.821,4.898-34.195,30.591-22.556,50.771c11.529,19.972,39.454,23.285,55.242,5.845l41.746,24.106 c-7.199,22.308,9.559,44.911,32.685,44.911c23.132,0,39.88-22.609,32.685-44.911l41.745-24.106 c15.817,17.469,43.73,14.099,55.242-5.844c0,0,0-0.001,0.001-0.002c4.587-7.953,5.805-17.213,3.431-26.076 C279.392,185.657,269.129,176.461,256.851,173.832z M249.62,72.088c20.568,0,27.428,27.191,10.008,37.239 c-0.003,0.002-0.006,0.003-0.009,0.005c-10.04,5.81-22.85,1.762-27.877-8.475C225.206,87.548,234.938,72.088,249.62,72.088z M149.734,14.4c11.005,0,19.958,8.954,19.958,19.959c0,11.127-9.077,19.958-19.958,19.958c-10.95,0-19.958-8.9-19.958-19.958 C129.776,23.354,138.729,14.4,149.734,14.4z M39.84,109.328c-17.451-10.067-10.534-37.24,10.01-37.24 c15.311,0,24.922,16.653,17.251,29.942C61.681,111.397,49.517,114.925,39.84,109.328z M59.802,224.702 c-9.535,5.503-21.768,2.229-27.268-7.298c-7.639-13.242,1.887-29.945,17.236-29.945c0.013,0,0.027,0,0.04,0 C70.07,187.48,77.49,214.469,59.802,224.702z M149.734,285.062c-11.005,0-19.958-8.954-19.958-19.958 c0-11.127,9.077-19.958,19.958-19.958c10.954,0,19.958,8.903,19.958,19.958C169.693,276.109,160.74,285.062,149.734,285.062z M216.953,217.982l-41.727,24.095c-13.778-15.22-37.459-14.94-50.983,0l-41.728-24.096c6.196-19.289-5.541-39.835-25.498-44.149 V125.63c19.752-4.268,31.762-24.65,25.498-44.149l41.727-24.095c13.629,15.055,37.32,15.093,50.983,0l41.728,24.096 c-6.196,19.29,5.534,39.835,25.498,44.149v48.202C222.61,178.123,210.721,198.581,216.953,217.982z M266.935,217.404 c-5.501,9.528-17.732,12.802-27.261,7.302c-17.682-10.23-10.301-37.247,10.032-37.247 C264.984,187.459,274.602,204.112,266.935,217.404z"},void 0)},void 0)}),void 0);function sHe(){return oHe}var uHe=B("svg",T({width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px"},{children:B("path",{d:"M21,16.5C21,16.88 20.79,17.21 20.47,17.38L12.57,21.82C12.41,21.94 12.21,22 12,22C11.79,22 11.59,21.94 11.43,21.82L3.53,17.38C3.21,17.21 3,16.88 3,16.5V7.5C3,7.12 3.21,6.79 3.53,6.62L11.43,2.18C11.59,2.06 11.79,2 12,2C12.21,2 12.41,2.06 12.57,2.18L20.47,6.62C20.79,6.79 21,7.12 21,7.5V16.5M12,4.15L6.04,7.5L12,10.85L17.96,7.5L12,4.15M5,15.91L11,19.29V12.58L5,9.21V15.91M19,15.91V9.21L13,12.58V19.29L19,15.91Z"},void 0)}),void 0);function PI(){return uHe}B("svg",T({width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px"},{children:B("path",{d:"M16,4L9,8.04V15.96L16,20L23,15.96V8.04M16,6.31L19.8,8.5L16,10.69L12.21,8.5M0,7V9H7V7M11,10.11L15,12.42V17.11L11,14.81M21,10.11V14.81L17,17.11V12.42M2,11V13H7V11M4,15V17H7V15"},void 0)}),void 0);var lHe=B("svg",T({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:B("path",{d:"M10.07,14.27C10.57,14.03 11.16,14.25 11.4,14.75L13.7,19.74L15.5,18.89L13.19,13.91C12.95,13.41 13.17,12.81 13.67,12.58L13.95,12.5L16.25,12.05L8,5.12V15.9L9.82,14.43L10.07,14.27M13.64,21.97C13.14,22.21 12.54,22 12.31,21.5L10.13,16.76L7.62,18.78C7.45,18.92 7.24,19 7,19A1,1 0 0,1 6,18V3A1,1 0 0,1 7,2C7.24,2 7.47,2.09 7.64,2.23L7.65,2.22L19.14,11.86C19.57,12.22 19.62,12.85 19.27,13.27C19.12,13.45 18.91,13.57 18.7,13.61L15.54,14.23L17.74,18.96C18,19.46 17.76,20.05 17.26,20.28L13.64,21.97Z"},void 0)}),void 0);function cHe(){return lHe}B("svg",T({width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px"},{children:B("path",{fill:"currentColor",d:"M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"},void 0)}),void 0);var dHe=B("svg",T({width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px"},{children:B("path",{d:"M3 17.25V21H6.75L17.81 9.93L14.06 6.18L3 17.25M22.61 18.36L18.36 22.61L13.16 17.41L14.93 15.64L15.93 16.64L18.4 14.16L19.82 15.58L18.36 17L19.42 18L20.84 16.6L22.61 18.36M6.61 10.83L1.39 5.64L5.64 1.39L7.4 3.16L4.93 5.64L6 6.7L8.46 4.22L9.88 5.64L8.46 7.05L9.46 8.05L6.61 10.83M20.71 7C21.1 6.61 21.1 6 20.71 5.59L18.37 3.29C18 2.9 17.35 2.9 16.96 3.29L15.12 5.12L18.87 8.87L20.71 7Z"},void 0)}),void 0);function fHe(){return dHe}var pHe=B("svg",T({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:B("path",{d:"M22 11V3h-7v3H9V3H2v8h7V8h2v10h4v3h7v-8h-7v3h-2V8h2v3h7zM7 9H4V5h3v4zm10 6h3v4h-3v-4zm0-10h3v4h-3V5z"},void 0)}),void 0);function MQ(){return pHe}var hHe=B("svg",T({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:B("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"},void 0)}),void 0);function Y0(){return hHe}var mHe=B("svg",T({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:B("path",{d:"M20 12l-1.41-1.41L13 16.17V4h-2v12.17l-5.58-5.59L4 12l8 8 8-8z"},void 0)}),void 0);function k_(){return mHe}var vHe=B("svg",T({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:B("path",{d:"M7 10l5 5 5-5z"},void 0)}),void 0);function Td(){return vHe}var gHe=B("svg",T({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:B("path",{d:"M10 17l5-5-5-5v10z"},void 0)}),void 0);function Ed(){return gHe}var yHe=B("svg",T({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:B("path",{d:"M4 12l1.41 1.41L11 7.83V20h2V7.83l5.58 5.59L20 12l-8-8-8 8z"},void 0)}),void 0);function R_(){return yHe}var bHe=B("svg",T({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:B("path",{d:"M12 6v3l4-4-4-4v3c-4.42 0-8 3.58-8 8 0 1.57.46 3.03 1.24 4.26L6.7 14.8c-.45-.83-.7-1.79-.7-2.8 0-3.31 2.69-6 6-6zm6.76 1.74L17.3 9.2c.44.84.7 1.79.7 2.8 0 3.31-2.69 6-6 6v-3l-4 4 4 4v-3c4.42 0 8-3.58 8-8 0-1.57-.46-3.03-1.24-4.26z"},void 0)}),void 0);function xHe(){return bHe}var SHe=B("svg",T({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:B("path",{d:"M6 13c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0 4c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0-8c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm-3 .5c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zM6 5c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm15 5.5c.28 0 .5-.22.5-.5s-.22-.5-.5-.5-.5.22-.5.5.22.5.5.5zM14 7c.55 0 1-.45 1-1s-.45-1-1-1-1 .45-1 1 .45 1 1 1zm0-3.5c.28 0 .5-.22.5-.5s-.22-.5-.5-.5-.5.22-.5.5.22.5.5.5zm-11 10c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zm7 7c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zm0-17c.28 0 .5-.22.5-.5s-.22-.5-.5-.5-.5.22-.5.5.22.5.5.5zM10 7c.55 0 1-.45 1-1s-.45-1-1-1-1 .45-1 1 .45 1 1 1zm0 5.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm8 .5c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0 4c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0-8c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0-4c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm3 8.5c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zM14 17c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0 3.5c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zm-4-12c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm0 8.5c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm4-4.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm0-4c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5z"},void 0)}),void 0);function DQ(){return SHe}var CHe=B("svg",T({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:B("path",{d:"M15 7v12.97l-4.21-1.81-.79-.34-.79.34L5 19.97V7h10m4-6H8.99C7.89 1 7 1.9 7 3h10c1.1 0 2 .9 2 2v13l2 1V3c0-1.1-.9-2-2-2zm-4 4H5c-1.1 0-2 .9-2 2v16l7-3 7 3V7c0-1.1-.9-2-2-2z"},void 0)}),void 0);function O_(){return CHe}var wHe=B("svg",T({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:B("path",{d:"M7 14c-1.66 0-3 1.34-3 3 0 1.31-1.16 2-2 2 .92 1.22 2.49 2 4 2 2.21 0 4-1.79 4-4 0-1.66-1.34-3-3-3zm13.71-9.37l-1.34-1.34a.9959.9959 0 00-1.41 0L9 12.25 11.75 15l8.96-8.96c.39-.39.39-1.02 0-1.41z"},void 0)}),void 0);function II(){return wHe}var _He=B("svg",T({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:B("path",{d:"M22.61 18.99l-9.08-9.08c.93-2.34.45-5.1-1.44-7C9.79.61 6.21.4 3.66 2.26L7.5 6.11 6.08 7.52 2.25 3.69C.39 6.23.6 9.82 2.9 12.11c1.86 1.86 4.57 2.35 6.89 1.48l9.11 9.11c.39.39 1.02.39 1.41 0l2.3-2.3c.4-.38.4-1.01 0-1.41zm-3 1.6l-9.46-9.46c-.61.45-1.29.72-2 .82-1.36.2-2.79-.21-3.83-1.25C3.37 9.76 2.93 8.5 3 7.26l3.09 3.09 4.24-4.24-3.09-3.09c1.24-.07 2.49.37 3.44 1.31 1.08 1.08 1.49 2.57 1.24 3.96-.12.71-.42 1.37-.88 1.96l9.45 9.45-.88.89z"},void 0)}),void 0);function AHe(){return _He}var THe=B("svg",T({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:B("path",{d:"M22.7 19l-9.1-9.1c.9-2.3.4-5-1.5-6.9-2-2-5-2.4-7.4-1.3L9 6 6 9 1.6 4.7C.4 7.1.9 10.1 2.9 12.1c1.9 1.9 4.6 2.4 6.9 1.5l9.1 9.1c.4.4 1 .4 1.4 0l2.3-2.3c.5-.4.5-1.1.1-1.4z"},void 0)}),void 0);function EHe(){return THe}var PHe=B("svg",T({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:B("path",{d:"M14.25 2.26l-.08-.04-.01.02C13.46 2.09 12.74 2 12 2 6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10c0-4.75-3.31-8.72-7.75-9.74zM19.41 9h-7.99l2.71-4.7c2.4.66 4.35 2.42 5.28 4.7zM13.1 4.08L10.27 9l-1.15 2L6.4 6.3C7.84 4.88 9.82 4 12 4c.37 0 .74.03 1.1.08zM5.7 7.09L8.54 12l1.15 2H4.26C4.1 13.36 4 12.69 4 12c0-1.85.64-3.55 1.7-4.91zM4.59 15h7.98l-2.71 4.7c-2.4-.67-4.34-2.42-5.27-4.7zm6.31 4.91L14.89 13l2.72 4.7C16.16 19.12 14.18 20 12 20c-.38 0-.74-.04-1.1-.09zm7.4-3l-4-6.91h5.43c.17.64.27 1.31.27 2 0 1.85-.64 3.55-1.7 4.91z"},void 0)}),void 0);function IHe(){return PHe}var MHe=B("svg",T({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:B("path",{d:"M9.4 10.5l4.77-8.26C13.47 2.09 12.75 2 12 2c-2.4 0-4.6.85-6.32 2.25l3.66 6.35.06-.1zM21.54 9c-.92-2.92-3.15-5.26-6-6.34L11.88 9h9.66zm.26 1h-7.49l.29.5 4.76 8.25C21 16.97 22 14.61 22 12c0-.69-.07-1.35-.2-2zM8.54 12l-3.9-6.75C3.01 7.03 2 9.39 2 12c0 .69.07 1.35.2 2h7.49l-1.15-2zm-6.08 3c.92 2.92 3.15 5.26 6 6.34L12.12 15H2.46zm11.27 0l-3.9 6.76c.7.15 1.42.24 2.17.24 2.4 0 4.6-.85 6.32-2.25l-3.66-6.35-.93 1.6z"},void 0)}),void 0);function DHe(){return MHe}var kHe=B("svg",T({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:B("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm3.59-13L12 10.59 8.41 7 7 8.41 10.59 12 7 15.59 8.41 17 12 13.41 15.59 17 17 15.59 13.41 12 17 8.41z"},void 0)}),void 0);function CR(){return kHe}var RHe=B("svg",T({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:B("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12 17 15.59z"},void 0)}),void 0);function kQ(){return RHe}var OHe=B("svg",T({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:B("path",{d:"M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm-7 7H3v4c0 1.1.9 2 2 2h4v-2H5v-4zM5 5h4V3H5c-1.1 0-2 .9-2 2v4h2V5zm14-2h-4v2h4v4h2V5c0-1.1-.9-2-2-2zm0 16h-4v2h4c1.1 0 2-.9 2-2v-4h-2v4z"},void 0)}),void 0);function BHe(){return OHe}var FHe=B("svg",T({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:B("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"},void 0)}),void 0);function K0(){return FHe}var LHe=B("svg",T({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:B("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"},void 0)}),void 0);function RQ(){return LHe}var NHe=B("svg",T({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:B("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"},void 0)}),void 0);function Qc(){return NHe}var zHe=B("svg",T({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:B("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM14 13v4h-4v-4H7l5-5 5 5h-3z"},void 0)}),void 0);function UHe(){return zHe}var VHe=B("svg",T({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:B("path",{d:"M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"},void 0)}),void 0);function HHe(){return VHe}var jHe=B("svg",T({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:B("path",{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm-1 4H8c-1.1 0-1.99.9-1.99 2L6 21c0 1.1.89 2 1.99 2H19c1.1 0 2-.9 2-2V11l-6-6zM8 21V7h6v5h5v9H8z"},void 0)}),void 0);function GHe(){return jHe}var qHe=B("svg",T({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:B("path",{d:"M17 15h2V7c0-1.1-.9-2-2-2H9v2h8v8zM7 17V1H5v4H1v2h4v10c0 1.1.9 2 2 2h10v4h2v-4h4v-2H7z"},void 0)}),void 0);function WHe(){return qHe}var XHe=B("svg",T({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:B("path",{d:"M3 5v4h2V5h4V3H5c-1.1 0-2 .9-2 2zm2 10H3v4c0 1.1.9 2 2 2h4v-2H5v-4zm14 4h-4v2h4c1.1 0 2-.9 2-2v-4h-2v4zm0-16h-4v2h4v4h2V5c0-1.1-.9-2-2-2z"},void 0)}),void 0);function YHe(){return XHe}var KHe=B("svg",T({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:B("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14zm-5.04-6.71l-2.75 3.54-1.96-2.36L6.5 17h11l-3.54-4.71z"},void 0)}),void 0);function $He(){return KHe}var QHe=B("svg",T({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:B("path",{d:"M16 9v10H8V9h8m-1.5-6h-5l-1 1H5v2h14V4h-3.5l-1-1zM18 7H6v12c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7z"},void 0)}),void 0);function Cu(){return QHe}B("svg",T({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:B("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"},void 0)}),void 0);var ZHe=B("svg",T({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:B("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"},void 0)}),void 0);function WN(){return ZHe}B("svg",T({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:B("path",{d:"M20.5 11H19V7c0-1.1-.9-2-2-2h-4V3.5C13 2.12 11.88 1 10.5 1S8 2.12 8 3.5V5H4c-1.1 0-1.99.9-1.99 2v3.8H3.5c1.49 0 2.7 1.21 2.7 2.7s-1.21 2.7-2.7 2.7H2V20c0 1.1.9 2 2 2h3.8v-1.5c0-1.49 1.21-2.7 2.7-2.7 1.49 0 2.7 1.21 2.7 2.7V22H17c1.1 0 2-.9 2-2v-4h1.5c1.38 0 2.5-1.12 2.5-2.5S21.88 11 20.5 11z"},void 0)}),void 0);var JHe=B("svg",T({width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px"},{children:B("path",{d:"M3 13h2v-2H3v2zm0 4h2v-2H3v2zm2 4v-2H3c0 1.1.89 2 2 2zM3 9h2V7H3v2zm12 12h2v-2h-2v2zm4-18H9c-1.11 0-2 .9-2 2v10c0 1.1.89 2 2 2h10c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 12H9V5h10v10zm-8 6h2v-2h-2v2zm-4 0h2v-2H7v2z"},void 0)}),void 0);function eje(){return JHe}var tje=B("svg",T({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:B("path",{d:"M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"},void 0)}),void 0);function rje(){return tje}var nje=B("svg",T({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:B("path",{d:"M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"},void 0)}),void 0);function MI(){return nje}var aje=B("svg",T({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:B("path",{d:"M11 18h2v-2h-2v2zm1-16C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm0-14c-2.21 0-4 1.79-4 4h2c0-1.1.9-2 2-2s2 .9 2 2c0 2-3 1.75-3 5h2c0-2.25 3-2.5 3-5 0-2.21-1.79-4-4-4z"},void 0)}),void 0);function cc(){return aje}var ije=B("svg",T({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:B("path",{d:"M12 5.69l5 4.5V18h-2v-6H9v6H7v-7.81l5-4.5M12 3L2 12h3v8h6v-6h2v6h6v-8h3L12 3z"},void 0)}),void 0);function DI(){return ije}B("svg",T({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:B("path",{d:"M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"},void 0)}),void 0);var oje=B("svg",T({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:B("path",{d:"M19.5 9.5c-1.03 0-1.9.62-2.29 1.5h-2.92c-.39-.88-1.26-1.5-2.29-1.5s-1.9.62-2.29 1.5H6.79c-.39-.88-1.26-1.5-2.29-1.5C3.12 9.5 2 10.62 2 12s1.12 2.5 2.5 2.5c1.03 0 1.9-.62 2.29-1.5h2.92c.39.88 1.26 1.5 2.29 1.5s1.9-.62 2.29-1.5h2.92c.39.88 1.26 1.5 2.29 1.5 1.38 0 2.5-1.12 2.5-2.5s-1.12-2.5-2.5-2.5z"},void 0)}),void 0);function sje(){return oje}var uje=B("svg",T({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:B("path",{d:"M6 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"},void 0)}),void 0);function mm(){return uje}var lje=B("svg",T({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:B("path",{d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"},void 0)}),void 0);function OQ(){return lje}var cje=B("svg",T({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:B("path",{d:"M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"},void 0)}),void 0);function BQ(){return cje}var dje=B("svg",T({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:B("path",{d:"M19 4H5c-1.11 0-2 .9-2 2v12c0 1.1.89 2 2 2h4v-2H5V8h14v10h-4v2h4c1.1 0 2-.9 2-2V6c0-1.1-.89-2-2-2zm-7 6l-4 4h3v6h2v-6h3l-4-4z"},void 0)}),void 0);function fje(){return dje}var pje=B("svg",T({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:B("path",{d:"M8 5v14l11-7z"},void 0)}),void 0);function FQ(){return pje}var hje=B("svg",T({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:B("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"},void 0)}),void 0);function kI(){return hje}var mje=B("svg",T({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:B("path",{d:"M19 13H5v-2h14v2z"},void 0)}),void 0);function RI(){return mje}var vje=B("svg",T({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:B("path",{d:"M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9zm-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8H12z"},void 0)}),void 0);function OI(){return vje}var gje=B("svg",T({width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px"},{children:B("path",{d:"M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm2 16H5V5h11.17L19 7.83V19zm-7-7c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3zM6 6h9v4H6z"},void 0)}),void 0);function LQ(){return gje}var yje=Pe("svg",T({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:[B("circle",{cx:"7",cy:"14",r:"3"},void 0),B("circle",{cx:"11",cy:"6",r:"3"},void 0),B("circle",{cx:"16.6",cy:"17.6",r:"3"},void 0)]}),void 0);function bje(){return yje}var xje=B("svg",T({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:B("path",{d:"M6 6h2v12H6zm3.5 6l8.5 6V6z"},void 0)}),void 0);function Sje(){return xje}var Cje=B("svg",T({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:B("path",{d:"M6 6h12v12H6z"},void 0)}),void 0);function NQ(){return Cje}var wje=B("svg",T({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:B("path",{d:"M4 6h16v2H4zm2-4h12v2H6zm14 8H4c-1.1 0-2 .9-2 2v8c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2v-8c0-1.1-.9-2-2-2zm0 10H4v-8h16v8zm-10-7.27v6.53L16 16z"},void 0)}),void 0);function _je(){return wje}var Aje=B("svg",T({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:B("path",{d:"M6.99 11L3 15l3.99 4v-3H14v-2H6.99v-3zM21 9l-3.99-4v3H10v2h7.01v3L21 9z"},void 0)}),void 0);function Tje(){return Aje}var Eje=B("svg",T({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:B("path",{d:"M3 17v2h6v-2H3zM3 5v2h10V5H3zm10 16v-2h8v-2h-8v-2h-2v6h2zM7 9v2H3v2h4v2h2V9H7zm14 4v-2H11v2h10zm-6-4h2V7h4V5h-4V3h-2v6z"},void 0)}),void 0);function vm(){return Eje}var Pje=B("svg",T({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:B("path",{d:"M12 6c3.79 0 7.17 2.13 8.82 5.5-.59 1.22-1.42 2.27-2.41 3.12l1.41 1.41c1.39-1.23 2.49-2.77 3.18-4.53C21.27 7.11 17 4 12 4c-1.27 0-2.49.2-3.64.57l1.65 1.65C10.66 6.09 11.32 6 12 6zm-1.07 1.14L13 9.21c.57.25 1.03.71 1.28 1.28l2.07 2.07c.08-.34.14-.7.14-1.07C16.5 9.01 14.48 7 12 7c-.37 0-.72.05-1.07.14zM2.01 3.87l2.68 2.68C3.06 7.83 1.77 9.53 1 11.5 2.73 15.89 7 19 12 19c1.52 0 2.98-.29 4.32-.82l3.42 3.42 1.41-1.41L3.42 2.45 2.01 3.87zm7.5 7.5l2.61 2.61c-.04.01-.08.02-.12.02-1.38 0-2.5-1.12-2.5-2.5 0-.05.01-.08.01-.13zm-3.4-3.4l1.75 1.75c-.23.55-.36 1.15-.36 1.78 0 2.48 2.02 4.5 4.5 4.5.63 0 1.23-.13 1.77-.36l.98.98c-.88.24-1.8.38-2.75.38-3.79 0-7.17-2.13-8.82-5.5.7-1.43 1.72-2.61 2.93-3.53z"},void 0)}),void 0);function Fm(){return Pje}var Ije=B("svg",T({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:B("path",{d:"M12 6c3.79 0 7.17 2.13 8.82 5.5C19.17 14.87 15.79 17 12 17s-7.17-2.13-8.82-5.5C4.83 8.13 8.21 6 12 6m0-2C7 4 2.73 7.11 1 11.5 2.73 15.89 7 19 12 19s9.27-3.11 11-7.5C21.27 7.11 17 4 12 4zm0 5c1.38 0 2.5 1.12 2.5 2.5S13.38 14 12 14s-2.5-1.12-2.5-2.5S10.62 9 12 9m0-2c-2.48 0-4.5 2.02-4.5 4.5S9.52 16 12 16s4.5-2.02 4.5-4.5S14.48 7 12 7z"},void 0)}),void 0);function Lm(){return Ije}var Mje=B("svg",T({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:B("path",{d:"M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"},void 0)}),void 0);function Dje(){return Mje}var kje=cHe,Rje=bje,XN=sje,Oje=eje,Zc=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!!r.props.initialExpanded},r.headerClicked=function(){r.props.onHeaderClick?r.props.onHeaderClick():r.setState({isExpanded:!r.state.isExpanded})},r}return t.prototype.render=function(){var r=this.props.hideOffset?"msp-control-group-children":"msp-control-group-children msp-control-offset";return this.props.childrenClassName&&(r+=" "+this.props.childrenClassName),Pe("div",T({className:"msp-control-group-wrapper",style:{position:"relative",marginTop:this.props.noTopMargin?0:void 0}},{children:[B("div",T({className:"msp-control-group-header",style:{marginLeft:this.props.headerLeftMargin},title:this.props.title},{children:Pe(xr,T({onClick:this.headerClicked},{children:[!this.props.hideExpander&&B(dn,{svg:this.state.isExpanded?Ed:Td},void 0),this.props.topRightIcon&&B(dn,{svg:this.props.topRightIcon,style:{position:"absolute",right:"2px",top:0}},void 0),B("b",{children:this.props.header},void 0)]}),void 0)}),void 0),this.state.isExpanded&&B("div",T({className:r,style:{display:this.state.isExpanded?"block":"none",maxHeight:this.props.maxHeight,overflow:"hidden",overflowY:"auto"}},{children:this.props.children}),void 0)]}),void 0)},t}(ke.exports.Component);function YN(e){return e}var ad=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.input=ke.exports.createRef(),r.delayHandle=void 0,r.pendingValue=void 0,r.state={originalValue:"",value:""},r.onBlur=function(){r.setState({value:""+r.state.originalValue}),r.props.onBlur&&r.props.onBlur()},r.raiseOnChange=function(){r.pendingValue!==void 0&&(r.props.onChange(r.pendingValue),r.pendingValue=void 0)},r.onChange=function(n){var a=n.target.value,i=r.props.isValid&&!r.props.isValid(a)||r.props.numeric&&Number.isNaN(+a);if(i){r.clearTimeout(),r.setState({value:a});return}if(r.props.numeric)r.setState({value:a},function(){return r.triggerChanged(a,+a)});else{var o=(r.props.toValue||YN)(a),s=(r.props.fromValue||YN)(o);r.setState({value:s},function(){return r.triggerChanged(s,o)})}},r.onKeyUp=function(n){(n.charCode===27||n.keyCode===27||n.key==="Escape")&&r.props.blurOnEscape&&r.input.current&&r.input.current.blur()},r.onKeyPress=function(n){(n.keyCode===13||n.charCode===13||n.key==="Enter")&&(r.isPending&&(r.clearTimeout(),r.raiseOnChange()),r.props.blurOnEnter&&r.input.current&&r.input.current.blur(),r.props.onEnter&&r.props.onEnter()),n.stopPropagation()},r}return Object.defineProperty(t.prototype,"isPending",{get:function(){return typeof this.delayHandle<"u"},enumerable:!1,configurable:!0}),t.prototype.clearTimeout=function(){this.isPending&&(clearTimeout(this.delayHandle),this.delayHandle=void 0)},t.prototype.triggerChanged=function(r,n){this.clearTimeout(),r!==this.state.originalValue&&(this.props.delayMs?(this.pendingValue=n,this.delayHandle=setTimeout(this.raiseOnChange,this.props.delayMs)):this.props.onChange(n))},t.getDerivedStateFromProps=function(r,n){var a=r.fromValue?r.fromValue(r.value):r.value;return a===n.originalValue?null:{originalValue:a,value:a}},t.prototype.render=function(){return B("input",{type:"text",className:this.props.className,style:this.props.style,ref:this.input,onBlur:this.onBlur,value:this.state.value,placeholder:this.props.placeholder,onChange:this.onChange,onKeyPress:this.props.onEnter||this.props.blurOnEnter||this.props.blurOnEscape?this.onKeyPress:void 0,onKeyDown:this.props.blurOnEscape?this.onKeyUp:void 0,disabled:!!this.props.isDisabled},void 0)},t}(ke.exports.PureComponent),Bje=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!1},r.toggleExpanded=function(){return r.setState({isExpanded:!r.state.isExpanded})},r}return t.prototype.render=function(){var r=this.props,n=r.label,a=r.pivot,i=r.controls;return Pe(Nt,{children:[B(yu,T({label:Pe(Nt,{children:[n,B("button",T({className:"msp-btn-link msp-btn-icon msp-control-group-expander",onClick:this.toggleExpanded,title:(this.state.isExpanded?"Less":"More")+" options",style:{background:"transparent",textAlign:"left",padding:"0"}},{children:B(dn,{svg:this.state.isExpanded?RI:Y0,style:{display:"inline-block"}},void 0)}),void 0)]},void 0),control:a},{children:this.props.colorStripe&&B("div",{className:"msp-expandable-group-color-stripe",style:{backgroundColor:vt.toStyle(this.props.colorStripe)}},void 0)}),void 0),this.state.isExpanded&&B("div",T({className:"msp-control-offset"},{children:i}),void 0)]},void 0)},t}(ke.exports.Component);function Jc(e){return Pe("div",T({className:"msp-section-header"+(e.accent?" msp-transform-header-brand-"+e.accent:"")},{children:[e.icon&&B(dn,{svg:e.icon},void 0),e.title," ",B("small",{children:e.desc},void 0)]}),void 0)}function xr(e){var t="msp-btn";e.inline||(t+=" msp-btn-block"),e.noOverflow&&(t+=" msp-no-overflow"),e.flex&&(t+=" msp-flex-item"),(e.commit==="on"||e.commit)&&(t+=" msp-btn-commit msp-btn-commit-on"),e.commit==="off"&&(t+=" msp-btn-commit msp-btn-commit-off"),e.children||(t+=" msp-btn-childless"),e.className&&(t+=" "+e.className);var r=void 0;return e.flex&&(typeof e.flex=="number"?r={flex:"0 0 "+e.flex+"px",padding:0,maxWidth:e.flex+"px"}:typeof e.flex=="string"&&(r={flex:"0 0 "+e.flex,padding:0,maxWidth:e.flex})),e.style&&(r?Object.assign(r,e.style):r=e.style),Pe("button",T({onClick:e.onClick,title:e.title,disabled:e.disabled,style:r,className:t,"data-id":e["data-id"],"data-color":e["data-color"],onContextMenu:e.onContextMenu,onMouseEnter:e.onMouseEnter,onMouseLeave:e.onMouseLeave},{children:[e.icon&&B(dn,{svg:e.icon},void 0),e.children]}),void 0)}function Zt(e){var t="msp-btn msp-btn-icon"+(e.small?"-small":"")+(e.className?" "+e.className:"");typeof e.toggleState<"u"&&(t+=" msp-btn-link-toggle-"+(e.toggleState?"on":"off")),e.transparent&&(t+=" msp-transparent-bg");var r=void 0;return e.flex&&(typeof e.flex=="boolean"?r={flex:"0 0 32px",padding:0}:typeof e.flex=="number"?r={flex:"0 0 "+e.flex+"px",padding:0,maxWidth:e.flex+"px"}:r={flex:"0 0 "+e.flex,padding:0,maxWidth:e.flex}),e.style&&(r?Object.assign(r,e.style):r=e.style),Pe("button",T({className:t,onClick:e.onClick,title:e.title,disabled:e.disabled,"data-id":e["data-id"],style:r},{children:[e.svg&&B(dn,{svg:e.svg},void 0),e.extraContent]}),void 0)}var Wa=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onClick=function(n){n.currentTarget.blur(),r.props.toggle()},r}return t.prototype.render=function(){var r=this.props,n=r.label,a=r.isSelected?(r.className||"")+" msp-control-current":r.className;return B(xr,T({icon:this.props.icon,onClick:this.onClick,title:this.props.title,inline:this.props.inline,disabled:r.disabled,style:r.style,className:a},{children:n&&this.props.isSelected?B("b",{children:n},void 0):n}),void 0)},t}(ke.exports.PureComponent),ul=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!!r.props.initiallyExpanded},r.toggleExpanded=function(){return r.setState({isExpanded:!r.state.isExpanded})},r}return t.prototype.render=function(){return Pe(Nt,{children:[B("div",T({className:"msp-control-group-header",style:{marginTop:this.props.marginTop!==void 0?this.props.marginTop:"1px",marginLeft:this.props.headerLeftMargin}},{children:Pe("button",T({className:"msp-btn msp-form-control msp-btn-block",onClick:this.toggleExpanded,style:this.props.headerStyle},{children:[B(dn,{svg:this.state.isExpanded?Td:Ed},void 0),this.props.header]}),void 0)}),void 0),this.state.isExpanded&&(this.props.noOffset?this.props.children:B("div",T({className:this.props.accent?"msp-accent-offset":"msp-control-offset"},{children:this.props.children}),void 0))]},void 0)},t}(ke.exports.PureComponent);function yu(e){var t="msp-control-row";return e.className&&(t+=" "+e.className),Pe("div",T({className:t},{children:[B("span",T({className:"msp-control-row-label",title:e.title},{children:e.label}),void 0),B("div",T({className:"msp-control-row-ctrl"},{children:e.control}),void 0),e.children]}),void 0)}var B_=ke.exports.createContext(void 0),Sr=function(e){Le(t,e);function t(r,n){var a=e.call(this,r)||this;return a.subs=void 0,a.plugin=n,a.init&&a.init(),a}return t.prototype.subscribe=function(r,n){typeof this.subs>"u"&&(this.subs=[]),this.subs.push(r.subscribe(n))},t.prototype.componentWillUnmount=function(){if(!!this.subs){for(var r=0,n=this.subs;r<n.length;r++){var a=n[r];a.unsubscribe()}this.subs=void 0}},t.contextType=B_,t}(ke.exports.Component),ci=function(e){Le(t,e);function t(r,n){var a=e.call(this,r,n)||this;return a.subs=void 0,a.plugin=n,a.init&&a.init(),a}return t.prototype.subscribe=function(r,n){typeof this.subs>"u"&&(this.subs=[]),this.subs.push(r.subscribe(n))},t.prototype.componentWillUnmount=function(){if(!!this.subs){for(var r=0,n=this.subs;r<n.length;r++){var a=n[r];a.unsubscribe()}this.subs=void 0}},t.contextType=B_,t}(ke.exports.PureComponent),$0=function(e){Le(t,e);function t(r,n){var a=e.call(this,r,n)||this;a.toggleCollapsed=function(){a.setState({isCollapsed:!a.state.isCollapsed})};var i=a.defaultState();return r.initiallyCollapsed!==void 0&&(i.isCollapsed=r.initiallyCollapsed),r.header!==void 0&&(i.header=r.header),a.state=i,a}return t.prototype.componentDidUpdate=function(r){this.props.initiallyCollapsed!==void 0&&r.initiallyCollapsed!==this.props.initiallyCollapsed&&this.setState({isCollapsed:this.props.initiallyCollapsed})},t.prototype.render=function(){var r;if(this.state.isHidden)return null;var n=this.state.isCollapsed?"msp-transform-wrapper msp-transform-wrapper-collapsed":"msp-transform-wrapper";return Pe("div",T({className:n},{children:[B("div",T({className:"msp-transform-header"},{children:Pe(xr,T({icon:this.state.brand?void 0:this.state.isCollapsed?Ed:Td,noOverflow:!0,onClick:this.toggleCollapsed,className:this.state.brand?"msp-transform-header-brand msp-transform-header-brand-"+this.state.brand.accent:void 0,title:"Click to "+(this.state.isCollapsed?"expand":"collapse")},{children:[B(dn,{svg:(r=this.state.brand)===null||r===void 0?void 0:r.svg,inline:!0},void 0),this.state.header,B("small",T({style:{margin:"0 6px"}},{children:this.state.isCollapsed?"":this.state.description}),void 0)]}),void 0)}),void 0),!this.state.isCollapsed&&this.renderControls()]}),void 0)},t}(Sr),ir=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.hide=function(){return r.props.onSelect(void 0)},r}return t.prototype.render=function(){var r=this.props,n=B(Fje,{items:r.items,onSelect:r.onSelect,current:r.current,multiselect:this.props.multiselect,noOffset:this.props.noOffset,noAccent:this.props.noAccent},void 0);return Pe("div",T({className:"msp-action-menu-options"+(r.header?"":" msp-action-menu-options-no-header")},{children:[r.header&&B(Zc,T({header:r.header,title:r.title,initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.hide,topRightIcon:Qc},{children:n}),void 0),!r.header&&n]}),void 0)},t}(ke.exports.PureComponent);(function(e){function t(l,c){return c?T({kind:"header",label:l},c):{kind:"header",label:l}}e.Header=t;function r(l,c,d){return T({kind:"item",label:l,value:c},d)}e.Item=r;function n(l,c){for(var d=c||{},f=d.label,p=d.value,h=d.category,m=d.selected,v=d.icon,g=d.addOn,y=d.description,b=void 0,S=[],x=0;x<l.length;x++){var C=l[x];if(!(c?.filter&&!c.filter(C))){var w=h?.(C),_=f?f(C):""+C,E=p?p(C):C,P=y?y(C):typeof C=="string"?C:void 0,D=void 0;w?(b||(b=new Map),D=b.get(w),D||(D=[e.Header(w,{description:w})],b.set(w,D),S.push(D))):D=S;var k=g?.(C);D.push({kind:"item",label:_,value:E,icon:v?v(C):void 0,selected:m?m(C):void 0,addOn:k,description:P})}}return S}e.createItems=n;var a={value:function(l){return l[0]},label:function(l){return l[1]},category:function(l){return l[2]}};function i(l,c){return n(l,c?T(T({},a),c):a)}e.createItemsFromSelectOptions=i;function o(l){if(jc(l))return!1;if(Zv(l))return!!l.selected;for(var c=0,d=l;c<d.length;c++){var f=d[c],p=o(f);if(p)return!0}return!1}e.hasSelectedItem=o;function s(l,c){if(!jc(l)){if(Zv(l))return l.value===c?l:void 0;for(var d=0,f=l;d<f.length;d++){var p=f[d],h=s(p,c);if(h)return h}}}e.findItem=s;function u(l){if(!jc(l)){if(Zv(l))return l;for(var c=0,d=l;c<d.length;c++){var f=d[c],p=u(f);if(p)return p}}}e.getFirstItem=u})(ir||(ir={}));var Fje=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state=t.createState(r.props),r.toggleExpanded=function(n){r.setState({isExpanded:!r.state.isExpanded}),n.currentTarget.blur()},r.selectAll=function(){var n=BI(r.props.items,[]).filter(function(a){return!a.selected});r.props.onSelect(n)},r.selectNone=function(){var n=BI(r.props.items,[]).filter(function(a){return!!a.selected});r.props.onSelect(n)},r}return t.createState=function(r,n){var a=yT(r.items)&&jc(r.items[0])?r.items[0]:void 0,i=a?.isIndependent?!1:r.multiselect?ir.hasSelectedItem(r.items):!!r.current&&!!ir.findItem(r.items,r.current.value)||ir.hasSelectedItem(r.items);return{header:a,hasCurrent:i,isExpanded:i||(n??!!a?.initiallyExpanded)}},t.prototype.componentDidUpdate=function(r){if(this.props.items!==r.items||this.props.current!==r.current){var n=yT(this.props.items)&&yT(r.items)&&jc(this.props.items[0])&&jc(r.items[0])&&this.props.items[0].label===r.items[0].label?this.state.isExpanded:void 0;this.setState(t.createState(this.props,n))}},Object.defineProperty(t.prototype,"multiselectHeader",{get:function(){var r=this.state,n=r.header,a=r.hasCurrent;return Pe("div",T({className:"msp-flex-row msp-control-group-header"},{children:[B(xr,T({icon:this.state.isExpanded?Td:Ed,flex:!0,noOverflow:!0,onClick:this.toggleExpanded,title:"Click to "+(this.state.isExpanded?"collapse":"expand")+"."+(n?.description?" "+n?.description:"")},{children:a?B("b",{children:n?.label},void 0):n?.label}),void 0),B(xr,T({icon:K0,flex:!0,onClick:this.selectAll,style:{flex:"0 0 50px",textAlign:"right"}},{children:"All"}),void 0),B(xr,T({icon:Qc,flex:!0,onClick:this.selectNone,style:{flex:"0 0 50px",textAlign:"right"}},{children:"None"}),void 0)]}),void 0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"basicHeader",{get:function(){var r=this.state,n=r.header,a=r.hasCurrent;return B("div",T({className:"msp-control-group-header",style:{marginTop:"1px"}},{children:B(xr,T({noOverflow:!0,icon:this.state.isExpanded?Td:Ed,onClick:this.toggleExpanded,title:"Click to "+(this.state.isExpanded?"collapse":"expand")+". "+(n?.description?n?.description:"")},{children:a?B("b",{children:n?.label},void 0):n?.label}),void 0)}),void 0)},enumerable:!1,configurable:!0}),t.prototype.render=function(){var r=this,n=this.props,a=n.items,i=n.onSelect,o=n.current;if(jc(a))return null;if(Zv(a))return B(KN,{item:a,onSelect:i,current:o,multiselect:this.props.multiselect},void 0);var s=this.state.header;return Pe(Nt,{children:[s&&(this.props.multiselect&&this.state.isExpanded?this.multiselectHeader:this.basicHeader),B("div",T({className:this.props.noOffset?void 0:this.props.noAccent?"msp-control-offset":"msp-accent-offset"},{children:(!s||this.state.isExpanded)&&a.map(function(u,l){return jc(u)?null:Zv(u)?B(KN,{item:u,onSelect:i,current:o,multiselect:r.props.multiselect},l):B(t,{items:u,onSelect:i,current:o,multiselect:r.props.multiselect,noAccent:!0},l)})}),void 0)]},void 0)},t}(ke.exports.PureComponent),KN=function(e){var t=e.item,r=e.onSelect,n=e.current,a=e.multiselect,i=n===t,o=t.addOn?{position:"relative"}:void 0;return Pe(xr,T({icon:t.icon,noOverflow:!0,className:"msp-action-menu-button",onClick:function(s){return r(a?[t]:t,s)},disabled:t.disabled,style:o,title:t.description},{children:[i||t.selected?B("b",{children:t.label},void 0):t.label,t.addOn]}),void 0)};function yT(e){return!!e&&Array.isArray(e)}function Zv(e){var t=e;return t&&t.kind==="item"}function jc(e){var t=e;return t&&t.kind==="header"}function BI(e,t){if(jc(e))return t;if(Zv(e))return t.push(e),t;for(var r=0,n=e;r<n.length;r++){var a=n[r];BI(a,t)}return t}var wR=[["black",0],["gray",8421504],["white",16777215],["red",13840661],["orange",14840576],["yellow",16565248],["green",6863872],["cyan",1484197],["blue",40160],["purple",8086783],["magenta",16394495],["violet",8200583]],Lje=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!!r.props.param.isExpanded,lightness:0},r.toggleExpanded=function(n){r.setState({isExpanded:!r.state.isExpanded}),n.currentTarget.blur()},r.onClickSwatch=function(n){var a=vt(+(n.currentTarget.getAttribute("data-color")||"0"));a!==r.props.value&&(r.props.param.isExpanded||r.setState({isExpanded:!1}),r.update(a))},r.onR=function(n){var a=vt.toRgb(r.props.value),i=a[1],o=a[2],s=vt.fromRgb(n,i,o);s!==r.props.value&&r.update(s)},r.onG=function(n){var a=vt.toRgb(r.props.value),i=a[0],o=a[2],s=vt.fromRgb(i,n,o);s!==r.props.value&&r.update(s)},r.onB=function(n){var a=vt.toRgb(r.props.value),i=a[0],o=a[1],s=vt.fromRgb(i,o,n);s!==r.props.value&&r.update(s)},r.onLighten=function(){r.update(vt.lighten(r.props.value,.1))},r.onDarken=function(){r.update(vt.darken(r.props.value,.1))},r}return t.prototype.update=function(r){this.props.onChange({param:this.props.param,name:this.props.name,value:r})},t.prototype.swatch=function(){var r=this;return B("div",T({className:"msp-combined-color-swatch"},{children:wR.map(function(n){return B(xr,{inline:!0,"data-color":n[1],onClick:r.onClickSwatch,style:{background:vt.toStyle(n[1])}},n[1])})}),void 0)},t.prototype.render=function(){var r=this.props.param.label||Ji(this.props.name),n=vt.toRgb(this.props.value),a=n[0],i=n[1],o=n[2];return Pe(Nt,{children:[B(yu,{title:this.props.param.description,label:r,control:B(xr,{onClick:this.toggleExpanded,inline:!0,className:"msp-combined-color-button",style:{background:vt.toStyle(this.props.value)}},void 0)},void 0),this.state.isExpanded&&Pe("div",T({className:"msp-control-offset"},{children:[this.swatch(),B(yu,{label:"RGB",className:"msp-control-label-short",control:Pe("div",T({style:{display:"flex",textAlignLast:"center",left:"80px"}},{children:[B(ad,{onChange:this.onR,numeric:!0,value:a,delayMs:250,style:{order:1,flex:"1 1 auto",minWidth:0},className:"msp-form-control",onEnter:this.props.onEnter,blurOnEnter:!0,blurOnEscape:!0},void 0),B(ad,{onChange:this.onG,numeric:!0,value:i,delayMs:250,style:{order:2,flex:"1 1 auto",minWidth:0},className:"msp-form-control",onEnter:this.props.onEnter,blurOnEnter:!0,blurOnEscape:!0},void 0),B(ad,{onChange:this.onB,numeric:!0,value:o,delayMs:250,style:{order:3,flex:"1 1 auto",minWidth:0},className:"msp-form-control",onEnter:this.props.onEnter,blurOnEnter:!0,blurOnEscape:!0},void 0)]}),void 0)},void 0),Pe("div",T({style:{display:"flex",textAlignLast:"center"}},{children:[B(xr,T({onClick:this.onLighten,style:{order:1,flex:"1 1 auto",minWidth:0},className:"msp-form-control"},{children:"Lighten"}),void 0),B(xr,T({onClick:this.onDarken,style:{order:1,flex:"1 1 auto",minWidth:0},className:"msp-form-control"},{children:"Darken"}),void 0)]}),void 0)]}),void 0)]},void 0)},t}(ke.exports.PureComponent),hx=void 0;function Nje(){return hx||(hx=B(Nt,{children:wR.map(function(e){return B("option",T({value:e[1],style:{background:""+vt.toStyle(e[1])}},{children:vs(e[0])}),e[1])})},void 0),hx)}var zje=function(){for(var e=new Map,t=0,r=wR;t<r.length;t++){var n=r[t];e.set(n[1],n[0])}return e}();function Uje(e){return zje.has(e)?null:B("option",T({value:e,style:{background:""+vt.toStyle(e)}},{children:vt.toRgbString(e)}),vt.toHexString(e))}function Vje(e){switch(e.kind){case"scale-legend":return Hje;case"table-legend":return jje;default:var t=e;console.warn(t+" has no associated UI component");return}}var Hje=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.render=function(){var r=this.props.legend,n=r.colors.map(function(a){return Array.isArray(a)?vt.toStyle(a[0])+" "+100*a[1]+"%":vt.toStyle(a)}).join(", ");return B("div",T({className:"msp-scale-legend"},{children:Pe("div",T({style:{background:"linear-gradient(to right, "+n+")"}},{children:[B("span",T({style:{float:"left"}},{children:r.minLabel}),void 0),B("span",T({style:{float:"right"}},{children:r.maxLabel}),void 0)]}),void 0)}),void 0)},t}(ke.exports.PureComponent),jje=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.render=function(){var r=this.props.legend;return B("div",T({className:"msp-table-legend"},{children:r.table.map(function(n,a){var i=n[0],o=n[1];return Pe("div",{children:[B("div",{className:"msp-table-legend-color",style:{backgroundColor:vt.toStyle(o)}},void 0),B("div",T({className:"msp-table-legend-text"},{children:i}),void 0)]},a)})}),void 0)},t}(ke.exports.PureComponent),Gje=function(e){Le(t,e);function t(r){var n=e.call(this,r)||this;return n.state={show:!1},n.handleHover=n.handleHover.bind(n),n.handleHoverOff=n.handleHoverOff.bind(n),n.deletePoint=n.deletePoint.bind(n),n}return t.prototype.handleHover=function(){this.setState({show:!0});var r=Xe.create(this.props.nX,this.props.nY);this.props.onmouseover(r)},t.prototype.handleHoverOff=function(){this.setState({show:!1}),this.props.onmouseover(void 0)},t.prototype.deletePoint=function(){this.props.delete(this.props.id)},t.prototype.render=function(){return[B("circle",{r:"10",id:""+this.props.id,cx:this.props.x,cy:this.props.y,onClick:this.props.onclick,onDoubleClick:this.props.delete(this.props.id),onMouseEnter:this.handleHover,onMouseLeave:this.handleHoverOff,onMouseDown:this.props.onmousedown,fill:"black"},this.props.id+"circle")]},t}(ke.exports.Component),qje=function(e){Le(t,e);function t(r){var n=e.call(this,r)||this;n.handleKeyDown=function(s){},n.handleKeyUp=function(s){},n.handleClick=function(s){return function(u){}},n.handleMouseDown=function(s){return function(u){if(!(s===0||s===n.state.points.length-1)&&!n.state.canSelectMultiple){var l=n.normalizePoint(Xe.create(n.state.points[s][0],n.state.points[s][1]));n.ghostPoints.push(document.createElementNS(n.namespace,"circle")),n.ghostPoints[0].setAttribute("r","10"),n.ghostPoints[0].setAttribute("fill","orange"),n.ghostPoints[0].setAttribute("cx",""+l[0]),n.ghostPoints[0].setAttribute("cy",""+l[1]),n.ghostPoints[0].setAttribute("style","display: none"),n.gElement.appendChild(n.ghostPoints[0]),n.updatedX=l[0],n.updatedY=l[1],n.selected=[s]}}},n.deletePoint=function(s){return function(u){if(!(s===0||s===n.state.points.length-1)){var l=n.state.points.filter(function(c,d){return d!==s});l.sort(function(c,d){return c[0]===d[0]?c[0]===0?c[1]-d[1]:c[1]===1?d[1]-c[1]:c[1]-d[1]:c[0]-d[0]}),n.setState({points:l}),n.change(l),u.stopPropagation()}}},n.myRef=ke.exports.createRef(),n.state={points:[Xe.create(0,0),Xe.create(1,0)],copyPoint:void 0,canSelectMultiple:!1},n.height=400,n.width=600,n.padding=70,n.selected=void 0,n.ghostPoints=[],n.namespace="http://www.w3.org/2000/svg";for(var a=0,i=n.props.data;a<i.length;a++){var o=i[a];n.state.points.push(o)}return n.state.points.sort(function(s,u){return s[0]===u[0]?s[0]===0?s[1]-u[1]:s[1]===1?u[1]-s[1]:s[1]-u[1]:s[0]-u[0]}),n.handleDrag=n.handleDrag.bind(n),n.handleMultipleDrag=n.handleMultipleDrag.bind(n),n.handleDoubleClick=n.handleDoubleClick.bind(n),n.refCallBack=n.refCallBack.bind(n),n.handlePointUpdate=n.handlePointUpdate.bind(n),n.change=n.change.bind(n),n.handleKeyUp=n.handleKeyUp.bind(n),n.handleLeave=n.handleLeave.bind(n),n.handleEnter=n.handleEnter.bind(n),n}return t.prototype.render=function(){var r=this.renderPoints(),n=this.renderLines();return[B("div",{children:Pe("svg",T({className:"msp-canvas",ref:this.refCallBack,viewBox:"0 0 "+(this.width+this.padding)+" "+(this.height+this.padding),onMouseMove:this.handleDrag,onMouseUp:this.handlePointUpdate,onMouseLeave:this.handleLeave,onMouseEnter:this.handleEnter,tabIndex:0,onKeyDown:this.handleKeyDown,onKeyUp:this.handleKeyUp,onDoubleClick:this.handleDoubleClick},{children:[Pe("g",T({stroke:"black",fill:"black"},{children:[n,r]}),void 0),B("g",{className:"ghost-points",stroke:"black",fill:"black"},void 0)]}),void 0)},"LineGraph"),B("div",{id:"modal-root"},"modal")]},t.prototype.componentDidMount=function(){this.gElement=document.getElementsByClassName("ghost-points")[0]},t.prototype.change=function(r){var n=r.slice();n.shift(),n.pop(),this.props.onChange(n)},t.prototype.handleDrag=function(r){if(this.selected!==void 0){var n=this.myRef.createSVGPoint(),a,i=this.padding/2;n.x=r.clientX,n.y=r.clientY;var o=n.matrixTransform(this.myRef.getScreenCTM().inverse());a=Xe.create(o.x,o.y),(o.x<i||o.x>this.width+i)&&(o.y>this.height+i||o.y<i)?a=Xe.create(this.updatedX,this.updatedY):o.x<i?a=Xe.create(i,o.y):o.x>this.width+i?a=Xe.create(this.width+i,o.y):o.y>this.height+i?a=Xe.create(o.x,this.height+i):o.y<i?a=Xe.create(o.x,i):a=Xe.create(o.x,o.y),this.updatedX=a[0],this.updatedY=a[1];var s=this.unNormalizePoint(a);this.ghostPoints[0].setAttribute("style","display: visible"),this.ghostPoints[0].setAttribute("cx",""+a[0]),this.ghostPoints[0].setAttribute("cy",""+a[1]),this.props.onDrag(s)}},t.prototype.handleMultipleDrag=function(){},t.prototype.handlePointUpdate=function(r){var n=this.selected;if(!this.state.canSelectMultiple){if(n===void 0||n[0]===0||n[0]===this.state.points.length-1){this.setState({copyPoint:void 0});return}this.selected=void 0;var a=this.unNormalizePoint(Xe.create(this.updatedX,this.updatedY)),i=this.state.points.filter(function(o,s){return s!==n[0]});i.push(a),i.sort(function(o,s){return o[0]===s[0]?o[0]===0?o[1]-s[1]:o[1]===1?s[1]-o[1]:o[1]-s[1]:o[0]-s[0]}),this.setState({points:i}),this.change(i),this.gElement.innerHTML="",this.ghostPoints=[],document.removeEventListener("mousemove",this.handleDrag,!0),document.removeEventListener("mouseup",this.handlePointUpdate,!0)}},t.prototype.handleDoubleClick=function(r){var n,a=this.myRef.createSVGPoint();a.x=r.clientX,a.y=r.clientY;var i=a.matrixTransform(this.myRef.getScreenCTM().inverse()),o=this.state.points,s=this.padding/2;i.x<s||i.x>this.width+s||i.y>this.height+s||i.y<this.padding/2||(n=this.unNormalizePoint(Xe.create(i.x,i.y)),o.push(n),o.sort(function(u,l){return u[0]===l[0]?u[0]===0?u[1]-l[1]:u[1]===1?l[1]-u[1]:u[1]-l[1]:u[0]-l[0]}),this.setState({points:o}),this.change(o))},t.prototype.handleLeave=function(){this.selected!==void 0&&(document.addEventListener("mousemove",this.handleDrag,!0),document.addEventListener("mouseup",this.handlePointUpdate,!0))},t.prototype.handleEnter=function(){document.removeEventListener("mousemove",this.handleDrag,!0),document.removeEventListener("mouseup",this.handlePointUpdate,!0)},t.prototype.normalizePoint=function(r){var n=this.padding/2,a=this.width+n,i=this.height+n,o=r[0]*(a-n)+n,s=r[1]*(i-n)+n,u=this.height+this.padding-s,l=Xe.create(o,u);return l},t.prototype.unNormalizePoint=function(r){var n=this.padding/2,a=this.width+n,i=this.height+n,o=(r[0]-n)/(a-n),s=(this.height+this.padding-r[1]-n)/(i-n);return Xe.create(o,s)},t.prototype.refCallBack=function(r){r&&(this.myRef=r)},t.prototype.renderPoints=function(){for(var r=[],n,a=0;a<this.state.points.length;a++)a!==0&&a!==this.state.points.length-1&&(n=this.normalizePoint(this.state.points[a]),r.push(B(Gje,{id:a,x:n[0],y:n[1],nX:this.state.points[a][0],nY:this.state.points[a][1],selected:!1,delete:this.deletePoint,onmouseover:this.props.onHover,onmousedown:this.handleMouseDown(a),onclick:this.handleClick(a)},a)));return r},t.prototype.renderLines=function(){for(var r=[],n=[],a,i,o,s,u,l,c=0,d=this.state.points;c<d.length;c++){var f=d[c];a=this.padding/2,i=this.width+a,o=this.height+a,s=f[0]*(i-a)+a,u=f[1]*(o-a)+a,l=this.height+this.padding-u,r.push(Xe.create(s,l))}for(var p=r,h=p.length,m=0;m<h-1;m++){var v=p[m][0],g=p[m][1],y=p[m+1][0],b=p[m+1][1];n.push(B("line",{x1:v,x2:y,y1:g,y2:b,stroke:"#cec9ba",strokeWidth:"5"},"lineOf"+m))}return n},t}(ke.exports.Component),zQ=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isChanging:!1,current:0},r.begin=function(){r.setState({isChanging:!0})},r.end=function(n){r.setState({isChanging:!1}),r.props.onChange(n)},r.updateCurrent=function(n){var a,i;r.setState({current:n}),(i=(a=r.props).onChangeImmediate)===null||i===void 0||i.call(a,n)},r.updateManually=function(n){r.setState({isChanging:!0});var a=n;r.props.step===1&&(a=Math.round(a)),a<r.props.min&&(a=r.props.min),a>r.props.max&&(a=r.props.max),r.setState({current:a,isChanging:!0})},r.onManualBlur=function(){r.setState({isChanging:!1}),r.props.onChange(r.state.current)},r}return t.getDerivedStateFromProps=function(r,n){return n.isChanging||r.value===n.current?null:{current:r.value}},t.prototype.render=function(){var r=this.props.step;return r===void 0&&(r=1),Pe("div",T({className:"msp-slider"},{children:[B("div",{children:B(UQ,{min:this.props.min,max:this.props.max,step:r,value:this.state.current,disabled:this.props.disabled,onBeforeChange:this.begin,onChange:this.updateCurrent,onAfterChange:this.end},void 0)},void 0),B("div",{children:B(ad,{numeric:!0,delayMs:50,value:this.state.current,blurOnEnter:!0,onBlur:this.onManualBlur,isDisabled:this.props.disabled,onChange:this.updateManually},void 0)},void 0)]}),void 0)},t}(ke.exports.Component),Wje=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isChanging:!1,current:[0,1]},r.begin=function(){r.setState({isChanging:!0})},r.end=function(n){r.setState({isChanging:!1}),r.props.onChange(n)},r.updateCurrent=function(n){r.setState({current:n})},r.updateMax=function(n){var a=n;r.props.step===1&&(a=Math.round(a)),a<r.state.current[0]?a=r.state.current[0]:a<r.props.min&&(a=r.props.min),a>r.props.max&&(a=r.props.max),r.props.onChange([r.state.current[0],a])},r.updateMin=function(n){var a=n;r.props.step===1&&(a=Math.round(a)),a<r.props.min&&(a=r.props.min),a>r.state.current[1]?a=r.state.current[1]:a>r.props.max&&(a=r.props.max),r.props.onChange([a,r.state.current[1]])},r}return t.getDerivedStateFromProps=function(r,n){return n.isChanging||r.value[0]===n.current[0]&&r.value[1]===n.current[1]?null:{current:r.value}},t.prototype.render=function(){var r=this.props.step;return r===void 0&&(r=1),Pe("div",T({className:"msp-slider2"},{children:[B("div",{children:B(ad,{numeric:!0,delayMs:50,value:this.state.current[0],onEnter:this.props.onEnter,blurOnEnter:!0,isDisabled:this.props.disabled,onChange:this.updateMin},void 0)},void 0),B("div",{children:B(UQ,{min:this.props.min,max:this.props.max,step:r,value:this.state.current,disabled:this.props.disabled,onBeforeChange:this.begin,onChange:this.updateCurrent,onAfterChange:this.end,range:!0,allowCross:!0},void 0)},void 0),B("div",{children:B(ad,{numeric:!0,delayMs:50,value:this.state.current[1],onEnter:this.props.onEnter,blurOnEnter:!0,isDisabled:this.props.disabled,onChange:this.updateMax},void 0)},void 0)]}),void 0)},t}(ke.exports.Component);function FI(e){for(var t=[],r={}.hasOwnProperty,n=0;n<arguments.length;n++){var a=arguments[n];if(!!a){var i=typeof a;if(i==="string"||i==="number")t.push(a);else if(Array.isArray(a))t.push(FI.apply(null,a));else if(i==="object")for(var o in a)r.call(a,o)&&a[o]&&t.push(o)}}return t.join(" ")}function $N(e){return e.touches.length>1||e.type.toLowerCase()==="touchend"&&e.touches.length>0}function QN(e,t){return e?t.touches[0].clientY:t.touches[0].pageX}function ZN(e,t){return e?t.clientY:t.pageX}function JN(e,t){var r=t.getBoundingClientRect();return e?r.top+r.height*.5:r.left+r.width*.5}function bT(e){e.stopPropagation(),e.preventDefault()}var Xje=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.render=function(){var r=this.props,n=r.className,a=r.tipFormatter,i=r.vertical,o=r.offset,s=r.value,u=r.index,l=i?{bottom:o+"%"}:{left:o+"%"};return B("div",{className:n,style:l,title:a(s,u)},void 0)},t}(ke.exports.Component),UQ=function(e){Le(t,e);function t(r){var n=e.call(this,r)||this;n.sliderElement=ke.exports.createRef(),n.handleElements=[],n.dragOffset=0,n.startPosition=0,n.startValue=0,n._getPointsCache=void 0,n.onMouseDown=function(f){if(f.button===0){var p=ZN(n.props.vertical,f);if(!n.isEventFromHandle(f))n.dragOffset=0;else{var h=JN(n.props.vertical,f.target);n.dragOffset=p-h,p=h}n.onStart(p),n.addDocumentEvents("mouse"),bT(f)}},n.onTouchMove=function(f){if($N(f)){n.end("touch");return}var p=QN(n.props.vertical,f);n.onMove(f,p-n.dragOffset)},n.onTouchStart=function(f){if(!$N(f)){var p=QN(n.props.vertical,f);if(!n.isEventFromHandle(f))n.dragOffset=0;else{var h=JN(n.props.vertical,f.target);n.dragOffset=p-h,p=h}n.onStart(p),n.addDocumentEvents("touch"),bT(f)}},n.eventHandlers={touchmove:function(f){return n.onTouchMove(f)},touchend:function(f){return n.end("touch")},mousemove:function(f){return n.onMouseMove(f)},mouseup:function(f){return n.end("mouse")}},n.calcOffset=function(f){var p=n.props,h=p.min,m=p.max,v=(f-h)/(m-h);return v*100};var a=r.range,i=r.min,o=r.max,s=a?Array.apply(null,Array(+a+1)).map(function(){return i}):i,u="defaultValue"in r?r.defaultValue:s,l=r.value!==void 0?r.value:u,c=(a?l:[i,l]).map(function(f){return n.trimAlignValue(f)}),d;return a&&c[0]===c[c.length-1]&&c[0]===o?d=0:d=c.length-1,n.state={handle:null,recent:d,bounds:c},n}return t.prototype.componentDidUpdate=function(r){var n=this;if("value"in this.props||"min"in this.props||"max"in this.props){var a=this.state.bounds;if(r.range){var i=this.props.value||a,o=i.map(function(u){return n.trimAlignValue(u,n.props)});if(o.every(function(u,l){return u===a[l]}))return;this.setState({bounds:o}),a.some(function(u){return n.isValueOutOfBounds(u,n.props)})&&this.props.onChange(o)}else{var i=this.props.value!==void 0?this.props.value:a[1],s=this.trimAlignValue(i,this.props);if(s===a[1]&&a[0]===r.min)return;this.setState({bounds:[r.min,s]}),this.isValueOutOfBounds(a[1],this.props)&&this.props.onChange(s)}}},t.prototype.onChange=function(r){var n=this.props,a=!("value"in n);a?this.setState(r):r.handle!==void 0&&this.setState({handle:r.handle});var i=T(T({},this.state),r),o=n.range?i.bounds:i.bounds[1];n.onChange(o)},t.prototype.onMouseMove=function(r){var n=ZN(this.props.vertical,r);this.onMove(r,n-this.dragOffset)},t.prototype.onMove=function(r,n){bT(r);var a=this.props,i=this.state,o=n-this.startPosition;o=this.props.vertical?-o:o;var s=o/this.getSliderLength()*(a.max-a.min),u=this.trimAlignValue(this.startValue+s),l=i.bounds[i.handle];if(u!==l){var c=Gt([],i.bounds);c[i.handle]=u;var d=i.handle;if(a.pushable){var f=i.bounds[d];this.pushSurroundingHandles(c,d,f)}else a.allowCross&&(c.sort(function(p,h){return p-h}),d=c.indexOf(u));this.onChange({handle:d,bounds:c})}},t.prototype.onStart=function(r){var n=this.props;n.onBeforeChange(this.getValue());var a=this.calcValueByPos(r);this.startValue=a,this.startPosition=r;var i=this.state,o=i.bounds,s=1;if(this.props.range){for(var u=0,l=1;l<o.length-1;++l)a>o[l]&&(u=l);Math.abs(o[u+1]-a)<Math.abs(o[u]-a)&&(u=u+1),s=u;var c=o[u+1]===o[u];c&&(s=i.recent),c&&a!==o[u+1]&&(s=a<o[u+1]?u:u+1)}this.setState({handle:s,recent:s});var d=i.bounds[s];if(a!==d){var f=Gt([],i.bounds);f[s]=a,this.onChange({bounds:f})}},t.prototype.getPoints=function(){var r=this.props,n=r.marks,a=r.step,i=r.min,o=r.max,s=this._getPointsCache;if(!s||s.marks!==n||s.step!==a){var u=T({},n);if(a!==null)for(var l=i;l<=o;l+=a)u[l]=l;var c=Object.keys(u).map(parseFloat);c.sort(function(d,f){return d-f}),this._getPointsCache={marks:n,step:a,points:c}}return this._getPointsCache.points},t.prototype.getPrecision=function(r){var n=r.toString(),a=0;return n.indexOf(".")>=0&&(a=n.length-n.indexOf(".")-1),a},t.prototype.getSliderLength=function(){var r=this.sliderElement.current;return r?this.props.vertical?r.clientHeight:r.clientWidth:0},t.prototype.getSliderStart=function(){var r=this.sliderElement.current,n=r.getBoundingClientRect();return this.props.vertical?n.top:n.left},t.prototype.getValue=function(){var r=this.state.bounds;return this.props.range?r:r[1]},t.prototype.addDocumentEvents=function(r){r==="touch"?(document.addEventListener("touchmove",this.eventHandlers.touchmove),document.addEventListener("touchend",this.eventHandlers.touchend)):r==="mouse"&&(document.addEventListener("mousemove",this.eventHandlers.mousemove),document.addEventListener("mouseup",this.eventHandlers.mouseup))},t.prototype.calcValue=function(r){var n=this.props,a=n.vertical,i=n.min,o=n.max,s=Math.abs(r/this.getSliderLength()),u=a?(1-s)*(o-i)+i:s*(o-i)+i;return u},t.prototype.calcValueByPos=function(r){var n=r-this.getSliderStart(),a=this.trimAlignValue(this.calcValue(n));return a},t.prototype.end=function(r){this.removeEvents(r),this.props.onAfterChange(this.getValue()),this.setState({handle:null})},t.prototype.isEventFromHandle=function(r){for(var n=0,a=this.handleElements;n<a.length;n++){var i=a[n];if(i.current===r.target)return!0}return!1},t.prototype.isValueOutOfBounds=function(r,n){return r<n.min||r>n.max},t.prototype.pushHandle=function(r,n,a,i){for(var o=r[n],s=r[n];a*(s-o)<i;){if(!this.pushHandleOnePoint(r,n,a))return r[n]=o,!1;s=r[n]}return!0},t.prototype.pushHandleOnePoint=function(r,n,a){var i=this.getPoints(),o=i.indexOf(r[n]),s=o+a;if(s>=i.length||s<0)return!1;var u=n+a,l=i[s],c=this.props.pushable,d=a*(r[u]-l);return this.pushHandle(r,u,a,+c-d)?(r[n]=l,!0):!1},t.prototype.pushSurroundingHandles=function(r,n,a){var i=this.props.pushable,o=r[n],s=0;if(r[n+1]-o<i?s=1:o-r[n-1]<i&&(s=-1),s!==0){var u=n+s,l=s*(r[u]-o);this.pushHandle(r,u,s,+i-l)||(r[n]=a)}},t.prototype.removeEvents=function(r){r==="touch"?(document.removeEventListener("touchmove",this.eventHandlers.touchmove),document.removeEventListener("touchend",this.eventHandlers.touchend)):r==="mouse"&&(document.removeEventListener("mousemove",this.eventHandlers.mousemove),document.removeEventListener("mouseup",this.eventHandlers.mouseup))},t.prototype.trimAlignValue=function(r,n){var a=this.state||{},i=a.handle,o=a.bounds,s=T(T({},this.props),n||{}),u=s.marks,l=s.step,c=s.min,d=s.max,f=s.allowCross,p=r;p<=c&&(p=c),p>=d&&(p=d),!f&&i!=null&&i>0&&p<=o[i-1]&&(p=o[i-1]),!f&&i!=null&&i<o.length-1&&p>=o[i+1]&&(p=o[i+1]);var h=Object.keys(u).map(parseFloat);if(l!==null){var m=Math.round((p-c)/l)*l+c;h.push(m)}var v=h.map(function(y){return Math.abs(p-y)}),g=h[v.indexOf(Math.min.apply(Math,v))];return l!==null?parseFloat(g.toFixed(this.getPrecision(l))):g},t.prototype.render=function(){var r,n=this,a=this.state,i=a.handle,o=a.bounds,s=this.props,u=s.className,l=s.prefixCls,c=s.disabled,d=s.vertical,f=s.range,p=s.step,h=s.marks,m=s.tipFormatter,v=this.props.handle,g=o.map(this.calcOffset),y=l+"-handle",b=o.map(function(E,P){var D;return FI((D={},D[y]=!0,D[y+"-"+(P+1)]=!0,D[y+"-lower"]=P===0,D[y+"-upper"]=P===o.length-1,D))}),S=p===null||m===null,x={prefixCls:l,noTip:S,tipFormatter:m,vertical:d};if(this.handleElements.length!==o.length){this.handleElements=[];for(var C=0;C<o.length;C++)this.handleElements.push(ke.exports.createRef())}var w=o.map(function(E,P){return ke.exports.cloneElement(v,T(T({},x),{className:b[P],value:E,offset:g[P],dragging:i===P,index:P,key:P,ref:n.handleElements[P]}))});f||w.shift();var _=FI((r={},r[l]=!0,r[l+"-with-marks"]=Object.keys(h).length,r[l+"-disabled"]=c,r[l+"-vertical"]=this.props.vertical,r[u]=!!u,r));return Pe("div",T({ref:this.sliderElement,className:_,onTouchStart:c?Df:this.onTouchStart,onMouseDown:c?Df:this.onMouseDown},{children:[B("div",{className:l+"-rail"},void 0),w]}),void 0)},t.defaultProps={prefixCls:"msp-slider-base",className:"",min:0,max:100,step:1,marks:{},handle:B(Xje,{className:"",vertical:!1,offset:0,tipFormatter:function(r){return r},value:0,index:0},void 0),onBeforeChange:Df,onChange:Df,onAfterChange:Df,tipFormatter:function(r,n){return r},disabled:!1,range:!1,vertical:!1,allowCross:!0,pushable:!1},t}(ke.exports.Component),Jn=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onChange=function(n){var a,i,o;if((o=(i=r.props).onChange)===null||o===void 0||o.call(i,n,r.props.values),r.props.onChangeValues){var s=T(T({},r.props.values),(a={},a[n.name]=n.value,a));r.props.onChangeValues(s,r.props.values)}},r.paramGroups=Sp(function(n){return Kje(n)}),r}return t.prototype.renderGroup=function(r){var n;if(r.length===0)return null;for(var a=this.props.values,i=null,o=void 0,s=0,u=r;s<u.length;s++){var l=u[s],c=l[0],d=l[1],f=l[2];!((n=d.hideIf)===null||n===void 0)&&n.call(d,a)||(i||(i=[]),o=d.category,i.push(B(f,{param:d,onChange:this.onChange,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled,name:c,value:a[c]},c)))}return i?o?[B(ul,T({header:o},{children:i}),o)]:i:null},t.prototype.renderPart=function(r){for(var n=null,a=0,i=r;a<i.length;a++){var o=i[a],s=this.renderGroup(o);if(!!s){n||(n=[]);for(var u=0,l=s;u<l.length;u++){var c=l[u];n.push(c)}}}return n},t.prototype.render=function(){var r=this.paramGroups(this.props.params),n=this.renderPart(r.essentials),a=this.renderPart(r.advanced);return n&&a?Pe(Nt,{children:[n,B(ul,T({header:"Advanced Options"},{children:a}),void 0)]},void 0):n||a},t}(ke.exports.PureComponent),Yje=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.setSettings=function(n,a){var i,o=T(T({},a),(i={},i[n.name]=n.value,i)),s=r.props.mapping.update(o,r.plugin);r.props.mapping.apply(s,r.plugin)},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.events.canvas3d.settingsUpdated,function(){return r.forceUpdate()})},t.prototype.render=function(){var r=this.props.mapping.getTarget(this.plugin),n=this.props.mapping.getValues(r,this.plugin),a=this.props.mapping.params(this.plugin);return B(Jn,{params:a,values:n,onChange:this.setSettings},void 0)},t}(Sr);function Kje(e){function t(c,d,f){var p=Mb(d);if(!!p)if(!d.category)f.params[0].push([c,d,p]);else{f.map||(f.map=new Map);var h=f.map.get(d.category);h||(h=[],f.map.set(d.category,h),f.params.push(h)),h.push([c,d,p])}}function r(c,d){var f=c[0],p=d[0];return!f||!f[1].category?-1:!p||!p[1].category?1:f[1].category<p[1].category?-1:1}for(var n=Object.keys(e),a={params:[[]],map:void 0},i={params:[[]],map:void 0},o=0,s=n;o<s.length;o++){var u=s[o],l=e[u];l.isHidden||(l.isEssential?t(u,l,a):t(u,l,i))}return a.params.sort(r),i.params.sort(r),{essentials:a.params,advanced:i.params}}function Mb(e){switch(e.type){case"value":return;case"boolean":return _R;case"number":return typeof e.min<"u"&&typeof e.max<"u"?Jje:Zje;case"converted":return bGe;case"conditioned":return yGe;case"multi-select":return mGe;case"color":return Lje;case"color-list":return e.offsets?lGe:uGe;case"vec3":return cGe;case"mat4":return dGe;case"url":return fGe;case"file":return pGe;case"file-list":return hGe;case"select":return AR;case"value-ref":return tGe;case"data-ref":return;case"text":return eGe;case"interval":return typeof e.min<"u"&&typeof e.max<"u"?nGe:rGe;case"group":return HQ;case"mapped":return vGe;case"line-graph":return Qje;case"script":return xGe;case"object-list":return ER;default:var t=e;console.warn(t+" has no associated UI component");return}}var $je=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.render=function(){var r=this.props,n=r.legend,a=r.description,i=n&&Vje(n);return B("div",T({className:"msp-help-text"},{children:Pe("div",{children:[Pe("div",T({className:"msp-help-description"},{children:[B(dn,{svg:cc,inline:!0},void 0),a]}),void 0),i&&B("div",T({className:"msp-help-legend"},{children:B(i,{legend:n},void 0)}),void 0)]},void 0)}),void 0)},t}(ke.exports.PureComponent);function Nm(e){var t=e.props,r=e.state,n=e.control,a=e.toggleHelp,i=e.addOn,o=[];t.param.shortLabel&&o.push("msp-control-label-short"),t.param.twoColumns&&o.push("msp-control-col-2");var s=o.join(" "),u=t.param.label||Ji(t.name),l=t.param.help?t.param.help(t.value):{description:t.param.description,legend:t.param.legend},c=l.description||l.legend,d=u+(c?". Click for help.":"");return Pe(Nt,{children:[B(yu,{className:s,title:d,label:Pe(Nt,{children:[u,c&&B("button",T({className:"msp-help msp-btn-link msp-btn-icon msp-control-group-expander",onClick:a,title:d||(r.showHelp?"Hide":"Show")+" help",style:{background:"transparent",textAlign:"left",padding:"0"}},{children:B(dn,{svg:cc},void 0)}),void 0)]},void 0),control:n},void 0),c&&r.showHelp&&B("div",T({className:"msp-control-offset"},{children:B($je,{legend:l.legend,description:l.description},void 0)}),void 0),i]},void 0)}var zm=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={showHelp:!1},r.toggleHelp=function(){return r.setState({showHelp:!r.state.showHelp})},r}return t.prototype.update=function(r){this.props.onChange({param:this.props.param,name:this.props.name,value:r})},t.prototype.renderAddOn=function(){return null},t.prototype.render=function(){return Nm({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:this.renderAddOn()})},t}(ke.exports.PureComponent),_R=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onClick=function(n){r.update(!r.props.value),n.currentTarget.blur()},r}return t.prototype.renderControl=function(){return Pe("button",T({onClick:this.onClick,disabled:this.props.isDisabled},{children:[B(dn,{svg:this.props.value?K0:RQ},void 0),this.props.value?"On":"Off"]}),void 0)},t}(zm),Qje=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!1,isOverPoint:!1,message:r.props.param.defaultValue.length+" points"},r.onHover=function(n){if(r.setState({isOverPoint:!r.state.isOverPoint}),n){r.setState({message:"("+n[0].toFixed(2)+", "+n[1].toFixed(2)+")"});return}r.setState({message:r.props.value.length+" points"})},r.onDrag=function(n){r.setState({message:"("+n[0].toFixed(2)+", "+n[1].toFixed(2)+")"})},r.onChange=function(n){r.props.onChange({name:r.props.name,param:r.props.param,value:n})},r.toggleExpanded=function(n){r.setState({isExpanded:!r.state.isExpanded}),n.currentTarget.blur()},r}return t.prototype.render=function(){var r=this.props.param.label||Ji(this.props.name);return Pe(Nt,{children:[B(yu,{label:r,control:B("button",T({onClick:this.toggleExpanded,disabled:this.props.isDisabled},{children:""+this.state.message}),void 0)},void 0),B("div",T({className:"msp-control-offset",style:{display:this.state.isExpanded?"block":"none"}},{children:B(qje,{data:this.props.param.defaultValue,onChange:this.onChange,onHover:this.onHover,onDrag:this.onDrag},void 0)}),void 0)]},void 0)},t}(ke.exports.PureComponent),Zje=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={value:"0"},r.update=function(n){var a=IC(r.props.param.step||.01);n=parseFloat(n.toFixed(a)),r.props.onChange({param:r.props.param,name:r.props.name,value:n})},r}return t.prototype.render=function(){var r=this.props.param.label||Ji(this.props.name),n=this.props.param.label||Ji(this.props.name),a=IC(this.props.param.step||.01);return B(yu,{title:this.props.param.description,label:n,control:B(ad,{numeric:!0,value:parseFloat(this.props.value.toFixed(a)),onEnter:this.props.onEnter,placeholder:r,isDisabled:this.props.isDisabled,onChange:this.update},void 0)},void 0)},t}(ke.exports.PureComponent),Jje=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onChange=function(n){r.update(n)},r}return t.prototype.renderControl=function(){var r=typeof this.props.value>"u"?this.props.param.defaultValue:this.props.value;return B(zQ,{value:r,min:this.props.param.min,max:this.props.param.max,step:this.props.param.step,onChange:this.onChange,onChangeImmediate:this.props.param.immediateUpdate?this.onChange:void 0,disabled:this.props.isDisabled,onEnter:this.props.onEnter},void 0)},t}(zm),eGe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onChange=function(n){var a=n.target.value;a!==r.props.value&&r.update(a)},r.onKeyPress=function(n){(n.keyCode===13||n.charCode===13||n.key==="Enter")&&r.props.onEnter&&r.props.onEnter(),n.stopPropagation()},r}return t.prototype.renderControl=function(){var r=this.props.param.label||Ji(this.props.name);return B("input",{type:"text",value:this.props.value||"",placeholder:r,onChange:this.onChange,onKeyPress:this.props.onEnter?this.onKeyPress:void 0,disabled:this.props.isDisabled},void 0)},t}(zm),hv=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onChange=function(n){typeof r.props.param.defaultValue=="number"?r.update(parseInt(n.target.value,10)):r.update(n.target.value)},r}return t.prototype.update=function(r){this.props.onChange({param:this.props.param,name:this.props.name,value:r})},t.prototype.render=function(){var r=this,n=this.props.value!==void 0&&!this.props.param.options.some(function(a){return a[0]===r.props.value});return Pe("select",T({className:"msp-form-control",title:this.props.title,value:this.props.value!==void 0?this.props.value:this.props.param.defaultValue,onChange:this.onChange,disabled:this.props.isDisabled},{children:[n&&B("option",T({value:this.props.value},{children:"[Invalid] "+this.props.value}),this.props.value),this.props.param.options.map(function(a){var i=a[0],o=a[1];return B("option",T({value:i},{children:o}),i)})]}),void 0)},t}(ke.exports.PureComponent),AR=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={showHelp:!1,showOptions:!1},r.onSelect=function(n){!n||n.value===r.props.value?r.setState({showOptions:!1}):r.setState({showOptions:!1},function(){r.props.onChange({param:r.props.param,name:r.props.name,value:n.value})})},r.toggle=function(){return r.setState({showOptions:!r.state.showOptions})},r.cycle=function(){var n=r.props.param.options,a=n.findIndex(function(o){return o[0]===r.props.value}),i=a===n.length-1?0:a+1;r.props.onChange({param:r.props.param,name:r.props.name,value:n[i][0]})},r.items=Sp(function(n){return ir.createItemsFromSelectOptions(n.options)}),r.toggleHelp=function(){return r.setState({showHelp:!r.state.showHelp})},r}return t.prototype.renderControl=function(){var r,n=this.items(this.props.param),a=this.props.value!==void 0?ir.findItem(n,this.props.value):void 0,i=a?a.label:typeof this.props.value>"u"?(((r=ir.getFirstItem(n))===null||r===void 0?void 0:r.label)||"")+" [Default]":"[Invalid] "+this.props.value,o=this.props.param.cycle?this.cycle:this.toggle,s=this.props.param.cycle?"center":"left",u=this.props.param.cycle?this.props.value==="on"?K0:this.props.value==="off"?RQ:void 0:void 0;return B(Wa,{disabled:this.props.isDisabled,style:{textAlign:s,overflow:"hidden",textOverflow:"ellipsis"},label:i,title:i,icon:u,toggle:o,isSelected:this.state.showOptions},void 0)},t.prototype.renderAddOn=function(){if(!this.state.showOptions)return null;var r=this.items(this.props.param),n=ir.findItem(r,this.props.value);return B(ir,{items:r,current:n,onSelect:this.onSelect},void 0)},t.prototype.render=function(){return Nm({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:this.renderAddOn()})},t}(ke.exports.PureComponent),tGe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={showHelp:!1,showOptions:!1},r.onSelect=function(n){!n||n.value===r.props.value?r.setState({showOptions:!1}):r.setState({showOptions:!1},function(){r.props.onChange({param:r.props.param,name:r.props.name,value:{ref:n.value}})})},r.toggle=function(){return r.setState({showOptions:!r.state.showOptions})},r.items=Sp(function(n){return ir.createItemsFromSelectOptions(n.getOptions())}),r.toggleHelp=function(){return r.setState({showHelp:!r.state.showHelp})},r}return t.prototype.renderControl=function(){var r,n=this.items(this.props.param),a=this.props.value.ref?ir.findItem(n,this.props.value.ref):void 0,i=a?a.label:"[Ref] "+((r=this.props.value.ref)!==null&&r!==void 0?r:"");return B(Wa,{disabled:this.props.isDisabled,style:{textAlign:"left",overflow:"hidden",textOverflow:"ellipsis"},label:i,title:i,toggle:this.toggle,isSelected:this.state.showOptions},void 0)},t.prototype.renderAddOn=function(){if(!this.state.showOptions)return null;var r=this.items(this.props.param),n=ir.findItem(r,this.props.value.ref);return B(ir,{items:r,current:n,onSelect:this.onSelect},void 0)},t.prototype.render=function(){return Nm({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:this.renderAddOn()})},t}(ke.exports.PureComponent),rGe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!1},r.components={0:M.Numeric(0,{step:r.props.param.step},{label:"Min"}),1:M.Numeric(0,{step:r.props.param.step},{label:"Max"})},r.componentChange=function(n){var a=n.name,i=n.value,o=Gt([],r.props.value);o[+a]=i,r.change(o)},r.toggleExpanded=function(n){r.setState({isExpanded:!r.state.isExpanded}),n.currentTarget.blur()},r}return t.prototype.change=function(r){this.props.onChange({name:this.props.name,param:this.props.param,value:r})},t.prototype.render=function(){var r=this.props.value,n=this.props.param.label||Ji(this.props.name),a=IC(this.props.param.step||.01),i="["+r[0].toFixed(a)+", "+r[1].toFixed(a)+"]";return Pe(Nt,{children:[B(yu,{label:n,control:B("button",T({onClick:this.toggleExpanded,disabled:this.props.isDisabled},{children:i}),void 0)},void 0),this.state.isExpanded&&B("div",T({className:"msp-control-offset"},{children:B(Jn,{params:this.components,values:r,onChange:this.componentChange,onEnter:this.props.onEnter},void 0)}),void 0)]},void 0)},t}(ke.exports.PureComponent),nGe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onChange=function(n){r.update(n)},r}return t.prototype.renderControl=function(){return B(Wje,{value:this.props.value,min:this.props.param.min,max:this.props.param.max,step:this.props.param.step,onChange:this.onChange,disabled:this.props.isDisabled,onEnter:this.props.onEnter},void 0)},t}(zm);(function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onChange=function(n){r.update(vt(parseInt(n.target.value)))},r}return t.prototype.stripStyle=function(){return{background:vt.toStyle(this.props.value),position:"absolute",bottom:"0",height:"4px",right:"0",left:"0"}},t.prototype.renderControl=function(){return Pe("div",T({style:{position:"relative"}},{children:[Pe("select",T({value:this.props.value,onChange:this.onChange},{children:[Uje(this.props.value),Nje()]}),void 0),B("div",{style:this.stripStyle()},void 0)]}),void 0)},t})(zm);function sy(e,t){return t===void 0&&(t=!1),Array.isArray(e)?t?vt.toStyle(e[0])+" "+(100*e[1]).toFixed(2)+"%":vt.toStyle(e[0]):vt.toStyle(e)}var aGe=a_(function(e){var t=e.map(function(r){return sy(r,!0)});return"linear-gradient(to right, "+t.join(", ")+")"}),iGe=a_(function(e){for(var t=e.length,r=[sy(e[0])+" "+100*(1/t)+"%"],n=1,a=t-1;n<a;++n)r.push(sy(e[n])+" "+100*(n/t)+"%",sy(e[n])+" "+100*((n+1)/t)+"%");return r.push(sy(e[t-1])+" "+100*((t-1)/t)+"%"),"linear-gradient(to right, "+r.join(", ")+")"});function TR(e,t){return t===void 0&&(t="0"),{background:oGe(e.colors,e.kind==="set"),position:"absolute",bottom:"0",height:"4px",right:t,left:"0"}}function oGe(e,t){return t?iGe(e):aGe(e)}function sGe(){var e=function(t){var r=fu(t[0]);return B("div",{style:TR({kind:r.type!=="qualitative"?"interpolate":"set",colors:r.list})},void 0)};return{ColorPresets:{all:ir.createItemsFromSelectOptions(ND,{addOn:e}),scale:ir.createItemsFromSelectOptions(Tge,{addOn:e}),set:ir.createItemsFromSelectOptions(Ege,{addOn:e})},ColorsParam:M.ObjectList({color:M.Color(0)},function(t){var r=t.color;return vt.toHexString(r).toUpperCase()}),OffsetColorsParam:M.ObjectList({color:M.Color(0),offset:M.Numeric(0,{min:0,max:1,step:.01})},function(t){var r=t.color,n=t.offset;return vt.toHexString(r).toUpperCase()+" ["+n.toFixed(2)+"]"}),IsInterpolatedParam:M.Boolean(!1,{label:"Interpolated"})}}var mx;function VQ(){return mx||(mx=sGe(),mx)}var uGe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={showHelp:!1,show:void 0},r.toggleEdit=function(){return r.setState({show:r.state.show==="edit"?void 0:"edit"})},r.togglePresets=function(){return r.setState({show:r.state.show==="presets"?void 0:"presets"})},r.selectPreset=function(n){if(!!n){r.setState({show:void 0});var a=fu(n.value);r.update({kind:a.type!=="qualitative"?"interpolate":"set",colors:a.list})}},r.colorsChanged=function(n){var a=n.value;r.update({kind:r.props.value.kind,colors:a.map(function(i){return i.color})})},r.isInterpolatedChanged=function(n){var a=n.value;r.update({kind:a?"interpolate":"set",colors:r.props.value.colors})},r.toggleHelp=function(){return r.setState({showHelp:!r.state.showHelp})},r}return t.prototype.update=function(r){this.props.onChange({param:this.props.param,name:this.props.name,value:r})},t.prototype.renderControl=function(){var r=this.props.value;return Pe(Nt,{children:[Pe("button",T({onClick:this.toggleEdit,style:{position:"relative",paddingRight:"33px"}},{children:[r.colors.length===1?"1 color":r.colors.length+" colors",B("div",{style:TR(r,"33px")},void 0)]}),void 0),B(Zt,{svg:O_,onClick:this.togglePresets,toggleState:this.state.show==="presets",title:"Color Presets",style:{padding:0,position:"absolute",right:0,top:0,width:"32px"}},void 0)]},void 0)},t.prototype.renderColors=function(){if(!this.state.show)return null;var r=VQ(),n=r.ColorPresets,a=r.ColorsParam,i=r.IsInterpolatedParam,o=n[this.props.param.presetKind];if(this.state.show==="presets")return B(ir,{items:o,onSelect:this.selectPreset},void 0);var s=this.props.value.colors.map(function(u){return{color:u}});return Pe("div",T({className:"msp-control-offset"},{children:[B(ER,{name:"colors",param:a,value:s,onChange:this.colorsChanged,isDisabled:this.props.isDisabled,onEnter:this.props.onEnter},void 0),B(_R,{name:"isInterpolated",param:i,value:this.props.value.kind==="interpolate",onChange:this.isInterpolatedChanged,isDisabled:this.props.isDisabled,onEnter:this.props.onEnter},void 0)]}),void 0)},t.prototype.render=function(){return Nm({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:this.renderColors()})},t}(ke.exports.PureComponent),lGe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={showHelp:!1,show:void 0},r.toggleEdit=function(){return r.setState({show:r.state.show==="edit"?void 0:"edit"})},r.togglePresets=function(){return r.setState({show:r.state.show==="presets"?void 0:"presets"})},r.selectPreset=function(n){if(!!n){r.setState({show:void 0});var a=fu(n.value);r.update({kind:a.type!=="qualitative"?"interpolate":"set",colors:a.list})}},r.colorsChanged=function(n){var a=n.value,i=a.map(function(o){return[o.color,o.offset]});i.sort(function(o,s){return o[1]-s[1]}),r.update({kind:r.props.value.kind,colors:i})},r.isInterpolatedChanged=function(n){var a=n.value;r.update({kind:a?"interpolate":"set",colors:r.props.value.colors})},r.toggleHelp=function(){return r.setState({showHelp:!r.state.showHelp})},r}return t.prototype.update=function(r){this.props.onChange({param:this.props.param,name:this.props.name,value:r})},t.prototype.renderControl=function(){var r=this.props.value;return Pe(Nt,{children:[Pe("button",T({onClick:this.toggleEdit,style:{position:"relative",paddingRight:"33px"}},{children:[r.colors.length===1?"1 color":r.colors.length+" colors",B("div",{style:TR(r,"33px")},void 0)]}),void 0),B(Zt,{svg:O_,onClick:this.togglePresets,toggleState:this.state.show==="presets",title:"Color Presets",style:{padding:0,position:"absolute",right:0,top:0,width:"32px"}},void 0)]},void 0)},t.prototype.renderColors=function(){if(!this.state.show)return null;var r=VQ(),n=r.ColorPresets,a=r.OffsetColorsParam,i=r.IsInterpolatedParam,o=n[this.props.param.presetKind];if(this.state.show==="presets")return B(ir,{items:o,onSelect:this.selectPreset},void 0);var s=this.props.value.colors,u=s.map(function(l,c){return Array.isArray(l)?{color:l[0],offset:l[1]}:{color:l,offset:c/s.length}});return u.sort(function(l,c){return l.offset-c.offset}),Pe("div",T({className:"msp-control-offset"},{children:[B(ER,{name:"colors",param:a,value:u,onChange:this.colorsChanged,isDisabled:this.props.isDisabled,onEnter:this.props.onEnter},void 0),B(_R,{name:"isInterpolated",param:i,value:this.props.value.kind==="interpolate",onChange:this.isInterpolatedChanged,isDisabled:this.props.isDisabled,onEnter:this.props.onEnter},void 0)]}),void 0)},t.prototype.render=function(){return Nm({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:this.renderColors()})},t}(ke.exports.PureComponent),cGe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!1},r.components={0:M.Numeric(0,{step:r.props.param.step},{label:r.props.param.fieldLabels&&r.props.param.fieldLabels.x||"X"}),1:M.Numeric(0,{step:r.props.param.step},{label:r.props.param.fieldLabels&&r.props.param.fieldLabels.y||"Y"}),2:M.Numeric(0,{step:r.props.param.step},{label:r.props.param.fieldLabels&&r.props.param.fieldLabels.z||"Z"})},r.componentChange=function(n){var a=n.name,i=n.value,o=A.copy(A.zero(),r.props.value);o[+a]=i,r.change(o)},r.toggleExpanded=function(n){r.setState({isExpanded:!r.state.isExpanded}),n.currentTarget.blur()},r}return t.prototype.change=function(r){this.props.onChange({name:this.props.name,param:this.props.param,value:r})},t.prototype.render=function(){var r=this.props.value,n=this.props.param.label||Ji(this.props.name),a=IC(this.props.param.step||.01),i="["+r[0].toFixed(a)+", "+r[1].toFixed(a)+", "+r[2].toFixed(a)+"]";return Pe(Nt,{children:[B(yu,{label:n,control:B("button",T({onClick:this.toggleExpanded,disabled:this.props.isDisabled},{children:i}),void 0)},void 0),this.state.isExpanded&&B("div",T({className:"msp-control-offset"},{children:B(Jn,{params:this.components,values:r,onChange:this.componentChange,onEnter:this.props.onEnter},void 0)}),void 0)]},void 0)},t}(ke.exports.PureComponent),dGe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!1},r.components={json:M.Text(JSON.stringify(de()),{description:"JSON array with 4x4 matrix in a column major (j * 4 + i indexing) format"})},r.componentChange=function(n){var a=n.name,i=n.value,o=de.copy(de(),r.props.value);a==="json"?de.copy(o,JSON.parse(i)):o[+a]=i,r.change(o)},r.toggleExpanded=function(n){r.setState({isExpanded:!r.state.isExpanded}),n.currentTarget.blur()},r}return t.prototype.change=function(r){this.props.onChange({name:this.props.name,param:this.props.param,value:r})},t.prototype.changeValue=function(r){var n=this;return function(a){var i=de.copy(de(),n.props.value);i[r]=a,n.change(i)}},Object.defineProperty(t.prototype,"grid",{get:function(){for(var r=this.props.value,n=[],a=0;a<4;a++){for(var i=[],o=0;o<4;o++)i.push(B(ad,{numeric:!0,delayMs:50,value:de.getValue(r,a,o),onChange:this.changeValue(4*o+a),className:"msp-form-control",blurOnEnter:!0,isDisabled:this.props.isDisabled},o));n.push(B("div",T({className:"msp-flex-row"},{children:i}),a))}return B("div",T({className:"msp-parameter-matrix"},{children:n}),void 0)},enumerable:!1,configurable:!0}),t.prototype.render=function(){var r={json:JSON.stringify(this.props.value)},n=this.props.param.label||Ji(this.props.name);return Pe(Nt,{children:[B(yu,{label:n,control:B("button",T({onClick:this.toggleExpanded,disabled:this.props.isDisabled},{children:"4\xD74 Matrix"}),void 0)},void 0),this.state.isExpanded&&Pe("div",T({className:"msp-control-offset"},{children:[this.grid,B(Jn,{params:this.components,values:r,onChange:this.componentChange,onEnter:this.props.onEnter},void 0)]}),void 0)]},void 0)},t}(ke.exports.PureComponent),fGe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onChange=function(n){var a=n.target.value;a!==Fn.getUrl(r.props.value||"")&&r.update(Fn.Url(a))},r.onKeyPress=function(n){(n.keyCode===13||n.charCode===13||n.key==="Enter")&&r.props.onEnter&&r.props.onEnter(),n.stopPropagation()},r}return t.prototype.renderControl=function(){var r=this.props.param.label||Ji(this.props.name);return B("input",{type:"text",value:Fn.getUrl(this.props.value||""),placeholder:r,onChange:this.onChange,onKeyPress:this.props.onEnter?this.onKeyPress:void 0,disabled:this.props.isDisabled},void 0)},t}(zm),pGe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={showHelp:!1},r.onChangeFile=function(n){r.change(n.target.files[0])},r.toggleHelp=function(){return r.setState({showHelp:!r.state.showHelp})},r}return t.prototype.change=function(r){this.props.onChange({name:this.props.name,param:this.props.param,value:Fn.File(r)})},t.prototype.renderControl=function(){var r=this.props.value;return Pe("div",T({className:"msp-btn msp-btn-block msp-btn-action msp-loader-msp-btn-file",style:{marginTop:"1px"}},{children:[r?r.name:"Select a file..."," ",B("input",{disabled:this.props.isDisabled,onChange:this.onChangeFile,type:"file",multiple:!1,accept:this.props.param.accept},void 0)]}),void 0)},t.prototype.render=function(){return this.props.param.label?Nm({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:null}):this.renderControl()},t}(ke.exports.PureComponent),hGe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={showHelp:!1},r.onChangeFileList=function(n){r.change(n.target.files)},r.toggleHelp=function(){return r.setState({showHelp:!r.state.showHelp})},r}return t.prototype.change=function(r){var n=[];if(r)for(var a=0,i=r.length;a<i;++a)n.push(Fn.File(r[a]));this.props.onChange({name:this.props.name,param:this.props.param,value:n})},t.prototype.renderControl=function(){var r=this.props.value,n=[];if(r)for(var a=0,i=r;a<i.length;a++){var o=i[a];n.push(o.name)}var s=n.length===0?"Select files...":n.length===1?n[0]:n.length+" files selected";return Pe("div",T({className:"msp-btn msp-btn-block msp-btn-action msp-loader-msp-btn-file",style:{marginTop:"1px"}},{children:[s," ",B("input",{disabled:this.props.isDisabled,onChange:this.onChangeFileList,type:"file",multiple:!0,accept:this.props.param.accept},void 0)]}),void 0)},t.prototype.render=function(){return this.props.param.label?Nm({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:null}):this.renderControl()},t}(ke.exports.PureComponent),mGe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!1},r.toggleExpanded=function(n){r.setState({isExpanded:!r.state.isExpanded}),n.currentTarget.blur()},r}return t.prototype.change=function(r){this.props.onChange({name:this.props.name,param:this.props.param,value:r})},t.prototype.toggle=function(r){var n=this;return function(a){n.props.value.indexOf(r)<0?n.change(n.props.value.concat(r)):n.change(n.props.value.filter(function(i){return i!==r})),a.currentTarget.blur()}},t.prototype.render=function(){var r=this,n=this.props.value,a=this.props.param.emptyValue,i=this.props.param.label||Ji(this.props.name);return Pe(Nt,{children:[B(yu,{label:i,control:B("button",T({onClick:this.toggleExpanded,disabled:this.props.isDisabled},{children:n.length===0&&a?a:n.length+" of "+this.props.param.options.length}),void 0)},void 0),this.state.isExpanded&&B("div",T({className:"msp-control-offset"},{children:this.props.param.options.map(function(o){var s=o[0],u=o[1],l=n.indexOf(s)>=0;return B(xr,T({onClick:r.toggle(s),disabled:r.props.isDisabled,style:{marginTop:"1px"}},{children:B("span",T({style:{float:l?"left":"right"}},{children:l?"\u2713 "+u:u+" \u2717"}),void 0)}),s)})}),void 0)]},void 0)},t}(ke.exports.PureComponent),HQ=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!!r.props.param.isExpanded,showHelp:!1},r.onChangeParam=function(n){var a;r.change(T(T({},r.props.value),(a={},a[n.name]=n.value,a)))},r.toggleExpanded=function(){return r.setState({isExpanded:!r.state.isExpanded})},r}return t.prototype.change=function(r){this.props.onChange({name:this.props.name,param:this.props.param,value:r})},t.prototype.pivoted=function(){var r=this.props.param.pivot,n=this.props.param.params,a=n[r],i=Mb(a),o=B(i,{name:r,param:a,value:this.props.value[r],onChange:this.onChangeParam,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled},void 0);if(!this.state.isExpanded)return Pe("div",T({className:"msp-mapped-parameter-group"},{children:[o,B(Zt,{svg:mm,onClick:this.toggleExpanded,toggleState:this.state.isExpanded,title:"More Options"},void 0)]}),void 0);for(var s=Object.create(null),u=0,l=Object.keys(n);u<l.length;u++){var c=l[u];c!==r&&(s[c]=n[c])}return Pe("div",T({className:"msp-mapped-parameter-group"},{children:[o,B(Zt,{svg:mm,onClick:this.toggleExpanded,toggleState:this.state.isExpanded,title:"More Options"},void 0),B("div",T({className:"msp-control-offset"},{children:B(Jn,{params:s,onEnter:this.props.onEnter,values:this.props.value,onChange:this.onChangeParam,isDisabled:this.props.isDisabled},void 0)}),void 0)]}),void 0)},t.prototype.render=function(){var r=this.props.param.params;if(Object.keys(r).length===0)return null;if(this.props.param.pivot)return this.pivoted();var n=this.props.param.label||Ji(this.props.name),a=B(Jn,{params:r,onChange:this.onChangeParam,values:this.props.value,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled},void 0);return this.props.inMapped?B("div",T({className:"msp-control-offset"},{children:a}),void 0):this.props.param.isFlat?a:Pe("div",T({className:"msp-control-group-wrapper"},{children:[B("div",T({className:"msp-control-group-header"},{children:Pe("button",T({className:"msp-btn msp-form-control msp-btn-block",onClick:this.toggleExpanded},{children:[B(dn,{svg:this.state.isExpanded?Td:Ed},void 0),n]}),void 0)}),void 0),this.state.isExpanded&&B("div",T({className:"msp-control-offset"},{children:a}),void 0)]}),void 0)},t}(ke.exports.PureComponent),vGe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!1},r.valuesCache={},r.onChangeName=function(n){r.change({name:n.value,params:r.getValues(n.value)})},r.onChangeParam=function(n){r.setValues(r.props.value.name,n.value),r.change({name:r.props.value.name,params:n.value})},r.toggleExpanded=function(){return r.setState({isExpanded:!r.state.isExpanded})},r}return t.prototype.setValues=function(r,n){this.valuesCache[r]=n},t.prototype.getValues=function(r){return r in this.valuesCache?this.valuesCache[r]:this.props.param.map(r).defaultValue},t.prototype.change=function(r){this.props.onChange({name:this.props.name,param:this.props.param,value:r})},t.prototype.areParamsEmpty=function(r){for(var n=0,a=Object.keys(r);n<a.length;n++){var i=a[n];if(!r[i].isHidden)return!1}return!0},t.prototype.render=function(){var r=this,n=this.props.value||this.props.param.defaultValue,a=this.props.param.map(n.name),i=this.props.param.label||Ji(this.props.name),o=Mb(a),s=this.props.param.help,u=s?T(T({},this.props.param.select),{help:function(c){return s({name:c,params:r.getValues(c)})}}):this.props.param.select,l=B(AR,{param:u,isDisabled:this.props.isDisabled,onChange:this.onChangeName,onEnter:this.props.onEnter,name:i,value:n.name},void 0);return o?a.type==="group"&&!a.isFlat?this.areParamsEmpty(a.params)?l:Pe("div",T({className:"msp-mapped-parameter-group"},{children:[l,B(Zt,{svg:mm,onClick:this.toggleExpanded,toggleState:this.state.isExpanded,title:i+" Properties"},void 0),this.state.isExpanded&&B(HQ,{inMapped:!0,param:a,value:n.params,name:n.name,onChange:this.onChangeParam,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled},void 0)]}),void 0):Pe(Nt,{children:[l,B(o,{param:a,value:n.params,name:n.name,onChange:this.onChangeParam,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled},void 0)]},void 0):l},t}(ke.exports.PureComponent),jQ=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={current:r.props.value},r.onChangeParam=function(n){var a;r.setState({current:T(T({},r.state.current),(a={},a[n.name]=n.value,a))})},r.apply=function(){r.props.apply(r.state.current)},r}return t.prototype.componentDidUpdate=function(r){(this.props.params!==r.params||this.props.value!==r.value)&&this.setState({current:this.props.value})},t.prototype.render=function(){return Pe(Nt,{children:[B(Jn,{params:this.props.params,onChange:this.onChangeParam,values:this.state.current,onEnter:this.apply,isDisabled:this.props.isDisabled},void 0),B("button",T({className:"msp-btn msp-btn-block msp-form-control msp-control-top-offset",onClick:this.apply,disabled:this.props.isDisabled},{children:this.props.isUpdate?"Update":"Add"}),void 0)]},void 0)},t}(ke.exports.PureComponent),gGe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!1},r.update=function(n){r.props.actions.update(n,r.props.index)},r.moveUp=function(){r.props.actions.move(r.props.index,-1)},r.moveDown=function(){r.props.actions.move(r.props.index,1)},r.remove=function(){r.setState({isExpanded:!1}),r.props.actions.remove(r.props.index)},r.toggleExpanded=function(n){r.setState({isExpanded:!r.state.isExpanded}),n.currentTarget.blur()},r}return t.prototype.render=function(){return Pe(Nt,{children:[Pe("div",T({className:"msp-param-object-list-item"},{children:[Pe("button",T({className:"msp-btn msp-btn-block msp-form-control",onClick:this.toggleExpanded},{children:[B("span",{children:this.props.index+1+": "},void 0),this.props.param.getLabel(this.props.value)]}),void 0),Pe("div",{children:[B(Zt,{svg:k_,title:"Move Up",onClick:this.moveUp,small:!0},void 0),B(Zt,{svg:R_,title:"Move Down",onClick:this.moveDown,small:!0},void 0),B(Zt,{svg:Cu,title:"Remove",onClick:this.remove,small:!0},void 0)]},void 0)]}),void 0),this.state.isExpanded&&B("div",T({className:"msp-control-offset"},{children:B(jQ,{params:this.props.param.element,apply:this.update,value:this.props.value,isUpdate:!0,isDisabled:this.props.isDisabled},void 0)}),void 0)]},void 0)},t}(ke.exports.PureComponent),ER=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!1},r.add=function(n){r.change(Gt(Gt([],r.props.value),[n]))},r.actions={update:function(n,a){var i=r.props.value.slice(0);i[a]=n,r.change(i)},move:function(n,a){var i=r.props.value;if(i.length!==1){var o=(n+a)%i.length;o<0&&(o+=i.length),i=i.slice(0);var s=i[n];i[n]=i[o],i[o]=s,r.change(i)}},remove:function(n){for(var a=r.props.value,i=[],o=0;o<a.length;o++)n!==o&&i.push(a[o]);r.change(i)}},r.toggleExpanded=function(n){r.setState({isExpanded:!r.state.isExpanded}),n.currentTarget.blur()},r}return t.prototype.change=function(r){this.props.onChange({name:this.props.name,param:this.props.param,value:r})},t.prototype.render=function(){var r=this,n=this.props.value,a=this.props.param.label||Ji(this.props.name),i=n.length+" item"+(n.length!==1?"s":"");return Pe(Nt,{children:[B(yu,{label:a,control:B("button",T({onClick:this.toggleExpanded,disabled:this.props.isDisabled},{children:i}),void 0)},void 0),this.state.isExpanded&&Pe("div",T({className:"msp-control-offset"},{children:[this.props.value.map(function(o,s){return B(gGe,{param:r.props.param,value:o,index:s,actions:r.actions,isDisabled:r.props.isDisabled},s)}),B(Zc,T({header:"New Item"},{children:B(jQ,{params:this.props.param.element,apply:this.add,value:this.props.param.ctor(),isDisabled:this.props.isDisabled},void 0)}),void 0)]}),void 0)]},void 0)},t}(ke.exports.PureComponent),yGe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onChangeCondition=function(n){r.change(r.props.param.conditionedValue(r.props.value,n.value))},r.onChangeParam=function(n){r.change(n.value)},r}return t.prototype.change=function(r){this.props.onChange({name:this.props.name,param:this.props.param,value:r})},t.prototype.render=function(){var r=this.props.value,n=this.props.param.conditionForValue(r),a=this.props.param.conditionParams[n],i=this.props.param.label||Ji(this.props.name),o=Mb(a),s=B(AR,{param:this.props.param.select,isDisabled:this.props.isDisabled,onChange:this.onChangeCondition,onEnter:this.props.onEnter,name:i+" Kind",value:n},void 0);return o?Pe(Nt,{children:[s,B(o,{param:a,value:r,name:i,onChange:this.onChangeParam,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled},void 0)]},void 0):s},t}(ke.exports.PureComponent),bGe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onChange=function(n){r.props.onChange({name:r.props.name,param:r.props.param,value:r.props.param.toValue(n.value)})},r}return t.prototype.render=function(){var r=this.props.param.fromValue(this.props.value),n=Mb(this.props.param.converted);return n?B(n,{param:this.props.param.converted,value:r,name:this.props.name,onChange:this.onChange,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled},void 0):null},t}(ke.exports.PureComponent),xGe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onChange=function(n){var a=n.target.value;a!==r.props.value.expression&&r.update({language:r.props.value.language,expression:a})},r.onKeyPress=function(n){(n.keyCode===13||n.charCode===13||n.key==="Enter")&&r.props.onEnter&&r.props.onEnter(),n.stopPropagation()},r}return t.prototype.renderControl=function(){var r=this.props.param.label||Ji(this.props.name);return B("input",{type:"text",value:this.props.value.expression||"",placeholder:r,onChange:this.onChange,onKeyPress:this.props.onEnter?this.onKeyPress:void 0,disabled:this.props.isDisabled},void 0)},t}(zm),SGe={color:M.Color(gr.black,{description:"Display color of the volume."}),wireframe:M.Boolean(!1,{description:"Control display of the volume as a wireframe."}),opacity:M.Numeric(.3,{min:0,max:1,step:.01},{description:"Opacity of the volume."})},CGe=new Map([["em",[-5,5]],["2fo-fc",[0,3]],["fo-fc(+ve)",[1,5]],["fo-fc(-ve)",[-5,-1]]]),vx=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.ref=lr.findTagInSubtree(r.plugin.state.data.tree,r.props.bCell.transform.ref,r.props.name),r.getVisible=function(){var n=r.plugin.state.data,a=r.ref;return a?!n.cells.get(a).state.isHidden:!1},r.toggleVisible=function(){var n=r.plugin.state.data,a=r.ref;!a||pm(n,a,!n.cells.get(a).state.isHidden)},r}return t.prototype.componentDidUpdate=function(){this.ref=lr.findTagInSubtree(this.plugin.state.data.tree,this.props.bCell.transform.ref,this.props.name)},t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.data.events.cell.stateUpdated,function(n){r.ref===n.ref&&r.forceUpdate()})},t.prototype.render=function(){var r=this.props,n=r.isRelative,a=r.stats,i=r.channels[r.name],o=a.min,s=a.max,u=a.mean,l=a.sigma,c=Math.round(100*(i.isoValue.kind==="relative"?i.isoValue.relativeValue:i.isoValue.absoluteValue))/100,d=(o-u)/l,f=(s-u)/l;if(!this.props.isUnbounded){var p=CGe.get(this.props.name);this.props.name==="em"?(d=Math.max(p[0],d),f=Math.min(p[1],f)):(d=p[0],f=p[1])}var h=u+l*d,m=u+l*f,v=e5(n?Math.round((m-h)/l)/100:l/100,2),g=n?d:h,y=n?f:m;return B(Bje,{label:r.label+(r.isRelative?" \u03C3":""),colorStripe:i.color,pivot:Pe("div",T({className:"msp-volume-channel-inline-controls"},{children:[B(zQ,{value:c,min:g,max:y,step:v,onChange:function(b){return r.changeIso(r.name,b,n)},disabled:r.params.isDisabled,onEnter:r.params.events.onEnter},void 0),B(Zt,{svg:this.getVisible()?Lm:Fm,onClick:this.toggleVisible,toggleState:!1,disabled:r.params.isDisabled},void 0)]}),void 0),controls:B(Jn,{onChange:function(b){var S=b.name,x=b.value;return r.changeParams(r.name,S,x)},params:SGe,values:i,onEnter:r.params.events.onEnter,isDisabled:r.params.isDisabled},void 0)},void 0)},t}(Sr),wGe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.changeIso=function(n,a,i){var o,s=r.props.params;r.newParams(T(T({},s),{entry:{name:s.entry.name,params:T(T({},s.entry.params),{channels:T(T({},s.entry.params.channels),(o={},o[n]=T(T({},s.entry.params.channels[n]),{isoValue:i?It.IsoValue.relative(a):It.IsoValue.absolute(a)}),o))})}}))},r.changeParams=function(n,a,i){var o,s,u=r.props.params;r.newParams(T(T({},u),{entry:{name:u.entry.name,params:T(T({},u.entry.params),{channels:T(T({},u.entry.params.channels),(o={},o[n]=T(T({},u.entry.params.channels[n]),(s={},s[a]=i,s)),o))})}}))},r.changeOption=function(n){var a=n.name,i=n.value,o=r.props.params;if(a==="entry")r.newParams(T(T({},o),{entry:{name:i,params:o.entry.params}}));else{var s=r.props.b.data,u=s.info.kind==="em",l=i.params.isRelative,c=s.info.header.sampling[0],d=o.entry.params.channels,f=o.entry.params.view.name===i.name?o.entry.params.view.params:r.props.info.params.entry.map(o.entry.name).params.view.map(i.name).defaultValue,p=T({},f);i.name==="selection-box"?p.radius=i.params.radius:i.name==="box"?(p.bottomLeft=i.params.bottomLeft,p.topRight=i.params.topRight):i.name==="auto"&&(p.radius=i.params.radius,p.selectionDetailLevel=i.params.selectionDetailLevel),p.isUnbounded=!!i.params.isUnbounded,r.newParams(T(T({},o),{entry:{name:o.entry.name,params:T(T({},o.entry.params),{view:{name:i.name,params:p},detailLevel:i.params.detailLevel,channels:u?{em:r.convert(d.em,c.valuesInfo[0],l)}:{"2fo-fc":r.convert(d["2fo-fc"],c.valuesInfo[0],l),"fo-fc(+ve)":r.convert(d["fo-fc(+ve)"],c.valuesInfo[1],l),"fo-fc(-ve)":r.convert(d["fo-fc(-ve)"],c.valuesInfo[1],l)}})}}))}},r}return t.prototype.areInitial=function(r){return M.areEqual(this.props.info.params,r,this.props.info.initialValues)},t.prototype.newParams=function(r){this.props.events.onChange(r,this.areInitial(r))},t.prototype.convert=function(r,n,a){return T(T({},r),{isoValue:a?It.IsoValue.toRelative(r.isoValue,n):It.IsoValue.toAbsolute(r.isoValue,n)})},t.prototype.render=function(){if(!this.props.b)return null;var r=this.props.b.data,n=r.info.kind==="em",a=n?"em":"2fo-fc",i=this.props.params,o=this.props.info.params.entry.map(i.entry.name),s=o.params.detailLevel,u=i.entry.params.channels[a].isoValue.kind==="relative",l=r.info.header.sampling[0],c=M.Boolean(u,{description:"Use normalized or absolute isocontour scale.",label:"Normalized"}),d=!!i.entry.params.view.params.isUnbounded,f=M.Boolean(d,{description:"Show full/limited range of iso-values for more fine-grained control.",label:"Unbounded"}),p=i.entry.params.view.name==="off",h={entry:M.Select(i.entry.name,r.data.entries.map(function(v){return[v.dataId,v.dataId]}),{isHidden:p,description:"Which entry with volume data to display."}),view:M.MappedStatic(i.entry.params.view.name,{off:M.Group({isRelative:M.Boolean(u,{isHidden:!0}),isUnbounded:M.Boolean(d,{isHidden:!0})},{description:"Display off."}),box:M.Group({bottomLeft:M.Vec3(A.zero()),topRight:M.Vec3(A.zero()),detailLevel:s,isRelative:c,isUnbounded:f},{description:"Static box defined by cartesian coords."}),"selection-box":M.Group({radius:M.Numeric(5,{min:0,max:50,step:.5},{description:"Radius in \u212B within which the volume is shown."}),detailLevel:s,isRelative:c,isUnbounded:f},{description:"Box around focused element."}),cell:M.Group({detailLevel:s,isRelative:c,isUnbounded:f},{description:"Box around the structure's bounding box."}),auto:M.Group({radius:M.Numeric(5,{min:0,max:50,step:.5},{description:"Radius in \u212B within which the volume is shown."}),detailLevel:s,selectionDetailLevel:T(T({},s),{label:"Selection Detail"}),isRelative:c,isUnbounded:f},{description:"Box around focused element."})},{options:Qi.ViewTypeOptions,description:'Controls what of the volume is displayed. "Off" hides the volume alltogether. "Bounded box" shows the volume inside the given box. "Around Focus" shows the volume around the element/atom last interacted with. "Whole Structure" shows the volume for the whole structure.'})},m={entry:i.entry.name,view:{name:i.entry.params.view.name,params:{detailLevel:i.entry.params.detailLevel,radius:i.entry.params.view.params.radius,bottomLeft:i.entry.params.view.params.bottomLeft,topRight:i.entry.params.view.params.topRight,selectionDetailLevel:i.entry.params.view.params.selectionDetailLevel,isRelative:u,isUnbounded:d}}};return p?B(Jn,{onChange:this.changeOption,params:h,values:m,onEnter:this.props.events.onEnter,isDisabled:this.props.isDisabled},void 0):Pe(Nt,{children:[!n&&B(vx,{label:"2Fo-Fc",name:"2fo-fc",bCell:this.props.bCell,channels:i.entry.params.channels,changeIso:this.changeIso,changeParams:this.changeParams,isRelative:u,params:this.props,stats:l.valuesInfo[0],isUnbounded:d},void 0),!n&&B(vx,{label:"Fo-Fc(+ve)",name:"fo-fc(+ve)",bCell:this.props.bCell,channels:i.entry.params.channels,changeIso:this.changeIso,changeParams:this.changeParams,isRelative:u,params:this.props,stats:l.valuesInfo[1],isUnbounded:d},void 0),!n&&B(vx,{label:"Fo-Fc(-ve)",name:"fo-fc(-ve)",bCell:this.props.bCell,channels:i.entry.params.channels,changeIso:this.changeIso,changeParams:this.changeParams,isRelative:u,params:this.props,stats:l.valuesInfo[1],isUnbounded:d},void 0),n&&B(vx,{label:"EM",name:"em",bCell:this.props.bCell,channels:i.entry.params.channels,changeIso:this.changeIso,changeParams:this.changeParams,isRelative:u,params:this.props,stats:l.valuesInfo[0],isUnbounded:d},void 0),B(Jn,{onChange:this.changeOption,params:h,values:m,onEnter:this.props.events.onEnter,isDisabled:this.props.isDisabled},void 0)]},void 0)},t}(Sr),GQ=function(){return T(T({},IQ()),{customParamEditors:[[SR,wGe]]})},_Ge=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.updateParams=function(n){var a;r.plugin.managers.animation.updateParams((a={},a[n.name]=n.value,a))},r.updateCurrentParams=function(n){var a;r.plugin.managers.animation.updateCurrentParams((a={},a[n.name]=n.value,a))},r.startOrStop=function(){var n=r.plugin.managers.animation;n.state.animationState==="playing"?n.stop():(r.props.onStart&&r.props.onStart(),n.start())},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.animation.events.updated,function(){return r.forceUpdate()})},t.prototype.render=function(){var r,n,a=this.plugin.managers.animation;if(a.isEmpty)return null;var i=a.state.animationState==="playing",o=(n=(r=a.current.anim).canApply)===null||n===void 0?void 0:n.call(r,this.plugin);return Pe(Nt,{children:[B(Jn,{params:a.getParams(),values:a.state.params,onChange:this.updateParams,isDisabled:i},void 0),B(Jn,{params:a.current.params,values:a.current.paramValues,onChange:this.updateCurrentParams,isDisabled:i},void 0),B("div",T({className:"msp-flex-row"},{children:B(xr,T({icon:a.state.animationState!=="playing"?void 0:FQ,onClick:this.startOrStop,disabled:o!==void 0&&o.canApply===!1},{children:a.state.animationState==="playing"?"Stop":o===void 0||o.canApply?"Start":o.reason||"Start"}),void 0)}),void 0)]},void 0)},t}(Sr),qQ="overpaint-controls";function ez(e,t,r,n,a){return pe(this,void 0,void 0,function(){var i=this;return he(this,function(o){switch(o.label){case 0:return[4,AGe(e,t,function(s,u,l){return pe(i,void 0,void 0,function(){var c,d,f,p,h,h;return he(this,function(m){switch(m.label){case 0:return a&&a.length>0&&!a.includes(u.params.values.type.name)?[2]:(c=u.obj.data.sourceData,[4,n(c.root)]);case 1:return d=m.sent(),cr.isEmpty(d)?[2]:(f={bundle:sn.fromLoci(d),color:r===-1?vt(0):r,clear:r===-1},l?(p=Gt(Gt([],l.params.values.layers),[f]),h=tz(p,c),s.to(l).update(ri.toBundle(h))):(h=tz([f],c),s.to(u.transform.ref).apply(lt.Representation.OverpaintStructureRepresentation3DFromBundle,ri.toBundle(h),{tags:qQ})),[2])}})})})];case 1:return o.sent(),[2]}})})}function AGe(e,t,r){return pe(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d;return he(this,function(f){switch(f.label){case 0:n=e.state.data,a=n.build(),i=0,o=t,f.label=1;case 1:if(!(i<o.length))return[3,6];s=o[i],u=0,l=s.representations,f.label=2;case 2:return u<l.length?(c=l[u],d=n.select(lr.Generators.ofTransformer(lt.Representation.OverpaintStructureRepresentation3DFromBundle,c.cell.transform.ref).withTag(qQ)),[4,r(a,c.cell,d[0])]):[3,5];case 3:f.sent(),f.label=4;case 4:return u++,[3,2];case 5:return i++,[3,1];case 6:return[2,a.commit({doNotUpdateCurrent:!0})]}})})}function tz(e,t){var r=ri.ofBundle(e,t.root),n=ri.merge(r);return ri.filter(n,t)}var WQ="clipping-controls";function TGe(e,t,r,n,a){return pe(this,void 0,void 0,function(){var i=this;return he(this,function(o){switch(o.label){case 0:return[4,EGe(e,t,function(s,u,l){return pe(i,void 0,void 0,function(){var c,d,f,p,h,h;return he(this,function(m){switch(m.label){case 0:return a&&a.length>0&&!a.includes(u.params.values.type.name)?[2]:(c=u.obj.data.sourceData,[4,n(c.root)]);case 1:return d=m.sent(),cr.isEmpty(d)?[2]:(f={bundle:sn.fromLoci(d),groups:r},l?(p=Gt(Gt([],l.params.values.layers),[f]),h=rz(p,c),s.to(l).update(cn.toBundle(h))):(h=rz([f],c),s.to(u.transform.ref).apply(lt.Representation.ClippingStructureRepresentation3DFromBundle,cn.toBundle(h),{tags:WQ})),[2])}})})})];case 1:return o.sent(),[2]}})})}function EGe(e,t,r){return pe(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d;return he(this,function(f){switch(f.label){case 0:n=e.state.data,a=n.build(),i=0,o=t,f.label=1;case 1:if(!(i<o.length))return[3,6];s=o[i],u=0,l=s.representations,f.label=2;case 2:return u<l.length?(c=l[u],d=n.select(lr.Generators.ofTransformer(lt.Representation.ClippingStructureRepresentation3DFromBundle,c.cell.transform.ref).withTag(WQ)),[4,r(a,c.cell,d[0])]):[3,5];case 3:f.sent(),f.label=4;case 4:return u++,[3,2];case 5:return i++,[3,1];case 6:return[2,a.commit({doNotUpdateCurrent:!0})]}})})}function rz(e,t){var r=cn.ofBundle(e,t.root),n=cn.merge(r);return cn.filter(n,t)}var XQ="transparency-controls";function PGe(e,t,r,n,a){return pe(this,void 0,void 0,function(){var i=this;return he(this,function(o){switch(o.label){case 0:return[4,IGe(e,t,function(s,u,l){return pe(i,void 0,void 0,function(){var c,d,f,p,h,h;return he(this,function(m){switch(m.label){case 0:return a&&a.length>0&&!a.includes(u.params.values.type.name)?[2]:(c=u.obj.data.sourceData,[4,n(c.root)]);case 1:return d=m.sent(),cr.isEmpty(d)?[2]:(f={bundle:sn.fromLoci(d),value:r},l?(p=Gt(Gt([],l.params.values.layers),[f]),h=nz(p,c),s.to(l).update(ni.toBundle(h))):(h=nz([f],c),s.to(u.transform.ref).apply(lt.Representation.TransparencyStructureRepresentation3DFromBundle,ni.toBundle(h),{tags:XQ})),[2])}})})})];case 1:return o.sent(),[2]}})})}function IGe(e,t,r){return pe(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d;return he(this,function(f){switch(f.label){case 0:n=e.state.data,a=n.build(),i=0,o=t,f.label=1;case 1:if(!(i<o.length))return[3,6];s=o[i],u=0,l=s.representations,f.label=2;case 2:return u<l.length?(c=l[u],d=n.select(lr.Generators.ofTransformer(lt.Representation.TransparencyStructureRepresentation3DFromBundle,c.cell.transform.ref).withTag(XQ)),[4,r(a,c.cell,d[0])]):[3,5];case 3:f.sent(),f.label=4;case 4:return u++,[3,2];case 5:return i++,[3,1];case 6:return[2,a.commit({doNotUpdateCurrent:!0})]}})})}function nz(e,t){var r=ni.ofBundle(e,t.root),n=ni.merge(r);return ni.filter(n,t)}var gm=function(e){Le(t,e);function t(r){var n=e.call(this,{options:M.getDefaultValues(t.OptionsParams)})||this;return n.plugin=r,n.events={optionsUpdated:n.ev()},n}return Object.defineProperty(t.prototype,"currentStructures",{get:function(){return this.plugin.managers.structure.hierarchy.selection.structures},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pivotStructure",{get:function(){return this.currentStructures[0]},enumerable:!1,configurable:!0}),t.prototype.setOptions=function(r){return pe(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d=this;return he(this,function(f){for(n=r.interactions!==this.state.options.interactions,this.updateState({options:r}),this.events.optionsUpdated.next(),a=this.dataState.build(),i=0,o=this.currentStructures;i<o.length;i++)for(s=o[i],u=0,l=s.components;u<l.length;u++)c=l[u],this.updateReprParams(a,c);return[2,this.plugin.dataTransaction(function(){return pe(d,void 0,void 0,function(){return he(this,function(p){switch(p.label){case 0:return[4,a.commit()];case 1:return p.sent(),[4,this.plugin.state.updateBehavior(uR,function(h){h.ignoreHydrogens=!r.showHydrogens})];case 2:return p.sent(),n?[4,this.updateInterationProps()]:[3,4];case 3:p.sent(),p.label=4;case 4:return[2]}})})})]})})},t.prototype.updateReprParams=function(r,n){for(var a=this.state.options,i=a.showHydrogens,o=a.visualQuality,s=!i,u=0,l=n.representations;u<l.length;u++){var c=l[u];if(c.cell.transform.transformer===e3){var d=c.cell.transform.params;(!!d.type.params.ignoreHydrogens!==s||d.type.params.quality!==o)&&r.to(c.cell).update(function(f){f.type.params.ignoreHydrogens=s,f.type.params.quality=o})}}},t.prototype.updateInterationProps=function(){var r,n,a;return pe(this,void 0,void 0,function(){var i,o,s,u,l,c,d,f=this;return he(this,function(p){switch(p.label){case 0:i=0,o=this.currentStructures,p.label=1;case 1:return i<o.length?(s=o[i],u=oa.getParams((r=s.cell.obj)===null||r===void 0?void 0:r.data),s.properties?(l=(n=s.properties.cell.transform.params)===null||n===void 0?void 0:n.properties[oa.descriptor.name],M.areEqual(u,l,this.state.options.interactions)?[3,5]:[4,this.dataState.build().to(s.properties.cell).update(function(h){h.properties[oa.descriptor.name]=f.state.options.interactions}).commit()]):[3,3]):[3,6];case 2:return p.sent(),[3,5];case 3:return c=this.plugin.customStructureProperties.getParams((a=s.cell.obj)===null||a===void 0?void 0:a.data),d=M.getDefaultValues(c),M.areEqual(u,d.properties[oa.descriptor.name],this.state.options.interactions)?[3,5]:(d.properties[oa.descriptor.name]=this.state.options.interactions,[4,this.plugin.builders.structure.insertStructureProperties(s.cell,d)]);case 4:p.sent(),p.label=5;case 5:return i++,[3,1];case 6:return[2]}})})},t.prototype.applyPreset=function(r,n,a){var i=this;return this.plugin.dataTransaction(function(){return pe(i,void 0,void 0,function(){var o,s,u,l;return he(this,function(c){switch(c.label){case 0:o=0,s=r,c.label=1;case 1:return o<s.length?(u=s[o],[4,this.plugin.builders.structure.representation.applyPreset(u.cell,n,a)]):[3,5];case 2:return l=c.sent(),[4,this.syncPreset(u,l)];case 3:c.sent(),c.label=4;case 4:return o++,[3,1];case 5:return[2]}})})},{canUndo:"Preset"})},t.prototype.syncPreset=function(r,n){if(!n||!n.components)return this.clearComponents([r]);var a=new Set;if(rl(n.components,function(y){y&&a.add(y.ref)}),n.representations&&rl(n.representations,function(y){y&&a.add(y.ref)}),a.size===0)return this.clearComponents([r]);for(var i=!1,o=this.dataState.build(),s=function(y){a.has(y.cell.transform.ref)||(i=!0,o.delete(y.cell))},u=0,l=r.components;u<l.length;u++){var c=l[u];s(c);for(var d=0,f=c.representations;d<f.length;d++){var p=f[d];s(p)}if(c.genericRepresentations)for(var h=0,m=c.genericRepresentations;h<m.length;h++){var p=m[h];s(p)}}if(r.genericRepresentations)for(var v=0,g=r.genericRepresentations;v<g.length;v++){var p=g[v];s(p)}if(i)return o.commit()},t.prototype.clear=function(r){return this.clearComponents(r)},t.prototype.selectThis=function(r){var n,a=this.plugin.managers.structure.selection;a.clear();for(var i=0,o=r;i<o.length;i++){var s=o[i],u=$e.toSubStructureElementLoci(s.structure.cell.obj.data,(n=s.cell.obj)===null||n===void 0?void 0:n.data);a.fromLoci("set",u)}},t.prototype.canBeModified=function(r){return this.plugin.builders.structure.isComponentTransform(r.cell)},t.prototype.modifyByCurrentSelection=function(r,n){var a=this;return this.plugin.runTask(Qe.create("Modify Component",function(i){return pe(a,void 0,void 0,function(){var o,s,u,l,c;return he(this,function(d){switch(d.label){case 0:for(o=this.dataState.build(),s=0,u=r;s<u.length;s++)l=u[s],this.canBeModified(l)&&(c=this.plugin.managers.structure.selection.getStructure(l.structure.cell.obj.data),!(!c||c.elementCount===0)&&this.modifyComponent(o,l,c,n));return[4,this.dataState.updateTree(o,{canUndo:"Modify Selection"}).runInContext(i)];case 1:return d.sent(),[2]}})})}))},t.prototype.toggleVisibility=function(r,n){if(r.length!==0)if(n)for(var u=r[0].representations.indexOf(n),a=!n.cell.state.isHidden,l=0,c=r;l<c.length;l++){var s=c[l],d=s.representations[u];!d||pm(this.dataState,d.cell.transform.ref,a)}else for(var a=!r[0].cell.state.isHidden,i=0,o=r;i<o.length;i++){var s=o[i];pm(this.dataState,s.cell.transform.ref,a)}},t.prototype.removeRepresentations=function(r,n){if(r.length!==0){var a=[];if(n){var i=r[0].representations.indexOf(n);if(i<0)return;for(var o=0,s=r;o<s.length;o++){var u=s[o];u.representations[i]&&a.push(u.representations[i])}}else for(var l=0,c=r;l<c.length;l++)for(var u=c[l],d=0,f=u.representations;d<f.length;d++){var p=f[d];a.push(p)}return this.plugin.managers.structure.hierarchy.remove(a,!0)}},t.prototype.updateRepresentations=function(r,n,a){if(r.length===0)return Promise.resolve();var i=r[0].representations.indexOf(n);if(i<0)return Promise.resolve();for(var o=this.dataState.build(),s=0,u=r;s<u.length;s++){var l=u[s],c=l.representations[i];!c||c.cell.transform.transformer===n.cell.transform.transformer&&o.to(c.cell).update(a)}return o.commit({canUndo:"Update Representation"})},t.prototype.updateRepresentationsTheme=function(r,n){var a,i,o,s;if(r.length!==0){for(var u=this.dataState.build(),l=0,c=r;l<c.length;l++)for(var d=c[l],f=function(g){var y=g.cell.transform.params,b=typeof n=="function"?n(d,g):n,S=b.color==="default"?SI(p.plugin,(a=d.structure.cell.obj)===null||a===void 0?void 0:a.data,y?.type.name):b.color?SI(p.plugin,(i=d.structure.cell.obj)===null||i===void 0?void 0:i.data,y?.type.name,b.color,b.colorParams):void 0,x=b.size==="default"?BN(p.plugin,(o=d.structure.cell.obj)===null||o===void 0?void 0:o.data,y?.type.name):b.color?BN(p.plugin,(s=d.structure.cell.obj)===null||s===void 0?void 0:s.data,y?.type.name,b.size,b.sizeParams):void 0;(S||x)&&u.to(g.cell).update(function(C){S&&(C.colorTheme=S),x&&(C.sizeTheme=x)})},p=this,h=0,m=d.representations;h<m.length;h++){var v=m[h];f(v)}return u.commit({canUndo:"Update Theme"})}},t.prototype.addRepresentation=function(r,n){var a=this;if(r.length!==0){var i=this.state.options,o=i.showHydrogens,s=i.visualQuality,u=!o,l={ignoreHydrogens:u,quality:s};return this.plugin.dataTransaction(function(){return pe(a,void 0,void 0,function(){var c,d,f;return he(this,function(p){switch(p.label){case 0:c=0,d=r,p.label=1;case 1:return c<d.length?(f=d[c],[4,this.plugin.builders.structure.representation.addRepresentation(f.cell,{type:this.plugin.representation.structure.registry.get(n),typeParams:l})]):[3,4];case 2:p.sent(),p.label=3;case 3:return c++,[3,1];case 4:return[2]}})})},{canUndo:"Add Representation"})}},t.prototype.tryFindComponent=function(r,n){var a=this;if(r.components.length!==0)return this.plugin.runTask(Qe.create("Find Component",function(i){return pe(a,void 0,void 0,function(){var o,s,u,l,c,d,f,p,h,m;return he(this,function(v){switch(v.label){case 0:return o=(h=r.cell.obj)===null||h===void 0?void 0:h.data,o?(l=(u=St).unionStructure,[4,n.getSelection(this.plugin,i,o)]):[2];case 1:for(s=l.apply(u,[v.sent()]),c=0,d=r.components;c<d.length;c++)if(f=d[c],p=(m=f.cell.obj)===null||m===void 0?void 0:m.data,!(!p||!f.cell.parent)&&kPe(s,p))return[2,f.cell];return[2]}})})}))},t.prototype.add=function(r,n){return pe(this,void 0,void 0,function(){var a=this;return he(this,function(i){return[2,this.plugin.dataTransaction(function(){return pe(a,void 0,void 0,function(){var o,s,u,l,c,d,f,p,h,m,v;return he(this,function(g){switch(g.label){case 0:if(o=n||this.currentStructures,o.length===0)return[2];s=this.state.options,u=s.showHydrogens,l=s.visualQuality,c=!u,d={ignoreHydrogens:c,quality:l},f=Cn.create22(),p=0,h=o,g.label=1;case 1:return p<h.length?(m=h[p],v=void 0,r.options.checkExisting?[4,this.tryFindComponent(m,r.selection)]:[3,3]):[3,8];case 2:v=g.sent(),g.label=3;case 3:return v?[3,5]:[4,this.plugin.builders.structure.tryCreateComponentFromSelection(m.cell,r.selection,f,{label:r.options.label||(r.selection===Ea.current?"Custom Selection":"")})];case 4:v=g.sent(),g.label=5;case 5:return r.representation==="none"||!v?[3,7]:[4,this.plugin.builders.structure.representation.addRepresentation(v,{type:this.plugin.representation.structure.registry.get(r.representation),typeParams:d})];case 6:g.sent(),g.label=7;case 7:return p++,[3,1];case 8:return[2]}})})},{canUndo:"Add Selection"})]})})},t.prototype.applyTheme=function(r,n){return pe(this,void 0,void 0,function(){var a=this;return he(this,function(i){return[2,this.plugin.dataTransaction(function(o){return pe(a,void 0,void 0,function(){var s,u,l,c,d,f,f,f,p=this;return he(this,function(h){switch(h.label){case 0:if(s=n||this.currentStructures,s.length===0)return[2];u=function(m){return pe(p,void 0,void 0,function(){var v,g;return he(this,function(y){switch(y.label){case 0:return g=(v=St).toLociWithSourceUnits,[4,r.selection.getSelection(this.plugin,o,m)];case 1:return[2,g.apply(v,[y.sent()])]}})})},l=0,c=s,h.label=1;case 1:return l<c.length?(d=c[l],r.action.name!=="reset"?[3,3]:[4,ez(this.plugin,d.components,-1,u,r.representations)]):[3,10];case 2:return h.sent(),[3,9];case 3:return r.action.name!=="color"?[3,5]:(f=r.action.params,[4,ez(this.plugin,d.components,f.color,u,r.representations)]);case 4:return h.sent(),[3,9];case 5:return r.action.name!=="transparency"?[3,7]:(f=r.action.params,[4,PGe(this.plugin,d.components,f.value,u,r.representations)]);case 6:return h.sent(),[3,9];case 7:return r.action.name!=="clipping"?[3,9]:(f=r.action.params,[4,TGe(this.plugin,d.components,cn.Groups.fromNames(f.excludeGroups),u,r.representations)]);case 8:h.sent(),h.label=9;case 9:return l++,[3,1];case 10:return[2]}})})},{canUndo:"Apply Theme"})]})})},t.prototype.modifyComponent=function(r,n,a,i){var o,s,u,l=(o=n.cell.obj)===null||o===void 0?void 0:o.data;if(!!l&&!((i==="subtract"||i==="intersect")&&!i_(l,a))){var c=(s=n.structure.cell.obj)===null||s===void 0?void 0:s.data,d=i==="union"?U1(c,[l,a]):i==="intersect"?HX(l,a):Dk(l,a);if(d.elementCount===0)r.delete(n.cell.transform.ref);else{var f=sn.fromSubStructure(c,d),p={type:{name:"bundle",params:f},nullIfEmpty:!0,label:(u=n.cell.obj)===null||u===void 0?void 0:u.label};r.to(n.cell).update(p)}}},t.prototype.updateLabel=function(r,n){var a,i,o={type:(a=r.cell.params)===null||a===void 0?void 0:a.values.type,nullIfEmpty:(i=r.cell.params)===null||i===void 0?void 0:i.values.nullIfEmpty,label:n};this.dataState.build().to(r.cell).update(o).commit()},Object.defineProperty(t.prototype,"dataState",{get:function(){return this.plugin.state.data},enumerable:!1,configurable:!0}),t.prototype.clearComponents=function(r){for(var n=this.dataState.build(),a=0,i=r;a<i.length;a++)for(var o=i[a],s=0,u=o.components;s<u.length;s++){var l=u[s];n.delete(l.cell.transform.ref)}return n.commit({canUndo:"Clear Selections"})},t}(Gd);(function(e){e.OptionsParams={showHydrogens:M.Boolean(!0,{description:"Toggle display of hydrogen atoms in representations"}),visualQuality:M.Select("auto",mk,{description:"Control the visual/rendering quality of representations"}),interactions:M.Group(oa.defaultParams,{label:"Non-covalent Interactions"})};function t(i,o){var s=i.query.structure.registry.options;return o=T({pivot:i.managers.structure.component.pivotStructure,allowNone:!0,hideSelection:!1,checkExisting:!1},o),{selection:M.Select(s[1][0],s,{isHidden:o?.hideSelection}),representation:a(i,o?.pivot,o?.allowNone?[["none","< Create Later >"]]:[]),options:M.Group({label:M.Text(""),checkExisting:M.Boolean(!!o?.checkExisting,{help:function(){return{description:"Checks if a selection with the specifield elements already exists to avoid creating duplicate components."}}})})}}e.getAddParams=t;function r(i,o){var s=i.query.structure.registry.options;return{selection:M.Select(s[1][0],s,{isHidden:!1}),action:M.MappedStatic("color",{color:M.Group({color:M.Color(gr.blue,{isExpanded:!0})},{isFlat:!0}),reset:M.EmptyGroup({label:"Reset Color"}),transparency:M.Group({value:M.Numeric(.5,{min:0,max:1,step:.01})},{isFlat:!0}),clipping:M.Group({excludeGroups:M.MultiSelect([],M.objectToOptions(cn.Groups.Names))},{isFlat:!0})}),representations:M.MultiSelect([],n(i,o),{emptyValue:"All"})}}e.getThemeParams=r;function n(i,o){var s,u;return!((s=o?.cell.obj)===null||s===void 0)&&s.data?i.representation.structure.registry.getApplicableTypes((u=o.cell.obj)===null||u===void 0?void 0:u.data):i.representation.structure.registry.types}e.getRepresentationTypes=n;function a(i,o,s,u){var l=Gt(Gt([],s),n(i,o));return M.Select(l[0][0],l,{label:u})}})(gm||(gm={}));function MGe(e,t){var r=VGe(e,t||PR());return qGe(e.tree,r),t&&t.refs.forEach(jGe,r),{hierarchy:r.hierarchy,added:r.added,changed:r.changed}}function PR(){return{trajectories:[],models:[],structures:[],refs:new Map}}function DGe(e){return{kind:"trajectory",cell:e,version:e.transform.version,models:[]}}function az(e,t){return{kind:"model",cell:e,version:e.transform.version,trajectory:t,structures:[]}}function kGe(e,t){return{kind:"model-properties",cell:e,version:e.transform.version,model:t}}function RGe(e,t){return{kind:"model-unitcell",cell:e,version:e.transform.version,model:t}}function iz(e,t){return{kind:"structure",cell:e,version:e.transform.version,model:t,components:[]}}function OGe(e,t){return{kind:"structure-properties",cell:e,version:e.transform.version,structure:t}}function BGe(e,t){return{kind:"structure-transform",cell:e,version:e.transform.version,structure:t}}function FGe(e,t){return{kind:"structure-volume-streaming",cell:e,version:e.transform.version,structure:t}}function LGe(e){return e.transform.tags?Gt([],e.transform.tags).sort().join():e.transform.ref}function NGe(e,t){return{kind:"structure-component",cell:e,version:e.transform.version,structure:t,key:LGe(e),representations:[]}}function zGe(e,t){return{kind:"structure-representation",cell:e,version:e.transform.version,component:t}}function UGe(e,t){return{kind:"generic-representation",cell:e,version:e.transform.version,parent:t}}function VGe(e,t){return{state:e,oldHierarchy:t,hierarchy:PR(),changed:!1,added:new Set}}function av(e,t,r,n){for(var a=[],i=4;i<arguments.length;i++)a[i-4]=arguments[i];var o=n.apply(void 0,a);r.push(o),e.hierarchy.refs.set(t.transform.ref,o);var s=e.oldHierarchy.refs.get(t.transform.ref);return s?s.version!==t.transform.version&&(e.changed=!0):(e.added.add(o.cell.transform.ref),e.changed=!0),o}function ih(e,t,r){for(var n=[],a=3;a<arguments.length;a++)n[a-3]=arguments[a];var i=r.apply(void 0,n);e.hierarchy.refs.set(t.transform.ref,i);var o=e.oldHierarchy.refs.get(t.transform.ref);return o?o.version!==t.transform.version&&(e.changed=!0):(e.added.add(i.cell.transform.ref),e.changed=!0),i}function oz(e){return function(t){return e.is(t.obj)}}function sz(e,t){return function(r,n){return!t(n)&&e.is(r.obj)}}function gx(e){return function(t){return t.transform.transformer===e}}function oh(){}var HGe=[[oz(be.Molecule.Trajectory),function(e,t){e.currentTrajectory=av(e,t,e.hierarchy.trajectories,DGe,t)},function(e){return e.currentTrajectory=void 0}],[sz(be.Molecule.Model,function(e){return e.currentModel}),function(e,t){e.currentTrajectory?e.currentModel=av(e,t,e.currentTrajectory.models,az,t,e.currentTrajectory):e.currentModel=ih(e,t,az,t),e.hierarchy.models.push(e.currentModel)},function(e){return e.currentModel=void 0}],[gx(lt.Model.CustomModelProperties),function(e,t){if(!e.currentModel)return!1;e.currentModel.properties=ih(e,t,kGe,t,e.currentModel)},oh],[gx(lt.Representation.ModelUnitcell3D),function(e,t){if(!e.currentModel)return!1;e.currentModel.unitcell=ih(e,t,RGe,t,e.currentModel)},oh],[sz(be.Molecule.Structure,function(e){return e.currentStructure}),function(e,t){e.currentModel?e.currentStructure=av(e,t,e.currentModel.structures,iz,t,e.currentModel):e.currentStructure=ih(e,t,iz,t),e.hierarchy.structures.push(e.currentStructure)},function(e){return e.currentStructure=void 0}],[gx(lt.Model.CustomStructureProperties),function(e,t){if(!e.currentStructure)return!1;e.currentStructure.properties=ih(e,t,OGe,t,e.currentStructure)},oh],[gx(lt.Model.TransformStructureConformation),function(e,t){if(!e.currentStructure)return!1;e.currentStructure.transform=ih(e,t,BGe,t,e.currentStructure)},oh],[oz(Qi),function(e,t){return e.currentStructure&&(e.currentStructure.volumeStreaming=ih(e,t,FGe,t,e.currentStructure)),!1},oh],[function(e,t){return t.currentComponent||!t.currentStructure||e.transform.transformer.definition.isDecorator?!1:be.Molecule.Structure.is(e.obj)},function(e,t){e.currentStructure&&(e.currentComponent=av(e,t,e.currentStructure.components,NGe,t,e.currentStructure))},function(e){return e.currentComponent=void 0}],[function(e,t){return!e.state.isGhost&&!!t.currentComponent&&be.Molecule.Structure.Representation3D.is(e.obj)},function(e,t){return e.currentComponent&&av(e,t,e.currentComponent.representations,zGe,t,e.currentComponent),!1},oh],[function(e){return!e.state.isGhost&&be.isRepresentation3D(e.obj)},function(e,t){var r=e.currentComponent||e.currentStructure||e.currentModel;r&&(r.genericRepresentations||(r.genericRepresentations=[]),av(e,t,r.genericRepresentations,UGe,t,r))},oh]];function YQ(e){if(!e||!e?.parent||!e.parent.cells.has(e.transform.ref))return!1;var t=e.obj;return!(!t||t===qn.Null||e.status!=="ok"&&e.status!=="error")}function jGe(e){var t=e.cell;YQ(t)||(this.changed=!0)}function GGe(e){KQ(this,this.tree.transforms.get(e))}function KQ(e,t){var r=e.state,n=r.state.cells.get(t.ref);if(!!YQ(n)){for(var a=void 0,i=!1,o=0,s=HGe;o<s.length;o++){var u=s[o],l=u[0],c=u[1],d=u[2];if(l(n,r)){var f=c(r,n);if(f===!1){i=!0;break}a=d;break}}if(!i){var p=e.tree.children.get(t.ref);p&&p.size&&p.forEach(GGe,e),a&&a(r)}}}function qGe(e,t){var r={tree:e,state:t};return KQ(r,e.root),r.state}var W1=function(e){Le(t,e);function t(r){var n=e.call(this)||this;return n.plugin=r,n.state={syncedTree:n.dataState.tree,notified:!1,hierarchy:PR(),selection:{trajectories:[],models:[],structures:[]}},n.behaviors={selection:n.ev.behavior({hierarchy:n.current,trajectories:n.selection.trajectories,models:n.selection.models,structures:n.selection.structures})},n._currentComponentGroups=void 0,n._currentSelectionSet=void 0,n.subscribe(r.state.data.events.changed,function(a){a.inTransaction||r.behaviors.state.isAnimating.value||n.sync(!0)}),n.subscribe(r.behaviors.state.isAnimating,function(a){!a&&!r.behaviors.state.isUpdating.value&&n.sync(!0)}),n}return Object.defineProperty(t.prototype,"dataState",{get:function(){return this.plugin.state.data},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentComponentGroups",{get:function(){return this._currentComponentGroups?this._currentComponentGroups:(this._currentComponentGroups=t.getComponentGroups(this.selection.structures),this._currentComponentGroups)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"seletionSet",{get:function(){if(this._currentSelectionSet)return this._currentSelectionSet;this._currentSelectionSet=new Set;for(var r=0,n=this.selection.trajectories;r<n.length;r++){var a=n[r];this._currentSelectionSet.add(a.cell.transform.ref)}for(var i=0,o=this.selection.models;i<o.length;i++){var a=o[i];this._currentSelectionSet.add(a.cell.transform.ref)}for(var s=0,u=this.selection.structures;s<u.length;s++){var a=u[s];this._currentSelectionSet.add(a.cell.transform.ref)}return this._currentSelectionSet},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"current",{get:function(){return this.sync(!1),this.state.hierarchy},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"selection",{get:function(){return this.sync(!1),this.state.selection},enumerable:!1,configurable:!0}),t.prototype.getStructuresWithSelection=function(){for(var r=this.plugin.managers.structure.hierarchy.current.structures,n=[],a=0,i=r;a<i.length;a++){var o=i[a];this.plugin.managers.structure.selection.structureHasSelection(o)&&n.push(o)}return n},t.prototype.syncCurrent=function(r,n){for(var a=this.seletionSet,i=[],o=0,s=r;o<s.length;o++){var u=s[o],l=u.cell.transform.ref;(a.has(l)||n.has(l))&&i.push(u)}return i.length===0?r.length>0?[r[0]]:[]:i},t.prototype.sync=function(r){if(!(!r&&this.dataState.inUpdate)){if(this.state.syncedTree===this.dataState.tree){r&&!this.state.notified&&(this.state.notified=!0,this.behaviors.selection.next(T({hierarchy:this.state.hierarchy},this.state.selection)));return}this.state.syncedTree=this.dataState.tree;var n=MGe(this.plugin.state.data,this.current);if(!!n.changed){var a=n.hierarchy,i=this.syncCurrent(a.trajectories,n.added),o=this.syncCurrent(a.models,n.added),s=this.syncCurrent(a.structures,n.added);this._currentComponentGroups=void 0,this._currentSelectionSet=void 0,this.state.hierarchy=a,this.state.selection.trajectories=i,this.state.selection.models=o,this.state.selection.structures=s,r?(this.state.notified=!0,this.behaviors.selection.next({hierarchy:a,trajectories:i,models:o,structures:s})):this.state.notified=!1}}},t.prototype.updateCurrent=function(r,n){for(var a=this.current,i=n==="add"?Aa.union(this.seletionSet,new Set(r.map(function(y){return y.cell.transform.ref}))):Aa.difference(this.seletionSet,new Set(r.map(function(y){return y.cell.transform.ref}))),o=[],s=[],u=[],l=0,c=a.trajectories;l<c.length;l++){var d=c[l];i.has(d.cell.transform.ref)&&o.push(d)}for(var f=0,p=a.models;f<p.length;f++){var h=p[f];i.has(h.cell.transform.ref)&&s.push(h)}for(var m=0,v=a.structures;m<v.length;m++){var g=v[m];i.has(g.cell.transform.ref)&&u.push(g)}this._currentComponentGroups=void 0,this._currentSelectionSet=void 0,this.state.selection.trajectories=o,this.state.selection.models=s,this.state.selection.structures=u,this.behaviors.selection.next({hierarchy:a,trajectories:o,models:s,structures:u})},t.prototype.remove=function(r,n){if(r.length!==0){for(var a=this.plugin.state.data.build(),i=0,o=r;i<o.length;i++){var s=o[i];a.delete(typeof s=="string"?s:s.cell.transform.ref)}return a.commit({canUndo:n?"Remove":!1})}},t.prototype.toggleVisibility=function(r,n){if(r.length!==0)for(var a=n!==void 0?n!=="show":!r[0].cell.state.isHidden,i=0,o=r;i<o.length;i++){var s=o[i];pm(this.dataState,s.cell.transform.ref,a)}},t.prototype.applyPreset=function(r,n,a){var i=this;return this.plugin.dataTransaction(function(){return pe(i,void 0,void 0,function(){var o,s,u;return he(this,function(l){switch(l.label){case 0:o=0,s=r,l.label=1;case 1:return o<s.length?(u=s[o],u.models.length>0?[4,this.clearTrajectory(u)]:[3,3]):[3,6];case 2:l.sent(),l.label=3;case 3:return[4,this.plugin.builders.structure.hierarchy.applyPreset(u.cell,n,a)];case 4:l.sent(),l.label=5;case 5:return o++,[3,1];case 6:return[2]}})})})},t.prototype.updateStructure=function(r,n){return pe(this,void 0,void 0,function(){var a=this;return he(this,function(i){switch(i.label){case 0:return[4,this.plugin.dataTransaction(function(){return pe(a,void 0,void 0,function(){var o,s;return he(this,function(u){switch(u.label){case 0:return o=xa.getDecoratorRoot(this.dataState.tree,r.cell.transform.ref),s=this.dataState.tree.children.get(o).toArray(),[4,this.remove(s,!1)];case 1:return u.sent(),[4,this.plugin.state.updateTransform(this.plugin.state.data,r.cell.transform.ref,n,"Structure Type")];case 2:return u.sent(),[4,this.plugin.builders.structure.representation.applyPreset(r.cell.transform.ref,"auto")];case 3:return u.sent(),[2]}})})},{canUndo:"Structure Type"})];case 1:return i.sent(),Rt.Camera.Reset(this.plugin),[2]}})})},t.prototype.clearTrajectory=function(r){for(var n=this.dataState.build(),a=0,i=r.models;a<i.length;a++){var o=i[a];n.delete(o.cell)}return n.commit()},t}(Sb);(function(e){function t(n){if(!n.length)return[];if(n.length===1)return n[0].components.map(function(h){return[h]});for(var a=[],i=new Map,o=0,s=n;o<s.length;o++)for(var u=s[o],l=0,c=u.components;l<c.length;l++){var d=c[l],f=d.key;if(!!f){var p=i.get(f);p||(p=[],i.set(f,p),a.push(p)),p.push(d)}}return a}e.getComponentGroups=t;function r(n){var a,i,o,s,u,l,c,d,f,p=n.managers.structure.hierarchy.selection.structures;if(p.length===0)return"";if(p.length===1){var h=p[0],m=(a=h.cell.obj)===null||a===void 0?void 0:a.data;if(!m)return((i=h.cell.obj)===null||i===void 0?void 0:i.label)||"Structure";var v=m.models[0]||m.representativeModel||m.masterModel;if(!v)return((o=h.cell.obj)===null||o===void 0?void 0:o.label)||"Structure";var g=v.entryId;return((u=(s=h.model)===null||s===void 0?void 0:s.trajectory)===null||u===void 0?void 0:u.models)&&h.model.trajectory.models.length===1?g:h.model?((l=h.model.cell.obj)===null||l===void 0?void 0:l.label)+" | "+g:g}for(var y=p[0],b=(c=y?.model)===null||c===void 0?void 0:c.trajectory,S=!0,x=0,C=p;x<C.length;x++){var h=C[x];if(((d=h?.model)===null||d===void 0?void 0:d.trajectory)!==b){S=!1;break}}return S&&b?((f=b.cell.obj)===null||f===void 0?void 0:f.label)+" | "+p.length+" structures":p.length+" structures"}e.getSelectedStructuresDescription=r})(W1||(W1={}));var ym=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onChange=function(n){var a,i=n.name,o=n.value,s=T(T({},r.props.params),(a={},a[i]=o,a));r.props.events.onChange(s,r.areInitial(s),r.validate(s))},r}return t.prototype.validate=function(r){},t.prototype.areInitial=function(r){return M.areEqual(this.props.info.params,r,this.props.info.initialValues)},t.prototype.render=function(){return B(Jn,{params:this.props.info.params,values:this.props.params,onChange:this.onChange,onEnter:this.props.events.onEnter,isDisabled:this.props.isDisabled},void 0)},t}(ci);(function(e){function t(a){for(var i=Object.keys(a),o=0,s=i;o<s.length;o++){var u=s[o];if(!a[u].isHidden)return!1}return!0}function r(a,i,o,s){var u=i.cells.get(s).obj,l=o.definition.params?o.definition.params(u,a):{},c=M.getDefaultValues(l);return{initialValues:c,params:l,isEmpty:t(l)}}e.infoFromAction=r;function n(a,i,o){var s=i.cells.get(o.ref),u=s.params&&s.params.definition||{},l=s.params&&s.params.values||{};return{initialValues:l,params:u,isEmpty:t(u)}}e.infoFromTransform=n})(ym||(ym={}));var $Q=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.busy=new ha,r.onEnter=function(){r.state.error||r.apply()},r.autoApplyHandle=void 0,r.events={onEnter:r.onEnter,onChange:function(n,a,i){r.clearAutoApply(),r.setState({params:n,isInitial:a,error:i&&i[0]},function(){!a&&!r.state.error&&r.canAutoApply(n)&&(r.clearAutoApply(),r.autoApplyHandle=setTimeout(r.apply,50))})}},r.apply=function(){return pe(r,void 0,void 0,function(){var n,a;return he(this,function(i){switch(i.label){case 0:this.clearAutoApply(),this.setState({busy:!0}),i.label=1;case 1:return i.trys.push([1,3,4,5]),[4,this.applyAction()];case 2:return i.sent(),[3,5];case 3:return i.sent(),[3,5];case 4:return(a=(n=this.props).onApply)===null||a===void 0||a.call(n),this.busy.next(!1),[7];case 5:return[2]}})})},r.refresh=function(){r.setState({params:r.getInfo().initialValues,isInitial:!0,error:void 0})},r.setDefault=function(){var n=r.getInfo(),a=M.getDefaultValues(n.params);r.setState({params:a,isInitial:M.areEqual(n.params,a,n.initialValues),error:void 0})},r.toggleExpanded=function(){r.setState({isCollapsed:!r.state.isCollapsed})},r}return t.prototype.clearAutoApply=function(){this.autoApplyHandle!==void 0&&(clearTimeout(this.autoApplyHandle),this.autoApplyHandle=void 0)},t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.behaviors.state.isBusy,function(n){r.state.busy!==n&&r.busy.next(n)}),this.subscribe(this.busy,function(n){r.state.busy!==n&&r.setState({busy:n})})},t.prototype.renderApply=function(){var r=this.canApply();return this.props.autoHideApply&&(!r||this.canAutoApply(this.state.params))?null:Pe("div",T({className:"msp-transform-apply-wrap"},{children:[B(Zt,{svg:kI,className:"msp-transform-default-params",onClick:this.setDefault,disabled:this.state.busy,title:"Set default params"},void 0),B("div",T({className:"msp-transform-apply-wider"},{children:B(xr,T({icon:r?K0:void 0,className:"msp-btn-commit msp-btn-commit-"+(r?"on":"off"),onClick:this.apply,disabled:!r},{children:this.props.applyLabel||this.applyText()}),void 0)}),void 0)]}),void 0)},t.prototype.renderDefault=function(){var r=this.getInfo(),n=r.isEmpty&&this.isUpdate(),a=this.getHeader(),i=this.getTransformerId(),o=this.plugin.customParamEditors.has(i)?this.plugin.customParamEditors.get(i):ym,s=this.state.isCollapsed?"msp-transform-wrapper msp-transform-wrapper-collapsed":"msp-transform-wrapper",u=null;if(!n&&!this.state.isCollapsed){var l=this.getSourceAndTarget(),c=l.a,d=l.b,f=l.bCell,p=this.renderApply();u=Pe(Nt,{children:[B(o,{info:r,a:c,b:d,bCell:f,events:this.events,params:this.state.params,isDisabled:this.state.busy},void 0),p]},void 0)}var h=Pe("div",T({className:s,style:{marginBottom:this.props.noMargin?0:void 0}},{children:[a!=="none"&&!this.props.wrapInExpander&&B("div",T({className:"msp-transform-header"},{children:Pe(xr,T({onClick:this.toggleExpanded,title:a.description},{children:[!n&&B(dn,{svg:this.state.isCollapsed?Ed:Td},void 0),a.name]}),void 0)}),void 0),u]}),void 0);return n||!this.props.wrapInExpander?h:B(ul,T({header:this.isUpdate()?"Update "+(a==="none"?"":a.name):"Apply "+(a==="none"?"":a.name),headerLeftMargin:this.props.expanderHeaderLeftMargin},{children:h}),void 0)},t.prototype.renderSimple=function(){var r,n,a,i=this.getInfo(),o=this.canApply(),s=Pe("div",T({className:"msp-flex-row"},{children:[B(xr,T({icon:(r=this.props.simpleApply)===null||r===void 0?void 0:r.icon,title:(n=this.props.simpleApply)===null||n===void 0?void 0:n.title,disabled:this.state.busy||!o,onClick:this.apply,className:"msp-btn-apply-simple"},{children:(a=this.props.simpleApply)===null||a===void 0?void 0:a.header}),void 0),!i.isEmpty&&B(Wa,{icon:vm,label:"",title:"Options",toggle:this.toggleExpanded,isSelected:!this.state.isCollapsed,disabled:this.state.busy,style:{flex:"0 0 40px",padding:0}},void 0)]}),void 0);if(this.state.isCollapsed)return s;var u=this.getTransformerId(),l=this.plugin.customParamEditors.has(u)?this.plugin.customParamEditors.get(u):ym,c=this.getSourceAndTarget(),d=c.a,f=c.b,p=c.bCell;return Pe(Nt,{children:[s,B(l,{info:i,a:d,b:f,bCell:p,events:this.events,params:this.state.params,isDisabled:this.state.busy},void 0)]},void 0)},t.prototype.render=function(){return this.props.simpleApply?this.renderSimple():this.renderDefault()},t}(ci),Pd=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r._getInfo=Sp(function(n){return ym.infoFromTransform(r.plugin,r.props.state,n)}),r.state={error:void 0,isInitial:!0,params:r.getInfo().initialValues,busy:!1,isCollapsed:r.props.initiallyCollapsed},r}return t.prototype.applyAction=function(){return this.props.customUpdate?this.props.customUpdate(this.state.params):this.plugin.state.updateTransform(this.props.state,this.props.transform.ref,this.state.params)},t.prototype.getInfo=function(){return this._getInfo(this.props.transform)},t.prototype.getTransformerId=function(){return this.props.transform.transformer.id},t.prototype.getHeader=function(){return this.props.customHeader||this.props.transform.transformer.definition.display},t.prototype.canApply=function(){var r=this.props.state,n=r.cells.get(this.props.transform.ref);if(!n)return!1;if(n.status==="error"){var a=r.cells.get(this.props.transform.parent);return a?a.status==="ok":!1}return!this.state.error&&!this.state.busy&&!this.state.isInitial},t.prototype.applyText=function(){return this.canApply()?"Update":"Nothing to Update"},t.prototype.isUpdate=function(){return!0},t.prototype.getSourceAndTarget=function(){var r=this.props.state.cells.get(this.props.transform.ref);return{a:this.props.state.cells.get(this.props.transform.parent).obj,b:r?.obj,bCell:r}},t.prototype.canAutoApply=function(r){var n=this.props.transform.transformer.definition.canAutoUpdate;if(!n)return!1;var a=this.props.state,i=a.cells.get(this.props.transform.ref);if(!i||!i.sourceRef||i.status!=="ok")return!1;var o=a.cells.get(i.sourceRef);return n({a:o.obj,b:i.obj,oldParams:this.getInfo().initialValues,newParams:r},this.plugin)},t.prototype.componentDidMount=function(){var r=this;e.prototype.componentDidMount.call(this),this.props.toggleCollapsed&&this.subscribe(this.props.toggleCollapsed,function(){return r.setState({isCollapsed:!r.state.isCollapsed})}),this.subscribe(this.plugin.state.events.object.updated,function(n){var a=n.ref,i=n.state;r.props.transform.ref!==a||r.props.state!==i||r.state.params!==r.props.transform.params&&(r._getInfo=Sp(function(o){return ym.infoFromTransform(r.plugin,r.props.state,o)}),r.setState({params:r.props.transform.params,isInitial:!0}))})},t.prototype.componentDidUpdate=function(r){var n;if(this.props.transform!==r.transform){var a=this.props.state.cells.get(this.props.transform.ref);this.setState({params:((n=a.params)===null||n===void 0?void 0:n.values)||{},isInitial:!0,error:void 0,simpleOnly:this.state.simpleOnly})}},t}($Q);(function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.events.object.updated,function(n){var a=n.ref,i=n.state;r.props.nodeRef!==a||r.plugin.state.data!==i||r.forceUpdate()})},t.prototype.render=function(){var r=this.plugin.state.data,n=this.props.nodeRef,a=r.cells.get(n);if(!a||a.status!=="ok"&&a.status!=="error")return null;var i=a.transform;return B(Pd,{state:r,transform:i,initiallyCollapsed:this.props.initiallyCollapsed,customHeader:this.props.header},void 0)},t})(Sr);var WGe=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return Object.defineProperty(t.prototype,"current",{get:function(){return this.plugin.managers.structure.hierarchy.behaviors.selection},enumerable:!1,configurable:!0}),t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.current,function(){return r.forceUpdate()})},Object.defineProperty(t.prototype,"unitcell",{get:function(){var r,n=this.plugin.managers.structure.hierarchy.selection;if(n.structures.length===0)return null;for(var a=[],i=0,o=n.structures;i<o.length;i++){var s=o[i],u=s.model;u?.unitcell&&((r=u.unitcell)===null||r===void 0?void 0:r.cell.obj)&&a.push(u.unitcell)}return a.length===0?null:B(uz,{refs:a,labelMultiple:"Unit Cells"},void 0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"customControls",{get:function(){var r=this,n=[];return this.plugin.genericRepresentationControls.forEach(function(a,i){var o=a(r.plugin.managers.structure.hierarchy.selection),s=o[0],u=o[1];s.length>0&&n.push(B("div",{children:B(uz,{refs:s,labelMultiple:u},void 0)},i))}),n.length>0?n:null},enumerable:!1,configurable:!0}),t.prototype.render=function(){return B(Nt,{children:Pe("div",T({style:{marginTop:"6px"}},{children:[this.unitcell,this.customControls]}),void 0)},void 0)},t}(ci),uz=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={showOptions:!1},r.toggleVisibility=function(n){n.preventDefault(),r.plugin.managers.structure.hierarchy.toggleVisibility(r.props.refs),n.currentTarget.blur()},r.highlight=function(n){n.preventDefault(),r.pivot.cell.parent&&Rt.Interactivity.Object.Highlight(r.plugin,{state:r.pivot.cell.parent,ref:r.props.refs.map(function(a){return a.cell.transform.ref})})},r.clearHighlight=function(n){n.preventDefault(),Rt.Interactivity.ClearHighlights(r.plugin)},r.focus=function(n){var a;n.preventDefault();for(var i=!0,o=0,s=r.props.refs;o<s.length;o++){var u=s[o];if(!u.cell.state.isHidden){i=!1;break}}i&&r.plugin.managers.structure.hierarchy.toggleVisibility(r.props.refs,"show");for(var l=[],c=0,d=r.props.refs;c<d.length;c++){var u=d[c];if(!u.cell.state.isHidden){var f=(a=u.cell.obj)===null||a===void 0?void 0:a.data.repr.getLoci();f&&l.push(f)}}r.plugin.managers.camera.focusLoci(l)},r.toggleOptions=function(){return r.setState({showOptions:!r.state.showOptions})},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.events.cell.stateUpdated,function(n){var a;vp.ObjectEvent.isCell(n,(a=r.pivot)===null||a===void 0?void 0:a.cell)&&r.forceUpdate()})},Object.defineProperty(t.prototype,"pivot",{get:function(){return this.props.refs[0]},enumerable:!1,configurable:!0}),t.prototype.render=function(){var r=this.props,n=r.refs,a=r.labelMultiple;if(n.length===0)return null;var i=n[0],o,s;if(n.length===1){var u=i.cell.obj;if(!u)return null;o=u?.label,s=u?.description}else o=n.length+" "+(a||"Objects");return Pe(Nt,{children:[Pe("div",T({className:"msp-flex-row"},{children:[Pe("button",T({className:"msp-form-control msp-control-button-label",title:o+". Click to focus.",onClick:this.focus,onMouseEnter:this.highlight,onMouseLeave:this.clearHighlight,style:{textAlign:"left"}},{children:[o," ",B("small",{children:s},void 0)]}),void 0),B(Zt,{svg:i.cell.state.isHidden?Fm:Lm,toggleState:!1,className:"msp-form-control",onClick:this.toggleVisibility,title:i.cell.state.isHidden?"Show":"Hide",small:!0,flex:!0},void 0),n.length===1&&B(Zt,{svg:mm,className:"msp-form-control",onClick:this.toggleOptions,title:"Options",toggleState:this.state.showOptions,flex:!0},void 0)]}),void 0),n.length===1&&this.state.showOptions&&i.cell.parent&&B(Nt,{children:B("div",T({className:"msp-control-offset"},{children:B(Pd,{state:i.cell.parent,transform:i.cell.transform,customHeader:"none",autoHideApply:!0},void 0)}),void 0)},void 0)]},void 0)},t}(ci),XGe=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.defaultState=function(){return{header:"Components",isCollapsed:!1,isDisabled:!1,brand:{accent:"blue",svg:PI}}},t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,function(n){return r.setState({description:W1.getSelectedStructuresDescription(r.plugin)})})},t.prototype.renderControls=function(){return Pe(Nt,{children:[B(YGe,{},void 0),B($Ge,{},void 0),B(WGe,{},void 0)]},void 0)},t}($0),YGe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isEmpty:!0,isBusy:!1,canUndo:!1},r.togglePreset=r.toggleAction("preset"),r.toggleAdd=r.toggleAction("add"),r.toggleOptions=r.toggleAction("options"),r.hideAction=function(){return r.setState({action:void 0})},r.applyPreset=function(n){if(r.hideAction(),!!n){var a=r.plugin.managers.structure,i=a.hierarchy.selection.structures;n.value===null?a.component.clear(i):a.component.applyPreset(i,n.value)}},r.undo=function(){var n=r.plugin.state.data.undo();n&&r.plugin.runTask(n)},r}return Object.defineProperty(t.prototype,"isDisabled",{get:function(){return this.state.isBusy||this.state.isEmpty},enumerable:!1,configurable:!0}),t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,function(n){return r.setState({action:r.state.action!=="options"||n.structures.length===0?void 0:"options",isEmpty:n.structures.length===0})}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){r.setState({isBusy:n,action:r.state.action!=="options"?void 0:"options"})}),this.subscribe(this.plugin.state.data.events.historyUpdated,function(n){var a=n.state;r.setState({canUndo:a.canUndo})})},t.prototype.toggleAction=function(r){var n=this;return function(){return n.setState({action:n.state.action===r?void 0:r})}},Object.defineProperty(t.prototype,"presetControls",{get:function(){return B(ir,{items:this.presetActions,onSelect:this.applyPreset},void 0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"presetActions",{get:function(){var r=this.plugin.managers.structure.component.pivotStructure,n=this.plugin.builders.structure.representation.getPresets(r?.cell.obj);return ir.createItems(n,{label:function(a){return a.display.name},category:function(a){return a.display.group},description:function(a){return a.display.description}})},enumerable:!1,configurable:!0}),t.prototype.render=function(){var r=this.state.canUndo?"Undo "+this.plugin.state.data.latestUndoLabel:"Some mistakes of the past can be undone.";return Pe(Nt,{children:[Pe("div",T({className:"msp-flex-row"},{children:[B(Wa,{icon:O_,label:"Preset",title:"Apply a representation preset for the current structure(s).",toggle:this.togglePreset,isSelected:this.state.action==="preset",disabled:this.isDisabled},void 0),B(Wa,{icon:Y0,label:"Add",title:"Add a new representation component for a selection.",toggle:this.toggleAdd,isSelected:this.state.action==="add",disabled:this.isDisabled},void 0),B(Wa,{icon:vm,label:"",title:"Options that are applied to all applicable representations.",style:{flex:"0 0 40px",padding:0},toggle:this.toggleOptions,isSelected:this.state.action==="options",disabled:this.isDisabled},void 0),B(Zt,{svg:OI,className:"msp-flex-item",flex:"40px",onClick:this.undo,disabled:!this.state.canUndo||this.isDisabled,title:r},void 0)]}),void 0),this.state.action==="preset"&&this.presetControls,this.state.action==="add"&&B("div",T({className:"msp-control-offset"},{children:B(QQ,{onApply:this.hideAction},void 0)}),void 0),this.state.action==="options"&&B("div",T({className:"msp-control-offset"},{children:B(KGe,{isDisabled:this.isDisabled},void 0)}),void 0)]},void 0)},t}(ci),QQ=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state=r.createState(),r.apply=function(){var n=r.props.forSelection?r.currentStructures:r.selectedStructures;r.props.onApply(),r.plugin.managers.structure.component.add(r.state.values,n)},r.paramsChanged=function(n){return r.setState({values:n})},r}return t.prototype.createState=function(){var r=gm.getAddParams(this.plugin);return{params:r,values:M.getDefaultValues(r)}},Object.defineProperty(t.prototype,"selectedStructures",{get:function(){return this.plugin.managers.structure.component.currentStructures},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentStructures",{get:function(){return this.plugin.managers.structure.hierarchy.current.structures},enumerable:!1,configurable:!0}),t.prototype.render=function(){return Pe(Nt,{children:[B(Jn,{params:this.state.params,values:this.state.values,onChangeValues:this.paramsChanged},void 0),B(xr,T({icon:Y0,title:"Use Selection and optional Representation to create a new Component.",className:"msp-btn-commit msp-btn-commit-on",onClick:this.apply,style:{marginTop:"1px"}},{children:"Create Component"}),void 0)]},void 0)},t}(ci),KGe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.update=function(n){return r.plugin.managers.structure.component.setOptions(n)},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.component.events.optionsUpdated,function(){return r.forceUpdate()})},t.prototype.render=function(){return B(Jn,{params:gm.OptionsParams,values:this.plugin.managers.structure.component.state.options,onChangeValues:this.update,isDisabled:this.props.isDisabled},void 0)},t}(ci),$Ge=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,function(){r.forceUpdate()})},t.prototype.render=function(){var r=this.plugin.managers.structure.hierarchy.currentComponentGroups;return r.length===0?null:B("div",T({style:{marginTop:"6px"}},{children:r.map(function(n){return B(QGe,{group:n},n[0].cell.transform.ref)})}),void 0)},t}(ci),QGe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={action:void 0},r.toggleVisible=function(n){n.preventDefault(),n.currentTarget.blur(),r.plugin.managers.structure.component.toggleVisibility(r.props.group)},r.selectAction=function(n){!n||(r.setState({action:void 0}),(n?.value)())},r.remove=function(){return r.plugin.managers.structure.hierarchy.remove(r.props.group,!0)},r.toggleAction=function(){return r.setState({action:r.state.action==="action"?void 0:"action"})},r.toggleLabel=function(){return r.setState({action:r.state.action==="label"?void 0:"label"})},r.highlight=function(n){n.preventDefault(),r.props.group[0].cell.parent&&Rt.Interactivity.Object.Highlight(r.plugin,{state:r.props.group[0].cell.parent,ref:r.props.group.map(function(a){return a.cell.transform.ref})})},r.clearHighlight=function(n){n.preventDefault(),Rt.Interactivity.ClearHighlights(r.plugin)},r.focus=function(){for(var n=!0,a=0,i=r.props.group;a<i.length;a++){var o=i[a];if(!o.cell.state.isHidden){n=!1;break}}n&&r.plugin.managers.structure.hierarchy.toggleVisibility(r.props.group,"show"),r.plugin.managers.camera.focusSpheres(r.props.group,function(s){var u;if(!s.cell.state.isHidden)return(u=s.cell.obj)===null||u===void 0?void 0:u.data.boundary.sphere})},r.updateLabel=function(n){r.plugin.managers.structure.component.updateLabel(r.pivot,n)},r}return Object.defineProperty(t.prototype,"pivot",{get:function(){return this.props.group[0]},enumerable:!1,configurable:!0}),t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.events.cell.stateUpdated,function(n){vp.ObjectEvent.isCell(n,r.pivot.cell)&&r.forceUpdate()})},Object.defineProperty(t.prototype,"colorByActions",{get:function(){var r=this,n,a,i=this.plugin.managers.structure.component,o=this.pivot.representations[0],s=(n=o.cell.transform.params)===null||n===void 0?void 0:n.colorTheme.name,u=nUe(this.plugin,(a=this.pivot.cell.obj)===null||a===void 0?void 0:a.data);return ir.createItemsFromSelectOptions(u,{value:function(l){return function(){return i.updateRepresentationsTheme(r.props.group,{color:l[0]})}},selected:function(l){return l[0]===s}})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"actions",{get:function(){var r=this,n=this.plugin.managers.structure.component,a=[Gt([ir.Header("Add Representation")],gm.getRepresentationTypes(this.plugin,this.props.group[0]).map(function(i){return ir.Item(i[1],function(){return n.addRepresentation(r.props.group,i[0])})}))];return this.pivot.representations.length>0&&a.push(Gt([ir.Header("Set Coloring",{isIndependent:!0})],this.colorByActions)),n.canBeModified(this.props.group[0])&&a.push([ir.Header("Modify by Selection"),ir.Item("Include",function(){return n.modifyByCurrentSelection(r.props.group,"union")},{icon:AI}),ir.Item("Subtract",function(){return n.modifyByCurrentSelection(r.props.group,"subtract")},{icon:TI}),ir.Item("Intersect",function(){return n.modifyByCurrentSelection(r.props.group,"intersect")},{icon:EI})]),a.push(ir.Item("Select This",function(){return n.selectThis(r.props.group)},{icon:S3})),n.canBeModified(this.props.group[0])&&a.push(ir.Item("Edit Label",this.toggleLabel)),a},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"reprLabel",{get:function(){var r,n=this.pivot;return n.representations.length===0?"No repr.":n.representations.length===1?(r=n.representations[0].cell.obj)===null||r===void 0?void 0:r.label:n.representations.length+" reprs"},enumerable:!1,configurable:!0}),t.prototype.render=function(){var r=this,n,a=this.pivot,i=a.cell,o=(n=i.obj)===null||n===void 0?void 0:n.label,s=this.reprLabel;return Pe(Nt,{children:[Pe("div",T({className:"msp-flex-row"},{children:[Pe(xr,T({noOverflow:!0,className:"msp-control-button-label",title:o+". Click to focus.",onClick:this.focus,onMouseEnter:this.highlight,onMouseLeave:this.clearHighlight,style:{textAlign:"left"}},{children:[o,B("small",T({className:"msp-25-lower-contrast-text",style:{float:"right"}},{children:s}),void 0)]}),void 0),B(Zt,{svg:i.state.isHidden?Fm:Lm,toggleState:!1,onClick:this.toggleVisible,title:(i.state.isHidden?"Show":"Hide")+" component",small:!0,className:"msp-form-control",flex:!0},void 0),B(Zt,{svg:Cu,toggleState:!1,onClick:this.remove,title:"Remove",small:!0,className:"msp-form-control",flex:!0},void 0),B(Zt,{svg:mm,onClick:this.toggleAction,title:"Actions",toggleState:this.state.action==="action",className:"msp-form-control",flex:!0},void 0)]}),void 0),this.state.action==="label"&&B("div",T({className:"msp-control-offset",style:{marginBottom:"6px"}},{children:B(yu,{label:"Label",control:Pe("div",T({style:{display:"flex",textAlignLast:"center"}},{children:[B(ad,{onChange:this.updateLabel,value:o,style:{flex:"1 1 auto",minWidth:0},className:"msp-form-control",blurOnEnter:!0,blurOnEscape:!0},void 0),B(Zt,{svg:K0,onClick:this.toggleLabel,className:"msp-form-control msp-control-button-label",flex:!0},void 0)]}),void 0)},void 0)}),void 0),this.state.action==="action"&&Pe("div",T({className:"msp-accent-offset"},{children:[B("div",T({style:{marginBottom:"6px"}},{children:B(ir,{items:this.actions,onSelect:this.selectAction,noOffset:!0},void 0)}),void 0),B("div",T({style:{marginBottom:"6px"}},{children:a.representations.map(function(u){return B(ZGe,{group:r.props.group,representation:u},u.cell.transform.ref)})}),void 0)]}),void 0)]},void 0)},t}(ci),ZGe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.remove=function(){return r.plugin.managers.structure.component.removeRepresentations(r.props.group,r.props.representation)},r.toggleVisible=function(n){n.preventDefault(),n.currentTarget.blur(),r.plugin.managers.structure.component.toggleVisibility(r.props.group,r.props.representation)},r.update=function(n){return r.plugin.managers.structure.component.updateRepresentations(r.props.group,r.props.representation,n)},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.events.cell.stateUpdated,function(n){vp.ObjectEvent.isCell(n,r.props.representation.cell)&&r.forceUpdate()})},t.prototype.render=function(){var r,n=this.props.representation.cell;return Pe("div",T({className:"msp-representation-entry"},{children:[n.parent&&B(ul,T({header:(((r=n.obj)===null||r===void 0?void 0:r.label)||"")+" Representation",noOffset:!0},{children:B(Pd,{state:n.parent,transform:n.transform,customHeader:"none",customUpdate:this.update,noMargin:!0},void 0)}),void 0),B(Zt,{svg:Cu,onClick:this.remove,title:"Remove",small:!0,className:"msp-default-bg",toggleState:!1,style:{position:"absolute",top:0,right:"32px",lineHeight:"24px",height:"24px",textAlign:"right",width:"44px",paddingRight:"6px",background:"none"}},void 0),B(Zt,{svg:this.props.representation.cell.state.isHidden?Fm:Lm,toggleState:!1,onClick:this.toggleVisible,title:"Toggle Visibility",small:!0,className:"msp-default-bg",style:{position:"absolute",top:0,right:0,lineHeight:"24px",height:"24px",textAlign:"right",width:"32px",paddingRight:"6px",background:"none"}},void 0)]}),void 0)},t}(ci),xT="measurement-group",ZQ={distanceUnitLabel:M.Text("\u212B",{isEssential:!0}),textColor:DK.textColor},JGe=M.getDefaultValues(ZQ),eqe=function(e){Le(t,e);function t(r){var n=e.call(this,{labels:[],distances:[],angles:[],dihedrals:[],orientations:[],options:JGe})||this;return n.plugin=r,n.behaviors={state:n.ev.behavior(n.state)},n._empty=[],r.state.data.events.changed.subscribe(function(a){a.inTransaction||r.behaviors.state.isAnimating.value||n.sync()}),r.behaviors.state.isAnimating.subscribe(function(a){!a&&!r.behaviors.state.isUpdating.value&&n.sync()}),n}return t.prototype.stateUpdated=function(){this.behaviors.state.next(this.state)},t.prototype.getGroup=function(){var r=this.plugin.state.data,n=lr.findTagInSubtree(r.tree,vr.RootRef,xT),a=this.plugin.state.data.build();return n?a.to(n):a.toRoot().group(lt.Misc.CreateGroup,{label:"Measurements"},{tags:xT})},t.prototype.setOptions=function(r){return pe(this,void 0,void 0,function(){var n,a,i,f,o,s,f,u,l,f,c,d,f;return he(this,function(p){switch(p.label){case 0:for(this.updateState({options:r})&&this.stateUpdated(),n=this.plugin.state.data.build(),a=0,i=this.state.distances;a<i.length;a++)f=i[a],n.to(f).update(function(h){h.unitLabel=r.distanceUnitLabel,h.textColor=r.textColor});for(o=0,s=this.state.labels;o<s.length;o++)f=s[o],n.to(f).update(function(h){h.textColor=r.textColor});for(u=0,l=this.state.angles;u<l.length;u++)f=l[u],n.to(f).update(function(h){h.textColor=r.textColor});for(c=0,d=this.state.dihedrals;c<d.length;c++)f=d[c],n.to(f).update(function(h){h.textColor=r.textColor});return n.editInfo.count===0?[2]:[4,Rt.State.Update(this.plugin,{state:this.plugin.state.data,tree:n,options:{doNotLogTiming:!0}})];case 1:return p.sent(),[2]}})})},t.prototype.addDistance=function(r,n,a){return pe(this,void 0,void 0,function(){var i,o,s,u,l;return he(this,function(c){switch(c.label){case 0:return i=this.plugin.helpers.substructureParent.get(r.structure),o=this.plugin.helpers.substructureParent.get(n.structure),!i||!o?[2]:(s=[i.transform.ref],ho(s,o.transform.ref),u=this.getGroup(),u.apply(lt.Model.MultiStructureSelectionFromExpression,{selections:[{key:"a",groupId:"a",ref:i.transform.ref,expression:Oe.toExpression(r)},{key:"b",groupId:"b",ref:o.transform.ref,expression:Oe.toExpression(n)}],isTransitive:!0,label:"Distance"},{dependsOn:s,tags:a?.selectionTags}).apply(lt.Representation.StructureSelectionsDistance3D,T(T(T({customText:a?.customText||"",unitLabel:this.state.options.distanceUnitLabel,textColor:this.state.options.textColor},a?.lineParams),a?.labelParams),a?.visualParams),{tags:a?.reprTags}),l=this.plugin.state.data,[4,Rt.State.Update(this.plugin,{state:l,tree:u,options:{doNotLogTiming:!0}})]);case 1:return c.sent(),[2]}})})},t.prototype.addAngle=function(r,n,a,i){return pe(this,void 0,void 0,function(){var o,s,u,l,c,d;return he(this,function(f){switch(f.label){case 0:return o=this.plugin.helpers.substructureParent.get(r.structure),s=this.plugin.helpers.substructureParent.get(n.structure),u=this.plugin.helpers.substructureParent.get(a.structure),!o||!s||!u?[2]:(l=[o.transform.ref],ho(l,s.transform.ref),ho(l,u.transform.ref),c=this.getGroup(),c.apply(lt.Model.MultiStructureSelectionFromExpression,{selections:[{key:"a",ref:o.transform.ref,expression:Oe.toExpression(r)},{key:"b",ref:s.transform.ref,expression:Oe.toExpression(n)},{key:"c",ref:u.transform.ref,expression:Oe.toExpression(a)}],isTransitive:!0,label:"Angle"},{dependsOn:l,tags:i?.selectionTags}).apply(lt.Representation.StructureSelectionsAngle3D,T(T(T({customText:i?.customText||"",textColor:this.state.options.textColor},i?.lineParams),i?.labelParams),i?.visualParams),{tags:i?.reprTags}),d=this.plugin.state.data,[4,Rt.State.Update(this.plugin,{state:d,tree:c,options:{doNotLogTiming:!0}})]);case 1:return f.sent(),[2]}})})},t.prototype.addDihedral=function(r,n,a,i,o){return pe(this,void 0,void 0,function(){var s,u,l,c,d,f,p;return he(this,function(h){switch(h.label){case 0:return s=this.plugin.helpers.substructureParent.get(r.structure),u=this.plugin.helpers.substructureParent.get(n.structure),l=this.plugin.helpers.substructureParent.get(a.structure),c=this.plugin.helpers.substructureParent.get(i.structure),!s||!u||!l||!c?[2]:(d=[s.transform.ref],ho(d,u.transform.ref),ho(d,l.transform.ref),ho(d,c.transform.ref),f=this.getGroup(),f.apply(lt.Model.MultiStructureSelectionFromExpression,{selections:[{key:"a",ref:s.transform.ref,expression:Oe.toExpression(r)},{key:"b",ref:u.transform.ref,expression:Oe.toExpression(n)},{key:"c",ref:l.transform.ref,expression:Oe.toExpression(a)},{key:"d",ref:c.transform.ref,expression:Oe.toExpression(i)}],isTransitive:!0,label:"Dihedral"},{dependsOn:d,tags:o?.selectionTags}).apply(lt.Representation.StructureSelectionsDihedral3D,T(T(T({customText:o?.customText||"",textColor:this.state.options.textColor},o?.lineParams),o?.labelParams),o?.visualParams),{tags:o?.reprTags}),p=this.plugin.state.data,[4,Rt.State.Update(this.plugin,{state:p,tree:f,options:{doNotLogTiming:!0}})]);case 1:return h.sent(),[2]}})})},t.prototype.addLabel=function(r,n){return pe(this,void 0,void 0,function(){var a,i,o,s;return he(this,function(u){switch(u.label){case 0:return a=this.plugin.helpers.substructureParent.get(r.structure),a?(i=[a.transform.ref],o=this.getGroup(),o.apply(lt.Model.MultiStructureSelectionFromExpression,{selections:[{key:"a",ref:a.transform.ref,expression:Oe.toExpression(r)}],isTransitive:!0,label:"Label"},{dependsOn:i,tags:n?.selectionTags}).apply(lt.Representation.StructureSelectionsLabel3D,T(T({textColor:this.state.options.textColor},n?.labelParams),n?.visualParams),{tags:n?.reprTags}),s=this.plugin.state.data,[4,Rt.State.Update(this.plugin,{state:s,tree:o,options:{doNotLogTiming:!0}})]):[2];case 1:return u.sent(),[2]}})})},t.prototype.addOrientation=function(r){return pe(this,void 0,void 0,function(){var n,a,i,o;return he(this,function(s){switch(s.label){case 0:return n=this.plugin.helpers.substructureParent.get(r.structure),n?(a=[n.transform.ref],i=this.getGroup(),i.apply(lt.Model.MultiStructureSelectionFromExpression,{selections:[{key:"a",ref:n.transform.ref,expression:Oe.toExpression(r)}],isTransitive:!0,label:"Orientation"},{dependsOn:a}).apply(lt.Representation.StructureSelectionsOrientation3D),o=this.plugin.state.data,[4,Rt.State.Update(this.plugin,{state:o,tree:i,options:{doNotLogTiming:!0}})]):[2];case 1:return s.sent(),[2]}})})},t.prototype.getTransforms=function(r){var n=this.plugin.state.data,a=lr.findTagInSubtree(n.tree,vr.RootRef,xT),i=a?n.select(lr.Generators.ofTransformer(r,a)):this._empty;return i.length===0?this._empty:i},t.prototype.sync=function(){var r=this.updateState({labels:this.getTransforms(lt.Representation.StructureSelectionsLabel3D),distances:this.getTransforms(lt.Representation.StructureSelectionsDistance3D),angles:this.getTransforms(lt.Representation.StructureSelectionsAngle3D),dihedrals:this.getTransforms(lt.Representation.StructureSelectionsDihedral3D),orientations:this.getTransforms(lt.Representation.StructureSelectionsOrientation3D)});r&&this.stateUpdated()},t}(Gd),C3=function(e){Le(t,e);function t(r,n){n===void 0&&(n={});var a=e.call(this,{props:T(T({},M.getDefaultValues(t.Params)),n)})||this;return a.plugin=r,a._props=M.getDefaultValues(t.Params),a.events={propsUpdated:a.ev()},a.lociSelects=new t.LociSelectManager(r,a._props),a.lociHighlights=new t.LociHighlightManager(r,a._props),a}return Object.defineProperty(t.prototype,"props",{get:function(){return T({},this.state.props)},enumerable:!1,configurable:!0}),t.prototype.setProps=function(r){var n=this.props,a=T(T({},this.state.props),r);LD(n,a)||(this.updateState({props:a}),this.lociSelects.setProps(a),this.lociHighlights.setProps(a),this.events.propsUpdated.next())},t}(Gd);(function(e){e.Params={granularity:M.Select("residue",cr.GranularityOptions,{label:"Picking Level",description:"Controls if selections are expanded upon picking to whole residues, chains, structures, instances, or left as atoms and coarse elements"})};var t=function(){function a(i,o){o===void 0&&(o={}),this.ctx=i,this.providers=[],this.props=M.getDefaultValues(e.Params),this.sel=i.managers.structure.selection,this.setProps(o)}return a.prototype.setProps=function(i){Object.assign(this.props,i)},a.prototype.addProvider=function(i){this.providers.push(i)},a.prototype.removeProvider=function(i){this.providers=this.providers.filter(function(o){return o!==i})},a.prototype.normalizedLoci=function(i,o){o===void 0&&(o=!0);var s=i.loci,u=i.repr,l=o?this.props.granularity:void 0;return{loci:cr.normalize(s,l),repr:u}},a.prototype.mark=function(i,o){if(!cr.isEmpty(i.loci))for(var s=0,u=this.providers;s<u.length;s++){var l=u[s];l(i,o)}},a}();e.LociMarkManager=t;var r=function(a){Le(i,a);function i(){var o=a!==null&&a.apply(this,arguments)||this;return o.prev=[],o.clearHighlights=function(){for(var s=0,u=o.prev;s<u.length;s++){var l=u[s];o.mark(l,sr.RemoveHighlight)}o.prev.length=0},o}return i.prototype.isHighlighted=function(o){for(var s=0,u=this.prev;s<u.length;s++){var l=u[s];if(mr.Loci.areEqual(l,o))return!0}return!1},i.prototype.addHighlight=function(o){this.mark(o,sr.Highlight),this.prev.push(o)},i.prototype.highlight=function(o,s){s===void 0&&(s=!0);var u=this.normalizedLoci(o,s);this.isHighlighted(u)||this.addHighlight(u)},i.prototype.highlightOnly=function(o,s){s===void 0&&(s=!0);var u=this.normalizedLoci(o,s);this.isHighlighted(u)||(this.clearHighlights(),this.addHighlight(u))},i.prototype.highlightOnlyExtend=function(o,s){s===void 0&&(s=!0);var u=this.normalizedLoci(o,s);if(Oe.is(u.loci)){var l={loci:this.sel.tryGetRange(u.loci)||u.loci,repr:u.repr};this.isHighlighted(l)||(this.clearHighlights(),this.addHighlight(l))}},i}(t);e.LociHighlightManager=r;var n=function(a){Le(i,a);function i(){return a!==null&&a.apply(this,arguments)||this}return i.prototype.toggle=function(o,s){if(s===void 0&&(s=!0),!cr.isEmpty(o.loci)){var u=this.normalizedLoci(o,s);Oe.is(u.loci)?this.toggleSel(u):a.prototype.mark.call(this,u,sr.Toggle)}},i.prototype.toggleExtend=function(o,s){if(s===void 0&&(s=!0),!cr.isEmpty(o.loci)){var u=this.normalizedLoci(o,s);if(Oe.is(u.loci)){var l=this.sel.tryGetRange(u.loci)||u.loci;this.toggleSel({loci:l,repr:u.repr})}}},i.prototype.select=function(o,s){s===void 0&&(s=!0);var u=this.normalizedLoci(o,s);Oe.is(u.loci)&&this.sel.modify("add",u.loci),this.mark(u,sr.Select)},i.prototype.selectJoin=function(o,s){s===void 0&&(s=!0);var u=this.normalizedLoci(o,s);Oe.is(u.loci)&&this.sel.modify("intersect",u.loci),this.mark(u,sr.Select)},i.prototype.selectOnly=function(o,s){s===void 0&&(s=!0);var u=this.normalizedLoci(o,s);Oe.is(u.loci)&&(this.deselect({loci:$e.toStructureElementLoci(u.loci.structure),repr:u.repr},!1),this.sel.modify("set",u.loci)),this.mark(u,sr.Select)},i.prototype.deselect=function(o,s){s===void 0&&(s=!0);var u=this.normalizedLoci(o,s);Oe.is(u.loci)&&this.sel.modify("remove",u.loci),this.mark(u,sr.Deselect)},i.prototype.deselectAll=function(){this.sel.clear(),this.mark({loci:W8e},sr.Deselect)},i.prototype.deselectAllOnEmpty=function(o){Ku(o.loci)&&this.deselectAll()},i.prototype.mark=function(o,s){var u=o.loci;cr.isEmpty(u)||(Oe.is(u)?(a.prototype.mark.call(this,{loci:$e.Loci(u.structure)},sr.Deselect),a.prototype.mark.call(this,{loci:this.sel.getLoci(u.structure)},sr.Select)):a.prototype.mark.call(this,o,s))},i.prototype.toggleSel=function(o){this.sel.has(o.loci)?(this.sel.modify("remove",o.loci),this.mark(o,sr.Deselect)):(this.sel.modify("add",o.loci),this.mark(o,sr.Select))},i}(t);e.LociSelectManager=n})(C3||(C3={}));function tqe(e,t){for(var r,n=[],a=t==="auth"?"auth_asym_id":"label_asym_id",i=t==="auth"?"auth_seq_id":"label_seq_id",o=0,s=e;o<s.length;o++){var u=s[o];if(u.kind==="range")n.push(ce.struct.generator.atomGroups({"chain-test":ce.core.rel.eq([ce.ammp(a),u.asym_id]),"residue-test":ce.core.rel.inRange([ce.ammp(i),u.seq_id_beg,u.seq_id_end])}));else{var l=((r=u.ins_code)!==null&&r!==void 0?r:"").trim();n.push(ce.struct.generator.atomGroups({"chain-test":ce.core.rel.eq([ce.ammp(a),u.asym_id]),"residue-test":ce.core.logic.and([ce.core.rel.eq([ce.ammp(i),u.seq_id]),ce.core.rel.eq([ce.ammp("pdbx_PDB_ins_code"),l])])}))}}var c=ce.struct.combinator.merge(n);return dm(c)}function rqe(e){for(var t=on.create(),r=0,n=e;r<n.length;r++)for(var a=n[r],i=a[0],o=a[1],s=i;s<=o;s++)on.add(t,s,s);var u=ce.struct.generator.atomGroups({"atom-test":ce.core.set.has([ce.set.apply(ce,t.array),ce.ammp("id")])});return dm(u)}function nqe(e,t,r){if(!(!e||t.length===0||Number.isNaN(+t[0])))return Number.isNaN(r)?{kind:"single",asym_id:e,seq_id:+t[0],ins_code:t[1]}:{kind:"range",asym_id:e,seq_id_beg:+t[0],seq_id_end:r}}function aqe(e){return e?e.split(":"):[]}function iqe(e){return e.split(",").map(function(t){return t.trim().split(/\s+|[-]/g).filter(function(r){return!!r})}).map(function(t){return nqe(t[0],aqe(t[1]),+t[2])}).filter(function(t){return!!t})}function oqe(e){return e.split(",").map(function(t){return t.trim().split(/\s+|[-]/g).filter(function(r){return!!r})}).filter(function(t){return t.length===1||t.length===2}).map(function(t){return t.length===1?[+t[0],+t[0]]:[+t[0],+t[1]]})}function sqe(e,t){if(t==="atom-id"){var r=oqe(e);return rqe(r)}else{var r=iqe(e);return tqe(r,t)}}function uqe(e){return Object.keys(e).map(function(t){return[t,e[t]]})}var LI=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getBindingComponents=function(){var r=uqe(this.props.bindings);return B(Nt,{children:r.map(function(n){var a=n[0],i=n[1];return yr.isEmpty(i)?null:Pe("div",T({style:{marginBottom:"6px"}},{children:[B("b",{children:i.action},void 0),B("br",{},void 0),B("span",{dangerouslySetInnerHTML:{__html:yr.format(i,a)}},void 0)]}),a)})},void 0)},t.prototype.render=function(){return B(kl,{children:this.getBindingComponents()},void 0)},t}(ke.exports.PureComponent),kl=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.render=function(){return B("div",T({className:"msp-help-text"},{children:B("div",{children:this.props.children},void 0)}),void 0)},t}(ke.exports.PureComponent),Ll=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={header:r.props.header,isExpanded:!!r.props.initiallyExpanded},r.toggleExpanded=function(){return r.setState({isExpanded:!r.state.isExpanded})},r}return t.prototype.render=function(){return Pe("div",T({className:"msp-control-group-wrapper"},{children:[B("div",T({className:"msp-control-group-header"},{children:Pe(xr,T({onClick:this.toggleExpanded},{children:[B(dn,{svg:this.state.isExpanded?Td:Ed},void 0),this.props.header]}),void 0)}),void 0),this.state.isExpanded&&B("div",T({className:"msp-control-offset",style:{display:this.state.isExpanded?"block":"none"}},{children:this.props.children}),void 0)]}),void 0)},t}(ke.exports.PureComponent);function ST(e){return B("div",T({className:"msp-simple-help-section"},{children:e.header}),void 0)}var IR=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.events.canvas3d.settingsUpdated,function(){return r.forceUpdate()})},t.prototype.render=function(){var r={};return this.plugin.spec.behaviors.forEach(function(n){var a=n.defaultParams.bindings;a&&Object.assign(r,a)}),Pe(Nt,{children:[!this.props.selectOnly&&this.plugin.canvas3d&&B(Ll,T({header:"Moving in 3D"},{children:B(LI,{bindings:this.plugin.canvas3d.props.trackball.bindings},void 0)}),"trackball"),B(Ll,T({header:"Mouse Controls"},{children:B(LI,{bindings:r},void 0)}),"interactions")]},void 0)},t}(Sr),lqe=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.events.canvas3d.settingsUpdated,function(){return r.forceUpdate()})},t.prototype.formatTriggers=function(r){return r.triggers.map(function(n){return yr.Trigger.format(n)}).join(" or ")},t.prototype.getTriggerFor=function(r,n){var a=this.plugin.state.behaviors,i=a.select(lr.Generators.ofTransformer(r)),o=i.length===1?i[0].params:void 0,s=o?o.values.bindings:{},u=n in s?s[n]:yr.Empty;return this.formatTriggers(u)},t.prototype.render=function(){var r=this.getTriggerFor(y$,"clickSelectToggle"),n=this.getTriggerFor(__,"clickFocus");return Pe("div",{children:[B(ST,{header:"Interface Controls"},void 0),Pe(Ll,T({header:"Inline Help"},{children:[B(kl,{children:"Many user interface elements show a little questionmark icon when hovered over. Clicking the icon toggles the display of an inline help text."},void 0),B(kl,{children:"Tooltips may provide additional information on a user interface element and are shown when hovering over it with the mouse."},void 0)]}),void 0),B(Ll,T({header:"Selections"},{children:Pe(kl,{children:["The viewer allows changing colors and representations for selections of atoms, residues or chains. Selections can be created by",Pe("ul",T({style:{paddingLeft:"20px"}},{children:[Pe("li",{children:["picking elements on the 3D canvas or the sequence view using the mouse, e.g. toggle selection using ",r," (for more see help section on ",B("i",{children:"Mouse Controls"},void 0),")"]},void 0),Pe("li",{children:["using the ",B("i",{children:"Add"},void 0),", ",B("i",{children:"Remove"},void 0)," and ",B("i",{children:"Only"},void 0)," dropdown buttons in the ",B("i",{children:"Manage Selection"},void 0)," panel which allow modifing the current selection by predefined sets"]},void 0)]}),void 0)]},void 0)}),void 0),B(Ll,T({header:"Coloring"},{children:Pe(kl,{children:["There are two ways to color structures. Every representation (e.g. cartoon or spacefill) has a color theme which can be changed using the dropdown for each representation in the ",B("i",{children:"Structure Settings"},void 0)," panel. Additionally any selection atoms, residues or chains can by given a custom color. For that, first select the parts of the structure to be colored (see help section on ",B("i",{children:"Selections"},void 0),") and, second, choose a color from the color dropdown botton in the ",B("i",{children:"Selection"},void 0)," row of the ",B("i",{children:"Change Representation"},void 0)," panel. The theme color can be seen as a base color that is overpainted by the custom color. Custom colors can be removed for a selection with the 'Clear' option in the color dropdown."]},void 0)}),void 0),B(Ll,T({header:"Representations"},{children:Pe(kl,{children:["Structures can be shown with many different representations (e.g. cartoon or spacefill). The ",B("i",{children:"Change Representation"},void 0)," panel offers a collection of predefined styles which can be applied using the ",B("i",{children:"Preset"},void 0)," dropdown button. Additionally any selection atoms, residues or chains can by shown with a custom representation. For that, first select the parts of the structure to be mofified (see help section on ",B("i",{children:"Selections"},void 0),") and, second, choose a representation to hide or show from the ",B("i",{children:"Show"},void 0)," and ",B("i",{children:"Hide"},void 0)," dropdown bottons in the ",B("i",{children:"Selection"},void 0)," row of the ",B("i",{children:"Change Representation"},void 0)," panel. The ",B("i",{children:"Everything"},void 0)," row applies the action to the whole structure instead of the current selection."]},void 0)}),void 0),B(Ll,T({header:"Surroundings"},{children:Pe(kl,{children:["To show the surroundings of a residue or ligand, click it in the 3D scene or in the sequence widget using ",n,"."]},void 0)}),void 0),B(ST,{header:"How-to Guides"},void 0),B(Ll,T({header:"Create an Image"},{children:Pe(kl,{children:[Pe("p",{children:["Use the ",B(dn,{svg:DHe},void 0)," icon in the viewport to bring up the screenshot controls."]},void 0),Pe("p",{children:["To adjust the size of the image, use the ",B("i",{children:"Resolution"},void 0)," dropdown."]},void 0)]},void 0)}),void 0),B(ST,{header:"Mouse Controls"},void 0),B(IR,{},void 0)]},void 0)},t}(Sr),w3=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r._toggleSelMode=function(){r.plugin.selectionMode=!r.plugin.selectionMode},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.events.canvas3d.settingsUpdated,function(){return r.forceUpdate()}),this.subscribe(this.plugin.layout.events.updated,function(){return r.forceUpdate()}),this.subscribe(this.plugin.behaviors.interaction.selectionMode,function(){return r.forceUpdate()})},t.prototype.render=function(){var r=this.props.inline?{background:"transparent",width:"auto",height:"auto",lineHeight:"unset"}:{background:"transparent"};return B(Zt,{svg:kje,onClick:this._toggleSelMode,title:"Toggle Selection Mode",style:r,toggleState:this.plugin.selectionMode},void 0)},t}(ci),cqe={granularity:C3.Params.granularity},iv=new Map([["add","Add/Union Selection"],["remove","Remove/Subtract Selection"],["intersect","Intersect Selection"],["set","Set Selection"]]),dqe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={action:void 0,helper:void 0,isEmpty:!0,isBusy:!1,canUndo:!1},r.set=function(n,a){r.plugin.managers.structure.selection.fromSelectionQuery(n,a,!1)},r.selectQuery=function(n,a){if(!n||!r.state.action){r.setState({action:void 0});return}var i=r.state.action;a?.shiftKey?r.set(i,n.value):r.setState({action:void 0},function(){r.set(i,n.value)})},r.selectHelper=function(n,a){if(console.log(n),!n||!r.state.action){r.setState({action:void 0,helper:void 0});return}r.setState({helper:n.value.kind})},r.queriesItems=[],r.queriesVersion=-1,r.helpersItems=void 0,r.toggleAdd=r.showAction("add"),r.toggleRemove=r.showAction("remove"),r.toggleIntersect=r.showAction("intersect"),r.toggleSet=r.showAction("set"),r.toggleTheme=r.showAction("theme"),r.toggleAddComponent=r.showAction("add-component"),r.toggleHelp=r.showAction("help"),r.setGranuality=function(n){var a=n.value;r.plugin.managers.interactivity.setProps({granularity:a})},r.turnOff=function(){return r.plugin.selectionMode=!1},r.undo=function(){var n=r.plugin.state.data.undo();n&&r.plugin.runTask(n)},r.subtract=function(){for(var n=r.plugin.managers.structure.hierarchy.getStructuresWithSelection(),a=[],i=0,o=n;i<o.length;i++){var s=o[i];a.push.apply(a,s.components)}a.length!==0&&r.plugin.managers.structure.component.modifyByCurrentSelection(a,"subtract")},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,function(n){var a=n.hierarchy.structures.length===0;r.state.isEmpty!==a&&r.setState({isEmpty:a}),r.queriesVersion=-1,r.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){r.setState({isBusy:n,action:void 0})}),this.subscribe(this.plugin.managers.interactivity.events.propsUpdated,function(){r.forceUpdate()}),this.subscribe(this.plugin.state.data.events.historyUpdated,function(n){var a=n.state;r.setState({canUndo:a.canUndo})})},Object.defineProperty(t.prototype,"isDisabled",{get:function(){return this.state.isBusy||this.state.isEmpty},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"structures",{get:function(){for(var r,n=[],a=0,i=this.plugin.managers.structure.hierarchy.selection.structures;a<i.length;a++){var o=i[a],s=(r=o.cell.obj)===null||r===void 0?void 0:r.data;s&&n.push(s)}return n},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"queries",{get:function(){var r=this.plugin.query.structure.registry;if(r.version!==this.queriesVersion){var n=this.structures,a=Gt(Gt(Gt(Gt([],r.list),Bke(n)),Oke(n)),Rke(n)).sort(function(i,o){return o.priority-i.priority});this.queriesItems=ir.createItems(a,{filter:function(i){return i!==Ea.current&&!i.isHidden},label:function(i){return i.label},category:function(i){return i.category},description:function(i){return i.description}}),this.queriesVersion=r.version}return this.queriesItems},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"helpers",{get:function(){if(this.helpersItems)return this.helpersItems;var r=[{kind:"residue-list",category:"Helpers",label:"Atom/Residue Identifier List",description:"Create a selection from a list of atom/residue ranges."}];return this.helpersItems=ir.createItems(r,{label:function(n){return n.label},category:function(n){return n.category},description:function(n){return n.description}}),this.helpersItems},enumerable:!1,configurable:!0}),t.prototype.showAction=function(r){var n=this;return function(){return n.setState({action:n.state.action===r?void 0:r,helper:void 0})}},t.prototype.render=function(){var r=this,n=this.plugin.managers.interactivity.props.granularity,a=this.state.canUndo?"Undo "+this.plugin.state.data.latestUndoLabel:"Some mistakes of the past can be undone.",i=void 0;if(this.state.action&&!this.state.helper)i=Pe(Nt,{children:[this.state.action&&this.state.action!=="theme"&&this.state.action!=="add-component"&&this.state.action!=="help"&&Pe("div",T({className:"msp-selection-viewport-controls-actions"},{children:[B(ir,{header:iv.get(this.state.action),title:"Click to close.",items:this.queries,onSelect:this.selectQuery,noOffset:!0},void 0),B(ir,{items:this.helpers,onSelect:this.selectHelper,noOffset:!0},void 0)]}),void 0),this.state.action==="theme"&&B("div",T({className:"msp-selection-viewport-controls-actions"},{children:B(Zc,T({header:"Theme",title:"Click to close.",initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.toggleTheme,topRightIcon:Qc},{children:B(pqe,{onApply:this.toggleTheme},void 0)}),void 0)}),void 0),this.state.action==="add-component"&&B("div",T({className:"msp-selection-viewport-controls-actions"},{children:B(Zc,T({header:"Add Component",title:"Click to close.",initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.toggleAddComponent,topRightIcon:Qc},{children:B(QQ,{onApply:this.toggleAddComponent,forSelection:!0},void 0)}),void 0)}),void 0),this.state.action==="help"&&B("div",T({className:"msp-selection-viewport-controls-actions"},{children:Pe(Zc,T({header:"Help",title:"Click to close.",initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.toggleHelp,topRightIcon:Qc,maxHeight:"300px"},{children:[B(Ll,T({header:"Selection Operations"},{children:Pe(kl,{children:["Use ",B(dn,{svg:AI,inline:!0},void 0)," ",B(dn,{svg:TI,inline:!0},void 0)," ",B(dn,{svg:EI,inline:!0},void 0)," ",B(dn,{svg:S3,inline:!0},void 0)," to modify the selection."]},void 0)}),void 0),B(Ll,T({header:"Representation Operations"},{children:Pe(kl,{children:["Use ",B(dn,{svg:II,inline:!0},void 0)," ",B(dn,{svg:PI,inline:!0},void 0)," ",B(dn,{svg:RI,inline:!0},void 0)," ",B(dn,{svg:OI,inline:!0},void 0)," to color, create components, remove from components, or undo actions."]},void 0)}),void 0),B(IR,{selectOnly:!0},void 0)]}),void 0)}),void 0)]},void 0);else if(iv.has(this.state.action)&&this.state.helper==="residue-list"){var o=function(){return r.setState({action:void 0,helper:void 0})};i=B("div",T({className:"msp-selection-viewport-controls-actions"},{children:B(Zc,T({header:"Atom/Residue Identifier List",title:"Click to close.",initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:o,topRightIcon:Qc},{children:B(mqe,{modifier:this.state.action,plugin:this.plugin,close:o},void 0)}),void 0)}),void 0)}return Pe(Nt,{children:[Pe("div",T({className:"msp-flex-row",style:{background:"none"}},{children:[B(hv,{title:"Picking Level for selecting and highlighting",param:cqe.granularity,name:"granularity",value:n,onChange:this.setGranuality,isDisabled:this.isDisabled},void 0),B(Wa,{icon:AI,title:iv.get("add")+". Hold shift key to keep menu open.",toggle:this.toggleAdd,isSelected:this.state.action==="add",disabled:this.isDisabled},void 0),B(Wa,{icon:TI,title:iv.get("remove")+". Hold shift key to keep menu open.",toggle:this.toggleRemove,isSelected:this.state.action==="remove",disabled:this.isDisabled},void 0),B(Wa,{icon:EI,title:iv.get("intersect")+". Hold shift key to keep menu open.",toggle:this.toggleIntersect,isSelected:this.state.action==="intersect",disabled:this.isDisabled},void 0),B(Wa,{icon:S3,title:iv.get("set")+". Hold shift key to keep menu open.",toggle:this.toggleSet,isSelected:this.state.action==="set",disabled:this.isDisabled},void 0),B(Wa,{icon:II,title:"Apply Theme to Selection",toggle:this.toggleTheme,isSelected:this.state.action==="theme",disabled:this.isDisabled,style:{marginLeft:"10px"}},void 0),B(Wa,{icon:PI,title:"Create Component of Selection with Representation",toggle:this.toggleAddComponent,isSelected:this.state.action==="add-component",disabled:this.isDisabled},void 0),B(Zt,{svg:RI,title:"Remove/subtract Selection from all Components",onClick:this.subtract,disabled:this.isDisabled},void 0),B(Zt,{svg:OI,onClick:this.undo,disabled:!this.state.canUndo||this.isDisabled,title:a},void 0),B(Wa,{icon:cc,title:"Show/hide help",toggle:this.toggleHelp,style:{marginLeft:"10px"},isSelected:this.state.action==="help"},void 0),B(Zt,{svg:CR,title:"Turn selection mode off",onClick:this.turnOff},void 0)]}),void 0),i]},void 0)},t}(Sr),fqe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isEmpty:!0,isBusy:!1},r.clear=function(){return r.plugin.managers.interactivity.lociSelects.deselectAll()},r.focus=function(){if(r.plugin.managers.structure.selection.stats.elementCount!==0){var n=r.plugin.managers.structure.selection.getBoundary().sphere;r.plugin.managers.camera.focusSphere(n)}},r.highlight=function(n){r.plugin.managers.interactivity.lociHighlights.clearHighlights(),r.plugin.managers.structure.selection.entries.forEach(function(a){r.plugin.managers.interactivity.lociHighlights.highlight({loci:a.selection},!1)})},r.clearHighlight=function(){r.plugin.managers.interactivity.lociHighlights.clearHighlights()},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.selection.events.changed,function(){r.forceUpdate()}),this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,function(n){var a=n.structures.length===0;r.state.isEmpty!==a&&r.setState({isEmpty:a})}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){r.setState({isBusy:n})})},Object.defineProperty(t.prototype,"isDisabled",{get:function(){return this.state.isBusy||this.state.isEmpty},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stats",{get:function(){var r=this.plugin.managers.structure.selection.stats;return r.structureCount===0||r.elementCount===0?"Nothing Selected":jf(r.label)+" Selected"},enumerable:!1,configurable:!0}),t.prototype.render=function(){var r=this.plugin.managers.structure.selection.stats,n=r.structureCount===0||r.elementCount===0;return n&&this.props.hideOnEmpty?null:B(Nt,{children:Pe("div",T({className:"msp-flex-row"},{children:[B(xr,T({noOverflow:!0,onClick:this.focus,title:"Click to Focus Selection",disabled:n,onMouseEnter:this.highlight,onMouseLeave:this.clearHighlight,style:{textAlignLast:n?void 0:"left"}},{children:this.stats}),void 0),!n&&B(Zt,{svg:CR,onClick:this.clear,title:"Clear",className:"msp-form-control",flex:!0},void 0)]}),void 0)},void 0)},t}(Sr),pqe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r._params=Sp(function(n){return gm.getThemeParams(r.plugin,n)}),r.state={values:M.getDefaultValues(r.params)},r.apply=function(){var n,a;r.plugin.managers.structure.component.applyTheme(r.state.values,r.plugin.managers.structure.hierarchy.current.structures),(a=(n=r.props).onApply)===null||a===void 0||a.call(n)},r.paramsChanged=function(n){return r.setState({values:n})},r}return Object.defineProperty(t.prototype,"params",{get:function(){return this._params(this.plugin.managers.structure.component.pivotStructure)},enumerable:!1,configurable:!0}),t.prototype.render=function(){return Pe(Nt,{children:[B(Jn,{params:this.params,values:this.state.values,onChangeValues:this.paramsChanged},void 0),B(xr,T({icon:II,className:"msp-btn-commit msp-btn-commit-on",onClick:this.apply,style:{marginTop:"1px"}},{children:"Apply Theme"}),void 0)]},void 0)},t}(ci),JQ={idType:M.Select("auth",M.arrayToOptions(["auth","label","atom-id"])),identifiers:M.Text("",{description:"A comma separated list of atom identifiers (e.g. 10, 15-25) or residue ranges in given chain (e.g. A 10-15, B 25, C 30:i)"})},hqe=M.getDefaultValues(JQ);function mqe(e){var t=e.modifier,r=e.plugin,n=e.close,a=ke.exports.useState(hqe),i=a[0],o=a[1],s=function(){if(i.identifiers.trim().length!==0)try{n();var u=sqe(i.identifiers,i.idType);r.managers.structure.selection.fromCompiledQuery(t,u,!1)}catch(l){r.log.error("Failed to create selection: "+l)}};return Pe(Nt,{children:[B(Jn,{params:JQ,values:i,onChangeValues:o,onEnter:s},void 0),Pe(xr,T({className:"msp-btn-commit msp-btn-commit-on",disabled:i.identifiers.trim().length===0,onClick:s,style:{marginTop:"1px"}},{children:[k0(t)," Selection"]}),void 0)]},void 0)}var vqe=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.defaultState=function(){return{isCollapsed:!1,header:"Measurements",brand:{accent:"gray",svg:fHe}}},t.prototype.renderControls=function(){return Pe(Nt,{children:[B(yqe,{},void 0),B(gqe,{},void 0)]},void 0)},t}($0),gqe=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.measurement.behaviors.state,function(){r.forceUpdate()})},t.prototype.renderGroup=function(r,n){for(var a=[],i=0,o=r;i<o.length;i++){var s=o[i];s.obj&&a.push(B(xqe,{cell:s},s.obj.id))}return a.length?B(ul,T({header:n,initiallyExpanded:!0},{children:a}),void 0):null},t.prototype.render=function(){var r=this.plugin.managers.structure.measurement.state;return Pe("div",T({style:{marginTop:"6px"}},{children:[this.renderGroup(r.labels,"Labels"),this.renderGroup(r.distances,"Distances"),this.renderGroup(r.angles,"Angles"),this.renderGroup(r.dihedrals,"Dihedrals")]}),void 0)},t}(ci),yqe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isBusy:!1,action:void 0},r.measureDistance=function(){var n=r.plugin.managers.structure.selection.additionsHistory;r.plugin.managers.structure.measurement.addDistance(n[0].loci,n[1].loci)},r.measureAngle=function(){var n=r.plugin.managers.structure.selection.additionsHistory;r.plugin.managers.structure.measurement.addAngle(n[0].loci,n[1].loci,n[2].loci)},r.measureDihedral=function(){var n=r.plugin.managers.structure.selection.additionsHistory;r.plugin.managers.structure.measurement.addDihedral(n[0].loci,n[1].loci,n[2].loci,n[3].loci)},r.addLabel=function(){var n=r.plugin.managers.structure.selection.additionsHistory;r.plugin.managers.structure.measurement.addLabel(n[0].loci)},r.selectAction=function(n){r.toggleAdd(),n&&(n?.value)()},r.toggleAdd=function(){return r.setState({action:r.state.action==="add"?void 0:"add"})},r.toggleOptions=function(){return r.setState({action:r.state.action==="options"?void 0:"options"})},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.selection.events.additionsHistoryUpdated,function(){r.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){r.setState({isBusy:n})})},Object.defineProperty(t.prototype,"selection",{get:function(){return this.plugin.managers.structure.selection},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"actions",{get:function(){var r=this.selection.additionsHistory,n=[{kind:"item",label:"Label "+(r.length===0?" (1 selection required)":" (1st selection)"),value:this.addLabel,disabled:r.length===0},{kind:"item",label:"Distance "+(r.length<2?" (2 selections required)":" (top 2 selections)"),value:this.measureDistance,disabled:r.length<2},{kind:"item",label:"Angle "+(r.length<3?" (3 selections required)":" (top 3 selections)"),value:this.measureAngle,disabled:r.length<3},{kind:"item",label:"Dihedral "+(r.length<4?" (4 selections required)":" (top 4 selections)"),value:this.measureDihedral,disabled:r.length<4}];return n},enumerable:!1,configurable:!0}),t.prototype.highlight=function(r){this.plugin.managers.interactivity.lociHighlights.highlightOnly({loci:r},!1)},t.prototype.moveHistory=function(r,n){this.plugin.managers.structure.selection.modifyHistory(r,n,4)},t.prototype.focusLoci=function(r){this.plugin.managers.camera.focusLoci(r)},t.prototype.historyEntry=function(r,n){var a=this,i=this.plugin.managers.structure.selection.additionsHistory;return Pe("div",T({className:"msp-flex-row"},{children:[Pe(xr,T({noOverflow:!0,title:"Click to focus. Hover to highlight.",onClick:function(){return a.focusLoci(r.loci)},style:{width:"auto",textAlign:"left"},onMouseEnter:function(){return a.highlight(r.loci)},onMouseLeave:this.plugin.managers.interactivity.lociHighlights.clearHighlights},{children:[n,". ",B("span",{dangerouslySetInnerHTML:{__html:r.label}},void 0)]}),void 0),i.length>1&&B(Zt,{svg:R_,small:!0,className:"msp-form-control",onClick:function(){return a.moveHistory(r,"up")},flex:"20px",title:"Move up"},void 0),i.length>1&&B(Zt,{svg:k_,small:!0,className:"msp-form-control",onClick:function(){return a.moveHistory(r,"down")},flex:"20px",title:"Move down"},void 0),B(Zt,{svg:Cu,small:!0,className:"msp-form-control",onClick:function(){return a.plugin.managers.structure.selection.modifyHistory(r,"remove")},flex:!0,title:"Remove"},void 0)]}),r.id)},t.prototype.add=function(){for(var r=this.plugin.managers.structure.selection.additionsHistory,n=[],a=0,i=Math.min(r.length,4);a<i;a++)n.push(this.historyEntry(r[a],a+1));return Pe(Nt,{children:[B(ir,{items:this.actions,onSelect:this.selectAction},void 0),n.length>0&&B("div",T({className:"msp-control-offset"},{children:n}),void 0),n.length===0&&B("div",T({className:"msp-control-offset msp-help-text"},{children:Pe("div",T({className:"msp-help-description"},{children:[B(dn,{svg:cc,inline:!0},void 0),"Add one or more selections (toggle ",B(w3,{inline:!0},void 0)," mode)"]}),void 0)}),void 0)]},void 0)},t.prototype.render=function(){return Pe(Nt,{children:[Pe("div",T({className:"msp-flex-row"},{children:[B(Wa,{icon:Y0,label:"Add",toggle:this.toggleAdd,isSelected:this.state.action==="add",disabled:this.state.isBusy,className:"msp-btn-apply-simple"},void 0),B(Wa,{icon:vm,label:"",title:"Options",toggle:this.toggleOptions,isSelected:this.state.action==="options",disabled:this.state.isBusy,style:{flex:"0 0 40px",padding:0}},void 0)]}),void 0),this.state.action==="add"&&this.add(),this.state.action==="options"&&B(bqe,{},void 0)]},void 0)},t}(ci),bqe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isDisabled:!1},r.changed=function(n){r.plugin.managers.structure.measurement.setOptions(n)},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.measurement.behaviors.state,function(){r.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){r.setState({isDisabled:n})})},t.prototype.render=function(){var r=this.plugin.managers.structure.measurement.state;return B("div",T({className:"msp-control-offset"},{children:B(Jn,{params:ZQ,values:r.options,onChangeValues:this.changed,isDisabled:this.state.isDisabled},void 0)}),void 0)},t}(ci),xqe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={showUpdate:!1},r.delete=function(){Rt.State.RemoveObject(r.plugin,{state:r.props.cell.parent,ref:r.props.cell.transform.parent,removeParentGhosts:!0})},r.toggleVisibility=function(n){n.preventDefault(),Rt.State.ToggleVisibility(r.plugin,{state:r.props.cell.parent,ref:r.props.cell.transform.parent}),n.currentTarget.blur()},r.highlight=function(){var n,a=r.selections;if(!!a){r.plugin.managers.interactivity.lociHighlights.clearHighlights();for(var i=0,o=r.lociArray;i<o.length;i++){var s=o[i];r.plugin.managers.interactivity.lociHighlights.highlight({loci:s},!1)}r.plugin.managers.interactivity.lociHighlights.highlight({loci:(n=r.props.cell.obj)===null||n===void 0?void 0:n.data.repr.getLoci()},!1)}},r.clearHighlight=function(){r.plugin.managers.interactivity.lociHighlights.clearHighlights()},r.toggleUpdate=function(){return r.setState({showUpdate:!r.state.showUpdate})},r.focus=function(){var n=r.selections;if(!!n){var a=cr.getBundleBoundingSphere({loci:r.lociArray});a&&r.plugin.managers.camera.focusSphere(a)}},r.selectAction=function(n){!n||(r.setState({showUpdate:!1}),(n?.value)())},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.events.cell.stateUpdated,function(n){r.forceUpdate()})},Object.defineProperty(t.prototype,"selections",{get:function(){var r;return(r=this.props.cell.obj)===null||r===void 0?void 0:r.data.sourceData},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lociArray",{get:function(){var r=this.selections;return r?r.infos?[r.infos[0].loci]:r.pairs?r.pairs[0].loci:r.triples?r.triples[0].loci:r.quads?r.quads[0].loci:[]:[]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"label",{get:function(){var r=this.selections;return r?r.infos?wp(r.infos[0].loci,{condensed:!0}):r.pairs?m_(r.pairs[0],{condensed:!0,unitLabel:this.plugin.managers.structure.measurement.state.options.distanceUnitLabel}):r.triples?v_(r.triples[0],{condensed:!0}):r.quads?g_(r.quads[0],{condensed:!0}):"<empty>":"<empty>"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"actions",{get:function(){var r=this;return this.props.cell.sourceRef,[ir.Item("Select This",function(){return r.plugin.managers.structure.selection.fromSelections(r.props.cell.sourceRef)},{icon:S3})]},enumerable:!1,configurable:!0}),t.prototype.render=function(){var r=this.props.cell,n=r.obj;return n?Pe(Nt,{children:[Pe("div",T({className:"msp-flex-row",onMouseEnter:this.highlight,onMouseLeave:this.clearHighlight},{children:[B("button",T({className:"msp-form-control msp-control-button-label msp-no-overflow",title:"Click to focus. Hover to highlight.",onClick:this.focus,style:{width:"auto",textAlign:"left"}},{children:B("span",{dangerouslySetInnerHTML:{__html:this.label}},void 0)}),void 0),B(Zt,{svg:r.state.isHidden?Fm:Lm,toggleState:!1,small:!0,className:"msp-form-control",onClick:this.toggleVisibility,flex:!0,title:r.state.isHidden?"Show":"Hide"},void 0),B(Zt,{svg:Cu,small:!0,className:"msp-form-control",onClick:this.delete,flex:!0,title:"Delete",toggleState:!1},void 0),B(Zt,{svg:mm,className:"msp-form-control",onClick:this.toggleUpdate,flex:!0,title:"Actions",toggleState:this.state.showUpdate},void 0)]}),n.id),this.state.showUpdate&&r.parent&&B(Nt,{children:Pe("div",T({className:"msp-accent-offset"},{children:[B(ir,{items:this.actions,onSelect:this.selectAction,noOffset:!0},void 0),B(ul,T({header:"Options",noOffset:!0},{children:B(Pd,{state:r.parent,transform:r.transform,customHeader:"none",autoHideApply:!0},void 0)}),void 0)]}),void 0)},void 0)]},void 0):null},t}(ci);function CT(e,t,r,n){for(var a=nt.indexOf(t.unit.elements,t.element),i=Oe(t.structure,[{unit:t.unit,indices:Ne.ofSingleton(a)}]),o=n==="residue"?Oe.extendToWholeResidues(i):Oe.extendToWholeChains(i),s=mt.entity.pdbx_description(t).join(", "),u=0,l=r.units;u<l.length;u++){var c=l[u],d=Oe(o.structure,[{unit:c,indices:o.elements[0].indices}]),f=wp(d,{reverse:!0,hidePrefix:!0,htmlStyling:!1,granularity:n});f||(f=wp(d,{hidePrefix:!1,htmlStyling:!1})),r.units.length>1&&(f+=" | "+d.elements[0].unit.conformation.operator.name);var p={label:f,category:s,loci:d};e.has(s)?e.get(s).push(p):e.set(s,[p])}}function Sqe(e){for(var t=new Map,r=ot.create(e),n=0,a=e.unitSymmetryGroups;n<a.length;n++){var i=a[n];if(!!We.isAtomic(i.units[0])){r.unit=i.units[0],r.element=i.elements[0];var o=We.Traits.is(r.unit.traits,1),s=mt.entity.type(r),u=s==="non-polymer",l=s==="branched",c=!!mt.entity.prd_id(r);if(c)CT(t,r,i,"chain");else if(u&&!o)CT(t,r,i,"residue");else if(l||u&&o)for(var d=r.unit,f=d.model.atomicHierarchy.residueAtomSegments.index,p=-1,h=0,m=d.elements.length;h<m;++h){var v=d.elements[h],g=f[v];g!==p&&(r.element=v,CT(t,r,i,"residue"),p=g)}}}var y=[];return t.forEach(function(b,S){b.length===1?y.push({label:S+": "+b[0].label,loci:b[0].loci}):b.length<2e3&&y.push.apply(y,b)}),y}var Cqe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isBusy:!1,showAction:!1},r.getSelectionItems=Sp(function(n){for(var a,i=[],o=0,s=n;o<s.length;o++){var u=s[o],l=(a=u.cell.obj)===null||a===void 0?void 0:a.data;if(l){var c=Sqe(l);c.length>0&&i.push(Gt([ir.Header(l.label,{description:l.label})],ir.createItems(c,{label:function(d){return d.label},category:function(d){return d.category},description:function(d){return d.label}})))}}return i}),r.selectAction=function(n,a){if(!n||!r.state.showAction){r.setState({showAction:!1});return}var i=n.value;a?.shiftKey?r.plugin.managers.structure.focus.addFromLoci(i.loci):r.plugin.managers.structure.focus.set(i),r.focusCamera()},r.toggleAction=function(){return r.setState({showAction:!r.state.showAction})},r.focusCamera=function(){var n=r.plugin.managers.structure.focus.current;n&&r.plugin.managers.camera.focusLoci(n.loci)},r.clear=function(){r.plugin.managers.structure.focus.clear(),r.plugin.managers.camera.reset()},r.highlightCurrent=function(){var n=r.plugin.managers.structure.focus.current;n&&r.plugin.managers.interactivity.lociHighlights.highlightOnly({loci:n.loci},!1)},r.clearHighlights=function(){r.plugin.managers.interactivity.lociHighlights.clearHighlights()},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.focus.behaviors.current,function(n){r.getSelectionItems([]),r.forceUpdate()}),this.subscribe(this.plugin.managers.structure.focus.events.historyUpdated,function(n){r.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){r.setState({isBusy:n,showAction:!1})})},Object.defineProperty(t.prototype,"isDisabled",{get:function(){return this.state.isBusy||this.actionItems.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"actionItems",{get:function(){var r=[],n=this.plugin.managers.structure.focus.history;n.length>0&&r.push(Gt([ir.Header("History",{description:"Previously focused on items."})],ir.createItems(n,{label:function(u){return u.label},description:function(u){return u.category&&u.label!==u.category?u.category+" | "+u.label:u.label}})));var a=this.getSelectionItems(this.plugin.managers.structure.hierarchy.selection.structures);if(a.length===1){var i=a[0],o=i[0];o.initiallyExpanded=!0}var s=[];return a.length>0&&s.push.apply(s,a),r.length>0&&s.push.apply(s,r),s},enumerable:!1,configurable:!0}),t.prototype.getToggleBindingLabel=function(){var r,n=this.plugin.state.behaviors.transforms.get(__.id);if(!n)return"";var a=(r=n.params)===null||r===void 0?void 0:r.bindings.clickFocus;return!a||yr.isEmpty(a)?"":yr.formatTriggers(a)},t.prototype.render=function(){var r=this.plugin.managers.structure.focus.current,n=r?.label||"Nothing Focused",a="Click to Center Camera";if(!r){a="Select focus using the menu";var i=this.getToggleBindingLabel();i&&(a+=`
or use '`+i+"' on element")}return Pe(Nt,{children:[Pe("div",T({className:"msp-flex-row"},{children:[B(xr,T({noOverflow:!0,onClick:this.focusCamera,title:a,onMouseEnter:this.highlightCurrent,onMouseLeave:this.clearHighlights,disabled:this.isDisabled||!r,style:{textAlignLast:r?"left":void 0}},{children:n}),void 0),r&&B(Zt,{svg:CR,onClick:this.clear,title:"Clear",className:"msp-form-control",flex:!0,disabled:this.isDisabled},void 0),B(Wa,{icon:BHe,title:"Select a focus target to center on an show its surroundings. Hold shift to focus on multiple targets.",toggle:this.toggleAction,isSelected:this.state.showAction,disabled:this.isDisabled,style:{flex:"0 0 40px",padding:0}},void 0)]}),void 0),this.state.showAction&&B(ir,{items:this.actionItems,onSelect:this.selectAction},void 0)]},void 0)},t}(Sr),wqe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.item=function(n){var a,i,o,s,u,l,c,d,f,p=r.plugin.managers.structure.hierarchy.seletionSet,h;switch(n.kind){case"model":{var m=(a=n.cell.obj)===null||a===void 0?void 0:a.data;m&&rr.TrajectoryInfo.get(m).size>1&&(h=((i=n.cell.obj)===null||i===void 0?void 0:i.data.entryId)+" | Model "+(rr.TrajectoryInfo.get(m).index+1)+" of "+rr.TrajectoryInfo.get(m).size),h=((o=n.cell.obj)===null||o===void 0?void 0:o.data.entryId)+" | "+((s=n.cell.obj)===null||s===void 0?void 0:s.label);break}case"structure":{var m=(u=n.cell.obj)===null||u===void 0?void 0:u.data.models[0];if(m&&rr.TrajectoryInfo.get(m).size>1){h=m.entryId+" | "+((l=n.cell.obj)===null||l===void 0?void 0:l.label)+" (Model "+(rr.TrajectoryInfo.get(m).index+1)+" of "+rr.TrajectoryInfo.get(m).size+")";break}else if(m){h=m.entryId+" | "+((c=n.cell.obj)===null||c===void 0?void 0:c.label);break}else{h=""+((d=n.cell.obj)===null||d===void 0?void 0:d.label);break}}default:h=(f=n.cell.obj)===null||f===void 0?void 0:f.label;break}var v={kind:"item",label:h||n.kind,selected:p.has(n.cell.transform.ref),value:[n]};return v},r.getTrajectoryItems=function(n){var a;return n.models.length===0?r.item(n):Gt([ir.Header((a=n.cell.obj)===null||a===void 0?void 0:a.label)],n.models.map(r.getModelItems))},r.getModelItems=function(n){var a,i,o;if(n.structures.length===0)return r.item(n);if(n.structures.length===1){var s=r.plugin.managers.structure.hierarchy.seletionSet,u=n.structures[0];return{label:((a=n.cell.obj)===null||a===void 0?void 0:a.label)+" | "+((i=u.cell.obj)===null||i===void 0?void 0:i.label),selected:s.has(u.cell.transform.ref),value:[n,u]}}return Gt([ir.Header((o=n.cell.obj)===null||o===void 0?void 0:o.label)],n.structures.map(r.item))},r.selectHierarchy=function(n){if(!(!n||n.length===0)){for(var a=[],i=0,o=n;i<o.length;i++)for(var s=o[i],u=0,l=s.value;u<l.length;u++){var c=l[u];a.push(c)}r.plugin.managers.structure.hierarchy.updateCurrent(a,n[0].selected?"remove":"add")}},r.toggleHierarchy=function(){return r.setState({show:r.state.show!=="hierarchy"?"hierarchy":void 0})},r.togglePreset=function(){return r.setState({show:r.state.show!=="presets"?"presets":void 0})},r.applyPreset=function(n){if(r.setState({show:void 0}),!!n){var a=r.plugin.managers.structure,i=a.hierarchy.selection.trajectories;a.hierarchy.applyPreset(i,n.value)}},r.updateModelQueueParams=void 0,r.isUpdatingModel=!1,r.updateStructureModel=function(n){r.updateModelQueueParams=n,r._updateStructureModel()},r.updateStructure=function(n){var a=r.plugin.managers.structure.hierarchy.selection,i=a.structures[0];return r.plugin.managers.structure.hierarchy.updateStructure(i,n)},r}return t.prototype.defaultState=function(){return{header:"Structure",isCollapsed:!1,isBusy:!1,brand:{accent:"purple",svg:sHe}}},t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,function(){return r.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){r.setState({isBusy:n})})},Object.defineProperty(t.prototype,"hierarchyItems",{get:function(){var r=this.plugin.managers.structure.hierarchy,n=r.current,a=[];return n.trajectories.length>1&&a.push(Gt([ir.Header("Trajectories")],n.trajectories.map(this.item))),(n.models.length>1||n.trajectories.length>1)&&a.push(Gt([ir.Header("Models")],n.models.map(this.item))),n.trajectories.length===1&&n.models.length===1?a.push.apply(a,n.structures.map(this.item)):n.structures.length>0&&a.push(Gt([ir.Header("Structures")],n.structures.map(this.item))),a},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isEmpty",{get:function(){var r=this.plugin.managers.structure.hierarchy.current,n=r.structures,a=r.models,i=r.trajectories;return i.length===0&&a.length===0&&n.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"label",{get:function(){var r,n,a,i,o,s,u,l,c,d,f,p,h,m,v=this.plugin.managers.structure.hierarchy.selection,g=v.structures,y=v.models,b=v.trajectories;if(g.length===1){var S=g[0];return((n=(r=S.model)===null||r===void 0?void 0:r.trajectory)===null||n===void 0?void 0:n.models)&&S.model.trajectory.models.length===1?(a=S.cell.obj)===null||a===void 0?void 0:a.data.label:S.model?((i=S.model.cell.obj)===null||i===void 0?void 0:i.label)+" | "+((o=S.cell.obj)===null||o===void 0?void 0:o.data.label):(s=S.cell.obj)===null||s===void 0?void 0:s.data.label}if(g.length>1){for(var x=g[0],C=(u=x?.model)===null||u===void 0?void 0:u.trajectory,w=!0,_=0,E=g;_<E.length;_++){var S=E[_];if(((l=S?.model)===null||l===void 0?void 0:l.trajectory)!==C){w=!1;break}}return w&&C?((c=C.cell.obj)===null||c===void 0?void 0:c.label)+" | "+g.length+" structures":g.length+" structures"}if(y.length>0){var C=y[0].trajectory;if(y.length===1){var P=(d=y[0].cell.obj)===null||d===void 0?void 0:d.data;return P&&rr.TrajectoryInfo.get(P).size>1?((f=C?.cell.obj)===null||f===void 0?void 0:f.label)+" | Model "+(rr.TrajectoryInfo.get(P).index+1)+" of "+rr.TrajectoryInfo.get(P).size:((p=C?.cell.obj)===null||p===void 0?void 0:p.label)+" | Model"}for(var w=!0,D=0,k=y;D<k.length;D++){var F=k[D];if(F.trajectory!==C){w=!1;break}}return w?((h=C?.cell.obj)===null||h===void 0?void 0:h.label)+" | "+y.length+" models":y.length+" models"}return b.length>0?b.length===1?((m=b[0].cell.obj)===null||m===void 0?void 0:m.label)+" trajectory":b.length+" trajectories":b.length===0&&y.length===0&&g.length===0?"Nothing Loaded":"Nothing Selected"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"presetActions",{get:function(){var r=[],n=this.plugin.managers.structure.hierarchy.selection.trajectories;if(n.length===0)return r;var a=this.plugin.builders.structure.hierarchy.getPresets(n[0].cell.obj);if(n.length>1){for(var i=new Set(a),o=1;o<n.length;o++)for(var s=this.plugin.builders.structure.hierarchy.getPresets(n[o].cell.obj),u=new Set(s),l=0,c=s;l<c.length;l++){var d=c[l];u.has(d)||i.delete(d)}a=a.filter(function(h){return i.has(h)})}for(var f=0,p=a;f<p.length;f++){var d=p[f];r.push(ir.Item(d.display.name,d,{description:d.display.description}))}return r},enumerable:!1,configurable:!0}),t.prototype._updateStructureModel=function(){return pe(this,void 0,void 0,function(){var r,n,a;return he(this,function(i){switch(i.label){case 0:if(!this.updateModelQueueParams||this.isUpdatingModel)return[2];r=this.updateModelQueueParams,this.updateModelQueueParams=void 0,i.label=1;case 1:return i.trys.push([1,,3,4]),this.isUpdatingModel=!0,n=this.plugin.managers.structure.hierarchy.selection,a=n.structures[0].model,[4,this.plugin.state.updateTransform(this.plugin.state.data,a.cell.transform.ref,r,"Model Index")];case 2:return i.sent(),[3,4];case 3:return this.isUpdatingModel=!1,this._updateStructureModel(),[7];case 4:return[2]}})})},Object.defineProperty(t.prototype,"modelIndex",{get:function(){var r,n,a=this.plugin.managers.structure.hierarchy.selection;if(a.structures.length!==1)return null;var i=a.structures[0].model;if(!i||i.cell.transform.transformer!==lt.Model.ModelFromTrajectory||!i.cell.obj||rr.TrajectoryInfo.get(i.cell.obj.data).size<=1)return null;var o=(r=i.cell.params)===null||r===void 0?void 0:r.definition;return o?B(Jn,{params:o,values:(n=i.cell.params)===null||n===void 0?void 0:n.values,onChangeValues:this.updateStructureModel,isDisabled:this.state.isBusy},void 0):null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"structureType",{get:function(){var r,n=this.plugin.managers.structure.hierarchy.selection;if(n.structures.length!==1)return null;var a=n.structures[0],i=(r=a.cell.params)===null||r===void 0?void 0:r.definition;return!i||!a.cell.parent?null:B(Pd,{state:a.cell.parent,transform:a.cell.transform,customHeader:"none",customUpdate:this.updateStructure,noMargin:!0,autoHideApply:!0},void 0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"transform",{get:function(){var r=this.plugin.managers.structure.hierarchy.selection;if(r.structures.length!==1)return null;var n=r.structures[0];if(!n.cell.parent)return null;var a=lr.tryFindDecorator(this.plugin.state.data,n.cell.transform.ref,lt.Model.TransformStructureConformation);if(!!a)return B(ul,T({header:"Conformation Transform"},{children:B(Pd,{state:a.parent,transform:a.transform,customHeader:"none",noMargin:!0,autoHideApply:!0},void 0)}),void 0)},enumerable:!1,configurable:!0}),t.prototype.renderControls=function(){var r=this.state.isBusy||this.isEmpty,n=this.presetActions,a=this.label;return Pe(Nt,{children:[Pe("div",T({className:"msp-flex-row",style:{marginTop:"1px"}},{children:[B(xr,T({noOverflow:!0,flex:!0,onClick:this.toggleHierarchy,disabled:r,title:a},{children:a}),void 0),n.length>0&&B(Zt,{svg:O_,className:"msp-form-control",flex:"40px",onClick:this.togglePreset,title:"Apply a structure presets to the current hierarchy.",toggleState:this.state.show==="presets",disabled:r},void 0)]}),void 0),this.state.show==="hierarchy"&&B(ir,{items:this.hierarchyItems,onSelect:this.selectHierarchy,multiselect:!0},void 0),this.state.show==="presets"&&B(ir,{items:n,onSelect:this.applyPreset},void 0),this.modelIndex,this.structureType,this.transform,Pe("div",T({style:{marginTop:"6px"}},{children:[B(Cqe,{},void 0),B(fqe,{hideOnEmpty:!0},void 0)]}),void 0)]},void 0)},t}($0);function _qe(e,t){var r=Pqe(e,t||MR());return Rqe(e.tree,r),t&&t.refs.forEach(Dqe,r),{hierarchy:r.hierarchy,added:r.added,changed:r.changed}}function MR(){return{volumes:[],lazyVolumes:[],refs:new Map}}function Aqe(e){return{kind:"volume",cell:e,version:e.transform.version,representations:[]}}function Tqe(e){return{kind:"lazy-volume",cell:e,version:e.transform.version}}function Eqe(e,t){return{kind:"volume-representation",cell:e,version:e.transform.version,volume:t}}function Pqe(e,t){return{state:e,oldHierarchy:t,hierarchy:MR(),changed:!1,added:new Set}}function wT(e,t,r,n){for(var a=[],i=4;i<arguments.length;i++)a[i-4]=arguments[i];var o=n.apply(void 0,a);r.push(o),e.hierarchy.refs.set(t.transform.ref,o);var s=e.oldHierarchy.refs.get(t.transform.ref);return s?s.version!==t.transform.version&&(e.changed=!0):(e.added.add(o.cell.transform.ref),e.changed=!0),o}function Iqe(e,t){return function(r,n){return!t(n)&&e.is(r.obj)}}function lz(){}var Mqe=[[Iqe(be.Volume.Data,function(e){return e.currentVolume}),function(e,t){e.currentVolume=wT(e,t,e.hierarchy.volumes,Aqe,t)},function(e){return e.currentVolume=void 0}],[function(e){return be.Volume.Lazy.is(e.obj)},function(e,t){wT(e,t,e.hierarchy.lazyVolumes,Tqe,t)},lz],[function(e,t){return!e.state.isGhost&&!!t.currentVolume&&be.Volume.Representation3D.is(e.obj)},function(e,t){return e.currentVolume&&wT(e,t,e.currentVolume.representations,Eqe,t,e.currentVolume),!1},lz]];function eZ(e){if(!e||!e?.parent||!e.parent.cells.has(e.transform.ref))return!1;var t=e.obj;return!(!t||t===qn.Null||e.status!=="ok"&&e.status!=="error")}function Dqe(e){var t=e.cell;eZ(t)||(this.changed=!0)}function kqe(e){tZ(this,this.tree.transforms.get(e))}function tZ(e,t){var r=e.state,n=r.state.cells.get(t.ref);if(!!eZ(n)){for(var a=void 0,i=!1,o=0,s=Mqe;o<s.length;o++){var u=s[o],l=u[0],c=u[1],d=u[2];if(l(n,r)){var f=c(r,n);if(f===!1){i=!0;break}a=d;break}}if(!i){var p=e.tree.children.get(t.ref);p&&p.size&&p.forEach(kqe,e),a&&a(r)}}}function Rqe(e,t){var r={tree:e,state:t};return tZ(r,e.root),r.state}function Jv(e,t,r){r===void 0&&(r={});var n=r;return typeof n.type=="string"||typeof n.color=="string"||typeof n.size=="string"?Oqe(e,t||It.One,r):rZ(e,t||It.One,r)}function Oqe(e,t,r){var n=r.type&&e.representation.volume.registry.get(r.type)||e.representation.volume.registry.default.provider,a=r.color&&e.representation.volume.themes.colorThemeRegistry.get(r.color)||e.representation.volume.themes.colorThemeRegistry.get(n.defaultColorTheme.name),i=r.size&&e.representation.volume.themes.sizeThemeRegistry.get(r.size)||e.representation.volume.themes.sizeThemeRegistry.get(n.defaultSizeTheme.name);return rZ(e,t,{type:n,typeParams:r.typeParams,color:a,colorParams:r.colorParams,size:i,sizeParams:r.sizeParams})}function rZ(e,t,r){r===void 0&&(r={});var n=e.representation.volume.themes,a={volume:t},i=r.type||e.representation.volume.registry.default.provider,o=M.getDefaultValues(i.getParams(n,t)),s=Object.assign(o,r.typeParams),u=r.color||n.colorThemeRegistry.get(i.defaultColorTheme.name),l=M.getDefaultValues(u.getParams(a));u.name===i.defaultColorTheme.name&&Object.assign(l,i.defaultColorTheme.props);var c=Object.assign(l,r.colorParams),d=r.size||n.sizeThemeRegistry.get(i.defaultSizeTheme.name),f=M.getDefaultValues(d.getParams(a));d.name===i.defaultSizeTheme.name&&Object.assign(f,i.defaultSizeTheme.props);var p=Object.assign(f,r.sizeParams);return{type:{name:i.name,params:s},colorTheme:{name:u.name,params:c},sizeTheme:{name:d.name,params:p}}}var _3=function(e){Le(t,e);function t(r){var n=e.call(this)||this;return n.plugin=r,n.state={syncedTree:n.dataState.tree,notified:!1,hierarchy:MR(),selection:void 0},n.behaviors={selection:n.ev.behavior({hierarchy:n.current,volume:n.selection})},n.subscribe(r.state.data.events.changed,function(a){a.inTransaction||r.behaviors.state.isAnimating.value||n.sync(!0)}),n.subscribe(r.behaviors.state.isAnimating,function(a){!a&&!r.behaviors.state.isUpdating.value&&n.sync(!0)}),n}return Object.defineProperty(t.prototype,"dataState",{get:function(){return this.plugin.state.data},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"current",{get:function(){return this.sync(!1),this.state.hierarchy},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"selection",{get:function(){return this.sync(!1),this.state.selection},enumerable:!1,configurable:!0}),t.prototype.sync=function(r){if(!(!r&&this.dataState.inUpdate)){if(this.state.syncedTree===this.dataState.tree){r&&!this.state.notified&&(this.state.notified=!0,this.behaviors.selection.next({hierarchy:this.state.hierarchy,volume:this.state.selection}));return}this.state.syncedTree=this.dataState.tree;var n=_qe(this.plugin.state.data,this.current);if(!!n.changed){var a=n.hierarchy;this.state.hierarchy=a,this.state.selection?this.state.selection=a.refs.has(this.state.selection.cell.transform.ref)?a.refs.get(this.state.selection.cell.transform.ref):a.volumes[0]:this.state.selection=a.volumes[0],r?(this.state.notified=!0,this.behaviors.selection.next({hierarchy:a,volume:this.state.selection})):this.state.notified=!1}}},t.prototype.setCurrent=function(r){this.state.selection=r||this.state.hierarchy.volumes[0],this.behaviors.selection.next({hierarchy:this.state.hierarchy,volume:r||this.state.hierarchy.volumes[0]})},t.prototype.remove=function(r,n){if(r.length!==0){for(var a=this.plugin.state.data.build(),i=0,o=r;i<o.length;i++){var s=o[i];a.delete(typeof s=="string"?s:s.cell.transform.ref)}return a.commit({canUndo:n?"Remove":!1})}},t.prototype.toggleVisibility=function(r,n){if(r.length!==0)for(var a=n!==void 0?n!=="show":!r[0].cell.state.isHidden,i=0,o=r;i<o.length;i++){var s=o[i];pm(this.dataState,s.cell.transform.ref,a)}},t.prototype.addRepresentation=function(r,n){var a,i=this.dataState.build().to(r.cell).apply(lt.Representation.VolumeRepresentation3D,Jv(this.plugin,(a=r.cell.obj)===null||a===void 0?void 0:a.data,{type:n}));return i.commit({canUndo:"Add Representation"})},t}(Sb);(function(e){function t(r,n){var a,i;return!((a=n?.cell.obj)===null||a===void 0)&&a.data?r.representation.volume.registry.getApplicableTypes((i=n.cell.obj)===null||i===void 0?void 0:i.data):r.representation.volume.registry.types}e.getRepresentationTypes=t})(_3||(_3={}));var DR=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r._getInfo=Sp(function(n,a){return ym.infoFromAction(r.plugin,r.props.state,r.props.action,r.props.nodeRef)}),r.state={plugin:r.plugin,ref:r.props.nodeRef,version:r.props.state.transforms.get(r.props.nodeRef).version,error:void 0,isInitial:!0,params:r.getInfo().initialValues,busy:!1,isCollapsed:r.props.initiallyCollapsed},r}return t.prototype.applyAction=function(){return Rt.State.ApplyAction(this.plugin,{state:this.props.state,action:this.props.action.create(this.state.params),ref:this.props.nodeRef})},t.prototype.getInfo=function(){return this._getInfo(this.props.nodeRef,this.props.state.transforms.get(this.props.nodeRef).version)},t.prototype.getTransformerId=function(){return this.props.state.transforms.get(this.props.nodeRef).transformer.id},t.prototype.getHeader=function(){return this.props.hideHeader?"none":this.props.action.definition.display},t.prototype.canApply=function(){return!this.state.error&&!this.state.busy},t.prototype.canAutoApply=function(){return!1},t.prototype.applyText=function(){return"Apply"},t.prototype.isUpdate=function(){return!1},t.prototype.getSourceAndTarget=function(){return{a:this.props.state.cells.get(this.props.nodeRef).obj}},t.getDerivedStateFromProps=function(r,n){var a=r.state.transforms.get(r.nodeRef).version;if(r.nodeRef===n.ref&&a===n.version)return null;var i=r.state.cells.get(r.nodeRef).obj,o=r.action.definition.params?M.getDefaultValues(r.action.definition.params(i,n.plugin)):{},s={plugin:n.plugin,ref:r.nodeRef,version:a,params:o,isInitial:!0,error:void 0};return s},t}($Q),Bqe=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.defaultState=function(){return{header:"Volume Streaming",isCollapsed:!1,isBusy:!1,isHidden:!0,brand:{accent:"cyan",svg:DQ}}},t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,function(){r.setState({isHidden:!r.canEnable(),description:W1.getSelectedStructuresDescription(r.plugin)})}),this.subscribe(this.plugin.state.events.cell.stateUpdated,function(n){vr.hasTag(n.cell.transform,Qi.RootTag)&&r.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){r.setState({isBusy:n})})},Object.defineProperty(t.prototype,"pivot",{get:function(){return this.plugin.managers.structure.hierarchy.selection.structures[0]},enumerable:!1,configurable:!0}),t.prototype.canEnable=function(){var r,n,a=this.plugin.managers.structure.hierarchy.selection;if(a.structures.length!==1)return!1;var i=this.pivot.cell;return i.obj?!!(!((n=(r=_I.definition).isApplicable)===null||n===void 0)&&n.call(r,i.obj,i.transform,this.plugin)):!1},t.prototype.renderEnable=function(){var r,n=this.pivot;if(!n.cell.parent)return null;var a=lr.findTagInSubtree(n.cell.parent.tree,this.pivot.cell.transform.ref,Qi.RootTag),i=a&&n.cell.parent.cells.get(a),o=i&&i.status==="error"?{header:"Error enabling",icon:WN,title:i.errorText}:i&&((r=i.obj)===null||r===void 0?void 0:r.data.entries.length)===0?{header:"Error enabling",icon:WN,title:"No entry for streaming found"}:{header:"Enable",icon:K0,title:"Enable"};return B(DR,{state:n.cell.parent,action:_I,initiallyCollapsed:!0,nodeRef:n.cell.transform.ref,simpleApply:o},void 0)},t.prototype.renderParams=function(){var r,n,a,i,o,s=this.pivot;if(!s.cell.parent)return null;var u=((n=(r=s.volumeStreaming)===null||r===void 0?void 0:r.cell.transform.params)===null||n===void 0?void 0:n.entry.params.view.name)==="selection-box"&&((o=(i=(a=this.plugin.state.behaviors.cells.get(__.id))===null||a===void 0?void 0:a.params)===null||i===void 0?void 0:i.values)===null||o===void 0?void 0:o.bindings);return Pe(Nt,{children:[B(Pd,{state:s.cell.parent,transform:s.volumeStreaming.cell.transform,customHeader:"none",noMargin:!0},void 0),u&&B(ul,T({header:"Controls Help"},{children:B(LI,{bindings:u},void 0)}),void 0)]},void 0)},t.prototype.renderControls=function(){var r=this.pivot;return r?r.volumeStreaming?this.renderParams():this.renderEnable():null},t}($0),Fqe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.item=function(n){var a,i=r.plugin.managers.volume.hierarchy.selection,o=((a=n.cell.obj)===null||a===void 0?void 0:a.label)||"Volume",s={kind:"item",label:(n.kind==="lazy-volume"?"Load ":"")+(o||n.kind),selected:i===n,value:n};return s},r.selectCurrent=function(n){if(r.toggleHierarchy(),!!n){var a=n.value;a.kind==="volume"?r.plugin.managers.volume.hierarchy.setCurrent(a):r.lazyLoad(a.cell)}},r.selectAdd=function(n){!n||(r.setState({show:void 0}),n.value())},r.toggleHierarchy=function(){return r.setState({show:r.state.show!=="hierarchy"?"hierarchy":void 0})},r.toggleAddRepr=function(){return r.setState({show:r.state.show!=="add-repr"?"add-repr":void 0})},r}return t.prototype.defaultState=function(){return{header:"Volume",isCollapsed:!1,isBusy:!1,isHidden:!0,brand:{accent:"purple",svg:DQ}}},t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.volume.hierarchy.behaviors.selection,function(n){r.setState({isHidden:n.hierarchy.volumes.length===0&&n.hierarchy.lazyVolumes.length===0})}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){r.setState({isBusy:n})})},Object.defineProperty(t.prototype,"hierarchyItems",{get:function(){for(var r=this.plugin.managers.volume.hierarchy,n=r.current,a=[],i=0,o=n.volumes;i<o.length;i++){var s=o[i];a.push(this.item(s))}for(var u=0,l=n.lazyVolumes;u<l.length;u++){var s=l[u];a.push(this.item(s))}return a},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"addActions",{get:function(){var r=this.plugin.managers.volume.hierarchy,n=r.selection,a=Gt([],_3.getRepresentationTypes(this.plugin,n).map(function(i){return ir.Item(i[1],function(){return r.addRepresentation(n,i[0])})}));return a},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isEmpty",{get:function(){var r=this.plugin.managers.volume.hierarchy.current,n=r.volumes,a=r.lazyVolumes;return n.length===0&&a.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"label",{get:function(){var r;if(this.state.loadingLabel)return"Loading "+this.state.loadingLabel+"...";var n=this.plugin.managers.volume.hierarchy.selection;return n?((r=n?.cell.obj)===null||r===void 0?void 0:r.label)||"Volume":"Nothing Selected"},enumerable:!1,configurable:!0}),t.prototype.lazyLoad=function(r){return pe(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c=this;return he(this,function(d){switch(d.label){case 0:n=r.obj.data,a=n.url,i=n.isBinary,o=n.format,s=n.entryId,u=n.isovalues,this.setState({isBusy:!0,loadingLabel:r.obj.label}),d.label=1;case 1:return d.trys.push([1,,3,4]),l=this.plugin,[4,l.dataTransaction(function(){return pe(c,void 0,void 0,function(){var f,p,h,m,v,g,y,b,S,x,C;return he(this,function(w){switch(w.label){case 0:return[4,l.builders.data.download({url:a,isBinary:i},{state:{isGhost:!0}})];case 1:return f=w.sent(),[4,l.dataFormats.get(o).parse(l,f,{entryId:s})];case 2:if(p=w.sent(),h=p.volume||p.volumes[0],!h?.isOk)throw new Error("Failed to parse any volume.");for(m=l.build(),v=0,g=u;v<g.length;v++)y=g[v],m.to((x=(b=p.volumes)===null||b===void 0?void 0:b[(S=y.volumeIndex)!==null&&S!==void 0?S:0])!==null&&x!==void 0?x:p.volume).apply(lt.Representation.VolumeRepresentation3D,Jv(this.plugin,h.data,{type:"isosurface",typeParams:{alpha:(C=y.alpha)!==null&&C!==void 0?C:1,isoValue:y.type==="absolute"?{kind:"absolute",absoluteValue:y.value}:{kind:"relative",relativeValue:y.value}},color:"uniform",colorParams:{value:y.color}}));return[4,m.commit()];case 3:return w.sent(),[4,l.build().delete(r).commit()];case 4:return w.sent(),[2]}})})})];case 2:return d.sent(),[3,4];case 3:return this.setState({isBusy:!1,loadingLabel:void 0}),[7];case 4:return[2]}})})},t.prototype.renderControls=function(){var r=this.state.isBusy||this.isEmpty,n=this.label,a=this.plugin.managers.volume.hierarchy.selection;return Pe(Nt,{children:[Pe("div",T({className:"msp-flex-row",style:{marginTop:"1px"}},{children:[B(xr,T({noOverflow:!0,flex:!0,onClick:this.toggleHierarchy,disabled:r,title:n},{children:n}),void 0),!this.isEmpty&&a&&B(Zt,{svg:Y0,onClick:this.toggleAddRepr,title:"Apply a structure presets to the current hierarchy.",toggleState:this.state.show==="add-repr",disabled:r},void 0)]}),void 0),this.state.show==="hierarchy"&&B(ir,{items:this.hierarchyItems,onSelect:this.selectCurrent},void 0),this.state.show==="add-repr"&&B(ir,{items:this.addActions,onSelect:this.selectAdd},void 0),a&&a.representations.length>0&&B("div",T({style:{marginTop:"6px"}},{children:a.representations.map(function(i){return B(Lqe,{representation:i},i.cell.transform.ref)})}),void 0)]},void 0)},t}($0),Lqe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={action:void 0},r.remove=function(){return r.plugin.managers.volume.hierarchy.remove([r.props.representation],!0)},r.toggleVisible=function(n){n.preventDefault(),n.currentTarget.blur(),r.plugin.managers.volume.hierarchy.toggleVisibility([r.props.representation])},r.toggleUpdate=function(){return r.setState({action:r.state.action==="update"?void 0:"update"})},r.highlight=function(n){n.preventDefault(),r.props.representation.cell.parent&&Rt.Interactivity.Object.Highlight(r.plugin,{state:r.props.representation.cell.parent,ref:r.props.representation.cell.transform.ref})},r.clearHighlight=function(n){n.preventDefault(),Rt.Interactivity.ClearHighlights(r.plugin)},r.focus=function(){var n,a=r.props.representation,i=(n=r.props.representation.cell.obj)===null||n===void 0?void 0:n.data.repr.renderObjects;a.cell.state.isHidden&&r.plugin.managers.volume.hierarchy.toggleVisibility([r.props.representation],"show"),r.plugin.managers.camera.focusRenderObjects(i,{extraRadius:1})},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.events.cell.stateUpdated,function(n){vp.ObjectEvent.isCell(n,r.props.representation.cell)&&r.forceUpdate()})},t.prototype.render=function(){var r,n,a,i=this.props.representation.cell;return Pe(Nt,{children:[Pe("div",T({className:"msp-flex-row"},{children:[Pe(xr,T({noOverflow:!0,className:"msp-control-button-label",title:((r=i.obj)===null||r===void 0?void 0:r.label)+". Click to focus.",onClick:this.focus,onMouseEnter:this.highlight,onMouseLeave:this.clearHighlight,style:{textAlign:"left"}},{children:[(n=i.obj)===null||n===void 0?void 0:n.label,B("small",T({className:"msp-25-lower-contrast-text",style:{float:"right"}},{children:(a=i.obj)===null||a===void 0?void 0:a.description}),void 0)]}),void 0),B(Zt,{svg:i.state.isHidden?Fm:Lm,toggleState:!1,onClick:this.toggleVisible,title:(i.state.isHidden?"Show":"Hide")+" component",small:!0,className:"msp-form-control",flex:!0},void 0),B(Zt,{svg:Cu,onClick:this.remove,title:"Remove",small:!0},void 0),B(Zt,{svg:mm,onClick:this.toggleUpdate,title:"Actions",toggleState:this.state.action==="update"},void 0)]}),void 0),this.state.action==="update"&&!!i.parent&&B("div",T({style:{marginBottom:"6px"},className:"msp-accent-offset"},{children:B(Pd,{state:i.parent,transform:i.transform,customHeader:"none",noMargin:!0},void 0)}),void 0)]},void 0)},t}(ci),A3;(function(e){function t(n){return{size:n,matrix:kr.create(n,n),eigenValues:new Float64Array(n),D:new Float64Array(n),E:new Float64Array(n)}}e.createCache=t;function r(n){Nqe(n.size,n.matrix.data,n.eigenValues,n.D,n.E)}e.compute=r})(A3||(A3={}));function Nqe(e,t,r,n,a){for(var i=0;i<e;i++)a[i]=0;for(var o=e-1,i=0;i<e;i++)n[i]=t[i*e+o];zqe(t,n,a,e),Uqe(t,n,a,e);for(var i=0;i<e;i++)r[i]=n[i]}function zqe(e,t,r,n){for(var a=n-1;a>0;a--){for(var i=0,o=0,s=0;s<a;s++)i=i+Math.abs(t[s]);if(i===0){r[a]=t[a-1];for(var u=0;u<a;u++)t[u]=e[u*n+a-1],e[u*n+a]=0,e[a*n+u]=0}else{for(var s=0;s<a;s++)t[s]/=i,o+=t[s]*t[s];var l=t[a-1],c=Math.sqrt(o);l>0&&(c=-c),r[a]=i*c,o=o-l*c,t[a-1]=l-c;for(var u=0;u<a;u++)r[u]=0;for(var u=0;u<a;u++){l=t[u],e[a*n+u]=l,c=r[u]+e[u*n+u]*l;for(var s=u+1;s<=a-1;s++)c+=e[u*n+s]*t[s],r[s]+=e[u*n+s]*l;r[u]=c}l=0;for(var u=0;u<a;u++)r[u]/=o,l+=r[u]*t[u];for(var d=l/(o+o),u=0;u<a;u++)r[u]-=d*t[u];for(var u=0;u<a;u++){l=t[u],c=r[u];for(var s=u;s<=a-1;s++)e[u*n+s]-=l*r[s]+c*t[s];t[u]=e[u*n+a-1],e[u*n+a]=0}}t[a]=o}for(var a=0;a<n-1;a++){e[a*n+n-1]=e[a*n+a],e[a*n+a]=1;var o=t[a+1];if(o!==0){for(var s=0;s<=a;s++)t[s]=e[(a+1)*n+s]/o;for(var u=0;u<=a;u++){for(var c=0,s=0;s<=a;s++)c+=e[(a+1)*n+s]*e[u*n+s];for(var s=0;s<=a;s++)e[u*n+s]-=c*t[s]}}for(var s=0;s<=a;s++)e[(a+1)*n+s]=0}for(var u=0;u<n;u++)t[u]=e[u*n+n-1],e[u*n+n-1]=0;e[n*n-1]=1,r[0]=0}function Uqe(e,t,r,n){for(var a=1e3,i=1;i<n;i++)r[i-1]=r[i];r[n-1]=0;for(var o=0,s=0,u=Math.pow(2,-53),l=0;l<n;l++){s=Math.max(s,Math.abs(t[l])+Math.abs(r[l]));for(var c=l;c<n&&!(Math.abs(r[c])<=u*s);)c++;if(c>l){var d=0;do{d=d+1;var f=t[l],p=(t[l+1]-f)/(2*r[l]),h=cz(p,1);p<0&&(h=-h),t[l]=r[l]/(p+h),t[l+1]=r[l]*(p+h);for(var m=t[l+1],v=f-t[l],i=l+2;i<n;i++)t[i]-=v;o=o+v,p=t[c];for(var g=1,y=g,b=g,S=r[l+1],x=0,C=0,i=c-1;i>=l;i--){b=y,y=g,C=x,f=g*r[i],v=g*p,h=cz(p,r[i]),r[i+1]=x*h,x=r[i]/h,g=p/h,p=g*t[i]-x*f,t[i+1]=v+x*(g*f+x*t[i]);for(var w=0;w<n;w++)v=e[(i+1)*n+w],e[(i+1)*n+w]=x*e[i*n+w]+g*v,e[i*n+w]=g*e[i*n+w]-x*v}if(p=-x*C*b*S*r[l]/m,r[l]=x*p,t[l]=g*p,d>=a)throw"SVD: Not converging."}while(Math.abs(r[l])>u*s)}t[l]=t[l]+o,r[l]=0}for(var i=0;i<n-1;i++){for(var w=i,p=t[i],_=i+1;_<n;_++)t[_]<p&&(w=_,p=t[_]);if(w!==i){t[w]=t[i],t[i]=p;for(var _=0;_<n;_++)p=e[i*n+_],e[i*n+_]=e[w*n+_],e[w*n+_]=p}}}function cz(e,t){if(Math.abs(e)>Math.abs(t)){var r=t/e;return Math.abs(e)*Math.sqrt(1+r*r)}if(t!==0){var r=e/t;return Math.abs(t)*Math.sqrt(1+r*r)}return 0}var Id;(function(e){(function(r){function n(a){return{x:new Float64Array(a),y:new Float64Array(a),z:new Float64Array(a)}}r.empty=n})(e.Positions||(e.Positions={}));function t(r,n){return typeof n>"u"&&(n={bTransform:de.zero(),rmsd:0}),Gqe(new Vqe(r,n)),n}e.compute=t})(Id||(Id={}));var Vqe=function(){function e(t,r){this.evdCache=A3.createCache(4),this.translateB=de.identity(),this.rotateB=de.identity(),this.tempMatrix=de.identity(),this.a=t.a,this.b=t.b,t.centerA?this.centerA=t.centerA:this.centerA=t.centerA=gd.fromArrays(t.a,He()).center,t.centerB?this.centerB=t.centerB:this.centerB=t.centerB=gd.fromArrays(t.b,He()).center,this.result=r}return e}();function Hqe(e){var t=e.evdCache.matrix;kr.makeZero(t);for(var r=e.a.x,n=e.a.y,a=e.a.z,i=e.b.x,o=e.b.y,s=e.b.z,u=e.centerA,l=e.centerB,c=0,d=0,f=e.a.x.length;d<f;d++){var p=r[d]-u[0],h=n[d]-u[1],m=a[d]-u[2],v=i[d]-l[0],g=o[d]-l[1],y=s[d]-l[2];c+=p*p+h*h+m*m+v*v+g*g+y*y,kr.add(t,0,0,p*v+h*g+m*y),kr.add(t,0,1,-(m*g)+h*y),kr.add(t,0,2,m*v-p*y),kr.add(t,0,3,-(h*v)+p*g),kr.add(t,1,0,-(m*g)+h*y),kr.add(t,1,1,p*v-h*g-m*y),kr.add(t,1,2,h*v+p*g),kr.add(t,1,3,m*v+p*y),kr.add(t,2,0,m*v-p*y),kr.add(t,2,1,h*v+p*g),kr.add(t,2,2,-(p*v)+h*g-m*y),kr.add(t,2,3,m*g+h*y),kr.add(t,3,0,-(h*v)+p*g),kr.add(t,3,1,m*v+p*y),kr.add(t,3,2,m*g+h*y),kr.add(t,3,3,-(p*v)-h*g+m*y)}return c}function jqe(e){var t=e.evdCache.matrix,r=kr.get(t,1,3),n=kr.get(t,2,3),a=kr.get(t,3,3),i=kr.get(t,0,3),o=2*n*n,s=2*a*a,u=2*r*r,l=2*r*n,c=2*i*a,d=2*r*a,f=2*i*n,p=2*n*a,h=2*i*r,m=e.translateB;de.setValue(m,0,3,-e.centerB[0]),de.setValue(m,1,3,-e.centerB[1]),de.setValue(m,2,3,-e.centerB[2]),m=e.rotateB,de.setValue(m,0,0,1-o-s),de.setValue(m,0,1,l+c),de.setValue(m,0,2,d-f),de.setValue(m,1,0,l-c),de.setValue(m,1,1,1-u-s),de.setValue(m,1,2,p+h),de.setValue(m,2,0,d+f),de.setValue(m,2,1,p-h),de.setValue(m,2,2,1-u-o),de.setValue(m,3,3,1),de.mul(e.tempMatrix,e.rotateB,e.translateB),m=e.translateB,de.setValue(m,0,3,e.centerA[0]),de.setValue(m,1,3,e.centerA[1]),de.setValue(m,2,3,e.centerA[2]),de.mul(e.result.bTransform,e.translateB,e.tempMatrix)}function Gqe(e){var t=Hqe(e);A3.compute(e.evdCache);var r=t-2*e.evdCache.eigenValues[3];r=r<0?0:Math.sqrt(r/e.a.x.length),jqe(e),e.result.rmsd=r}var qqe="ACDEFGHIKLMNPQRSTVWY",Wqe="ARNDCQEGHILKMFPSTWYVBZX",Xqe=[[4,0,-2,-1,-2,0,-2,-1,-1,-1,-1,-2,-1,-1,-1,1,0,0,-3,-2],[0,9,-3,-4,-2,-3,-3,-1,-3,-1,-1,-3,-3,-3,-3,-1,-1,-1,-2,-2],[-2,-3,6,2,-3,-1,-1,-3,-1,-4,-3,1,-1,0,-2,0,-1,-3,-4,-3],[-1,-4,2,5,-3,-2,0,-3,1,-3,-2,0,-1,2,0,0,-1,-2,-3,-2],[-2,-2,-3,-3,6,-3,-1,0,-3,0,0,-3,-4,-3,-3,-2,-2,-1,1,3],[0,-3,-1,-2,-3,6,-2,-4,-2,-4,-3,0,-2,-2,-2,0,-2,-3,-2,-3],[-2,-3,-1,0,-1,-2,8,-3,-1,-3,-2,1,-2,0,0,-1,-2,-3,-2,2],[-1,-1,-3,-3,0,-4,-3,4,-3,2,1,-3,-3,-3,-3,-2,-1,3,-3,-1],[-1,-3,-1,1,-3,-2,-1,-3,5,-2,-1,0,-1,1,2,0,-1,-2,-3,-2],[-1,-1,-4,-3,0,-4,-3,2,-2,4,2,-3,-3,-2,-2,-2,-1,1,-2,-1],[-1,-1,-3,-2,0,-3,-2,1,-1,2,5,-2,-2,0,-1,-1,-1,1,-1,-1],[-2,-3,1,0,-3,0,1,-3,0,-3,-2,6,-2,0,0,1,0,-3,-4,-2],[-1,-3,-1,-1,-4,-2,-2,-3,-1,-3,-2,-2,7,-1,-2,-1,-1,-2,-4,-3],[-1,-3,0,2,-3,-2,0,-3,1,-2,0,0,-1,5,1,0,-1,-2,-2,-1],[-1,-3,-2,0,-3,-2,0,-3,2,-2,-1,0,-2,1,5,-1,-1,-3,-3,-2],[1,-1,0,0,-2,0,-1,-2,0,-2,-1,1,-1,0,-1,4,1,-2,-3,-2],[0,-1,-1,-1,-2,-2,-2,-1,-1,-1,-1,0,-1,-1,-1,1,5,0,-2,-2],[0,-1,-3,-2,-1,-3,-3,3,-2,1,1,-3,-2,-2,-3,-2,0,4,-3,-1],[-3,-2,-4,-3,1,-2,-2,-3,-3,-2,-1,-4,-4,-2,-3,-3,-2,-3,11,2],[-2,-2,-3,-2,3,-3,2,-1,-2,-1,-1,-2,-3,-1,-2,-2,-2,-1,2,7]],Yqe=[[4,-1,-2,-2,0,-1,-1,0,-2,-1,-1,-1,-1,-2,-1,1,0,-3,-2,0,-2,-1,0],[-1,5,0,-2,-3,1,0,-2,0,-3,-2,2,-1,-3,-2,-1,-1,-3,-2,-3,-1,0,-1],[-2,0,6,1,-3,0,0,0,1,-3,-3,0,-2,-3,-2,1,0,-4,-2,-3,3,0,-1],[-2,-2,1,6,-3,0,2,-1,-1,-3,-4,-1,-3,-3,-1,0,-1,-4,-3,-3,4,1,-1],[0,-3,-3,-3,9,-3,-4,-3,-3,-1,-1,-3,-1,-2,-3,-1,-1,-2,-2,-1,-3,-3,-2],[-1,1,0,0,-3,5,2,-2,0,-3,-2,1,0,-3,-1,0,-1,-2,-1,-2,0,3,-1],[-1,0,0,2,-4,2,5,-2,0,-3,-3,1,-2,-3,-1,0,-1,-3,-2,-2,1,4,-1],[0,-2,0,-1,-3,-2,-2,6,-2,-4,-4,-2,-3,-3,-2,0,-2,-2,-3,-3,-1,-2,-1],[-2,0,1,-1,-3,0,0,-2,8,-3,-3,-1,-2,-1,-2,-1,-2,-2,2,-3,0,0,-1],[-1,-3,-3,-3,-1,-3,-3,-4,-3,4,2,-3,1,0,-3,-2,-1,-3,-1,3,-3,-3,-1],[-1,-2,-3,-4,-1,-2,-3,-4,-3,2,4,-2,2,0,-3,-2,-1,-2,-1,1,-4,-3,-1],[-1,2,0,-1,-3,1,1,-2,-1,-3,-2,5,-1,-3,-1,0,-1,-3,-2,-2,0,1,-1],[-1,-1,-2,-3,-1,0,-2,-3,-2,1,2,-1,5,0,-2,-1,-1,-1,-1,1,-3,-1,-1],[-2,-3,-3,-3,-2,-3,-3,-3,-1,0,0,-3,0,6,-4,-2,-2,1,3,-1,-3,-3,-1],[-1,-2,-2,-1,-3,-1,-1,-2,-2,-3,-3,-1,-2,-4,7,-1,-1,-4,-3,-2,-2,-1,-2],[1,-1,1,0,-1,0,0,0,-1,-2,-2,0,-1,-2,-1,4,1,-3,-2,-2,0,0,0],[0,-1,0,-1,-1,-1,-1,-2,-2,-1,-1,-1,-1,-2,-1,1,5,-2,-2,0,-1,-1,0],[-3,-3,-4,-4,-2,-2,-3,-2,-2,-3,-2,-3,-1,1,-4,-3,-2,11,2,-3,-4,-3,-2],[-2,-2,-2,-3,-2,-1,-2,-3,2,-1,-1,-2,-1,3,-3,-2,-2,2,7,-1,-3,-2,-1],[0,-3,-3,-3,-1,-2,-2,-3,-3,3,1,-2,1,-1,-2,-2,0,-3,-1,4,-3,-2,-1],[-2,-1,3,4,-3,0,1,-1,0,-3,-4,0,-3,-3,-2,0,-1,-4,-3,-3,4,1,-1],[-1,0,0,1,-3,3,4,-2,0,-3,-3,1,-1,-3,-1,0,-1,-3,-2,-2,1,4,-1],[0,-1,-1,-1,-2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-2,0,0,-2,-1,-1,-1,-1,-1]];function dz(e,t){var r,n=0,a={};return t.forEach(function(i){r=0;var o={};i.forEach(function(s){return o[e[r++]]=s}),a[e[n++]]=o}),a}var Kqe=function(){return{blosum62:dz(Wqe,Yqe),blosum62x:dz(qqe,Xqe)}}(),$qe={gapPenalty:-11,gapExtensionPenalty:-1,substMatrix:"default"};function Qqe(e,t,r){r===void 0&&(r={});var n=T(T({},$qe),r),a=new Zqe(e,t,n);return a.calculate(),a.trace()}var Zqe=function(){function e(t,r,n){this.seqA=t,this.seqB=r,this.S=[],this.V=[],this.H=[],this.gapPenalty=n.gapPenalty,this.gapExtensionPenalty=n.gapExtensionPenalty,this.substMatrix=n.substMatrix==="default"?void 0:Kqe[n.substMatrix],this.n=this.seqA.length,this.m=this.seqB.length}return e.prototype.initMatrices=function(){for(var t=this,r=t.n,n=t.m,a=t.gapPenalty,i=t.S,o=t.V,s=t.H,u=0;u<=r;++u){i[u]=[],o[u]=[],s[u]=[];for(var l=0;l<=n;++l)i[u][l]=0,o[u][l]=0,s[u][l]=0}for(var u=0;u<=r;++u)i[u][0]=a,s[u][0]=-1/0;for(var l=0;l<=n;++l)i[0][l]=a,o[0][l]=-1/0;i[0][0]=0},e.prototype.makeScoreFn=function(){var t=this,r=t.seqA,n=t.seqB,a=t.substMatrix;return a?function(o,s){var u,l,c=r[o],d=n[s];return(l=(u=a[c])===null||u===void 0?void 0:u[d])!==null&&l!==void 0?l:-4}:function(o,s){var u=r[o],l=n[s];return u===l?5:-3}},e.prototype.calculate=function(){this.initMatrices();for(var t=this.makeScoreFn(),r=this,n=r.V,a=r.H,i=r.S,o=r.n,s=r.m,u=r.gapExtensionPenalty,l=r.gapPenalty,c,d,f,p,h,m=1;m<=o;++m){d=i[m-1],c=n[m-1],f=n[m],p=a[m],h=i[m];for(var v=1;v<=s;++v)f[v]=Math.max(d[v]+l,c[v]+u),p[v]=Math.max(h[v-1]+l,p[v-1]+u),h[v]=Math.max(d[v-1]+t(m-1,v-1),f[v],p[v])}},e.prototype.trace=function(){var t=this.makeScoreFn(),r=this,n=r.V,a=r.H,i=r.S,o=r.seqA,s=r.seqB,u=r.gapExtensionPenalty,l=r.gapPenalty,c=this.n,d=this.m,f,p,h="",m="";for(i[c][d]>=n[c][d]?(f="S",p=i[c][d]):n[c][d]>=a[c][d]?(f="V",p=n[c][d]):(f="H",p=a[c][d]);c>0&&d>0;)f==="S"?i[c][d]===i[c-1][d-1]+t(c-1,d-1)?(h=o[c-1]+h,m=s[d-1]+m,--c,--d,f="S"):i[c][d]===n[c][d]?f="V":i[c][d]===a[c][d]?f="H":(--c,--d):f==="V"?n[c][d]===n[c-1][d]+u?(h=o[c-1]+h,m="-"+m,--c,f="V"):n[c][d]===i[c-1][d]+l?(h=o[c-1]+h,m="-"+m,--c,f="S"):--c:f==="H"&&(a[c][d]===a[c][d-1]+u?(h="-"+h,m=s[d-1]+m,--d,f="H"):a[c][d]===i[c][d-1]+l?(h="-"+h,m=s[d-1]+m,--d,f="S"):--d);for(;c>0;)h=o[c-1]+h,m="-"+m,--c;for(;d>0;)h="-"+h,m=s[d-1]+m,--d;return{aliA:h,aliB:m,score:p}},e}(),NI;(function(e){function t(n){var a=new Map;if(We.isAtomic(n.unit))for(var i=n.unit.model.atomicHierarchy.residues.label_seq_id,o=n.unit.residueIndex,s=0,u=Ne.size(n.indices);s<u;++s){var l=Ne.getAt(n.indices,s),c=n.unit.elements[l],d=i.value(o[c]);a.has(d)?a.get(d).push(l):a.set(d,[l])}else if(We.isCoarse(n.unit))for(var f=(We.isSpheres(n.unit)?n.unit.model.coarseHierarchy.spheres:n.unit.model.coarseHierarchy.gaussians).seq_id_begin,s=0,u=Ne.size(n.indices);s<u;++s){var l=Ne.getAt(n.indices,s),c=n.unit.elements[l],d=f.value(c);a.set(d,[l])}return a}function r(n,a){a===void 0&&(a={});for(var i=fz(n.a.unit),o=fz(n.b.unit),s=t(n.a),u=t(n.b),l=[],c=[],d=Qqe(i.code.toArray(),o.code.toArray(),a),f=d.aliA,p=d.aliB,h=d.score,m=0,v=0,g=0,y=f.length;g<y;++g){if(f[g]==="-"||p[g]==="-"){f[g]!=="-"&&(m+=1),p[g]!=="-"&&(v+=1);continue}var b=i.seqId.value(m),S=o.seqId.value(v);if(s.has(b)&&u.has(S))for(var x=s.get(b),C=u.get(S),w=0,_=Math.min(x.length,C.length);w<_;++w)l.push(x[w]),c.push(C[w]);m+=1,v+=1}var E=Ne.intersect(Ne.ofSortedArray(l),n.a.indices),P=Ne.intersect(Ne.ofSortedArray(c),n.b.indices);return{a:{unit:n.a.unit,indices:E},b:{unit:n.b.unit,indices:P},score:h}}e.compute=r})(NI||(NI={}));function Jqe(e){switch(e.kind){case 0:return e.model.atomicHierarchy.index.getEntityFromChain(e.chainIndex[e.elements[0]]);case 1:return e.model.coarseHierarchy.spheres.entityKey[e.elements[0]];case 2:return e.model.coarseHierarchy.gaussians.entityKey[e.elements[0]]}}function fz(e){return e.model.sequence.byEntityKey[Jqe(e)].sequence}function pz(e){var t=[];if(e.length<=0)return t;var r=rWe(e),n={a:qy(e[0],r),b:qy(e[1],r)};t[0]=Id.compute(n);for(var a=2;a<e.length;a++)n.b=qy(e[a],r),n.centerB=void 0,t.push(Id.compute(n));return t}var eWe=/(polypeptide|cyclic-pseudo-peptide)/i;function tWe(e){var t=[];if(e.length<=0)return t;for(var r=Oe.getFirstLocation(e[0]),n=mt.entity.subtype(r),a=n.match(eWe)?"blosum62":"default",i=1;i<e.length;i++){var o=NI.compute({a:e[0].elements[0],b:e[i].elements[0]},{substMatrix:a}),s=o.a,u=o.b,l=o.score,c=Oe(e[0].structure,[s]),d=Oe(e[i].structure,[u]),f=Ne.size(s.indices);t.push(T(T({},Id.compute({a:qy(c,f),b:qy(d,f)})),{alignmentScore:l}))}return t}function qy(e,t){for(var r=Id.Positions.empty(t),n=0,a=0,i=e.elements;a<i.length;a++){for(var o=i[a],s=o.unit,u=o.indices,l=s.elements,c=s.conformation,d=c.x,f=c.y,p=c.z,h=0,m=Ne.size(u);h<m;h++){var v=l[Ne.getAt(u,h)];if(r.x[n]=d(v),r.y[n]=f(v),r.z[n]=p(v),n++,n>=t)break}if(n>=t)break}return r}function rWe(e){if(e.length===0)return 0;for(var t=Oe.size(e[0]),r=1;r<e.length;r++){var n=Oe.size(e[r]);n<t&&(t=n)}return t}function nWe(e){for(var t=new Map,r=0;r<e.length;r++)oWe(e[r],t,r);for(var n=Array.from(t.values()),a=iWe(e.length,n),i=[],o=0,s=a;o<s.length;o++){var u=s[o],l=aWe(n,u.i,u.j,u.count),c=l[0],d=l[1],f=Id.compute({a:c,b:d});i.push({transform:f,pivot:u.i,other:u.j})}return i}function aWe(e,t,r,n){for(var a=Id.Positions.empty(n),i=Id.Positions.empty(n),o=0,s=0,u=e;s<u.length;s++){var l=u[s].pivots,c=l[t],d=l[r];if(!(!c||!d))for(var f=Math.min(c[2]-c[1],d[2]-d[1]),p=0;p<f;p++){var h=c[1]+p;a.x[o]=c[0].conformation.x(h),a.y[o]=c[0].conformation.y(h),a.z[o]=c[0].conformation.z(h),h=d[1]+p,i.x[o]=d[0].conformation.x(h),i.y[o]=d[0].conformation.y(h),i.z[o]=d[0].conformation.z(h),o++}}return[a,i]}function iWe(e,t){for(var r=[],n=0;n<e;n++){r[n]=[];for(var a=0;a<e;a++)r[n][a]=0}for(var i=0,o=t;i<o.length;i++)for(var s=o[i].pivots,n=0;n<e;n++)if(!!s[n]){for(var u=s[n][2]-s[n][1],a=n+1;a<e;a++)if(!!s[a]){var l=s[a][2]-s[a][1];r[n][a]=r[n][a]+Math.min(u,l)}}for(var c=[],a=1;a<e;a++)c[a-1]={i:0,j:a,count:r[0][a]};return c}function oWe(e,t,r){for(var n,a=0,i=e.units;a<i.length;a++){var o=i[a];if(o.kind===0){var s=o.elements,u=o.model,l=u.atomicHierarchy.residueAtomSegments.offsets,c=Zu.Provider.get(u).value;if(!c)return;for(var d=c.dbName,f=c.accession,p=c.num,h=pr.transientSegments(o.model.atomicHierarchy.chainAtomSegments,s),m=pr.transientSegments(o.model.atomicHierarchy.residueAtomSegments,s);h.hasNext;){var v=h.move();for(m.setSegment(v);m.hasNext;){var g=m.move(),y=s[g.start],b=l[y];if(!!d[b]){var S=d[b]+"-"+f[b]+"-"+p[b];if(!t.has(S))t.set(S,{key:S,pivots:(n={},n[r]=[o,y,s[g.end]],n)});else{var x=t.get(S);x.pivots[r]||(x.pivots[r]=[o,y,s[g.end]])}}}}}}}var sWe=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.defaultState=function(){return{isCollapsed:!1,header:"Superposition",brand:{accent:"gray",svg:Oje},isHidden:!0}},t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,function(n){r.setState({isHidden:n.structures.length<2})})},t.prototype.renderControls=function(){return B(Nt,{children:B(lWe,{},void 0)},void 0)},t}($0),nZ={alignSequences:M.Boolean(!0,{isEssential:!0,description:"Perform a sequence alignment and use the aligned residue pairs to guide the 3D superposition."})},uWe=M.getDefaultValues(nZ),hz="SuperpositionTransform",lWe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isBusy:!1,canUseDb:!1,action:void 0,options:uWe},r.superposeChains=function(){return pe(r,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d,f,p,h,m,v=this;return he(this,function(g){switch(g.label){case 0:n=Ea.trace.query,a=this.chainEntries,i=a.map(function(y,b){var S=Oe.toStructure(y.loci),x=St.toLociWithSourceUnits(n(new As(S)));return Oe.remap(x,b===0?v.plugin.helpers.substructureParent.get(y.loci.structure.root).obj.data:x.structure.root)}),o=this.state.options.alignSequences?tWe(i):pz(i),s=a[0],u=1,l=i.length,g.label=1;case 1:return u<l?(c=a[u],d=o[u-1],f=d.bTransform,p=d.rmsd,[4,this.transform(c.cell,f)]):[3,4];case 2:g.sent(),h=jf(s.label),m=jf(c.label),this.plugin.log.info("Superposed ["+h+"] and ["+m+"] with RMSD "+p.toFixed(2)+"."),g.label=3;case 3:return++u,[3,1];case 4:return[2]}})})},r.superposeAtoms=function(){return pe(r,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d,f,p,h,m,v=this;return he(this,function(g){switch(g.label){case 0:n=this.atomEntries,a=n.map(function(y,b){return Oe.remap(y.loci,b===0?v.plugin.helpers.substructureParent.get(y.loci.structure.root).obj.data:y.loci.structure.root)}),i=pz(a),o=n[0],s=1,u=a.length,g.label=1;case 1:return s<u?(l=n[s],c=i[s-1],d=c.bTransform,f=c.rmsd,[4,this.transform(l.cell,d)]):[3,4];case 2:g.sent(),p=jf(o.label),h=jf(l.label),m=n[s].atoms.length,this.plugin.log.info("Superposed "+m+" "+(m===1?"atom":"atoms")+" of ["+p+"] and ["+h+"] with RMSD "+f.toFixed(2)+"."),g.label=3;case 3:return++s,[3,1];case 4:return[2]}})})},r.superposeDb=function(){return pe(r,void 0,void 0,function(){var n,a,i,o,s,u;return he(this,function(l){switch(l.label){case 0:n=this.plugin.managers.structure.hierarchy.behaviors.selection.value.structures,a=nWe(n.map(function(c){var d;return(d=c.cell.obj)===null||d===void 0?void 0:d.data})),i=0,o=0,s=a,l.label=1;case 1:return o<s.length?(u=s[o],[4,this.transform(n[u.other].cell,u.transform.bTransform)]):[3,4];case 2:l.sent(),i+=u.transform.rmsd,l.label=3;case 3:return o++,[3,1];case 4:return i/=a.length-1,this.plugin.log.info("Superposed "+n.length+" structures with avg. RMSD "+i.toFixed(2)+"."),[4,new Promise(function(c){return requestAnimationFrame(c)})];case 5:return l.sent(),Rt.Camera.Reset(this.plugin),[2]}})})},r.toggleByChains=function(){return r.setState({action:r.state.action==="byChains"?void 0:"byChains"})},r.toggleByAtoms=function(){return r.setState({action:r.state.action==="byAtoms"?void 0:"byAtoms"})},r.toggleOptions=function(){return r.setState({action:r.state.action==="options"?void 0:"options"})},r.setOptions=function(n){r.setState({options:n})},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.selection.events.changed,function(){r.forceUpdate()}),this.subscribe(this.selection.events.additionsHistoryUpdated,function(){r.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){r.setState({isBusy:n})}),this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,function(n){r.setState({canUseDb:n.structures.every(function(a){var i;return!!(!((i=a.cell.obj)===null||i===void 0)&&i.data)&&a.cell.obj.data.models.some(function(o){return Zu.Provider.isApplicable(o)})})})})},Object.defineProperty(t.prototype,"selection",{get:function(){return this.plugin.managers.structure.selection},enumerable:!1,configurable:!0}),t.prototype.transform=function(r,n){return pe(this,void 0,void 0,function(){var a,i,o,s;return he(this,function(u){switch(u.label){case 0:return a=Ka.resolveAndCheck(this.plugin.state.data,r),a?(i=lr.findTagInSubtree(this.plugin.state.data.tree,a.transform.ref,hz),o={transform:{name:"matrix",params:{data:n,transpose:!1}}},s=i?this.plugin.state.data.build().to(i).update(o):this.plugin.state.data.build().to(r).insert(lt.Model.TransformStructureConformation,o,{tags:hz}),[4,this.plugin.runTask(this.plugin.state.data.updateTree(s))]):[2];case 1:return u.sent(),[2]}})})},t.prototype.highlight=function(r){this.plugin.managers.interactivity.lociHighlights.highlightOnly({loci:r},!1)},t.prototype.moveHistory=function(r,n){this.plugin.managers.structure.selection.modifyHistory(r,n,void 0,!0)},t.prototype.focusLoci=function(r){this.plugin.managers.camera.focusLoci(r)},t.prototype.lociEntry=function(r,n){var a=this;return B("div",T({className:"msp-flex-row"},{children:B(xr,T({noOverflow:!0,title:"Click to focus. Hover to highlight.",onClick:function(){return a.focusLoci(r.loci)},style:{width:"auto",textAlign:"left"},onMouseEnter:function(){return a.highlight(r.loci)},onMouseLeave:this.plugin.managers.interactivity.lociHighlights.clearHighlights},{children:B("span",{dangerouslySetInnerHTML:{__html:r.label}},void 0)}),void 0)}),n)},t.prototype.historyEntry=function(r,n){var a=this,i=this.plugin.managers.structure.selection.additionsHistory;return Pe("div",T({className:"msp-flex-row"},{children:[Pe(xr,T({noOverflow:!0,title:"Click to focus. Hover to highlight.",onClick:function(){return a.focusLoci(r.loci)},style:{width:"auto",textAlign:"left"},onMouseEnter:function(){return a.highlight(r.loci)},onMouseLeave:this.plugin.managers.interactivity.lociHighlights.clearHighlights},{children:[n,". ",B("span",{dangerouslySetInnerHTML:{__html:r.label}},void 0)]}),void 0),i.length>1&&B(Zt,{svg:R_,small:!0,className:"msp-form-control",onClick:function(){return a.moveHistory(r,"up")},flex:"20px",title:"Move up"},void 0),i.length>1&&B(Zt,{svg:k_,small:!0,className:"msp-form-control",onClick:function(){return a.moveHistory(r,"down")},flex:"20px",title:"Move down"},void 0),B(Zt,{svg:Cu,small:!0,className:"msp-form-control",onClick:function(){return a.plugin.managers.structure.selection.modifyHistory(r,"remove")},flex:!0,title:"Remove"},void 0)]}),r.id)},t.prototype.atomsLociEntry=function(r,n){var a=this;return Pe("div",{children:[B("div",T({className:"msp-control-group-header"},{children:B("div",T({className:"msp-no-overflow",title:r.label},{children:r.label}),void 0)}),void 0),B("div",T({className:"msp-control-offset"},{children:r.atoms.map(function(i,o){return a.historyEntry(i,o)})}),void 0)]},n)},Object.defineProperty(t.prototype,"chainEntries",{get:function(){var r=this,n=ot.create(),a=[];return this.plugin.managers.structure.selection.entries.forEach(function(i,o){var s=i.selection,u=Ka.resolveAndCheck(r.plugin.state.data,o);if(!(!u||Oe.isEmpty(s))){var l=Oe.getFirstLocation(s,n);if(!(s.elements.length>1||mt.entity.type(l)!=="polymer")){var c=Kf.ofLoci(s),d=JC(c,{countsOnly:!0}),f=Ou(l,{reverse:!0,granularity:"chain"}).split("|"),p=d+" | "+f[0]+" | "+f[f.length-1];a.push({loci:s,label:p,cell:u})}}}),a},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"atomEntries",{get:function(){for(var r=this,n=new Map,a=this.plugin.managers.structure.selection.additionsHistory,i=0,o=a.length;i<o;++i){var s=a[i];if(Oe.size(s.loci)===1){var u=s.loci.structure;n.has(u)?n.get(u).push(s):n.set(u,[s])}}var l=[];return n.forEach(function(c,d){for(var f=r.plugin.helpers.substructureParent.get(d),p=[],h=0,m=c.length;h<m;++h)p.push(c[h].loci.elements[0]);var v=Oe(c[0].loci.structure,p),g=v.structure.label.split(" | ")[0];l.push({loci:v,label:g,cell:f,atoms:c})}),l},enumerable:!1,configurable:!0}),t.prototype.addByChains=function(){var r=this,n=this.chainEntries;return Pe(Nt,{children:[n.length>0&&B("div",T({className:"msp-control-offset"},{children:n.map(function(a,i){return r.lociEntry(a,i)})}),void 0),n.length<2&&B("div",T({className:"msp-control-offset msp-help-text"},{children:Pe("div",T({className:"msp-help-description"},{children:[B(dn,{svg:cc,inline:!0},void 0),"Add 2 or more selections (toggle ",B(w3,{inline:!0},void 0)," mode) from separate structures. Selections must be limited to single polymer chains or residues therein."]}),void 0)}),void 0),n.length>1&&B(xr,T({title:"Superpose structures by selected chains.",className:"msp-btn-commit msp-btn-commit-on",onClick:this.superposeChains,style:{marginTop:"1px"}},{children:"Superpose"}),void 0)]},void 0)},t.prototype.addByAtoms=function(){var r=this,n=this.atomEntries;return Pe(Nt,{children:[n.length>0&&B("div",T({className:"msp-control-offset"},{children:n.map(function(a,i){return r.atomsLociEntry(a,i)})}),void 0),n.length<2&&B("div",T({className:"msp-control-offset msp-help-text"},{children:Pe("div",T({className:"msp-help-description"},{children:[B(dn,{svg:cc,inline:!0},void 0),"Add 1 or more selections (toggle ",B(w3,{inline:!0},void 0)," mode) from separate structures. Selections must be limited to single atoms."]}),void 0)}),void 0),n.length>1&&B(xr,T({title:"Superpose structures by selected atoms.",className:"msp-btn-commit msp-btn-commit-on",onClick:this.superposeAtoms,style:{marginTop:"1px"}},{children:"Superpose"}),void 0)]},void 0)},t.prototype.superposeByDbMapping=function(){return B(Nt,{children:B(xr,T({icon:XN,title:"Superpose structures using database mapping.",className:"msp-btn msp-btn-block",onClick:this.superposeDb,style:{marginTop:"1px"},disabled:this.state.isBusy},{children:"DB"}),void 0)},void 0)},t.prototype.render=function(){return Pe(Nt,{children:[Pe("div",T({className:"msp-flex-row"},{children:[B(Wa,{icon:XN,label:"Chains",toggle:this.toggleByChains,isSelected:this.state.action==="byChains",disabled:this.state.isBusy},void 0),B(Wa,{icon:Rje,label:"Atoms",toggle:this.toggleByAtoms,isSelected:this.state.action==="byAtoms",disabled:this.state.isBusy},void 0),this.state.canUseDb&&this.superposeByDbMapping(),B(Wa,{icon:vm,label:"",title:"Options",toggle:this.toggleOptions,isSelected:this.state.action==="options",disabled:this.state.isBusy,style:{flex:"0 0 40px",padding:0}},void 0)]}),void 0),this.state.action==="byChains"&&this.addByChains(),this.state.action==="byAtoms"&&this.addByAtoms(),this.state.action==="options"&&B("div",T({className:"msp-control-offset"},{children:B(Jn,{params:nZ,values:this.state.options,onChangeValues:this.setOptions,isDisabled:this.state.isBusy},void 0)}),void 0)]},void 0)},t}(ci),cWe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={show:!1,label:""},r.update=function(){var n=r.plugin.state.data,a=n.selectQ(function(p){return p.ofTransformer(lt.Model.ModelFromTrajectory)});if(a.length===0){r.setState({show:!1});return}for(var i="",o=0,s=new Set,u=0,l=a;u<l.length;u++){var c=l[u];if(!!c.sourceRef){var d=n.cells.get(c.sourceRef).obj;if(!!d&&d.data.frameCount>1){if(s.has(c.sourceRef)){r.setState({show:!1});return}if(s.add(c.sourceRef),o++,!i){var f=c.transform.params.modelIndex;i="Model "+(f+1)+" / "+d.data.frameCount}}}}o>1&&(i=""),r.setState({show:o>0,label:i})},r.reset=function(){return Rt.State.ApplyAction(r.plugin,{state:r.plugin.state.data,action:yS.create({action:"reset"})})},r.prev=function(){return Rt.State.ApplyAction(r.plugin,{state:r.plugin.state.data,action:yS.create({action:"advance",by:-1})})},r.next=function(){return Rt.State.ApplyAction(r.plugin,{state:r.plugin.state.data,action:yS.create({action:"advance",by:1})})},r}return t.prototype.componentDidMount=function(){this.subscribe(this.plugin.state.data.events.changed,this.update),this.subscribe(this.plugin.behaviors.state.isAnimating,this.update)},t.prototype.render=function(){var r=this.plugin.behaviors.state.isAnimating.value;return!this.state.show||r&&!this.state.label?null:Pe("div",T({className:"msp-traj-controls"},{children:[!r&&B(Zt,{svg:Sje,title:"First Model",onClick:this.reset,disabled:r},void 0),!r&&B(Zt,{svg:OQ,title:"Previous Model",onClick:this.prev,disabled:r},void 0),!r&&B(Zt,{svg:BQ,title:"Next Model",onClick:this.next,disabled:r},void 0),!!this.state.label&&B("span",{children:this.state.label},void 0)]}),void 0)},t}(Sr),dWe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isBusy:!1,show:!0},r.keyUp=function(n){if(!(!n.ctrlKey||r.state.isBusy||n.target!==document.body)){var a=r.plugin.managers.snapshot;if(n.keyCode===37||n.key==="ArrowLeft")a.state.isPlaying&&a.stop(),r.prev();else if(n.keyCode===38||n.key==="ArrowUp"){if(a.state.isPlaying&&a.stop(),a.state.entries.size===0)return;var i=a.state.entries.get(0);r.update(i.snapshot.id)}else if(n.keyCode===39||n.key==="ArrowRight")a.state.isPlaying&&a.stop(),r.next();else if(n.keyCode===40||n.key==="ArrowDown"){if(a.state.isPlaying&&a.stop(),a.state.entries.size===0)return;var o=a.state.entries.get(a.state.entries.size-1);r.update(o.snapshot.id)}}},r.change=function(n){n.target.value!=="none"&&r.update(n.target.value)},r.prev=function(){var n=r.plugin.managers.snapshot,a=n.getNextId(n.state.current,-1);a&&r.update(a)},r.next=function(){var n=r.plugin.managers.snapshot,a=n.getNextId(n.state.current,1);a&&r.update(a)},r.togglePlay=function(){r.plugin.managers.snapshot.togglePlay()},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.snapshot.events.changed,function(){return r.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){return r.setState({isBusy:n})}),this.subscribe(this.plugin.behaviors.state.isAnimating,function(n){return r.setState({isBusy:n})}),window.addEventListener("keyup",this.keyUp,!1)},t.prototype.componentWillUnmount=function(){e.prototype.componentWillUnmount.call(this),window.removeEventListener("keyup",this.keyUp,!1)},t.prototype.update=function(r){return pe(this,void 0,void 0,function(){return he(this,function(n){switch(n.label){case 0:return this.setState({isBusy:!0}),[4,Rt.State.Snapshots.Apply(this.plugin,{id:r})];case 1:return n.sent(),this.setState({isBusy:!1}),[2]}})})},t.prototype.render=function(){var r=this.plugin.managers.snapshot,n=r.state.entries.size;if(n<2||!this.state.show)return null;var a=r.state.current,i=r.state.isPlaying;return Pe("div",T({className:"msp-state-snapshot-viewport-controls"},{children:[Pe("select",T({className:"msp-form-control",value:a||"none",onChange:this.change,disabled:this.state.isBusy||i},{children:[!a&&B("option",{value:"none"},"none"),r.state.entries.valueSeq().map(function(o,s){return Pe("option",T({value:o.snapshot.id},{children:["["+(s+1)+"/"+n+"]"," ",o.name||new Date(o.timestamp).toLocaleString()]}),o.snapshot.id)})]}),void 0),B(Zt,{svg:i?NQ:FQ,title:i?"Pause":"Cycle States",onClick:this.togglePlay,disabled:i?!1:this.state.isBusy},void 0),!i&&Pe(Nt,{children:[B(Zt,{svg:OQ,title:"Previous State",onClick:this.prev,disabled:this.state.isBusy||i},void 0),B(Zt,{svg:BQ,title:"Next State",onClick:this.next,disabled:this.state.isBusy||i},void 0)]},void 0)]}),void 0)},t}(Sr),fWe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isEmpty:!0,isExpanded:!1,isBusy:!1,isAnimating:!1,isPlaying:!1},r.toggleExpanded=function(){return r.setState({isExpanded:!r.state.isExpanded})},r.stop=function(){r.plugin.managers.animation.stop(),r.plugin.managers.snapshot.stop()},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.snapshot.events.changed,function(){r.plugin.managers.snapshot.state.isPlaying?r.setState({isPlaying:!0,isExpanded:!1}):r.setState({isPlaying:!1})}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){n?r.setState({isBusy:!0,isExpanded:!1,isEmpty:r.plugin.state.data.tree.transforms.size<2}):r.setState({isBusy:!1,isEmpty:r.plugin.state.data.tree.transforms.size<2})}),this.subscribe(this.plugin.behaviors.state.isAnimating,function(n){n?r.setState({isAnimating:!0,isExpanded:!1}):r.setState({isAnimating:!1})})},t.prototype.render=function(){var r=this.plugin.managers.snapshot.state.isPlaying;if(r||this.state.isEmpty||this.plugin.managers.animation.isEmpty||!this.plugin.config.get(Qn.Viewport.ShowAnimation))return null;var n=this.state.isAnimating;return Pe("div",T({className:"msp-animation-viewport-controls"},{children:[Pe("div",{children:[B("div",{className:"msp-semi-transparent-background"},void 0),B(Zt,{svg:n||r?NQ:_je,transparent:!0,title:n?"Stop":"Select Animation",onClick:n||r?this.stop:this.toggleExpanded,toggleState:this.state.isExpanded,disabled:n||r?!1:this.state.isBusy||this.state.isPlaying||this.state.isEmpty},void 0)]},void 0),this.state.isExpanded&&!this.state.isBusy&&B("div",T({className:"msp-animation-viewport-controls-select"},{children:B(_Ge,{onStart:this.toggleExpanded},void 0)}),void 0)]}),void 0)},t}(Sr),pWe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onMouseMove=function(n){n.buttons===0&&n.stopPropagation()},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.behaviors.interaction.selectionMode,function(){return r.forceUpdate()})},t.prototype.render=function(){return this.plugin.selectionMode?B("div",T({className:"msp-selection-viewport-controls",onMouseMove:this.onMouseMove},{children:B(dqe,{},void 0)}),void 0):null},t}(Sr),hWe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={labels:[]},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.behaviors.labels.highlight,function(n){return r.setState({labels:n.labels})})},t.prototype.render=function(){return this.state.labels.length===0?null:B("div",T({className:"msp-highlight-info"},{children:this.state.labels.map(function(r,n){return B("div",{dangerouslySetInnerHTML:{__html:r}},""+n)})}),void 0)},t}(Sr),mWe=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.behaviors.events.changed,function(){return r.forceUpdate()})},t.prototype.render=function(){var r=this,n=[];return this.plugin.customStructureControls.forEach(function(a,i){n.push(B(a,{initiallyCollapsed:r.props.initiallyCollapsed},i))}),n.length>0?B(Nt,{children:n},void 0):null},t}(Sr),vWe=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.render=function(){return Pe(Nt,{children:[Pe("div",T({className:"msp-section-header"},{children:[B(dn,{svg:EHe},void 0),"Structure Tools"]}),void 0),B(wqe,{},void 0),B(vqe,{},void 0),B(sWe,{},void 0),B(XGe,{},void 0),this.plugin.config.get(Qn.VolumeStreaming.Enabled)&&B(Bqe,{},void 0),B(Fqe,{},void 0),B(mWe,{},void 0)]},void 0)},t}(Sr),gWe=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return Object.defineProperty(t.prototype,"current",{get:function(){return this.props.state.behaviors.currentObject.value},enumerable:!1,configurable:!0}),t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.events.object.updated,function(n){var a=n.ref,i=n.state,o=r.current;o.ref!==a||o.state!==i||r.forceUpdate()}),this.subscribe(this.plugin.state.data.actions.events.added,function(){return r.forceUpdate()}),this.subscribe(this.plugin.state.data.actions.events.removed,function(){return r.forceUpdate()})},t.prototype.render=function(){var r=this,n=this.props,a=n.state,i=n.nodeRef,o=a.cells.get(i),s=a.actions.fromCell(o,this.plugin);if(s.length===0)return null;var u=o.transform.transformer.definition,l=o.obj?o.obj.label:u.display&&u.display.name||u.name;return Pe("div",T({className:"msp-state-actions"},{children:[!this.props.hideHeader&&Pe("div",T({className:"msp-section-header"},{children:[B(dn,{svg:HHe},void 0)," ","Actions ("+l+")"]}),void 0),s.map(function(c,d){return B(DR,{state:a,action:c,nodeRef:i,initiallyCollapsed:d===0?!r.props.alwaysExpandFirst&&r.props.initiallyCollapsed:r.props.initiallyCollapsed},""+c.id)})]}),void 0)},t}(Sr),T3=function(e){Le(t,e);function t(r){var n=e.call(this)||this;return n.plugin=r,n.data=vp.create(new be.Root({}),{runTask:n.plugin.runTask,globalContext:n.plugin,historyCapacity:n.plugin.config.get(Qn.State.HistoryCapacity)}),n.behaviors=vp.create(new Ur.Root({}),{runTask:n.plugin.runTask,globalContext:n.plugin,rootState:{isLocked:!0}}),n.events={cell:{stateUpdated:Vc(n.data.events.cell.stateUpdated,n.behaviors.events.cell.stateUpdated),created:Vc(n.data.events.cell.created,n.behaviors.events.cell.created),removed:Vc(n.data.events.cell.removed,n.behaviors.events.cell.removed)},object:{created:Vc(n.data.events.object.created,n.behaviors.events.object.created),removed:Vc(n.data.events.object.removed,n.behaviors.events.object.removed),updated:Vc(n.data.events.object.updated,n.behaviors.events.object.updated)}},n.snapshotParams=n.ev.behavior(t.DefaultSnapshotParams),n.setSnapshotParams=function(a){n.snapshotParams.next(T(T({},t.DefaultSnapshotParams),a))},n}return Object.defineProperty(t.prototype,"animation",{get:function(){return this.plugin.managers.animation},enumerable:!1,configurable:!0}),t.prototype.getSnapshot=function(r){var n,a,i=T(T({},this.snapshotParams.value),r);return{id:Cn.create22(),data:i.data?this.data.getSnapshot():void 0,behaviour:i.behavior?this.behaviors.getSnapshot():void 0,animation:i.animation?this.animation.getSnapshot():void 0,startAnimation:i.startAnimation?!!i.startAnimation:void 0,camera:i.camera?{current:this.plugin.canvas3d.camera.getSnapshot(),transitionStyle:i.cameraTransition.name,transitionDurationInMs:((n=i?.cameraTransition)===null||n===void 0?void 0:n.name)==="animate"?i.cameraTransition.params.durationInMs:void 0}:void 0,canvas3d:i.canvas3d?{props:(a=this.plugin.canvas3d)===null||a===void 0?void 0:a.props}:void 0,interactivity:i.interactivity?{props:this.plugin.managers.interactivity.props}:void 0,structureFocus:this.plugin.managers.structure.focus.getSnapshot(),durationInMs:i?.durationInMs}},t.prototype.setSnapshot=function(r){var n;return pe(this,void 0,void 0,function(){var a;return he(this,function(i){switch(i.label){case 0:return[4,this.animation.stop()];case 1:return i.sent(),r.behaviour?[4,this.plugin.runTask(this.behaviors.setSnapshot(r.behaviour))]:[3,3];case 2:i.sent(),i.label=3;case 3:return r.data?[4,this.plugin.runTask(this.data.setSnapshot(r.data))]:[3,5];case 4:i.sent(),i.label=5;case 5:return!((n=r.canvas3d)===null||n===void 0)&&n.props?(a=M.normalizeParams(Xs,r.canvas3d.props,"children"),[4,Rt.Canvas3D.SetSettings(this.plugin,{settings:a})]):[3,7];case 6:i.sent(),i.label=7;case 7:return r.interactivity&&r.interactivity.props&&this.plugin.managers.interactivity.setProps(r.interactivity.props),r.structureFocus&&this.plugin.managers.structure.focus.setSnapshot(r.structureFocus),r.animation&&this.animation.setSnapshot(r.animation),r.camera&&Rt.Camera.Reset(this.plugin,{snapshot:r.camera.current,durationMs:r.camera.transitionStyle==="animate"?r.camera.transitionDurationInMs:void 0}),r.startAnimation&&this.animation.start(),[2]}})})},t.prototype.updateTransform=function(r,n,a,i){var o=r.build().to(n).update(a);return Rt.State.Update(this.plugin,{state:r,tree:o,options:{canUndo:i}})},t.prototype.updateBehavior=function(r,n){var a=this.behaviors.build();if(this.behaviors.tree.transforms.has(r.id))a.to(r.id).update(n);else{var i=r.createDefaultParams(void 0,this.plugin);a.to(Ur.getCategoryId(r)).apply(r,hd(i,n),{ref:r.id})}return this.plugin.runTask(this.behaviors.updateTree(a))},t.prototype.dispose=function(){this.behaviors.cells.forEach(function(r){Ur.Behavior.is(r.obj)&&r.obj.data.unregister()}),e.prototype.dispose.call(this),this.data.dispose(),this.behaviors.dispose(),this.animation.dispose()},t}(Sb);(function(e){e.SnapshotParams={durationInMs:M.Numeric(1500,{min:100,max:15e3,step:100},{label:"Duration in ms"}),data:M.Boolean(!0),behavior:M.Boolean(!1),animation:M.Boolean(!0),startAnimation:M.Boolean(!1),canvas3d:M.Boolean(!0),interactivity:M.Boolean(!0),camera:M.Boolean(!0),cameraTransition:M.MappedStatic("animate",{animate:M.Group({durationInMs:M.Numeric(250,{min:100,max:5e3,step:500},{label:"Duration in ms"})}),instant:M.Group({})},{options:[["animate","Animate"],["instant","Instant"]]})},e.DefaultSnapshotParams=M.getDefaultValues(e.SnapshotParams)})(T3||(T3={}));var yWe=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.render=function(){var r;return Pe("div",{children:[B(Jc,{icon:LQ,title:"Plugin State"},void 0),B("div",T({style:{marginBottom:"10px"}},{children:B(ul,T({header:"Save Options",initiallyExpanded:!1},{children:B(iZ,{},void 0)}),void 0)}),void 0),B(bWe,{},void 0),B(xWe,{},void 0),B(Jc,{title:"Save as File",accent:"blue"},void 0),B(aZ,{},void 0),((r=this.plugin.spec.components)===null||r===void 0?void 0:r.remoteState)!=="none"&&B(oZ,{},void 0)]},void 0)},t}(Sr),aZ=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.downloadToFileJson=function(){var n,a;(a=(n=r.props).onAction)===null||a===void 0||a.call(n),Rt.State.Snapshots.DownloadToFile(r.plugin,{type:"json"})},r.downloadToFileZip=function(){var n,a;(a=(n=r.props).onAction)===null||a===void 0||a.call(n),Rt.State.Snapshots.DownloadToFile(r.plugin,{type:"zip"})},r.open=function(n){var a,i;if(!n.target.files||!n.target.files[0]){r.plugin.log.error("No state file selected");return}(i=(a=r.props).onAction)===null||i===void 0||i.call(a),Rt.State.Snapshots.OpenFile(r.plugin,{file:n.target.files[0]})},r}return t.prototype.render=function(){return Pe(Nt,{children:[Pe("div",T({className:"msp-flex-row"},{children:[B(xr,T({icon:MI,onClick:this.downloadToFileJson,title:"Save the state description. Input data are loaded using the provided sources. Does not work if local files are used as input."},{children:"State"}),void 0),B(xr,T({icon:MI,onClick:this.downloadToFileZip,title:"Save the state including the input data."},{children:"Session"}),void 0),Pe("div",T({className:"msp-btn msp-btn-block msp-btn-action msp-loader-msp-btn-file"},{children:[B(dn,{svg:fje,inline:!0},void 0)," Open ",B("input",{onChange:this.open,type:"file",multiple:!1,accept:".molx,.molj"},void 0)]}),void 0)]}),void 0),Pe("div",T({className:"msp-help-text",style:{padding:"10px"}},{children:[B(dn,{svg:Dje},void 0)," This is an experimental feature and stored states/sessions might not be openable in a future version."]}),void 0)]},void 0)},t}(Sr),iZ=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.snapshotParams,function(){return r.forceUpdate()})},t.prototype.render=function(){return B(Jn,{params:T3.SnapshotParams,values:this.plugin.state.snapshotParams.value,onChangeValues:this.plugin.state.setSnapshotParams},void 0)},t}(Sr),bWe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={params:M.getDefaultValues(t.Params)},r.add=function(){Rt.State.Snapshots.Add(r.plugin,{name:r.state.params.name,description:r.state.params.description})},r.updateParams=function(n){return r.setState({params:n})},r.clear=function(){Rt.State.Snapshots.Clear(r.plugin,{})},r}return t.prototype.shouldComponentUpdate=function(r,n){return!p0(this.props,r)||!p0(this.state,n)},t.prototype.render=function(){return Pe("div",{children:[B(Jn,{params:t.Params,values:this.state.params,onEnter:this.add,onChangeValues:this.updateParams},void 0),Pe("div",T({className:"msp-flex-row"},{children:[B(Zt,{onClick:this.clear,svg:Cu,title:"Remove All"},void 0),B(xr,T({onClick:this.add,icon:Y0,style:{textAlign:"right"},commit:!0},{children:"Add"}),void 0)]}),void 0)]},void 0)},t.Params={name:M.Text(),description:M.Text()},t}(Sr),xWe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.apply=function(n){var a=n.currentTarget.getAttribute("data-id");!a||Rt.State.Snapshots.Apply(r.plugin,{id:a})},r.remove=function(n){var a=n.currentTarget.getAttribute("data-id");!a||Rt.State.Snapshots.Remove(r.plugin,{id:a})},r.moveUp=function(n){var a=n.currentTarget.getAttribute("data-id");!a||Rt.State.Snapshots.Move(r.plugin,{id:a,dir:-1})},r.moveDown=function(n){var a=n.currentTarget.getAttribute("data-id");!a||Rt.State.Snapshots.Move(r.plugin,{id:a,dir:1})},r.replace=function(n){var a=n.currentTarget.getAttribute("data-id");!a||Rt.State.Snapshots.Replace(r.plugin,{id:a})},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.snapshot.events.changed,function(){return r.forceUpdate()})},t.prototype.render=function(){var r=this,n=this.plugin.managers.snapshot.state.current;return B("ul",T({style:{listStyle:"none",marginTop:"10px"},className:"msp-state-list"},{children:this.plugin.managers.snapshot.state.entries.map(function(a){return Pe("li",T({className:"msp-flex-row"},{children:[Pe(xr,T({"data-id":a.snapshot.id,onClick:r.apply,className:"msp-no-overflow"},{children:[B("span",T({style:{fontWeight:a.snapshot.id===n?"bold":void 0}},{children:a.name||new Date(a.timestamp).toLocaleString()}),void 0)," ",B("small",{children:(a.snapshot.durationInMs?iS(a.snapshot.durationInMs,!1)+(a.description?", ":""):"")+(a.description?a.description:"")},void 0)]}),void 0),B(Zt,{svg:R_,"data-id":a.snapshot.id,title:"Move Up",onClick:r.moveUp,flex:"20px"},void 0),B(Zt,{svg:k_,"data-id":a.snapshot.id,title:"Move Down",onClick:r.moveDown,flex:"20px"},void 0),B(Zt,{svg:Tje,"data-id":a.snapshot.id,title:"Replace",onClick:r.replace,flex:"20px"},void 0),B(Zt,{svg:Cu,"data-id":a.snapshot.id,title:"Remove",onClick:r.remove,flex:"20px"},void 0)]}),a.snapshot.id)})}),void 0)},t}(Sr),oZ=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.Params={name:M.Text(),options:M.Group({description:M.Text(),playOnLoad:M.Boolean(!1),serverUrl:M.Text(r.plugin.config.get(Qn.State.CurrentServer))})},r.state={params:M.getDefaultValues(r.Params),entries:ma.exports.OrderedMap(),isBusy:!1},r.ListOnlyParams={options:M.Group({serverUrl:M.Text(r.plugin.config.get(Qn.State.CurrentServer))},{isFlat:!0})},r._mounted=!1,r.refresh=function(){return pe(r,void 0,void 0,function(){var n,a,i,o,s,u;return he(this,function(l){switch(l.label){case 0:return l.trys.push([0,2,,3]),this.setState({isBusy:!0}),this.plugin.config.set(Qn.State.CurrentServer,this.state.params.options.serverUrl),[4,this.plugin.runTask(this.plugin.fetch({url:this.serverUrl("list"),type:"json"}))];case 1:for(n=l.sent()||[],n.sort(function(c,d){return c.isSticky===d.isSticky?c.timestamp-d.timestamp:c.isSticky?-1:1}),a=ma.exports.OrderedMap().asMutable(),i=0,o=n;i<o.length;i++)s=o[i],a.set(s.id,T(T({},s),{url:this.serverUrl("get/"+s.id),removeUrl:this.serverUrl("remove/"+s.id)}));return this._mounted&&this.setState({entries:a.asImmutable(),isBusy:!1}),[3,3];case 2:return u=l.sent(),this.plugin.log.error("Fetching Remote Snapshots: "+u),this._mounted&&this.setState({entries:ma.exports.OrderedMap(),isBusy:!1}),[3,3];case 3:return[2]}})})},r.upload=function(){return pe(r,void 0,void 0,function(){return he(this,function(n){switch(n.label){case 0:return this.setState({isBusy:!0}),this.plugin.config.set(Qn.State.CurrentServer,this.state.params.options.serverUrl),[4,Rt.State.Snapshots.Upload(this.plugin,{name:this.state.params.name,description:this.state.params.options.description,playOnLoad:this.state.params.options.playOnLoad,serverUrl:this.state.params.options.serverUrl})];case 1:return n.sent(),this.plugin.log.message("Snapshot uploaded."),this._mounted&&(this.setState({isBusy:!1}),this.refresh()),[2]}})})},r.fetch=function(n){return pe(r,void 0,void 0,function(){var a,i;return he(this,function(o){switch(o.label){case 0:if(a=n.currentTarget.getAttribute("data-id"),!a)return[2];if(i=this.state.entries.get(a),!i)return[2];this.setState({isBusy:!0}),o.label=1;case 1:return o.trys.push([1,,3,4]),[4,Rt.State.Snapshots.Fetch(this.plugin,{url:i.url})];case 2:return o.sent(),[3,4];case 3:return this._mounted&&this.setState({isBusy:!1}),[7];case 4:return[2]}})})},r.remove=function(n){return pe(r,void 0,void 0,function(){var a,i;return he(this,function(o){switch(o.label){case 0:if(a=n.currentTarget.getAttribute("data-id"),!a)return[2];if(i=this.state.entries.get(a),!i)return[2];this.setState({entries:this.state.entries.remove(a)}),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,fetch(i.removeUrl)];case 2:return o.sent(),[3,4];case 3:return o.sent(),[3,4];case 4:return[2]}})})},r}return t.prototype.componentDidMount=function(){this.refresh(),this._mounted=!0},t.prototype.componentWillUnmount=function(){this._mounted=!1},t.prototype.serverUrl=function(r){return r?w_(this.state.params.options.serverUrl,r):this.state.params.options.serverUrl},t.prototype.render=function(){var r=this;return Pe(Nt,{children:[B(Jc,{title:"Remote States",accent:"blue"},void 0),!this.props.listOnly&&Pe(Nt,{children:[B(Jn,{params:this.Params,values:this.state.params,onEnter:this.upload,onChange:function(n){var a;r.setState({params:T(T({},r.state.params),(a={},a[n.name]=n.value,a))})},isDisabled:this.state.isBusy},void 0),Pe("div",T({className:"msp-flex-row"},{children:[B(Zt,{onClick:this.refresh,disabled:this.state.isBusy,svg:kI},void 0),B(xr,T({icon:UHe,onClick:this.upload,disabled:this.state.isBusy,commit:!0},{children:"Upload"}),void 0)]}),void 0)]},void 0),B(SWe,{entries:this.state.entries,isBusy:this.state.isBusy,serverUrl:this.state.params.options.serverUrl,fetch:this.fetch,remove:this.props.listOnly?void 0:this.remove},void 0),this.props.listOnly&&Pe("div",T({style:{marginTop:"10px"}},{children:[B(Jn,{params:this.ListOnlyParams,values:this.state.params,onEnter:this.upload,onChange:function(n){var a;r.setState({params:T(T({},r.state.params),(a={},a[n.name]=n.value,a))})},isDisabled:this.state.isBusy},void 0),B("div",T({className:"msp-flex-row"},{children:B(xr,T({onClick:this.refresh,disabled:this.state.isBusy,icon:kI},{children:"Refresh"}),void 0)}),void 0)]}),void 0)]},void 0)},t}(Sr),SWe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.open=function(n){return pe(r,void 0,void 0,function(){var a,i,o,s;return he(this,function(u){return a=n.currentTarget.getAttribute("data-id"),a?(i=this.props.entries.get(a),i?(n.preventDefault(),o=""+window.location,s=o.indexOf("?"),s>0&&(o=o.substr(0,s)),window.open(o+"?snapshot-url="+encodeURIComponent(i.url),"_blank"),[2]):[2]):[2]})})},r}return t.prototype.render=function(){var r=this;return B("ul",T({style:{listStyle:"none",marginTop:"10px"},className:"msp-state-list"},{children:this.props.entries.valueSeq().map(function(n){return Pe("li",T({className:"msp-flex-row"},{children:[Pe(xr,T({"data-id":n.id,onClick:r.props.fetch,disabled:r.props.isBusy,onContextMenu:r.open,title:"Click to download, right-click to open in a new tab."},{children:[n.name||new Date(n.timestamp).toLocaleString()," ",B("small",{children:n.description},void 0)]}),void 0),!n.isSticky&&r.props.remove&&B(Zt,{svg:Cu,"data-id":n.id,title:"Remove",onClick:r.props.remove,disabled:r.props.isBusy,small:!0},void 0)]}),n.id)})}),void 0)},t}(ci);function sZ(e,t){return t===void 0&&(t=b1e),function(r){return r.lift(new CWe(e,t))}}var CWe=function(){function e(t,r){this.dueTime=t,this.scheduler=r}return e.prototype.call=function(t,r){return r.subscribe(new wWe(t,this.dueTime,this.scheduler))},e}(),wWe=function(e){Fi(t,e);function t(r,n,a){var i=e.call(this,r)||this;return i.dueTime=n,i.scheduler=a,i.debouncedSubscription=null,i.lastValue=null,i.hasValue=!1,i}return t.prototype._next=function(r){this.clearDebounce(),this.lastValue=r,this.hasValue=!0,this.add(this.debouncedSubscription=this.scheduler.schedule(_We,this.dueTime,this))},t.prototype._complete=function(){this.debouncedNext(),this.destination.complete()},t.prototype.debouncedNext=function(){if(this.clearDebounce(),this.hasValue){var r=this.lastValue;this.lastValue=null,this.hasValue=!1,this.destination.next(r)}},t.prototype.clearDebounce=function(){var r=this.debouncedSubscription;r!==null&&(this.remove(r),r.unsubscribe(),this.debouncedSubscription=null)},t}(ou);function _We(e){e.debouncedNext()}function AWe(e){return function(t){return e===0?h1e():t.lift(new TWe(e))}}var TWe=function(){function e(t){if(this.total=t,this.total<0)throw new S1e}return e.prototype.call=function(t,r){return r.subscribe(new EWe(t,this.total))},e}(),EWe=function(e){Fi(t,e);function t(r,n){var a=e.call(this,r)||this;return a.total=n,a.count=0,a}return t.prototype._next=function(r){var n=this.total,a=++this.count;a<=n&&(this.destination.next(r),a===n&&(this.destination.complete(),this.unsubscribe()))},t}(ou),uZ=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={showActions:!0},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.events.cell.created,function(n){n.cell.transform.parent===vr.RootRef&&r.forceUpdate()}),this.subscribe(this.plugin.state.events.cell.removed,function(n){n.parent===vr.RootRef&&r.forceUpdate()})},t.getDerivedStateFromProps=function(r,n){var a=r.state.tree.root.ref,i=r.state.tree.children.get(a),o=i.size===0;return n.showActions===o?null:{showActions:o}},t.prototype.render=function(){var r=this.props.state.tree.root.ref;return this.state.showActions?Pe("div",T({style:{margin:"10px",cursor:"default"}},{children:[B("p",{children:"Nothing to see here yet."},void 0),Pe("p",{children:["Structures and Volumes can be loaded from the ",B(dn,{svg:DI},void 0)," tab."]},void 0)]}),void 0):B(PWe,{cell:this.props.state.cells.get(r),depth:0},void 0)},t}(Sr),PWe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isCollapsed:!!r.props.cell.state.isCollapsed,isNull:t.isNull(r.props.cell),showLabel:t.showLabel(r.props.cell)},r}return t.prototype.is=function(r){return r.ref===this.ref&&r.state===this.props.cell.parent},Object.defineProperty(t.prototype,"ref",{get:function(){return this.props.cell.transform.ref},enumerable:!1,configurable:!0}),t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.events.cell.stateUpdated,function(n){r.props.cell===n.cell&&r.is(n)&&n.state.cells.has(r.ref)&&(r.state.isCollapsed!==!!n.cell.state.isCollapsed||r.state.isNull!==t.isNull(n.cell)||r.state.showLabel!==t.showLabel(n.cell))&&r.forceUpdate()}),this.subscribe(this.plugin.state.events.cell.created,function(n){r.props.cell.parent===n.state&&r.ref===n.cell.transform.parent&&r.forceUpdate()}),this.subscribe(this.plugin.state.events.cell.removed,function(n){r.props.cell.parent===n.state&&r.ref===n.parent&&r.forceUpdate()})},t.getDerivedStateFromProps=function(r,n){var a=t.isNull(r.cell),i=t.showLabel(r.cell);return!!r.cell.state.isCollapsed===n.isCollapsed&&n.isNull===a&&n.showLabel===i?null:{isCollapsed:!!r.cell.state.isCollapsed,isNull:a,showLabel:i}},t.hasDecorator=function(r){var n,a=r.parent.tree.children.get(r.transform.ref);return a.size!==1?!1:!!(!((n=r.parent)===null||n===void 0)&&n.tree.transforms.get(a.first()).transformer.definition.isDecorator)},t.isNull=function(r){return!r||!r.parent||r.obj===qn.Null||!r.parent.tree.transforms.has(r.transform.ref)},t.showLabel=function(r){return r.transform.ref!==vr.RootRef&&(r.status!=="ok"||!r.state.isGhost&&!t.hasDecorator(r))},t.prototype.render=function(){var r=this;if(this.state.isNull)return null;var n=this.props.cell,a=n.parent.tree.children.get(this.ref);if(!this.state.showLabel)return a.size===0?null:B(Nt,{children:a.map(function(o){return B(t,{cell:n.parent.cells.get(o),depth:r.props.depth},o)})},void 0);var i=this.props.depth+1;return Pe(Nt,{children:[B(IWe,{cell:n,depth:this.props.depth},void 0),a.size===0?void 0:B("div",T({style:{display:this.state.isCollapsed?"none":"block"}},{children:a.map(function(o){return B(t,{cell:n.parent.cells.get(o),depth:i},o)})}),void 0)]},void 0)},t}(Sr),IWe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isCurrent:r.props.cell.parent.current===r.ref,isCollapsed:!!r.props.cell.state.isCollapsed,action:void 0,currentAction:void 0},r.setCurrent=function(n){n?.preventDefault(),n?.currentTarget.blur(),Rt.State.SetCurrentObject(r.plugin,{state:r.props.cell.parent,ref:r.ref})},r.setCurrentRoot=function(n){n?.preventDefault(),n?.currentTarget.blur(),Rt.State.SetCurrentObject(r.plugin,{state:r.props.cell.parent,ref:vr.RootRef})},r.remove=function(n){n?.preventDefault(),Rt.State.RemoveObject(r.plugin,{state:r.props.cell.parent,ref:r.ref,removeParentGhosts:!0})},r.toggleVisible=function(n){n.preventDefault(),Rt.State.ToggleVisibility(r.plugin,{state:r.props.cell.parent,ref:r.ref}),n.currentTarget.blur()},r.toggleExpanded=function(n){n.preventDefault(),Rt.State.ToggleExpanded(r.plugin,{state:r.props.cell.parent,ref:r.ref}),n.currentTarget.blur()},r.highlight=function(n){n.preventDefault(),Rt.Interactivity.Object.Highlight(r.plugin,{state:r.props.cell.parent,ref:r.ref}),n.currentTarget.blur()},r.clearHighlight=function(n){n.preventDefault(),Rt.Interactivity.ClearHighlights(r.plugin),n.currentTarget.blur()},r.hideApply=function(){r.setCurrentRoot()},r.selectAction=function(n){!n||(n?.value)()},r}return t.prototype.is=function(r){return r.ref===this.ref&&r.state===this.props.cell.parent},Object.defineProperty(t.prototype,"ref",{get:function(){return this.props.cell.transform.ref},enumerable:!1,configurable:!0}),t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.events.cell.stateUpdated.pipe(Gw(function(n){return r.is(n)}),sZ(33)),function(n){r.forceUpdate()}),this.subscribe(this.props.cell.parent.behaviors.currentObject,function(n){if(!r.is(n)){r.state.isCurrent&&n.state.transforms.has(r.ref)&&r._setCurrent(r.props.cell.parent.current===r.ref,r.state.isCollapsed);return}n.state.transforms.has(r.ref)&&r._setCurrent(r.props.cell.parent.current===r.ref,!!r.props.cell.state.isCollapsed)})},t.prototype._setCurrent=function(r,n){r?this.setState({isCurrent:r,action:"options",currentAction:void 0,isCollapsed:n}):this.setState({isCurrent:r,action:void 0,currentAction:void 0,isCollapsed:n})},t.getDerivedStateFromProps=function(r,n){var a=r.cell.parent.current===r.cell.transform.ref,i=!!r.cell.state.isCollapsed;return n.isCollapsed===i&&n.isCurrent===a?null:{isCurrent:a,isCollapsed:i,action:void 0,currentAction:void 0}},Object.defineProperty(t.prototype,"actions",{get:function(){var r=this,n=this.props.cell,a=Gt([],n.parent.actions.fromCell(n,this.plugin));if(a.length!==0)return a.sort(function(i,o){return i.definition.display.name<o.definition.display.name?-1:i.definition.display.name===o.definition.display.name?0:1}),Gt([ir.Header("Apply Action")],a.map(function(i){return ir.Item(i.definition.display.name,function(){return r.setState({action:"apply",currentAction:i})})}))},enumerable:!1,configurable:!0}),t.prototype.updates=function(r){for(var n=this.props.cell,a=I1.getDecoratorChain(n.parent,n.transform.ref),i=[],o=a.length-1;o>=0;o--){var s=a[o];i.push(B(Pd,{state:n.parent,transform:s.transform,noMargin:!0,wrapInExpander:!0,expanderHeaderLeftMargin:r},s.transform.transformer.id+"-"+o))}return B("div",T({className:"msp-tree-updates-wrapper"},{children:i}),void 0)},t.prototype.render=function(){var r=this.props.cell,n=r.transform;if(!r)return null;var a=this.is(r.parent.behaviors.currentObject.value),i=r.status!=="error"&&r.status!=="ok",o;if(r.status==="error"||!r.obj){var s=r.status==="error"?r.errorText:n.transformer.definition.display.name;o=Pe(xr,T({className:"msp-btn-tree-label msp-no-hover-outline",noOverflow:!0,title:s,onClick:this.state.isCurrent?this.setCurrentRoot:this.setCurrent,disabled:i},{children:[r.status==="error"&&Pe("b",{children:["[",r.status,"]"]},void 0)," ",B("span",{children:s},void 0)]}),void 0)}else{var u=r.obj,l=u.label+" "+(u.description?u.description:"");o=Pe(xr,T({className:"msp-btn-tree-label msp-type-class-"+u.type.typeClass,noOverflow:!0,disabled:i,title:l,onClick:this.state.isCurrent?this.setCurrentRoot:this.setCurrent},{children:[B("span",{children:u.label},void 0)," ",u.description?B("small",{children:u.description},void 0):void 0]}),void 0)}var c=r.parent.tree.children.get(this.ref),d=r.state,f=B(Zt,{svg:d.isCollapsed?Ed:Td,flex:"20px",disabled:i,onClick:this.toggleExpanded,transparent:!0,className:"msp-no-hover-outline",style:{visibility:c.size>0?"visible":"hidden"}},void 0),p=r.state.isLocked?void 0:B(Zt,{svg:Cu,onClick:this.remove,disabled:i,small:!0,toggleState:!1},void 0),h=B(Zt,{svg:d.isHidden?Fm:Lm,toggleState:!1,disabled:i,small:!0,onClick:this.toggleVisible},void 0),m={marginLeft:this.props.depth*8+"px"},v=Pe("div",T({className:"msp-flex-row msp-tree-row"+(a?" msp-tree-row-current":""),onMouseEnter:this.highlight,onMouseLeave:this.clearHighlight,style:m},{children:[f,o,p,h]}),void 0);if(!a)return v;if(this.state.action==="apply"&&this.state.currentAction)return Pe("div",T({style:{marginBottom:"1px"}},{children:[v,B(Zc,T({header:"Apply "+this.state.currentAction.definition.display.name,initialExpanded:!0,hideExpander:!0,hideOffset:!1,onHeaderClick:this.hideApply,topRightIcon:Qc,headerLeftMargin:this.props.depth*8+21+"px"},{children:B(DR,{onApply:this.hideApply,state:this.props.cell.parent,action:this.state.currentAction,nodeRef:this.props.cell.transform.ref,hideHeader:!0,noMargin:!0},void 0)}),void 0)]}),void 0);if(this.state.action==="options"){var g=this.actions,y=this.updates(this.props.depth*8+21+"px");return Pe("div",T({style:{marginBottom:"1px"}},{children:[v,y,g&&B("div",T({style:{marginLeft:this.props.depth*8+21+"px",marginTop:"-1px"}},{children:B(ir,{items:g,onSelect:this.selectAction},void 0)}),void 0)]}),void 0)}return v},t}(Sr),MWe=function(e){Le(t,e);function t(){var r,n=e.apply(this,arguments)||this;return n.state={tab:n.plugin.behaviors.layout.leftPanelTabName.value},n.set=function(a){if(n.state.tab===a){n.setState({tab:"none"},function(){return n.plugin.behaviors.layout.leftPanelTabName.next("none")}),Rt.Layout.Update(n.plugin,{state:{regionState:T(T({},n.plugin.layout.state.regionState),{left:"collapsed"})}});return}n.setState({tab:a},function(){return n.plugin.behaviors.layout.leftPanelTabName.next(a)}),n.plugin.layout.state.regionState.left!=="full"&&Rt.Layout.Update(n.plugin,{state:{regionState:T(T({},n.plugin.layout.state.regionState),{left:"full"})}})},n.tabs={none:B(Nt,{},void 0),root:Pe(Nt,{children:[B(Jc,{icon:DI,title:"Home"},void 0),B(gWe,{state:n.plugin.state.data,nodeRef:vr.RootRef,hideHeader:!0,initiallyCollapsed:!0,alwaysExpandFirst:!0},void 0),((r=n.plugin.spec.components)===null||r===void 0?void 0:r.remoteState)!=="none"&&B(oZ,{listOnly:!0},void 0)]},void 0),data:Pe(Nt,{children:[B(Jc,{icon:MQ,title:Pe(Nt,{children:[B(RWe,{},void 0)," State Tree"]},void 0)},void 0),B(uZ,{state:n.plugin.state.data},void 0)]},void 0),states:B(yWe,{},void 0),settings:Pe(Nt,{children:[B(Jc,{icon:vm,title:"Plugin Settings"},void 0),B(kWe,{},void 0)]},void 0),help:Pe(Nt,{children:[B(Jc,{icon:cc,title:"Help"},void 0),B(lqe,{},void 0)]},void 0)},n}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.behaviors.layout.leftPanelTabName,function(n){r.state.tab!==n&&r.setState({tab:n}),n==="none"&&r.plugin.layout.state.regionState.left!=="collapsed"&&Rt.Layout.Update(r.plugin,{state:{regionState:T(T({},r.plugin.layout.state.regionState),{left:"collapsed"})}})}),this.subscribe(this.plugin.state.data.events.changed,function(n){var a=n.state;r.state.tab==="data"&&a.cells.size===1&&r.set("root")})},t.prototype.render=function(){var r=this,n=this.state.tab;return Pe("div",T({className:"msp-left-panel-controls"},{children:[Pe("div",T({className:"msp-left-panel-controls-buttons"},{children:[B(Zt,{svg:DI,toggleState:n==="root",transparent:!0,onClick:function(){return r.set("root")},title:"Home"},void 0),B(DWe,{set:this.set},void 0),B(Zt,{svg:LQ,toggleState:n==="states",transparent:!0,onClick:function(){return r.set("states")},title:"Plugin State"},void 0),B(Zt,{svg:cc,toggleState:n==="help",transparent:!0,onClick:function(){return r.set("help")},title:"Help"},void 0),B("div",T({className:"msp-left-panel-controls-buttons-bottom"},{children:B(Zt,{svg:vm,toggleState:n==="settings",transparent:!0,onClick:function(){return r.set("settings")},title:"Settings"},void 0)}),void 0)]}),void 0),B("div",T({className:"msp-scrollable-container"},{children:this.tabs[n]}),void 0)]}),void 0)},t}(Sr),DWe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={changed:!1},r}return Object.defineProperty(t.prototype,"tab",{get:function(){return this.plugin.behaviors.layout.leftPanelTabName.value},enumerable:!1,configurable:!0}),t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.behaviors.layout.leftPanelTabName,function(n){r.tab==="data"?r.setState({changed:!1}):r.forceUpdate()}),this.subscribe(this.plugin.state.data.events.changed,function(n){r.tab!=="data"&&r.setState({changed:!0})})},t.prototype.render=function(){var r=this;return B(Zt,{svg:MQ,toggleState:this.tab==="data",transparent:!0,onClick:function(){return r.props.set("data")},title:"State Tree",style:{position:"relative"},extraContent:this.state.changed?B("div",{className:"msp-left-panel-controls-button-data-dirty"},void 0):void 0},void 0)},t}(Sr),kWe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.setSettings=function(n){var a;Rt.Canvas3D.SetSettings(r.plugin,{settings:(a={},a[n.name]=n.value,a)})},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.events.canvas3d.settingsUpdated,function(){return r.forceUpdate()}),this.subscribe(this.plugin.layout.events.updated,function(){return r.forceUpdate()}),this.subscribe(this.plugin.canvas3d.camera.stateChanged,function(n){(n.radiusMax!==void 0||n.radius!==void 0)&&r.forceUpdate()})},t.prototype.render=function(){return Pe(Nt,{children:[this.plugin.canvas3d&&Pe(Nt,{children:[B(Jc,{title:"Viewport"},void 0),B(Jn,{params:Xs,values:this.plugin.canvas3d.props,onChange:this.setSettings},void 0)]},void 0),B(Jc,{title:"Behavior"},void 0),B(uZ,{state:this.plugin.state.behaviors},void 0)]},void 0)},t}(Sr),RWe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.remove=function(n){n.preventDefault(),Rt.State.RemoveObject(r.plugin,{state:r.plugin.state.data,ref:vr.RootRef})},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.events.cell.created,function(n){n.cell.transform.parent===vr.RootRef&&r.forceUpdate()}),this.subscribe(this.plugin.state.events.cell.removed,function(n){n.parent===vr.RootRef&&r.forceUpdate()})},t.prototype.render=function(){var r=this.plugin.state.data.tree.children.get(vr.RootRef).size;return r===0?null:B(Zt,{svg:Cu,onClick:this.remove,title:"Remove All",style:{display:"inline-block"},small:!0,className:"msp-no-hover-outline",transparent:!0},void 0)},t}(Sr),mz=5,OWe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.parentDiv=ke.exports.createRef(),r.lastMouseOverSeqIdx=-1,r.highlightQueue=new ha,r.lociHighlightProvider=function(n,a){var i=r.props.sequenceWrapper.markResidue(n.loci,a);i&&r.updateMarker()},r.lociSelectionProvider=function(n,a){var i=r.props.sequenceWrapper.markResidue(n.loci,a);i&&r.updateMarker()},r.contextMenu=function(n){n.preventDefault()},r.mouseDownLoci=void 0,r.mouseDown=function(n){n.stopPropagation();var a=r.getSeqIdx(n),i=r.getLoci(a),o=Dh(n.nativeEvent),s=Ov(n.nativeEvent),u=ix(n.nativeEvent);r.click(i,o,s,u),r.mouseDownLoci=i},r.mouseUp=function(n){if(n.stopPropagation(),r.mouseDownLoci!==void 0){var a=r.getSeqIdx(n),i=r.getLoci(a);if(i&&!Oe.areEqual(r.mouseDownLoci,i)){var o=Dh(n.nativeEvent),s=Ov(n.nativeEvent),u=ix(n.nativeEvent),l=r.mouseDownLoci.elements[0],c=i.elements[0],d=Math.min(Ne.min(l.indices),Ne.min(c.indices)),f=Math.max(Ne.max(l.indices),Ne.max(c.indices)),p=Oe(i.structure,[{unit:l.unit,indices:Ne.ofRange(d,f)}]);r.click(Oe.subtract(p,r.mouseDownLoci),o,s,u)}r.mouseDownLoci=void 0}},r.location=ot.create(void 0),r.mouseMove=function(n){n.stopPropagation();var a=Dh(n.nativeEvent),i=Ov(n.nativeEvent),o=ix(n.nativeEvent),s=n.target;if(!s||!s.getAttribute){if(r.lastMouseOverSeqIdx===-1)return;r.lastMouseOverSeqIdx=-1,r.highlightQueue.next({seqIdx:-1,buttons:a,button:i,modifiers:o});return}var u=s.hasAttribute("data-seqid")?+s.getAttribute("data-seqid"):-1;if(r.lastMouseOverSeqIdx!==u)if(r.lastMouseOverSeqIdx=u,r.mouseDownLoci!==void 0){var l=r.getLoci(u);r.hover(l,0,0,T(T({},o),{shift:!0}))}else r.highlightQueue.next({seqIdx:u,buttons:a,button:i,modifiers:o})},r.mouseLeave=function(n){if(n.stopPropagation(),r.mouseDownLoci=void 0,r.lastMouseOverSeqIdx!==-1){r.lastMouseOverSeqIdx=-1;var a=Dh(n.nativeEvent),i=Ov(n.nativeEvent),o=ix(n.nativeEvent);r.highlightQueue.next({seqIdx:-1,buttons:a,button:i,modifiers:o})}},r}return Object.defineProperty(t.prototype,"sequenceNumberPeriod",{get:function(){if(this.props.sequenceNumberPeriod!==void 0)return this.props.sequenceNumberPeriod;if(this.props.sequenceWrapper.length>10)return 10;var r=this.getSequenceNumber(this.props.sequenceWrapper.length-1);return r.length>1?5:1},enumerable:!1,configurable:!0}),t.prototype.componentDidMount=function(){var r=this;this.plugin.managers.interactivity.lociHighlights.addProvider(this.lociHighlightProvider),this.plugin.managers.interactivity.lociSelects.addProvider(this.lociSelectionProvider),this.subscribe(sZ(15)(this.highlightQueue),function(n){var a=r.getLoci(n.seqIdx<0?void 0:n.seqIdx);r.hover(a,n.buttons,n.button,n.modifiers)})},t.prototype.componentWillUnmount=function(){e.prototype.componentWillUnmount.call(this),this.plugin.managers.interactivity.lociHighlights.removeProvider(this.lociHighlightProvider),this.plugin.managers.interactivity.lociSelects.removeProvider(this.lociSelectionProvider)},t.prototype.getLoci=function(r){if(r!==void 0){var n=this.props.sequenceWrapper.getLoci(r);if(!Oe.isEmpty(n))return n}},t.prototype.getSeqIdx=function(r){var n=void 0,a=r.target;return a&&a.getAttribute&&(n=a.hasAttribute("data-seqid")?+a.getAttribute("data-seqid"):void 0),n},t.prototype.hover=function(r,n,a,i){var o={current:mr.Loci.Empty,buttons:n,button:a,modifiers:i};r!==void 0&&!Oe.isEmpty(r)&&(o.current={loci:r}),this.plugin.behaviors.interaction.hover.next(o)},t.prototype.click=function(r,n,a,i){var o={current:mr.Loci.Empty,buttons:n,button:a,modifiers:i};r!==void 0&&!Oe.isEmpty(r)&&(o.current={loci:r}),this.plugin.behaviors.interaction.click.next(o)},t.prototype.getBackgroundColor=function(r){return typeof r>"u"&&console.error("unexpected marker value"),r===0?"":r%2===0?"rgb(51, 255, 25)":"rgb(255, 102, 153)"},t.prototype.getResidueClass=function(r,n){return n.length>1?this.props.sequenceWrapper.residueClass(r)+(r===0?" msp-sequence-residue-long-begin":" msp-sequence-residue-long"):this.props.sequenceWrapper.residueClass(r)},t.prototype.residue=function(r,n,a){return B("span",T({"data-seqid":r,style:{backgroundColor:this.getBackgroundColor(a)},className:this.getResidueClass(r,n)},{children:"\u200B"+n+"\u200B"}),r)},t.prototype.getSequenceNumberClass=function(r,n,a){var i=["msp-sequence-number"];return n.startsWith("-")?a.length>1&&r>0?i.push("msp-sequence-number-long-negative"):i.push("msp-sequence-number-negative"):a.length>1&&r>0&&i.push("msp-sequence-number-long"),i.join(" ")},t.prototype.getSequenceNumber=function(r){var n="",a=this.props.sequenceWrapper.getLoci(r),i=Oe.getFirstLocation(a,this.location);if(i)if(We.isAtomic(i.unit)){var o=mt.residue.auth_seq_id(i),s=mt.residue.pdbx_PDB_ins_code(i);n=""+o+(s||"")}else We.isCoarse(i.unit)&&(n=""+(r+1));return n},t.prototype.padSeqNum=function(r){return r.length<mz?r+new Array(mz-r.length+1).join("\xA0"):r},t.prototype.getSequenceNumberSpan=function(r,n){var a=this.getSequenceNumber(r);return B("span",T({className:this.getSequenceNumberClass(r,a,n)},{children:this.padSeqNum(a)}),"marker-"+r)},t.prototype.updateMarker=function(){if(!!this.parentDiv.current)for(var r=this.parentDiv.current.children,n=this.props.sequenceWrapper.markerArray,a=!this.props.hideSequenceNumbers,i=this.sequenceNumberPeriod,o=0,s=0,u=n.length;s<u;s++){a&&s%i===0&&s<u&&o++;var l=r[o];if(!l)return;o++;var c=this.getBackgroundColor(n[s]);l.style.backgroundColor!==c&&(l.style.backgroundColor=c)}},t.prototype.render=function(){for(var r=this.props.sequenceWrapper,n=[],a=!this.props.hideSequenceNumbers,i=this.sequenceNumberPeriod,o=0,s=r.length;o<s;++o){var u=r.residueLabel(o);a&&o%i===0&&o<s&&(n[n.length]=this.getSequenceNumberSpan(o,u)),n[n.length]=this.residue(o,u,r.markerArray[o])}return this.updateMarker(),B("div",T({className:"msp-sequence-wrapper",onContextMenu:this.contextMenu,onMouseDown:this.mouseDown,onMouseUp:this.mouseUp,onMouseMove:this.mouseMove,onMouseLeave:this.mouseLeave,ref:this.parentDiv},{children:n}),void 0)},t}(Sr),F_=function(){function e(t,r,n){this.data=t,this.markerArray=r,this.length=n}return e.prototype.markResidue=function(t,r){return uu(t)?sl(this.markerArray,Me.ofLength(this.length),r):this.mark(t,r)},e}(),BWe=function(e){Le(t,e);function t(r){var n=this,a=ot.create(r.structure,r.units[0],r.units[0].elements[0]),i=r.units[0].model.sequence.byEntityKey[mt.entity.key(a)],o=i.sequence.length,s=new Uint8Array(o);n=e.call(this,r,s,o)||this,n.unitMap=new Map;for(var u=0,l=r.units;u<l.length;u++){var c=l[u];n.unitMap.set(c.id,c)}n.sequence=i.sequence,n.missing=r.units[0].model.properties.missingResidues,n.modelNum=r.units[0].model.modelNum,n.asymId=We.isAtomic(r.units[0])?mt.chain.label_asym_id(a):mt.coarse.asym_id(a);for(var d=[],f=0;f<o;++f)n.missing.has(n.modelNum,n.asymId,n.seqId(f))&&d.push(f);return n.observed=Ne.subtract(Me.ofBounds(0,o),nt.ofSortedArray(d)),n}return t.prototype.seqId=function(r){return this.sequence.seqId.value(r)},t.prototype.residueLabel=function(r){return this.sequence.label.value(r)||this.sequence.code.value(r)},t.prototype.residueColor=function(r){return this.missing.has(this.modelNum,this.asymId,this.seqId(r))?gr.grey:gr.black},t.prototype.residueClass=function(r){return this.missing.has(this.modelNum,this.asymId,this.seqId(r))?"msp-sequence-missing":"msp-sequence-present"},t.prototype.mark=function(r,n){var a=this,i=!1,o=this.data.structure,s=function(d){return a.sequence.index(d)};if(Oe.is(r)){if(!$e.areRootsEquivalent(r.structure,o))return!1;r=Oe.remap(r,o);for(var u=0,l=r.elements;u<l.length;u++){var c=l[u];!this.unitMap.has(c.unit.id)||(We.isAtomic(c.unit)?i=LWe(c,n,this.markerArray,s):i=NWe(c,n,this.markerArray,s))}}else if($e.isLoci(r)){if(!$e.areRootsEquivalent(r.structure,o))return!1;sl(this.markerArray,this.observed,n)&&(i=!0)}return i},t.prototype.getLoci=function(r){var n=FWe(this.data.units[0].chainGroupId,this.data.units[0].conformation.operator.name,this.seqId(r));return St.toLociWithSourceUnits(C5.run(n,this.data.structure))},t}(F_);function FWe(e,t,r){return un.generators.atoms({unitTest:function(n){return mt.unit.chainGroupId(n.element)===e&&mt.unit.operator_name(n.element)===t},residueTest:function(n){return n.element.unit.kind===0?mt.residue.label_seq_id(n.element)===r:mt.coarse.seq_id_begin(n.element)<=r&&mt.coarse.seq_id_end(n.element)>=r}})}function LWe(e,t,r,n){var a=e.unit,i=a.model,o=a.elements,s=i.atomicHierarchy.residueAtomSegments.index,u=i.atomicHierarchy.residues.label_seq_id;return Ne.forEachSegment(e.indices,function(l){return s[o[l]]},function(l){var c=u.value(l);QC(r,n(c),t)}),!0}function NWe(e,t,r,n){var a=e.unit,i=a.model,o=a.elements,s=We.isSpheres(e.unit)?i.coarseHierarchy.spheres.seq_id_begin:i.coarseHierarchy.gaussians.seq_id_begin,u=We.isSpheres(e.unit)?i.coarseHierarchy.spheres.seq_id_end:i.coarseHierarchy.gaussians.seq_id_end;return Ne.forEach(e.indices,function(l){for(var c=o[l],d=n(s.value(c)),f=n(u.value(c));d<=f;d++)QC(r,d,t)}),!0}var zWe=function(e){Le(t,e);function t(r){for(var n=this,a=[],i=new Map,o=new Map,s=new Map,u=0,l=r.units.length;u<l;++u)for(var c=r.units[u],d=c.model.atomicHierarchy,f=d.residueAtomSegments,p=d.atoms,h=pr.transientSegments(f,c.elements);h.hasNext;){var m=h.move().index;i.set(m,a.length),o.set(a.length,m),s.set(a.length,c),a.push(p.label_comp_id.value(f.offsets[m]))}var v=a.length,g=new Uint8Array(v);n=e.call(this,r,g,v)||this,n.unitMap=new Map;for(var y=0,b=r.units;y<b.length;y++){var c=b[y];n.unitMap.set(c.id,c)}return n.sequence=a,n.sequenceIndices=i,n.residueIndices=o,n.seqToUnit=s,n}return t.prototype.residueLabel=function(r){return this.sequence[r]},t.prototype.residueColor=function(r){return gr.black},t.prototype.residueClass=function(r){return"msp-sequence-present"},t.prototype.mark=function(r,n){var a=this,i=!1,o=this.data.structure;if(Oe.is(r)){if(!$e.areRootsEquivalent(r.structure,o))return!1;r=Oe.remap(r,o);for(var s=function(f){var p=u.unitMap.get(f.unit.id);if(p){var h=f.unit.model.atomicHierarchy.residueAtomSegments.index;Ne.forEach(f.indices,function(m){var v=a.sequenceIndices.get(h[p.elements[m]]);v!==void 0&&sl(a.markerArray,Me.ofSingleton(v),n)&&(i=!0)})}},u=this,l=0,c=r.elements;l<c.length;l++){var d=c[l];s(d)}}else if($e.isLoci(r)){if(!$e.areRootsEquivalent(r.structure,o))return!1;sl(this.markerArray,Me.ofBounds(0,this.length),n)&&(i=!0)}return i},t.prototype.getLoci=function(r){var n=[],a=this.residueIndices.get(r);if(a!==void 0){var i=this.seqToUnit.get(r),o=i.model.atomicHierarchy.residueAtomSegments.offsets,s=nt.findPredecessorIndex(i.elements,o[a]),u=nt.findPredecessorIndex(i.elements,o[a+1]);n.push({unit:i,indices:Me.ofBounds(s,u)})}return Oe(this.data.structure,n)},t}(F_),_T=function(e){Le(t,e);function t(r){for(var n=this,a=0,i=0,o=[],s=ot.create(r.structure),u=new Map,l=[],c=0,d=r.units.length;c<d;++c){var f=r.units[c];ot.set(s,r.structure,f,f.elements[0]);var p=f.model.sequence.byEntityKey[mt.entity.key(s)];p&&(a+=p.sequence.length),i+=f.elements.length;var h=Me.ofBounds(0,f.elements.length);u.set(f.id,h),l.push({unit:f,indices:h})}a>0&&o.push(a+" residues"),o.push(i+" elements");var m=1,v=new Uint8Array(m);return n=e.call(this,r,v,m)||this,n.label="Whole Chain ("+o.join(", ")+")",n.unitIndices=u,n.loci=Oe(n.data.structure,l),n}return t.prototype.residueLabel=function(r){return this.label},t.prototype.residueColor=function(r){return gr.black},t.prototype.residueClass=function(r){return"msp-sequence-present"},t.prototype.mark=function(r,n){var a=!1,i=this.data.structure;if(Oe.is(r)){if(!$e.areRootsEquivalent(r.structure,i))return!1;r=Oe.remap(r,i);for(var o=0,s=r.elements;o<s.length;o++){var u=s[o],l=this.unitIndices.get(u.unit.id);l&&Ne.isSubset(l,u.indices)&&sl(this.markerArray,Me.ofSingleton(0),n)&&(a=!0)}}else if($e.isLoci(r)){if(!$e.areRootsEquivalent(r.structure,i))return!1;sl(this.markerArray,Me.ofSingleton(0),n)&&(a=!0)}return a},t.prototype.getLoci=function(r){return this.loci},t}(F_),UWe=function(e){Le(t,e);function t(r){for(var n=this,a=0,i=new Map,o=0,s=r.units.length;o<s;++o){var u=r.units[o];a+=u.elements.length;var l=Me.ofBounds(0,u.elements.length);i.set(u.id,l)}var c=new Uint8Array(a);return n=e.call(this,r,c,a)||this,n.unitIndices=i,n}return t.prototype.residueLabel=function(r){return"X"},t.prototype.residueColor=function(r){return gr.black},t.prototype.residueClass=function(r){return"msp-sequence-present"},t.prototype.mark=function(r,n){var a=!1,i=this.data,o=i.structure,s=i.units;if(Oe.is(r)){if(!$e.areRootsEquivalent(r.structure,o))return!1;r=Oe.remap(r,o);for(var u=0,l=r.elements;u<l.length;u++){var c=l[u],d=this.unitIndices.get(c.unit.id);d&&Ne.isSubset(d,c.indices)&&sl(this.markerArray,c.indices,n)&&(a=!0)}}else if($e.isLoci(r)){if(!$e.areRootsEquivalent(r.structure,o))return!1;for(var f=0,p=s.length;f<p;++f){var d=this.unitIndices.get(s[f].id);sl(this.markerArray,d,n)&&(a=!0)}}return a},t.prototype.getLoci=function(r){for(var n=this.data.units,a=[],i=0,o=0,s=n.length;o<s;++o){var u=n[o];if(r<i+u.elements.length){a.push({unit:u,indices:Me.ofSingleton(r-i)});break}i+=u.elements.length}return Oe(this.data.structure,a)},t}(F_),AT=5e3;function lZ(e){var t=mt.unit.pdbx_struct_oper_list_ids(e),r=mt.unit.struct_ncs_oper_id(e),n=mt.unit.hkl(e),a=mt.unit.spgrOp(e);return t.sort().join(",")+"|"+r+"|"+n+"|"+a}function kR(e){var t=e.split("|"),r=t[0],n=t[1];return[parseInt(r),n]}function vz(e,t){for(var r=e.structure,n=e.modelEntityId,a=e.chainGroupId,i=e.operatorKey,o=ot.create(r),s=kR(n),u=s[0],l=s[1],c=[],d=0,f=r.units;d<f.length;d++){var p=f[d];ot.set(o,r,p,p.elements[0]),r.getModelIndex(p.model)===u&&mt.entity.id(o)===l&&p.chainGroupId===a&&lZ(o)===i&&c.push(p)}if(c.length>0){var h={structure:r,units:c},p=c[0],m=void 0;if(p.polymerElements.length){var v=ot.create(r,p,p.elements[0]),g=p.model.sequence.byEntityKey[mt.entity.key(v)];if(g&&g.sequence.length<=AT)m=new BWe(h);else{var y=c.reduce(function(x,C){return x+C.polymerElements.length},0);We.isAtomic(p)||y>AT?m=new _T(h):m=new UWe(h)}}else if(We.isAtomic(p)){var b=c.reduce(function(x,C){return x+C.residueCount},0);b>AT?m=new _T(h):m=new zWe(h)}else console.warn("should not happen, expecting coarse units to be polymeric"),m=new _T(h);return m.markResidue(t.getLoci(r),sr.Select),m}else return"No sequence available"}function yx(e,t){t===void 0&&(t=!1);for(var r=[],n=ot.create(e),a=new Set,i=0,o=e.units;i<o.length;i++){var s=o[i];ot.set(n,e,s,s.elements[0]);var u=mt.entity.id(n),l=e.getModelIndex(s.model),c=l+"|"+u;if(!a.has(c)&&!(t&&mt.entity.type(n)!=="polymer")){var d=mt.entity.pdbx_description(n).join(", ");e.models.length&&(e.representativeModel?d+=" (Model "+e.models[l].modelNum+")":d.startsWith("Polymer ")&&(d+=" ("+e.models[l].entry+")"));var f=u+": "+d;r.push([c,f]),a.add(c)}}return r.length===0&&r.push(["","No entities"]),r}function Bg(e,t){for(var r=[],n=ot.create(e),a=new Set,i=kR(t),o=i[0],s=i[1],u=0,l=e.units;u<l.length;u++){var c=l[u];if(ot.set(n,e,c,c.elements[0]),e.getModelIndex(c.model)===o&&mt.entity.id(n)===s){var d=c.chainGroupId;if(!a.has(d)){var f=Ou(n,{granularity:"chain",hidePrefix:!0,htmlStyling:!1});r.push([d,f]),a.add(d)}}}return r.length===0&&r.push([-1,"No units"]),r}function ov(e,t,r){for(var n=[],a=ot.create(e),i=new Set,o=kR(t),s=o[0],u=o[1],l=0,c=e.units;l<c.length;l++){var d=c[l];if(ot.set(a,e,d,d.elements[0]),e.getModelIndex(d.model)===s&&mt.entity.id(a)===u&&d.chainGroupId===r){var f=lZ(a);if(!i.has(f)){var p=d.conformation.operator.name;n.push([f,p]),i.add(f)}}}return n.length===0&&n.push(["","No operators"]),n}function gz(e){for(var t,r=[],n=[],a=e.select(lr.Generators.rootsOfType(be.Molecule.Structure)),i=0,o=a;i<o.length;i++){var s=o[i];!(!((t=s.obj)===null||t===void 0)&&t.data)||(n.push(s.obj.data),r.push([s.transform.ref,s.obj.data.label]))}return r.length===0&&r.push(["","No structure"]),{options:r,all:n}}var yz=M.Select("single",[["single","Chain"],["polymers","Polymers"],["all","Everything"]]),VWe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={structureOptions:{options:[],all:[]},structure:$e.Empty,structureRef:"",modelEntityId:"",chainGroupId:-1,operatorKey:"",mode:"single"},r.setParamProps=function(n){var a=T({},r.state);switch(n.name){case"mode":if(a.mode=n.value,r.state.mode===a.mode)return;if(a.mode==="all"||a.mode==="polymers")break;case"structure":n.name==="structure"&&(a.structureRef=n.value),a.structure=r.getStructure(a.structureRef),a.modelEntityId=yx(a.structure)[0][0],a.chainGroupId=Bg(a.structure,a.modelEntityId)[0][0],a.operatorKey=ov(a.structure,a.modelEntityId,a.chainGroupId)[0][0];break;case"entity":a.modelEntityId=n.value,a.chainGroupId=Bg(a.structure,a.modelEntityId)[0][0],a.operatorKey=ov(a.structure,a.modelEntityId,a.chainGroupId)[0][0];break;case"chain":a.chainGroupId=n.value,a.operatorKey=ov(a.structure,a.modelEntityId,a.chainGroupId)[0][0];break;case"operator":a.operatorKey=n.value;break}r.setState(a)},r}return t.prototype.componentDidMount=function(){var r=this;this.plugin.state.data.select(lr.Generators.rootsOfType(be.Molecule.Structure)).length>0&&this.setState(this.getInitialState()),this.subscribe(this.plugin.state.events.object.updated,function(n){var a=n.ref,i=n.obj;a===r.state.structureRef&&i&&i.type===be.Molecule.Structure.type&&i.data!==r.state.structure&&r.sync()}),this.subscribe(this.plugin.state.events.object.created,function(n){var a=n.obj;a&&a.type===be.Molecule.Structure.type&&r.sync()}),this.subscribe(this.plugin.state.events.object.removed,function(n){var a=n.obj;a&&a.type===be.Molecule.Structure.type&&a.data===r.state.structure&&r.sync()})},t.prototype.sync=function(){var r=gz(this.plugin.state.data);XD(r.all,this.state.structureOptions.all)||this.setState(this.getInitialState())},t.prototype.getStructure=function(r){var n=this.plugin.state.data,a=n.select(r)[0];return!r||!a||!a.obj?$e.Empty:a.obj.data},t.prototype.getSequenceWrapper=function(r){return{wrapper:vz(this.state,this.plugin.managers.structure.selection),label:M.optionLabel(r.chain,this.state.chainGroupId)+" | "+M.optionLabel(r.entity,this.state.modelEntityId)}},t.prototype.getSequenceWrappers=function(r){if(this.state.mode==="single")return[this.getSequenceWrapper(r)];for(var n=this.getStructure(this.state.structureRef),a=[],i=0,o=yx(n,this.state.mode==="polymers");i<o.length;i++)for(var s=o[i],u=s[0],l=s[1],c=0,d=Bg(n,u);c<d.length;c++)for(var f=d[c],p=f[0],h=f[1],m=0,v=ov(n,u,p);m<v.length;m++){var g=v[m][0];a.push({wrapper:vz({structure:n,modelEntityId:u,chainGroupId:p,operatorKey:g},this.plugin.managers.structure.selection),label:h+" | "+l})}return a},t.prototype.getInitialState=function(){var r,n=gz(this.plugin.state.data),a=n.options[0][0],i=this.getStructure(a),o=yx(i)[0][0],s=Bg(i,o)[0][0],u=ov(i,o,s)[0][0];return this.state.structure&&this.state.structure===i&&(o=this.state.modelEntityId,s=this.state.chainGroupId,u=this.state.operatorKey),{structureOptions:n,structure:i,structureRef:a,modelEntityId:o,chainGroupId:s,operatorKey:u,mode:(r=this.props.defaultMode)!==null&&r!==void 0?r:"single"}},Object.defineProperty(t.prototype,"params",{get:function(){var r=this.state,n=r.structureOptions,a=r.structure,i=r.modelEntityId,o=r.chainGroupId,s=yx(a),u=Bg(a,i),l=ov(a,i,o);return{structure:M.Select(n.options[0][0],n.options,{shortLabel:!0}),entity:M.Select(s[0][0],s,{shortLabel:!0}),chain:M.Select(u[0][0],u,{shortLabel:!0,twoColumns:!0,label:"Chain"}),operator:M.Select(l[0][0],l,{shortLabel:!0,twoColumns:!0}),mode:yz}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"values",{get:function(){return{structure:this.state.structureRef,entity:this.state.modelEntityId,chain:this.state.chainGroupId,operator:this.state.operatorKey,mode:this.state.mode}},enumerable:!1,configurable:!0}),t.prototype.render=function(){if(this.getStructure(this.state.structureRef)===$e.Empty)return B("div",T({className:"msp-sequence"},{children:Pe("div",T({className:"msp-sequence-select"},{children:[B(dn,{svg:cc,style:{cursor:"help",position:"absolute",right:0,top:0},title:"Shows a sequence of one or more chains. Use the controls to alter selection."},void 0),B("span",{children:"Sequence"},void 0),B("span",T({style:{fontWeight:"normal"}},{children:"No structure available"}),void 0)]}),void 0)}),void 0);var r=this.params,n=this.values,a=this.getSequenceWrappers(r);return Pe("div",T({className:"msp-sequence"},{children:[Pe("div",T({className:"msp-sequence-select"},{children:[B(dn,{svg:cc,style:{cursor:"help",position:"absolute",right:0,top:0},title:"This shows a single sequence. Use the controls to show a different sequence."},void 0),B("span",{children:"Sequence of"},void 0),B(hv,{title:"[Structure] "+M.optionLabel(r.structure,n.structure),param:r.structure,name:"structure",value:n.structure,onChange:this.setParamProps},void 0),B(hv,{title:"[Mode]",param:yz,name:"mode",value:n.mode,onChange:this.setParamProps},void 0),n.mode==="single"&&B(hv,{title:"[Entity] "+M.optionLabel(r.entity,n.entity),param:r.entity,name:"entity",value:n.entity,onChange:this.setParamProps},void 0),n.mode==="single"&&B(hv,{title:"[Chain] "+M.optionLabel(r.chain,n.chain),param:r.chain,name:"chain",value:n.chain,onChange:this.setParamProps},void 0),r.operator.options.length>1&&B(Nt,{children:B(hv,{title:"[Instance] "+M.optionLabel(r.operator,n.operator),param:r.operator,name:"operator",value:n.operator,onChange:this.setParamProps},void 0)},void 0)]}),void 0),B(HWe,{children:a.map(function(i,o){var s=typeof i.wrapper=="string"?B("div",T({className:"msp-sequence-wrapper"},{children:i.wrapper}),o):B(OWe,{sequenceWrapper:i.wrapper},o);return n.mode==="single"?s:Pe(ke.exports.Fragment,{children:[B("div",T({className:"msp-sequence-chain-label"},{children:i.label}),void 0),s]},o)})},void 0)]}),void 0)},t}(Sr);function HWe(e){var t=e.children;return B("div",T({className:"msp-sequence-wrapper-non-empty"},{children:t}),void 0)}var jWe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={tracked:ma.exports.OrderedMap()},r}return t.prototype.componentDidMount=function(){var r=this,n,a=!!(!((n=this.plugin.spec.components)===null||n===void 0)&&n.hideTaskOverlay);this.subscribe(this.plugin.events.task.progress.pipe(Gw(function(i){return i.level==="background"&&(a||!i.useOverlay)})),function(i){r.setState({tracked:r.state.tracked.set(i.id,i)})}),this.subscribe(this.plugin.events.task.finished,function(i){var o=i.id;r.setState({tracked:r.state.tracked.delete(o)})})},t.prototype.render=function(){return B("div",T({className:"msp-background-tasks"},{children:this.state.tracked.valueSeq().map(function(r){return B(cZ,{event:r},r.id)})}),void 0)},t}(Sr),cZ=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.abort=function(){r.plugin.managers.task.requestAbort(r.props.event.progress.root.progress.taskId,"User Request")},r}return t.prototype.render=function(){var r=this.props.event.progress.root,n=dZ(this.props.event.progress.root)-1,a=r.progress.isIndeterminate?void 0:Pe(Nt,{children:["[",r.progress.current,"/",r.progress.max,"]"]},void 0),i=n>0?Pe(Nt,{children:["[",n," subtask(s)]"]},void 0):void 0;return B("div",T({className:"msp-task-state"},{children:Pe("div",{children:[r.progress.canAbort&&B(Zt,{svg:kQ,onClick:this.abort,title:"Abort"},void 0),Pe("div",{children:[r.progress.message," ",a," ",i]},void 0)]},void 0)}),void 0)},t}(Sr);function dZ(e){if(e.children.length===0)return 1;for(var t=0,r=0,n=e.children;r<n.length;r++){var a=n[r];t+=dZ(a)}return t}var GWe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={tracked:ma.exports.OrderedMap()},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.events.task.progress.pipe(Gw(function(n){return!!n.useOverlay})),function(n){r.setState({tracked:r.state.tracked.set(n.id,n)})}),this.subscribe(this.plugin.events.task.finished,function(n){var a=n.id;r.setState({tracked:r.state.tracked.delete(a)})})},t.prototype.render=function(){return this.state.tracked.size===0?null:B("div",T({className:"msp-overlay-tasks"},{children:this.state.tracked.valueSeq().map(function(r){return B(cZ,{event:r},r.id)})}),void 0)},t}(Sr),qWe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.hide=function(){var n=r.props.entry;(n.hide||function(){}).call(null)},r}return t.prototype.render=function(){var r=this,n=this.props.entry,a=typeof n.message=="string"?B("div",{dangerouslySetInnerHTML:{__html:n.message}},void 0):B("div",{children:B(n.message,{},void 0)},void 0);return Pe("div",T({className:"msp-toast-entry"},{children:[B("div",T({className:"msp-toast-title",onClick:function(){return r.hide()}},{children:n.title}),void 0),B("div",T({className:"msp-toast-message"},{children:a}),void 0),B("div",{className:"msp-toast-clear"},void 0),B("div",T({className:"msp-toast-hide"},{children:B(Zt,{svg:kQ,onClick:this.hide,title:"Hide",className:"msp-no-hover-outline"},void 0)}),void 0)]}),void 0)},t}(Sr),WWe=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.toast.events.changed,function(){return r.forceUpdate()})},t.prototype.render=function(){var r=this.plugin.managers.toast.state;if(!r.entries.count())return null;var n=[];return r.entries.forEach(function(a,i){return n.push(a)}),n.sort(function(a,i){return a.serialNumber-i.serialNumber}),B("div",T({className:"msp-toast-container"},{children:n.map(function(a){return B(qWe,{entry:a},a.serialNumber)})}),void 0)},t}(Sr),XWe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.container=ke.exports.createRef(),r.canvas=ke.exports.createRef(),r.state={noWebGl:!1,showLogo:!0},r.handleLogo=function(){var n;r.setState({showLogo:!(!((n=r.plugin.canvas3d)===null||n===void 0)&&n.reprCount.value)})},r}return t.prototype.componentDidMount=function(){if(!this.canvas.current||!this.container.current||!this.plugin.initViewer(this.canvas.current,this.container.current)){this.setState({noWebGl:!0});return}this.handleLogo(),this.subscribe(this.plugin.canvas3d.reprCount,this.handleLogo)},t.prototype.componentWillUnmount=function(){e.prototype.componentWillUnmount.call(this)},t.prototype.renderMissing=function(){if(this.props.noWebGl){var r=this.props.noWebGl;return B(r,{},void 0)}return B("div",T({className:"msp-no-webgl"},{children:Pe("div",{children:[B("p",{children:B("b",{children:"WebGL does not seem to be available."},void 0)},void 0),B("p",{children:"This can be caused by an outdated browser, graphics card driver issue, or bad weather. Sometimes, just restarting the browser helps."},void 0),Pe("p",{children:["For a list of supported browsers, refer to ",B("a",T({href:"http://caniuse.com/#feat=webgl",target:"_blank"},{children:"http://caniuse.com/#feat=webgl"}),void 0),"."]},void 0)]},void 0)}),void 0)},t.prototype.render=function(){if(this.state.noWebGl)return this.renderMissing();var r=this.props.logo;return Pe("div",T({className:this.props.parentClassName||"msp-viewport",style:this.props.parentStyle},{children:[B("div",T({className:this.props.hostClassName||"msp-viewport-host3d",style:this.props.hostStyle,ref:this.container},{children:B("canvas",{ref:this.canvas},void 0)}),void 0),this.state.showLogo&&r&&B(r,{},void 0)]}),void 0)},t}(Sr);function Oh(e){var t=ke.exports.useState(e?.value),r=t[0],n=t[1];return ke.exports.useEffect(function(){if(!e){r!==void 0&&n(void 0);return}var a=!0,i=e.subscribe(function(o){a?(a=!1,o!==r&&n(o)):n(o)});return function(){i.unsubscribe()}},[e]),r}var YWe=function(e){var t=e.plugin,r=e.cropFrameColor,n=t.helpers.viewportScreenshot,a=ke.exports.useState(null),i=a[0],o=a[1],s=ke.exports.useRef(null),u=ke.exports.useRef(e);return ke.exports.useEffect(function(){u.current=e},Object.values(e)),ke.exports.useEffect(function(){i!==s.current&&o(s.current)}),ke.exports.useEffect(function(){var l,c=!1,d=[];function f(g,y){!g||d.push(g.subscribe(y))}function p(){var g=u.current;!g.suspend&&s.current&&bz(n,s.current,g.customBackground,g.borderColor,g.borderWidth),s.current||(c=!0)}var h=setInterval(function(){c&&(c=!1,p())},1e3/8);f(t.events.canvas3d.settingsUpdated,function(){return c=!0}),f((l=t.canvas3d)===null||l===void 0?void 0:l.didDraw,function(){return c=!0}),f(t.state.data.behaviors.isUpdating,function(g){g||(c=!0)}),f(n.behaviors.values,function(){return c=!0}),f(n.behaviors.cropParams,function(){return c=!0});var m=void 0;typeof ResizeObserver<"u"&&(m=new ResizeObserver(function(){return c=!0}));var v=s.current;return m?.observe(v),p(),function(){clearInterval(h),d.forEach(function(g){return g.unsubscribe()}),m?.unobserve(v)}},[n]),ke.exports.useLayoutEffect(function(){s.current&&bz(n,s.current,e.customBackground,e.borderColor,e.borderWidth)},Gt([],Object.values(e))),B(Nt,{children:Pe("div",T({style:{position:"relative",width:"100%",height:"100%"}},{children:[B("canvas",{ref:s,onContextMenu:function(l){l.preventDefault(),l.stopPropagation()},style:{display:"block",width:"100%",height:"100%"}},void 0),B($We,{plugin:t,canvas:i,color:r},void 0)]}),void 0)},void 0)},KWe=ke.exports.memo(YWe,function(e,t){return LD(e,t)});function bz(e,t,r,n,a){var i=e.getPreview(),o=i.canvas,s=i.width,u=i.height,l=t.getContext("2d");if(!!l){var c=t.clientWidth,d=t.clientHeight;t.width=c,t.height=d,l.clearRect(0,0,c,d);var f=fZ(s,u,c,d);if(r)l.fillStyle=r,l.fillRect(f.x,f.y,f.width,f.height);else if(e.values.transparent)for(var p=13,h=0;h<f.width;h+=p)for(var m=0;m<f.height;m+=p){l.fillStyle=(h+m)%2?"#ffffff":"#bfbfbf";var v=f.x+h,g=f.y+m,y=h+p>f.width?f.width-h:p,b=m+p>f.height?f.height-m:p;l.fillRect(v,g,y,b)}if(l.drawImage(o,f.x,f.y,f.width,f.height),n&&a){var S=a;l.rect(f.x,f.y,f.width,f.height),l.rect(f.x+S,f.y+S,f.width-2*S,f.height-2*S),l.fillStyle=n,l.fill("evenodd")}}}function $We(e){var t,r=e.plugin,n=e.canvas,a=e.color,i=a===void 0?"rgba(255, 87, 45, 0.75)":a,o=r.helpers.viewportScreenshot,s=Oh(o?.behaviors.values),u=Oh(o?.behaviors.cropParams),l=Oh(o?.behaviors.relativeCrop),c=ke.exports.useRef({x:0,y:0,width:0,height:0});Oh(s?.resolution.name==="viewport"?(t=r.canvas3d)===null||t===void 0?void 0:t.resized:void 0);var d=ke.exports.useState(""),f=d[0],p=d[1],h=ke.exports.useState([0,0]),m=h[0],v=h[1],g=ke.exports.useState([0,0]),y=g[0],b=g[1];if(!o||!n)return null;var S=o.getSizeAndViewport(),x=S.width,C=S.height,w=fZ(x,C,n.clientWidth,n.clientHeight),_={x:w.x+Math.floor(w.width*l.x),y:w.y+Math.floor(w.height*l.y),width:Math.ceil(w.width*l.width),height:Math.ceil(w.height*l.height)},E=xz(_),P=xz(w);if(f==="move"?(E.l+=y[0]-m[0],E.r+=y[0]-m[0],E.t+=y[1]-m[1],E.b+=y[1]-m[1]):f&&(f.indexOf("left")>=0?E.l+=y[0]-m[0]:f.indexOf("right")>=0&&(E.r+=y[0]-m[0]),f.indexOf("top")>=0?E.t+=y[1]-m[1]:f.indexOf("bottom")>=0&&(E.b+=y[1]-m[1])),E.l>E.r){var D=E.l;E.l=E.r,E.r=D}if(E.t>E.b){var D=E.t;E.t=E.b,E.b=D}var k=40;E.l=Math.min(P.r-k,Math.max(P.l,E.l)),E.r=Math.max(P.l+k,Math.min(P.r,E.r)),E.t=Math.min(P.b-k,Math.max(P.t,E.t)),E.b=Math.max(P.t+k,Math.min(P.b,E.b)),_.x=E.l,_.y=E.t,_.width=E.r-E.l+1,_.height=E.b-E.t+1,c.current=_;var F=function(Q){Q.preventDefault(),b([Q.pageX,Q.pageY])},X=function(Q){Q.preventDefault();var R=Q.touches[0];b([R.pageX,R.pageY])},U=function(Q){Q.preventDefault(),p(Q.currentTarget.getAttribute("data-drag"));var R=Q.touches[0],Y=[R.pageX,R.pageY];v(Y),b(Y),window.addEventListener("touchend",q),window.addEventListener("touchmove",X)},j=function(Q){Q.preventDefault(),p(Q.currentTarget.getAttribute("data-drag"));var R=[Q.pageX,Q.pageY];v(R),b(R),window.addEventListener("mouseup",te),window.addEventListener("mousemove",F)},te=function(){window.removeEventListener("mouseup",te),window.removeEventListener("mousemove",F),W()},q=function(){window.removeEventListener("touchend",q),window.removeEventListener("touchmove",X),W()};function W(){var Q=c.current;u.auto&&o?.behaviors.cropParams.next(T(T({},u),{auto:!1})),o?.behaviors.relativeCrop.next({x:(Q.x-w.x)/w.width,y:(Q.y-w.y)/w.height,width:Q.width/w.width,height:Q.height/w.height}),p("");var R=[0,0];v(R),b(R)}var V=function(Q){Q.preventDefault(),Q.stopPropagation()},ee=4,ue="3px solid "+i,$="transparent";return Pe(Nt,{children:[B("div",{"data-drag":"move",style:{position:"absolute",left:_.x,top:_.y,width:_.width,height:_.height,border:ue,cursor:"move"},onMouseDown:j,onTouchStart:U,draggable:!1,onContextMenu:V},void 0),B("div",{"data-drag":"left",style:{position:"absolute",left:_.x-ee,top:_.y+ee,width:4*ee,height:_.height-ee,background:$,cursor:"w-resize"},onMouseDown:j,onTouchStart:U,draggable:!1,onContextMenu:V},void 0),B("div",{"data-drag":"right",style:{position:"absolute",left:E.r-2*ee,top:_.y,width:4*ee,height:_.height-ee,background:$,cursor:"w-resize"},onMouseDown:j,onTouchStart:U,draggable:!1,onContextMenu:V},void 0),B("div",{"data-drag":"top",style:{position:"absolute",left:_.x-ee,top:_.y-ee,width:_.width+2*ee,height:4*ee,background:$,cursor:"n-resize"},onMouseDown:j,onTouchStart:U,draggable:!1,onContextMenu:V},void 0),B("div",{"data-drag":"bottom",style:{position:"absolute",left:_.x-ee,top:E.b-2*ee,width:_.width+2*ee,height:4*ee,background:$,cursor:"n-resize"},onMouseDown:j,onTouchStart:U,draggable:!1,onContextMenu:V},void 0),B("div",{"data-drag":"top, left",style:{position:"absolute",left:E.l-ee,top:E.t-ee,width:4*ee,height:4*ee,background:$,cursor:"nw-resize"},onMouseDown:j,onTouchStart:U,draggable:!1,onContextMenu:V},void 0),B("div",{"data-drag":"bottom, right",style:{position:"absolute",left:E.r-2*ee,top:E.b-2*ee,width:4*ee,height:4*ee,background:$,cursor:"nw-resize"},onMouseDown:j,onTouchStart:U,draggable:!1,onContextMenu:V},void 0),B("div",{"data-drag":"top, right",style:{position:"absolute",left:E.r-2*ee,top:E.t-ee,width:4*ee,height:4*ee,background:$,cursor:"ne-resize"},onMouseDown:j,onTouchStart:U,draggable:!1,onContextMenu:V},void 0),B("div",{"data-drag":"bottom, left",style:{position:"absolute",left:E.l-ee,top:E.b-2*ee,width:4*ee,height:4*ee,background:$,cursor:"ne-resize"},onMouseDown:j,onTouchStart:U,draggable:!1,onContextMenu:V},void 0)]},void 0)}function xz(e){return{l:e.x,t:e.y,r:e.x+e.width-1,b:e.y+e.height-1}}function fZ(e,t,r,n){var a=e/t,i=r/n;if(a<=i){var o=n*a;return{x:Math.round((r-o)/2),y:0,width:Math.round(o),height:n}}else{var o=r/a;return{x:0,y:Math.round((n-o)/2),width:r,height:Math.round(o)}}}var QWe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={showPreview:!0,isDisabled:!1},r.download=function(){var n;(n=r.plugin.helpers.viewportScreenshot)===null||n===void 0||n.download(),r.props.close()},r.copy=function(){return pe(r,void 0,void 0,function(){var n;return he(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,(n=this.plugin.helpers.viewportScreenshot)===null||n===void 0?void 0:n.copyToClipboard()];case 1:return a.sent(),Rt.Toast.Show(this.plugin,{message:"Copied to clipboard.",title:"Screenshot",timeoutMs:1500}),[3,3];case 2:return a.sent(),[2,this.copyImg()];case 3:return[2]}})})},r.copyImg=function(){return pe(r,void 0,void 0,function(){var n,a;return he(this,function(i){switch(i.label){case 0:return[4,(a=this.plugin.helpers.viewportScreenshot)===null||a===void 0?void 0:a.getImageDataUri()];case 1:return n=i.sent(),this.setState({imageData:n}),[2]}})})},r.open=function(n){!n.target.files||!n.target.files[0]||Rt.State.Snapshots.OpenFile(r.plugin,{file:n.target.files[0]})},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.data.behaviors.isUpdating,function(n){r.setState({isDisabled:n})})},t.prototype.componentWillUnmount=function(){this.setState({imageData:void 0})},t.prototype.render=function(){var r=this,n,a=!!(!((n=navigator.clipboard)===null||n===void 0)&&n.write);return Pe("div",{children:[this.state.showPreview&&Pe("div",T({className:"msp-image-preview"},{children:[B(KWe,{plugin:this.plugin},void 0),B(JWe,{plugin:this.plugin},void 0)]}),void 0),Pe("div",T({className:"msp-flex-row"},{children:[!this.state.imageData&&B(xr,T({icon:GHe,onClick:a?this.copy:this.copyImg,disabled:this.state.isDisabled},{children:"Copy"}),void 0),this.state.imageData&&B(xr,T({onClick:function(){return r.setState({imageData:void 0})},disabled:this.state.isDisabled},{children:"Clear"}),void 0),B(xr,T({icon:MI,onClick:this.download,disabled:this.state.isDisabled},{children:"Download"}),void 0)]}),void 0),this.state.imageData&&Pe("div",T({className:"msp-row msp-copy-image-wrapper"},{children:[B("div",{children:"Right click below + Copy Image"},void 0),B("img",{src:this.state.imageData,style:{width:"100%",height:32,display:"block"}},void 0)]}),void 0),B(ZWe,{plugin:this.plugin,isDisabled:this.state.isDisabled},void 0),Pe(ul,T({header:"State"},{children:[B(aZ,{onAction:this.props.close},void 0),B(ul,T({header:"Save Options",initiallyExpanded:!1,noOffset:!0},{children:B(iZ,{},void 0)}),void 0)]}),void 0)]},void 0)},t}(Sr);function ZWe(e){var t=e.plugin,r=e.isDisabled,n=t.helpers.viewportScreenshot,a=Oh(n.behaviors.values);return B(Jn,{params:n.params,values:a,onChangeValues:function(i){return n.behaviors.values.next(i)},isDisabled:r},void 0)}function JWe(e){var t=e.plugin,r=t.helpers.viewportScreenshot,n=Oh(r?.behaviors.cropParams);return Oh(r?.behaviors.relativeCrop),r?Pe("div",T({style:{width:"100%",height:"24px",marginTop:"8px"}},{children:[B(Wa,{icon:$He,title:"Auto-crop",inline:!0,isSelected:n.auto,style:{background:"transparent",float:"left",width:"auto",height:"24px",lineHeight:"24px"},toggle:function(){return r.toggleAutocrop()},label:"Auto-crop "+(n.auto?"On":"Off")},void 0),!n.auto&&B(xr,{icon:WHe,title:"Crop",style:{background:"transparent",float:"right",height:"24px",lineHeight:"24px",width:"24px",padding:"0"},onClick:function(){return r.autocrop()}},void 0),!n.auto&&!r.isFullFrame&&B(xr,{icon:YHe,title:"Reset Crop",style:{background:"transparent",float:"right",height:"24px",lineHeight:"24px",width:"24px",padding:"0"},onClick:function(){return r.resetCrop()}},void 0)]}),void 0):null}function eXe(e){return function(t){var r=t.values,n=t.update,a=t.apply;return{params:typeof e.params=="function"?e.params:function(i){return e.params},getTarget:e.target,getValues:r,update:function(i,o){var s=e.target(o);return hd(s,function(u){return n(i,u,o)})},apply:a||function(){}}}}var tXe=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.events.canvas3d.settingsUpdated,function(){return r.forceUpdate()}),this.subscribe(this.plugin.canvas3d.camera.stateChanged,function(n){(n.radiusMax!==void 0||n.radius!==void 0)&&r.forceUpdate()})},t.prototype.render=function(){return this.plugin.canvas3d?Pe(Nt,{children:[B(Yje,{mapping:nXe},void 0),B(IR,{},void 0)]},void 0):null},t}(Sr),bS={sequence:"Sequence",log:"Log",left:"Left Panel"},rXe={spin:M.Group({spin:Xs.trackball.params.spin,speed:Xs.trackball.params.spinSpeed},{pivot:"spin"}),camera:Xs.camera,background:M.Group({color:M.Color(vt(16579577),{label:"Background",description:"Custom background color"}),transparent:M.Boolean(!1)},{pivot:"color"}),lighting:M.Group({renderStyle:Xs.renderer.params.style,occlusion:Xs.postprocessing.params.occlusion,outline:Xs.postprocessing.params.outline,fog:Xs.cameraFog},{pivot:"renderStyle"}),clipping:M.Group(T(T({},Xs.cameraClipping.params),Xs.renderer.params.clip.params),{pivot:"radius"}),layout:M.MultiSelect([],M.objectToOptions(bS))},nXe=eXe({params:function(e){var t,r=M.clone(rXe),n=(t=e.spec.components)===null||t===void 0?void 0:t.controls;if(n){var a=[];n.top!=="none"&&a.push(["sequence",bS.sequence]),n.bottom!=="none"&&a.push(["log",bS.log]),n.left!=="none"&&a.push(["left",bS.left]),r.layout.options=a}return r},target:function(e){var t,r,n=(t=e.spec.components)===null||t===void 0?void 0:t.controls,a=e.layout.state.regionState,i=[];return a.top!=="hidden"&&(!n||n.top!=="none")&&i.push("sequence"),a.bottom!=="hidden"&&(!n||n.bottom!=="none")&&i.push("log"),a.left!=="hidden"&&(!n||n.left!=="none")&&i.push("left"),{canvas:(r=e.canvas3d)===null||r===void 0?void 0:r.props,layout:i}}})({values:function(e,t){var r=e.canvas,n=r.renderer;return{layout:e.layout,spin:{spin:!!r.trackball.spin,speed:r.trackball.spinSpeed},camera:r.camera,background:{color:n.backgroundColor,transparent:r.transparentBackground},lighting:{renderStyle:n.style,occlusion:r.postprocessing.occlusion,outline:r.postprocessing.outline,fog:r.cameraFog},clipping:T(T({},r.cameraClipping),r.renderer.clip)}},update:function(e,t){var r=t.canvas;r.trackball.spin=e.spin.spin,r.trackball.spinSpeed=e.spin.speed,r.camera=e.camera,r.transparentBackground=e.background.transparent,r.renderer.backgroundColor=e.background.color,r.renderer.style=e.lighting.renderStyle,r.postprocessing.occlusion=e.lighting.occlusion,r.postprocessing.outline=e.lighting.outline,r.cameraFog=e.lighting.fog,r.cameraClipping={radius:e.clipping.radius,far:e.clipping.far},r.renderer.clip={variant:e.clipping.variant,objects:e.clipping.objects},t.layout=e.layout},apply:function(e,t){return pe(this,void 0,void 0,function(){var r,n;return he(this,function(a){switch(a.label){case 0:return[4,Rt.Canvas3D.SetSettings(t,{settings:e.canvas})];case 1:return a.sent(),r=e.layout.indexOf("left")<0,n=hd(t.layout.state,function(i){i.regionState.top=e.layout.indexOf("sequence")>=0?"full":"hidden",i.regionState.bottom=e.layout.indexOf("log")>=0?"full":"hidden",i.regionState.left=r?"hidden":t.behaviors.layout.leftPanelTabName.value==="none"?"collapsed":"full"}),[4,Rt.Layout.Update(t,{state:n})];case 2:return a.sent(),r&&Rt.State.SetCurrentObject(t,{state:t.state.data,ref:vr.RootRef}),[2]}})})}}),aXe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.allCollapsedState={isSettingsExpanded:!1,isScreenshotExpanded:!1},r.state=T({},r.allCollapsedState),r.resetCamera=function(){Rt.Camera.Reset(r.plugin,{})},r.toggleSettingsExpanded=r.toggle("isSettingsExpanded"),r.toggleScreenshotExpanded=r.toggle("isScreenshotExpanded"),r.toggleControls=function(){Rt.Layout.Update(r.plugin,{state:{showControls:!r.plugin.layout.state.showControls}})},r.toggleExpanded=function(){Rt.Layout.Update(r.plugin,{state:{isExpanded:!r.plugin.layout.state.isExpanded}})},r.setSettings=function(n){var a;Rt.Canvas3D.SetSettings(r.plugin,{settings:(a={},a[n.name]=n.value,a)})},r.setLayout=function(n){var a;Rt.Layout.Update(r.plugin,{state:(a={},a[n.name]=n.value,a)})},r.screenshot=function(){var n;(n=r.plugin.helpers.viewportScreenshot)===null||n===void 0||n.download()},r.onMouseMove=function(n){n.buttons===0&&n.stopPropagation()},r}return t.prototype.toggle=function(r){var n=this;return function(a){var i;n.setState(T(T({},n.allCollapsedState),(i={},i[r]=!n.state[r],i))),a?.currentTarget.blur()}},t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.events.canvas3d.settingsUpdated,function(){return r.forceUpdate()}),this.subscribe(this.plugin.layout.events.updated,function(){return r.forceUpdate()})},t.prototype.icon=function(r,n,a,i){return i===void 0&&(i=!0),B(Zt,{svg:r,toggleState:i,onClick:n,title:a,style:{background:"transparent"}},void 0)},t.prototype.render=function(){return Pe("div",T({className:"msp-viewport-controls",onMouseMove:this.onMouseMove},{children:[Pe("div",T({className:"msp-viewport-controls-buttons"},{children:[Pe("div",{children:[B("div",{className:"msp-semi-transparent-background"},void 0),this.icon(xHe,this.resetCamera,"Reset Camera")]},void 0),Pe("div",{children:[B("div",{className:"msp-semi-transparent-background"},void 0),this.icon(IHe,this.toggleScreenshotExpanded,"Screenshot / State Snapshot",this.state.isScreenshotExpanded)]},void 0),Pe("div",{children:[B("div",{className:"msp-semi-transparent-background"},void 0),this.plugin.config.get(Qn.Viewport.ShowControls)&&this.icon(AHe,this.toggleControls,"Toggle Controls Panel",this.plugin.layout.state.showControls),this.plugin.config.get(Qn.Viewport.ShowExpand)&&this.icon(rje,this.toggleExpanded,"Toggle Expanded Viewport",this.plugin.layout.state.isExpanded),this.plugin.config.get(Qn.Viewport.ShowSettings)&&this.icon(vm,this.toggleSettingsExpanded,"Settings / Controls Info",this.state.isSettingsExpanded)]},void 0),this.plugin.config.get(Qn.Viewport.ShowSelectionMode)&&Pe("div",{children:[B("div",{className:"msp-semi-transparent-background"},void 0),B(w3,{},void 0)]},void 0)]}),void 0),this.state.isScreenshotExpanded&&B("div",T({className:"msp-viewport-controls-panel"},{children:B(Zc,T({header:"Screenshot / State",title:"Click to close.",initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.toggleScreenshotExpanded,topRightIcon:Qc,noTopMargin:!0,childrenClassName:"msp-viewport-controls-panel-controls"},{children:B(QWe,{close:this.toggleScreenshotExpanded},void 0)}),void 0)}),void 0),this.state.isSettingsExpanded&&B("div",T({className:"msp-viewport-controls-panel"},{children:B(Zc,T({header:"Settings / Controls Info",title:"Click to close.",initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.toggleSettingsExpanded,topRightIcon:Qc,noTopMargin:!0,childrenClassName:"msp-viewport-controls-panel-controls"},{children:B(tXe,{},void 0)}),void 0)}),void 0)]}),void 0)},t}(Sr),iXe=function(){return B("a",{className:"msp-logo",href:"https://molstar.org",target:"_blank"},void 0)},oXe=function(){return B(XWe,{logo:iXe},void 0)},sXe=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.region=function(r,n){return B("div",T({className:"msp-layout-region msp-layout-"+r},{children:B("div",T({className:"msp-layout-static"},{children:n}),void 0)}),void 0)},t.prototype.render=function(){return B(B_.Provider,T({value:this.props.plugin},{children:B(uXe,{},void 0)}),void 0)},t}(ke.exports.Component);(function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.render=function(){return B(B_.Provider,T({value:this.props.plugin},{children:B("div",T({className:"msp-plugin"},{children:this.props.children}),void 0)}),void 0)},t})(ke.exports.Component);var uXe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onDrop=function(n){n.preventDefault();var a;if(n.dataTransfer.items){for(var i=0;i<n.dataTransfer.items.length;i++)if(n.dataTransfer.items[i].kind==="file"){a=n.dataTransfer.items[i].getAsFile();break}}else a=n.dataTransfer.files[0];if(!!a){var o=a?.name.toLowerCase()||"";(o.endsWith("molx")||o.endsWith("molj"))&&Rt.State.Snapshots.OpenFile(r.plugin,{file:a})}},r.onDragOver=function(n){n.preventDefault()},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.layout.events.updated,function(){return r.forceUpdate()})},t.prototype.region=function(r,n){return B("div",T({className:"msp-layout-region msp-layout-"+r},{children:B("div",T({className:"msp-layout-static"},{children:n?B(n,{},void 0):null}),void 0)}),void 0)},Object.defineProperty(t.prototype,"layoutVisibilityClassName",{get:function(){var r,n,a=this.plugin.layout.state,i=(n=(r=this.plugin.spec.components)===null||r===void 0?void 0:r.controls)!==null&&n!==void 0?n:{},o=[];return(i.top==="none"||!a.showControls||a.regionState.top==="hidden")&&o.push("msp-layout-hide-top"),i.left==="none"||!a.showControls||a.regionState.left==="hidden"?o.push("msp-layout-hide-left"):a.regionState.left==="collapsed"&&o.push("msp-layout-collapse-left"),(i.right==="none"||!a.showControls||a.regionState.right==="hidden")&&o.push("msp-layout-hide-right"),(i.bottom==="none"||!a.showControls||a.regionState.bottom==="hidden")&&o.push("msp-layout-hide-bottom"),o.join(" ")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"layoutClassName",{get:function(){var r=this.plugin.layout.state,n=["msp-plugin-content"];return r.isExpanded?n.push("msp-layout-expanded"):n.push("msp-layout-standard","msp-layout-standard-"+r.controlsDisplay),n.join(" ")},enumerable:!1,configurable:!0}),t.prototype.render=function(){var r,n,a,i,o=this.plugin.layout.state,s=((r=this.plugin.spec.components)===null||r===void 0?void 0:r.controls)||{},u=((a=(n=this.plugin.spec.components)===null||n===void 0?void 0:n.viewport)===null||a===void 0?void 0:a.view)||cXe;return B("div",T({className:"msp-plugin",onDrop:this.onDrop,onDragOver:this.onDragOver},{children:Pe("div",T({className:this.layoutClassName},{children:[Pe("div",T({className:this.layoutVisibilityClassName},{children:[this.region("main",u),o.showControls&&s.top!=="none"&&this.region("top",s.top||VWe),o.showControls&&s.left!=="none"&&this.region("left",s.left||MWe),o.showControls&&s.right!=="none"&&this.region("right",s.right||lXe),o.showControls&&s.bottom!=="none"&&this.region("bottom",s.bottom||dXe)]}),void 0),!(!((i=this.plugin.spec.components)===null||i===void 0)&&i.hideTaskOverlay)&&B(GWe,{},void 0)]}),void 0)}),void 0)},t}(Sr),lXe=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.render=function(){var r,n=((r=this.plugin.spec.components)===null||r===void 0?void 0:r.structureTools)||vWe;return B("div",T({className:"msp-scrollable-container"},{children:B(n,{},void 0)}),void 0)},t}(Sr),cXe=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.render=function(){var r,n,a=((n=(r=this.plugin.spec.components)===null||r===void 0?void 0:r.viewport)===null||n===void 0?void 0:n.controls)||aXe;return Pe(Nt,{children:[B(oXe,{},void 0),Pe("div",T({className:"msp-viewport-top-left-controls"},{children:[B(fWe,{},void 0),B(cWe,{},void 0),B(dWe,{},void 0)]}),void 0),B(pWe,{},void 0),B(a,{},void 0),B(jWe,{},void 0),Pe("div",T({className:"msp-highlight-toast-wrapper"},{children:[B(hWe,{},void 0),B(WWe,{},void 0)]}),void 0)]},void 0)},t}(Sr),dXe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.wrapper=ke.exports.createRef(),r.state={entries:r.plugin.log.entries},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.events.log,function(){return r.setState({entries:r.plugin.log.entries})})},t.prototype.componentDidUpdate=function(){this.scrollToBottom()},t.prototype.scrollToBottom=function(){var r=this.wrapper.current;r&&(r.scrollTop=r.scrollHeight-r.clientHeight-1)},t.prototype.render=function(){for(var r=10,n=this.state.entries,a=n.size,i=[],o=Math.max(0,a-r),s=0;o<a;o++){var u=n.get(o);i.push(Pe("li",{children:[B("div",{className:"msp-log-entry-badge msp-log-entry-"+u.type},void 0),B("div",T({className:"msp-log-timestamp"},{children:dge(u.timestamp)}),void 0),B("div",T({className:"msp-log-entry"},{children:u.message}),void 0)]},s++))}return B("div",T({ref:this.wrapper,className:"msp-log",style:{position:"absolute",top:"0",right:"0",bottom:"0",left:"0",overflowY:"auto"}},{children:B("ul",T({className:"msp-list-unstyled"},{children:i}),void 0)}),void 0)},t}(Sr);function fXe(e,t,r,n){n===void 0&&(n=1),e.width=Math.round(window.devicePixelRatio*n*t),e.height=Math.round(window.devicePixelRatio*n*r),Object.assign(e.style,{width:t+"px",height:r+"px"})}function pXe(e,t,r){r===void 0&&(r=1);var n=window.innerWidth,a=window.innerHeight;t!==document.body&&(n=t.offsetWidth,a=t.offsetHeight),fXe(e,n,a,r)}function hXe(e,t,r,n){for(var a=atob(e.toDataURL(r,n).split(",")[1]),i=a.length,o=i>>2,s=new Uint8Array(i),u=new Uint32Array(s.buffer,0,o),l=0,c=0;c<o;++c)u[c]=a.charCodeAt(l++)|a.charCodeAt(l++)<<8|a.charCodeAt(l++)<<16|a.charCodeAt(l++)<<24;for(var d=i&3;d--;)s[l]=a.charCodeAt(l++);t(new Blob([s],{type:r||"image/png"}))}function Sz(e,t,r){return pe(this,void 0,void 0,function(){return he(this,function(n){return[2,new Promise(function(a,i){var o=function(s){s?a(s):i("no blob returned")};HTMLCanvasElement.prototype.toBlob?e.toBlob(o,t,r):hXe(e,o,t,r)})]})})}var E3;(function(e){var t=function(){function r(){this.providers=ma.exports.OrderedMap().asMutable(),this.defaultAutoAttachValues=new Map}return r.prototype.getParams=function(n){var a={},i=[],o=[];if(n)for(var s=this.providers.values();;){var u=s.next();if(u.done)break;var l=u.value;!l.isApplicable(n)||(l.isHidden||(i.push([l.descriptor.name,l.label]),this.defaultAutoAttachValues.get(l.descriptor.name)&&o.push(l.descriptor.name)),a[l.descriptor.name]=M.Group(T({},l.getParams(n)),{label:l.label,isHidden:l.isHidden}))}return{autoAttach:M.MultiSelect(o,i),properties:M.Group(a,{isFlat:!0})}},r.prototype.setDefaultAutoAttach=function(n,a){this.defaultAutoAttachValues.set(n,a)},r.prototype.get=function(n){var a=this.providers.get(n);if(!a)throw new Error("Custom property '"+n+"' is not registered.");return this.providers.get(n)},r.prototype.register=function(n,a){this.providers.set(n.descriptor.name,n),this.defaultAutoAttachValues.set(n.descriptor.name,a)},r.prototype.unregister=function(n){this.providers.delete(n),this.defaultAutoAttachValues.delete(n)},r}();e.Registry=t})(E3||(E3={}));var mXe=function(){function e(t){this.plugin=t}return Object.defineProperty(e.prototype,"dataState",{get:function(){return this.plugin.state.data},enumerable:!1,configurable:!0}),e.prototype.rawData=function(t,r){var n=this.dataState.build().toRoot().apply(vW,t,r);return n.commit({revertOnError:!0})},e.prototype.download=function(t,r){var n=this.dataState.build().toRoot().apply(hW,t,r);return n.commit({revertOnError:!0})},e.prototype.downloadBlob=function(t,r){var n=this.dataState.build().toRoot().apply(mW,t,r);return n.commit({revertOnError:!0})},e.prototype.readFile=function(t,r){var n;return pe(this,void 0,void 0,function(){var a,i;return he(this,function(o){switch(o.label){case 0:return[4,this.dataState.build().toRoot().apply(gW,t,r).commit({revertOnError:!0})];case 1:return a=o.sent(),i=cR(((n=t.file)===null||n===void 0?void 0:n.file)||""),[2,{data:a,fileInfo:i}]}})})},e}(),vXe=function(){function e(t){var r=this;this.plugin=t,this._providers=[],this.providerMap=new Map,this.defaultProvider=$v.auto,rl($v,function(n){return r.registerPreset(n)})}return Object.defineProperty(e.prototype,"dataState",{get:function(){return this.plugin.state.data},enumerable:!1,configurable:!0}),e.prototype.resolveProvider=function(t){var r;return typeof t=="string"?(r=$v[t])!==null&&r!==void 0?r:VD(this._providers,function(n){return n.id===t}):t},e.prototype.hasPreset=function(t){for(var r=0,n=this._providers;r<n.length;r++){var a=n[r];if(!a.isApplicable||a.isApplicable(t,this.plugin))return!0}return!1},Object.defineProperty(e.prototype,"providers",{get:function(){return this._providers},enumerable:!1,configurable:!0}),e.prototype.getPresets=function(t){if(!t)return this.providers;for(var r=[],n=0,a=this._providers;n<a.length;n++){var i=a[n];i.isApplicable&&!i.isApplicable(t,this.plugin)||r.push(i)}return r},e.prototype.getPresetSelect=function(t){for(var r=[],n=0,a=this._providers;n<a.length;n++){var i=a[n];t&&i.isApplicable&&!i.isApplicable(t,this.plugin)||r.push([i.id,i.display.name,i.display.group])}return M.Select("auto",r)},e.prototype.getPresetsWithOptions=function(t){for(var r=[],n=Object.create(null),a=0,i=this._providers;a<i.length;a++){var o=i[a];o.isApplicable&&!o.isApplicable(t,this.plugin)||(r.push([o.id,o.display.name]),n[o.id]=o.params?M.Group(o.params(t,this.plugin)):M.EmptyGroup())}return r.length===0?M.MappedStatic("",{"":M.EmptyGroup()}):M.MappedStatic(r[0][0],n,{options:r})},e.prototype.registerPreset=function(t){if(this.providerMap.has(t.id))throw new Error("Representation provider with id '"+t.id+"' already registered.");this._providers.push(t),this.providerMap.set(t.id,t)},e.prototype.unregisterPreset=function(t){this.providerMap.delete(t.id),A1(this._providers,t)},e.prototype.applyPreset=function(t,r,n){var a=this,i,o=this.resolveProvider(r);if(!!o){var s=this.plugin.state.data,u=Ka.resolveAndCheck(s,t);if(!u){R0||console.warn("Applying structure repr. provider to bad cell.");return}var l=((i=o.params)===null||i===void 0?void 0:i.call(o,u.obj,this.plugin))||{},c=n||(o.params?M.getDefaultValues(l):{}),d=this.plugin.config.get(Qn.Structure.DefaultRepresentationPresetParams);c=M.merge(l,d,c);var f=Qe.create(""+o.display.name,function(){return o.apply(u,c,a.plugin)});return this.plugin.runTask(f)}},e.prototype.addRepresentation=function(t,r,n){return pe(this,void 0,void 0,function(){var a,i;return he(this,function(o){switch(o.label){case 0:return a=this.dataState.build(),i=this.buildRepresentation(a,t,r,n),i?[4,a.commit()]:[2];case 1:return o.sent(),[2,i]}})})},e.prototype.buildRepresentation=function(t,r,n,a){var i,o;if(!!r){var s=(o=(i=Ka.resolveAndCheck(this.dataState,r))===null||i===void 0?void 0:i.obj)===null||o===void 0?void 0:o.data;if(!!s){var u=gS(this.plugin,s,n);return a?.tag?t.to(r).applyOrUpdateTagged(a.tag,e3,u,{state:a?.initialState}).selector:t.to(r).apply(e3,u,{state:a?.initialState}).selector}}},e}();function _p(e){return e}(function(e){e.CommonParams=function(t,r){return{modelProperties:M.Optional(M.Group(gt.getParamDefinition(lt.Model.CustomModelProperties,void 0,r))),structureProperties:M.Optional(M.Group(gt.getParamDefinition(lt.Model.CustomStructureProperties,void 0,r))),representationPreset:M.Optional(M.Text("auto"))}}})(_p||(_p={}));var L_=_p.CommonParams,gXe=function(e,t){return T({model:M.Optional(M.Group(gt.getParamDefinition(lt.Model.ModelFromTrajectory,e,t))),showUnitcell:M.Optional(M.Boolean(!1)),structure:M.Optional(Yh.getParams(void 0,"assembly").type),representationPresetParams:M.Optional(M.Group(xo.CommonParams))},L_(e,t))},pZ=_p({id:"preset-trajectory-default",display:{name:"Default (Assembly)",group:"Preset",description:"Shows the first assembly or, if that is unavailable, the first model."},isApplicable:function(e){return!0},params:gXe,apply:function(e,t,r){return pe(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c;return he(this,function(d){switch(d.label){case 0:return n=r.builders.structure,[4,n.createModel(e,t.model)];case 1:return a=d.sent(),[4,n.insertModelProperties(a,t.modelProperties)];case 2:return i=d.sent(),[4,n.createStructure(i||a,t.structure)];case 3:return o=d.sent(),[4,n.insertStructureProperties(o,t.structureProperties)];case 4:return s=d.sent(),t.showUnitcell===void 0||!!t.showUnitcell?[4,n.tryCreateUnitcell(i,void 0,{isHidden:!0})]:[3,6];case 5:return l=d.sent(),[3,7];case 6:l=void 0,d.label=7;case 7:return u=l,[4,r.builders.structure.representation.applyPreset(s,t.representationPreset||"auto",t.representationPresetParams)];case 8:return c=d.sent(),[2,{model:a,modelProperties:i,unitcell:u,structure:o,structureProperties:s,representation:c}]}})})}}),yXe=function(e,t){return T({useDefaultIfSingleModel:M.Optional(M.Boolean(!1)),representationPresetParams:M.Optional(M.Group(xo.CommonParams))},L_(e,t))},bXe=_p({id:"preset-trajectory-all-models",display:{name:"All Models",group:"Preset",description:"Shows all models; colored by model-index."},isApplicable:function(e){return e.data.frameCount>1},params:yXe,apply:function(e,t,r){var n,a;return pe(this,void 0,void 0,function(){var i,o,s,u,l,c,d,f,p,h;return he(this,function(m){switch(m.label){case 0:if(i=(a=(n=Ka.resolveAndCheck(r.state.data,e))===null||n===void 0?void 0:n.obj)===null||a===void 0?void 0:a.data,!i)return[2,{}];if(i.frameCount===1&&t.useDefaultIfSingleModel)return[2,pZ.apply(e,t,r)];o=r.builders.structure,s=[],u=[],l=0,m.label=1;case 1:return l<i.frameCount?[4,o.createModel(e,{modelIndex:l})]:[3,8];case 2:return c=m.sent(),[4,o.insertModelProperties(c,t.modelProperties,{isCollapsed:!0})];case 3:return d=m.sent(),[4,o.createStructure(d||c,{name:"model",params:{}})];case 4:return f=m.sent(),[4,o.insertStructureProperties(f,t.structureProperties)];case 5:return p=m.sent(),s.push(c),u.push(f),h=f.obj?PK(f.obj.data,{elementCountFactor:i.frameCount}):"medium",[4,o.representation.applyPreset(p,t.representationPreset||"auto",{theme:{globalName:"model-index"},quality:h})];case 6:m.sent(),m.label=7;case 7:return l++,[3,1];case 8:return[2,{models:s,structures:u}]}})})}}),hZ=function(e,t){return T({model:M.Optional(M.Group(gt.getParamDefinition(lt.Model.ModelFromTrajectory,e,t)))},L_(e,t))};function mZ(e,t,r,n){return pe(this,void 0,void 0,function(){var a,i,o,s,u,l,c;return he(this,function(d){switch(d.label){case 0:return a=n.builders.structure,[4,a.createModel(t,r.model)];case 1:return i=d.sent(),[4,a.insertModelProperties(i,r.modelProperties)];case 2:return o=d.sent(),[4,a.createStructure(o||i,{name:"symmetry",params:e})];case 3:return s=d.sent(),[4,a.insertStructureProperties(s,r.structureProperties)];case 4:return u=d.sent(),[4,a.tryCreateUnitcell(o,void 0,{isHidden:!1})];case 5:return l=d.sent(),[4,n.builders.structure.representation.applyPreset(u,r.representationPreset||"auto",{theme:{globalName:e.theme}})];case 6:return c=d.sent(),[2,{model:i,modelProperties:o,unitcell:l,structure:s,structureProperties:u,representation:c}]}})})}var xXe=_p({id:"preset-trajectory-unitcell",display:{name:"Unit Cell",group:"Preset",description:"Shows the fully populated unit cell."},isApplicable:function(e){return rr.hasCrystalSymmetry(e.data.representative)},params:hZ,apply:function(e,t,r){return pe(this,void 0,void 0,function(){return he(this,function(n){switch(n.label){case 0:return[4,mZ({ijkMin:A.create(0,0,0),ijkMax:A.create(0,0,0)},e,t,r)];case 1:return[2,n.sent()]}})})}}),SXe=_p({id:"preset-trajectory-supercell",display:{name:"Super Cell",group:"Preset",description:"Shows the super cell, i.e. the central unit cell and all adjacent unit cells."},isApplicable:function(e){return rr.hasCrystalSymmetry(e.data.representative)},params:hZ,apply:function(e,t,r){return pe(this,void 0,void 0,function(){return he(this,function(n){switch(n.label){case 0:return[4,mZ({ijkMin:A.create(-1,-1,-1),ijkMax:A.create(1,1,1),theme:"operator-hkl"},e,t,r)];case 1:return[2,n.sent()]}})})}}),CXe=function(e,t){return T({model:M.Optional(M.Group(gt.getParamDefinition(lt.Model.ModelFromTrajectory,e,t)))},L_(e,t))},wXe=_p({id:"preset-trajectory-crystal-contacts",display:{name:"Crystal Contacts",group:"Preset",description:"Showsasymetric unit and chains from neighbours within 5 \u212B, i.e., symmetry mates."},isApplicable:function(e){return rr.hasCrystalSymmetry(e.data.representative)},params:CXe,apply:function(e,t,r){return pe(this,void 0,void 0,function(){var n,a,i,o,s,u,l;return he(this,function(c){switch(c.label){case 0:return n=r.builders.structure,[4,n.createModel(e,t.model)];case 1:return a=c.sent(),[4,n.insertModelProperties(a,t.modelProperties)];case 2:return i=c.sent(),[4,n.createStructure(i||a,{name:"symmetry-mates",params:{radius:5}})];case 3:return o=c.sent(),[4,n.insertStructureProperties(o,t.structureProperties)];case 4:return s=c.sent(),[4,n.tryCreateUnitcell(i,void 0,{isHidden:!0})];case 5:return u=c.sent(),[4,r.builders.structure.representation.applyPreset(s,t.representationPreset||"auto",{theme:{globalName:"operator-name",carbonColor:"operator-name",focus:{name:"element-symbol",params:{carbonColor:{name:"operator-name",params:Uk.defaultValues}}}}})];case 6:return l=c.sent(),[2,{model:a,modelProperties:i,unitcell:u,structure:o,structureProperties:s,representation:l}]}})})}}),TT={default:pZ,"all-models":bXe,unitcell:xXe,supercell:SXe,crystalContacts:wXe},_Xe=function(){function e(t){var r=this;this.plugin=t,this._providers=[],this.providerMap=new Map,this.defaultProvider=TT.default,rl(TT,function(n){return r.registerPreset(n)})}return e.prototype.resolveProvider=function(t){var r;return typeof t=="string"?(r=TT[t])!==null&&r!==void 0?r:VD(this._providers,function(n){return n.id===t}):t},e.prototype.hasPreset=function(t){for(var r=0,n=this._providers;r<n.length;r++){var a=n[r];if(!a.isApplicable||a.isApplicable(t,this.plugin))return!0}return!1},Object.defineProperty(e.prototype,"providers",{get:function(){return this._providers},enumerable:!1,configurable:!0}),e.prototype.getPresets=function(t){if(!t)return this.providers;for(var r=[],n=0,a=this._providers;n<a.length;n++){var i=a[n];i.isApplicable&&!i.isApplicable(t,this.plugin)||r.push(i)}return r},e.prototype.getPresetSelect=function(t){for(var r=[],n=0,a=this._providers;n<a.length;n++){var i=a[n];t&&i.isApplicable&&!i.isApplicable(t,this.plugin)||r.push([i.id,i.display.name])}return M.Select("auto",r)},e.prototype.getPresetsWithOptions=function(t){for(var r=[],n=Object.create(null),a=0,i=this._providers;a<i.length;a++){var o=i[a];o.isApplicable&&!o.isApplicable(t,this.plugin)||(r.push([o.id,o.display.name]),n[o.id]=o.params?M.Group(o.params(t,this.plugin)):M.EmptyGroup())}return r.length===0?M.MappedStatic("",{"":M.EmptyGroup()}):M.MappedStatic(r[0][0],n,{options:r})},e.prototype.registerPreset=function(t){if(this.providerMap.has(t.id))throw new Error("Hierarchy provider with id '"+t.id+"' already registered.");this._providers.push(t),this.providerMap.set(t.id,t)},e.prototype.unregisterPreset=function(t){this.providerMap.delete(t.id),A1(this._providers,t)},e.prototype.applyPreset=function(t,r,n){var a=this,i=this.resolveProvider(r);if(!!i){var o=this.plugin.state.data,s=Ka.resolveAndCheck(o,t);if(!s){R0||console.warn("Applying hierarchy preset provider to bad cell.");return}var u=n||(i.params?M.getDefaultValues(i.params(s.obj,this.plugin)):{}),l=Qe.create(""+i.display.name,function(){return i.apply(s,u,a.plugin)});return this.plugin.runTask(l)}},e}(),AXe=function(){function e(t){this.plugin=t,this.hierarchy=new _Xe(this.plugin),this.representation=new vXe(this.plugin)}return Object.defineProperty(e.prototype,"dataState",{get:function(){return this.plugin.state.data},enumerable:!1,configurable:!0}),e.prototype.parseTrajectoryData=function(t,r){return pe(this,void 0,void 0,function(){var n,a;return he(this,function(i){switch(i.label){case 0:if(n=typeof r=="string"?this.plugin.dataFormats.get(r):r,!n)throw new Error("'"+r+"' is not a supported data format.");return[4,n.parse(this.plugin,t)];case 1:return a=i.sent().trajectory,[2,a]}})})},e.prototype.parseTrajectoryBlob=function(t,r){var n=this.dataState,a=n.build().to(t).apply(lt.Data.ParseBlob,r,{state:{isGhost:!0}}).apply(lt.Model.TrajectoryFromBlob,void 0);return a.commit({revertOnError:!0})},e.prototype.parseTrajectory=function(t,r){var n=Ka.resolveAndCheck(this.dataState,t);if(!n)throw new Error("Invalid data cell.");return be.Data.Blob.is(n.obj)?this.parseTrajectoryBlob(t,r):this.parseTrajectoryData(t,r)},e.prototype.createModel=function(t,r,n){var a=this.dataState,i=a.build().to(t).apply(lt.Model.ModelFromTrajectory,r||{modelIndex:0},{state:n});return i.commit({revertOnError:!0})},e.prototype.insertModelProperties=function(t,r,n){var a=this.dataState,i=a.build().to(t).apply(lt.Model.CustomModelProperties,r,{state:n});return i.commit({revertOnError:!0})},e.prototype.tryCreateUnitcell=function(t,r,n){var a,i,o,s=this.dataState,u=(i=(a=Ka.resolveAndCheck(s,t))===null||a===void 0?void 0:a.obj)===null||i===void 0?void 0:i.data;if(!!u){var l=(o=wa.Provider.get(u))===null||o===void 0?void 0:o.spacegroup.cell;if(!Go.isZero(l)){var c=s.build().to(t).apply(lt.Representation.ModelUnitcell3D,r,{state:n});return c.commit({revertOnError:!0})}}},e.prototype.createStructure=function(t,r,n){var a,i=this.dataState;if(!r){var o=Ka.resolveAndCheck(i,t);if(o){var s=wa.Provider.get((a=o.obj)===null||a===void 0?void 0:a.data);(!s||s?.assemblies.length===0)&&(r={name:"model",params:{}})}}var u=i.build().to(t).apply(lt.Model.StructureFromModel,{type:r||{name:"assembly",params:{}}},{state:n});return u.commit({revertOnError:!0})},e.prototype.insertStructureProperties=function(t,r){var n=this.dataState,a=n.build().to(t).apply(lt.Model.CustomStructureProperties,r);return a.commit({revertOnError:!0})},e.prototype.isComponentTransform=function(t){return t.transform.transformer===lt.Model.StructureComponent},e.prototype.tryCreateComponent=function(t,r,n,a){var i,o;return pe(this,void 0,void 0,function(){var s,u,l,c,d;return he(this,function(f){switch(f.label){case 0:return s=this.dataState,u=s.build().to(t),l="structure-component-"+n,c=u.applyOrUpdateTagged(l,lt.Model.StructureComponent,r,{tags:a?Gt(Gt([],a),[l]):[l]}),[4,c.commit()];case 1:return f.sent(),d=c.selector,!d.isOk||((o=(i=d.cell)===null||i===void 0?void 0:i.obj)===null||o===void 0?void 0:o.data.elementCount)===0?[4,s.build().delete(d.ref).commit()]:[3,3];case 2:return f.sent(),[2];case 3:return[2,d]}})})},e.prototype.tryCreateComponentFromExpression=function(t,r,n,a){return this.tryCreateComponent(t,{type:{name:"expression",params:r},nullIfEmpty:!0,label:(a?.label||"").trim()},n,a?.tags)},e.prototype.tryCreateComponentStatic=function(t,r,n){return this.tryCreateComponent(t,{type:{name:"static",params:r},nullIfEmpty:!0,label:(n?.label||"").trim()},"static-"+r,n?.tags)},e.prototype.tryCreateComponentFromSelection=function(t,r,n,a){var i=this;return this.plugin.runTask(Qe.create("Query Component",function(o){return pe(i,void 0,void 0,function(){var s,u,l,c,d,f,p,h,m,v,g,y;return he(this,function(b){switch(b.label){case 0:return s=a||{},u=s.label,l=s.tags,u=(u||"").trim(),c=(y=(g=Ka.resolveAndCheck(this.dataState,t))===null||g===void 0?void 0:g.obj)===null||y===void 0?void 0:y.data,c?r.referencesCurrent?(m={},v={name:"bundle"},h=(p=sn).fromSelection,[4,r.getSelection(this.plugin,o,c)]):[3,2]:[2];case 1:return f=(m.type=(v.params=h.apply(p,[b.sent()]),v),m.nullIfEmpty=!0,m.label=u||r.label,m),[3,3];case 2:f={type:{name:"expression",params:r.expression},nullIfEmpty:!0,label:u||r.label},b.label=3;case 3:return d=f,r.ensureCustomProperties?[4,r.ensureCustomProperties({runtime:o,assetManager:this.plugin.managers.asset},c)]:[3,5];case 4:b.sent(),b.label=5;case 5:return[2,this.tryCreateComponent(t,d,n,l)]}})})}))},e}(),zI;(function(e){function t(r){var n=r.name;return{descriptor:r,get:function(a){return a._propertyData[n]},set:function(a,i){a.customProperties.add(r),a._propertyData[n]=i}}}e.create=t})(zI||(zI={}));var P3;(function(e){e.Descriptor={name:"recommended_iso_value"},e.Provider=zI.create(e.Descriptor)})(P3||(P3={}));var Db="Volume";function kb(e,t){return pe(this,void 0,void 0,function(){var r,n=this;return he(this,function(a){return t?(r=t.entryId,!r||!r.toLowerCase().startsWith("emd")?[2]:[2,e.runTask(Qe.create("Try Set Recommended IsoValue",function(i){return pe(n,void 0,void 0,function(){var o;return he(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,pQ(e,i,r)];case 1:return o=s.sent(),P3.Provider.set(t,It.IsoValue.absolute(o)),[3,3];case 2:return s.sent(),[3,3];case 3:return[2]}})})}))]):[2]})})}function vZ(e){var t=P3.Provider.get(e);if(!!t){if(t.kind==="relative")return t;var r=e.grid.stats;return $C.is(e.sourceData)&&(r={min:e.sourceData.data.volume_data_3d_info.min_source.value(0),max:e.sourceData.data.volume_data_3d_info.max_source.value(0),mean:e.sourceData.data.volume_data_3d_info.mean_source.value(0),sigma:e.sourceData.data.volume_data_3d_info.sigma_source.value(0)}),It.IsoValue.toRelative(t,r)}}function RR(e,t){return pe(this,void 0,void 0,function(){var r,n,a;return he(this,function(i){switch(i.label){case 0:return r={},n=t.volume.data&&vZ(t.volume.data),n&&(r.isoValue=n),a=e.build().to(t.volume).apply(lt.Representation.VolumeRepresentation3D,Jv(e,t.volume.data,{type:"isosurface",typeParams:r})),[4,a.commit()];case 1:return[2,[i.sent()]]}})})}var TXe={label:"CCP4/MRC/MAP",description:"CCP4/MRC/MAP",category:Db,binaryExtensions:["ccp4","mrc","map"],parse:function(e,t,r){return pe(void 0,void 0,void 0,function(){var n,a;return he(this,function(i){switch(i.label){case 0:return n=e.build().to(t).apply(lt.Data.ParseCcp4,{},{state:{isGhost:!0}}),a=n.apply(lt.Volume.VolumeFromCcp4,{entryId:r?.entryId}),[4,n.commit({revertOnError:!0})];case 1:return i.sent(),[4,kb(e,a.selector.data)];case 2:return i.sent(),[2,{format:n.selector,volume:a.selector}]}})})},visuals:RR},EXe={label:"DSN6/BRIX",description:"DSN6/BRIX",category:Db,binaryExtensions:["dsn6","brix"],parse:function(e,t,r){return pe(void 0,void 0,void 0,function(){var n,a;return he(this,function(i){switch(i.label){case 0:return n=e.build().to(t).apply(lt.Data.ParseDsn6,{},{state:{isGhost:!0}}),a=n.apply(lt.Volume.VolumeFromDsn6,{entryId:r?.entryId}),[4,n.commit({revertOnError:!0})];case 1:return i.sent(),[4,kb(e,a.selector.data)];case 2:return i.sent(),[2,{format:n.selector,volume:a.selector}]}})})},visuals:RR},PXe={label:"DX",description:"DX",category:Db,stringExtensions:["dx"],binaryExtensions:["dxbin"],parse:function(e,t,r){return pe(void 0,void 0,void 0,function(){var n,a;return he(this,function(i){switch(i.label){case 0:return n=e.build().to(t).apply(lt.Data.ParseDx,{},{state:{isGhost:!0}}),a=n.apply(lt.Volume.VolumeFromDx,{entryId:r?.entryId}),[4,a.commit({revertOnError:!0})];case 1:return i.sent(),[4,kb(e,a.selector.data)];case 2:return i.sent(),[2,{volume:a.selector}]}})})},visuals:RR},IXe={label:"Cube",description:"Cube",category:Db,stringExtensions:["cub","cube"],parse:function(e,t,r){return pe(void 0,void 0,void 0,function(){var n,a,i;return he(this,function(o){switch(o.label){case 0:return n=e.build().to(t).apply(lt.Data.ParseCube,{},{state:{isGhost:!0}}),a=n.apply(lt.Volume.VolumeFromCube,{entryId:r?.entryId}),i=n.apply(lt.Model.TrajectoryFromCube,void 0,{state:{isGhost:!0}}).apply(lt.Model.ModelFromTrajectory).apply(lt.Model.StructureFromModel),[4,n.commit({revertOnError:!0})];case 1:return o.sent(),[4,kb(e,a.selector.data)];case 2:return o.sent(),[2,{format:n.selector,volume:a.selector,structure:i.selector}]}})})},visuals:function(e,t){return pe(void 0,void 0,void 0,function(){var r,n,a,i,o,s,u,l,c,d;return he(this,function(f){switch(f.label){case 0:return r=e.build(),n=[],a=(d=(c=t.volume.cell)===null||c===void 0?void 0:c.obj)===null||d===void 0?void 0:d.data,a&&It.isOrbitals(a)?(i=r.to(t.volume).apply(lt.Representation.VolumeRepresentation3D,Jv(e,a,{type:"isosurface",typeParams:{isoValue:It.IsoValue.relative(1),alpha:.4},color:"uniform",colorParams:{value:gr.blue}})),o=r.to(t.volume).apply(lt.Representation.VolumeRepresentation3D,Jv(e,a,{type:"isosurface",typeParams:{isoValue:It.IsoValue.relative(-1),alpha:.4},color:"uniform",colorParams:{value:gr.red}})),n.push(i.selector,o.selector)):(s=r.to(t.volume).apply(lt.Representation.VolumeRepresentation3D,Jv(e,a,{type:"isosurface",typeParams:{isoValue:It.IsoValue.relative(2),alpha:.4},color:"uniform",colorParams:{value:gr.grey}})),n.push(s.selector)),[4,e.builders.structure.representation.applyPreset(t.structure,"auto")];case 1:return u=f.sent(),[4,r.commit()];case 2:return f.sent(),l=[],rl(u?.representations,function(p){p&&l.push(p)}),[2,Gt(Gt([],n),l)]}})})}},MXe={label:"DensityServer CIF",description:"DensityServer CIF",category:Db,stringExtensions:["cif"],binaryExtensions:["bcif"],isApplicable:function(e,t){return lR(e,t)==="dscif"},parse:function(e,t,r){return pe(void 0,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d,f,p,h;return he(this,function(m){switch(m.label){case 0:return[4,e.build().to(t).apply(lt.Data.ParseCif).commit()];case 1:if(n=m.sent(),a=e.build().to(n),i=n.obj.data.blocks.slice(1),i.length!==1&&i.length!==2)throw new Error("unknown number of blocks");for(o=[],s=0,u=0,l=i;u<l.length;u++)c=l[u],d=Array.isArray(r?.entryId)?r?.entryId[s]:r?.entryId,o.push(a.apply(lt.Volume.VolumeFromDensityServerCif,{blockHeader:c.header,entryId:d}).selector),s++;return[4,a.commit()];case 2:m.sent(),f=0,p=o,m.label=3;case 3:return f<p.length?(h=p[f],[4,kb(e,h.data)]):[3,6];case 4:m.sent(),m.label=5;case 5:return f++,[3,3];case 6:return[2,{volumes:o}]}})})},visuals:function(e,t){return pe(void 0,void 0,void 0,function(){var r,n,a,i,o,s;return he(this,function(u){switch(u.label){case 0:return r=t.volumes,n=e.build(),a=[],r.length>0&&(i=r[0].data&&vZ(r[0].data)||It.IsoValue.relative(1.5),a[0]=n.to(r[0]).apply(lt.Representation.VolumeRepresentation3D,nd.getDefaultParamsStatic(e,"isosurface",{isoValue:i,alpha:1},"uniform",{value:gr.teal})).selector),r.length>1&&(o=nd.getDefaultParamsStatic(e,"isosurface",{isoValue:It.IsoValue.relative(3),alpha:.3},"uniform",{value:gr.green}),s=nd.getDefaultParamsStatic(e,"isosurface",{isoValue:It.IsoValue.relative(-3),alpha:.3},"uniform",{value:gr.red}),a[a.length]=n.to(r[1]).apply(lt.Representation.VolumeRepresentation3D,o).selector,a[a.length]=n.to(r[1]).apply(lt.Representation.VolumeRepresentation3D,s).selector),[4,n.commit()];case 1:return u.sent(),[2,a]}})})}},DXe=[["ccp4",TXe],["dsn6",EXe],["cube",IXe],["dx",PXe],["dscif",MXe]],kXe="Shape",RXe={label:"PLY",description:"PLY",category:kXe,stringExtensions:["ply"],parse:function(e,t){return pe(void 0,void 0,void 0,function(){var r,n;return he(this,function(a){switch(a.label){case 0:return r=e.state.data.build().to(t).apply(lt.Data.ParsePly,{},{state:{isGhost:!0}}),n=r.apply(lt.Model.ShapeFromPly),[4,r.commit()];case 1:return a.sent(),[2,{format:r.selector,shape:n.selector}]}})})},visuals:function(e,t){var r=e.state.data.build().to(t.shape).apply(lt.Representation.ShapeRepresentation3D);return r.commit()}},OXe=[["ply",RXe]],OR="Structure",BXe={label:"PSF",description:"PSF",category:OR,stringExtensions:["psf"],parse:function(e,t){return pe(void 0,void 0,void 0,function(){var r,n;return he(this,function(a){switch(a.label){case 0:return r=e.state.data.build().to(t).apply(lt.Data.ParsePsf,{},{state:{isGhost:!0}}),n=r.apply(lt.Model.TopologyFromPsf),[4,r.commit()];case 1:return a.sent(),[2,{format:r.selector,topology:n.selector}]}})})}},FXe={label:"DCD",description:"DCD",category:OR,binaryExtensions:["dcd"],parse:function(e,t){var r=e.state.data.build().to(t).apply(lt.Model.CoordinatesFromDcd);return r.commit()}},LXe={label:"XTC",description:"XTC",category:OR,binaryExtensions:["xtc"],parse:function(e,t){var r=e.state.data.build().to(t).apply(lt.Model.CoordinatesFromXtc);return r.commit()}},NXe=[["psf",BXe],["dcd",FXe],["xtc",LXe]],zXe=function(){function e(){this._list=[],this._map=new Map,this._extensions=void 0,this._binaryExtensions=void 0,this._options=void 0;for(var t=0,r=DXe;t<r.length;t++){var n=r[t],a=n[0],i=n[1];this.add(a,i)}for(var o=0,s=NXe;o<s.length;o++){var u=s[o],a=u[0],i=u[1];this.add(a,i)}for(var l=0,c=OXe;l<c.length;l++){var d=c[l],a=d[0],i=d[1];this.add(a,i)}for(var f=0,p=cQ;f<p.length;f++){var h=p[f],a=h[0],i=h[1];this.add(a,i)}}return Object.defineProperty(e.prototype,"types",{get:function(){return this._list.map(function(t){return[t.name,t.provider.label]})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"extensions",{get:function(){if(this._extensions)return this._extensions;var t=new Set;return this._list.forEach(function(r){var n,a,i=r.provider;(n=i.stringExtensions)===null||n===void 0||n.forEach(function(o){return t.add(o)}),(a=i.binaryExtensions)===null||a===void 0||a.forEach(function(o){return t.add(o)})}),this._extensions=t,t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"binaryExtensions",{get:function(){if(this._binaryExtensions)return this._binaryExtensions;var t=new Set;return this._list.forEach(function(r){var n,a=r.provider;return(n=a.binaryExtensions)===null||n===void 0?void 0:n.forEach(function(i){return t.add(i)})}),this._binaryExtensions=t,t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"options",{get:function(){if(this._options)return this._options;var t=[];return this._list.forEach(function(r){var n=r.name,a=r.provider;return t.push([n,a.label,a.category||""])}),this._options=t,t},enumerable:!1,configurable:!0}),e.prototype._clear=function(){this._extensions=void 0,this._binaryExtensions=void 0,this._options=void 0},e.prototype.add=function(t,r){this._clear(),this._list.push({name:t,provider:r}),this._map.set(t,r)},e.prototype.remove=function(t){this._clear(),this._list.splice(this._list.findIndex(function(r){return r.name===t}),1),this._map.delete(t)},e.prototype.auto=function(t,r){for(var n=0,a=this.list.length;n<a;++n){var i=this._list[n].provider,o=!1;if((i.binaryExtensions&&i.binaryExtensions.indexOf(t.ext)>=0||i.stringExtensions&&i.stringExtensions.indexOf(t.ext)>=0)&&(o=!0),o&&(!i.isApplicable||i.isApplicable(t,r.data)))return i}},e.prototype.get=function(t){if(this._map.has(t))return this._map.get(t);throw new Error("unknown data format name '"+t+"'")},Object.defineProperty(e.prototype,"list",{get:function(){return this._list},enumerable:!1,configurable:!0}),e}(),UXe=function(e){Le(t,e);function t(r){var n=e.call(this,{params:{current:""},animationState:"stopped"})||this;return n.context=r,n.map=new Map,n._animations=[],n.currentTime=0,n._params=void 0,n.events={updated:n.ev(),applied:n.ev()},n.isStopped=!0,n.isApplying=!1,n}return Object.defineProperty(t.prototype,"isEmpty",{get:function(){return this._animations.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"current",{get:function(){return this._current},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"animations",{get:function(){return this._animations},enumerable:!1,configurable:!0}),t.prototype.triggerUpdate=function(){this.events.updated.next()},t.prototype.triggerApply=function(){this.events.applied.next()},t.prototype.getParams=function(){return this._params||(this._params={current:M.Select(this._animations[0]&&this._animations[0].name,this._animations.map(function(r){return[r.name,r.display.name]}),{label:"Animation"})}),this._params},t.prototype.updateParams=function(r){if(!this.isEmpty){this.updateState({params:T(T({},this.state.params),r)});var n=this.map.get(this.state.params.current),a=n.params(this.context);this._current={anim:n,params:a,paramValues:M.getDefaultValues(a),state:{},startedTime:-1,lastTime:0},this.triggerUpdate()}},t.prototype.updateCurrentParams=function(r){this.isEmpty||(this._current.paramValues=T(T({},this._current.paramValues),r),this.triggerUpdate())},t.prototype.register=function(r){if(this.map.has(r.name)){this.context.log.error("Animation '"+r.name+"' is already registered.");return}this._params=void 0,this.map.set(r.name,r),this._animations.push(r),this._animations.length===1?this.updateParams({current:r.name}):this.triggerUpdate()},t.prototype.play=function(r,n){return pe(this,void 0,void 0,function(){return he(this,function(a){switch(a.label){case 0:return[4,this.stop()];case 1:return a.sent(),this.map.has(r.name)||this.register(r),this.updateParams({current:r.name}),this.updateCurrentParams(n),[4,this.start()];case 2:return a.sent(),[2]}})})},t.prototype.tick=function(r,n){return pe(this,void 0,void 0,function(){return he(this,function(a){switch(a.label){case 0:return this.currentTime=r,this.isStopped?[2]:n?[4,this.applyFrame()]:[3,2];case 1:return a.sent(),[3,3];case 2:this.applyAsync(),a.label=3;case 3:return[2]}})})},t.prototype.start=function(){return pe(this,void 0,void 0,function(){var r,n,a;return he(this,function(i){switch(i.label){case 0:return this.updateState({animationState:"playing"}),this.context.behaviors.state.isAnimating.value||this.context.behaviors.state.isAnimating.next(!0),this.triggerUpdate(),r=this._current.anim,n=this._current.anim.initialState(this._current.paramValues,this.context),r.setup?[4,r.setup(this._current.paramValues,n,this.context)]:[3,2];case 1:a=i.sent(),a&&(n=a),i.label=2;case 2:return this._current.lastTime=0,this._current.startedTime=-1,this._current.state=n,this.isStopped=!1,[2]}})})},t.prototype.stop=function(){return pe(this,void 0,void 0,function(){var r;return he(this,function(n){switch(n.label){case 0:return this.isStopped=!0,this.state.animationState==="stopped"?[3,3]:(r=this._current.anim,r.teardown?[4,r.teardown(this._current.paramValues,this._current.state,this.context)]:[3,2]);case 1:n.sent(),n.label=2;case 2:this.updateState({animationState:"stopped"}),this.triggerUpdate(),n.label=3;case 3:return this.context.behaviors.state.isAnimating.value&&this.context.behaviors.state.isAnimating.next(!1),[2]}})})},Object.defineProperty(t.prototype,"isAnimating",{get:function(){return this.state.animationState==="playing"},enumerable:!1,configurable:!0}),t.prototype.applyAsync=function(){return pe(this,void 0,void 0,function(){return he(this,function(r){switch(r.label){case 0:if(this.isApplying)return[2];this.isApplying=!0,r.label=1;case 1:return r.trys.push([1,,3,4]),[4,this.applyFrame()];case 2:return r.sent(),[3,4];case 3:return this.isApplying=!1,[7];case 4:return[2]}})})},t.prototype.applyFrame=function(){return pe(this,void 0,void 0,function(){var r,n;return he(this,function(a){switch(a.label){case 0:return r=this.currentTime,this._current.startedTime<0&&(this._current.startedTime=r),[4,this._current.anim.apply(this._current.state,{lastApplied:this._current.lastTime,current:r-this._current.startedTime},{params:this._current.paramValues,plugin:this.context})];case 1:return n=a.sent(),n.kind==="finished"?this.stop():n.kind==="next"&&(this._current.state=n.state,this._current.lastTime=r-this._current.startedTime),this.triggerApply(),[2]}})})},t.prototype.getSnapshot=function(){return this.current?{state:this.state,current:{paramValues:this._current.paramValues,state:this._current.anim.stateSerialization?this._current.anim.stateSerialization.toJSON(this._current.state):this._current.state}}:{state:this.state}},t.prototype.setSnapshot=function(r){this.isEmpty||(this.updateState({animationState:r.state.animationState}),this.updateParams(r.state.params),r.current&&(this.current.paramValues=r.current.paramValues,this.current.state=this._current.anim.stateSerialization?this._current.anim.stateSerialization.fromJSON(r.current.state):r.current.state,this.triggerUpdate(),this.state.animationState==="playing"&&this.resume()))},t.prototype.resume=function(){return pe(this,void 0,void 0,function(){var r;return he(this,function(n){switch(n.label){case 0:return this._current.lastTime=0,this._current.startedTime=-1,r=this._current.anim,this.context.behaviors.state.isAnimating.value||this.context.behaviors.state.isAnimating.next(!0),r.setup?[4,r.setup(this._current.paramValues,this._current.state,this.context)]:[3,2];case 1:n.sent(),n.label=2;case 2:return this.isStopped=!1,[2]}})})},t}(Gd),VXe={minRadius:5,extraRadius:4,durationMs:250},HXe=function(){function e(t){this.plugin=t,this.boundaryHelper=new Ms("98")}return e.prototype.transformedLoci=function(t){var r,n;if(Oe.is(t)){var a=(n=(r=this.plugin.helpers.substructureParent.get(t.structure))===null||r===void 0?void 0:r.obj)===null||n===void 0?void 0:n.data;a&&(t=Oe.remap(t,a))}return t},e.prototype.focusRenderObjects=function(t,r){if(!!t){for(var n=[],a=0,i=t;a<i.length;a++){var o=i[a],s=o.values.boundingSphere.ref.value;s.radius!==0&&n.push(s)}this.focusSpheres(n,function(u){return u},r)}},e.prototype.focusLoci=function(t,r){var n;if(Array.isArray(t)&&t.length>1){for(var a=[],i=0,o=t;i<o.length;i++){var s=o[i],u=cr.getBoundingSphere(this.transformedLoci(s));u&&a.push(u)}if(a.length===0)return;this.boundaryHelper.reset();for(var l=0,c=a;l<c.length;l++){var u=c[l];this.boundaryHelper.includeSphere(u)}this.boundaryHelper.finishedIncludeStep();for(var d=0,f=a;d<f.length;d++){var u=f[d];this.boundaryHelper.radiusSphere(u)}n=this.boundaryHelper.getSphere()}else if(Array.isArray(t)){if(t.length===0)return;n=cr.getBoundingSphere(this.transformedLoci(t[0]))}else n=cr.getBoundingSphere(this.transformedLoci(t));n&&this.focusSphere(n,r)},e.prototype.focusSpheres=function(t,r,n){for(var a=[],i=0,o=t;i<o.length;i++){var s=o[i],u=r(s);u&&a.push(u)}if(a.length!==0){if(a.length===1)return this.focusSphere(a[0],n);this.boundaryHelper.reset();for(var l=0,c=a;l<c.length;l++){var u=c[l];this.boundaryHelper.includeSphere(u)}this.boundaryHelper.finishedIncludeStep();for(var d=0,f=a;d<f.length;d++){var u=f[d];this.boundaryHelper.radiusSphere(u)}this.focusSphere(this.boundaryHelper.getSphere(),n)}},e.prototype.focusSphere=function(t,r){var n,a,i,o,s=T(T({},VXe),r),u=s.extraRadius,l=s.minRadius,c=s.durationMs,d=Math.max(t.radius+u,l);if(r?.principalAxes){var f=r?.principalAxes.boxAxes,p=f.origin,h=f.dirA,m=f.dirC,v=(n=this.plugin.canvas3d)===null||n===void 0?void 0:n.camera.getFocus(p,d,h,m);(a=this.plugin.canvas3d)===null||a===void 0||a.requestCameraReset({durationMs:c,snapshot:v})}else{var v=(i=this.plugin.canvas3d)===null||i===void 0?void 0:i.camera.getFocus(t.center,d);(o=this.plugin.canvas3d)===null||o===void 0||o.requestCameraReset({durationMs:c,snapshot:v})}},e.prototype.setSnapshot=function(t,r){var n;(n=this.plugin.canvas3d)===null||n===void 0||n.requestCameraReset({snapshot:t,durationMs:r})},e.prototype.reset=function(t,r){var n;(n=this.plugin.canvas3d)===null||n===void 0||n.requestCameraReset({snapshot:t,durationMs:r})},e}(),jXe=function(){function e(t){var r=this;this.ctx=t,this.providers=[],this.locis=[],this.isDirty=!1,this.labels=[],this.groupedLabels=new Map,t.managers.interactivity.lociHighlights.addProvider(function(n,a){r.mark(n,a),r.showLabels()})}return e.prototype.clearProviders=function(){this.providers=[],this.isDirty=!0,this.showLabels()},e.prototype.addProvider=function(t){this.providers.push(t),this.providers.sort(function(r,n){return(n.priority||0)-(r.priority||0)}),this.isDirty=!0,this.showLabels()},e.prototype.removeProvider=function(t){this.providers=this.providers.filter(function(r){return r!==t}),this.isDirty=!0,this.showLabels()},e.prototype.mark=function(t,r){var n=this.locis.findIndex(function(a){return mr.Loci.areEqual(t,a)});n===-1&&r===sr.Highlight?(this.locis.push(t),this.isDirty=!0):n!==-1&&r===sr.RemoveHighlight&&(T1(this.locis,n),this.isDirty=!0)},e.prototype.showLabels=function(){this.ctx.behaviors.labels.highlight.next({labels:this.getLabels()})},e.prototype.getLabels=function(){var t=this;if(this.isDirty){this.groupedLabels.clear(),this.labels.length=0;for(var r=0,n=this.providers;r<n.length;r++)for(var a=n[r],i=0,o=this.locis;i<o.length;i++){var s=o[i];if(!cr.isEmpty(s.loci)){var u=a.label(s.loci,s.repr);if(u){var l=a.group?a.group(u):u.toString(),c=this.groupedLabels.get(l);c?c.push(u):this.groupedLabels.set(l,[u])}}}this.labels.length=0,this.groupedLabels.forEach(function(d,f){var p=d.length,h=p>1&&d[0]!==d[1]?f:d[0];t.labels.push(p===1?h:h+" <small>|| \xD7 "+p+"</small>")}),this.isDirty=!1}return this.labels},e}(),GXe=8,qXe=function(e){Le(t,e);function t(r){var n=e.call(this,{history:[]})||this;n.plugin=r,n.events={historyUpdated:n.ev()},n.behaviors={current:n.ev.behavior(void 0)},r.state.data.events.object.removed.subscribe(function(i){var o,s,u=i.obj;if(!!be.Molecule.Structure.is(u)){((s=n.current)===null||s===void 0?void 0:s.loci.structure)===u.data&&n.clear();for(var l=[],c=0,d=n.history;c<d.length;c++){var f=d[c];f.loci.structure===u.data&&l.push(f)}l.length!==n.history.length&&(n.history.length=0,(o=n.history).push.apply(o,l),n.events.historyUpdated.next())}});var a=He();return r.state.data.events.object.updated.subscribe(function(i){var o,s=i.oldData,u=i.obj,l=i.action;if(!!be.Molecule.Structure.is(u)&&s!==u.data&&l==="in-place"){var c=n.state.current,d=u.data;if(c&&c.loci.structure===s){var f=Oe.remap(c.loci,d);n.state.current=T(T({},c),{loci:f}),n.behaviors.current.next(n.state.current),cr.getBoundingSphere(f,a);var p=(o=n.plugin.canvas3d)===null||o===void 0?void 0:o.camera,h=p.getTargetDistance(a.radius+4);(A.distance(p.target,a.center)>a.radius||h>p.viewport.height/p.zoom)&&n.plugin.managers.camera.focusSphere(a,{durationMs:0})}}}),n}return Object.defineProperty(t.prototype,"current",{get:function(){return this.state.current},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"history",{get:function(){return this.state.history},enumerable:!1,configurable:!0}),t.prototype.tryAddHistory=function(r){if(!Oe.isEmpty(r.loci)){for(var n=0,a=void 0,i=0,o=this.state.history;i<o.length;i++){var s=o[i];if(Oe.areEqual(s.loci,r.loci)){a=s;break}n++}if(a){T1(this.state.history,n),this.state.history.unshift(r),this.events.historyUpdated.next();return}this.state.history.unshift(r),this.state.history.length>GXe&&this.state.history.pop(),this.events.historyUpdated.next()}},t.prototype.set=function(r){this.tryAddHistory(r),(!this.state.current||!Oe.areEqual(this.state.current.loci,r.loci))&&(this.state.current=r,this.behaviors.current.next(r))},t.prototype.setFromLoci=function(r){var n=cr.normalize(r);if(!Oe.is(n)||Oe.isEmpty(n)){this.clear();return}this.set({loci:n,label:wp(n,{reverse:!0,hidePrefix:!0,htmlStyling:!1})})},t.prototype.addFromLoci=function(r){var n=this.state.current&&Oe.is(r)&&r.structure===this.state.current.loci.structure?Oe.union(r,this.state.current.loci):r;this.setFromLoci(n)},t.prototype.clear=function(){this.state.current&&(this.state.current=void 0,this.behaviors.current.next(void 0))},t.prototype.getSnapshot=function(){if(!this.current)return{};var r=this.plugin.helpers.substructureParent.get(this.current.loci.structure),n=r?.transform.ref;return n?{current:{label:this.current.label,ref:n,bundle:sn.fromLoci(this.current.loci),category:this.current.category}}:{}},t.prototype.setSnapshot=function(r){var n,a;if(!r.current){this.clear();return}var i=r.current,o=i.label,s=i.ref,u=i.bundle,l=i.category,c=(a=(n=this.plugin.state.data.select(lr.Generators.byRef(s))[0])===null||n===void 0?void 0:n.obj)===null||a===void 0?void 0:a.data;if(!!c){var d=sn.toLoci(u,c);this.set({label:o,loci:d,category:l})}},t}(Gd),Fg=new Ms("98"),WXe=24,XXe=function(e){Le(t,e);function t(r){var n=e.call(this,{entries:new Map,additionsHistory:[],stats:YXe()})||this;return n.plugin=r,n.events={changed:n.ev(),additionsHistoryUpdated:n.ev(),loci:{add:n.ev(),remove:n.ev(),clear:n.ev()}},r.helpers.substructureParent.events.removed.subscribe(function(a){return n.onRemove(a.ref,a.obj)}),r.helpers.substructureParent.events.updated.subscribe(function(a){return n.onUpdate(a.ref,a.oldObj,a.obj)}),n}return Object.defineProperty(t.prototype,"entries",{get:function(){return this.state.entries},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"additionsHistory",{get:function(){return this.state.additionsHistory},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stats",{get:function(){return this.state.stats?this.state.stats:(this.state.stats=this.calcStats(),this.state.stats)},enumerable:!1,configurable:!0}),t.prototype.getEntry=function(r){var n=this.plugin.helpers.substructureParent.get(r,!0);if(!!n){var a=n.transform.ref;if(!this.entries.has(a)){var i=new UI(Oe(r,[]));return this.entries.set(a,i),i}return this.entries.get(a)}},t.prototype.calcStats=function(){var r=0,n=0,a=Kf.create();this.entries.forEach(function(o){var s=o.selection.elements;if(s.length){r+=1;for(var u=0,l=s.length;u<l;++u)n+=Ne.size(s[u].indices);Kf.add(a,a,Kf.ofLoci(o.selection))}});var i=JC(a,{countsOnly:!0});return{structureCount:r,elementCount:n,label:i}},t.prototype.add=function(r){if(!Oe.is(r))return!1;var n=this.getEntry(r.structure);if(!n)return!1;var a=n.selection;return n.selection=Oe.union(n.selection,r),this.tryAddHistory(r),this.referenceLoci=r,this.events.loci.add.next(r),!Oe.areEqual(a,n.selection)},t.prototype.remove=function(r){if(!Oe.is(r))return!1;var n=this.getEntry(r.structure);if(!n)return!1;var a=n.selection;return n.selection=Oe.subtract(n.selection,r),this.referenceLoci=r,this.events.loci.remove.next(r),!Oe.areEqual(a,n.selection)},t.prototype.intersect=function(r){if(!Oe.is(r))return!1;var n=this.getEntry(r.structure);if(!n)return!1;var a=n.selection;return n.selection=Oe.intersect(n.selection,r),this.referenceLoci=r,!Oe.areEqual(a,n.selection)},t.prototype.set=function(r){if(!Oe.is(r))return!1;var n=this.getEntry(r.structure);if(!n)return!1;var a=n.selection;return n.selection=r,this.tryAddHistory(r),this.referenceLoci=void 0,!Oe.areEqual(a,n.selection)},t.prototype.modifyHistory=function(r,n,a,i){i===void 0&&(i=!1);var o=this.additionsHistory,s=o.indexOf(r);if(!(s<0)){var u=void 0;switch(n){case"remove":T1(o,s);break;case"up":u=s-1;break;case"down":u=s+1;break}if(u!==void 0)for(var l=a?Math.min(o.length,a):o.length;;)if(u=u%l,u<0&&(u+=l),!i||o[s].loci.structure===o[u].loci.structure){var c=o[s];o[s]=o[u],o[u]=c;break}else u+=n==="up"?-1:1;this.events.additionsHistoryUpdated.next()}},t.prototype.tryAddHistory=function(r){if(!cr.isEmpty(r)){for(var n=0,a=void 0,i=0,o=this.additionsHistory;i<o.length;i++){var s=o[i];if(cr.areEqual(s.loci,r)){a=s;break}n++}if(a){T1(this.additionsHistory,n),this.additionsHistory.unshift(a),this.events.additionsHistoryUpdated.next();return}var u=Kf.ofLoci(r),l=JC(u,{reverse:!0});this.additionsHistory.unshift({id:Cn.create22(),loci:r,label:l}),this.additionsHistory.length>WXe&&this.additionsHistory.pop(),this.events.additionsHistoryUpdated.next()}},t.prototype.clearHistory=function(){this.state.additionsHistory.length!==0&&(this.state.additionsHistory=[],this.events.additionsHistoryUpdated.next())},t.prototype.clearHistoryForStructure=function(r){for(var n=[],a=0,i=this.state.additionsHistory;a<i.length;a++){var o=i[a];o.loci.structure.root===r.root&&n.push(o)}for(var s=0,u=n;s<u.length;s++){var o=u[s];this.modifyHistory(o,"remove")}n.length!==0&&this.events.additionsHistoryUpdated.next()},t.prototype.onRemove=function(r,n){var a;this.entries.has(r)&&(this.entries.delete(r),n?.data&&this.clearHistoryForStructure(n.data),((a=this.referenceLoci)===null||a===void 0?void 0:a.structure)===n?.data&&(this.referenceLoci=void 0),this.state.stats=void 0,this.events.changed.next())},t.prototype.onUpdate=function(r,n,a){var i,o,s,u;if(!(n===a||n?.data===a.data)){var l=this.plugin.helpers.substructureParent.get(a.data,!0);if(!!l&&(r=l.transform.ref,!!this.entries.has(r))){var c=(o=(i=this.plugin.helpers.substructureParent.get(a.data))===null||i===void 0?void 0:i.obj)===null||o===void 0?void 0:o.data;if(!!c)if(!n?.data||$e.areUnitIdsAndIndicesEqual(n.data,a.data)){this.entries.set(r,KXe(this.entries.get(r),c)),((s=this.referenceLoci)===null||s===void 0?void 0:s.structure.root)===c.root&&(this.referenceLoci=Oe.remap(this.referenceLoci,c));for(var d=!1,f=0,p=this.state.additionsHistory;f<p.length;f++){var h=p[f];h.loci.structure.root===c.root&&(h.loci=Oe.remap(h.loci,c),d=!0)}d&&this.events.additionsHistoryUpdated.next()}else this.entries.set(r,new UI(Oe(c,[]))),((u=this.referenceLoci)===null||u===void 0?void 0:u.structure.root)===c.root&&(this.referenceLoci=void 0),this.clearHistoryForStructure(c),this.state.stats=void 0,this.events.changed.next()}}},t.prototype.clear=function(){for(var r=this.entries.keys(),n=[];;){var a=r.next();if(a.done)break;var i=this.entries.get(a.value);Oe.isEmpty(i.selection)||n.push(i.selection),i.selection=Oe(i.selection.structure,[])}return this.referenceLoci=void 0,this.state.stats=void 0,this.events.changed.next(),this.events.loci.clear.next(),this.clearHistory(),n},t.prototype.getLoci=function(r){var n=this.getEntry(r);return n?n.selection:zr},t.prototype.getStructure=function(r){var n=this.getEntry(r);if(!!n)return n.structure},t.prototype.structureHasSelection=function(r){var n,a,i=(a=(n=r.cell)===null||n===void 0?void 0:n.obj)===null||a===void 0?void 0:a.data;if(!i)return!1;var o=this.getEntry(i);return!!o&&!Oe.isEmpty(o.selection)},t.prototype.has=function(r){if(Oe.is(r)){var n=this.getEntry(r.structure);if(n)return Oe.isSubset(n.selection,r)}return!1},t.prototype.tryGetRange=function(r){if(!!Oe.is(r)&&r.elements.length===1){var n=this.getEntry(r.structure);if(!!n){var a=r.elements[0];if(!!a){var i=this.referenceLoci;if(!(!i||!Oe.is(i)||i.structure!==r.structure)){for(var o,s=0,u=i.elements;s<u.length;s++){var l=u[s];if(a.unit===l.unit){o=l;break}}if(!!o&&a.unit===o.unit)return $Xe(r.structure,o,a)}}}}},t.prototype.elementCount=function(){var r=0;return this.entries.forEach(function(n){r+=Oe.size(n.selection)}),r},t.prototype.getBoundary=function(){var r=A.create(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),n=A.create(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);Fg.reset();var a=[];this.entries.forEach(function(c){var d=c.selection;Oe.isEmpty(d)||a.push(Oe.getBoundary(d))});for(var i=0,o=a.length;i<o;++i){var s=a[i],u=s.box,l=s.sphere;A.min(r,r,u.min),A.max(n,n,u.max),Fg.includePositionRadius(l.center,l.radius)}Fg.finishedIncludeStep();for(var i=0,o=a.length;i<o;++i){var l=a[i].sphere;Fg.radiusPositionRadius(l.center,l.radius)}return{box:{min:r,max:n},sphere:Fg.getSphere()}},t.prototype.getPrincipalAxes=function(){var r=this.elementCount(),n=new Float32Array(3*r),a=0;return this.entries.forEach(function(i){Oe.toPositionsArray(i.selection,n,a),a+=Oe.size(i.selection)*3}),um.ofPositions(n)},t.prototype.modify=function(r,n){var a=!1;switch(r){case"add":a=this.add(n);break;case"remove":a=this.remove(n);break;case"intersect":a=this.intersect(n);break;case"set":a=this.set(n);break}a&&(this.state.stats=void 0,this.events.changed.next())},Object.defineProperty(t.prototype,"applicableStructures",{get:function(){return this.plugin.managers.structure.hierarchy.selection.structures.filter(function(r){return!!r.cell.obj}).map(function(r){return r.cell.obj.data})},enumerable:!1,configurable:!0}),t.prototype.triggerInteraction=function(r,n,a){switch(a===void 0&&(a=!0),r){case"add":this.plugin.managers.interactivity.lociSelects.select({loci:n},a);break;case"remove":this.plugin.managers.interactivity.lociSelects.deselect({loci:n},a);break;case"intersect":this.plugin.managers.interactivity.lociSelects.selectJoin({loci:n},a);break;case"set":this.plugin.managers.interactivity.lociSelects.selectOnly({loci:n},a);break}},t.prototype.fromLoci=function(r,n,a){a===void 0&&(a=!0),this.triggerInteraction(r,n,a)},t.prototype.fromCompiledQuery=function(r,n,a){a===void 0&&(a=!0);for(var i=0,o=this.applicableStructures;i<o.length;i++){var s=o[i],u=n(new As(s));this.triggerInteraction(r,St.toLociWithSourceUnits(u),a)}},t.prototype.fromSelectionQuery=function(r,n,a){var i=this;a===void 0&&(a=!0),this.plugin.runTask(Qe.create("Structure Selection",function(o){return pe(i,void 0,void 0,function(){var s,u,l,c;return he(this,function(d){switch(d.label){case 0:s=0,u=this.applicableStructures,d.label=1;case 1:return s<u.length?(l=u[s],[4,n.getSelection(this.plugin,o,l)]):[3,4];case 2:c=d.sent(),this.triggerInteraction(r,St.toLociWithSourceUnits(c),a),d.label=3;case 3:return s++,[3,1];case 4:return[2]}})})}))},t.prototype.fromSelections=function(r){var n,a=Ka.resolveAndCheck(this.plugin.state.data,r);if(!(!a||!a.obj)){if(!be.Molecule.Structure.Selections.is(a.obj)){console.warn("fromSelections applied to wrong object type.",a.obj);return}this.clear();for(var i=0,o=(n=a.obj)===null||n===void 0?void 0:n.data;i<o.length;i++){var s=o[i];this.fromLoci("set",s.loci)}}},t}(Gd);function YXe(){return{structureCount:0,elementCount:0,label:"Nothing Selected"}}var UI=function(){function e(t){this._structure=void 0,this._selection=t}return Object.defineProperty(e.prototype,"selection",{get:function(){return this._selection},set:function(t){this._selection=t,this._structure=void 0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"structure",{get:function(){return this._structure?this._structure:(cr.isEmpty(this._selection)?this._structure=void 0:this._structure=Oe.toStructure(this._selection),this._structure)},enumerable:!1,configurable:!0}),e}();function KXe(e,t){return new UI(Oe.remap(e.selection,t))}function $Xe(e,t,r){var n=Math.min(Ne.min(t.indices),Ne.min(r.indices)),a=Math.max(Ne.max(t.indices),Ne.max(r.indices));return Oe(e,[{unit:t.unit,indices:Ne.ofRange(n,a)}])}var QXe=[["full","Full"],["collapsed","Collapsed"],["hidden","Hidden"]],ET=[["full","Full"],["hidden","Hidden"]],ZXe={isExpanded:M.Boolean(!1),showControls:M.Boolean(!0),regionState:M.Group({left:M.Select("full",QXe),top:M.Select("full",ET),right:M.Select("full",ET),bottom:M.Select("full",ET)}),controlsDisplay:M.Value("outside",{isHidden:!0})},JXe=function(e){Le(t,e);function t(r){var n=e.call(this,T(T({},M.getDefaultValues(ZXe)),r.spec.layout&&r.spec.layout.initial))||this;return n.context=r,n.events={updated:n.ev()},n.rootState=void 0,Rt.Layout.Update.subscribe(r,function(a){return n.updateProps(a.state)}),typeof document<"u"&&(n.expandedViewport=document.createElement("meta"),n.expandedViewport.name="viewport",n.expandedViewport.content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"),n}return t.prototype.updateProps=function(r){var n=!!this.state.isExpanded;this.updateState(r),this.root&&typeof r.isExpanded=="boolean"&&r.isExpanded!==n&&this.handleExpand(),this.events.updated.next()},t.prototype.setProps=function(r){this.updateState(r)},t.prototype.setRoot=function(r){this.root=r,this.state.isExpanded&&this.handleExpand()},t.prototype.getScrollElement=function(){return document.scrollingElement?document.scrollingElement:document.documentElement?document.documentElement:document.body},t.prototype.handleExpand=function(){try{var r=document.getElementsByTagName("body")[0],n=document.getElementsByTagName("head")[0];if(!r||!n||!this.root)return;if(this.state.isExpanded){for(var a=n.children,i=[],o=!1,s=0;s<a.length;s++)a[s]===this.expandedViewport?o=!0:(a[s].name||"").toLowerCase()==="viewport"&&i.push(a[s]);for(var u=0,l=i;u<l.length;u++){var c=l[u];n.removeChild(c)}o||n.appendChild(this.expandedViewport);var d=r.style,f=this.getScrollElement(),p=f.scrollLeft,h=f.scrollTop;this.rootState={top:d.top,bottom:d.bottom,right:d.right,left:d.left,scrollTop:h,scrollLeft:p,position:d.position,overflow:d.overflow,viewports:i,zIndex:this.root.style.zIndex,width:d.width,height:d.height,maxWidth:d.maxWidth,maxHeight:d.maxHeight,margin:d.margin,marginLeft:d.marginLeft,marginRight:d.marginRight,marginTop:d.marginTop,marginBottom:d.marginBottom},d.overflow="hidden",d.position="fixed",d.top="0",d.bottom="0",d.right="0",d.left="0",d.width="100%",d.height="100%",d.maxWidth="100%",d.maxHeight="100%",d.margin="0",d.marginLeft="0",d.marginRight="0",d.marginTop="0",d.marginBottom="0"}else{for(var a=n.children,s=0;s<a.length;s++)if(a[s]===this.expandedViewport){n.removeChild(this.expandedViewport);break}if(this.rootState){for(var m=this.rootState,v=0,g=m.viewports;v<g.length;v++){var c=g[v];n.appendChild(c)}var d=r.style;d.top=m.top,d.bottom=m.bottom,d.left=m.left,d.right=m.right,d.width=m.width,d.height=m.height,d.maxWidth=m.maxWidth,d.maxHeight=m.maxHeight,d.margin=m.margin,d.marginLeft=m.marginLeft,d.marginRight=m.marginRight,d.marginTop=m.marginTop,d.marginBottom=m.marginBottom,d.position=m.position,d.overflow=m.overflow||"";var f=this.getScrollElement();f.scrollTop=m.scrollTop,f.scrollLeft=m.scrollLeft,this.rootState=void 0,this.root.style.zIndex=m.zIndex}}}catch(b){var y="Layout change error, you might have to reload the page.";this.context.log.error(y),console.error(y,b)}},t}(Gd),BR={includeTypes:M.MultiSelect(f_($r.Names),M.objectToOptions($r.Names)),excludeTypes:M.MultiSelect([],M.objectToOptions($r.Names)),ignoreHydrogens:M.Boolean(!1)};M.getDefaultValues(BR);var FR=T(T(T({},Rm),BR),{adjustCylinderLength:M.Boolean(!0,{description:"Shorten cylinders to reduce overlap with spheres."})});M.getDefaultValues(FR);var LR=T(T({},W$),BR);M.getDefaultValues(LR);function gZ(e,t,r){return!$r.is(e,r)||$r.is(t,r)}function yZ(e,t,r){var n=t.elements,a=t.model.atomicHierarchy.derived.atom.atomicNumber,i=t.bonds,o=i.a,s=i.b,u=i.edgeProps,l=u.flags,c=r.ignoreHydrogens,d=r.includeTypes,f=r.excludeTypes,p=$r.fromNames(d),h=$r.fromNames(f),m=$r.isAll(p)&&h===0,v=e.child,g=v?.unitMap.get(t.id);if(v&&!g)throw new Error("expected childUnit to exist if child exists");if(!(m&&!c&&!v))return function(y){return!!g&&!nt.has(g.elements,n[o[y]])||c&&(p3(a,n[o[y]])||p3(a,n[s[y]]))||!m&&gZ(p,h,l[y])}}function bZ(e,t){var r=e.interUnitBonds,n=r.edges,a=t.ignoreHydrogens,i=t.includeTypes,o=t.excludeTypes,s=$r.fromNames(i),u=$r.fromNames(o),l=$r.isAll(s)&&u===0,c=e.child;if(!(l&&!a&&!c))return function(d){if(c){var f=n[d],p=c.unitMap.get(f.unitA);if(!p)return!0;var h=e.unitMap.get(f.unitA),m=h.elements[f.indexA];if(!nt.has(p.elements,m))return!0}if(a){var f=n[d],v=e.unitMap.get(f.unitA),g=e.unitMap.get(f.unitB);if(f3(v,v.elements[f.indexA])||f3(g,g.elements[f.indexB]))return!0}return!!(!l&&gZ(s,u,n[d].props.flag))}}var Ap;(function(e){function t(n){var a=n.group,i=n.structure,o=a.units[0],s=We.isAtomic(o)?o.bonds.edgeCount*2:0,u=a.units.length,l=$t.Location(i,void 0,void 0,i,void 0,void 0),c=function(d,f){var p=a.units[f];return l.aUnit=p,l.bUnit=p,l.aIndex=p.bonds.a[d],l.bIndex=p.bonds.b[d],l};return Tn(s,u,1,c)}e.fromGroup=t;function r(n){var a=n.interUnitBonds.edgeCount,i=1,o=$t.Location(n,void 0,void 0,n,void 0,void 0),s=function(u){var l=n.interUnitBonds.edges[u];return o.aUnit=n.unitMap.get(l.unitA),o.aIndex=l.indexA,o.bUnit=n.unitMap.get(l.unitB),o.bIndex=l.indexB,o};return Tn(a,i,1,s,!0)}e.fromStructure=r})(Ap||(Ap={}));function NR(e,t,r){var n=e.objectId,a=e.instanceId,i=e.groupId;if(r===n){var o=t.structure,s=t.group,u=s.units[a];if(We.isAtomic(u)){var l=o.target,c=u.bonds.a[i],d=u.bonds.b[i];return $t.Loci(l,[$t.Location(l,u,c,l,u,d),$t.Location(l,u,d,l,u,c)])}}return zr}function zR(e,t,r,n){var a=!1;if($t.isLoci(e)){var i=t.structure,o=t.group;if(!$e.areEquivalent(e.structure,i))return!1;var s=o.units[0];if(!We.isAtomic(s))return!1;for(var u=s.bonds.edgeCount*2,l=0,c=e.bonds;l<c.length;l++){var d=c[l];if(d.aUnit===d.bUnit){var f=o.unitIndexMap.get(d.aUnit.id);if(f!==void 0){var p=s.bonds.getDirectedEdgeIndex(d.aIndex,d.bIndex);p!==-1&&r(Me.ofSingleton(f*u+p))&&(a=!0)}}}}else if(Oe.is(e)){var i=t.structure,o=t.group;if(!$e.areEquivalent(e.structure,i))return!1;var s=o.units[0];if(!We.isAtomic(s))return!1;for(var h=s.bonds.edgeCount*2,m=function(C){var w=o.unitIndexMap.get(C.unit.id);if(w!==void 0){var _=s.bonds,E=_.offset,P=_.b;Ne.forEach(C.indices,function(D){for(var k=E[D],F=E[D+1];k<F;k++)(!n||Ne.has(C.indices,P[k]))&&r(Me.ofSingleton(w*h+k))&&(a=!0)})}},v=0,g=e.elements;v<g.length;v++){var y=g[v];m(y)}}return a}function UR(e,t,r){var n=e.objectId,a=e.groupId;if(r===n){var i=t.target,o=t.interUnitBonds.edges[a],s=t.unitMap.get(o.unitA),u=t.unitMap.get(o.unitB);return $t.Loci(i,[$t.Location(i,s,o.indexA,i,u,o.indexB),$t.Location(i,u,o.indexB,i,s,o.indexA)])}return zr}function VR(e,t,r,n){var a=!1;if($t.isLoci(e)){if(!$e.areEquivalent(e.structure,t))return!1;for(var i=0,o=e.bonds;i<o.length;i++){var s=o[i],u=t.interUnitBonds.getBondIndexFromLocation(s);u!==-1&&r(Me.ofSingleton(u))&&(a=!0)}}else if(Oe.is(e)){if(!$e.areEquivalent(e.structure,t)||n&&e.elements.length===1)return!1;for(var l=new Map,c=0,d=e.elements;c<d.length;c++){var f=d[c];l.set(f.unit.id,f.indices)}for(var p=function(v){var g=v.unit;if(!We.isAtomic(g))return"continue";t.interUnitBonds.getConnectedUnits(g.id).forEach(function(y){var b=l.get(y.unitB);(!n||b)&&Ne.forEach(v.indices,function(S){!y.connectedIndices.includes(S)||y.getEdges(S).forEach(function(x){if(!n||b&&Ne.has(b,x.indexB)){var C=t.interUnitBonds.getEdgeIndex(S,g.id,x.indexB,y.unitB);r(Me.ofSingleton(C))&&(a=!0)}})})})},h=0,m=e.elements;h<m.length;h++){var f=m[h];p(f)}}return a}var Cz=$r.is;function xZ(e,t,r,n){var a=e.elements,i=e.bonds,o=i.edgeCount,s=i.a,u=i.b,l=i.edgeProps,c=i.offset,d=l.order,f=l.flags,p=n.sizeFactor,h=n.sizeAspectRatio,m=n.adjustCylinderLength,v=A(),g=A(),y=e.conformation.invariantPosition,b,S=ot.create(t,e),x=$t.Location(t,e,void 0,t,e,void 0);if(n.includeParent){var C=t.child;if(!C)throw new Error("expected child to exist");var w=C.unitMap.get(e.id);if(!w)throw new Error("expected childUnit to exist");b=function(D){var k=a[s[D]],F=a[u[D]];return nt.has(w.elements,k)&&!nt.has(w.elements,F)}}var _=function(D){return x.aIndex=s[D],x.bIndex=u[D],r.size.size(x)*p},E=function(D){return S.element=a[s[D]],r.size.size(S)*p},P=function(D){return S.element=a[u[D]],r.size.size(S)*p};return{linkCount:o*2,referencePosition:function(D){var k,F,X=s[D],U=u[D];X>U&&(k=[U,X],X=k[0],U=k[1]),c[X+1]-c[X]===1&&(F=[U,X],X=F[0],U=F[1]);for(var j=c[X],te=c[X+1];j<te;++j){var q=u[j];if(q!==U&&q!==X)return y(a[q],v)}for(var j=c[U],te=c[U+1];j<te;++j){var W=s[j];if(W!==X&&W!==U)return y(a[W],v)}return null},position:function(D,k,F){if(y(a[s[F]],D),y(a[u[F]],k),m){var X=E(F),U=P(F),j=Math.min(X,U)*h,te=Math.sqrt(Math.max(0,X*X-j*j))-.05,q=Math.sqrt(Math.max(0,U*U-j*j))-.05;if(te<=.01&&q<=.01)return;A.normalize(g,A.sub(g,k,D)),A.scaleAndAdd(D,D,g,te),A.scaleAndAdd(k,k,g,-q)}},style:function(D){var k=d[D],F=f[D];return Cz(F,2)||Cz(F,4)?1:k===2?2:k===3?3:0},radius:function(D){return _(D)*h},ignore:yZ(t,e,n),stub:b}}function eYe(e,t,r,n,a,i){if(!We.isAtomic(t)||!t.bonds.edgeCount)return su.createEmpty(i);var o=r.child,s=o?.unitMap.get(t.id);if(o&&!s)return su.createEmpty(i);var u=xZ(t,r,n,a),l=X$(e,u,a,i),c=He.expand(He(),(s??t).boundary.sphere,1*a.sizeFactor);return l.setBoundingSphere(c),l}function tYe(e,t,r,n,a,i){if(!We.isAtomic(t)||!t.bonds.edgeCount)return Wt.createEmpty(i);var o=r.child,s=o?.unitMap.get(t.id);if(o&&!s)return Wt.createEmpty(i);var u=xZ(t,r,n,a),l=Om(e,u,a,i),c=He.expand(He(),(s??t).boundary.sphere,1*a.sizeFactor);return l.setBoundingSphere(c),l}var N_=T(T(T(T({},wo),cze),FR),{sizeFactor:M.Numeric(.3,{min:0,max:10,step:.01}),sizeAspectRatio:M.Numeric(2/3,{min:0,max:3,step:.01}),tryUseImpostor:M.Boolean(!0),includeParent:M.Boolean(!1)});function SZ(e,t,r,n){return r.tryUseImpostor&&n&&n.extensions.fragDepth?rYe(e):nYe(e)}function rYe(e){return dze({defaultProps:M.getDefaultValues(N_),createGeometry:eYe,createLocationIterator:Ap.fromGroup,getLoci:NR,eachLocation:zR,setUpdateState:function(t,r,n,a,i,o,s){t.createGeometry=r.sizeAspectRatio!==n.sizeAspectRatio||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.ignoreHydrogens!==n.ignoreHydrogens||r.linkCap!==n.linkCap||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.stubCap!==n.stubCap||!yo(r.includeTypes,n.includeTypes)||!yo(r.excludeTypes,n.excludeTypes)||r.adjustCylinderLength!==n.adjustCylinderLength;var u=o.group.units[0],l=s.group.units[0];We.isAtomic(u)&&We.isAtomic(l)&&(qo.areEqual(u.bonds,l.bonds)||(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.updateSize=!0))},mustRecreate:function(t,r,n){return!r.tryUseImpostor||!n}},e)}function nYe(e){return Rs({defaultProps:M.getDefaultValues(N_),createGeometry:tYe,createLocationIterator:Ap.fromGroup,getLoci:NR,eachLocation:zR,setUpdateState:function(t,r,n,a,i,o,s){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.sizeAspectRatio!==n.sizeAspectRatio||r.radialSegments!==n.radialSegments||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.ignoreHydrogens!==n.ignoreHydrogens||r.linkCap!==n.linkCap||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.stubCap!==n.stubCap||!yo(r.includeTypes,n.includeTypes)||!yo(r.excludeTypes,n.excludeTypes)||r.adjustCylinderLength!==n.adjustCylinderLength;var u=o.group.units[0],l=s.group.units[0];We.isAtomic(u)&&We.isAtomic(l)&&(qo.areEqual(u.bonds,l.bonds)||(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.updateSize=!0))},mustRecreate:function(t,r,n){return r.tryUseImpostor&&!!n}},e)}var PT=new $t.ElementBondIterator;function wz(e,t,r,n){for(PT.setElement(t,r,n);PT.hasNext;){var a=PT.move();return a.otherUnit.conformation.position(a.otherUnit.elements[a.otherIndex],e),e}return null}var _z=A();function CZ(e,t,r){var n=ot.create(e),a=$t.Location(e,void 0,void 0,e,void 0,void 0),i=e.interUnitBonds,o=i.edgeCount,s=i.edges,u=r.sizeFactor,l=r.sizeAspectRatio,c=r.adjustCylinderLength,d=A(),f;if(r.includeParent){var p=e.child;if(!p)throw new Error("expected child to exist");f=function(g){var y=s[g],b=p.unitMap.get(y.unitA),S=p.unitMap.get(y.unitB),x=e.unitMap.get(y.unitA),C=x.elements[y.indexA],w=e.unitMap.get(y.unitB),_=w.elements[y.indexB];return b&&nt.has(b.elements,C)&&(!S||!nt.has(S.elements,_))}}var h=function(g){var y=s[g];return a.aUnit=e.unitMap.get(y.unitA),a.aIndex=y.indexA,a.bUnit=e.unitMap.get(y.unitB),a.bIndex=y.indexB,t.size.size(a)*u},m=function(g){var y=s[g];return n.unit=e.unitMap.get(y.unitA),n.element=n.unit.elements[y.indexA],t.size.size(n)*u},v=function(g){var y=s[g];return n.unit=e.unitMap.get(y.unitB),n.element=n.unit.elements[y.indexB],t.size.size(n)*u};return{linkCount:o,referencePosition:function(g){var y=s[g],b,S,x,C;if(y.unitA<y.unitB)b=e.unitMap.get(y.unitA),S=e.unitMap.get(y.unitB),x=y.indexA,C=y.indexB;else if(y.unitA>y.unitB)b=e.unitMap.get(y.unitB),S=e.unitMap.get(y.unitA),x=y.indexB,C=y.indexA;else throw new Error("same units in createInterUnitBondCylinderMesh");return wz(_z,e,b,x)||wz(_z,e,S,C)},position:function(g,y,b){var S=s[b],x=e.unitMap.get(S.unitA),C=e.unitMap.get(S.unitB);if(x.conformation.position(x.elements[S.indexA],g),C.conformation.position(C.elements[S.indexB],y),c){var w=m(b),_=v(b),E=Math.min(w,_)*l,P=Math.sqrt(Math.max(0,w*w-E*E))-.05,D=Math.sqrt(Math.max(0,_*_-E*E))-.05;if(P<=.01&&D<=.01)return;A.normalize(d,A.sub(d,y,g)),A.scaleAndAdd(g,g,d,P),A.scaleAndAdd(y,y,d,-D)}},style:function(g){var y=s[g].props.order,b=Oi.create(s[g].props.flag);return $r.is(b,2)||$r.is(b,4)?1:y===2?2:y===3?3:0},radius:function(g){return h(g)*l},ignore:bZ(e,r),stub:f}}function aYe(e,t,r,n,a){if(!t.interUnitBonds.edgeCount)return su.createEmpty(a);var i=CZ(t,r,n),o=X$(e,i,n,a),s=t.child,u=He.expand(He(),(s??t).boundary.sphere,1*n.sizeFactor);return o.setBoundingSphere(u),o}function iYe(e,t,r,n,a){if(!t.interUnitBonds.edgeCount)return Wt.createEmpty(a);var i=CZ(t,r,n),o=Om(e,i,n,a),s=t.child,u=He.expand(He(),(s??t).boundary.sphere,1*n.sizeFactor);return o.setBoundingSphere(u),o}var z_=T(T(T(T({},Ab),QNe),FR),{sizeFactor:M.Numeric(.3,{min:0,max:10,step:.01}),sizeAspectRatio:M.Numeric(2/3,{min:0,max:3,step:.01}),tryUseImpostor:M.Boolean(!0),includeParent:M.Boolean(!1)});function wZ(e,t,r,n){return r.tryUseImpostor&&n&&n.extensions.fragDepth?oYe(e):sYe(e)}function oYe(e){return ZNe({defaultProps:M.getDefaultValues(z_),createGeometry:aYe,createLocationIterator:Ap.fromStructure,getLoci:UR,eachLocation:VR,setUpdateState:function(t,r,n){t.createGeometry=r.sizeAspectRatio!==n.sizeAspectRatio||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.ignoreHydrogens!==n.ignoreHydrogens||r.linkCap!==n.linkCap||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.stubCap!==n.stubCap||!yo(r.includeTypes,n.includeTypes)||!yo(r.excludeTypes,n.excludeTypes)||r.adjustCylinderLength!==n.adjustCylinderLength},mustRecreate:function(t,r,n){return!r.tryUseImpostor||!n}},e)}function sYe(e){return Dm({defaultProps:M.getDefaultValues(z_),createGeometry:iYe,createLocationIterator:Ap.fromStructure,getLoci:UR,eachLocation:VR,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.sizeAspectRatio!==n.sizeAspectRatio||r.radialSegments!==n.radialSegments||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.ignoreHydrogens!==n.ignoreHydrogens||r.linkCap!==n.linkCap||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.stubCap!==n.stubCap||!yo(r.includeTypes,n.includeTypes)||!yo(r.excludeTypes,n.excludeTypes)||r.adjustCylinderLength!==n.adjustCylinderLength},mustRecreate:function(t,r,n){return r.tryUseImpostor&&!!n}},e)}var Az=new Float32Array([-1,1,-1,-1,1,1,1,-1]),sv=new Uint16Array([0,1,2,1,3,2]),IT=Ke.add3,uYe=Ke.add2,lYe=Ke.add,VI;(function(e){function t(r,n,a){r===void 0&&(r=2048),n===void 0&&(n=1024),r*=4,n*=4;var i=Ke.create(Float32Array,3,n,a?a.centerBuffer.ref.value:r),o=Ke.create(Float32Array,2,n,a?a.mappingBuffer.ref.value:r),s=Ke.create(Uint32Array,3,n/2,a?a.indexBuffer.ref.value:r/2),u=Ke.create(Float32Array,1,n,a?a.groupBuffer.ref.value:r);return{add:function(l,c,d,f){for(var p=i.elementCount,h=0;h<4;++h)IT(i,l,c,d),uYe(o,Az[h*2],Az[h*2+1]),lYe(u,f);IT(s,p+sv[0],p+sv[1],p+sv[2]),IT(s,p+sv[3],p+sv[4],p+sv[5])},getSpheres:function(){var l=Ke.compact(i,!0),c=Ke.compact(o,!0),d=Ke.compact(s,!0),f=Ke.compact(u,!0);return om.create(l,c,d,f,i.elementCount/4,a)}}}e.create=t})(VI||(VI={}));var _Z=A.add;function HR(e,t,r){var n=r.ignoreHydrogens,a=r.traceOnly,i=t.model.atomicHierarchy.derived.atom.atomicNumber,o=We.isCoarse(t),s=e.child,u=s?.unitMap.get(t.id);if(s&&!u)throw new Error("expected childUnit to exist if child exists");if(!(!s&&(!n&&!a||a)))return function(l){return!!u&&!nt.has(u.elements,l)||!o&&n&&p3(i,l)||a&&!nR(t,l)}}function cYe(e,t,r,n,a,i){var o=r.child,s=o?.unitMap.get(t.id);if(o&&!s)return Wt.createEmpty(i);for(var u=a.detail,l=a.sizeFactor,c=t.elements,d=c.length,f=d*xk(u),p=kt.createState(f,f/2,i),h=A(),m=t.conformation.invariantPosition,v=HR(r,t,a),g=ot.create(r,t),y=n.size.size,b=A(),S=0,x=0,C=0;C<d;C++)if(!(v&&v(c[C]))){g.element=c[C],m(c[C],h),_Z(b,b,h),x+=1,p.currentGroup=C;var w=y(g);w>S&&(S=w),ti(p,h,w*l,u)}var _;A.scale(b,b,1/x),i&&A.distance(b,i.boundingSphere.center)/i.boundingSphere.radius<1?_=He.clone(i.boundingSphere):_=He.expand(He(),(s??t).boundary.sphere,S*l+.05);var E=kt.getMesh(p);return E.setBoundingSphere(_),E}function dYe(e,t,r,n,a,i){var o=r.child,s=o?.unitMap.get(t.id);if(o&&!s)return om.createEmpty(i);for(var u=t.elements,l=u.length,c=VI.create(l,l/2,i),d=A(),f=t.conformation.invariantPosition,p=HR(r,t,a),h=ot.create(r,t),m=n.size.size,v=A(),g=0,y=0,b=0;b<l;b++)if(!p?.(u[b])){f(u[b],d),c.add(d[0],d[1],d[2],b),_Z(v,v,d),y+=1,h.element=u[b];var S=m(h);S>g&&(g=S)}var x;A.scale(v,v,1/y),i&&A.distance(v,i.boundingSphere.center)/i.boundingSphere.radius<1?x=He.clone(i.boundingSphere):x=He.expand(He(),(s??t).boundary.sphere,g*a.sizeFactor+.05);var C=c.getSpheres();return C.setBoundingSphere(x),C}function pc(e,t,r){var n=!1;if(!Oe.is(e))return!1;var a=t.structure,i=t.group;if(!$e.areEquivalent(e.structure,a))return!1;for(var o=i.elements.length,s=0,u=e.elements;s<u.length;s++){var l=u[s],c=i.unitIndexMap.get(l.unit.id);if(c!==void 0){var d=c*o;if(Me.is(l.indices)){var f=d+Me.start(l.indices),p=d+Me.end(l.indices);r(Me.ofBounds(f,p))&&(n=!0)}else for(var h=0,m=l.indices.length;h<m;h++){for(var f=l.indices[h],v=h+1;v<m&&l.indices[v]===f;)v++;h=v-1;var p=l.indices[h];n=r(Me.ofRange(d+f,d+p))||n}}}return n}function hc(e,t,r){var n=e.objectId,a=e.instanceId,i=e.groupId;if(r===n){var o=t.structure,s=t.group,u=s.units[a],l=Ne.ofSingleton(i);return Oe(o.target,[{unit:u,indices:l}])}return zr}function U_(e,t,r){var n=!1;if(!Oe.is(e)||!$e.areEquivalent(e.structure,t))return!1;for(var a=t.serialMapping.cumulativeUnitElementCount,i=0,o=e.elements;i<o.length;i++){var s=o[i],u=t.unitIndexMap.get(s.unit.id);if(u!==void 0)if(Me.is(s.indices)){var l=a[u]+Me.start(s.indices),c=a[u]+Me.end(s.indices);r(Me.ofBounds(l,c))&&(n=!0)}else for(var d=0,f=s.indices.length;d<f;d++){var p=a[u]+s.indices[d];r(Me.ofSingleton(p))&&(n=!0)}}return n}function V_(e,t,r){var n=e.objectId,a=e.groupId;if(r===n){var i=t.serialMapping,o=i.unitIndices,s=i.cumulativeUnitElementCount,u=o[a],l=t.units[u],c=a-s[u],d=Ne.ofSingleton(c);return Oe(t,[{unit:l,indices:d}])}return zr}var to;(function(e){function t(n){var a=n.group,i=n.structure,o=a.elements.length,s=a.units.length,u=ot.create(i),l=function(c,d){var f=a.units[d];return u.unit=f,u.element=f.elements[c],u};return Tn(o,s,1,l)}e.fromGroup=t;function r(n){var a=n.units,i=n.elementCount,o=i,s=1,u=n.serialMapping,l=u.unitIndices,c=u.elementIndices,d=ot.create(n),f=function(p){return d.unit=a[l[p]],d.element=c[p],d};return Tn(o,s,1,f,!0)}e.fromStructure=r})(to||(to={}));var H_=T(T(T({},wo),uze),{sizeFactor:M.Numeric(1,{min:0,max:10,step:.1}),detail:M.Numeric(0,{min:0,max:3,step:1},Dt.CustomQualityParamInfo),ignoreHydrogens:M.Boolean(!1),traceOnly:M.Boolean(!1),tryUseImpostor:M.Boolean(!0)});function AZ(e,t,r,n){return r.tryUseImpostor&&n&&n.extensions.fragDepth?fYe(e):pYe(e)}function fYe(e){return lze({defaultProps:M.getDefaultValues(H_),createGeometry:dYe,createLocationIterator:to.fromGroup,getLoci:hc,eachLocation:pc,setUpdateState:function(t,r,n){t.createGeometry=r.ignoreHydrogens!==n.ignoreHydrogens||r.traceOnly!==n.traceOnly},mustRecreate:function(t,r,n){return!r.tryUseImpostor||!n}},e)}function pYe(e){return Rs({defaultProps:M.getDefaultValues(H_),createGeometry:cYe,createLocationIterator:to.fromGroup,getLoci:hc,eachLocation:pc,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail||r.ignoreHydrogens!==n.ignoreHydrogens||r.traceOnly!==n.traceOnly},mustRecreate:function(t,r,n){return r.tryUseImpostor&&!!n}},e)}var TZ={"element-sphere":function(e,t){return Ba("Element sphere",e,t,AZ)},"intra-bond":function(e,t){return Ba("Intra-unit bond cylinder",e,t,SZ)},"inter-bond":function(e,t){return Qu("Inter-unit bond cylinder",e,t,wZ)}},EZ=T(T(T(T(T({},H_),{traceOnly:M.Boolean(!1,{isHidden:!0})}),N_),z_),{unitKinds:_b(["atomic"]),sizeFactor:M.Numeric(.15,{min:.01,max:10,step:.01}),sizeAspectRatio:M.Numeric(2/3,{min:.01,max:3,step:.01}),visuals:M.MultiSelect(["element-sphere","intra-bond","inter-bond"],M.objectToOptions(TZ))});function hYe(e,t){return M.clone(EZ)}function mYe(e,t){return mr.createMulti("Ball & Stick",e,t,si,TZ)}var vYe={name:"ball-and-stick",label:"Ball & Stick",description:"Displays atoms as spheres and bonds as cylinders.",factory:mYe,getParams:hYe,defaultValues:M.getDefaultValues(EZ),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"physical"},isApplicable:function(e){return e.elementCount>0},getData:function(e,t){return t.includeParent?e.asParent():e},mustRecreate:function(e,t){return e.includeParent!==t.includeParent}};function gYe(e,t,r,n,a){var i=t.carbohydrates,o=i.links,s=i.elements,u=n.linkSizeFactor,l=ot.create(t),c={linkCount:o.length,position:function(d,f,p){var h=o[p];A.copy(d,s[h.carbohydrateIndexA].geometry.center),A.copy(f,s[h.carbohydrateIndexB].geometry.center)},radius:function(d){var f=o[d],p=s[f.carbohydrateIndexA],h=p.unit.rings.all[p.ringIndex];return l.unit=p.unit,l.element=p.unit.elements[h[0]],r.size.size(l)*u}};return Om(e,c,n,a)}var PZ=T(T(T({},wo),Rm),{linkSizeFactor:M.Numeric(.3,{min:0,max:3,step:.01})});function yYe(e){return Dm({defaultProps:M.getDefaultValues(PZ),createGeometry:gYe,createLocationIterator:bYe,getLoci:xYe,eachLocation:SYe,setUpdateState:function(t,r,n){t.createGeometry=r.linkSizeFactor!==n.linkSizeFactor||r.radialSegments!==n.radialSegments||r.linkCap!==n.linkCap}},e)}function bYe(e){var t=e.carbohydrates,r=t.elements,n=t.links,a=n.length,i=1,o=ot.create(e),s=function(u){var l=n[u],c=r[l.carbohydrateIndexA],d=c.unit.rings.all[c.ringIndex];return o.unit=c.unit,o.element=c.unit.elements[d[0]],o};return Tn(a,i,1,s,!0)}function xYe(e,t,r){var n=e.objectId,a=e.groupId;if(r===n){var i=t.carbohydrates,o=i.links,s=i.elements,u=o[a],l=s[u.carbohydrateIndexA],c=s[u.carbohydrateIndexB];return Oe.union(q1(t,l.unit,l.residueIndex,l.altId),q1(t,c.unit,c.residueIndex,c.altId))}return zr}function SYe(e,t,r){var n=!1;if(!Oe.is(e)||!$e.areEquivalent(e.structure,t))return!1;for(var a=t.carbohydrates.getLinkIndices,i=function(d,f){if(!We.isAtomic(d))return"continue";Ne.forEach(f,function(p){for(var h=a(d,d.elements[p]),m=0,v=h.length;m<v;++m)r(Me.ofSingleton(h[m]))&&(n=!0)})},o=0,s=e.elements;o<s.length;o++){var u=s[o],l=u.unit,c=u.indices;i(l,c)}return n}var CYe=A.create(0,0,-.5),wYe=A.create(0,0,.5),pf=A(),hf=A(),bx=A(),Tz=A();function _Ye(e){for(var t=e.length/3,r=t===3?1:t===4?2:t,n=r+t,a=t===4?t*3+4:n*3,i=N0(n,a),o=0;o<t;++o){var s=(o+1)%t;A.set(pf,e[o*3],e[o*3+1],-.5),A.set(hf,e[s*3],e[s*3+1],-.5),i.add(pf,hf,wYe)}if(t===3)A.set(pf,e[0],e[1],-.5),A.set(hf,e[3],e[4],-.5),A.set(bx,e[6],e[7],-.5),i.add(bx,hf,pf);else if(t===4)A.set(pf,e[0],e[1],-.5),A.set(hf,e[3],e[4],-.5),A.set(bx,e[6],e[7],-.5),A.set(Tz,e[9],e[10],-.5),i.addQuad(Tz,bx,hf,pf);else for(var o=0;o<t;++o){var s=(o+1)%t;A.set(pf,e[o*3],e[o*3+1],-.5),A.set(hf,e[s*3],e[s*3+1],-.5),i.add(CYe,hf,pf)}return i.getPrimitive()}var MT;function AYe(){return MT||(MT=_Ye(dc(8,!0))),MT}var DT;function TYe(){if(!DT){for(var e=dc(8,!0),t=new Float32Array(8*3+6),r=0;r<8;++r)t[r*3]=e[r*3],t[r*3+1]=e[r*3+1],t[r*3+2]=-.5;t[8*3]=0,t[8*3+1]=0,t[8*3+2]=-.5,t[8*3+3]=0,t[8*3+4]=0,t[8*3+5]=.5;var n=[0,1,8,1,2,8,4,5,8,5,6,8,2,3,9,3,4,9,6,7,9,7,0,9];DT=Kw(t,n)}return DT}var EYe={pointCount:5,outerRadius:1,innerRadius:.5,thickness:.3},kT=A.zero(),RT=A.zero(),OT=A.zero(),Lg=A.zero(),BT=A.zero();function PYe(e){for(var t=T(T({},EYe),e),r=t.outerRadius,n=t.innerRadius,a=t.thickness,i=t.pointCount,o=i*2*2,s=N0(o),u=new Float32Array(i*2),l=new Float32Array(i*2),c=0;c<i;++c){var d=c*2,f=c*2+1,p=(d+1)/i*Math.PI,h=(f+1)/i*Math.PI;l[d]=Math.cos(p)*r,l[f]=Math.sin(p)*r,u[d]=Math.cos(h)*n,u[f]=Math.sin(h)*n}A.set(kT,0,0,a/2),A.set(RT,0,0,-a/2);for(var c=0;c<i;++c){var m=(c+1)%i;A.set(OT,l[c*2],l[c*2+1],0),A.set(Lg,u[c*2],u[c*2+1],0),A.set(BT,l[m*2],l[m*2+1],0),s.add(kT,OT,Lg),s.add(Lg,OT,RT),s.add(kT,Lg,BT),s.add(BT,Lg,RT)}return s.getPrimitive()}var IZ=[.5,0,0,-.5,0,0,0,.5,0,0,-.5,0,0,0,.5,0,0,-.5],IYe=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],MYe=[0,2,4,0,4,3,1,2,5,1,5,3],FT;function DYe(){return FT||(FT=Kw(IZ,IYe)),FT}var LT;function kYe(){return LT||(LT=Kw(IZ,MYe)),LT}var Vt=de.identity(),Dc=A.zero(),Ez=A.zero(),RYe=2*.806,Pz=yk(),Iz=K3e(),OYe=AYe(),Mz=TYe(),BYe=PYe({outerRadius:1,innerRadius:.5,thickness:.5,pointCount:5}),FYe=DYe(),Dz=kYe(),kz=vAe(),LYe=gAe(),NYe=yAe(),zYe=bAe(),UYe=xAe();function VYe(e,t,r,n,a){for(var i=kt.createState(256,128,a),o=n.detail,s=n.sizeFactor,u=t.carbohydrates,l=u.elements.length,c=ot.create(t),d=0;d<l;++d){var f=u.elements[d],p=f.unit.rings.all[f.ringIndex],h=yTe(f.component.type,p.length);c.unit=f.unit,c.element=f.unit.elements[p[0]];var m=r.size.size(c),v=m*s,g=m*s*RYe,y=f.geometry,b=y.center,S=y.normal,x=y.direction;switch(A.add(Ez,b,x),de.targetTo(Vt,b,Ez,S),de.setTranslation(Vt,b),i.currentGroup=d*2,h){case 0:ti(i,b,v,o);break;case 1:de.scaleUniformly(Vt,Vt,g),kt.addPrimitive(i,Vt,Pz);break;case 2:de.scaleUniformly(Vt,Vt,g),kt.addPrimitive(i,Vt,Iz),de.mul(Vt,Vt,de.rotZ90X180),i.currentGroup+=1,kt.addPrimitive(i,Vt,Iz);break;case 4:de.scaleUniformly(Vt,Vt,g*1.2),kt.addPrimitive(i,Vt,OYe);break;case 5:de.scaleUniformly(Vt,Vt,g*1.2),kt.addPrimitive(i,Vt,Mz),de.mul(Vt,Vt,de.rotZ90),i.currentGroup+=1,kt.addPrimitive(i,Vt,Mz);break;case 6:de.mul(Vt,Vt,de.rotZY90),de.scale(Vt,Vt,A.set(Dc,g,g,g/2)),kt.addPrimitive(i,Vt,Pz);break;case 7:de.scaleUniformly(Vt,Vt,g),de.mul(Vt,Vt,de.rotZY90),kt.addPrimitive(i,Vt,BYe);break;case 8:de.mul(Vt,Vt,de.rotZY90),de.scale(Vt,Vt,A.set(Dc,g*1.4,g*1.4,g*1.4)),kt.addPrimitive(i,Vt,FYe);break;case 3:de.mul(Vt,Vt,de.rotZY90),de.scale(Vt,Vt,A.set(Dc,g*1.4,g*1.4,g*1.4)),kt.addPrimitive(i,Vt,Dz),de.mul(Vt,Vt,de.rotY90),i.currentGroup+=1,kt.addPrimitive(i,Vt,Dz);break;case 9:de.mul(Vt,Vt,de.rotZY90),de.scale(Vt,Vt,A.set(Dc,g,g/2,g/2)),kt.addPrimitive(i,Vt,kz);break;case 12:de.mul(Vt,Vt,de.rotZY90),de.scale(Vt,Vt,A.set(Dc,g,g,g/2)),kt.addPrimitive(i,Vt,kz);break;case 13:case 11:de.mul(Vt,Vt,de.rotZY90),de.scale(Vt,Vt,A.set(Dc,g,g,g/2)),kt.addPrimitive(i,Vt,LYe);break;case 14:de.mul(Vt,Vt,de.rotZY90),de.scale(Vt,Vt,A.set(Dc,g,g,g/2)),kt.addPrimitive(i,Vt,NYe);break;case 15:de.mul(Vt,Vt,de.rotZY90),de.scale(Vt,Vt,A.set(Dc,g,g,g/2)),kt.addPrimitive(i,Vt,UYe);break;case 10:default:de.mul(Vt,Vt,de.rotZYZ90),de.scale(Vt,Vt,A.set(Dc,g/1.5,g,g/2)),kt.addPrimitive(i,Vt,zYe);break}}return kt.getMesh(i)}var MZ=T(T({},Ab),{detail:M.Numeric(0,{min:0,max:3,step:1},Dt.CustomQualityParamInfo),sizeFactor:M.Numeric(1.75,{min:0,max:10,step:.01})});function HYe(e){return Dm({defaultProps:M.getDefaultValues(MZ),createGeometry:VYe,createLocationIterator:jYe,getLoci:GYe,eachLocation:qYe,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail}},e)}function jYe(e){var t=e.carbohydrates.elements,r=t.length*2,n=1,a=ot.create(e);function i(s,u){var l=t[Math.floor(s/2)],c=l.unit.rings.all[l.ringIndex];return a.unit=l.unit,a.element=l.unit.elements[c[0]],a}function o(s,u){return s%2===1}return Tn(r,n,1,i,!0,o)}function GYe(e,t,r){var n=e.objectId,a=e.groupId;if(r===n){var i=t.carbohydrates.elements[Math.floor(a/2)];return q1(t,i.unit,i.residueIndex,i.altId)}return zr}function qYe(e,t,r){var n=t.carbohydrates.getElementIndices,a=!1;if(!Oe.is(e)||!$e.areEquivalent(e.structure,t))return!1;for(var i=function(d,f){if(!We.isAtomic(d))return"continue";Ne.forEach(f,function(p){for(var h=n(d,d.elements[p]),m=0,v=h.length;m<v;++m)r(Me.ofSingleton(h[m]*2))&&(a=!0)})},o=0,s=e.elements;o<s.length;o++){var u=s[o],l=u.unit,c=u.indices;i(l,c)}return a}function WYe(e,t,r,n,a){var i=t.carbohydrates,o=i.terminalLinks,s=i.elements,u=n.terminalLinkSizeFactor,l=ot.create(t),c={linkCount:o.length,position:function(d,f,p){var h=o[p];h.fromCarbohydrate?(A.copy(d,s[h.carbohydrateIndex].geometry.center),h.elementUnit.conformation.position(h.elementUnit.elements[h.elementIndex],f)):(h.elementUnit.conformation.position(h.elementUnit.elements[h.elementIndex],d),A.copy(f,s[h.carbohydrateIndex].geometry.center))},radius:function(d){var f=o[d];if(f.fromCarbohydrate){var p=s[f.carbohydrateIndex],h=p.unit.rings.all[p.ringIndex];l.unit=p.unit,l.element=p.unit.elements[h[0]]}else l.unit=f.elementUnit,l.element=f.elementUnit.elements[f.elementIndex];return r.size.size(l)*u},style:function(d){var f=o[d],p=f.elementUnit.elements[f.elementIndex],h=g0(f.elementUnit.model.atomicHierarchy.atoms.type_symbol.value(p));return L1.has(h)?1:0}};return Om(e,c,n,a)}var DZ=T(T(T({},wo),Rm),{terminalLinkSizeFactor:M.Numeric(.2,{min:0,max:3,step:.01})});function XYe(e){return Dm({defaultProps:M.getDefaultValues(DZ),createGeometry:WYe,createLocationIterator:YYe,getLoci:KYe,eachLocation:$Ye,setUpdateState:function(t,r,n){t.createGeometry=r.terminalLinkSizeFactor!==n.terminalLinkSizeFactor||r.radialSegments!==n.radialSegments||r.linkCap!==n.linkCap}},e)}function YYe(e){var t=e.carbohydrates,r=t.elements,n=t.terminalLinks,a=n.length,i=1,o=ot.create(e),s=function(u){var l=n[u];if(l.fromCarbohydrate){var c=r[l.carbohydrateIndex],d=c.unit.rings.all[c.ringIndex];o.unit=c.unit,o.element=c.unit.elements[d[0]]}else o.unit=l.elementUnit,o.element=l.elementUnit.elements[l.elementIndex];return o};return Tn(a,i,1,s,!0)}function KYe(e,t,r){var n=e.objectId,a=e.groupId;if(r===n){var i=t.carbohydrates,o=i.terminalLinks,s=i.elements,u=o[a],l=s[u.carbohydrateIndex];return Oe.union(q1(t,l.unit,l.residueIndex,l.altId),UNe(t,u.elementUnit,u.elementUnit.elements[u.elementIndex]))}return zr}function $Ye(e,t,r){var n=!1;if(!Oe.is(e)||!$e.areEquivalent(e.structure,t))return!1;for(var a=t.carbohydrates.getTerminalLinkIndices,i=function(d,f){if(!We.isAtomic(d))return"continue";Ne.forEach(f,function(p){for(var h=a(d,d.elements[p]),m=0,v=h.length;m<v;++m)r(Me.ofSingleton(h[m]))&&(n=!0)})},o=0,s=e.elements;o<s.length;o++){var u=s[o],l=u.unit,c=u.indices;i(l,c)}return n}var kZ={"carbohydrate-symbol":function(e,t){return Qu("Carbohydrate symbol mesh",e,t,HYe)},"carbohydrate-link":function(e,t){return Qu("Carbohydrate link cylinder",e,t,yYe)},"carbohydrate-terminal-link":function(e,t){return Qu("Carbohydrate terminal link cylinder",e,t,XYe)}},RZ=T(T(T(T({},MZ),PZ),DZ),{visuals:M.MultiSelect(["carbohydrate-symbol","carbohydrate-link","carbohydrate-terminal-link"],M.objectToOptions(kZ))});function QYe(e,t){return M.clone(RZ)}function ZYe(e,t){return mr.createMulti("Carbohydrate",e,t,si,kZ)}var JYe={name:"carbohydrate",label:"Carbohydrate",description:"Displays carbohydrate symbols (3D SNFG).",factory:ZYe,getParams:QYe,defaultValues:M.getDefaultValues(RZ),defaultColorTheme:{name:"carbohydrate-symbol"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.models.some(function(t){return rr.hasCarbohydrate(t)})}};function eKe(e,t){switch(t.kind){case 0:return new tKe(e,t);case 1:case 2:return new rKe(e,t)}}function OZ(e,t){return{centerA:ot.create(e,t),centerB:ot.create(e,t)}}var tKe=function(){function e(t,r){this.unit=r,this.hasNext=!1,this.traceElementIndex=r.model.atomicHierarchy.derived.residue.traceElementIndex,this.gapIt=In.transientSegments(UZ(r),r.elements),this.value=OZ(t,r),this.hasNext=this.gapIt.hasNext}return e.prototype.move=function(){var t=this.unit,r=t.elements,n=t.residueIndex,a=this.gapIt.move();return this.value.centerA.element=this.traceElementIndex[n[r[a.start]]],this.value.centerB.element=this.traceElementIndex[n[r[a.end-1]]],this.hasNext=this.gapIt.hasNext,this.value},e}(),rKe=function(){function e(t,r){this.unit=r,this.hasNext=!1,this.gapIt=In.transientSegments(UZ(r),r.elements),this.value=OZ(t,r),this.hasNext=this.gapIt.hasNext}return e.prototype.move=function(){var t=this.gapIt.move();return this.value.centerA.element=this.unit.elements[t.start],this.value.centerB.element=this.unit.elements[t.end-1],this.hasNext=this.gapIt.hasNext,this.value},e}();function jR(e,t,r){switch(r===void 0&&(r=!1),e.kind){case 0:return new nKe(e,t,r);case 1:case 2:return new aKe(e,t)}}var xS=jr.create(536870912);function BZ(e,t){return{center:ot.create(e,t),centerPrev:ot.create(e,t),centerNext:ot.create(e,t),first:!1,last:!1,initial:!1,final:!1,secStrucFirst:!1,secStrucLast:!1,secStrucType:xS,moleculeType:0,coarseBackboneFirst:!1,coarseBackboneLast:!1,isCoarseBackbone:!1,p0:A(),p1:A(),p2:A(),p3:A(),p4:A(),d12:A(),d23:A()}}var Yr=A(),xx=A(),Sx=A(),nKe=function(){function e(t,r,n){n===void 0&&(n=!1);var a;this.unit=t,this.state=0,this.p0=A(),this.p1=A(),this.p2=A(),this.p3=A(),this.p4=A(),this.p5=A(),this.p6=A(),this.d01=A(),this.d12=A(),this.d23=A(),this.d34=A(),this.hasNext=!1,this.atomicConformation=t.model.atomicConformation,this.residueAtomSegments=t.model.atomicHierarchy.residueAtomSegments,this.polymerRanges=t.model.atomicRanges.polymerRanges,this.traceElementIndex=t.model.atomicHierarchy.derived.residue.traceElementIndex,this.directionFromElementIndex=t.model.atomicHierarchy.derived.residue.directionFromElementIndex,this.directionToElementIndex=t.model.atomicHierarchy.derived.residue.directionToElementIndex,this.moleculeType=t.model.atomicHierarchy.derived.residue.moleculeType,this.cyclicPolymerMap=t.model.atomicRanges.cyclicPolymerMap,this.polymerIt=In.transientSegments(this.polymerRanges,t.elements),this.residueIt=pr.transientSegments(this.residueAtomSegments,t.elements),this.value=BZ(r,t),this.hasNext=this.residueIt.hasNext&&this.polymerIt.hasNext;var i=!n&&((a=sc.get(r).value)===null||a===void 0?void 0:a.get(t.invariantId));if(i){var o=i.type,s=i.getIndex;this.getSecStruc=function(u){return o[s(u)]}}else this.getSecStruc=function(u){return xS}}return e.prototype.pos=function(t,r){r!==-1&&(t[0]=this.atomicConformation.x[r],t[1]=this.atomicConformation.y[r],t[2]=this.atomicConformation.z[r])},e.prototype.updateResidueSegmentRange=function(t){var r=this.residueAtomSegments.index;this.residueSegmentMin=r[this.polymerRanges[t.index*2]],this.residueSegmentMax=r[this.polymerRanges[t.index*2+1]]},e.prototype.getResidueIndex=function(t){if(t<this.residueSegmentMin){var r=this.cyclicPolymerMap.get(this.residueSegmentMin);r!==void 0?t=r-(this.residueSegmentMin-t-1):t=this.residueSegmentMin}else if(t>this.residueSegmentMax){var r=this.cyclicPolymerMap.get(this.residueSegmentMax);r!==void 0?t=r+(t-this.residueSegmentMax-1):t=this.residueSegmentMax}return t},e.prototype.setControlPoint=function(t,r,n,a,i){var o=this.getSecStruc(i);jr.is(o,4)?A.scale(t,A.add(t,r,A.add(t,a,A.add(t,n,n))),1/4):A.copy(t,n)},e.prototype.setFromToVector=function(t,r){this.value.isCoarseBackbone?A.set(t,1,0,0):(this.pos(xx,this.directionFromElementIndex[r]),this.pos(Sx,this.directionToElementIndex[r]),A.sub(t,Sx,xx))},e.prototype.setDirection=function(t,r,n,a){A.matchDirection(xx,r,n),A.matchDirection(Sx,a,n),A.scale(t,A.add(t,xx,A.add(t,Sx,A.add(t,n,n))),1/4)},e.prototype.move=function(){var t=this,r=t.residueIt,n=t.polymerIt,a=t.value;if(this.state===0){for(;n.hasNext;)if(this.polymerSegment=n.move(),r.setSegment(this.polymerSegment),this.updateResidueSegmentRange(this.polymerSegment),r.hasNext){this.state=1;var i=this.residueAtomSegments.index[this.unit.elements[this.polymerSegment.start]],o=this.getResidueIndex(i-1);this.currSecStrucType=i===o?xS:this.getSecStruc(o),this.nextSecStrucType=this.getSecStruc(i),this.currCoarseBackbone=this.directionFromElementIndex[o]===-1||this.directionToElementIndex[o]===-1,this.nextCoarseBackbone=this.directionFromElementIndex[i]===-1||this.directionToElementIndex[i]===-1;break}}if(this.state===1){var s=r.move().index,u=this.getResidueIndex(s-3),l=this.getResidueIndex(s-2),c=this.getResidueIndex(s-1),d=this.getResidueIndex(s+1),f=this.getResidueIndex(s+2),p=this.getResidueIndex(s+3);this.prevSecStrucType=this.currSecStrucType,this.currSecStrucType=this.nextSecStrucType,this.nextSecStrucType=s===d?xS:this.getSecStruc(d),this.prevCoarseBackbone=this.currCoarseBackbone,this.currCoarseBackbone=this.nextCoarseBackbone,this.nextCoarseBackbone=s===d?!1:this.directionFromElementIndex[d]===-1||this.directionToElementIndex[d]===-1,a.secStrucType=this.currSecStrucType,a.secStrucFirst=this.prevSecStrucType!==this.currSecStrucType,a.secStrucLast=this.currSecStrucType!==this.nextSecStrucType,a.isCoarseBackbone=this.currCoarseBackbone,a.coarseBackboneFirst=this.prevCoarseBackbone!==this.currCoarseBackbone,a.coarseBackboneLast=this.currCoarseBackbone!==this.nextCoarseBackbone,a.first=s===this.residueSegmentMin,a.last=s===this.residueSegmentMax,a.moleculeType=this.moleculeType[s],a.isCoarseBackbone=this.directionFromElementIndex[s]===-1||this.directionToElementIndex[s]===-1,a.initial=s===c,a.final=s===d,a.centerPrev.element=this.traceElementIndex[c],a.center.element=this.traceElementIndex[s],a.centerNext.element=this.traceElementIndex[d],this.pos(this.p0,this.traceElementIndex[u]),this.pos(this.p1,this.traceElementIndex[l]),this.pos(this.p2,this.traceElementIndex[c]),this.pos(this.p3,this.traceElementIndex[s]),this.pos(this.p4,this.traceElementIndex[d]),this.pos(this.p5,this.traceElementIndex[f]),this.pos(this.p6,this.traceElementIndex[p]),this.setFromToVector(this.d01,c),this.setFromToVector(this.d12,s),this.setFromToVector(this.d23,d),this.setFromToVector(this.d34,f);var h=.5;s===c?(A.scale(Yr,A.sub(Yr,this.p3,this.p4),h),A.add(this.p2,this.p3,Yr),A.add(this.p1,this.p2,Yr),A.add(this.p0,this.p1,Yr)):c===l?(A.scale(Yr,A.sub(Yr,this.p2,this.p3),h),A.add(this.p1,this.p2,Yr),A.add(this.p0,this.p1,Yr)):l===u&&(A.scale(Yr,A.sub(Yr,this.p1,this.p2),h),A.add(this.p0,this.p1,Yr)),s===d?(A.scale(Yr,A.sub(Yr,this.p3,this.p2),h),A.add(this.p4,this.p3,Yr),A.add(this.p5,this.p4,Yr),A.add(this.p6,this.p5,Yr)):d===f?(A.scale(Yr,A.sub(Yr,this.p4,this.p3),h),A.add(this.p5,this.p4,Yr),A.add(this.p6,this.p5,Yr)):f===p&&(A.scale(Yr,A.sub(Yr,this.p5,this.p4),h),A.add(this.p6,this.p5,Yr)),this.setControlPoint(a.p0,this.p0,this.p1,this.p2,l),this.setControlPoint(a.p1,this.p1,this.p2,this.p3,c),this.setControlPoint(a.p2,this.p2,this.p3,this.p4,s),this.setControlPoint(a.p3,this.p3,this.p4,this.p5,d),this.setControlPoint(a.p4,this.p4,this.p5,this.p6,f),this.setDirection(a.d12,this.d01,this.d12,this.d23),this.setDirection(a.d23,this.d12,this.d23,this.d34),r.hasNext||(this.state=0)}return this.hasNext=r.hasNext||n.hasNext,this.value},e}(),aKe=function(){function e(t,r){switch(this.unit=t,this.state=0,this.hasNext=!1,this.polymerIt=In.transientSegments(pKe(t),t.elements),this.value=BZ(r,t),A.set(this.value.d12,1,0,0),A.set(this.value.d23,1,0,0),t.kind){case 1:this.conformation=t.model.coarseConformation.spheres;break;case 2:this.conformation=t.model.coarseConformation.gaussians;break}this.hasNext=this.polymerIt.hasNext}return e.prototype.getElementIndex=function(t){return Math.min(Math.max(this.polymerSegment.start,t),this.polymerSegment.end-1)},e.prototype.pos=function(t,r){var n=this.unit.elements[r];t[0]=this.conformation.x[n],t[1]=this.conformation.y[n],t[2]=this.conformation.z[n]},e.prototype.move=function(){if(this.state===0){for(;this.polymerIt.hasNext;)if(this.polymerSegment=this.polymerIt.move(),this.elementIndex=this.polymerSegment.start,this.elementIndex<this.polymerSegment.end){this.state=1;break}}if(this.state===1){var t=this.getElementIndex(this.elementIndex-2),r=this.getElementIndex(this.elementIndex-1),n=this.getElementIndex(this.elementIndex+1),a=this.getElementIndex(this.elementIndex+2);this.value.centerPrev.element=this.value.center.unit.elements[r],this.value.center.element=this.value.center.unit.elements[this.elementIndex],this.value.centerNext.element=this.value.center.unit.elements[n],this.pos(this.value.p0,t),this.pos(this.value.p1,r),this.pos(this.value.p2,this.elementIndex),this.pos(this.value.p3,n),this.pos(this.value.p4,a);var i=.5;this.elementIndex===r?(A.scale(Yr,A.sub(Yr,this.value.p2,this.value.p3),i),A.add(this.value.p1,this.value.p2,Yr),A.add(this.value.p0,this.value.p1,Yr)):r===t&&(A.scale(Yr,A.sub(Yr,this.value.p1,this.value.p2),i),A.add(this.value.p0,this.value.p1,Yr)),this.elementIndex===n?(A.scale(Yr,A.sub(Yr,this.value.p2,this.value.p1),i),A.add(this.value.p3,this.value.p2,Yr),A.add(this.value.p4,this.value.p3,Yr)):n===a&&(A.scale(Yr,A.sub(Yr,this.value.p3,this.value.p2),i),A.add(this.value.p4,this.value.p3,Yr)),this.value.first=this.elementIndex===this.polymerSegment.start,this.value.last=this.elementIndex===this.polymerSegment.end-1,this.elementIndex+1>=this.polymerSegment.end&&(this.state=0)}return this.hasNext=this.elementIndex+1<this.polymerSegment.end||this.polymerIt.hasNext,this.elementIndex+=1,this.value},e}(),NT=A.fromArray,I3=A.toArray,FZ=A.normalize,iKe=A.sub,uv=A.spline,oKe=A.slerp,Rz=A.copy,sKe=A.cross,zT=A.orthogonalize,uKe=A.matchDirection;function GR(e){var t=e+1,r=t*3;return{curvePoints:new Float32Array(r),tangentVectors:new Float32Array(r),normalVectors:new Float32Array(r),binormalVectors:new Float32Array(r),widthValues:new Float32Array(t),heightValues:new Float32Array(t),linearSegments:e}}function qR(e,t,r,n){lKe(e,t,r,n),dKe(e,t)}var UT=A(),VT=A(),HT=A();function lKe(e,t,r,n){for(var a=e.curvePoints,i=e.tangentVectors,o=e.linearSegments,s=t.p0,u=t.p1,l=t.p2,c=t.p3,d=t.p4,f=t.secStrucFirst,p=t.secStrucLast,h=1-n,m=f?.5:r,v=p?.5:r,g=0;g<=o;++g){var y=g*1/o;if(y<h){var b=fs(m,r,y);uv(HT,s,u,l,c,y+n,b),uv(UT,s,u,l,c,y+n+.01,m),uv(VT,s,u,l,c,y+n-.01,m)}else{var b=fs(r,v,y);uv(HT,u,l,c,d,y-h,b),uv(UT,u,l,c,d,y-h+.01,b),uv(VT,u,l,c,d,y-h-.01,b)}I3(HT,a,g*3),FZ(e0,iKe(e0,UT,VT)),I3(e0,i,g*3)}}var cKe=A(),e0=A(),Cx=A(),jT=A(),GT=A(),Oz=A(),Bz=A(),qT=A(),wx=A();function dKe(e,t){var r=e.curvePoints,n=e.tangentVectors,a=e.normalVectors,i=e.binormalVectors,o=t.d12,s=t.d23,u=r.length/3;NT(Oz,n,0),NT(Bz,n,(u-1)*3),zT(qT,Oz,o),zT(wx,Bz,s),uKe(wx,wx,qT),Rz(GT,qT);for(var l=0;l<u;++l){var c=l===0?0:1/(u-l);NT(e0,n,l*3),zT(Cx,e0,oKe(cKe,GT,wx,c)),I3(Cx,a,l*3),Rz(GT,Cx),FZ(jT,sKe(jT,e0,Cx)),I3(jT,i,l*3)}}function HI(e,t,r,n,a,i,o,s){for(var u=e.widthValues,l=e.heightValues,c=e.linearSegments,d=1-s,f=0;f<=c;++f){var p=f*1/c;p<d?(u[f]=fs(t,r,p+s),l[f]=fs(a,i,p+s)):(u[f]=fs(r,n,p-d),l[f]=fs(i,o,p-d))}}var LZ=.5,fKe=.9,NZ=.5,zZ=.3,M3=2;function pKe(e){switch(e.kind){case 0:return e.model.atomicRanges.polymerRanges;case 1:return e.model.coarseHierarchy.spheres.polymerRanges;case 2:return e.model.coarseHierarchy.gaussians.polymerRanges}}function UZ(e){switch(e.kind){case 0:return e.model.atomicRanges.gapRanges;case 1:return e.model.coarseHierarchy.spheres.gapRanges;case 2:return e.model.coarseHierarchy.gaussians.gapRanges}}var X1;(function(e){function t(r){var n=r.group,a=r.structure,i=n.units[0].polymerElements,o=i.length,s=n.units.length,u=ot.create(a),l=function(c,d){var f=n.units[d];return u.unit=f,u.element=i[c],u};return Tn(o,s,1,l)}e.fromGroup=t})(X1||(X1={}));var jI;(function(e){function t(r){var n=r.group,a=r.structure,i=n.units[0].gapElements,o=i.length,s=n.units.length,u=ot.create(a),l=function(c,d){var f=n.units[d];return u.unit=f,u.element=i[c],u};return Tn(o,s,1,l)}e.fromGroup=t})(jI||(jI={}));function WR(e,t,r){var n=e.objectId,a=e.instanceId,i=e.groupId;if(r===n){var o=t.structure,s=t.group,u=s.units[a];if(We.isAtomic(u))return B$(o,u,u.polymerElements[i]);var l=u.elements,c=u.polymerElements[i],d=Ne.indexOf(l,c);if(d!==-1){var f=Ne.ofSingleton(d);return Oe(o,[{unit:u,indices:f}])}}return zr}function Fz(e,t,r,n,a,i){for(var o=-1,s=-1,u=a;u<=i;u++){var l=r[u];if(!(l<0)&&(o=Ne.indexOf(t,l),o>=0)){s=u;break}}if(o<0)return!1;for(var c=o,u=i;u>s;u--){var l=r[u];if(!(l<0)){var d=Ne.indexOf(t,l);if(d>=0){c=d;break}}}return n(Me.ofRange(e+o,e+c))}function VZ(e,t,r,n,a){var i=!1,o=a.unit.elements,s=a.unit.model.atomicHierarchy.derived.residue.traceElementIndex,u=a.unit.model.atomicHierarchy.residueAtomSegments.index,l=r(a.unit);if(Me.is(a.indices))if(Me.start(a.indices)===0&&Me.end(a.indices)===a.unit.elements.length)i=n(Me.ofBounds(e,e+t))||i;else{var c=u[o[Me.min(a.indices)]],d=u[o[Me.max(a.indices)]];i=Fz(e,l,s,n,c,d)||i}else for(var f=a.indices,p=0,h=f.length;p<h;p++){for(var c=u[o[f[p]]],d=c,m=p+1;m<h;){var v=u[o[f[m]]];if(v-d>1)break;d=v,m++}p=m-1,i=Fz(e,l,s,n,c,d)||i}return i}function hKe(e){return e.polymerElements}function XR(e,t,r){var n=!1;if(!Oe.is(e))return!1;var a=t.structure,i=t.group;if(!$e.areEquivalent(e.structure,a))return!1;for(var o=i.units[0].polymerElements.length,s=0,u=e.elements;s<u.length;s++){var l=u[s];if(!!i.unitIndexMap.has(l.unit.id)){var c=i.unitIndexMap.get(l.unit.id)*o;if(We.isAtomic(l.unit))n=VZ(c,o,hKe,r,l)||n;else if(Me.is(l.indices)){var d=c+Me.start(l.indices),f=c+Me.end(l.indices);n=r(Me.ofBounds(d,f))||n}else for(var p=0,h=l.indices.length;p<h;p++){for(var d=l.indices[p],m=p+1;m<h&&l.indices[m]===d;)m++;p=m-1;var f=l.indices[p];n=r(Me.ofRange(c+d,c+f))||n}}}return n}function mKe(e,t,r){var n=e.objectId,a=e.instanceId,i=e.groupId;if(r===n){var o=t.structure,s=t.group,u=s.units[a],l=Ne.indexOf(u.elements,u.gapElements[i]),c=Ne.indexOf(u.elements,u.gapElements[i%2?i-1:i+1]);if(l!==-1&&c!==-1)return $t.Loci(o,[$t.Location(o,u,l,o,u,c),$t.Location(o,u,c,o,u,l)])}return zr}function vKe(e,t,r){var n=!1;if($t.isLoci(e)){var a=t.structure,i=t.group;if(!$e.areRootsEquivalent(e.structure,a))return!1;e=$t.remapLoci(e,a);for(var o=i.units[0].gapElements.length,s=0,u=e.bonds;s<u.length;s++){var l=u[s],c=i.unitIndexMap.get(l.aUnit.id);if(c!==void 0){var d=Ne.indexOf(l.aUnit.gapElements,l.aUnit.elements[l.aIndex]),f=Ne.indexOf(l.bUnit.gapElements,l.bUnit.elements[l.bIndex]);d!==-1&&f!==-1&&r(Me.ofSingleton(c*o+d))&&(n=!0)}}}else if(Oe.is(e)){var a=t.structure,i=t.group;if(!$e.areRootsEquivalent(e.structure,a))return!1;e=Oe.remap(e,a);for(var p=i.units[0].gapElements.length,h=function(S){var x=i.unitIndexMap.get(S.unit.id);x!==void 0&&Ne.forEach(S.indices,function(C){var w=Ne.indexOf(S.unit.gapElements,S.unit.elements[C]);w!==-1&&r(Me.ofSingleton(x*p+w))&&(n=!0)})},m=0,v=e.elements;m<v.length;m++){var g=v[m];h(g)}}return n}var D3;(function(e){function t(r){var n=r.group,a=r.structure,i=n.units[0],o=We.isAtomic(i)?i.nucleotideElements:[],s=o.length,u=n.units.length,l=ot.create(a),c=function(d,f){var p=n.units[f];return l.unit=p,l.element=o[d],l};return Tn(s,u,1,c)}e.fromGroup=t})(D3||(D3={}));function HZ(e,t,r){var n=e.objectId,a=e.instanceId,i=e.groupId;if(r===n){var o=t.structure,s=t.group,u=s.units[a];if(We.isAtomic(u))return B$(o,u,u.nucleotideElements[i])}return zr}function gKe(e){return e.nucleotideElements}function jZ(e,t,r){var n=!1;if(!Oe.is(e))return!1;var a=t.structure,i=t.group;if(!$e.areEquivalent(e.structure,a))return!1;var o=i.units[0];if(!We.isAtomic(o))return!1;for(var s=o.nucleotideElements,u=s.length,l=0,c=e.elements;l<c.length;l++){var d=c[l];if(!!We.isAtomic(d.unit)&&!!i.unitIndexMap.has(d.unit.id)){var f=i.unitIndexMap.get(d.unit.id)*u;We.isAtomic(d.unit)&&(n=VZ(f,u,gKe,r,d)||n)}}return n}var Ng=A.zero(),_x=A.zero(),Lz=A.zero(),Nz=A.zero(),zz=A.zero(),Uz=A.zero(),Ax=A.zero(),WT=A.zero(),XT=A.zero(),Vz=A.zero(),zg=de.identity(),yKe=A.zero(),Hz=yk(),GZ={sizeFactor:M.Numeric(.2,{min:0,max:10,step:.01}),radialSegments:M.Numeric(16,{min:2,max:56,step:2},Dt.CustomQualityParamInfo)};M.getDefaultValues(GZ);function bKe(e,t,r,n,a,i){if(!We.isAtomic(t))return Wt.createEmpty(i);var o=t.nucleotideElements.length;if(!o)return Wt.createEmpty(i);for(var s=a.sizeFactor,u=a.radialSegments,l=o*(Hz.vertices.length/3+u*2),c=kt.createState(l,l/4,i),d=t.elements,f=t.model,p=f.atomicHierarchy,h=p.chainAtomSegments,m=p.residueAtomSegments,v=p.atoms,g=p.index,y=f.atomicHierarchy.derived.residue,b=y.moleculeType,S=y.traceElementIndex,x=v.label_comp_id,C=t.conformation.invariantPosition,w=pr.transientSegments(h,d),_=pr.transientSegments(m,d),E={radiusTop:1*s,radiusBottom:1*s,radialSegments:u,bottomCap:!0},P=0;w.hasNext;)for(_.setSegment(w.move());_.hasNext;){var D=_.move().index;if(kp(b[D])){var k=x.value(m.offsets[D]),F=-1,X=-1,U=-1,j=-1,te=-1,q=-1,W=4.5,V=4.5,ee=2.5*s,ue=wX(k),$=_X(k);if(!ue&&!$){var Q=g.findAtomOnResidue(D,"C4"),R=g.findAtomOnResidue(D,"N9");Q!==-1&&R!==-1&&A.distance(C(Q,Ng),C(R,_x))<1.6?ue=!0:$=!0}ue?(V=4.5,F=g.findAtomOnResidue(D,"N1"),X=g.findAtomOnResidue(D,"C4"),U=g.findAtomOnResidue(D,"C6"),j=g.findAtomOnResidue(D,"C2"),te=g.findAtomOnResidue(D,"N9"),q=S[D]):$&&(V=3,F=g.findAtomOnResidue(D,"N3"),X=g.findAtomOnResidue(D,"C6"),U=g.findAtomOnResidue(D,"C4"),j=g.findAtomOnResidue(D,"C2"),te=g.findAtomOnResidue(D,"N1"),te===-1&&(te=g.findAtomOnResidue(D,"C1")),q=S[D]),te!==-1&&q!==-1&&(C(te,zz),C(q,Uz),c.currentGroup=P,gs(c,zz,Uz,1,E),F!==-1&&X!==-1&&U!==-1&&j!==-1&&(C(F,Ng),C(X,_x),C(U,Lz),C(j,Nz),A.normalize(Ax,A.sub(Ax,_x,Ng)),A.normalize(WT,A.sub(WT,Nz,Lz)),A.normalize(XT,A.cross(XT,Ax,WT)),de.targetTo(zg,Ng,_x,XT),A.scaleAndAdd(Vz,Ng,Ax,V/2-.2),de.scale(zg,zg,A.set(yKe,W,ee,V)),de.setTranslation(zg,Vz),kt.addPrimitive(c,zg,Hz))),++P}}var Y=kt.getMesh(c),re=He.expand(He(),t.boundary.sphere,1*a.sizeFactor);return Y.setBoundingSphere(re),Y}var qZ=T(T({},wo),GZ);function xKe(e){return Rs({defaultProps:M.getDefaultValues(qZ),createGeometry:bKe,createLocationIterator:D3.fromGroup,getLoci:HZ,eachLocation:jZ,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.radialSegments!==n.radialSegments}},e)}var Tx=A.zero(),mf=A.zero(),Ex=A.zero(),Px=A.zero(),sh=A.zero(),lv=A.zero(),Ix=A.zero(),jz=A.zero(),Gz=A.zero(),Ug=A.zero(),vf=A.zero(),WZ={sizeFactor:M.Numeric(.2,{min:0,max:10,step:.01}),radialSegments:M.Numeric(16,{min:2,max:56,step:2},Dt.CustomQualityParamInfo),detail:M.Numeric(0,{min:0,max:3,step:1},Dt.CustomQualityParamInfo)};M.getDefaultValues(WZ);var Mx=new Float32Array(2*9*3),SKe=new Uint32Array([0,1,2,3,4,5,6,7,16,17,14,15,12,13,8,9,10,11,0,1]),CKe=new Uint32Array([8,12,14,16,6,4,2,0,10]),wKe=new Uint32Array([9,11,1,3,5,7,17,15,13]),Dx=new Float32Array(2*6*3),_Ke=new Uint32Array([0,1,2,3,4,5,6,7,8,9,10,11,0,1]),AKe=new Uint32Array([0,10,8,6,4,2]),TKe=new Uint32Array([1,3,5,7,9,11]),qz=A.zero();function Wz(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];for(var a=0,i=r.length;a<i;++a){var o=r[a];A.toArray(A.add(qz,o,t),e,a*2*3),A.toArray(A.sub(qz,o,t),e,(a*2+1)*3)}}function EKe(e,t,r,n,a,i){if(!We.isAtomic(t))return Wt.createEmpty(i);var o=t.nucleotideElements.length;if(!o)return Wt.createEmpty(i);for(var s=a.sizeFactor,u=a.radialSegments,l=a.detail,c=o*(26+u*2),d=kt.createState(c,c/4,i),f=t.elements,p=t.model,h=p.atomicHierarchy,m=h.chainAtomSegments,v=h.residueAtomSegments,g=h.atoms,y=h.index,b=p.atomicHierarchy.derived.residue,S=b.moleculeType,x=b.traceElementIndex,C=g.label_comp_id,w=t.conformation.invariantPosition,_=pr.transientSegments(m,f),E=pr.transientSegments(v,f),P=1*s,D=1.25*s,k={radiusTop:1*s,radiusBottom:1*s,radialSegments:u},F=0;_.hasNext;)for(E.setSegment(_.move());E.hasNext;){var X=E.move().index;if(kp(S[X])){var U=C.value(v.offsets[X]),j=-1,te=-1,q=-1,W=-1,V=-1,ee=-1,ue=-1,$=-1,Q=-1,R=-1;d.currentGroup=F;var Y=wX(U),re=_X(U);if(!Y&&!re){var K=y.findAtomOnResidue(X,"C4"),L=y.findAtomOnResidue(X,"N9");K!==-1&&L!==-1&&A.distance(w(K,sh),w(L,Ug))<1.6?Y=!0:re=!0}Y?(j=x[X],te=y.findAtomOnResidue(X,"N1"),q=y.findAtomOnResidue(X,"C2"),W=y.findAtomOnResidue(X,"N3"),V=y.findAtomOnResidue(X,"C4"),ee=y.findAtomOnResidue(X,"C5"),ee===-1&&(ee=y.findAtomOnResidue(X,"N5")),ue=y.findAtomOnResidue(X,"C6"),$=y.findAtomOnResidue(X,"N7"),$===-1&&($=y.findAtomOnResidue(X,"C7")),Q=y.findAtomOnResidue(X,"C8"),R=y.findAtomOnResidue(X,"N9"),R!==-1&&j!==-1&&(w(R,Ug),w(j,Tx),d.currentGroup=F,gs(d,Ug,Tx,1,k),ti(d,Ug,P,l)),te!==-1&&q!==-1&&W!==-1&&V!==-1&&ee!==-1&&ue!==-1&&$!==-1&&Q!==-1&&R!==-1&&(w(te,mf),w(q,Ex),w(W,Px),w(V,sh),w(ee,lv),w(ue,Ix),w($,jz),w(Q,Gz),A.triangleNormal(vf,mf,sh,lv),A.scale(vf,vf,D),Wz(Mx,vf,mf,Ex,Px,sh,lv,Ix,jz,Gz,Ug),kt.addTriangleStrip(d,Mx,SKe),kt.addTriangleFan(d,Mx,CKe),kt.addTriangleFan(d,Mx,wKe))):re&&(j=x[X],te=y.findAtomOnResidue(X,"N1"),te===-1&&(te=y.findAtomOnResidue(X,"C1")),q=y.findAtomOnResidue(X,"C2"),W=y.findAtomOnResidue(X,"N3"),V=y.findAtomOnResidue(X,"C4"),ee=y.findAtomOnResidue(X,"C5"),ue=y.findAtomOnResidue(X,"C6"),te!==-1&&j!==-1&&(w(te,mf),w(j,Tx),d.currentGroup=F,gs(d,mf,Tx,1,k),ti(d,mf,P,l)),te!==-1&&q!==-1&&W!==-1&&V!==-1&&ee!==-1&&ue!==-1&&(w(q,Ex),w(W,Px),w(V,sh),w(ee,lv),w(ue,Ix),A.triangleNormal(vf,mf,sh,lv),A.scale(vf,vf,D),Wz(Dx,vf,mf,Ex,Px,sh,lv,Ix),kt.addTriangleStrip(d,Dx,_Ke),kt.addTriangleFan(d,Dx,AKe),kt.addTriangleFan(d,Dx,TKe))),++F}}var H=kt.getMesh(d),Z=He.expand(He(),t.boundary.sphere,1*a.sizeFactor);return H.setBoundingSphere(Z),H}var XZ=T(T({},wo),WZ);function PKe(e){return Rs({defaultProps:M.getDefaultValues(XZ),createGeometry:EKe,createLocationIterator:D3.fromGroup,getLoci:HZ,eachLocation:jZ,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.radialSegments!==n.radialSegments}},e)}var uh=A.zero(),cv=A.zero(),lh=A.zero(),Xz=A.zero(),za=dc(3,!1);function IKe(){for(var e=N0(8),t=0;t<3;++t){var r=(t+1)%3;A.set(uh,za[t*3],za[t*3+1],-.5),A.set(cv,za[r*3],za[r*3+1],-.5),A.set(lh,za[r*3],za[r*3+1],.5),A.set(Xz,za[t*3],za[t*3+1],.5),e.add(uh,cv,lh),e.add(lh,Xz,uh)}return A.set(uh,za[0],za[1],-.5),A.set(cv,za[3],za[4],-.5),A.set(lh,za[6],za[7],-.5),e.add(lh,cv,uh),A.set(uh,za[0],za[1],.5),A.set(cv,za[3],za[4],.5),A.set(lh,za[6],za[7],.5),e.add(uh,cv,lh),e.getPrimitive()}var YT;function MKe(){return YT||(YT=IKe()),YT}var ch=de.identity(),DKe=A.zero(),Yz=A.zero(),Kz=A.zero(),KT=A.zero(),kKe=4,RKe=4,OKe=6,BKe=MKe(),YZ={sizeFactor:M.Numeric(.2,{min:0,max:10,step:.01})};M.getDefaultValues(YZ);function FKe(e,t,r,n,a,i){var o=t.polymerElements.length;if(!o)return Wt.createEmpty(i);for(var s=a.sizeFactor,u=o*24,l=kt.createState(u,u/10,i),c=1,d=GR(c),f=d.normalVectors,p=d.binormalVectors,h=0,m=jR(t,r);m.hasNext;){var v=m.move();l.currentGroup=h;var g=kp(v.moleculeType),y=jr.is(v.secStrucType,4),b=g||y?.5:.9,S=g?.3:.5;if(qR(d,v,b,S),y&&!v.secStrucLast||!y){var x=n.size.size(v.center)*s,C=kKe*x,w=RKe*x,_=OKe*x,E=g?p:f;A.fromArray(Yz,E,0),A.fromArray(Kz,E,3),A.normalize(KT,A.add(KT,Yz,Kz)),de.targetTo(ch,v.p3,v.p1,KT),de.mul(ch,ch,de.rotY90Z180),de.scale(ch,ch,A.set(DKe,_,w,C)),de.setTranslation(ch,v.p2),kt.addPrimitive(l,ch,BKe)}++h}var P=kt.getMesh(l),D=He.expand(He(),t.boundary.sphere,1*a.sizeFactor);return P.setBoundingSphere(D),P}var KZ=T(T({},wo),YZ);function LKe(e){return Rs({defaultProps:M.getDefaultValues(KZ),createGeometry:FKe,createLocationIterator:X1.fromGroup,getLoci:WR,eachLocation:XR,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor}},e)}var $T=10,$Z={sizeFactor:M.Numeric(.2,{min:0,max:10,step:.01}),radialSegments:M.Numeric(16,{min:2,max:56,step:2},Dt.CustomQualityParamInfo)};M.getDefaultValues($Z);function NKe(e,t,r,n,a,i){var o=t.gapElements.length;if(!o)return Wt.createEmpty(i);for(var s=a.sizeFactor,u=a.radialSegments,l=$T*u*2*o*2,c=kt.createState(l,l/10,i),d=t.conformation.invariantPosition,f=A.zero(),p=A.zero(),h={radiusTop:1,radiusBottom:1,topCap:!0,bottomCap:!0,radialSegments:u},m=0,v=eKe(r,t);v.hasNext;){var g=v.move(),y=g.centerA,b=g.centerB;y.element===b.element||(d(y.element,f),d(b.element,p),h.radiusTop=h.radiusBottom=n.size.size(y)*s,c.currentGroup=m,f5(c,f,p,.5,$T,h),h.radiusTop=h.radiusBottom=n.size.size(b)*s,c.currentGroup=m+1,f5(c,p,f,.5,$T,h)),m+=2}var S=kt.getMesh(c),x=He.expand(He(),t.boundary.sphere,1*a.sizeFactor);return S.setBoundingSphere(x),S}var YR=T(T({},wo),$Z);function QZ(e){return Rs({defaultProps:M.getDefaultValues(YR),createGeometry:NKe,createLocationIterator:jI.fromGroup,getLoci:mKe,eachLocation:vKe,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.radialSegments!==n.radialSegments}},e)}var Br=A(),en=A(),zKe=A(),cs=A(),Il=A(),kx=A(),Rx=A(),Vg=A(),zu=A(),Bh=A(),QT=A(),gf=A(),yf=A(),bf=A(),xf=A(),Ys=A.fromArray,t0=A.scale,$s=A.add,Gc=A.sub,UKe=A.magnitude,$z=A.negate,GI=A.copy,ZZ=A.cross,VKe=A.set,bn=Ke.add3,HKe=Ke.add;function Ox(e,t,r,n,a,i,o,s){var u=t.vertices,l=t.normals,c=t.indices,d=u.elementCount;Ys(Br,n,e),t0(Rx,Br,o),t0(kx,Br,s),Ys(en,a,e),t0(cs,en,i),ZZ(Bh,en,Br),Ys(zu,r,e),$s(gf,$s(gf,zu,cs),kx),Gc(yf,$s(yf,zu,cs),Rx),Gc(bf,Gc(bf,zu,cs),Rx),$s(xf,Gc(xf,zu,cs),kx),o<s?(bn(u,xf[0],xf[1],xf[2]),bn(u,bf[0],bf[1],bf[2]),bn(u,yf[0],yf[1],yf[2]),bn(u,gf[0],gf[1],gf[2]),GI(Il,kx)):(bn(u,gf[0],gf[1],gf[2]),bn(u,yf[0],yf[1],yf[2]),bn(u,bf[0],bf[1],bf[2]),bn(u,xf[0],xf[1],xf[2]),GI(Il,Rx));for(var f=0;f<4;++f)bn(l,Bh[0],Bh[1],Bh[2]);bn(c,d+2,d+1,d),bn(c,d,d+3,d+2)}function qI(e,t,r,n,a,i,o,s,u,l){var c=e.currentGroup,d=e.vertices,f=e.normals,p=e.indices,h=e.groups,m=d.elementCount,v=0;s>0?(Ys(Br,t,0),Ys(en,t,a*3),v=s/UKe(Gc(zKe,en,Br))):VKe(Vg,0,0,0);for(var g=0;g<=a;++g){var y=i[g],b=o[g],S=s===0?b:s*(1-g/a),x=g*3;Ys(Il,r,x),t0(Il,Il,S),Ys(cs,n,x),t0(cs,cs,y),s>0&&(Ys(Br,r,x),Ys(en,n,x),t0(Vg,ZZ(Vg,Br,en),v)),Ys(zu,t,x),Ys(Bh,r,x),Ys(QT,n,x),$s(Br,$s(Br,zu,cs),Il),$s(en,Bh,Vg),bn(d,Br[0],Br[1],Br[2]),bn(f,en[0],en[1],en[2]),$s(Br,Gc(Br,zu,cs),Il),bn(d,Br[0],Br[1],Br[2]),bn(f,en[0],en[1],en[2]),$z(en,QT),bn(d,Br[0],Br[1],Br[2]),bn(f,en[0],en[1],en[2]),Gc(Br,Gc(Br,zu,cs),Il),bn(d,Br[0],Br[1],Br[2]),bn(f,en[0],en[1],en[2]),$s(en,$z(en,Bh),Vg),bn(d,Br[0],Br[1],Br[2]),bn(f,en[0],en[1],en[2]),Gc(Br,$s(Br,zu,cs),Il),bn(d,Br[0],Br[1],Br[2]),bn(f,en[0],en[1],en[2]),GI(en,QT),bn(d,Br[0],Br[1],Br[2]),bn(f,en[0],en[1],en[2]),$s(Br,$s(Br,zu,cs),Il),bn(d,Br[0],Br[1],Br[2]),bn(f,en[0],en[1],en[2])}for(var g=0;g<a;++g){for(var C=0;C<2;C++)bn(p,m+g*8+2*C,m+(g+1)*8+2*C+1,m+g*8+2*C+1),bn(p,m+g*8+2*C,m+(g+1)*8+2*C,m+(g+1)*8+2*C+1);for(var C=2;C<4;C++)bn(p,m+g*8+2*C,m+(g+1)*8+2*C,m+g*8+2*C+1),bn(p,m+(g+1)*8+2*C,m+(g+1)*8+2*C+1,m+g*8+2*C+1)}if(u){var y=i[0],b=o[0],w=s===0?b:s;Ox(0,e,t,r,n,y,w,w)}else if(s>0){var y=i[0],b=o[0];Ox(0,e,t,r,n,y,s,-b),Ox(0,e,t,r,n,y,-s,b)}if(l&&s===0){var y=i[a],b=o[a];Ox(a*3,e,t,r,n,y,-b,-b)}for(var _=(a+1)*8+(u?4:s>0?8:0)+(l&&s===0?4:0),g=0,E=_;g<E;++g)HKe(h,c)}var ta=A(),js=A(),Gs=A(),kc=A(),_l=A();function jKe(e,t,r,n,a){e[0]=t[0]*n+r[0]*a,e[1]=t[1]*n+r[1]*a,e[2]=t[2]*n+r[2]*a}function ZT(e,t,r,n,a,i){e[0]=t[0]*a+r[0]*i+n[0],e[1]=t[1]*a+r[1]*i+n[1],e[2]=t[2]*a+r[2]*i+n[2]}var Rc=A.fromArray,Qz=A.normalize,GKe=A.negate,qKe=A.copy,Zz=A.cross,Mo=Ke.add3,JT=new Map;function WKe(e){if(!JT.has(e)){for(var t=[],r=[],n=0;n<e;++n){var a=2*Math.PI*n/e;t[n]=Math.cos(a),r[n]=Math.sin(a)}JT.set(e,{cos:t,sin:r})}return JT.get(e)}function JZ(e,t,r,n,a,i,o,s,u,l){for(var c=e.currentGroup,d=e.vertices,f=e.normals,p=e.indices,h=e.groups,m=d.elementCount,v=WKe(i),g=v.cos,y=v.sin,b=0;b<=a;++b){var S=b*3;Rc(kc,r,S),Rc(_l,n,S),Rc(Gs,t,S);for(var x=o[b],C=s[b],w=0;w<i;++w)ZT(js,kc,_l,Gs,C*g[w],x*y[w]),i===2?(qKe(ta,_l),Qz(ta,ta),(w!==0||b%2===0)&&GKe(ta,ta)):jKe(ta,kc,_l,x*g[w],C*y[w]),Qz(ta,ta),Mo(d,js[0],js[1],js[2]),Mo(f,ta[0],ta[1],ta[2])}for(var b=0;b<a;++b)for(var w=0;w<i;++w)Mo(p,m+b*i+(w+1)%i,m+(b+1)*i+(w+1)%i,m+b*i+w),Mo(p,m+(b+1)*i+(w+1)%i,m+(b+1)*i+w,m+b*i+w);if(u){var _=0,E=d.elementCount;Rc(kc,r,_),Rc(_l,n,_),Rc(Gs,t,_),Zz(ta,_l,kc),Mo(d,Gs[0],Gs[1],Gs[2]),Mo(f,ta[0],ta[1],ta[2]);var x=o[0],C=s[0];m=d.elementCount;for(var b=0;b<i;++b)ZT(js,kc,_l,Gs,C*g[b],x*y[b]),Mo(d,js[0],js[1],js[2]),Mo(f,ta[0],ta[1],ta[2]),Mo(p,m+(b+1)%i,m+b,E)}if(l){var _=a*3,E=d.elementCount;Rc(kc,r,_),Rc(_l,n,_),Rc(Gs,t,_),Zz(ta,kc,_l),Mo(d,Gs[0],Gs[1],Gs[2]),Mo(f,ta[0],ta[1],ta[2]);var x=o[a],C=s[a];m=d.elementCount;for(var b=0;b<i;++b)ZT(js,kc,_l,Gs,C*g[b],x*y[b]),Mo(d,js[0],js[1],js[2]),Mo(f,ta[0],ta[1],ta[2]),Mo(p,m+b,m+(b+1)%i,E)}var P=(a+1)*i+(u?i+1:0)+(l?i+1:0);Ke.addRepeat(h,P,c)}var Oc=A.fromArray,XKe=A.magnitude,eE=A.sub,Jz=A.add,tE=A.scale,YKe=A.negate,KKe=A.copy,$Ke=A.cross,qs=Ke.add3,QKe=Ke.add,Ua=A(),fi=A(),ZKe=A(),rE=A(),dh=A(),eU=A(),Hg=A(),JKe=A(),nE=A();function SS(e,t,r,n,a,i,o,s){var u=e.currentGroup,l=e.vertices,c=e.normals,d=e.indices,f=e.groups,p=l.elementCount,h=0;s>0&&(Oc(Ua,t,0),Oc(fi,t,a*3),h=s/XKe(eE(ZKe,fi,Ua)));for(var m=0;m<=a;++m){var v=i[m],g=o[m],y=s===0?g:s*(1-m/a),b=m*3;Oc(dh,r,b),tE(dh,dh,y),Oc(rE,n,b),tE(rE,rE,v),s>0&&(Oc(Ua,r,b),Oc(fi,n,b),tE(eU,$Ke(eU,Ua,fi),h)),Oc(Hg,t,b),Oc(JKe,r,b),Oc(nE,n,b),Jz(Ua,Hg,dh),YKe(fi,nE),qs(l,Ua[0],Ua[1],Ua[2]),qs(c,fi[0],fi[1],fi[2]),eE(Ua,Hg,dh),qs(l,Ua[0],Ua[1],Ua[2]),qs(c,fi[0],fi[1],fi[2]),Jz(Ua,Hg,dh),KKe(fi,nE),qs(l,Ua[0],Ua[1],Ua[2]),qs(c,fi[0],fi[1],fi[2]),eE(Ua,Hg,dh),qs(l,Ua[0],Ua[1],Ua[2]),qs(c,fi[0],fi[1],fi[2])}for(var m=0;m<a;++m)qs(d,p+m*4,p+(m+1)*4+1,p+m*4+1),qs(d,p+m*4,p+(m+1)*4,p+(m+1)*4+1),qs(d,p+m*4+2+1,p+(m+1)*4+2+1,p+m*4+2),qs(d,p+m*4+2,p+(m+1)*4+2+1,p+(m+1)*4+2);for(var S=(a+1)*4,m=0,x=S;m<x;++m)QKe(f,u)}var eJ={sizeFactor:M.Numeric(.2,{min:0,max:10,step:.01}),aspectRatio:M.Numeric(5,{min:.1,max:10,step:.1}),arrowFactor:M.Numeric(1.5,{min:0,max:3,step:.1}),detail:M.Numeric(0,{min:0,max:3,step:1},Dt.CustomQualityParamInfo),linearSegments:M.Numeric(8,{min:1,max:48,step:1},Dt.CustomQualityParamInfo),radialSegments:M.Numeric(16,{min:2,max:56,step:2},Dt.CustomQualityParamInfo)};M.getDefaultValues(eJ);var Do=A();function e$e(e,t,r,n,a,i){var o,s,u,l=t.polymerElements.length;if(!l)return Wt.createEmpty(i);for(var c=a.sizeFactor,d=a.detail,f=a.linearSegments,p=a.radialSegments,h=a.aspectRatio,m=a.arrowFactor,v=f*p*l+(p+1)*l*2,g=kt.createState(v,v/10,i),y=We.isCoarse(t),b=GR(f),S=b.curvePoints,x=b.normalVectors,C=b.binormalVectors,w=b.widthValues,_=b.heightValues,E=0,P=jR(t,r);P.hasNext;){var D=P.move();g.currentGroup=E;var k=kp(D.moleculeType),F=jr.is(D.secStrucType,4),X=jr.is(D.secStrucType,2),U=X?fKe:LZ,j=k?zZ:NZ;qR(b,D,U,j);var te=n.size.size(D.centerPrev)*c,q=n.size.size(D.center)*c,W=n.size.size(D.centerNext)*c;y&&(te*=h/2,q*=h/2,W*=h/2);var V=D.secStrucFirst||D.coarseBackboneFirst||D.first,ee=D.secStrucLast||D.coarseBackboneLast||D.last,ue=f;if(D.initial){ue=Math.max(Math.round(f*j),1);var $=f-ue;S.copyWithin(0,$*3),C.copyWithin(0,$*3),x.copyWithin(0,$*3),A.fromArray(Do,S,3),A.normalize(Do,A.sub(Do,D.p2,Do)),A.scaleAndAdd(Do,D.p2,Do,q*M3),A.toArray(Do,S,0)}else D.final&&(ue=Math.max(Math.round(f*(1-j)),1),A.fromArray(Do,S,ue*3-3),A.normalize(Do,A.sub(Do,D.p2,Do)),A.scaleAndAdd(Do,D.p2,Do,q*M3),A.toArray(Do,S,ue*3));if(D.initial===!0&&D.final===!0)ti(g,D.p2,q*2,d);else if(F){var Q=te*h,R=q*h,Y=W*h,re=D.secStrucLast?R*m:0;HI(b,te,q,W,Q,R,Y,j),p===2?SS(g,S,x,C,ue,w,_,re):qI(g,S,x,C,ue,w,_,re,V,ee)}else{var Q=void 0,R=void 0,Y=void 0;if(X&&!D.isCoarseBackbone?(Q=te*h,R=q*h,Y=W*h):k&&!D.isCoarseBackbone?(Q=te*h,R=q*h,Y=W*h,o=[Q,te],te=o[0],Q=o[1],s=[R,q],q=s[0],R=s[1],u=[Y,W],W=u[0],Y=u[1]):(Q=te,R=q,Y=W),HI(b,te,q,W,Q,R,Y,j),p===2)if(k&&!D.isCoarseBackbone){for(var K=0,L=C.length;K<L;K++)C[K]*=-1;SS(g,S,C,x,ue,_,w,0)}else SS(g,S,x,C,ue,w,_,0);else p===4?qI(g,S,x,C,ue,w,_,0,V,ee):JZ(g,S,x,C,ue,p,w,_,V,ee)}++E}var H=kt.getMesh(g),Z=He.expand(He(),t.boundary.sphere,1*a.sizeFactor);return H.setBoundingSphere(Z),H}var tJ=T(T({},wo),eJ);function t$e(e){return Rs({defaultProps:M.getDefaultValues(tJ),createGeometry:e$e,createLocationIterator:X1.fromGroup,getLoci:WR,eachLocation:XR,setUpdateState:function(t,r,n,a,i,o,s){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail||r.linearSegments!==n.linearSegments||r.radialSegments!==n.radialSegments||r.aspectRatio!==n.aspectRatio||r.arrowFactor!==n.arrowFactor;var u=sc.get(o.structure).version;t.info.secondaryStructureHash!==u&&(t.createGeometry=!0,t.info.secondaryStructureHash=u)}},e)}var rJ={"polymer-trace":function(e,t){return Ba("Polymer trace mesh",e,t,t$e)},"polymer-gap":function(e,t){return Ba("Polymer gap cylinder",e,t,QZ)},"nucleotide-block":function(e,t){return Ba("Nucleotide block mesh",e,t,xKe)},"nucleotide-ring":function(e,t){return Ba("Nucleotide ring mesh",e,t,PKe)},"direction-wedge":function(e,t){return Ba("Polymer direction wedge",e,t,LKe)}},nJ=T(T(T(T(T(T({},tJ),YR),qZ),XZ),KZ),{sizeFactor:M.Numeric(.2,{min:0,max:10,step:.01}),visuals:M.MultiSelect(["polymer-trace","polymer-gap","nucleotide-block"],M.objectToOptions(rJ))});function r$e(e,t){var r=M.clone(nJ),n=!1,a=!1;return t.units.forEach(function(i){!n&&We.isAtomic(i)&&i.nucleotideElements.length&&(n=!0),!a&&i.gapElements.length&&(a=!0)}),r.visuals.defaultValue=["polymer-trace"],n&&r.visuals.defaultValue.push("nucleotide-block"),a&&r.visuals.defaultValue.push("polymer-gap"),r}function n$e(e,t){return mr.createMulti("Cartoon",e,t,si,rJ)}var a$e={name:"cartoon",label:"Cartoon",description:"Displays ribbons, planks, tubes smoothly following the trace atoms of polymers.",factory:n$e,getParams:r$e,defaultValues:M.getDefaultValues(nJ),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.polymerResidueCount>0},ensureCustomProperties:{attach:function(e,t){return sc.attach(e,t,void 0,!0)},detach:function(e){return sc.ref(e,!1)}}},aJ=T(T({},wo),{sizeFactor:M.Numeric(1,{min:0,max:10,step:.1}),detail:M.Numeric(0,{min:0,max:3,step:1},Dt.CustomQualityParamInfo),ignoreHydrogens:M.Boolean(!1)});function i$e(e){return Rs({defaultProps:M.getDefaultValues(aJ),createGeometry:o$e,createLocationIterator:to.fromGroup,getLoci:hc,eachLocation:pc,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail||r.ignoreHydrogens!==n.ignoreHydrogens}},e)}function o$e(e,t,r,n,a,i){var o=r.child,s=o?.unitMap.get(t.id);if(o&&!s)return Wt.createEmpty(i);var u=a.detail,l=a.sizeFactor,c=a.ignoreHydrogens,d=t.elements,f=t.model,p=t.model.atomicHierarchy.derived.atom.atomicNumber,h=d.length,m=h*xk(u),v=kt.createState(m,m/2,i),g=uc.Provider.get(f);if(!g)return Wt.createEmpty(i);var y=A(),b=ia(),S=A(),x=A(),C=A(),w=g.elementToAnsiotrop,_=g.data,E=_.U,P=_._schema.U.space,D=t.conformation.invariantPosition,k=ot.create(r);k.unit=t;for(var F=0;F<h;F++){var X=d[F],U=w[X];if(U!==-1&&!(!!s&&!nt.has(s.elements,X)||c&&p3(p,X))){k.element=X,D(X,y),v.currentGroup=F,Rr.toMat3(b,P,E.value(U)),ia.symmtricFromLower(b,b),ia.symmetricEigenvalues(S,b),ia.eigenvector(x,b,S[1]),ia.eigenvector(C,b,S[2]);for(var j=0;j<3;++j)S[j]=l*1.5958*Math.sqrt(Math.abs(S[j]));Hn(S[0],S[1],jn)&&Hn(S[1],S[2],jn)?ti(v,y,S[0],u):Gk(v,y,C,x,S,u)}}var te=kt.getMesh(v),q=He.expand(He(),(s||t).boundary.sphere,1*l);return te.setBoundingSphere(q),te}var iJ={"ellipsoid-mesh":function(e,t){return Ba("Ellipsoid Mesh",e,t,i$e)},"intra-bond":function(e,t){return Ba("Intra-unit bond cylinder",e,t,SZ)},"inter-bond":function(e,t){return Qu("Inter-unit bond cylinder",e,t,wZ)}},oJ=T(T(T(T({},aJ),N_),z_),{adjustCylinderLength:M.Boolean(!1,{isHidden:!0}),unitKinds:_b(["atomic"]),sizeFactor:M.Numeric(1,{min:.01,max:10,step:.01}),sizeAspectRatio:M.Numeric(.1,{min:.01,max:3,step:.01}),linkCap:M.Boolean(!0),visuals:M.MultiSelect(["ellipsoid-mesh","intra-bond","inter-bond"],M.objectToOptions(iJ))});function s$e(e,t){return M.clone(oJ)}function u$e(e,t){return mr.createMulti("Ellipsoid",e,t,si,iJ)}var l$e={name:"ellipsoid",label:"Ellipsoid",description:"Displays anisotropic displacement ellipsoids of atomic elements plus bonds as cylinders.",factory:u$e,getParams:s$e,defaultValues:M.getDefaultValues(oJ),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.elementCount>0&&e.models.some(function(t){return uc.Provider.isApplicable(t)})},getData:function(e,t){return t.includeParent?e.asParent():e},mustRecreate:function(e,t){return e.includeParent!==t.includeParent}},c$e=`
precision highp float;

attribute vec3 aPosition;
attribute float aRadius;

varying vec3 vPosition;
varying float vRadiusSqInv;

#if defined(dCalcType_groupId)
    attribute float aGroup;
    varying float vGroup;
#endif

uniform vec3 uBboxSize;
uniform vec3 uBboxMin;
uniform float uResolution;

void main() {
    vRadiusSqInv = 1.0 / (aRadius * aRadius);
    #if defined(dCalcType_groupId)
        vGroup = aGroup;
    #endif
    gl_PointSize = ceil(((aRadius * 3.0) / uResolution) + uResolution);
    vPosition = (aPosition - uBboxMin) / uResolution;
    gl_Position = vec4(((aPosition - uBboxMin) / uBboxSize) * 2.0 - 1.0, 1.0);
}
`,d$e=`
precision highp float;

varying vec3 vPosition;
varying float vRadiusSqInv;
#if defined(dCalcType_groupId)
    #if defined(dGridTexType_2d)
        precision highp sampler2D;
        uniform sampler2D tMinDistanceTex;
        uniform vec3 uGridTexDim;
    #elif defined(dGridTexType_3d)
        precision highp sampler3D;
        uniform sampler3D tMinDistanceTex;
    #endif
    varying float vGroup;
#endif

#include common

uniform vec3 uGridDim;
uniform vec2 uGridTexScale;
uniform float uCurrentSlice;
uniform float uCurrentX;
uniform float uCurrentY;
uniform float uAlpha;
uniform float uResolution;
uniform float uRadiusFactorInv;

void main() {
    vec2 v = gl_FragCoord.xy - vec2(uCurrentX, uCurrentY) - 0.5;
    vec3 fragPos = vec3(v.x, v.y, uCurrentSlice);
    float dist = distance(fragPos, vPosition) * uResolution;

    #if defined(dCalcType_density)
        float density = exp(-uAlpha * ((dist * dist) * vRadiusSqInv));
        gl_FragColor.a = density * uRadiusFactorInv;
    #elif defined(dCalcType_minDistance)
        gl_FragColor.a = 1.0 - dist * uRadiusFactorInv;
    #elif defined(dCalcType_groupId)
        #if defined(dGridTexType_2d)
            float minDistance = 1.0 - texture2D(tMinDistanceTex, (gl_FragCoord.xy) / (uGridTexDim.xy / uGridTexScale)).a;
        #elif defined(dGridTexType_3d)
            float minDistance = 1.0 - texelFetch(tMinDistanceTex, ivec3(gl_FragCoord.xy, uCurrentSlice), 0).a;
        #endif
        if (dist * uRadiusFactorInv > minDistance + uResolution * 0.05)
            discard;
        gl_FragColor.rgb = encodeFloatRGB(vGroup);
    #endif
}
`,f$e={drawCount:Ra("number"),instanceCount:Ra("number"),aRadius:Zr("float32",1,0),aPosition:Zr("float32",3,0),aGroup:Zr("float32",1,0),uCurrentSlice:Ye("f"),uCurrentX:Ye("f"),uCurrentY:Ye("f"),uBboxMin:Ye("v3","material"),uBboxSize:Ye("v3","material"),uGridDim:Ye("v3","material"),uGridTexDim:Ye("v3","material"),uGridTexScale:Ye("v2","material"),uAlpha:Ye("f","material"),uResolution:Ye("f","material"),uRadiusFactorInv:Ye("f","material"),tMinDistanceTex:hr("texture","rgba","float","nearest"),dGridTexType:nr("string",["2d","3d"]),dCalcType:nr("string",["density","minDistance","groupId"])},Ul="gaussian-density";function sJ(e){return e.namedFramebuffers[Ul]||(e.namedFramebuffers[Ul]=e.resources.framebuffer()),e.namedFramebuffers[Ul]}function uJ(e,t,r,n,a,i){var o=Ul+"-"+e;return t.namedTextures[o]||(t.namedTextures[o]=t.resources.texture(r,n,a,i)),t.namedTextures[o]}function lJ(e,t,r,n,a,i){return e.isWebGL2?p$e(e,t,r,n,a,i):KR(e,t,r,n,!1,a,i)}function KR(e,t,r,n,a,i,o){return cJ(m$e(e,t,r,n,a,i,o))}function p$e(e,t,r,n,a,i){return cJ(v$e(e,t,r,n,a,i))}function cJ(e){var t=e.texture,r=e.scale,n=e.bbox,a=e.gridDim,i=e.gridTexDim,o=e.gridTexScale,s=e.radiusFactor,u=e.resolution;return{transform:h$e(r,n),texture:t,bbox:n,gridDim:a,gridTexDim:i,gridTexScale:o,radiusFactor:s,resolution:u}}function h$e(e,t){var r=de.identity();return de.fromScaling(r,e),de.setTranslation(r,t.min),r}function m$e(e,t,r,n,a,i,o){var s=e.gl,u=e.resources,l=e.state,c=e.extensions,d=c.colorBufferFloat,f=c.textureFloat,p=c.colorBufferHalfFloat,h=c.textureHalfFloat,m=c.blendMinMax,v=i.smoothness,g=i.resolution,y=dJ(t,r,n,i),b=y.drawCount,S=y.positions,x=y.radii,C=y.groups,w=y.scale,_=y.expandedBox,E=y.dim,P=y.maxRadius,D=E[0],k=E[1],F=E[2],X=y$e(E),U=X.texDimX,j=X.texDimY,te=X.texCols,q=X.powerOfTwoSize,W=A.create(U,j,0),V=Xe.create(U/q,j/q),ee=P*2,ue=a?q:U,$=a?q:j,Q=uJ("min-dist-2d",e,"image-uint8","rgba","ubyte","nearest");Q.define(ue,$);var R=fJ(e,b,S,x,C,Q,_,E,W,V,v,g,ee),Y=R.values,re=Y.uCurrentSlice,K=Y.uCurrentX,L=Y.uCurrentY,H=sJ(e);H.bind(),pJ(e),o||(o=p&&h?u.texture("image-float16","rgba","fp16","linear"):d&&f?u.texture("image-float32","rgba","float","linear"):u.texture("image-uint8","rgba","ubyte","linear")),o.define(ue,$);function Z(fe,me){l.currentRenderItemId=-1,fe.attachFramebuffer(H,0),me&&(s.viewport(0,0,ue,$),s.scissor(0,0,ue,$),s.clear(s.COLOR_BUFFER_BIT)),N.update(L,0);for(var xe=0,Se=0,ie=0,le=0;le<F;++le)xe>=te&&(xe-=te,Se+=k,ie=0,N.update(L,Se)),N.update(K,ie),N.update(re,le),s.viewport(ie,Se,D,k),s.scissor(ie,Se,D,k),R.render(),++xe,ie+=D;s.flush()}return mJ(e,R),Z(o,!0),m&&(hJ(e,R),Z(Q,!0),vJ(e,R),Z(o,!1)),{texture:o,scale:w,bbox:_,gridDim:E,gridTexDim:W,gridTexScale:V,radiusFactor:ee,resolution:g}}function v$e(e,t,r,n,a,i){var o=e.gl,s=e.resources,u=e.state,l=e.extensions,c=l.colorBufferFloat,d=l.textureFloat,f=l.colorBufferHalfFloat,p=l.textureHalfFloat,h=a.smoothness,m=a.resolution,v=dJ(t,r,n,a),g=v.drawCount,y=v.positions,b=v.radii,S=v.groups,x=v.scale,C=v.expandedBox,w=v.dim,_=v.maxRadius,E=w[0],P=w[1],D=w[2],k=uJ("min-dist-3d",e,"volume-uint8","rgba","ubyte","nearest");k.define(E,P,D);var F=Xe.create(1,1),X=_*2,U=fJ(e,g,y,b,S,k,C,w,w,F,h,m,X),j=U.values.uCurrentSlice,te=sJ(e);te.bind(),pJ(e),o.viewport(0,0,E,P),o.scissor(0,0,E,P),i||(i=f&&p?s.texture("volume-float16","rgba","fp16","linear"):c&&d?s.texture("volume-float32","rgba","float","linear"):s.texture("volume-uint8","rgba","ubyte","linear")),i.define(E,P,D);function q(W,V){u.currentRenderItemId=-1;for(var ee=0;ee<D;++ee)N.update(j,ee),W.attachFramebuffer(te,0,ee),V&&o.clear(o.COLOR_BUFFER_BIT),U.render();o.flush()}return mJ(e,U),q(i,!0),hJ(e,U),q(k,!0),vJ(e,U),q(i,!1),{texture:i,scale:x,bbox:C,gridDim:w,gridTexDim:w,gridTexScale:F,radiusFactor:X,resolution:m}}function dJ(e,t,r,n){for(var a=n.resolution,i=n.radiusOffset,o=1/a,s=e.indices,u=e.x,l=e.y,c=e.z,d=e.id,f=Ne.size(s),p=new Float32Array(f*3),h=new Float32Array(f),m=new Float32Array(f),v=0,g=0;g<f;++g){var y=Ne.getAt(s,g);p[g*3]=u[y],p[g*3+1]=l[y],p[g*3+2]=c[y];var b=r(y)+i;v<b&&(v=b),h[g]=b,m[g]=d?d[g]:g}var S=v*2+a*4,x=tr.expand(tr(),t,A.create(S,S,S)),C=tr.scale(tr(),x,o),w=tr.size(A(),C);A.ceil(w,w);var _=A.create(a,a,a);return{drawCount:f,positions:p,radii:h,groups:m,scale:_,expandedBox:x,dim:w,maxRadius:v}}function fJ(e,t,r,n,a,i,o,s,u,l,c,d,f){if(e.namedComputeRenderables[Ul]){var p=A.sub(A(),o.max,o.min),h=e.namedComputeRenderables[Ul].values;N.updateIfChanged(h.drawCount,t),N.updateIfChanged(h.instanceCount,1),N.update(h.aRadius,n),N.update(h.aPosition,r),N.update(h.aGroup,a),N.updateIfChanged(h.uCurrentSlice,0),N.updateIfChanged(h.uCurrentX,0),N.updateIfChanged(h.uCurrentY,0),N.update(h.uBboxMin,o.min),N.update(h.uBboxSize,p),N.update(h.uGridDim,s),N.update(h.uGridTexDim,u),N.update(h.uGridTexScale,l),N.updateIfChanged(h.uAlpha,c),N.updateIfChanged(h.uResolution,d),N.updateIfChanged(h.uRadiusFactorInv,1/f),N.update(h.tMinDistanceTex,i),N.updateIfChanged(h.dGridTexType,i.getDepth()>0?"3d":"2d"),N.updateIfChanged(h.dCalcType,"density"),e.namedComputeRenderables[Ul].update()}else e.namedComputeRenderables[Ul]=g$e(e,t,r,n,a,i,o,s,u,l,c,d,f);return e.namedComputeRenderables[Ul]}function g$e(e,t,r,n,a,i,o,s,u,l,c,d,f){var p=A.sub(A(),o.max,o.min),h={drawCount:N.create(t),instanceCount:N.create(1),aRadius:N.create(n),aPosition:N.create(r),aGroup:N.create(a),uCurrentSlice:N.create(0),uCurrentX:N.create(0),uCurrentY:N.create(0),uBboxMin:N.create(o.min),uBboxSize:N.create(p),uGridDim:N.create(s),uGridTexDim:N.create(u),uGridTexScale:N.create(l),uAlpha:N.create(c),uResolution:N.create(d),uRadiusFactorInv:N.create(1/f),tMinDistanceTex:N.create(i),dGridTexType:N.create(i.getDepth()>0?"3d":"2d"),dCalcType:N.create("density")},m=T({},f$e),v=Wn(Ul,c$e,d$e),g=li(e,"points",v,m,h);return ui(g,h)}function pJ(e){var t=e.gl,r=e.state;r.disable(t.CULL_FACE),r.enable(t.BLEND),r.disable(t.DEPTH_TEST),r.enable(t.SCISSOR_TEST),r.depthMask(!1),r.clearColor(0,0,0,0)}function hJ(e,t){var r=e.gl,n=e.state;if(N.update(t.values.dCalcType,"minDistance"),t.update(),n.colorMask(!1,!1,!1,!0),n.blendFunc(r.ONE,r.ONE),!e.extensions.blendMinMax)throw new Error("GPU gaussian surface calculation requires EXT_blend_minmax");n.blendEquation(e.extensions.blendMinMax.MAX)}function mJ(e,t){var r=e.gl,n=e.state;N.update(t.values.dCalcType,"density"),t.update(),n.colorMask(!1,!1,!1,!0),n.blendFunc(r.ONE,r.ONE),n.blendEquation(r.FUNC_ADD)}function vJ(e,t){var r=e.gl,n=e.state;N.update(t.values.dCalcType,"groupId"),t.update(),n.colorMask(!0,!0,!0,!1),n.blendFunc(r.ONE,r.ZERO),n.blendEquation(r.FUNC_ADD)}function y$e(e){var t=e[0]*e[1]*e[2],r=Math.sqrt(t),n=Math.pow(2,Math.ceil(Math.log(r)/Math.log(2))),a=0,i=e[1],o=1,s=e[2];return n<e[0]*e[2]?(s=Math.floor(n/e[0]),o=Math.ceil(e[2]/s),a=s*e[0],i*=o):a=e[0]*e[2],{texDimX:a,texDimY:i,texRows:o,texCols:s,powerOfTwoSize:i<n?n:n*2}}function gJ(e,t,r,n,a){return pe(this,void 0,void 0,function(){function i(K,L){for(var H=K;H<L;++H)for(var Z=Ne.getAt(d,H),fe=f[Z],me=p[Z],xe=h[Z],Se=g[H],ie=Se*Se,le=1/ie,O=Se*2,G=O*O,ve=Math.ceil(O*c),we=Math.floor(c*(fe-w[0])),Te=Math.floor(c*(me-w[1])),Ue=Math.floor(c*(xe-w[2])),Ge=Math.max(0,we-ve),Je=Math.max(0,Te-ve),st=Math.max(0,Ue-ve),ze=Math.min(U,we+ve+2),et=Math.min(j,Te+ve+2),ut=Math.min(te,Ue+ve+2),pt=Ge;pt<ze;++pt)for(var ht=ee[pt]-fe,Re=pt*V,it=Je;it<et;++it)for(var Fe=ue[it]-me,tt=ht*ht+Fe*Fe,wt=it*q+Re,dt=st;dt<ut;++dt){var Et=$[dt]-xe,oe=tt+Et*Et;if(oe<=G){var ge=f3e(-R*(oe*le)),Ee=dt+wt;D[Ee]+=ge,ge>Q[Ee]&&(Q[Ee]=ge,F[Ee]=m?m[H]:H)}}}function o(){return pe(this,void 0,void 0,function(){var K;return he(this,function(L){switch(L.label){case 0:K=0,L.label=1;case 1:return K<v?(i(K,Math.min(K+Y,v)),e.shouldUpdate?[4,e.update({message:"filling density grid",current:K,max:v})]:[3,3]):[3,4];case 2:L.sent(),L.label=3;case 3:return K+=Y,[3,1];case 4:return[2]}})})}var s,u,l,c,d,f,p,h,m,v,g,y,b,S,x,C,w,_,E,P,D,k,F,X,U,j,te,q,W,V,ee,ue,$,Q,R,Y,re;return he(this,function(K){switch(K.label){case 0:for(s=a.resolution,u=a.radiusOffset,l=a.smoothness,c=1/s,d=t.indices,f=t.x,p=t.y,h=t.z,m=t.id,v=Ne.size(d),g=new Float32Array(v),y=0,b=0;b<v;++b)S=n(Ne.getAt(d,b))+u,y<S&&(y=S),g[b]=S;return x=y*2+s,C=tr.expand(tr(),r,A.create(x,x,x)),w=C.min,_=tr.scale(tr(),C,c),E=tr.size(A(),_),A.ceil(E,E),P=Rr.Space(E,[0,1,2],Float32Array),D=P.create(),k=Rr.create(P,D),F=P.create(),F.fill(-1),X=Rr.create(P,F),U=E[0],j=E[1],te=E[2],q=te,W=j,V=q*W,ee=Kv(E[0],w[0],s),ue=Kv(E[1],w[1],s),$=Kv(E[2],w[2],s),Q=P.create(),R=l,Y=Math.ceil(1e5/(Math.pow(Math.pow(y,3),3)*c)),[4,o()];case 1:return K.sent(),re=de.identity(),de.fromScaling(re,A.create(s,s,s)),de.setTranslation(re,C.min),[2,{field:k,idField:X,transform:re,radiusFactor:1,resolution:s}]}})})}var Rb=T({resolution:M.Numeric(1,{min:.1,max:20,step:.1},T({description:"Grid resolution/cell spacing."},Dt.CustomQualityParamInfo)),radiusOffset:M.Numeric(0,{min:0,max:10,step:.1},{description:"Extra/offset radius added to the atoms/coarse elements for gaussian calculation. Useful to create coarse, low resolution surfaces."}),smoothness:M.Numeric(1.5,{min:.5,max:2.5,step:.1},{description:"Smoothness of the gausian surface, lower is smoother."})},A_);M.getDefaultValues(Rb);function j_(e,t){var r=e.maxTextureSize/3;return r*r/Math.max(1,t?t.units.length/16:1)}function yJ(e,t,r){var n=this,a=t.lookup3d.boundary.box,i=Mm(a,r),o=T_(e,t,i),s=o.position,u=o.radius;return Qe.create("Gaussian Density",function(l){return pe(n,void 0,void 0,function(){return he(this,function(c){switch(c.label){case 0:return[4,gJ(l,s,a,u,i)];case 1:return[2,c.sent()]}})})})}function b$e(e,t,r,n,a){var i=this,o=t.lookup3d.boundary.box,s=Mm(o,r,j_(n,e)),u=T_(e,t,s),l=u.position,c=u.radius;return Qe.create("Gaussian Density",function(d){return pe(i,void 0,void 0,function(){return he(this,function(f){return[2,lJ(n,l,o,c,s,a)]})})})}function x$e(e,t,r,n,a,i){var o=this,s=t.lookup3d.boundary.box,u=Mm(s,n,j_(a,e)),l=T_(e,t,u),c=l.position,d=l.radius;return Qe.create("Gaussian Density",function(f){return pe(o,void 0,void 0,function(){return he(this,function(p){return[2,KR(a,c,s,d,r,u,i)]})})})}function S$e(e,t){var r=this,n=e.lookup3d.boundary.box,a=Mm(n,t),i=rR(e,t.ignoreHydrogens,t.traceOnly),o=i.position,s=i.radius;return Qe.create("Gaussian Density",function(u){return pe(r,void 0,void 0,function(){return he(this,function(l){switch(l.label){case 0:return[4,gJ(u,o,n,s,a)];case 1:return[2,l.sent()]}})})})}function C$e(e,t,r,n){var a=this,i=e.lookup3d.boundary.box,o=Mm(i,t,j_(r)),s=rR(e,t.ignoreHydrogens,t.traceOnly),u=s.position,l=s.radius;return Qe.create("Gaussian Density",function(c){return pe(a,void 0,void 0,function(){return he(this,function(d){return[2,lJ(r,u,i,l,o,n)]})})})}function w$e(e,t,r,n,a){var i=this,o=e.lookup3d.boundary.box,s=Mm(o,r,j_(n)),u=rR(e,r.ignoreHydrogens,r.traceOnly),l=u.position,c=u.radius;return Qe.create("Gaussian Density",function(d){return pe(i,void 0,void 0,function(){return he(this,function(f){return[2,KR(n,l,o,c,t,s,a)]})})})}function _$e(e,t,r,n,a){var i=e.colorType,o=e.vertexCount,s=e.groupCount,u=e.positionBuffer,l=e.transformBuffer,c=e.groupBuffer,d=i.endsWith("Instance"),f=tr.fromSphere3D(tr(),d?e.boundingSphere:e.invariantBoundingSphere),p=1/t,h=tr.scale(tr(),f,p),m=tr.size(A(),h);A.ceil(m,m),A.add(m,m,A.create(2,2,2));var v=f.min,g=m[0],y=m[1],b=Ib(m),S=b.width,x=b.height,C=3,w=new Float32Array(S*x*C),_=new Float32Array(S*x),E=new Uint8Array(S*x*C),P={array:E,width:S,height:x,filter:"linear"},D=d?e.instanceCount:1,k=e.colorData.array;function F(it,Fe,tt){var wt=Math.floor(tt*g%S/g),dt=Math.floor(tt*g/S),Et=wt*g+it;return C*(dt*y*S+Fe*S+Et)}for(var X=2,U=m[0],j=m[1],te=m[2],q=A(),W=0;W<D;++W)for(var V=0;V<o;V+=r){A.fromArray(q,u,V*3),d&&A.transformMat4Offset(q,q,l,0,0,W*16),A.sub(q,q,v),A.scale(q,q,p);for(var ee=q[0],ue=q[1],$=q[2],Q=Math.floor(ee),R=Math.floor(ue),Y=Math.floor($),re=W*s+c[V],K=k[re*3],L=k[re*3+1],H=k[re*3+2],Z=Math.max(0,Q-X),fe=Math.max(0,R-X),me=Math.max(0,Y-X),xe=Math.min(U,Q+X+2),Se=Math.min(j,R+X+2),ie=Math.min(te,Y+X+2),le=Z;le<xe;++le)for(var O=le-ee,G=fe;G<Se;++G)for(var ve=G-ue,we=me;we<ie;++we){var Te=we-$,Ue=Math.sqrt(O*O+ve*ve+Te*Te);if(!(Ue>X)){var Ge=X-Ue,Je=F(le,G,we);w[Je]+=K*Ge,w[Je+1]+=L*Ge,w[Je+2]+=H*Ge,_[Je/3]+=Ge}}}for(var W=0,st=_.length;W<st;++W){var ze=W*3,et=_[W];E[ze]=Math.round(w[ze]/et),E[ze+1]=Math.round(w[ze+1]/et),E[ze+2]=Math.round(w[ze+2]/et)}var ut=Xe.create(S,x),pt=Mr.create(v[0],v[1],v[2],p),ht=d?"volumeInstance":"volume";if(n)return a||(a=n.resources.texture("image-uint8","rgb","ubyte","linear")),a.load(P),{kind:"volume",texture:a,gridTexDim:ut,gridDim:m,gridTransform:pt,type:ht};var Re=A$e({vertexCount:o,instanceCount:D,transformBuffer:l,positionBuffer:u,colorType:ht,grid:E,gridDim:m,gridTexDim:ut,gridTransform:pt,vertexStride:3,colorStride:3});return{kind:"vertex",texture:Re,texDim:Xe.create(Re.width,Re.height),type:d?"vertexInstance":"vertex"}}function A$e(e){var t=e.vertexCount,r=e.positionBuffer,n=e.transformBuffer,a=e.grid,i=e.gridDim,o=e.gridTexDim,s=e.gridTransform,u=e.vertexStride,l=e.colorStride,c=e.colorType.endsWith("Instance"),d=c?e.instanceCount:1,f=Li(Math.max(1,d*t),3,Uint8Array),p=f.array,h=i[0],m=i[1],v=o[0],g=A.fromArray(A(),s,0),y=s[3];function b(me,xe,Se){var ie=Math.floor(Se*h%v/h),le=Math.floor(Se*h/v),O=ie*h+me;return l*(le*m*v+xe*v+O)}for(var S=A(),x=A(),C=A(),w=A(),_=0;_<d;++_)for(var E=0;E<t;++E){A.fromArray(S,r,E*u),c&&A.transformMat4Offset(S,S,n,0,0,_*16),A.sub(S,S,g),A.scale(S,S,y),A.floor(x,S),A.ceil(C,S),A.sub(w,S,x),A.sub(S,C,x),A.div(w,w,S);var P=x[0],D=x[1],k=x[2],F=C[0],X=C[1],U=C[2],j=w[0],te=w[1],q=w[2],W=vt.fromArray(a,b(P,D,k)),V=vt.fromArray(a,b(F,D,k)),ee=vt.fromArray(a,b(P,D,U)),ue=vt.fromArray(a,b(F,D,U)),$=vt.fromArray(a,b(P,X,k)),Q=vt.fromArray(a,b(F,X,k)),R=vt.fromArray(a,b(P,X,U)),Y=vt.fromArray(a,b(F,X,U)),re=vt.interpolate(W,V,j),K=vt.interpolate(ee,ue,j),L=vt.interpolate($,Q,j),H=vt.interpolate(R,Y,j),Z=vt.interpolate(re,L,te),fe=vt.interpolate(K,H,te);vt.toArray(vt.interpolate(Z,fe,q),p,(_*t+E)*3)}return f}var T$e=`
precision highp float;
precision highp sampler2D;

uniform sampler2D tColor;
uniform vec2 uTexSize;

void main(void) {
    vec2 coords = gl_FragCoord.xy / uTexSize;
    vec4 color = texture2D(tColor, coords);

    gl_FragColor.rgb = color.rgb / color.a;
}
`,E$e=`
precision highp float;

varying vec3 vPosition;
varying vec3 vColor;

uniform float uCurrentSlice;
uniform float uCurrentX;
uniform float uCurrentY;
uniform float uResolution;

const float p = 2.0;

void main() {
    vec2 v = gl_FragCoord.xy - vec2(uCurrentX, uCurrentY) - 0.5;
    vec3 fragPos = vec3(v.x, v.y, uCurrentSlice);
    float dist = distance(fragPos, vPosition);
    if (dist > p) discard;

    gl_FragColor = vec4(vColor, 1.0) * (p - dist);
}
`,P$e=`
precision highp float;

#include common
#include read_from_texture

uniform int uTotalCount;
uniform int uGroupCount;

attribute float aSample;
#define SampleID int(aSample)

attribute mat4 aTransform;
attribute float aInstance;

uniform vec2 uGeoTexDim;
uniform sampler2D tPosition;
uniform sampler2D tGroup;

uniform vec2 uColorTexDim;
uniform sampler2D tColor;

varying vec3 vPosition;
varying vec3 vColor;

uniform vec3 uBboxSize;
uniform vec3 uBboxMin;
uniform float uResolution;

void main() {
    vec3 position = readFromTexture(tPosition, SampleID, uGeoTexDim).xyz;
    float group = decodeFloatRGB(readFromTexture(tGroup, SampleID, uGeoTexDim).rgb);

    position = (aTransform * vec4(position, 1.0)).xyz;
    gl_PointSize = 7.0;
    vPosition = (position - uBboxMin) / uResolution;
    gl_Position = vec4(((position - uBboxMin) / uBboxSize) * 2.0 - 1.0, 1.0);

    #if defined(dColorType_group)
        vColor = readFromTexture(tColor, group, uColorTexDim).rgb;
    #elif defined(dColorType_groupInstance)
        vColor = readFromTexture(tColor, aInstance * float(uGroupCount) + group, uColorTexDim).rgb;
    #endif
}
`,I$e={drawCount:Ra("number"),instanceCount:Ra("number"),stride:Ra("number"),uTotalCount:Ye("i"),uInstanceCount:Ye("i"),uGroupCount:Ye("i"),aTransform:Zr("float32",16,1),aInstance:Zr("float32",1,1),aSample:Zr("float32",1,0),uGeoTexDim:Ye("v2","buffered"),tPosition:hr("texture","rgba","float","nearest"),tGroup:hr("texture","rgba","float","nearest"),uColorTexDim:Ye("v2"),tColor:hr("image-uint8","rgb","ubyte","nearest"),dColorType:nr("string",["group","groupInstance","vertex","vertexInstance"]),uCurrentSlice:Ye("f"),uCurrentX:Ye("f"),uCurrentY:Ye("f"),uBboxMin:Ye("v3","material"),uBboxSize:Ye("v3","material"),uResolution:Ye("f","material")},Uu="color-accumulate";function bJ(e,t){for(var r=new Float32Array(e),n=0;n<e;++n)r[n]=n*t;return r}function M$e(e,t,r,n,a){if(e.namedComputeRenderables[Uu]){var i=A.sub(A(),r.max,r.min),o=e.namedComputeRenderables[Uu].values,s=Math.round(t.vertexCount/a);(s>o.drawCount.ref.value||a!==o.stride.ref.value)&&N.update(o.aSample,bJ(s,a)),N.updateIfChanged(o.drawCount,s),N.updateIfChanged(o.instanceCount,t.instanceCount),N.updateIfChanged(o.stride,a),N.updateIfChanged(o.uTotalCount,t.vertexCount),N.updateIfChanged(o.uInstanceCount,t.instanceCount),N.updateIfChanged(o.uGroupCount,t.groupCount),N.update(o.aTransform,t.transformBuffer),N.update(o.aInstance,t.instanceBuffer),N.update(o.uGeoTexDim,Xe.set(o.uGeoTexDim.ref.value,t.positionTexture.getWidth(),t.positionTexture.getHeight())),N.update(o.tPosition,t.positionTexture),N.update(o.tGroup,t.groupTexture),N.update(o.uColorTexDim,Xe.set(o.uColorTexDim.ref.value,t.colorData.width,t.colorData.height)),N.update(o.tColor,t.colorData),N.updateIfChanged(o.dColorType,t.colorType),N.updateIfChanged(o.uCurrentSlice,0),N.updateIfChanged(o.uCurrentX,0),N.updateIfChanged(o.uCurrentY,0),N.update(o.uBboxMin,r.min),N.update(o.uBboxSize,i),N.updateIfChanged(o.uResolution,n),e.namedComputeRenderables[Uu].update()}else e.namedComputeRenderables[Uu]=D$e(e,t,r,n,a);return e.namedComputeRenderables[Uu]}function D$e(e,t,r,n,a){var i=A.sub(A(),r.max,r.min),o=Math.round(t.vertexCount/a),s={drawCount:N.create(o),instanceCount:N.create(t.instanceCount),stride:N.create(a),uTotalCount:N.create(t.vertexCount),uInstanceCount:N.create(t.instanceCount),uGroupCount:N.create(t.groupCount),aTransform:N.create(t.transformBuffer),aInstance:N.create(t.instanceBuffer),aSample:N.create(bJ(o,a)),uGeoTexDim:N.create(Xe.create(t.positionTexture.getWidth(),t.positionTexture.getHeight())),tPosition:N.create(t.positionTexture),tGroup:N.create(t.groupTexture),uColorTexDim:N.create(Xe.create(t.colorData.width,t.colorData.height)),tColor:N.create(t.colorData),dColorType:N.create(t.colorType),uCurrentSlice:N.create(0),uCurrentX:N.create(0),uCurrentY:N.create(0),uBboxMin:N.create(r.min),uBboxSize:N.create(i),uResolution:N.create(n)},u=T({},I$e),l=Wn("accumulate",P$e,E$e),c=li(e,"points",l,u,s);return ui(c,s)}function k$e(e){var t=e.gl,r=e.state;r.disable(t.CULL_FACE),r.enable(t.BLEND),r.disable(t.DEPTH_TEST),r.enable(t.SCISSOR_TEST),r.depthMask(!1),r.clearColor(0,0,0,0),r.blendFunc(t.ONE,t.ONE),r.blendEquation(t.FUNC_ADD)}var R$e=T(T({},Ni),{tColor:hr("texture","rgba","float","nearest"),uTexSize:Ye("v2")}),jg="color-normalize";function O$e(e,t){if(e.namedComputeRenderables[jg]){var r=e.namedComputeRenderables[jg].values;N.update(r.tColor,t),N.update(r.uTexSize,Xe.set(r.uTexSize.ref.value,t.getWidth(),t.getHeight())),e.namedComputeRenderables[jg].update()}else e.namedComputeRenderables[jg]=B$e(e,t);return e.namedComputeRenderables[jg]}function B$e(e,t){var r=T(T({},zi),{tColor:N.create(t),uTexSize:N.create(Xe.create(t.getWidth(),t.getHeight()))}),n=T({},R$e),a=Wn("normalize",Yo,T$e),i=li(e,"triangles",a,n,r);return ui(i,r)}function F$e(e){var t=e.gl,r=e.state;r.disable(t.CULL_FACE),r.enable(t.BLEND),r.disable(t.DEPTH_TEST),r.enable(t.SCISSOR_TEST),r.depthMask(!1),r.clearColor(0,0,0,0),r.blendFunc(t.ONE,t.ONE),r.blendEquation(t.FUNC_ADD)}function L$e(e){var t=e[0]*e[1]*e[2],r=Math.sqrt(t),n=Math.pow(2,Math.ceil(Math.log(r)/Math.log(2))),a=0,i=e[1],o=1,s=e[2];return n<e[0]*e[2]?(s=Math.floor(n/e[0]),o=Math.ceil(e[2]/s),a=s*e[0],i*=o):a=e[0]*e[2],{texDimX:a,texDimY:i,texRows:o,texCols:s,powerOfTwoSize:i<n?n:n*2}}function N$e(e,t,r,n,a){var i=n.gl,o=n.resources,s=n.state,u=n.extensions,l=u.colorBufferHalfFloat,c=u.textureHalfFloat,d=e.colorType.endsWith("Instance"),f=tr.fromSphere3D(tr(),d?e.boundingSphere:e.invariantBoundingSphere),p=1/t,h=tr.scale(tr(),f,p),m=tr.size(A(),h);A.ceil(m,m),A.add(m,m,A.create(2,2,2));var v=f.min,g=m[0],y=m[1],b=m[2],S=L$e(m),x=S.texDimX,C=S.texDimY,w=S.texCols;n.namedTextures[Uu]||(n.namedTextures[Uu]=l&&c?o.texture("image-float16","rgba","fp16","nearest"):o.texture("image-float32","rgba","float","nearest"));var _=n.namedTextures[Uu];_.define(x,C);var E=M$e(n,e,f,t,r),P=E.values,D=P.uCurrentSlice,k=P.uCurrentX,F=P.uCurrentY;n.namedFramebuffers[Uu]||(n.namedFramebuffers[Uu]=n.resources.framebuffer());var X=n.namedFramebuffers[Uu];X.bind(),k$e(n),s.currentRenderItemId=-1,_.attachFramebuffer(X,0),i.viewport(0,0,x,C),i.scissor(0,0,x,C),i.clear(i.COLOR_BUFFER_BIT),N.update(F,0);for(var U=0,j=0,te=0,q=0;q<b;++q)U>=w&&(U-=w,j+=y,te=0,N.update(F,j)),N.update(k,te),N.update(D,q),i.viewport(te,j,g,y),i.scissor(te,j,g,y),E.render(),++U,te+=g;a||(a=o.texture("image-uint8","rgb","ubyte","linear")),a.define(x,C);var W=O$e(n,_);F$e(n),s.currentRenderItemId=-1,a.attachFramebuffer(X,0),i.viewport(0,0,x,C),i.scissor(0,0,x,C),i.clear(i.COLOR_BUFFER_BIT),W.render();var V=Mr.create(v[0],v[1],v[2],p),ee=d?"volumeInstance":"volume";return{texture:a,gridDim:m,gridTexDim:Xe.create(x,C),gridTransform:V,type:ee}}var xJ={smoothColors:M.MappedStatic("auto",{auto:M.Group({}),on:M.Group({resolutionFactor:M.Numeric(2,{min:.5,max:6,step:.1}),sampleStride:M.Numeric(3,{min:1,max:12,step:1})}),off:M.Group({})})};function Ob(e,t,r,n){if((e.smoothColors.name==="on"||e.smoothColors.name==="auto"&&t.color.preferSmoothing)&&r&&r<3&&n){var a=3;return e.smoothColors.name==="on"?(r*=e.smoothColors.params.resolutionFactor,a=e.smoothColors.params.sampleStride):(r*=2-vge(0,1.1,r),r=Math.max(.5,r),r>1.2&&(a=2)),{resolution:r,stride:a,webgl:n}}}function SJ(e){return e==="group"||e==="groupInstance"}function $R(e,t,r,n,a){if(!!SJ(e.dColorType.ref.value)){var i=_$e({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionBuffer:e.aPosition.ref.value,groupBuffer:e.aGroup.ref.value,colorData:e.tColor.ref.value,colorType:e.dColorType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value},t,r,n,a);i.kind==="volume"?(N.updateIfChanged(e.dColorType,i.type),N.update(e.tColorGrid,i.texture),N.update(e.uColorTexDim,i.gridTexDim),N.update(e.uColorGridDim,i.gridDim),N.update(e.uColorGridTransform,i.gridTransform)):i.kind==="vertex"&&(N.updateIfChanged(e.dColorType,i.type),N.update(e.tColor,i.texture),N.update(e.uColorTexDim,i.texDim))}}function CJ(e,t,r,n,a){if(!!SJ(e.dColorType.ref.value)){r*=3;var i=N$e({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionTexture:e.tPosition.ref.value,groupTexture:e.tGroup.ref.value,colorData:e.tColor.ref.value,colorType:e.dColorType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value},t,r,n,a);N.updateIfChanged(e.dColorType,i.type),N.update(e.tColorGrid,i.texture),N.update(e.uColorTexDim,i.gridTexDim),N.update(e.uColorGridDim,i.gridDim),N.update(e.uColorGridTransform,i.gridTransform)}}var wJ=T(T(T({},Rb),xJ),{ignoreHydrogens:M.Boolean(!1),tryUseGpu:M.Boolean(!0)}),QR=T(T(T({},wo),vze),wJ),_J=T(T(T({},Ab),ize),wJ);function AJ(e){return e.extensions.colorBufferFloat&&e.extensions.textureFloat&&e.extensions.blendMinMax&&e.extensions.drawBuffers}function Q0(e,t,r){if(t.resolution>1)return!1;var n=r.maxTextureSize/3,a=N$(e.boundary.box,t.resolution,n*n),i=a.areaCells,o=a.maxAreaCells;return i<o}function z$e(e,t,r,n){return r.tryUseGpu&&n&&AJ(n)&&Q0(t,r,n)?W$e(e):H$e(e)}function U$e(e,t,r,n){return r.tryUseGpu&&n&&AJ(n)&&Q0(t,r,n)?Y$e(e):G$e(e)}function V$e(e,t,r,n,a,i){return pe(this,void 0,void 0,function(){var o,s,u,l,c,d,f,p,h,m;return he(this,function(v){switch(v.label){case 0:return o=a.smoothness,[4,yJ(r,t,a).runInContext(e.runtime)];case 1:return s=v.sent(),u=s.transform,l=s.field,c=s.idField,d=s.radiusFactor,f=s.resolution,p={isoLevel:Math.exp(-o)/d,scalarField:l,idField:c},[4,I_(p,i).runAsChild(e.runtime)];case 2:return h=v.sent(),h.meta.resolution=f,Wt.transform(h,u),e.webgl&&!e.webgl.isWebGL2&&Wt.uniformTriangleGroup(h),m=He.expand(He(),t.boundary.sphere,a.radiusOffset+q0(t)),h.setBoundingSphere(m),[2,h]}})})}function H$e(e){return Rs({defaultProps:M.getDefaultValues(QR),createGeometry:V$e,createLocationIterator:to.fromGroup,getLoci:hc,eachLocation:pc,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0),r.smoothColors.name!==n.smoothColors.name?t.updateColor=!0:r.smoothColors.name==="on"&&n.smoothColors.name==="on"&&(r.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(t.updateColor=!0),r.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(t.updateColor=!0))},mustRecreate:function(t,r,n){return r.tryUseGpu&&!!n&&Q0(t.structure,r,n)},processValues:function(t,r,n,a,i){var o=r.meta,s=o.resolution,u=o.colorTexture,l=Ob(n,a,s,i);l&&($R(t,l.resolution,l.stride,l.webgl,u),r.meta.colorTexture=t.tColorGrid.ref.value)},dispose:function(t){var r;(r=t.meta.colorTexture)===null||r===void 0||r.destroy()}},e)}function j$e(e,t,r,n,a){return pe(this,void 0,void 0,function(){var i,o,s,u,l,c,d,f,p,h;return he(this,function(m){switch(m.label){case 0:return i=n.smoothness,[4,S$e(t,n).runInContext(e.runtime)];case 1:return o=m.sent(),s=o.transform,u=o.field,l=o.idField,c=o.radiusFactor,d=o.resolution,f={isoLevel:Math.exp(-i)/c,scalarField:u,idField:l},[4,I_(f,a).runAsChild(e.runtime)];case 2:return p=m.sent(),p.meta.resolution=d,Wt.transform(p,s),e.webgl&&!e.webgl.isWebGL2&&Wt.uniformTriangleGroup(p),h=He.expand(He(),t.boundary.sphere,n.radiusOffset+E_(t)),p.setBoundingSphere(h),[2,p]}})})}function G$e(e){return Dm({defaultProps:M.getDefaultValues(_J),createGeometry:j$e,createLocationIterator:to.fromStructure,getLoci:V_,eachLocation:U_,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.smoothColors.name!==n.smoothColors.name?t.updateColor=!0:r.smoothColors.name==="on"&&n.smoothColors.name==="on"&&(r.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(t.updateColor=!0),r.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(t.updateColor=!0))},mustRecreate:function(t,r,n){return r.tryUseGpu&&!!n&&Q0(t,r,n)},processValues:function(t,r,n,a,i){var o=r.meta,s=o.resolution,u=o.colorTexture,l=Ob(n,a,s,i);l&&($R(t,l.resolution,l.stride,l.webgl,u),r.meta.colorTexture=t.tColorGrid.ref.value)},dispose:function(t){var r;(r=t.meta.colorTexture)===null||r===void 0||r.destroy()}},e)}var r0="gaussian-surface";function q$e(e,t,r,n,a,i){return pe(this,void 0,void 0,function(){var o,s,u,l,c,d,f,p,h,m,v,g,y,b;return he(this,function(S){switch(S.label){case 0:if(!e.webgl)throw new Error("webgl context required to create gaussian surface texture-mesh");return o=e.webgl,s=o.namedTextures,u=o.resources,l=o.extensions,c=l.colorBufferFloat,d=l.textureFloat,f=l.colorBufferHalfFloat,p=l.textureHalfFloat,s[r0]||(s[r0]=f&&p?u.texture("image-float16","rgba","fp16","linear"):c&&d?u.texture("image-float32","rgba","float","linear"):u.texture("image-uint8","rgba","ubyte","linear")),[4,x$e(r,t,!0,a,e.webgl,s[r0]).runInContext(e.runtime)];case 1:return h=S.sent(),m=Math.exp(-a.smoothness)/h.radiusFactor,v=i?.doubleBuffer.get(),g=pR(e.webgl,h.texture,h.gridDim,h.gridTexDim,h.gridTexScale,h.transform,m,!1,!0,v?.vertex,v?.group,v?.normal),y=He.expand(He(),t.boundary.sphere,a.radiusOffset+E_(r)),b=il.create(g.vertexCount,1,g.vertexTexture,g.groupTexture,g.normalTexture,y,i),b.meta={resolution:h.resolution},[2,b]}})})}function W$e(e){return gze({defaultProps:M.getDefaultValues(QR),createGeometry:q$e,createLocationIterator:to.fromGroup,getLoci:hc,eachLocation:pc,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0),r.smoothColors.name!==n.smoothColors.name?t.updateColor=!0:r.smoothColors.name==="on"&&n.smoothColors.name==="on"&&(r.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(t.updateColor=!0),r.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(t.updateColor=!0))},mustRecreate:function(t,r,n){return!r.tryUseGpu||!n||!Q0(t.structure,r,n)},processValues:function(t,r,n,a,i){var o=r.meta,s=o.resolution,u=o.colorTexture,l=Ob(n,a,s,i);l&&(CJ(t,l.resolution,l.stride,l.webgl,u),r.meta.colorTexture=t.tColorGrid.ref.value)},dispose:function(t){var r;t.vertexTexture.ref.value.destroy(),t.groupTexture.ref.value.destroy(),t.normalTexture.ref.value.destroy(),t.doubleBuffer.destroy(),(r=t.meta.colorTexture)===null||r===void 0||r.destroy()}},e)}function X$e(e,t,r,n,a){return pe(this,void 0,void 0,function(){var i,o,s,u,l,c,d,f,p,h,m,v,g,y;return he(this,function(b){switch(b.label){case 0:if(!e.webgl)throw new Error("webgl context required to create structure gaussian surface texture-mesh");return i=e.webgl,o=i.namedTextures,s=i.resources,u=i.extensions,l=u.colorBufferFloat,c=u.textureFloat,d=u.colorBufferHalfFloat,f=u.textureHalfFloat,o[r0]||(o[r0]=d&&f?s.texture("image-float16","rgba","fp16","linear"):l&&c?s.texture("image-float32","rgba","float","linear"):s.texture("image-uint8","rgba","ubyte","linear")),[4,w$e(t,!0,n,e.webgl,o[r0]).runInContext(e.runtime)];case 1:return p=b.sent(),h=Math.exp(-n.smoothness)/p.radiusFactor,m=a?.doubleBuffer.get(),v=pR(e.webgl,p.texture,p.gridDim,p.gridTexDim,p.gridTexScale,p.transform,h,!1,!0,m?.vertex,m?.group,m?.normal),g=He.expand(He(),t.boundary.sphere,n.radiusOffset+E_(t)),y=il.create(v.vertexCount,1,v.vertexTexture,v.groupTexture,v.normalTexture,g,a),y.meta={resolution:p.resolution},[2,y]}})})}function Y$e(e){return oze({defaultProps:M.getDefaultValues(_J),createGeometry:X$e,createLocationIterator:to.fromStructure,getLoci:V_,eachLocation:U_,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0),r.smoothColors.name!==n.smoothColors.name?t.updateColor=!0:r.smoothColors.name==="on"&&n.smoothColors.name==="on"&&(r.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(t.updateColor=!0),r.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(t.updateColor=!0))},mustRecreate:function(t,r,n){return!r.tryUseGpu||!n||!Q0(t,r,n)},processValues:function(t,r,n,a,i){var o=r.meta,s=o.resolution,u=o.colorTexture,l=Ob(n,a,s,i);l&&(CJ(t,l.resolution,l.stride,l.webgl,u),r.meta.colorTexture=t.tColorGrid.ref.value)},dispose:function(t){var r;t.vertexTexture.ref.value.destroy(),t.groupTexture.ref.value.destroy(),t.normalTexture.ref.value.destroy(),t.doubleBuffer.destroy(),(r=t.meta.colorTexture)===null||r===void 0||r.destroy()}},e)}function K$e(e,t,r,n,a,i){return pe(this,void 0,void 0,function(){var o,s,u,l,c,d,f,p;return he(this,function(h){switch(h.label){case 0:return o=a.smoothness,[4,yJ(r,t,a).runInContext(e.runtime)];case 1:return s=h.sent(),u=s.transform,l=s.field,c=s.idField,d={isoLevel:Math.exp(-o),scalarField:l,idField:c},[4,dR(d,i).runAsChild(e.runtime)];case 2:return f=h.sent(),Mn.transform(f,u),p=He.expand(He(),t.boundary.sphere,a.radiusOffset+q0(t)),f.setBoundingSphere(p),[2,f]}})})}var TJ=T(T(T({},aR),Rb),{sizeFactor:M.Numeric(3,{min:0,max:10,step:.1}),lineSizeAttenuation:M.Boolean(!1),ignoreHydrogens:M.Boolean(!1)});function $$e(e){return iR({defaultProps:M.getDefaultValues(TJ),createGeometry:K$e,createLocationIterator:to.fromGroup,getLoci:hc,eachLocation:pc,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0)}},e)}var EJ={"gaussian-surface-mesh":function(e,t){return Ba("Gaussian surface mesh",e,t,z$e)},"structure-gaussian-surface-mesh":function(e,t){return Qu("Structure-Gaussian surface mesh",e,t,U$e)},"gaussian-surface-wireframe":function(e,t){return Ba("Gaussian surface wireframe",e,t,$$e)}},PJ=T(T(T({},QR),TJ),{visuals:M.MultiSelect(["gaussian-surface-mesh"],M.objectToOptions(EJ))});function Q$e(e,t){return M.clone(PJ)}function Z$e(e,t){return mr.createMulti("Gaussian Surface",e,t,si,EJ)}var J$e={name:"gaussian-surface",label:"Gaussian Surface",description:"Displays a gaussian molecular surface.",factory:Z$e,getParams:Q$e,defaultValues:M.getDefaultValues(PJ),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.elementCount>0}},IJ=T(T({},tze),{background:M.Boolean(!0),backgroundMargin:M.Numeric(0,{min:0,max:1,step:.01}),backgroundColor:M.Color(gr.black),backgroundOpacity:M.Numeric(.5,{min:0,max:1,step:.01}),level:M.Select("residue",[["chain","Chain"],["residue","Residue"],["element","Element"]]),chainScale:M.Numeric(10,{min:0,max:20,step:.1}),residueScale:M.Numeric(1,{min:0,max:20,step:.1}),elementScale:M.Numeric(.5,{min:0,max:20,step:.1})});function eQe(e){return rze({defaultProps:M.getDefaultValues(IJ),createGeometry:tQe,createLocationIterator:to.fromStructure,getLoci:V_,eachLocation:U_,setUpdateState:function(t,r,n){t.createGeometry=r.level!==n.level||r.level==="chain"&&r.chainScale!==n.chainScale||r.level==="residue"&&r.residueScale!==n.residueScale||r.level==="element"&&r.elementScale!==n.elementScale}},e)}function tQe(e,t,r,n,a){switch(n.level){case"chain":return rQe(e,t,r,n,a);case"residue":return nQe(e,t,r,n,a);case"element":return aQe(e,t,r,n,a)}}var au=A(),Gg=new Ms("98");function rQe(e,t,r,n,a){for(var i=ot.create(t),o=t.units,s=t.serialMapping,u=mt.chain,l=u.auth_asym_id,c=u.label_asym_id,d=s.cumulativeUnitElementCount,f=o.length,p=n.chainScale,h=Sd.create(n,f,f/2,a),m=0,v=o.length;m<v;++m){var g=o[m];i.unit=g,i.element=g.elements[0];var y=g.lookup3d.boundary.sphere,b=y.center,S=y.radius;A.transformMat4(au,b,g.conformation.operator.matrix);var x=l(i),C=c(i),w=x===C?C:C+" ["+x+"]";h.add(w,au[0],au[1],au[2],S,p,d[m])}return h.getText()}function nQe(e,t,r,n,a){for(var i=ot.create(t),o=t.units,s=t.serialMapping,u=mt.atom.label_comp_id,l=mt.residue.auth_seq_id,c=s.cumulativeUnitElementCount,d=t.polymerResidueCount*2,f=n.residueScale,p=Sd.create(n,d,d/2,a),h=0,m=o.length;h<m;++h){var v=o[h],g=v.conformation.position,y=v.elements;i.unit=v,i.element=v.elements[0];for(var b=v.model.atomicHierarchy.residueAtomSegments.index,S=c[h],x=0,C=y.length;x<C;){var w=x,_=b[y[x]];for(x++;x<C&&b[y[x]]===_;)x++;Gg.reset();for(var E=w;E<x;E++)g(y[E],au),Gg.includePosition(au);Gg.finishedIncludeStep();for(var E=w;E<x;E++)g(y[E],au),Gg.radiusPosition(au);i.element=y[w];var P=Gg.getSphere(),D=P.center,k=P.radius,F=l(i),X=u(i),U=X+" "+F;p.add(U,D[0],D[1],D[2],k,f,S+w)}}return p.getText()}function aQe(e,t,r,n,a){for(var i=ot.create(t),o=t.units,s=t.serialMapping,u=mt.atom,l=u.label_atom_id,c=u.label_alt_id,d=s.cumulativeUnitElementCount,f=xb({},{scale:1}),p=t.elementCount,h=n.elementScale,m=Sd.create(n,p,p/2,a),v=0,g=o.length;v<g;++v){var y=o[v],b=y.conformation.position,S=y.elements;i.unit=y;for(var x=d[v],C=0,w=S.length;C<w;C++){i.element=S[C],b(i.element,au);var _=l(i),E=c(i),P=E?_+"%"+E:_;m.add(P,au[0],au[1],au[2],f.size(i),h,x+C)}}return m.getText()}var MJ={"label-text":function(e,t){return Qu("Label text",e,t,eQe)}},DJ=T(T({},IJ),{visuals:M.MultiSelect(["label-text"],M.objectToOptions(MJ))});function iQe(e,t){return M.clone(DJ)}function oQe(e,t){var r=mr.createMulti("Label",e,t,si,MJ);return r.setState({pickable:!1,markerActions:sr.None}),r}var sQe={name:"label",label:"Label",description:"Displays labels.",factory:oQe,getParams:iQe,defaultValues:M.getDefaultValues(DJ),defaultColorTheme:{name:"uniform"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.elementCount>0}};function uQe(e,t){return e[0]=e[1]=e[2]=1,t[0]!==0?e[0]=(t[1]+t[2])/-t[0]:t[1]!==0?e[1]=(t[0]+t[2])/-t[1]:t[2]!==0&&(e[2]=(t[0]+t[1])/-t[2]),e}function lQe(e){for(var t=0,r=2*Math.PI/e,n=new Float32Array(e),a=new Float32Array(e),i=0;i<e;i++)n[i]=Math.cos(t),a[i]=Math.sin(t),t+=r;return{cosTable:n,sinTable:a}}var ZR={probeRadius:M.Numeric(1.4,{min:0,max:10,step:.1},{description:"Radius of the probe tracing the molecular surface."}),resolution:M.Numeric(.5,{min:.01,max:20,step:.01},T({description:"Grid resolution/cell spacing."},Dt.CustomQualityParamInfo)),probePositions:M.Numeric(36,{min:12,max:90,step:1},T({description:"Number of positions tested for probe target intersection."},Dt.CustomQualityParamInfo))};M.getDefaultValues(ZR);function cQe(e,t,r,n,a,i){return pe(this,void 0,void 0,function(){function o(Ge,Je,st,ze,et){if(p!==-1){var ut=p;if(ut!==ze&&ut!==et&&s(ut,Ge,Je,st))return ut;p=-1}for(var pt=0,ht=E.count;pt<ht;++pt){var ut=Ne.getAt(P,E.indices[pt]);if(ut!==ze&&ut!==et&&s(ut,Ge,Je,st))return p=ut,ut}return-1}function s(Ge,Je,st,ze){var et=U[Ge],ut=D[Ge]-Je,pt=k[Ge]-st,ht=F[Ge]-ze,Re=ut*ut+pt*pt+ht*ht;return Re<et*et}function u(Ge,Je){for(var st=Ge;st<Je;++st){var ze=Ne.getAt(P,st),et=D[ze],ut=k[ze],pt=F[ze],ht=U[ze],Re=ht*ht;_.find(et,ut,pt,ht);for(var it=Math.ceil(ht*x),Fe=Math.floor(x*(et-V)),tt=Math.floor(x*(ut-ee)),wt=Math.floor(x*(pt-ue)),dt=Math.max(0,Fe-it),Et=Math.max(0,tt-it),oe=Math.max(0,wt-it),ge=Math.min(R,Fe+it+2),Ee=Math.min(Y,tt+it+2),Ze=Math.min(re,wt+it+2),xt=dt;xt<ge;++xt)for(var Tt=le[xt]-et,Qt=xt*H,dr=Et;dr<Ee;++dr)for(var _r=O[dr]-ut,Jt=Tt*Tt+_r*_r,ea=dr*K+Qt,On=oe;On<Ze;++On){var La=G[On]-pt,no=Jt+La*La;if(no<Re){var Os=On+ea;Se[Os]<0&&(Se[Os]*=-1);var wu=Math.sqrt(no),$o=ht/wu,_o=Tt*$o+et,mc=_r*$o+ut,Ui=La*$o+pt;if(o(_o,mc,Ui,ze,-1)===-1){var cl=ht-wu;cl<Se[Os]&&(Se[Os]=cl,ie[Os]=X[st])}}}}}function l(){return pe(this,void 0,void 0,function(){var Ge;return he(this,function(Je){switch(Je.label){case 0:Ge=0,Je.label=1;case 1:return Ge<j?(u(Ge,Math.min(Ge+ve,j)),e.shouldUpdate?[4,e.update({message:"projecting points",current:Ge,max:j})]:[3,3]):[3,4];case 2:Je.sent(),Je.label=3;case 3:return Ge+=ve,[3,1];case 4:return[2]}})})}function c(Ge,Je){var st=U[Ge],ze=U[Je],et=h[0]=D[Je]-D[Ge],ut=h[1]=k[Je]-k[Ge],pt=h[2]=F[Je]-F[Ge],ht=et*et+ut*ut+pt*pt,Re=Math.sqrt(ht),it=(st*st+Re*Re-ze*ze)/(2*st*Re),Fe=st*it;A.normalize(h,h),uQe(v,h),A.normalize(v,v),A.cross(g,h,v),A.normalize(g,g);var tt=Math.sqrt(st*st-Fe*Fe);A.scale(v,v,tt),A.scale(g,g,tt),A.scale(h,h,Fe),m[0]=h[0]+D[Ge],m[1]=h[1]+k[Ge],m[2]=h[2]+F[Ge],p=-1;for(var wt=0;wt<S;++wt){var dt=fe[wt],Et=me[wt],oe=m[0]+dt*v[0]+Et*g[0],ge=m[1]+dt*v[1]+Et*g[1],Ee=m[2]+dt*v[2]+Et*g[2];if(o(oe,ge,Ee,Ge,Je)===-1)for(var Ze=Math.floor(x*(oe-V)),xt=Math.floor(x*(ge-ee)),Tt=Math.floor(x*(Ee-ue)),Qt=Math.max(0,Ze-C),dr=Math.max(0,xt-C),_r=Math.max(0,Tt-C),Jt=Math.min(R,Ze+C+2),ea=Math.min(Y,xt+C+2),On=Math.min(re,Tt+C+2),La=Qt;La<Jt;++La)for(var no=oe-le[La],Os=La*H,wu=dr;wu<ea;++wu)for(var $o=ge-O[wu],_o=no*no+$o*$o,mc=wu*K+Os,Ui=_r;Ui<On;++Ui){var cl=Ee-G[Ui],Um=_o+cl*cl,vc=Ui+mc,Ao=Se[vc];if(Ao>0&&Um<Ao*Ao){Se[vc]=Math.sqrt(Um);var wi=no*h[0]+$o*h[1]+cl*h[2];ie[vc]=X[Ne.indexOf(P,wi<0?Je:Ge)]}}}}function d(Ge,Je){for(var st=Ge;st<Je;++st){var ze=Ne.getAt(P,st);_.find(D[ze],k[ze],F[ze],U[ze]);for(var et=0,ut=E.count;et<ut;++et){var pt=Ne.getAt(P,E.indices[et]);ze<pt&&c(ze,pt)}}}function f(){return pe(this,void 0,void 0,function(){var Ge;return he(this,function(Je){switch(Je.label){case 0:Ge=0,Je.label=1;case 1:return Ge<j?(d(Ge,Math.min(Ge+ve,j)),e.shouldUpdate?[4,e.update({message:"projecting torii",current:Ge,max:j})]:[3,3]):[3,4];case 2:Je.sent(),Je.label=3;case 3:return Ge+=ve,[3,1];case 4:return[2]}})})}var p,h,m,v,g,y,b,S,x,C,w,_,E,P,D,k,F,X,U,j,te,q,W,V,ee,ue,$,Q,R,Y,re,K,L,H,Z,fe,me,xe,Se,ie,le,O,G,ve,we,Te,Ue;return he(this,function(Ge){switch(Ge.label){case 0:return p=-1,h=A(),m=A(),v=A(),g=A(),y=i.resolution,b=i.probeRadius,S=i.probePositions,x=1/y,C=Math.max(5,2+Math.floor(b*x)),w=A.create(n,n,n),A.scale(w,w,2),_=nm(t,r,w),E=_.result,a===null&&(a=_.boundary.box),P=t.indices,D=t.x,k=t.y,F=t.z,X=t.id,U=t.radius,j=Ne.size(P),te=n+y,q=tr.expand(tr(),a,A.create(te,te,te)),W=q.min,V=W[0],ee=W[1],ue=W[2],$=tr.scale(tr(),q,x),Q=tr.size(A(),$),A.ceil(Q,Q),R=Q[0],Y=Q[1],re=Q[2],K=re,L=Y,H=K*L,Z=lQe(S),fe=Z.cosTable,me=Z.sinTable,xe=Rr.Space(Q,[0,1,2],Float32Array),Se=xe.create(),ie=xe.create(),Se.fill(-1001),ie.fill(-1),le=Kv(R,V,y),O=Kv(Y,ee,y),G=Kv(re,ue,y),ve=Math.ceil(1e5/(Math.pow(Math.pow(n,3),3)*x)),[4,l()];case 1:return Ge.sent(),[4,f()];case 2:return Ge.sent(),we=Rr.create(xe,Se),Te=Rr.create(xe,ie),Ue=de.identity(),de.fromScaling(Ue,A.create(y,y,y)),de.setTranslation(Ue,q.min),[2,{field:we,idField:Te,transform:Ue,resolution:y}]}})})}function dQe(e,t,r){for(var n=r.probeRadius,a=T_(e,t,r),i=a.position,o=a.boundary,s=a.radius,u=i.indices,l=Ne.size(u),c=new Float32Array(Ne.end(u)),d=0,f=0;f<l;++f){var p=Ne.getAt(u,f),h=s(p);d<h&&(d=h),c[p]=h+n}return{position:T(T({},i),{radius:c}),boundary:o,maxRadius:d}}function kJ(e,t,r){var n=this,a=t.lookup3d.boundary.box,i=Mm(a,r),o=dQe(e,t,i),s=o.position,u=o.boundary,l=o.maxRadius;return Qe.create("Molecular Surface",function(c){return pe(n,void 0,void 0,function(){return he(this,function(d){switch(d.label){case 0:return[4,fQe(c,s,u,l,a,i)];case 1:return[2,d.sent()]}})})})}function fQe(e,t,r,n,a,i){return pe(this,void 0,void 0,function(){return he(this,function(o){return[2,cQe(e,t,r,n,a,i)]})})}var RJ=T(T(T(T({},wo),ZR),A_),xJ);function pQe(e,t,r,n,a,i){return pe(this,void 0,void 0,function(){var o,s,u,l,c,d,f,p;return he(this,function(h){switch(h.label){case 0:return[4,kJ(r,t,a).runInContext(e.runtime)];case 1:return o=h.sent(),s=o.transform,u=o.field,l=o.idField,c=o.resolution,d={isoLevel:a.probeRadius,scalarField:u,idField:l},[4,I_(d,i).runAsChild(e.runtime)];case 2:return f=h.sent(),Wt.transform(f,s),e.webgl&&!e.webgl.isWebGL2&&Wt.uniformTriangleGroup(f),p=He.expand(He(),t.boundary.sphere,a.probeRadius+q0(t)),f.setBoundingSphere(p),f.meta.resolution=c,[2,f]}})})}function hQe(e){return Rs({defaultProps:M.getDefaultValues(RJ),createGeometry:pQe,createLocationIterator:to.fromGroup,getLoci:hc,eachLocation:pc,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.probeRadius!==n.probeRadius&&(t.createGeometry=!0),r.probePositions!==n.probePositions&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0),r.smoothColors.name!==n.smoothColors.name?t.updateColor=!0:r.smoothColors.name==="on"&&n.smoothColors.name==="on"&&(r.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(t.updateColor=!0),r.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(t.updateColor=!0))},processValues:function(t,r,n,a,i){var o=r.meta,s=o.resolution,u=o.colorTexture,l=Ob(n,a,s,i);l&&($R(t,l.resolution,l.stride,l.webgl,u),r.meta.colorTexture=t.tColorGrid.ref.value)},dispose:function(t){var r;(r=t.meta.colorTexture)===null||r===void 0||r.destroy()}},e)}var OJ=T(T(T(T({},aR),ZR),A_),{sizeFactor:M.Numeric(1.5,{min:0,max:10,step:.1})});function mQe(e,t,r,n,a,i){return pe(this,void 0,void 0,function(){var o,s,u,l,c,d,f;return he(this,function(p){switch(p.label){case 0:return[4,kJ(r,t,a).runInContext(e.runtime)];case 1:return o=p.sent(),s=o.transform,u=o.field,l=o.idField,c={isoLevel:a.probeRadius,scalarField:u,idField:l},[4,dR(c,i).runAsChild(e.runtime)];case 2:return d=p.sent(),Mn.transform(d,s),f=He.expand(He(),t.boundary.sphere,a.probeRadius+q0(t)),d.setBoundingSphere(f),[2,d]}})})}function vQe(e){return iR({defaultProps:M.getDefaultValues(OJ),createGeometry:mQe,createLocationIterator:to.fromGroup,getLoci:hc,eachLocation:pc,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.probeRadius!==n.probeRadius&&(t.createGeometry=!0),r.probePositions!==n.probePositions&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0)}},e)}var BJ={"molecular-surface-mesh":function(e,t){return Ba("Molecular surface mesh",e,t,hQe)},"molecular-surface-wireframe":function(e,t){return Ba("Molecular surface wireframe",e,t,vQe)}},FJ=T(T(T({},RJ),OJ),{visuals:M.MultiSelect(["molecular-surface-mesh"],M.objectToOptions(BJ))});function gQe(e,t){return M.clone(FJ)}function yQe(e,t){return mr.createMulti("Molecular Surface",e,t,si,BJ)}var bQe={name:"molecular-surface",label:"Molecular Surface",description:"Displays a molecular surface.",factory:yQe,getParams:gQe,defaultValues:M.getDefaultValues(FJ),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.elementCount>0}},LJ=T(T({},wo),{sizeFactor:M.Numeric(1,{min:0,max:2,step:.1}),detail:M.Numeric(0,{min:0,max:3,step:1},Dt.CustomQualityParamInfo)});function xQe(e){return Rs({defaultProps:M.getDefaultValues(LJ),createGeometry:CQe,createLocationIterator:wQe,getLoci:_Qe,eachLocation:AQe,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail}},e)}function SQe(e){if(We.Traits.is(e.traits,1)||We.Traits.is(e.traits,2))return!1;if(We.isCoarse(e))return!0;if(e.elements.length===0)return!1;e.model.atomicHierarchy.derived.residue.moleculeType;var t=e.residueIndex[e.elements[0]],r=e.model.atomicHierarchy.derived.residue.moleculeType[t];return!(r===3||r===2)}function CQe(e,t,r,n,a,i){if(!SQe(t))return Wt.createEmpty(i);var o=a.detail,s=a.sizeFactor,u=256,l=kt.createState(u,u/2,i),c=t.principalAxes.boxAxes,d=c.origin,f=c.dirA,p=c.dirB,h=Hu.size(A(),c);A.scale(h,h,s/2);var m=A.create(h[2],h[1],h[0]);l.currentGroup=0,Gk(l,d,f,p,m,o+1);var v=kt.getMesh(l),g=He.expand(He(),t.boundary.sphere,1*a.sizeFactor);return v.setBoundingSphere(g),v}function wQe(e){var t=e.group,r=e.structure,n=1,a=t.units.length,i=ot.create(r),o=function(s,u){var l=t.units[u];return i.unit=l,i.element=l.elements[s],i};return Tn(n,a,1,o)}function _Qe(e,t,r){var n=e.objectId,a=e.instanceId;if(r===n){var i=t.structure,o=t.group,s=o.units[a],u=Ne.ofBounds(0,s.elements.length);return Oe(i,[{unit:s,indices:u}])}return zr}function AQe(e,t,r){var n=!1;if(!Oe.is(e))return!1;var a=t.structure,i=t.group;if(!$e.areEquivalent(e.structure,a))return!1;for(var o=i.elements.length,s=0,u=e.elements;s<u.length;s++){var l=u[s],c=i.unitIndexMap.get(l.unit.id);c!==void 0&&Ne.size(l.indices)===o&&r(Me.ofSingleton(c))&&(n=!0)}return n}var NJ={"orientation-ellipsoid-mesh":function(e,t){return Ba("Orientation ellipsoid mesh",e,t,xQe)}},zJ=T(T({},LJ),{visuals:M.MultiSelect(["orientation-ellipsoid-mesh"],M.objectToOptions(NJ))});function TQe(e,t){return M.clone(zJ)}function EQe(e,t){return mr.createMulti("Orientation",e,t,si,NJ)}var PQe={name:"orientation",label:"Orientation",description:"Displays orientation ellipsoids for polymer chains.",factory:EQe,getParams:TQe,defaultValues:M.getDefaultValues(zJ),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.elementCount>0}},IQe=Ke.add3,MQe=Ke.add,WI;(function(e){function t(r,n,a){r===void 0&&(r=2048),n===void 0&&(n=1024);var i=Ke.create(Float32Array,3,n,a?a.centerBuffer.ref.value:r),o=Ke.create(Float32Array,1,n,a?a.groupBuffer.ref.value:r);return{add:function(s,u,l,c){IQe(i,s,u,l),MQe(o,c)},getPoints:function(){var s=Ke.compact(i,!0),u=Ke.compact(o,!0);return im.create(s,u,i.elementCount,a)}}}e.create=t})(WI||(WI={}));var UJ=T(T({},fze),{pointSizeAttenuation:M.Boolean(!0),ignoreHydrogens:M.Boolean(!1),traceOnly:M.Boolean(!1)});function DQe(e,t,r,n,a,i){var o=r.child;if(o&&!o.unitMap.get(t.id))return im.createEmpty(i);var s=t.elements,u=s.length,l=WI.create(u,u/10,i),c=A(),d=t.conformation.invariantPosition,f=HR(r,t,a);if(f)for(var p=0;p<u;++p)f(s[p])||(d(s[p],c),l.add(c[0],c[1],c[2],p));else for(var p=0;p<u;++p)d(s[p],c),l.add(c[0],c[1],c[2],p);var h=l.getPoints(),m=He.expand(He(),t.boundary.sphere,1*a.sizeFactor);return h.setBoundingSphere(m),h}function kQe(e){return pze({defaultProps:M.getDefaultValues(UJ),createGeometry:DQe,createLocationIterator:to.fromGroup,getLoci:hc,eachLocation:pc,setUpdateState:function(t,r,n){t.createGeometry=r.ignoreHydrogens!==n.ignoreHydrogens||r.traceOnly!==n.traceOnly}},e)}var RQe={"element-point":function(e,t){return Ba("Points",e,t,kQe)}},VJ=T({},UJ);function OQe(e,t){return M.clone(VJ)}function BQe(e,t){return mr.createMulti("Point",e,t,si,RQe)}var FQe={name:"point",label:"Point",description:"Displays elements (atoms, coarse spheres) as spheres.",factory:BQe,getParams:OQe,defaultValues:M.getDefaultValues(VJ),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"physical"},isApplicable:function(e){return e.elementCount>0}},HJ={sizeFactor:M.Numeric(.2,{min:0,max:10,step:.01}),detail:M.Numeric(0,{min:0,max:3,step:1},Dt.CustomQualityParamInfo),linearSegments:M.Numeric(8,{min:1,max:48,step:1},Dt.CustomQualityParamInfo),radialSegments:M.Numeric(16,{min:2,max:56,step:2},Dt.CustomQualityParamInfo)};M.getDefaultValues(HJ);var ko=A();function LQe(e,t,r,n,a,i){var o=t.polymerElements.length;if(!o)return Wt.createEmpty(i);for(var s=a.sizeFactor,u=a.detail,l=a.linearSegments,c=a.radialSegments,d=l*c*o+(c+1)*o*2,f=kt.createState(d,d/10,i),p=GR(l),h=p.curvePoints,m=p.normalVectors,v=p.binormalVectors,g=p.widthValues,y=p.heightValues,b=0,S=jR(t,r,!0);S.hasNext;){var x=S.move();f.currentGroup=b;var C=kp(x.moleculeType),w=C?zZ:NZ;qR(p,x,LZ,w);var _=x.coarseBackboneFirst||x.first,E=x.coarseBackboneLast||x.last,P=n.size.size(x.centerPrev)*s,D=n.size.size(x.center)*s,k=n.size.size(x.centerNext)*s;HI(p,P,D,k,P,D,k,w);var F=l;if(x.initial){F=Math.max(Math.round(l*w),1);var X=l-F;h.copyWithin(0,X*3),v.copyWithin(0,X*3),m.copyWithin(0,X*3),g.copyWithin(0,X*3),y.copyWithin(0,X*3),A.fromArray(ko,h,3),A.normalize(ko,A.sub(ko,x.p2,ko)),A.scaleAndAdd(ko,x.p2,ko,D*M3),A.toArray(ko,h,0)}else x.final&&(F=Math.max(Math.round(l*(1-w)),1),A.fromArray(ko,h,F*3-3),A.normalize(ko,A.sub(ko,x.p2,ko)),A.scaleAndAdd(ko,x.p2,ko,D*M3),A.toArray(ko,h,F*3));x.initial===!0&&x.final===!0?ti(f,x.p2,D*2,u):c===2?SS(f,h,m,v,F,g,y,0):c===4?qI(f,h,m,v,F,g,y,0,_,E):JZ(f,h,m,v,F,c,g,y,_,E),++b}var U=kt.getMesh(f),j=He.expand(He(),t.boundary.sphere,1*a.sizeFactor);return U.setBoundingSphere(j),U}var jJ=T(T({},wo),HJ);function NQe(e){return Rs({defaultProps:M.getDefaultValues(jJ),createGeometry:LQe,createLocationIterator:X1.fromGroup,getLoci:WR,eachLocation:XR,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail||r.linearSegments!==n.linearSegments||r.radialSegments!==n.radialSegments}},e)}var GJ={"polymer-tube":function(e,t){return Ba("Polymer tube mesh",e,t,NQe)},"polymer-gap":function(e,t){return Ba("Polymer gap cylinder",e,t,QZ)}},qJ=T(T(T({},jJ),YR),{sizeFactor:M.Numeric(.2,{min:0,max:10,step:.01}),visuals:M.MultiSelect(["polymer-tube","polymer-gap"],M.objectToOptions(GJ))});function zQe(e,t){var r=M.clone(qJ),n=!1,a=!1;return t.units.forEach(function(i){!n&&We.isAtomic(i)&&i.nucleotideElements.length&&(n=!0),!a&&i.gapElements.length&&(a=!0)}),r.visuals.defaultValue=["polymer-tube"],a&&r.visuals.defaultValue.push("polymer-gap"),r}function UQe(e,t){return mr.createMulti("Putty",e,t,si,GJ)}var VQe={name:"putty",label:"Putty",description:"Displays a tube smoothly following the trace atoms of polymers.",factory:UQe,getParams:zQe,defaultValues:M.getDefaultValues(qJ),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uncertainty"},isApplicable:function(e){return e.polymerResidueCount>0}},HQe={"element-sphere":function(e,t){return Ba("Sphere mesh",e,t,AZ)}},WJ=T({},H_);function jQe(e,t){var r=M.clone(WJ);return t.isCoarseGrained&&(r.sizeFactor.defaultValue=2),r}function GQe(e,t){return mr.createMulti("Spacefill",e,t,si,HQe)}var qQe={name:"spacefill",label:"Spacefill",description:"Displays atomic/coarse elements as spheres.",factory:GQe,getParams:jQe,defaultValues:M.getDefaultValues(WJ),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"physical"},isApplicable:function(e){return e.elementCount>0}},tU=$r.is;function WQe(e,t,r,n,a,i){if(!We.isAtomic(t))return Mn.createEmpty(i);var o=r.child,s=o?.unitMap.get(t.id);if(o&&!s)return Mn.createEmpty(i);if(a.includeParent&&!o)throw new Error("expected child to exist");var u=ot.create(r,t),l=t.elements,c=t.bonds,d=c.edgeCount,f=c.a,p=c.b,h=c.edgeProps,m=c.offset,v=h.order,g=h.flags,y=a.sizeFactor;if(!d)return Mn.createEmpty(i);var b=A(),S=t.conformation.invariantPosition,x={linkCount:d*2,referencePosition:function(_){var E,P,D=f[_],k=p[_];D>k&&(E=[k,D],D=E[0],k=E[1]),m[D+1]-m[D]===1&&(P=[k,D],D=P[0],k=P[1]);for(var F=m[D],X=m[D+1];F<X;++F){var U=p[F];if(U!==k&&U!==D)return S(l[U],b)}for(var F=m[k],X=m[k+1];F<X;++F){var j=f[F];if(j!==D&&j!==k)return S(l[j],b)}return null},position:function(_,E,P){S(l[f[P]],_),S(l[p[P]],E)},style:function(_){var E=v[_],P=g[_];return tU(P,2)||tU(P,4)?1:E===2?2:E===3?3:0},radius:function(_){u.element=l[f[_]];var E=n.size.size(u);u.element=l[p[_]];var P=n.size.size(u);return Math.min(E,P)*y},ignore:yZ(r,t,a)},C=Y$(e,x,a,i),w=He.expand(He(),(s??t).boundary.sphere,1*y);return C.setBoundingSphere(w),C}var XJ=T(T(T({},aR),LR),{includeParent:M.Boolean(!1)});function XQe(e){return iR({defaultProps:M.getDefaultValues(XJ),createGeometry:WQe,createLocationIterator:Ap.fromGroup,getLoci:NR,eachLocation:zR,setUpdateState:function(t,r,n,a,i,o,s){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.dashCount!==n.dashCount||r.ignoreHydrogens!==n.ignoreHydrogens||!yo(r.includeTypes,n.includeTypes)||!yo(r.excludeTypes,n.excludeTypes);var u=o.group.units[0],l=s.group.units[0];We.isAtomic(u)&&We.isAtomic(l)&&(qo.areEqual(u.bonds,l.bonds)||(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.updateSize=!0))}},e)}var aE=new $t.ElementBondIterator;function rU(e,t,r,n){for(aE.setElement(t,r,n);aE.hasNext;){var a=aE.move();return a.otherUnit.conformation.position(a.otherUnit.elements[a.otherIndex],e),e}return null}function YQe(e,t,r,n,a){var i=t.interUnitBonds,o=i.edgeCount,s=i.edges,u=n.sizeFactor;if(!o)return Mn.createEmpty(a);var l=A(),c=ot.create(),d={linkCount:o,referencePosition:function(m){var v=s[m],g,y,b,S;if(v.unitA<v.unitB)g=t.unitMap.get(v.unitA),y=t.unitMap.get(v.unitB),b=v.indexA,S=v.indexB;else if(v.unitA>v.unitB)g=t.unitMap.get(v.unitB),y=t.unitMap.get(v.unitA),b=v.indexB,S=v.indexA;else throw new Error("same units in createInterUnitBondLines");return rU(l,t,g,b)||rU(l,t,y,S)},position:function(m,v,g){var y=s[g],b=t.unitMap.get(y.unitA),S=t.unitMap.get(y.unitB);b.conformation.position(b.elements[y.indexA],m),S.conformation.position(S.elements[y.indexB],v)},style:function(m){var v=s[m].props.order,g=Oi.create(s[m].props.flag);return $r.is(g,2)||$r.is(g,4)?1:v===2?2:v===3?3:0},radius:function(m){var v=s[m];c.structure=t,c.unit=t.unitMap.get(v.unitA),c.element=c.unit.elements[v.indexA];var g=r.size.size(c);c.unit=t.unitMap.get(v.unitB),c.element=c.unit.elements[v.indexB];var y=r.size.size(c);return Math.min(g,y)*u},ignore:bZ(t,n)},f=Y$(e,d,n,a),p=t.child,h=He.expand(He(),(p??t).boundary.sphere,1*n.sizeFactor);return f.setBoundingSphere(h),f}var YJ=T(T(T({},JNe),LR),{includeParent:M.Boolean(!1)});function KQe(e){return eze({defaultProps:M.getDefaultValues(YJ),createGeometry:YQe,createLocationIterator:Ap.fromStructure,getLoci:UR,eachLocation:VR,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.dashCount!==n.dashCount||r.ignoreHydrogens!==n.ignoreHydrogens||!yo(r.includeTypes,n.includeTypes)||!yo(r.excludeTypes,n.excludeTypes)}},e)}var KJ={"intra-bond":function(e,t){return Ba("Intra-unit bond line",e,t,XQe)},"inter-bond":function(e,t){return Qu("Inter-unit bond line",e,t,KQe)}},$J=T(T(T({},XJ),YJ),{sizeFactor:M.Numeric(1.5,{min:.01,max:10,step:.01}),unitKinds:_b(["atomic"]),visuals:M.MultiSelect(["intra-bond","inter-bond"],M.objectToOptions(KJ))});function $Qe(e,t){return M.clone($J)}function QQe(e,t){return mr.createMulti("Line",e,t,si,KJ)}var ZQe={name:"line",label:"Line",description:"Displays bonds as lines.",factory:QQe,getParams:$Qe,defaultValues:M.getDefaultValues($J),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.elementCount>0},getData:function(e,t){return t.includeParent?e.asParent():e},mustRecreate:function(e,t){return e.includeParent!==t.includeParent}};function JQe(e,t,r,n,a){return pe(this,void 0,void 0,function(){var i,o,s,u,l,c,d,f,p,h,m,v,g;return he(this,function(y){switch(y.label){case 0:if(i=e.runtime,o=e.webgl,!o||!o.extensions.blendMinMax)throw new Error("GaussianDensityVolume requires `webgl` and `blendMinMax` extension");return s=a?a.gridTexture.ref.value:void 0,[4,C$e(t,n,o,s).runInContext(i)];case 1:return u=y.sent(),l=u.transform,c=u.texture,d=u.bbox,f=u.gridDim,p={min:0,max:1,mean:.04,sigma:.01},h=de.mul(de(),l,de.fromScaling(de(),f)),m=de.getScaling(A(),l),v=bo.create(d,f,l,h,m,c,p,!0,a),g=He.expand(He(),t.boundary.sphere,n.radiusOffset+E_(t)),v.setBoundingSphere(g),[2,v]}})})}var QJ=T(T(T({},nze),Rb),{ignoreHydrogens:M.Boolean(!1)});function eZe(e){return aze({defaultProps:M.getDefaultValues(QJ),createGeometry:JQe,createLocationIterator:to.fromStructure,getLoci:V_,eachLocation:U_,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0)},dispose:function(t){t.gridTexture.ref.value.destroy()}},e)}function tZe(e,t,r,n,a,i){return pe(this,void 0,void 0,function(){var o,s,u,l,c,d,f,p,h,m,v,g,y;return he(this,function(b){switch(b.label){case 0:if(o=e.runtime,s=e.webgl,!s)throw new Error("GaussianDensityVolume requires `webgl`");return u=i?i.gridTexture.ref.value:void 0,[4,b$e(r,t,a,s,u).runInContext(o)];case 1:return l=b.sent(),c=l.transform,d=l.texture,f=l.bbox,p=l.gridDim,h={min:0,max:1,mean:.04,sigma:.01},m=de.mul(de(),c,de.fromScaling(de(),p)),v=de.getScaling(A(),c),g=bo.create(f,p,c,m,v,d,h,!0,i),y=He.expand(He(),t.boundary.sphere,a.radiusOffset+q0(t)),g.setBoundingSphere(y),[2,g]}})})}var rZe=T(T(T({},hze),Rb),{ignoreHydrogens:M.Boolean(!1)});function nZe(e){return mze({defaultProps:M.getDefaultValues(rZe),createGeometry:tZe,createLocationIterator:to.fromGroup,getLoci:hc,eachLocation:pc,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0)},dispose:function(t){t.gridTexture.ref.value.destroy()}},e)}var ZJ={"gaussian-volume":function(e,t){return Qu("Gaussian volume",e,t,eZe)},"units-gaussian-volume":function(e,t){return Ba("Units-Gaussian volume",e,t,nZe)}},JJ=T(T({},QJ),{visuals:M.MultiSelect(["gaussian-volume"],M.objectToOptions(ZJ))});function aZe(e,t){var r=M.clone(JJ);return r.renderMode=bo.createRenderModeParam({min:0,max:1,mean:.04,sigma:.01}),r.jumpLength=M.Numeric(4,{min:0,max:20,step:.1}),r}function iZe(e,t){return mr.createMulti("Gaussian Volume",e,t,si,ZJ)}var oZe={name:"gaussian-volume",label:"Gaussian Volume",description:"Displays a gaussian molecular density using direct volume rendering.",factory:iZe,getParams:aZe,defaultValues:M.getDefaultValues(JJ),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.elementCount>0}},XI=function(e){Le(t,e);function t(){var r=e.call(this)||this;return rl(t.BuiltIn,function(n,a){if(n.name!==a)throw new Error("Fix BuiltInStructureRepresentations to have matching names. "+n.name+" "+a);r.add(n)}),r}return t}(IK);(function(e){e.BuiltIn={cartoon:a$e,"ball-and-stick":vYe,carbohydrate:JYe,ellipsoid:l$e,"gaussian-surface":J$e,"gaussian-volume":oZe,label:sQe,line:ZQe,"molecular-surface":bQe,orientation:PQe,point:FQe,putty:VQe,spacefill:qQe}})(XI||(XI={}));var sZe=function(){function e(t){var r=this;this.plugin=t,this.currentFrame=void 0,this._isAnimating=!1,this.frame=function(){r.tick(Gn()),r._isAnimating&&(r.currentFrame=requestAnimationFrame(r.frame))}}return Object.defineProperty(e.prototype,"isAnimating",{get:function(){return this._isAnimating},enumerable:!1,configurable:!0}),e.prototype.tick=function(t,r){var n;return pe(this,void 0,void 0,function(){return he(this,function(a){switch(a.label){case 0:return[4,this.plugin.managers.animation.tick(t,r?.isSynchronous)];case 1:return a.sent(),(n=this.plugin.canvas3d)===null||n===void 0||n.tick(t,r),[2]}})})},e.prototype.resetTime=function(t){var r;t===void 0&&(t=Gn()),(r=this.plugin.canvas3d)===null||r===void 0||r.resetTime(t)},e.prototype.start=function(){this._isAnimating=!0,this.resetTime(),this.currentFrame=requestAnimationFrame(this.frame)},e.prototype.stop=function(){this._isAnimating=!1,this.currentFrame!==void 0&&(cancelAnimationFrame(this.currentFrame),this.currentFrame=void 0)},e}(),uZe=function(){function e(t){var r=this;this.plugin=t,this.ev=pd.create(),this.events={updated:this.ev(),removed:this.ev()},this.root=new Map,this.tracked=new Map,t.state.data.events.object.created.subscribe(function(n){r.addMapping(n.state,n.ref,n.obj)}),t.state.data.events.object.removed.subscribe(function(n){r.removeMapping(n.ref)&&r.events.removed.next({ref:n.ref,obj:n.obj})}),t.state.data.events.object.updated.subscribe(function(n){r.updateMapping(n.state,n.ref,n.oldObj,n.obj)&&r.events.updated.next({ref:n.ref,oldObj:n.oldObj,obj:n.obj})})}return e.prototype.getDecorator=function(t){var r=this.plugin.state.data.tree,n=r.children.get(t);if(n.size!==1)return t;var a=n.first();return r.transforms.get(a).transformer.definition.isDecorator?this.getDecorator(a):t},e.prototype.get=function(t,r){r===void 0&&(r=!1);var n=this.root.get(t);if(!!n)return r?this.plugin.state.data.cells.get(n.ref):this.plugin.state.data.cells.get(this.getDecorator(n.ref))},e.prototype.addMapping=function(t,r,n){if(!be.Molecule.Structure.is(n))return!1;if(this.tracked.set(r,n.data),this.root.has(n.data)){var a=this.root.get(n.data);a.count++}else{var i=t.select(lr.Generators.byRef(r).rootOfType([be.Molecule.Structure]))[0];i?this.root.set(n.data,{ref:i.transform.ref,count:1}):this.root.set(n.data,{ref:r,count:1})}return!0},e.prototype.removeMapping=function(t){if(!this.tracked.has(t))return!1;var r=this.tracked.get(t);this.tracked.delete(t);var n=this.root.get(r);return n.count>1?n.count--:this.root.delete(r),!0},e.prototype.updateMapping=function(t,r,n,a){return be.Molecule.Structure.is(a)?(this.removeMapping(r),this.addMapping(t,r,a),!0):!1},e.prototype.dispose=function(){this.ev.dispose()},e}(),YI=function(){function e(){this.ev=pd.create(),this.id=0,this.runningTasks=new Set,this.abortRequests=new Map,this.options=new Map,this.currentContext=[],this.events={progress:this.ev(),finished:this.ev()}}return e.prototype.tryGetAbortTaskId=function(t){if(this.abortRequests.has(t.progress.taskId))return t.progress.taskId;for(var r=0,n=t.children;r<n.length;r++){var a=n[r],i=this.tryGetAbortTaskId(a);if(i!==void 0)return i}},e.prototype.track=function(t,r){var n=this;return function(a){var i;if(a.canAbort&&a.requestAbort){var o=n.tryGetAbortTaskId(a.root);o!==void 0&&a.requestAbort(n.abortRequests.get(o))}var s=Gn()-a.root.progress.startedTime;n.events.progress.next({id:t,useOverlay:(i=n.options.get(r))===null||i===void 0?void 0:i.useOverlay,level:s<250?"none":"background",progress:a})}},e.prototype.run=function(t,r){return pe(this,void 0,void 0,function(){var n,a,i;return he(this,function(o){switch(o.label){case 0:n=this.id++,r?.createNewContext||this.currentContext.length===0?a={ctx:sye(t,this.track(n,t.id),100),refCount:1}:(a=this.currentContext[this.currentContext.length-1],a.refCount++),o.label=1;case 1:return o.trys.push([1,,3,4]),this.options.set(t.id,{useOverlay:!!r?.useOverlay}),this.runningTasks.add(t.id),[4,yq(a.ctx,t)];case 2:return i=o.sent(),[2,i];case 3:return this.options.delete(t.id),this.runningTasks.delete(t.id),this.events.finished.next({id:n}),this.abortRequests.delete(t.id),a.refCount--,a.refCount===0&&A1(this.currentContext,a),[7];case 4:return[2]}})})},e.prototype.requestAbortAll=function(t){var r=this;this.runningTasks.forEach(function(n){return r.abortRequests.set(n,t)})},e.prototype.requestAbort=function(t,r){var n=typeof t=="number"?t:t.root.progress.taskId;this.abortRequests.set(n,r)},e.prototype.dispose=function(){this.ev.dispose()},e}();(function(e){function t(n){return new Promise(function(a){return setTimeout(a,n)})}function r(n){var a=this;return Qe.create("Test",function(i){return pe(a,void 0,void 0,function(){var o;return he(this,function(s){switch(s.label){case 0:o=0,s.label=1;case 1:return o<n?[4,t(100+Math.random()*200)]:[3,5];case 2:return s.sent(),i.shouldUpdate?[4,i.update({message:"Step "+o,current:o,max:n,isIndeterminate:!1})]:[3,4];case 3:s.sent(),s.label=4;case 4:return o++,[3,1];case 5:return[2]}})})})}e.testTask=r})(YI||(YI={}));var lZe=function(e){Le(t,e);function t(r){var n=e.call(this,{entries:ma.exports.OrderedMap()})||this;return n.events={changed:n.ev()},n.serialNumber=0,n.serialId=0,Rt.Toast.Show.subscribe(r,function(a){return n.show(a)}),Rt.Toast.Hide.subscribe(r,function(a){return n.hide(n.findByKey(a.key))}),n}return t.prototype.findByKey=function(r){return this.state.entries.find(function(n){return!!n&&n.key===r})},t.prototype.show=function(r){var n=this,a=this.state.entries,i=void 0,o=++this.serialId,s;r.key&&(i=this.findByKey(r.key))?(i.timeout!==void 0&&clearTimeout(i.timeout),s=i.serialNumber,a=a.remove(i.id)):s=++this.serialNumber,i={id:o,serialNumber:s,key:r.key,title:r.title,message:r.message,timeout:this.timeout(o,r.timeoutMs),hide:function(){return n.hideId(o)}},this.updateState({entries:a.set(o,i)})&&this.events.changed.next()},t.prototype.timeout=function(r,n){var a=this;if(n!==void 0)return n<0&&(n=500),setTimeout(function(){var i=a.state.entries.get(r);i.timeout=void 0,a.hide(i)},n)},t.prototype.hideId=function(r){this.hide(this.state.entries.get(r))},t.prototype.hide=function(r){!r||(r.timeout!==void 0&&clearTimeout(r.timeout),r.hide=void 0,this.updateState({entries:this.state.entries.delete(r.id)})&&this.events.changed.next())},t}(Gd),cZe=function(e){Le(t,e);function t(r){var n=e.call(this)||this;return n.plugin=r,n._params=void 0,n.behaviors={values:n.ev.behavior({transparent:n.params.transparent.defaultValue,axes:{name:"off",params:{}},resolution:n.params.resolution.defaultValue}),cropParams:n.ev.behavior({auto:!0,relativePadding:.1}),relativeCrop:n.ev.behavior({x:0,y:0,width:1,height:1})},n.events={previewed:n.ev()},n.canvas=function(){var a=document.createElement("canvas");return a}(),n.previewCanvas=function(){var a=document.createElement("canvas");return a}(),n.previewData={image:{data:new Uint8ClampedArray(1),width:1,height:0},background:vt(0),transparent:!1},n}return t.prototype.createParams=function(){var r=Math.min(this.plugin.canvas3d?this.plugin.canvas3d.webgl.maxRenderbufferSize:4096,4096);return{resolution:M.MappedStatic("viewport",{viewport:M.Group({}),hd:M.Group({}),"full-hd":M.Group({}),"ultra-hd":M.Group({}),custom:M.Group({width:M.Numeric(1920,{min:128,max:r,step:1}),height:M.Numeric(1080,{min:128,max:r,step:1})},{isFlat:!0})},{options:[["viewport","Viewport"],["hd","HD (1280 x 720)"],["full-hd","Full HD (1920 x 1080)"],["ultra-hd","Ultra HD (3840 x 2160)"],["custom","Custom"]]}),transparent:M.Boolean(!1),axes:Cb.axes}},Object.defineProperty(t.prototype,"params",{get:function(){return this._params?this._params:this._params=this.createParams()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"values",{get:function(){return this.behaviors.values.value},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cropParams",{get:function(){return this.behaviors.cropParams.value},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"relativeCrop",{get:function(){return this.behaviors.relativeCrop.value},enumerable:!1,configurable:!0}),t.prototype.getCanvasSize=function(){var r,n;return{width:((r=this.plugin.canvas3d)===null||r===void 0?void 0:r.webgl.gl.drawingBufferWidth)||0,height:((n=this.plugin.canvas3d)===null||n===void 0?void 0:n.webgl.gl.drawingBufferHeight)||0}},t.prototype.getSize=function(){var r=this.values;switch(r.resolution.name){case"viewport":return this.getCanvasSize();case"hd":return{width:1280,height:720};case"full-hd":return{width:1920,height:1080};case"ultra-hd":return{width:3840,height:2160};default:return{width:r.resolution.params.width,height:r.resolution.params.height}}},t.prototype.createPass=function(r){var n=this.plugin.canvas3d,a=n.webgl.extensions,i=a.colorBufferFloat,o=a.textureFloat,s=this.plugin.canvas3d.props.postprocessing.occlusion;return this.plugin.canvas3d.getImagePass({transparentBackground:this.values.transparent,cameraHelper:{axes:this.values.axes},multiSample:{mode:r?"on":"off",sampleLevel:i&&o?4:2},postprocessing:T(T({},n.props.postprocessing),{occlusion:s.name==="on"?{name:"on",params:T(T({},s.params),{samples:128})}:s})})},Object.defineProperty(t.prototype,"previewPass",{get:function(){return this._previewPass||(this._previewPass=this.createPass(!1))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"imagePass",{get:function(){if(this._imagePass){var r=this.plugin.canvas3d.props.postprocessing.occlusion;return this._imagePass.setProps({cameraHelper:{axes:this.values.axes},transparentBackground:this.values.transparent,postprocessing:T(T({},this.plugin.canvas3d.props.postprocessing),{occlusion:r.name==="on"?{name:"on",params:T(T({},r.params),{samples:128})}:r})}),this._imagePass}return this._imagePass=this.createPass(!0)},enumerable:!1,configurable:!0}),t.prototype.getFilename=function(r){r===void 0&&(r=".png");var n=this.plugin.state.data.select(lr.Generators.rootsOfType(be.Molecule.Model)).map(function(o){return o.obj.data}),a=new Set;n.forEach(function(o){return a.add(o.entryId.toUpperCase())});var i=Aa.toArray(a).join("-");return""+(i||"molstar-image")+r},t.prototype.resetCrop=function(){this.behaviors.relativeCrop.next({x:0,y:0,width:1,height:1})},t.prototype.toggleAutocrop=function(){this.cropParams.auto?(this.behaviors.cropParams.next(T(T({},this.cropParams),{auto:!1})),this.resetCrop()):this.behaviors.cropParams.next(T(T({},this.cropParams),{auto:!0}))},Object.defineProperty(t.prototype,"isFullFrame",{get:function(){var r=this.relativeCrop;return Hn(r.x,0,1e-5)&&Hn(r.y,0,1e-5)&&Hn(r.width,1,1e-5)&&Hn(r.height,1,1e-5)},enumerable:!1,configurable:!0}),t.prototype.autocrop=function(r){r===void 0&&(r=this.cropParams.relativePadding);for(var n=this.previewData.image,a=n.data,i=n.width,o=n.height,s=this.previewData.transparent,u=s?this.previewData.background:4278190080|this.previewData.background,l=i,c=0,d=o,f=0,p=0;p<o;p++)for(var h=p*i,m=0;m<i;m++){var v=4*(h+m);if(s){if(a[v+3]===0)continue}else{var g=a[v]<<16|a[v+1]<<8|a[v+2]|a[v+3]<<24;if(g===u)continue}m<l&&(l=m),m>c&&(c=m),p<d&&(d=p),p>f&&(f=p)}if(l>c){var y=l;l=c,c=y}if(d>f){var y=d;d=f,f=y}var b=c-l+1,S=f-d+1;l-=r*b,c+=r*b,d-=r*S,f+=r*S;var x={x:Math.max(0,l/i),y:Math.max(0,d/o),width:Math.min(1,(c-l+1)/i),height:Math.min(1,(f-d+1)/o)};this.behaviors.relativeCrop.next(x)},t.prototype.getPreview=function(r){r===void 0&&(r=320);var n=this.getSize(),a=n.width,i=n.height;if(!(a<=0||i<=0)){var o=a/i,s=0,u=0;o>1?(s=r,u=Math.round(r/o)):(u=r,s=Math.round(r*o));var l=this.plugin.canvas3d.props;this.previewPass.setProps({cameraHelper:{axes:this.values.axes},transparentBackground:this.values.transparent,postprocessing:l.postprocessing});var c=this.previewPass.getImageData(s,u),d=this.previewCanvas;d.width=c.width,d.height=c.height,this.previewData.image=c,this.previewData.background=l.renderer.backgroundColor,this.previewData.transparent=this.values.transparent;var f=d.getContext("2d");if(!f)throw new Error("Could not create canvas 2d context");return f.putImageData(c,0,0),this.cropParams.auto&&this.autocrop(),this.events.previewed.next(),{canvas:d,width:s,height:u}}},t.prototype.getSizeAndViewport=function(){var r=this.getSize(),n=r.width,a=r.height,i=this.relativeCrop,o={x:Math.floor(i.x*n),y:Math.floor(i.y*a),width:Math.ceil(i.width*n),height:Math.ceil(i.height*a)};return o.width+o.x>n&&(o.width=n-o.x),o.height+o.y>a&&(o.height=a-o.y),{width:n,height:a,viewport:o}},t.prototype.draw=function(r){return pe(this,void 0,void 0,function(){var n,a,i,o,s,u,l;return he(this,function(c){switch(c.label){case 0:return n=this.getSizeAndViewport(),a=n.width,i=n.height,o=n.viewport,a<=0||i<=0?[2]:[4,r.update("Rendering image...")];case 1:return c.sent(),s=this.imagePass.getImageData(a,i,o),[4,r.update("Encoding image...")];case 2:if(c.sent(),u=this.canvas,u.width=s.width,u.height=s.height,l=u.getContext("2d"),!l)throw new Error("Could not create canvas 2d context");return l.putImageData(s,0,0),[2]}})})},t.prototype.copyToClipboardTask=function(){var r=this,n=navigator.clipboard;if(!n?.write){this.plugin.log.error("clipboard.write not supported!");return}return Qe.create("Copy Image",function(a){return pe(r,void 0,void 0,function(){var i,o;return he(this,function(s){switch(s.label){case 0:return[4,this.draw(a)];case 1:return s.sent(),[4,a.update("Converting image...")];case 2:return s.sent(),[4,Sz(this.canvas,"png")];case 3:return i=s.sent(),o=new ClipboardItem({"image/png":i}),[4,n.write([o])];case 4:return s.sent(),this.plugin.log.message("Image copied to clipboard."),[2]}})})})},t.prototype.getImageDataUri=function(){var r=this;return this.plugin.runTask(Qe.create("Generate Image",function(n){return pe(r,void 0,void 0,function(){return he(this,function(a){switch(a.label){case 0:return[4,this.draw(n)];case 1:return a.sent(),[4,n.update("Converting image...")];case 2:return a.sent(),[2,this.canvas.toDataURL("png")]}})})}))},t.prototype.copyToClipboard=function(){var r=this.copyToClipboardTask();if(!!r)return this.plugin.runTask(r)},t.prototype.downloadTask=function(r){var n=this;return Qe.create("Download Image",function(a){return pe(n,void 0,void 0,function(){var i;return he(this,function(o){switch(o.label){case 0:return[4,this.draw(a)];case 1:return o.sent(),[4,a.update("Downloading image...")];case 2:return o.sent(),[4,Sz(this.canvas,"png")];case 3:return i=o.sent(),WK(i,r??this.getFilename()),[2]}})})})},t.prototype.download=function(r){this.plugin.runTask(this.downloadTask(r))},t}(Sb),eee=function(){function e(t){var r=this;this.spec=t,this.runTask=function(n,a){return r.managers.task.run(n,a)},this.resolveTask=function(n){if(!!n)return Qe.is(n)?r.runTask(n):n},this.subs=[],this.disposed=!1,this.ev=pd.create(),this.config=new iFe(this.spec.config),this.state=new T3(this),this.commands=new $Be,this.canvas3dInit=this.ev.behavior(!1),this.behaviors={state:{isAnimating:this.ev.behavior(!1),isUpdating:this.ev.behavior(!1),isBusy:this.ev.behavior(!1)},interaction:{hover:this.ev.behavior({current:mr.Loci.Empty,modifiers:$u.None,buttons:0,button:0}),click:this.ev.behavior({current:mr.Loci.Empty,modifiers:$u.None,buttons:0,button:0}),drag:this.ev.behavior({current:mr.Loci.Empty,modifiers:$u.None,buttons:0,button:0,pageStart:Xe(),pageEnd:Xe()}),selectionMode:this.ev.behavior(!1)},labels:{highlight:this.ev.behavior({labels:[]})},layout:{leftPanelTabName:this.ev.behavior("root")},canvas3d:{initialized:this.canvas3dInit.pipe(Gw(function(n){return!!n}),AWe(1))}},this.layout=new JXe(this),this.animationLoop=new sZe(this),this.representation={structure:{registry:new XI,themes:{colorThemeRegistry:xd.createRegistry(),sizeThemeRegistry:oi.createRegistry()}},volume:{registry:new x3,themes:{colorThemeRegistry:xd.createRegistry(),sizeThemeRegistry:oi.createRegistry()}}},this.query={structure:{registry:new Fke}},this.dataFormats=new zXe,this.builders={data:new mXe(this),structure:void 0},this.helpers={substructureParent:new uZe(this),viewportScreenshot:void 0},this.managers={structure:{hierarchy:new W1(this),component:new gm(this),measurement:new eqe(this),selection:new XXe(this),focus:new qXe(this)},volume:{hierarchy:new _3(this)},interactivity:void 0,camera:new HXe(this),animation:new UXe(this),snapshot:new t3(this),lociLabels:void 0,toast:new lZe(this),asset:new Yye,task:new YI},this.events={log:this.ev(),task:this.managers.task.events,canvas3d:{settingsUpdated:this.ev()}},this.customModelProperties=new E3.Registry,this.customStructureProperties=new E3.Registry,this.customStructureControls=new Map,this.genericRepresentationControls=new Map,this.customState=Object.create(null),this.log={entries:ma.exports.List(),entry:function(n){return r.events.log.next(n)},error:function(n){return r.events.log.next(jl.error(n))},message:function(n){return r.events.log.next(jl.message(n))},info:function(n){return r.events.log.next(jl.info(n))},warn:function(n){return r.events.log.next(jl.warning(n))}},this.fetch=VP,rbe(!1)}return e.prototype.build=function(){return this.state.data.build()},e.prototype.initViewer=function(t,r,n){var a=this,i,o,s,u,l;try{if(this.layout.setRoot(r),this.spec.layout&&this.spec.layout.initial&&this.layout.setProps(this.spec.layout.initial),n)this.canvas3dContext=n;else{var c=!((i=this.config.get(Qn.General.DisableAntialiasing))!==null&&i!==void 0&&i),d=!((o=this.config.get(Qn.General.DisablePreserveDrawingBuffer))!==null&&o!==void 0&&o),f=this.config.get(Qn.General.PixelScale)||1,p=this.config.get(Qn.General.PickScale)||.25,h=this.config.get(Qn.General.EnableWboit)||!1;this.canvas3dContext=cI.fromCanvas(t,{antialias:c,preserveDrawingBuffer:d,pixelScale:f,pickScale:p,enableWboit:h})}this.canvas3d=dI.create(this.canvas3dContext),this.canvas3dInit.next(!0);var m=this.spec.canvas3d,v=vt(16579577);return m?(((u=m.renderer)===null||u===void 0?void 0:u.backgroundColor)===void 0&&(m=hd(m,function(g){g.renderer?g.renderer.backgroundColor=v:g.renderer={backgroundColor:v}})),(l=this.canvas3d)===null||l===void 0||l.setProps(m)):(s=this.canvas3d)===null||s===void 0||s.setProps({renderer:{backgroundColor:v}}),this.animationLoop.start(),this.helpers.viewportScreenshot=new cZe(this),this.subs.push(this.canvas3d.interaction.click.subscribe(function(g){return a.behaviors.interaction.click.next(g)})),this.subs.push(this.canvas3d.interaction.drag.subscribe(function(g){return a.behaviors.interaction.drag.next(g)})),this.subs.push(this.canvas3d.interaction.hover.subscribe(function(g){return a.behaviors.interaction.hover.next(g)})),this.subs.push(this.canvas3d.input.resize.subscribe(function(){return a.handleResize()})),this.subs.push(this.layout.events.updated.subscribe(function(){return requestAnimationFrame(function(){return a.handleResize()})})),this.handleResize(),!0}catch(g){return this.log.error(""+g),console.error(g),!1}},e.prototype.handleResize=function(){var t,r,n=(t=this.canvas3dContext)===null||t===void 0?void 0:t.canvas,a=this.layout.root;if(a&&n){var i=this.config.get(Qn.General.PixelScale)||1;pXe(n,a,i),(r=this.canvas3d)===null||r===void 0||r.requestResize()}},Object.defineProperty(e.prototype,"isBusy",{get:function(){return this.behaviors.state.isAnimating.value||this.behaviors.state.isUpdating.value},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"selectionMode",{get:function(){return this.behaviors.interaction.selectionMode.value},set:function(t){this.behaviors.interaction.selectionMode.next(t)},enumerable:!1,configurable:!0}),e.prototype.dataTransaction=function(t,r){return this.runTask(this.state.data.transaction(t,r))},e.prototype.clear=function(t){var r;return t===void 0&&(t=!1),t&&((r=this.canvas3d)===null||r===void 0||r.setProps(Kk)),Rt.State.RemoveObject(this,{state:this.state.data,ref:vr.RootRef})},e.prototype.dispose=function(t){var r,n;if(!this.disposed){for(var a=0,i=this.subs;a<i.length;a++){var o=i[a];o.unsubscribe()}this.subs=[],this.commands.dispose(),(r=this.canvas3d)===null||r===void 0||r.dispose(),(n=this.canvas3dContext)===null||n===void 0||n.dispose(t),this.ev.dispose(),this.state.dispose(),this.managers.task.dispose(),this.helpers.substructureParent.dispose(),rl(this.managers,function(s){var u,l;return(l=(u=s)===null||u===void 0?void 0:u.dispose)===null||l===void 0?void 0:l.call(u)}),rl(this.managers.structure,function(s){var u,l;return(l=(u=s)===null||u===void 0?void 0:u.dispose)===null||l===void 0?void 0:l.call(u)}),this.disposed=!0}},e.prototype.initBehaviorEvents=function(){var t=this;this.subs.push(Vc(this.state.data.behaviors.isUpdating,this.state.behaviors.behaviors.isUpdating).subscribe(function(s){t.behaviors.state.isUpdating.value!==s&&t.behaviors.state.isUpdating.next(s)}));var r=this.config.get(Qn.General.IsBusyTimeoutMs)||750,n=this.behaviors.state.isBusy,a=void 0,i=function(){n.value||n.next(!0)},o=function(){a!==void 0&&clearTimeout(a),a=void 0};this.subs.push(Vc(this.behaviors.state.isUpdating,this.behaviors.state.isAnimating).subscribe(function(s){var u=t.behaviors.state.isUpdating.value,l=t.behaviors.state.isAnimating.value;u||l?n.value||(o(),a=setTimeout(i,r)):(o(),n.next(!1))})),this.subs.push(this.behaviors.interaction.selectionMode.subscribe(function(s){var u;s||(u=t.managers.interactivity)===null||u===void 0||u.lociSelects.deselectAll()}))},e.prototype.initBuiltInBehavior=function(){var t=this;dx.State.registerDefault(this),dx.Representation.registerDefault(this),dx.Camera.registerDefault(this),dx.Misc.registerDefault(this),this.subs.push(Vc(this.state.data.events.log,this.state.behaviors.events.log).subscribe(function(r){return t.events.log.next(r)}))},e.prototype.initBehaviors=function(){return pe(this,void 0,void 0,function(){var t,r,n,l,a,i,u,l,o,s,u,l;return he(this,function(c){switch(c.label){case 0:for(t=this.state.behaviors.build(),r=0,n=Object.keys(Ur.Categories);r<n.length;r++)l=n[r],t.toRoot().apply(Ur.CreateCategory,{label:Ur.Categories[l]},{ref:l,state:{isLocked:!0}});for(a=0,i=this.spec.behaviors;a<i.length;a++)u=i[a],l=Ur.getCategoryId(u.transformer),l==="custom-props"&&t.to(Ur.getCategoryId(u.transformer)).apply(u.transformer,u.defaultParams,{ref:u.transformer.id});return[4,this.runTask(this.state.behaviors.updateTree(t,{doNotUpdateCurrent:!0,doNotLogTiming:!0}))];case 1:for(c.sent(),t=this.state.behaviors.build(),o=0,s=this.spec.behaviors;o<s.length;o++)u=s[o],l=Ur.getCategoryId(u.transformer),l!=="custom-props"&&t.to(Ur.getCategoryId(u.transformer)).apply(u.transformer,u.defaultParams,{ref:u.transformer.id});return[4,this.runTask(this.state.behaviors.updateTree(t,{doNotUpdateCurrent:!0,doNotLogTiming:!0}))];case 2:return c.sent(),[2]}})})},e.prototype.initCustomFormats=function(){if(!!this.spec.customFormats)for(var t=0,r=this.spec.customFormats;t<r.length;t++){var n=r[t];this.dataFormats.add(n[0],n[1])}},e.prototype.initAnimations=function(){if(!!this.spec.animations)for(var t=0,r=this.spec.animations;t<r.length;t++){var n=r[t];this.managers.animation.register(n)}},e.prototype.initDataActions=function(){if(!!this.spec.actions)for(var t=0,r=this.spec.actions;t<r.length;t++){var n=r[t];this.state.data.actions.add(n.action)}},e.prototype.init=function(){return pe(this,void 0,void 0,function(){var t=this;return he(this,function(r){switch(r.label){case 0:return this.subs.push(this.events.log.subscribe(function(n){return t.log.entries=t.log.entries.push(n)})),this.initCustomFormats(),this.initBehaviorEvents(),this.initBuiltInBehavior(),this.managers.interactivity=new C3(this),this.managers.lociLabels=new jXe(this),this.builders.structure=new AXe(this),this.initAnimations(),this.initDataActions(),[4,this.initBehaviors()];case 1:return r.sent(),this.log.message("Mol* Plugin "+tI+" ["+tFe.toLocaleString()+"]"),R0||this.log.message("Development mode enabled"),Fr&&this.log.message("Debug mode enabled"),[2]}})})},e}(),dZe=function(e){Le(t,e);function t(r){var n=e.call(this,r)||this;return n.spec=r,n.customParamEditors=new Map,n.initCustomParamEditors(),n}return t.prototype.initCustomParamEditors=function(){if(!!this.spec.customParamEditors)for(var r=0,n=this.spec.customParamEditors;r<n.length;r++){var a=n[r],i=a[0],o=a[1];this.customParamEditors.set(i.id,o)}},t.prototype.dispose=function(r){e.prototype.dispose.call(this,r),this.layout.dispose()},t}(eee);function fZe(e,t){return pe(this,void 0,void 0,function(){var r,n;return he(this,function(a){switch(a.label){case 0:return r=new dZe(t||GQ()),n=r.init(),K1.exports.render(B(sXe,{plugin:r}),e),[4,n];case 1:return a.sent(),[2,r]}})})}function pZe(e,t){t===void 0&&(t={});var r=t.insertAt;if(!(!e||typeof document>"u")){var n=document.head||document.getElementsByTagName("head")[0],a=document.createElement("style");a.type="text/css",r==="top"&&n.firstChild?n.insertBefore(a,n.firstChild):n.appendChild(a),a.styleSheet?a.styleSheet.cssText=e:a.appendChild(document.createTextNode(e))}}var hZe=`.msp-plugin{font-family:"Helvetica Neue", "Segoe UI", Helvetica, "Source Sans Pro", Arial, sans-serif;font-size:14px;line-height:1.42857143;position:absolute;left:0;top:0;right:0;bottom:0;/*! normalize.css v3.0.3 | MIT License | github.com/necolas/normalize.css */background:#eeece7}.msp-plugin *{box-sizing:border-box}.msp-plugin [hidden],.msp-plugin template{display:none}.msp-plugin a{background-color:transparent}.msp-plugin a:active,.msp-plugin a:hover{outline:0}.msp-plugin abbr[title]{border-bottom:1px dotted}.msp-plugin b,.msp-plugin strong{font-weight:bold}.msp-plugin small{font-size:80%}.msp-plugin img{border:0}.msp-plugin svg:not(:root){overflow:hidden}.msp-plugin button,.msp-plugin input,.msp-plugin optgroup,.msp-plugin select,.msp-plugin textarea{color:inherit;font:inherit;margin:0}.msp-plugin button{overflow:visible}.msp-plugin button,.msp-plugin select{text-transform:none}.msp-plugin button,.msp-plugin html input[type="button"],.msp-plugin input[type="reset"],.msp-plugin input[type="submit"]{-webkit-appearance:button;cursor:pointer}.msp-plugin button[disabled],.msp-plugin html input[disabled]{cursor:default}.msp-plugin button::-moz-focus-inner,.msp-plugin input::-moz-focus-inner{border:0;padding:0}.msp-plugin input{line-height:normal}.msp-plugin input[type="checkbox"],.msp-plugin input[type="radio"]{box-sizing:border-box;padding:0}.msp-plugin input[type="number"]::-webkit-inner-spin-button,.msp-plugin input[type="number"]::-webkit-outer-spin-button{height:auto}.msp-plugin textarea{overflow:auto}.msp-plugin .msp-layout-expanded,.msp-plugin .msp-layout-standard{left:0;right:0;top:0;bottom:0}.msp-plugin .msp-layout-standard{border:1px solid #cec9ba}.msp-plugin .msp-layout-region{overflow:hidden}.msp-plugin .msp-layout-static,.msp-plugin .msp-layout-scrollable{position:absolute}.msp-plugin .msp-scrollable{overflow-y:auto}.msp-plugin .msp-scrollable-container{position:absolute;left:0;right:0;top:0;bottom:0;overflow-y:auto}.msp-plugin .msp-layout-static{overflow:hidden}.msp-plugin .msp-layout-top .msp-layout-static,.msp-plugin .msp-layout-main .msp-layout-static,.msp-plugin .msp-layout-bottom .msp-layout-static{left:0;right:0;top:0;bottom:0}.msp-plugin .msp-layout-right .msp-layout-static{left:0;right:0;top:0;bottom:0}.msp-plugin .msp-layout-right .msp-layout-scrollable{left:0;right:0;top:43px;bottom:0}.msp-plugin .msp-layout-left .msp-layout-static{left:0;right:0;bottom:0;top:0}.msp-plugin .msp-layout-standard-outside{position:absolute}.msp-plugin .msp-layout-standard-outside .msp-layout-main{position:absolute;left:0;right:0;bottom:0;top:0}.msp-plugin .msp-layout-standard-outside .msp-layout-top{position:absolute;right:0;height:97px;top:-97px;width:50%;border-left:1px solid #cec9ba;border-bottom:1px solid #cec9ba}.msp-plugin .msp-layout-standard-outside .msp-layout-bottom{position:absolute;left:0;right:0;height:97px;top:-97px;width:50%;border-bottom:1px solid #cec9ba}.msp-plugin .msp-layout-standard-outside .msp-layout-right{position:absolute;width:50%;right:0;bottom:-295px;height:295px;border-left:1px solid #cec9ba;border-top:1px solid #cec9ba}.msp-plugin .msp-layout-standard-outside .msp-layout-left{position:absolute;width:50%;left:0;bottom:0;bottom:-295px;height:295px;border-top:1px solid #cec9ba}.msp-plugin .msp-layout-standard-outside .msp-layout-hide-right .msp-layout-right{display:none}.msp-plugin .msp-layout-standard-outside .msp-layout-hide-right .msp-layout-left{width:100%}.msp-plugin .msp-layout-standard-outside .msp-layout-hide-left .msp-layout-left{display:none}.msp-plugin .msp-layout-standard-outside .msp-layout-hide-left .msp-layout-right{width:100%;border-left:none}.msp-plugin .msp-layout-standard-outside .msp-layout-collapse-left .msp-layout-left{width:32px}.msp-plugin .msp-layout-standard-outside .msp-layout-collapse-left .msp-layout-right{left:32px;width:auto}.msp-plugin .msp-layout-standard-outside .msp-layout-hide-top .msp-layout-top{display:none}.msp-plugin .msp-layout-standard-outside .msp-layout-hide-top .msp-layout-bottom{width:100%;border-left:none}.msp-plugin .msp-layout-standard-outside .msp-layout-hide-bottom .msp-layout-bottom{display:none}.msp-plugin .msp-layout-standard-outside .msp-layout-hide-bottom .msp-layout-top{width:100%;border-left:none}.msp-plugin .msp-layout-standard-landscape{position:absolute}.msp-plugin .msp-layout-standard-landscape .msp-layout-main{position:absolute;left:330px;right:300px;bottom:70px;top:100px}.msp-plugin .msp-layout-standard-landscape .msp-layout-top{position:absolute;left:330px;right:300px;height:100px;top:0;border-bottom:1px solid #cec9ba}.msp-plugin .msp-layout-standard-landscape .msp-layout-bottom{position:absolute;left:330px;right:300px;height:70px;bottom:0;border-top:1px solid #cec9ba}.msp-plugin .msp-layout-standard-landscape .msp-layout-right{position:absolute;width:300px;right:0;bottom:0;top:0;border-left:1px solid #cec9ba}.msp-plugin .msp-layout-standard-landscape .msp-layout-left{position:absolute;width:330px;left:0;bottom:0;top:0;border-right:1px solid #cec9ba}.msp-plugin .msp-layout-standard-landscape .msp-layout-hide-right .msp-layout-right{display:none}.msp-plugin .msp-layout-standard-landscape .msp-layout-hide-right .msp-layout-main,.msp-plugin .msp-layout-standard-landscape .msp-layout-hide-right .msp-layout-top,.msp-plugin .msp-layout-standard-landscape .msp-layout-hide-right .msp-layout-bottom{right:0}.msp-plugin .msp-layout-standard-landscape .msp-layout-hide-left .msp-layout-left{display:none}.msp-plugin .msp-layout-standard-landscape .msp-layout-hide-left .msp-layout-main,.msp-plugin .msp-layout-standard-landscape .msp-layout-hide-left .msp-layout-top,.msp-plugin .msp-layout-standard-landscape .msp-layout-hide-left .msp-layout-bottom{left:0}.msp-plugin .msp-layout-standard-landscape .msp-layout-collapse-left .msp-layout-left{width:32px}.msp-plugin .msp-layout-standard-landscape .msp-layout-collapse-left .msp-layout-main,.msp-plugin .msp-layout-standard-landscape .msp-layout-collapse-left .msp-layout-top,.msp-plugin .msp-layout-standard-landscape .msp-layout-collapse-left .msp-layout-bottom{left:32px}.msp-plugin .msp-layout-standard-landscape .msp-layout-hide-bottom .msp-layout-bottom{display:none}.msp-plugin .msp-layout-standard-landscape .msp-layout-hide-bottom .msp-layout-main{bottom:0}.msp-plugin .msp-layout-standard-landscape .msp-layout-hide-top .msp-layout-top{display:none}.msp-plugin .msp-layout-standard-landscape .msp-layout-hide-top .msp-layout-main{top:0}.msp-plugin .msp-layout-standard-portrait{position:absolute}.msp-plugin .msp-layout-standard-portrait .msp-layout-main{position:absolute;left:0;right:0;bottom:361px;top:97px}.msp-plugin .msp-layout-standard-portrait .msp-layout-top{position:absolute;right:0;height:97px;top:0;width:50%;border-left:1px solid #cec9ba;border-bottom:1px solid #cec9ba}.msp-plugin .msp-layout-standard-portrait .msp-layout-bottom{position:absolute;left:0;right:0;height:97px;width:50%;border-bottom:1px solid #cec9ba}.msp-plugin .msp-layout-standard-portrait .msp-layout-right{position:absolute;width:50%;right:0;bottom:0;height:361px;border-left:1px solid #cec9ba;border-top:1px solid #cec9ba}.msp-plugin .msp-layout-standard-portrait .msp-layout-left{position:absolute;width:50%;left:0;bottom:0;height:361px;border-top:1px solid #cec9ba}.msp-plugin .msp-layout-standard-portrait .msp-layout-hide-right .msp-layout-right{display:none}.msp-plugin .msp-layout-standard-portrait .msp-layout-hide-right .msp-layout-left{width:100%}.msp-plugin .msp-layout-standard-portrait .msp-layout-hide-left .msp-layout-left{display:none}.msp-plugin .msp-layout-standard-portrait .msp-layout-hide-left .msp-layout-right{width:100%;border-left:none}.msp-plugin .msp-layout-standard-portrait .msp-layout-hide-right.msp-layout-hide-left .msp-layout-main{bottom:0}.msp-plugin .msp-layout-standard-portrait .msp-layout-collapse-left .msp-layout-left{width:32px}.msp-plugin .msp-layout-standard-portrait .msp-layout-collapse-left .msp-layout-right{left:32px;width:auto}.msp-plugin .msp-layout-standard-portrait .msp-layout-hide-top .msp-layout-top{display:none}.msp-plugin .msp-layout-standard-portrait .msp-layout-hide-top .msp-layout-bottom{width:100%;border-left:none}.msp-plugin .msp-layout-standard-portrait .msp-layout-hide-bottom .msp-layout-bottom{display:none}.msp-plugin .msp-layout-standard-portrait .msp-layout-hide-bottom .msp-layout-top{width:100%;border-left:none}.msp-plugin .msp-layout-standard-portrait .msp-layout-hide-top.msp-layout-hide-bottom .msp-layout-main{top:0}.msp-plugin .msp-layout-standard-reactive{position:absolute}@media (orientation: landscape), (min-width: 1000px){.msp-plugin .msp-layout-standard-reactive .msp-layout-main{position:absolute;left:330px;right:300px;bottom:70px;top:100px}.msp-plugin .msp-layout-standard-reactive .msp-layout-top{position:absolute;left:330px;right:300px;height:100px;top:0;border-bottom:1px solid #cec9ba}.msp-plugin .msp-layout-standard-reactive .msp-layout-bottom{position:absolute;left:330px;right:300px;height:70px;bottom:0;border-top:1px solid #cec9ba}.msp-plugin .msp-layout-standard-reactive .msp-layout-right{position:absolute;width:300px;right:0;bottom:0;top:0;border-left:1px solid #cec9ba}.msp-plugin .msp-layout-standard-reactive .msp-layout-left{position:absolute;width:330px;left:0;bottom:0;top:0;border-right:1px solid #cec9ba}.msp-plugin .msp-layout-standard-reactive .msp-layout-hide-right .msp-layout-right{display:none}.msp-plugin .msp-layout-standard-reactive .msp-layout-hide-right .msp-layout-main,.msp-plugin .msp-layout-standard-reactive .msp-layout-hide-right .msp-layout-top,.msp-plugin .msp-layout-standard-reactive .msp-layout-hide-right .msp-layout-bottom{right:0}.msp-plugin .msp-layout-standard-reactive .msp-layout-hide-left .msp-layout-left{display:none}.msp-plugin .msp-layout-standard-reactive .msp-layout-hide-left .msp-layout-main,.msp-plugin .msp-layout-standard-reactive .msp-layout-hide-left .msp-layout-top,.msp-plugin .msp-layout-standard-reactive .msp-layout-hide-left .msp-layout-bottom{left:0}.msp-plugin .msp-layout-standard-reactive .msp-layout-collapse-left .msp-layout-left{width:32px}.msp-plugin .msp-layout-standard-reactive .msp-layout-collapse-left .msp-layout-main,.msp-plugin .msp-layout-standard-reactive .msp-layout-collapse-left .msp-layout-top,.msp-plugin .msp-layout-standard-reactive .msp-layout-collapse-left .msp-layout-bottom{left:32px}.msp-plugin .msp-layout-standard-reactive .msp-layout-hide-bottom .msp-layout-bottom{display:none}.msp-plugin .msp-layout-standard-reactive .msp-layout-hide-bottom .msp-layout-main{bottom:0}.msp-plugin .msp-layout-standard-reactive .msp-layout-hide-top .msp-layout-top{display:none}.msp-plugin .msp-layout-standard-reactive .msp-layout-hide-top .msp-layout-main{top:0}}@media (orientation: portrait) and (max-width: 1000px){.msp-plugin .msp-layout-standard-reactive .msp-layout-main{position:absolute;left:0;right:0;bottom:361px;top:97px}.msp-plugin .msp-layout-standard-reactive .msp-layout-top{position:absolute;right:0;height:97px;top:0;width:50%;border-left:1px solid #cec9ba;border-bottom:1px solid #cec9ba}.msp-plugin .msp-layout-standard-reactive .msp-layout-bottom{position:absolute;left:0;right:0;height:97px;width:50%;border-bottom:1px solid #cec9ba}.msp-plugin .msp-layout-standard-reactive .msp-layout-right{position:absolute;width:50%;right:0;bottom:0;height:361px;border-left:1px solid #cec9ba;border-top:1px solid #cec9ba}.msp-plugin .msp-layout-standard-reactive .msp-layout-left{position:absolute;width:50%;left:0;bottom:0;height:361px;border-top:1px solid #cec9ba}.msp-plugin .msp-layout-standard-reactive .msp-layout-hide-right .msp-layout-right{display:none}.msp-plugin .msp-layout-standard-reactive .msp-layout-hide-right .msp-layout-left{width:100%}.msp-plugin .msp-layout-standard-reactive .msp-layout-hide-left .msp-layout-left{display:none}.msp-plugin .msp-layout-standard-reactive .msp-layout-hide-left .msp-layout-right{width:100%;border-left:none}.msp-plugin .msp-layout-standard-reactive .msp-layout-hide-right.msp-layout-hide-left .msp-layout-main{bottom:0}.msp-plugin .msp-layout-standard-reactive .msp-layout-collapse-left .msp-layout-left{width:32px}.msp-plugin .msp-layout-standard-reactive .msp-layout-collapse-left .msp-layout-right{left:32px;width:auto}.msp-plugin .msp-layout-standard-reactive .msp-layout-hide-top .msp-layout-top{display:none}.msp-plugin .msp-layout-standard-reactive .msp-layout-hide-top .msp-layout-bottom{width:100%;border-left:none}.msp-plugin .msp-layout-standard-reactive .msp-layout-hide-bottom .msp-layout-bottom{display:none}.msp-plugin .msp-layout-standard-reactive .msp-layout-hide-bottom .msp-layout-top{width:100%;border-left:none}.msp-plugin .msp-layout-standard-reactive .msp-layout-hide-top.msp-layout-hide-bottom .msp-layout-main{top:0}}.msp-plugin .msp-layout-expanded{position:fixed}@media (orientation: landscape){.msp-plugin .msp-layout-expanded .msp-layout-main{position:absolute;left:330px;right:300px;bottom:70px;top:100px}.msp-plugin .msp-layout-expanded .msp-layout-top{position:absolute;left:330px;right:300px;height:100px;top:0;border-bottom:1px solid #cec9ba}.msp-plugin .msp-layout-expanded .msp-layout-bottom{position:absolute;left:330px;right:300px;height:70px;bottom:0;border-top:1px solid #cec9ba}.msp-plugin .msp-layout-expanded .msp-layout-right{position:absolute;width:300px;right:0;bottom:0;top:0;border-left:1px solid #cec9ba}.msp-plugin .msp-layout-expanded .msp-layout-left{position:absolute;width:330px;left:0;bottom:0;top:0;border-right:1px solid #cec9ba}.msp-plugin .msp-layout-expanded .msp-layout-hide-right .msp-layout-right{display:none}.msp-plugin .msp-layout-expanded .msp-layout-hide-right .msp-layout-main,.msp-plugin .msp-layout-expanded .msp-layout-hide-right .msp-layout-top,.msp-plugin .msp-layout-expanded .msp-layout-hide-right .msp-layout-bottom{right:0}.msp-plugin .msp-layout-expanded .msp-layout-hide-left .msp-layout-left{display:none}.msp-plugin .msp-layout-expanded .msp-layout-hide-left .msp-layout-main,.msp-plugin .msp-layout-expanded .msp-layout-hide-left .msp-layout-top,.msp-plugin .msp-layout-expanded .msp-layout-hide-left .msp-layout-bottom{left:0}.msp-plugin .msp-layout-expanded .msp-layout-collapse-left .msp-layout-left{width:32px}.msp-plugin .msp-layout-expanded .msp-layout-collapse-left .msp-layout-main,.msp-plugin .msp-layout-expanded .msp-layout-collapse-left .msp-layout-top,.msp-plugin .msp-layout-expanded .msp-layout-collapse-left .msp-layout-bottom{left:32px}.msp-plugin .msp-layout-expanded .msp-layout-hide-bottom .msp-layout-bottom{display:none}.msp-plugin .msp-layout-expanded .msp-layout-hide-bottom .msp-layout-main{bottom:0}.msp-plugin .msp-layout-expanded .msp-layout-hide-top .msp-layout-top{display:none}.msp-plugin .msp-layout-expanded .msp-layout-hide-top .msp-layout-main{top:0}}@media (orientation: portrait){.msp-plugin .msp-layout-expanded .msp-layout-main{position:absolute;left:0;right:0;bottom:361px;top:97px}.msp-plugin .msp-layout-expanded .msp-layout-top{position:absolute;right:0;height:97px;top:0;width:50%;border-left:1px solid #cec9ba;border-bottom:1px solid #cec9ba}.msp-plugin .msp-layout-expanded .msp-layout-bottom{position:absolute;left:0;right:0;height:97px;width:50%;border-bottom:1px solid #cec9ba}.msp-plugin .msp-layout-expanded .msp-layout-right{position:absolute;width:50%;right:0;bottom:0;height:361px;border-left:1px solid #cec9ba;border-top:1px solid #cec9ba}.msp-plugin .msp-layout-expanded .msp-layout-left{position:absolute;width:50%;left:0;bottom:0;height:361px;border-top:1px solid #cec9ba}.msp-plugin .msp-layout-expanded .msp-layout-hide-right .msp-layout-right{display:none}.msp-plugin .msp-layout-expanded .msp-layout-hide-right .msp-layout-left{width:100%}.msp-plugin .msp-layout-expanded .msp-layout-hide-left .msp-layout-left{display:none}.msp-plugin .msp-layout-expanded .msp-layout-hide-left .msp-layout-right{width:100%;border-left:none}.msp-plugin .msp-layout-expanded .msp-layout-hide-right.msp-layout-hide-left .msp-layout-main{bottom:0}.msp-plugin .msp-layout-expanded .msp-layout-collapse-left .msp-layout-left{width:32px}.msp-plugin .msp-layout-expanded .msp-layout-collapse-left .msp-layout-right{left:32px;width:auto}.msp-plugin .msp-layout-expanded .msp-layout-hide-top .msp-layout-top{display:none}.msp-plugin .msp-layout-expanded .msp-layout-hide-top .msp-layout-bottom{width:100%;border-left:none}.msp-plugin .msp-layout-expanded .msp-layout-hide-bottom .msp-layout-bottom{display:none}.msp-plugin .msp-layout-expanded .msp-layout-hide-bottom .msp-layout-top{width:100%;border-left:none}.msp-plugin .msp-layout-expanded .msp-layout-hide-top.msp-layout-hide-bottom .msp-layout-main{top:0}}.msp-plugin ::-webkit-scrollbar{width:10px;height:10px}.msp-plugin ::-webkit-scrollbar-track{border-radius:0;background-color:#e9e6e0}.msp-plugin ::-webkit-scrollbar-thumb{border-radius:0;background-color:#f1f0eb}.msp-plugin .msp-form-control,.msp-plugin .msp-btn,.msp-plugin .msp-control-row button,.msp-plugin .msp-control-row select,.msp-plugin .msp-control-row input[type=text]{display:block;width:100%;background:#f3f2ee;border:none;padding:0 10px;line-height:30px;height:32px;-webkit-appearance:none;-moz-appearance:none;appearance:none;-webkit-box-shadow:none;box-shadow:none;background-image:none}.msp-plugin .msp-form-control::-moz-placeholder,.msp-plugin .msp-btn::-moz-placeholder,.msp-plugin .msp-control-row button::-moz-placeholder,.msp-plugin .msp-control-row select::-moz-placeholder,.msp-plugin .msp-control-row input[type=text]::-moz-placeholder{color:#9c835f;opacity:1}.msp-plugin .msp-form-control:-ms-input-placeholder,.msp-plugin .msp-btn:-ms-input-placeholder,.msp-plugin .msp-control-row button:-ms-input-placeholder,.msp-plugin .msp-control-row select:-ms-input-placeholder,.msp-plugin .msp-control-row input:-ms-input-placeholder[type=text]{color:#9c835f}.msp-plugin .msp-form-control::-webkit-input-placeholder,.msp-plugin .msp-btn::-webkit-input-placeholder,.msp-plugin .msp-control-row button::-webkit-input-placeholder,.msp-plugin .msp-control-row select::-webkit-input-placeholder,.msp-plugin .msp-control-row input[type=text]::-webkit-input-placeholder{color:#9c835f}.msp-plugin .msp-form-control:hover,.msp-plugin .msp-btn:hover,.msp-plugin .msp-control-row button:hover,.msp-plugin .msp-control-row select:hover,.msp-plugin .msp-control-row input:hover[type=text]{color:#ae5d04;background-color:#e9e6e0;border:none;outline-offset:-1px !important;outline:1px solid #c9c3b3 !important}.msp-plugin .msp-form-control:active,.msp-plugin .msp-btn:active,.msp-plugin .msp-control-row button:active,.msp-plugin .msp-control-row select:active,.msp-plugin .msp-control-row input:active[type=text],.msp-plugin .msp-form-control:focus,.msp-plugin .msp-btn:focus,.msp-plugin .msp-control-row button:focus,.msp-plugin .msp-control-row select:focus,.msp-plugin .msp-control-row input:focus[type=text]{color:#332b1f;background-color:#f3f2ee;border:none;outline-offset:0;outline:none}.msp-plugin .msp-form-control[disabled],.msp-plugin .msp-btn[disabled],.msp-plugin .msp-control-row button[disabled],.msp-plugin .msp-control-row select[disabled],.msp-plugin .msp-control-row input[disabled][type=text],.msp-plugin .msp-form-control[readonly],.msp-plugin .msp-btn[readonly],.msp-plugin .msp-control-row button[readonly],.msp-plugin .msp-control-row select[readonly],.msp-plugin .msp-control-row input[readonly][type=text],fieldset[disabled] .msp-plugin .msp-form-control,fieldset[disabled] .msp-plugin .msp-btn,fieldset[disabled] .msp-plugin .msp-control-row button,fieldset[disabled] .msp-plugin .msp-control-row select,fieldset[disabled] .msp-plugin .msp-control-row input[type=text]{background:#eeece7;opacity:0.35}.msp-plugin .msp-btn,.msp-plugin .msp-control-row button{display:inline-block;margin-bottom:0;text-align:center;touch-action:manipulation;cursor:pointer;background-image:none;white-space:nowrap;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;padding:0 10px;line-height:32px;border:none;-moz-box-sizing:border-box;box-sizing:border-box}.msp-plugin .msp-btn[disabled],.msp-plugin .msp-control-row button[disabled]{background:#eeece7;opacity:0.35}.msp-plugin .msp-btn-block,.msp-plugin .msp-control-row button{display:block;width:100%}.msp-plugin .msp-btn,.msp-plugin .msp-control-row button,.msp-plugin .msp-btn:active,.msp-plugin .msp-control-row button:active,.msp-plugin .msp-btn-link:focus,.msp-plugin .msp-btn:hover,.msp-plugin .msp-control-row button:hover{outline:none}.msp-plugin .msp-material-icon svg{display:inline-flex;vertical-align:middle;font-size:1.2em;margin-bottom:3px;fill:currentColor;width:1em;height:1em;flex-shrink:0;user-select:none}.msp-plugin .msp-btn-block>.msp-material-icon,.msp-plugin .msp-control-row button>.msp-material-icon{margin-left:0;margin-right:.4em}.msp-plugin .msp-btn-childless>.msp-material-icon{margin-left:0;margin-right:0}.msp-plugin .msp-btn-icon{border:none;height:32px;width:32px;line-height:32px;padding:0;text-align:center}.msp-plugin .msp-btn-icon:hover{color:#ae5d04;background-color:#e9e6e0;border:none;outline-offset:-1px !important;outline:1px solid #c9c3b3 !important}.msp-plugin .msp-btn-icon[disabled],.msp-plugin .msp-btn-icon[disabled]:hover,.msp-plugin .msp-btn-icon[disabled]:active{color:#9c835f}.msp-plugin .msp-btn-icon-small{border:none;height:32px;width:20px;line-height:32px;padding:0;text-align:center}.msp-plugin .msp-btn-icon-small:hover{color:#ae5d04;background-color:#e9e6e0;border:none;outline-offset:-1px !important;outline:1px solid #c9c3b3 !important}.msp-plugin .msp-btn-icon-small[disabled],.msp-plugin .msp-btn-icon-small[disabled]:hover,.msp-plugin .msp-btn-icon-small[disabled]:active{color:#9c835f}.msp-plugin .msp-btn-link{font-weight:normal;border-radius:0}.msp-plugin .msp-btn-link,.msp-plugin .msp-btn-link:active,.msp-plugin .msp-btn-link.active,.msp-plugin .msp-btn-link[disabled],fieldset[disabled] .msp-plugin .msp-btn-link{background-color:transparent;-webkit-box-shadow:none;box-shadow:none}.msp-plugin .msp-btn-link,.msp-plugin .msp-btn-link:hover,.msp-plugin .msp-btn-link:focus,.msp-plugin .msp-btn-link:active{border-color:transparent}.msp-plugin .msp-btn-link:hover,.msp-plugin .msp-btn-link:focus{text-decoration:none;background-color:transparent}.msp-plugin .msp-btn-link[disabled]:hover,.msp-plugin .msp-btn-link[disabled]:focus,fieldset[disabled] .msp-plugin .msp-btn-link:hover,fieldset[disabled] .msp-plugin .msp-btn-link:focus{text-decoration:none}.msp-plugin .msp-btn-link .msp-icon{font-size:100%}.msp-plugin .msp-btn-link,.msp-plugin .msp-btn-link:active,.msp-plugin .msp-btn-link:focus{color:#332b1f;text-decoration:none}.msp-plugin .msp-btn-link:hover{color:#ae5d04;text-decoration:none}.msp-plugin .msp-btn-link-toggle-on{color:#332b1f}.msp-plugin .msp-btn-link-toggle-off,.msp-plugin .msp-btn-link-toggle-off:active,.msp-plugin .msp-btn-link-toggle-off:focus{color:#9c835f !important}.msp-plugin .msp-btn-link-toggle-off:hover,.msp-plugin .msp-btn-link-toggle-on:hover{color:#ae5d04 !important}.msp-plugin .msp-btn-action,.msp-plugin .msp-btn-action:active,.msp-plugin .msp-btn-action:focus{color:#332b1f;background:#f3f2ee}.msp-plugin .msp-btn-action:hover{color:#ae5d04;background:#f9f8f6}.msp-plugin .msp-btn-action[disabled],.msp-plugin .msp-btn-action[disabled]:hover,.msp-plugin .msp-btn-action[disabled]:active,.msp-plugin .msp-btn-action[disabled]:focus{color:#362e21}.msp-plugin .msp-btn-commit-on,.msp-plugin .msp-btn-commit-on:active,.msp-plugin .msp-btn-commit-on:focus{color:#974102;background:#f2f1ed}.msp-plugin .msp-btn-commit-on:hover{color:#ae5d04;background:#f8f7f4}.msp-plugin .msp-btn-commit-on[disabled],.msp-plugin .msp-btn-commit-on[disabled]:hover,.msp-plugin .msp-btn-commit-on[disabled]:active,.msp-plugin .msp-btn-commit-on[disabled]:focus{color:#9c4302}.msp-plugin .msp-btn-commit-off,.msp-plugin .msp-btn-commit-off:active,.msp-plugin .msp-btn-commit-off:focus{color:#332b1f;background:#f6f5f3}.msp-plugin .msp-btn-commit-off:hover{color:#ae5d04;background:#fcfbfa}.msp-plugin .msp-btn-commit-off[disabled],.msp-plugin .msp-btn-commit-off[disabled]:hover,.msp-plugin .msp-btn-commit-off[disabled]:active,.msp-plugin .msp-btn-commit-off[disabled]:focus{color:#362e21}.msp-plugin .msp-btn-remove:hover{color:#F2F4F7}.msp-plugin .msp-btn-commit-on:hover{color:#fc6c03}.msp-plugin .msp-btn-action{height:32px;line-height:32px}.msp-plugin input[type="file"]{display:block}.msp-plugin input[type="range"]{display:block;width:100%}.msp-plugin select[multiple],.msp-plugin select[size]{height:auto}.msp-plugin textarea.msp-form-control,.msp-plugin textarea.msp-btn{height:auto}.msp-plugin .msp-control-top-offset{margin-top:1px}.msp-plugin .msp-btn-commit{text-align:right;padding-top:0;padding-bottom:0;padding-right:10px;padding-left:0;line-height:32px;border:none;overflow:hidden;font-weight:bold}.msp-plugin .msp-btn-commit .msp-icon{display:block-inline;line-height:32px;width:32px;text-align:center}.msp-plugin select.msp-form-control,.msp-plugin select.msp-btn,.msp-plugin .msp-control-row select{background:none;background-color:#f3f2ee;background-size:8px 12px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAUCAMAAACzvE1FAAAADFBMVEUzMzMzMzMzMzMzMzMKAG/3AAAAA3RSTlMAf4C/aSLHAAAAPElEQVR42q3NMQ4AIAgEQTn//2cLdRKppSGzBYwzVXvznNWs8C58CiussPJj8h6NwgorrKRdTvuV9v16Afn0AYFOB7aYAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-position:right 10px center;padding-right:24px}.msp-plugin select.msp-form-control:-moz-focusring,.msp-plugin select.msp-btn:-moz-focusring,.msp-plugin .msp-control-row select:-moz-focusring{color:transparent;text-shadow:0 0 0 #332b1f}.msp-plugin .msp-default-bg{background:#eeece7}.msp-plugin .msp-transparent-bg{background:transparent}.msp-plugin .msp-no-hover-outline:hover{color:#ae5d04;background-color:inherit;border:none;outline-offset:0 !important;outline:none !important}.msp-plugin .msp-icon-inline{margin-right:8px}.msp-plugin .msp-control-row{position:relative;height:32px;background:#eeece7;margin-top:1px}.msp-plugin .msp-control-row>span.msp-control-row-label,.msp-plugin .msp-control-row>button.msp-control-button-label{line-height:32px;display:block;width:120px;text-align:right;padding:0 10px;color:#63533c;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;position:relative;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;-o-user-select:none;user-select:none;cursor:default}.msp-plugin .msp-control-row>button.msp-control-button-label{background:#eeece7;cursor:pointer}.msp-plugin .msp-control-row .msp-control-current{background:#eeece7}.msp-plugin .msp-control-row>div.msp-control-row-ctrl{position:absolute;left:120px;top:0;right:0;bottom:0}.msp-plugin .msp-control-row>div{background:#f3f2ee}.msp-plugin .msp-control-row>.msp-flex-row{background:#eeece7}.msp-plugin .msp-control-label-short>span{width:80px !important}.msp-plugin .msp-control-label-short>div:nth-child(2){left:80px !important}.msp-plugin .msp-control-col-2{float:left;width:50%}.msp-plugin .msp-control-group{position:relative}.msp-plugin .msp-toggle-button .msp-icon{display:inline-block;margin-right:6px}.msp-plugin .msp-toggle-button>div>button:hover{border-color:#e9e6e0 !important;border:none;outline-offset:-1px  !important;outline:1px solid #c9c3b3 !important}.msp-plugin .msp-slider>div:first-child{position:absolute;top:0;left:18px;bottom:0;right:62px;display:flex}.msp-plugin .msp-slider>div:last-child{position:absolute;height:32px;line-height:32px;text-align:center;right:0;width:50px;top:0;bottom:0}.msp-plugin .msp-slider input[type=text]{padding-right:6px;padding-left:4px;font-size:80%;text-align:right}.msp-plugin .msp-slider2>div:first-child{position:absolute;height:32px;line-height:32px;text-align:center;left:0;width:25px;top:0;bottom:0;font-size:80%}.msp-plugin .msp-slider2>div:nth-child(2){position:absolute;top:0;left:35px;bottom:0;right:37px;display:flex}.msp-plugin .msp-slider2>div:last-child{position:absolute;height:32px;line-height:32px;text-align:center;right:0;width:25px;top:0;bottom:0;font-size:80%}.msp-plugin .msp-slider2 input[type=text]{padding-right:4px;padding-left:4px;font-size:80%;text-align:center}.msp-plugin .msp-toggle-color-picker button{border:10px solid #f3f2ee !important;margin:0;text-align:center;padding-right:10px;padding-left:10px}.msp-plugin .msp-toggle-color-picker button:hover{border-color:#e9e6e0 !important;border:none;outline-offset:-1px  !important;outline:1px solid #c9c3b3 !important}.msp-plugin .msp-toggle-color-picker .msp-color-picker{position:absolute;z-index:100000;background:#eeece7;border-top:1px solid #eeece7;padding-bottom:5px;width:100%}.msp-plugin .msp-toggle-color-picker-above .msp-color-picker{top:-85px;height:85px}.msp-plugin .msp-toggle-color-picker-below .msp-color-picker{top:32px;height:80px}.msp-plugin .msp-control-offset{padding-left:10px}.msp-plugin .msp-accent-offset{padding-left:1px;margin-left:8px;border-left:2px solid #e98b39}.msp-plugin .msp-control-group-wrapper{margin-bottom:0px;margin-top:1px}.msp-plugin .msp-control-group-header{background:#eeece7}.msp-plugin .msp-control-group-header>button,.msp-plugin .msp-control-group-header div{padding-left:4px;text-align:left;height:24px !important;line-height:24px !important;font-size:85% !important;background:#eeece7 !important;color:#63533c}.msp-plugin .msp-control-group-header .msp-icon{height:24px !important;line-height:24px !important}.msp-plugin .msp-control-group-header>span{padding-left:5px;line-height:21.33333px;font-size:70%;background:#eeece7;color:#63533c}.msp-plugin .msp-control-current{background:#eeece7}.msp-plugin .msp-control-group-footer{background:#e3e0d8;height:5px;font-size:1px;margin-top:1px}.msp-plugin .msp-control-group-expander{display:block;position:absolute;line-height:32px;padding:0;left:0;top:0;width:120px;text-align:left;background:transparent}.msp-plugin .msp-control-group-expander .msp-icon{line-height:29px;width:31px;text-align:center;font-size:100%}.msp-plugin .msp-plugin-layout_controls{position:absolute;left:10px;top:10px}.msp-plugin .msp-plugin-layout_controls>button:first-child{margin-right:6px}.msp-plugin .msp-empty-control{display:none}.msp-plugin .msp-control .msp-btn-block,.msp-plugin .msp-control .msp-control-row button,.msp-plugin .msp-control-row .msp-control button{margin-bottom:0px;margin-top:0px}.msp-plugin .msp-row-text{height:32px;position:relative;background:#eeece7;margin-top:1px}.msp-plugin .msp-row-text>div{line-height:32px;text-align:center;color:#63533c}.msp-plugin .msp-help span{display:none}.msp-plugin .msp-help:hover span{display:inline-block;background:linear-gradient(#eeece7, rgba(238,236,231,0.8))}.msp-plugin .msp-help-text{position:relative;background:#eeece7;margin-top:1px}.msp-plugin .msp-help-text>div{padding:5px 10px;text-align:left;color:#63533c}.msp-plugin .msp-help-description{font-style:italic}.msp-plugin .msp-help-legend{padding-top:10px}.msp-plugin .msp-scale-legend>div{width:100%;height:30px}.msp-plugin .msp-scale-legend>div>span{padding:5px;color:white;font-weight:bold;background-color:rgba(0,0,0,0.2)}.msp-plugin .msp-table-legend>div{margin-right:5px;display:inline-flex}.msp-plugin .msp-table-legend>div .msp-table-legend-color{width:30px;height:20px}.msp-plugin .msp-table-legend>div .msp-table-legend-text{margin:0 5px}.msp-plugin .msp-image-preview{position:relative;background:#eeece7;margin-top:1px;padding:10px}.msp-plugin .msp-image-preview canvas{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.msp-plugin .msp-image-preview>span{margin-top:6px;display:block;text-align:center;font-size:80%;line-height:15px}.msp-plugin .msp-copy-image-wrapper{position:relative}.msp-plugin .msp-copy-image-wrapper div{font-weight:bold;padding:3px;margin:1px 0;width:100%;background:#f3f2ee;text-align:center}.msp-plugin .msp-copy-image-wrapper img{margin-top:1px}.msp-plugin .msp-slider-base{position:relative;height:14px;padding:5px 0;width:100%;border-radius:6px;align-self:center;box-sizing:border-box;-webkit-tap-highlight-color:rgba(0,0,0,0)}.msp-plugin .msp-slider-base *{box-sizing:border-box;-webkit-tap-highlight-color:rgba(0,0,0,0)}.msp-plugin .msp-slider-base-rail{position:absolute;width:100%;background-color:#e0ddd4;height:4px;border-radius:2px}.msp-plugin .msp-slider-base-track{position:absolute;left:0;height:4px;border-radius:6px;background-color:tint(#332b1f, 60%)}.msp-plugin .msp-slider-base-handle{position:absolute;margin-left:-11px;margin-top:-9px;width:22px;height:22px;cursor:pointer;border-radius:50%;background-color:#332b1f;border:4px solid #e0ddd4}.msp-plugin .msp-slider-base-handle:hover{background-color:#ae5d04}.msp-plugin .msp-slider-base-mark{position:absolute;top:18px;left:0;width:100%;font-size:12px}.msp-plugin .msp-slider-base-mark-text{position:absolute;display:inline-block;vertical-align:middle;text-align:center;cursor:pointer;color:#999}.msp-plugin .msp-slider-base-mark-text-active{color:#666}.msp-plugin .msp-slider-base-step{position:absolute;width:100%;height:4px;background:transparent}.msp-plugin .msp-slider-base-dot{position:absolute;bottom:-2px;margin-left:-4px;width:8px;height:8px;border:2px solid #e9e9e9;background-color:#fff;cursor:pointer;border-radius:50%;vertical-align:middle}.msp-plugin .msp-slider-base-dot:first-child{margin-left:-4px}.msp-plugin .msp-slider-base-dot:last-child{margin-left:-4px}.msp-plugin .msp-slider-base-dot-active{border-color:tint(#332b1f, 50%)}.msp-plugin .msp-slider-base-disabled{background:#eeece7;opacity:0.35}.msp-plugin .msp-slider-base-disabled .msp-slider-base-handle,.msp-plugin .msp-slider-base-disabled .msp-slider-base-dot{cursor:not-allowed}.msp-plugin .msp-slider-base-disabled .msp-slider-base-mark-text,.msp-plugin .msp-slider-base-disabled .msp-slider-base-dot{cursor:not-allowed !important}.msp-plugin .msp-description{padding:10px;font-size:85%;background:#eeece7;text-align:center;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;-o-user-select:none;user-select:none;font-weight:light;cursor:default}.msp-plugin .msp-description:not(:first-child){border-top:1px solid #e0ddd4}.msp-plugin .msp-color-picker input{color:black !important}.msp-plugin .msp-no-webgl{position:absolute;width:100%;height:100%;left:0;top:0;display:table;text-align:center;background:#eeece7}.msp-plugin .msp-no-webgl>div{display:table-cell;vertical-align:middle;text-align:center;width:100%;height:100%}.msp-plugin .msp-no-webgl>div b{font-size:120%}.msp-plugin .msp-loader-msp-btn-file{position:relative;overflow:hidden}.msp-plugin .msp-loader-msp-btn-file input[type=file]{position:absolute;top:0;right:0;min-width:100%;min-height:100%;font-size:100px;text-align:right;filter:alpha(opacity=0);opacity:0;outline:none;background:white;cursor:inherit;display:block}.msp-plugin .msp-controls-section{margin-bottom:10px}.msp-plugin .msp-combined-color-button{border:4px solid #f3f2ee !important;margin:0;text-align:center;padding-right:10px;padding-left:10px}.msp-plugin .msp-combined-color-button:hover{border-color:#e9e6e0 !important;border:none;outline-offset:-1px  !important;outline:1px solid #c9c3b3 !important}.msp-plugin .msp-combined-color-swatch{width:100%;display:grid;grid-gap:1px;grid-template-columns:repeat(6, auto)}.msp-plugin .msp-combined-color-swatch .msp-btn:hover,.msp-plugin .msp-combined-color-swatch .msp-control-row button:hover,.msp-plugin .msp-control-row .msp-combined-color-swatch button:hover{outline-offset:-1px  !important;outline:1px solid #c9c3b3 !important}.msp-plugin .msp-action-select{position:relative}.msp-plugin .msp-action-select select{padding-left:42px}.msp-plugin .msp-action-select option:first-child{color:#63533c}.msp-plugin .msp-action-select>.msp-icon{display:block;top:0;left:10px;position:absolute;line-height:32px}.msp-plugin .msp-simple-help-section{height:28px;line-height:28px;margin-top:5px;margin-bottom:5px;padding:0 10px;font-weight:500;background:#eeece7;color:#332b1f}.msp-plugin .msp-left-panel-controls-buttons{position:absolute;width:32px;top:0;bottom:0;padding-top:10px;background:#eeece7}.msp-plugin .msp-left-panel-controls-buttons-bottom{position:absolute;bottom:0}.msp-plugin .msp-left-panel-controls-button-data-dirty{position:absolute;width:6px;height:6px;background:#e98b39;border-radius:3px;right:6px;bottom:6px}.msp-plugin .msp-left-panel-controls .msp-scrollable-container{left:33px}.msp-plugin .msp-mapped-parameter-group{position:relative}.msp-plugin .msp-mapped-parameter-group>.msp-control-row:first-child>div:nth-child(2){right:33px}.msp-plugin .msp-mapped-parameter-group>button:first-child{right:33px}.msp-plugin .msp-mapped-parameter-group>.msp-btn-icon{position:absolute;right:0;width:32px;top:0;padding:0}.msp-plugin .msp-shape-filled{fill:#332b1f;stroke:#332b1f}.msp-plugin .msp-shape-empty{fill:none;stroke:#332b1f}.msp-plugin .msp-no-overflow{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.msp-plugin .msp-25-lower-contrast-text{color:#826e4f}.msp-plugin .msp-expandable-group-color-stripe{position:absolute;left:0;top:30px;width:120px;height:2px}.msp-plugin .msp-section-header{height:32px;line-height:32px;margin-top:10px;margin-bottom:10px;text-align:right;padding:0 10px;font-weight:bold;background:#eeece7;overflow:hidden;cursor:default}.msp-plugin .msp-section-header>.msp-icon{display:block;float:left}.msp-plugin .msp-section-header>small{font-weight:normal}.msp-plugin .msp-current-header{height:32px;line-height:32px;margin-bottom:10px;text-align:center;font-weight:bold;background:#eeece7}.msp-plugin .msp-flex-row{margin-top:1px;background:#eeece7;display:flex;flex-direction:row;width:inherit;height:32px}.msp-plugin .msp-flex-row>.msp-flex-item{margin:0;flex:1 1 auto;margin-right:1px;overflow:hidden}.msp-plugin .msp-flex-row>.msp-flex-item:last-child{margin-right:0}.msp-plugin .msp-flex-row>select,.msp-plugin .msp-flex-row>button{margin:0;flex:1 1 auto;margin-right:1px;height:32px;overflow:hidden}.msp-plugin .msp-flex-row .msp-btn-icon,.msp-plugin .msp-flex-row .msp-btn-icon-small{flex:0 0 32px;max-width:32px}.msp-plugin .msp-flex-row>select{background:none}.msp-plugin .msp-flex-row>select>option[value=_]{display:none}.msp-plugin .msp-flex-row>select:last-child,.msp-plugin .msp-flex-row>button:last-child{margin-right:0}.msp-plugin .msp-flex-row>button.msp-control-button-label{background:#eeece7}.msp-plugin .msp-state-list{list-style:none}.msp-plugin .msp-state-list>li{position:relative;overflow:hidden}.msp-plugin .msp-state-list>li>button:first-child{text-align:left;border-left:10px solid #d5d0c3 !important}.msp-plugin .msp-state-list>li>div{position:absolute;right:0;top:0}.msp-plugin .msp-tree-row{position:relative;margin-top:0;margin-bottom:1px;background:transparent}.msp-plugin .msp-tree-row-current .msp-btn-tree-label{border-radius:0 !important}.msp-plugin .msp-tree-row-current .msp-btn-tree-label>span{font-weight:bold}.msp-plugin .msp-tree-row .msp-btn-tree-label{text-align:left;border-radius:0 0 0 8px;border-left-width:4px;border-left-style:solid}.msp-plugin .msp-tree-row .msp-btn-tree-label>small{color:#726046}.msp-plugin .msp-tree-updates-wrapper .msp-control-group-header:last-child{margin-bottom:1px}.msp-plugin .msp-viewport-top-left-controls{position:absolute;left:10px;top:10px}.msp-plugin .msp-viewport-top-left-controls .msp-traj-controls{line-height:32px;float:left;margin-right:10px;background-color:#f3f2ee}.msp-plugin .msp-viewport-top-left-controls .msp-traj-controls>span{color:#332b1f;margin-left:10px;margin-right:10px;font-size:85%;display:inline-block}.msp-plugin .msp-viewport-top-left-controls .msp-state-snapshot-viewport-controls{line-height:32px;float:left;margin-right:10px}.msp-plugin .msp-viewport-top-left-controls .msp-state-snapshot-viewport-controls>button{background-color:#f3f2ee}.msp-plugin .msp-viewport-top-left-controls .msp-state-snapshot-viewport-controls>select{display:inline-block;width:200px;margin-right:10px}.msp-plugin .msp-viewport-top-left-controls .msp-animation-viewport-controls{line-height:32px;float:left;margin-right:10px;position:relative}.msp-plugin .msp-viewport-top-left-controls .msp-animation-viewport-controls>div:first-child{position:relative;display:inline-block}.msp-plugin .msp-viewport-top-left-controls .msp-animation-viewport-controls>div:first-child>button{position:relative}.msp-plugin .msp-viewport-top-left-controls .msp-animation-viewport-controls .msp-animation-viewport-controls-select{width:290px;position:absolute;left:0;margin-top:10px;background:#e0ddd4}.msp-plugin .msp-viewport-top-left-controls .msp-animation-viewport-controls .msp-animation-viewport-controls-select .msp-control-row:first-child{margin-top:0}.msp-plugin .msp-selection-viewport-controls{position:relative;margin:10px auto 0 auto;width:430px}.msp-plugin .msp-selection-viewport-controls-actions{position:absolute;width:100%;top:32px;background:#e0ddd4}.msp-plugin .msp-selection-viewport-controls>.msp-flex-row .msp-btn,.msp-plugin .msp-selection-viewport-controls>.msp-flex-row .msp-control-row button,.msp-plugin .msp-control-row .msp-selection-viewport-controls>.msp-flex-row button{padding:0 5px}.msp-plugin .msp-selection-viewport-controls select.msp-form-control,.msp-plugin .msp-selection-viewport-controls select.msp-btn,.msp-plugin .msp-selection-viewport-controls .msp-control-row select,.msp-plugin .msp-control-row .msp-selection-viewport-controls select{padding:0 5px;text-align:center;background:#f3f2ee;flex:0 0 80px;text-overflow:ellipsis}.msp-plugin .msp-param-object-list-item{margin-top:1px;position:relative}.msp-plugin .msp-param-object-list-item>button{text-align:left}.msp-plugin .msp-param-object-list-item>button>span{font-weight:bold}.msp-plugin .msp-param-object-list-item>div{position:absolute;right:0;top:0}.msp-plugin .msp-state-actions .msp-transform-wrapper:last-child{margin-bottom:10px}.msp-plugin .msp-button-row{display:flex;flex-direction:row;height:32px;width:inherit}.msp-plugin .msp-button-row>button{margin:0;flex:1 1 auto;margin-right:1px;height:32px;text-align-last:center;background:none;padding:0 10px;overflow:hidden}.msp-plugin .msp-action-menu-options-no-header,.msp-plugin .msp-action-menu-options .msp-control-group-children{max-height:300px;overflow:hidden;overflow-y:auto}.msp-plugin .msp-action-menu-options .msp-control-row,.msp-plugin .msp-action-menu-options button,.msp-plugin .msp-action-menu-options .msp-icon,.msp-plugin .msp-action-menu-options .msp-flex-row{height:24px;line-height:24px}.msp-plugin .msp-action-menu-options button{text-align:left}.msp-plugin .msp-action-menu-options .msp-action-menu-button{margin-top:1px;display:flex}.msp-plugin .msp-action-menu-options .msp-action-menu-button .msp-icon{margin-right:6px}.msp-plugin .msp-representation-entry{position:relative}.msp-plugin .msp-representation-entry>.msp-control-group-header>.msp-btn,.msp-plugin .msp-control-row .msp-representation-entry>.msp-control-group-header>button{font-weight:bold}.msp-plugin .msp-representation-entry>.msp-control-group-header>.msp-icon,.msp-plugin .msp-representation-entry>.msp-control-group-header>.msp-btn-link{line-height:24px;height:24px}.msp-plugin .msp-parameter-matrix input{flex:1 1 auto;min-width:0}.msp-plugin .msp-btn-apply-simple{text-align:left}.msp-plugin .msp-btn-apply-simple .msp-icon{margin-right:10px}.msp-plugin .msp-type-class-Root{border-left-color:#eeece7}.msp-plugin .msp-type-class-Group{border-left-color:#e98b39}.msp-plugin .msp-type-class-Data{border-left-color:#bfc8c9}.msp-plugin .msp-type-class-Object{border-left-color:#54d98c}.msp-plugin .msp-type-class-Representation3D{border-left-color:#4aa3df}.msp-plugin .msp-type-class-Behavior{border-left-color:#b07cc6}.msp-plugin .msp-accent-color-cyan{color:#bfc8c9}.msp-plugin .msp-accent-bg-cyan{background:#bfc8c9}.msp-plugin .msp-transform-header-brand-cyan{border-bottom:1px solid #bfc8c9}.msp-plugin .msp-transform-header-brand-cyan:active,.msp-plugin .msp-transform-header-brand-cyan:focus{border-bottom:1px solid #bfc8c9}.msp-plugin .msp-accent-color-red{color:#ef8b80}.msp-plugin .msp-accent-bg-red{background:#ef8b80}.msp-plugin .msp-transform-header-brand-red{border-bottom:1px solid #ef8b80}.msp-plugin .msp-transform-header-brand-red:active,.msp-plugin .msp-transform-header-brand-red:focus{border-bottom:1px solid #ef8b80}.msp-plugin .msp-accent-color-gray{color:#46637f}.msp-plugin .msp-accent-bg-gray{background:#46637f}.msp-plugin .msp-transform-header-brand-gray{border-bottom:1px solid #46637f}.msp-plugin .msp-transform-header-brand-gray:active,.msp-plugin .msp-transform-header-brand-gray:focus{border-bottom:1px solid #46637f}.msp-plugin .msp-accent-color-green{color:#54d98c}.msp-plugin .msp-accent-bg-green{background:#54d98c}.msp-plugin .msp-transform-header-brand-green{border-bottom:1px solid #54d98c}.msp-plugin .msp-transform-header-brand-green:active,.msp-plugin .msp-transform-header-brand-green:focus{border-bottom:1px solid #54d98c}.msp-plugin .msp-accent-color-purple{color:#b07cc6}.msp-plugin .msp-accent-bg-purple{background:#b07cc6}.msp-plugin .msp-transform-header-brand-purple{border-bottom:1px solid #b07cc6}.msp-plugin .msp-transform-header-brand-purple:active,.msp-plugin .msp-transform-header-brand-purple:focus{border-bottom:1px solid #b07cc6}.msp-plugin .msp-accent-color-blue{color:#4aa3df}.msp-plugin .msp-accent-bg-blue{background:#4aa3df}.msp-plugin .msp-transform-header-brand-blue{border-bottom:1px solid #4aa3df}.msp-plugin .msp-transform-header-brand-blue:active,.msp-plugin .msp-transform-header-brand-blue:focus{border-bottom:1px solid #4aa3df}.msp-plugin .msp-accent-color-orange{color:#e98b39}.msp-plugin .msp-accent-bg-orange{background:#e98b39}.msp-plugin .msp-transform-header-brand-orange{border-bottom:1px solid #e98b39}.msp-plugin .msp-transform-header-brand-orange:active,.msp-plugin .msp-transform-header-brand-orange:focus{border-bottom:1px solid #e98b39}.msp-plugin .msp-volume-channel-inline-controls>:first-child{position:absolute;left:0;top:0;height:32px;right:32px}.msp-plugin .msp-volume-channel-inline-controls .msp-slider>div:first-child{right:42px}.msp-plugin .msp-volume-channel-inline-controls .msp-slider>div:last-child{width:30px}.msp-plugin .msp-volume-channel-inline-controls>button{position:absolute;right:0;width:32px;top:0;padding:0}.msp-plugin .msp-volume-channel-inline-controls>button .msp-material-icon{margin-right:0}.msp-plugin .msp-list-unstyled{padding-left:0;list-style:none}.msp-plugin .msp-task-state{line-height:32px}.msp-plugin .msp-task-state>span{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;-o-user-select:none;user-select:none;cursor:default}.msp-plugin .msp-overlay-tasks{position:absolute;display:flex;top:0;left:0;bottom:0;right:0;height:100%;width:100%;z-index:1000;justify-content:center;align-items:center;background:rgba(0,0,0,0.25)}.msp-plugin .msp-overlay-tasks .msp-task-state>div{height:32px;margin-top:1px;position:relative;width:100%;background:#eeece7}.msp-plugin .msp-overlay-tasks .msp-task-state>div>div{height:32px;line-height:32px;display:inline-block;padding:0 10px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;-o-user-select:none;user-select:none;cursor:default;white-space:nowrap;background:#eeece7;position:absolute}.msp-plugin .msp-overlay-tasks .msp-task-state>div>button{display:inline-block;margin-top:-3px}.msp-plugin .msp-background-tasks{position:absolute;left:0;bottom:0;z-index:1000}.msp-plugin .msp-background-tasks .msp-task-state>div{height:32px;margin-top:1px;position:relative;width:100%;background:#eeece7}.msp-plugin .msp-background-tasks .msp-task-state>div>div{height:32px;line-height:32px;display:inline-block;padding:0 10px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;-o-user-select:none;user-select:none;cursor:default;white-space:nowrap;background:#eeece7;position:absolute}.msp-plugin .msp-background-tasks .msp-task-state>div>button{display:inline-block;margin-top:-3px}.msp-plugin .msp-viewport{position:absolute;left:0;top:0;right:0;bottom:0;background:black}.msp-plugin .msp-viewport .msp-btn-link{background:rgba(0,0,0,0.2)}.msp-plugin .msp-viewport-expanded{position:fixed;z-index:1000}.msp-plugin .msp-viewport-host3d{position:absolute;left:0;top:0;right:0;bottom:0;-webkit-user-select:none;-webkit-tap-highlight-color:rgba(0,0,0,0);-webkit-touch-callout:none;touch-action:manipulation}.msp-plugin .msp-viewport-host3d>canvas{background-color:#eeece7;background-image:linear-gradient(45deg, lightgrey 25%, transparent 25%, transparent 75%, lightgrey 75%, lightgrey),linear-gradient(45deg, lightgrey 25%, transparent 25%, transparent 75%, lightgrey 75%, lightgrey);background-size:60px 60px;background-position:0 0, 30px 30px}.msp-plugin .msp-viewport-controls{position:absolute;right:10px;top:10px;width:32px}.msp-plugin .msp-viewport-controls-buttons{text-align:right;position:relative}.msp-plugin .msp-viewport-controls-buttons>div{position:relative;margin-bottom:4px}.msp-plugin .msp-viewport-controls-buttons button{padding:0;text-align:center;width:32px;position:relative}.msp-plugin .msp-viewport-controls-buttons .msp-btn-link-toggle-off{color:#9c835f}.msp-plugin .msp-viewport-controls-buttons .msp-btn-link:hover{color:#ae5d04}.msp-plugin .msp-semi-transparent-background{background:#eeece7;opacity:0.5;position:absolute;top:0;left:0;width:100%;height:100%}.msp-plugin .msp-viewport-controls-panel{width:290px;top:0;right:36px;position:absolute;background:#e0ddd4}.msp-plugin .msp-viewport-controls-panel .msp-control-group-wrapper:first-child{padding-top:0}.msp-plugin .msp-viewport-controls-panel .msp-viewport-controls-panel-controls{overflow-y:auto;max-height:400px}.msp-plugin .msp-highlight-toast-wrapper{position:absolute;right:10px;bottom:10px;max-width:95%;z-index:10000}.msp-plugin .msp-highlight-info{color:#ae5d04;padding:3px 10px;background:#eeece7;text-align:right;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;-o-user-select:none;user-select:none;cursor:default}.msp-plugin .msp-highlight-info-additional{font-size:85%;display:inline-block;color:#fa911e}.msp-plugin .msp-log-wrap{position:absolute;right:0;top:0;left:0;bottom:0;overflow:hidden}.msp-plugin .msp-log{position:absolute;right:-20px;top:0;left:0;bottom:0;overflow-y:scroll;overflow-x:hidden;font-size:90%;background:#e0ddd4}.msp-plugin .msp-log{font-size:90%;color:#433829}.msp-plugin .msp-log ul{padding:0;margin:0}.msp-plugin .msp-log li{clear:both;margin:0;background:#eeece7;position:relative}.msp-plugin .msp-log li:not(:last-child){border-bottom:1px solid #cec9ba}.msp-plugin .msp-log .msp-log-entry{margin-left:110px;background:#ebe8e3;padding:3px 25px 3px 10px}.msp-plugin .msp-log .msp-log-timestamp{padding:3px 10px 3px 10px;float:left;text-align:right;width:110px;color:#726046;font-size:100%}.msp-plugin .msp-log .msp-log-timestamp small{font-size:100%}.msp-plugin .msp-log .label{margin-top:-3px;font-size:7pt}.msp-plugin .msp-log-entry-badge{position:absolute;left:0;top:0;bottom:0;width:6px}.msp-plugin .msp-log-entry-message{background:#0CCA5D}.msp-plugin .msp-log-entry-info{background:#5E3673}.msp-plugin .msp-log-entry-error{background:#FD354B}.msp-plugin .msp-log-entry-warning{background:#FCC937}.msp-plugin .msp-sequence{position:absolute;right:0;top:0;left:0;bottom:0;background:#eeece7}.msp-plugin .msp-sequence-select{position:relative;height:24px;width:100%;margin-bottom:1px;background:#e0ddd4;text-align:left}.msp-plugin .msp-sequence-select>span{display:inline-block;line-height:24px;padding:0 10px;font-size:85%;font-weight:bold;cursor:default}.msp-plugin .msp-sequence-select>select{display:inline-block;max-width:120px;width:auto;text-overflow:ellipsis;font-size:85%;height:24px;line-height:24px;background-size:6px 8px;background-color:#e0ddd4}.msp-plugin .msp-sequence-wrapper{word-break:break-word;padding:10px 10px 3px 10px;user-select:none}.msp-plugin .msp-sequence-wrapper-non-empty{font-size:85%;line-height:180%;font-family:"Courier New", monospace;background:#f3f2ee;width:100%;overflow-y:auto;overflow-x:hidden;position:absolute;top:25px;left:0;bottom:0;right:0}.msp-plugin .msp-sequence-chain-label{margin-left:10px;margin-top:10px;user-select:none;color:#ae5d04;font-size:90%;line-height:90%;padding-left:0.2em}.msp-plugin .msp-sequence-wrapper span{cursor:pointer}.msp-plugin .msp-sequence-wrapper .msp-sequence-residue-long{margin:0em 0.2em 0em 0.2em}.msp-plugin .msp-sequence-wrapper .msp-sequence-residue-long-begin{margin:0em 0.2em 0em 0em}.msp-plugin .msp-sequence-wrapper .msp-sequence-label{color:#ae5d04;font-size:90%;line-height:90%;padding-bottom:1em;padding-left:0.2em}.msp-plugin .msp-sequence-wrapper .msp-sequence-number{color:#ae5d04;word-break:keep-all;cursor:default;position:relative;top:-1.1em;left:3.1em;padding:0px;margin-left:-3em;font-size:80%}.msp-plugin .msp-sequence-wrapper .msp-sequence-number-long{left:3.3em}.msp-plugin .msp-sequence-wrapper .msp-sequence-number-long-negative{left:2.7em}.msp-plugin .msp-sequence-wrapper .msp-sequence-number-negative{left:2.5em}.msp-plugin .msp-sequence-wrapper .msp-sequence-present{color:#332b1f}.msp-plugin .msp-sequence-wrapper .msp-sequence-missing{color:#9c835f}.msp-plugin .msp-transformer .msp-entity-badge{position:absolute;top:0;right:0;height:32px;line-height:32px;width:32px}.msp-plugin .msp-layout-right,.msp-plugin .msp-layout-left{background:#e0ddd4}.msp-plugin .msp-transformer-wrapper{position:relative}.msp-plugin .msp-transformer-wrapper .msp-entity-badge{left:0;top:0}.msp-plugin .msp-transformer-wrapper:first-child .msp-panel-description-content{top:33px}.msp-plugin .msp-transformer-wrapper:not(:first-child) .msp-panel-description-content{bottom:33px}.msp-plugin .msp-transform-wrapper{margin-bottom:10px}.msp-plugin .msp-transform-wrapper-collapsed{margin-bottom:1px}.msp-plugin .msp-transform-update-wrapper{margin-bottom:1px}.msp-plugin .msp-transform-update-wrapper-collapsed{margin-bottom:1px}.msp-plugin .msp-transform-update-wrapper>.msp-transform-header>button,.msp-plugin .msp-transform-update-wrapper-collapsed>.msp-transform-header>button{text-align:left;padding-left:32px;line-height:24px;background:#e9e6e0}.msp-plugin .msp-transform-wrapper>.msp-transform-header>button{text-align:left;background:#eeece7;font-weight:bold;padding-right:5px}.msp-plugin .msp-transform-header{position:relative}.msp-plugin .msp-transform-header>button>small{font-weight:normal;float:right}.msp-plugin .msp-transform-header>button>span:first-child{margin-right:10px}.msp-plugin .msp-transform-header>button:hover{color:#63533c}.msp-plugin .msp-transform-header-brand{margin-bottom:-1px}.msp-plugin .msp-transform-header-brand svg{fill:#332b1f;stroke:#332b1f}.msp-plugin .msp-transform-default-params{background:#eeece7;position:absolute;left:0;top:0;width:32px;padding:0}.msp-plugin .msp-transform-default-params:hover{background:#fff}.msp-plugin .msp-transform-apply-wrap{position:relative;margin-top:1px;width:100%;height:32px}.msp-plugin .msp-transform-refresh{width:87px;margin-left:33px;background:#eeece7;text-align:right}.msp-plugin .msp-transform-apply{display:block;position:absolute;left:120px;right:0;top:0}.msp-plugin .msp-transform-apply-wider{margin-left:33px}.msp-plugin .msp-data-beh{margin:10px 0 !important}.msp-plugin .msp-toast-container{position:relative;z-index:1001}.msp-plugin .msp-toast-container .msp-toast-entry{color:#332b1f;background:#e0ddd4;position:relative;float:right;min-height:32px;margin-top:10px;border:1px solid #cec9ba;display:table}.msp-plugin .msp-toast-container .msp-toast-entry .msp-toast-title{height:100%;line-height:32px;padding:0 10px;background:#eeece7;font-weight:bold;display:table-cell;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;-o-user-select:none;user-select:none;font-weight:light;cursor:pointer}.msp-plugin .msp-toast-container .msp-toast-entry .msp-toast-message{padding:3px 42px 3px 10px;display:table-cell}.msp-plugin .msp-toast-container .msp-toast-entry .msp-toast-message a{text-decoration:none;color:#974102;font-weight:bold}.msp-plugin .msp-toast-container .msp-toast-entry .msp-toast-message a:hover{text-decoration:underline;color:#fc6c03}.msp-plugin .msp-toast-container .msp-toast-entry .msp-toast-message a:active,.msp-plugin .msp-toast-container .msp-toast-entry .msp-toast-message a:focus{color:#974102;outline-offset:0;outline:none}.msp-plugin .msp-toast-container .msp-toast-entry .msp-toast-hide{position:absolute;width:42px;right:0;top:0;bottom:0}.msp-plugin .msp-toast-container .msp-toast-entry .msp-toast-hide .msp-btn-icon{background:transparent;position:absolute;top:1px;right:0;left:0;bottom:0;width:100%;text-align:right;padding-right:5px}.msp-plugin .msp-help-row{position:relative;height:32px;background:#eeece7;margin-top:1px;display:table;width:100%}.msp-plugin .msp-help-row>span{width:120px;text-align:right;padding:3px 10px;color:#63533c;display:table-cell;font-weight:bold;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;-o-user-select:none;user-select:none;cursor:default}.msp-plugin .msp-help-row>div{background:#f3f2ee;position:relative;padding:3px 10px;display:table-cell}.msp-plugin .msp-canvas{width:100%;height:100%;background-color:#f3f2ee}.msp-plugin .msp-canvas text{-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.msp-plugin .msp-canvas circle{stroke:black;stroke-width:10;stroke-opacity:.3}.msp-plugin .msp-canvas circle:hover{fill:#ae5d04;stroke:black;stroke-width:10px}.msp-plugin .msp-canvas .info{fill:white;stroke:black;stroke-width:3}.msp-plugin .msp-canvas .show{visibility:visible}.msp-plugin .msp-canvas .hide{visibility:hidden}.msp-plugin .msp-canvas .delete-button rect{fill:#ED4337;stroke:black}.msp-plugin .msp-canvas .delete-button text{stroke:white;fill:white}.msp-plugin .msp-canvas .delete-button:hover{stroke:black;stroke-width:3;fill:#ff6961}.msp-plugin .msp-canvas .infoCircle:hover{fill:#4c66b2}.msp-plugin .msp-canvas:focus{outline:none}.msp-plugin .msp-logo{display:block;position:absolute;bottom:10px;right:10px;height:32px;width:100px;background-repeat:no-repeat;background-position:bottom right;background-size:auto;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFcAAAAgCAYAAABn7+QVAAAABGdBTUEAALGOfPtRkwAAACBjSFJNAACHDwAAjA8AAP1SAACBQAAAfXkAAOmLAAA85QAAGcxzPIV3AAAKL2lDQ1BJQ0MgUHJvZmlsZQAASMedlndUVNcWh8+9d3qhzTACUobeu8AA0nuTXkVhmBlgKAMOMzSxIaICEUVEmiJIUMSA0VAkVkSxEBRUsAckCCgxGEVULG9G1ouurLz38vL746xv7bP3ufvsvc9aFwCSpy+XlwZLAZDKE/CDPJzpEZFRdOwAgAEeYIApAExWRrpfsHsIEMnLzYWeIXICXwQB8HpYvAJw09AzgE4H/5+kWel8geiYABGbszkZLBEXiDglS5Auts+KmBqXLGYYJWa+KEERy4k5YZENPvsssqOY2ak8tojFOaezU9li7hXxtkwhR8SIr4gLM7mcLBHfErFGijCVK+I34thUDjMDABRJbBdwWIkiNhExiR8S5CLi5QDgSAlfcdxXLOBkC8SXcklLz+FzExIFdB2WLt3U2ppB9+RkpXAEAsMAJiuZyWfTXdJS05m8HAAW7/xZMuLa0kVFtjS1trQ0NDMy/apQ/3Xzb0rc20V6Gfi5ZxCt/4vtr/zSGgBgzIlqs/OLLa4KgM4tAMjd+2LTOACApKhvHde/ug9NPC+JAkG6jbFxVlaWEZfDMhIX9A/9T4e/oa++ZyQ+7o/y0F058UxhioAurhsrLSVNyKdnpDNZHLrhn4f4Hwf+dR4GQZx4Dp/DE0WEiaaMy0sQtZvH5gq4aTw6l/efmvgPw/6kxbkWidL4EVBjjIDUdSpAfu0HKAoRINH7xV3/o2+++DAgfnnhKpOLc//vN/1nwaXiJYOb8DnOJSiEzhLyMxf3xM8SoAEBSAIqkAfKQB3oAENgBqyALXAEbsAb+IMQEAlWAxZIBKmAD7JAHtgECkEx2An2gGpQBxpBM2gFx0EnOAXOg0vgGrgBboP7YBRMgGdgFrwGCxAEYSEyRIHkIRVIE9KHzCAGZA+5Qb5QEBQJxUIJEA8SQnnQZqgYKoOqoXqoGfoeOgmdh65Ag9BdaAyahn6H3sEITIKpsBKsBRvDDNgJ9oFD4FVwArwGzoUL4B1wJdwAH4U74PPwNfg2PAo/g+cQgBARGqKKGCIMxAXxR6KQeISPrEeKkAqkAWlFupE+5CYyiswgb1EYFAVFRxmibFGeqFAUC7UGtR5VgqpGHUZ1oHpRN1FjqFnURzQZrYjWR9ugvdAR6AR0FroQXYFuQrejL6JvoyfQrzEYDA2jjbHCeGIiMUmYtZgSzD5MG+YcZhAzjpnDYrHyWH2sHdYfy8QKsIXYKuxR7FnsEHYC+wZHxKngzHDuuCgcD5ePq8AdwZ3BDeEmcQt4Kbwm3gbvj2fjc/Cl+EZ8N/46fgK/QJAmaBPsCCGEJMImQiWhlXCR8IDwkkgkqhGtiYFELnEjsZJ4jHiZOEZ8S5Ih6ZFcSNEkIWkH6RDpHOku6SWZTNYiO5KjyALyDnIz+QL5EfmNBEXCSMJLgi2xQaJGokNiSOK5JF5SU9JJcrVkrmSF5AnJ65IzUngpLSkXKabUeqkaqZNSI1Jz0hRpU2l/6VTpEukj0lekp2SwMloybjJsmQKZgzIXZMYpCEWd4kJhUTZTGikXKRNUDFWb6kVNohZTv6MOUGdlZWSXyYbJZsvWyJ6WHaUhNC2aFy2FVko7ThumvVuitMRpCWfJ9iWtS4aWzMstlXOU48gVybXJ3ZZ7J0+Xd5NPlt8l3yn/UAGloKcQqJClsF/hosLMUupS26WspUVLjy+9pwgr6ikGKa5VPKjYrzinpKzkoZSuVKV0QWlGmabsqJykXK58RnlahaJir8JVKVc5q/KULkt3oqfQK+m99FlVRVVPVaFqveqA6oKatlqoWr5am9pDdYI6Qz1evVy9R31WQ0XDTyNPo0XjniZek6GZqLlXs09zXktbK1xrq1an1pS2nLaXdq52i/YDHbKOg84anQadW7oYXYZusu4+3Rt6sJ6FXqJejd51fVjfUp+rv09/0ABtYG3AM2gwGDEkGToZZhq2GI4Z0Yx8jfKNOo2eG2sYRxnvMu4z/mhiYZJi0mhy31TG1Ns037Tb9HczPTOWWY3ZLXOyubv5BvMu8xfL9Jdxlu1fdseCYuFnsdWix+KDpZUl37LVctpKwyrWqtZqhEFlBDBKGJet0dbO1husT1m/tbG0Edgct/nN1tA22faI7dRy7eWc5Y3Lx+3U7Jh29Xaj9nT7WPsD9qMOqg5MhwaHx47qjmzHJsdJJ12nJKejTs+dTZz5zu3O8y42Lutczrkirh6uRa4DbjJuoW7Vbo/c1dwT3FvcZz0sPNZ6nPNEe/p47vIc8VLyYnk1e816W3mv8+71IfkE+1T7PPbV8+X7dvvBft5+u/0erNBcwVvR6Q/8vfx3+z8M0A5YE/BjICYwILAm8EmQaVBeUF8wJTgm+Ejw6xDnkNKQ+6E6ocLQnjDJsOiw5rD5cNfwsvDRCOOIdRHXIhUiuZFdUdiosKimqLmVbiv3rJyItogujB5epb0qe9WV1QqrU1afjpGMYcaciEXHhsceiX3P9Gc2MOfivOJq42ZZLqy9rGdsR3Y5e5pjxynjTMbbxZfFTyXYJexOmE50SKxInOG6cKu5L5I8k+qS5pP9kw8lf0oJT2lLxaXGpp7kyfCSeb1pymnZaYPp+umF6aNrbNbsWTPL9+E3ZUAZqzK6BFTRz1S/UEe4RTiWaZ9Zk/kmKyzrRLZ0Ni+7P0cvZ3vOZK577rdrUWtZa3vyVPM25Y2tc1pXvx5aH7e+Z4P6hoINExs9Nh7eRNiUvOmnfJP8svxXm8M3dxcoFWwsGN/isaWlUKKQXziy1XZr3TbUNu62ge3m26u2fyxiF10tNimuKH5fwiq5+o3pN5XffNoRv2Og1LJ0/07MTt7O4V0Ouw6XSZfllo3v9tvdUU4vLyp/tSdmz5WKZRV1ewl7hXtHK30ru6o0qnZWva9OrL5d41zTVqtYu712fh9739B+x/2tdUp1xXXvDnAP3Kn3qO9o0GqoOIg5mHnwSWNYY9+3jG+bmxSaips+HOIdGj0cdLi32aq5+YjikdIWuEXYMn00+uiN71y/62o1bK1vo7UVHwPHhMeefh/7/fBxn+M9JxgnWn/Q/KG2ndJe1AF15HTMdiZ2jnZFdg2e9D7Z023b3f6j0Y+HTqmeqjkte7r0DOFMwZlPZ3PPzp1LPzdzPuH8eE9Mz/0LERdu9Qb2Dlz0uXj5kvulC31OfWcv210+dcXmysmrjKud1yyvdfRb9Lf/ZPFT+4DlQMd1q+tdN6xvdA8uHzwz5DB0/qbrzUu3vG5du73i9uBw6PCdkeiR0TvsO1N3U+6+uJd5b+H+xgfoB0UPpR5WPFJ81PCz7s9to5ajp8dcx/ofBz++P84af/ZLxi/vJwqekJ9UTKpMNk+ZTZ2adp++8XTl04ln6c8WZgp/lf619rnO8x9+c/ytfzZiduIF/8Wn30teyr889GrZq565gLlHr1NfL8wXvZF/c/gt423fu/B3kwtZ77HvKz/ofuj+6PPxwafUT5/+BQOY8/xvJtwPAAAACXBIWXMAAC4iAAAuIgGq4t2SAAANMElEQVRoQ92aB1xURx7H/69sY5eOFBELCipESsSC0RCMJRZMrICHGiMmGjWaqDk7YEsuGok5TS6xi56KGtsFG6jBiAYLKhqVc8GGBZG+fd97N+/twNJWFksS7/v5DG/nN/OG/fze/838Z4CA/wMCE9d9W8oQ3mUMBSojBTqWAuBQAweHIC56lanXHw8xJixM6qhQNcX1KuQykluyKzMPVxvF5XUh3hIpgFSiQz8AJBItSKU6sCsX55P9byLxxRKwYl3W5O6dg5o62IMRmcpyBBz87wNYcyH3R4iL+gh3+8MhHaTqYJKUKO2dPYTigIqza1MlLZLnzh3arQ/uZzVn14YOIGRyJWXrqgR5U6VI1kRJS92VBEEry+wrAnC3F04XL3cY4OMF7/p6weC2zSDQzQG3/IlM7dspdPmU0VxtLqYf5haM6HYOBYLVUwcXByQy92JxXioexUzFhT5cySn3TrjrC4WP3EsPHuPfZGJVZg4HCdt/wF0aT8LWUHT/jTpl4fZU3KNBSHytQ0D33uDR0qfjoqg3hmOpQU65d4u2cW4X6NCyJ1ZeIeKSFRC3p1q4kzYdmzr6Zk98p6rsj+rhi0KoFe5gIm53M/ypDhbNJQgC3kbTFUGSi+LiwmgsWyQ5zk9McESCZ8gEVHvF1kneWJI5CJT2SHWDbUQ0vNbEvqr4OClwCyZ+RzSQ+psomqOwUgOL5vL4BIdCi/aBvtJb3AdYsoirs0usnWfH1vbNOmPlFWHmWlve2DFB3t0nhvh0qm2wRRZuG+ksFyUlDe4qcbYRJ0H8v6NxSxVPNZcnPPJDIAlY8PWnXWVYqsPhZb3lDAfzW3T50xbmZ+MfyFhbRcr7yNj1EZ1gdb+O8DFvMKk7it4+ywYjY11k0s1po8KpmA4tITUmnHaWS5HBKJKr0aC5zXw6QJvgNzyhXDIZS3UgCN3UJq3fdLd188PKs3H8+Bjpvn2x/jv2TwnbsOezt3/YPavTss3TXXHzi4U3Vic/+H5gq+7rkLEkmgb5yWwVb3CnNiFAcD+aOtaGaMobmzrqLaoyIwlC11RkNB/JvPGCiGjQXJ43h8QCSRGzEqeG1Xmah77u48QCPdM7NBYrjSPveJg069i7H2UcjUpndWSZrZ3bFRfHlic8nL1TnezcM2Vyh0dLtsbnzdu8JHHW5qVt8G3Pj9qOT4RYluOE/UYllQZPCvFxMik1cbGRSKsbWwlKUPhxhDGxZJ25Ls28oX2X3k60HmZiqQqDTj+rqX8fB7lTC6xYT2569zA9Jb5m7xz8r3aB03uE9fpOFP7WYujZ/TPo22MSDOs1FT4ePBfG9ZvQsod/12kUJf190prli4YnJ6Mt2HOSMKICGLL/5su3Tn6wPxMYZE4lvMH/RAZP6NjaJGBsJSJIi3mrTg6d9bAYem05YSxS6WJgQdR2LFtnLk9oxFigRaKpq2aEuWMJDizu6UlQosltuo3FivU8zgyOkEhkRzz941u2CogDxyYhgMzDrWb4rMXN0Q36vN4TZr43XuTt0WyeoiR/MwqV509JqgzOSx+77zcw8nGM4UMx2r+5qYJpqpByHVztcc3E+QdFXJWx8dE78MgCDaZYldi5eIB/jwj577/+NB9VJ/GajmHj2nYZKpPZNW5aVJ9v2ULDwlaXdsvFYlvzpo1l9PD4yXUoKStAY3MgFjuAexNvcFA4C+32NgqY3HcofHFg18ioH1adRSHyjdBgCQJaQ/y2SFyzAIMKuSkp+1YAepIOGwZ1Bgo9UGu4gCK2z9ZfoEit3yMI1X8XxZwh+B2al2/7jOnfbsKqGaNeB7RYgmsAmvJi2LHkbwaC0baXyElKKpVe7f/JVlpsY4978Abp0PxsvqcSVVZfMGoud3Z44+HZ8vOeG2m3GWOkntNwK8CTgky4eiWJK9fqflUZJRe0jFirZmgvDSPu29or2PmdzhEgpkVC3/ziIpiRvL1ETUua74+NLed3aEnRg4IC3F2Edp6DNx/AmqxcXLMeFK0w3M8L1yxToTfCtCNZUKTRY8VMZv4TyC/VxFiM3OM7N0BudiaMW/g9VgBkto7QIWyYKDstaSEYGdo3dEQNY/n5/EbKJHBq2QPcOozBWk24K00UGgM3QuI2GisA5cVXIOdyYqHeKBo0cEDSaSwLLNu8TJ5968o6LQORI3oMETRPRycI9GrhkHH7Di/UjQpEvzYeQnlZKMQ0rB1Y/25+xO4M2Fl61/KcazTo4W5ONuRcOIUVEx3CI0Fqax8lljsO9w2tuTMuyksHVcHvwKHX2xIcU9aFsgmQEbR5MX50aztQYJzWu19NY3lmjp6pekIrxmbfvv6woLQQqwCBzZujn0SYqfbX5KkLGprVL51IXgMcW5VdgFgqh4DwkaR/WAxBi837Co5j4Hbmj3wucglL9cJy4ENKzRkVf5+q9Bqnpol9WKpDYuR0DfoKabcL8rGCotfBEQ0GLy41ewk81VyWIfYV3lNmXj2NNizVaNvtPfBBc2B1Hl07BKqi2xkkyf0HSxYg0D7eFn9G5rJ69EAYfXj4zgos1QtaYoq16G2qRCYWA0dw5oFqcb9cAyfvPG50ufq4FI/wdPg5t777+VKoNh1ZPzVbIAiWIwl69qm9G9Lad+kJFF5QKFosXCthjXrI/W0jsCw5G62+Tz0D5p8mU3sxrp7FWwClZKYcHWMawvKqvuf6PZh86HwBusW6VY0g/FzlEru0mHAsPB05mnN3X7sHKzNz+K91Df2o+VQIorDBVGz2lpPHvhobdvRy+v7ewT2HYrUmdy/tBU3po5Ren55MP7e+a6MP2F8aHLHXqr9ExO8Y46oQr08bFS6cflkD/1gT+wYLH1aeydGCSD8Q5ox5Ymo1YdUmgqTI2ZkpWziDToMVM0adCpRntrAERc/B0qvFImSsrWAsWdvYx/j1rkRtYNBGo+bbk9gnGKZ19Q0GgzgVlm4yJeQYq8ydsfb4eW158a6LaTuxYkaZuQN0mrLtb39y/KkL2V+Shdved7URrz9Wj7Fn7xfBuAOZuGbiTqkKRu09Y8HgtkFg5A3+qcpgq8zloUT0vItpyUZthXlq0amKQfnbTgNw5AIsvTos3o2SYGL10vAA0r8eY/mdV4nWgBUz26/eqWMwz7JeQeDrbIcM1idgyXpzp6xOyzHoVBuyUrdiBeD6ySQw6DVr+n9+XImlBmE5ggHOiGs8wleg0G7e8urEQwBNEuavywjpYY2BGse8oQ9QHjgM7bK0/ApfiWDslhOGEq1+NZZqwnH526/cOVbdYP7K13OelKcBY/O5ICKsNpeHFJMJ1zL2aVQlBaAqfgDKswdUKIFYhJutAqVqDznDI1xDdbRVFkkc6YzDQ9piqX448HNSmE+jitVq/mkU4OqzERd9sEJnGNJ/W7pgcGalsTp9FDLRdF5QGwJ0wNpEoAhOi0GGao0M8Fe+DkzpIEgYpMY9G2fuxMRj+axBvyrryEbITtsIjNGwcuDnvzzEzVahJ+gsVnURfTK/Vg6uYUDSNH8gVG/0Ltqy6E2FVNajjYf5WFNZ8AhQcvb88zxvsIEZzBvcV4hYYyQsiP4Jt9YPbyAycgcytM2qn4G/moz9qMpYnkaZK0CIv8y9cKQk72JqkYqAZVi1GmlAxXVGX3DdWHYGKwDurSLBxrb1yLRDo/ftTxkflpQyxW5lyhTJ97vm+azYNneWiCJ+HtxtICnCeTZ/wH0m9yaQHHNAEJ6X+ZGHeINLtLpIiIusP2JrwxspJyLyyzVL+WttY3kabe74xCNFBMd+xXDcl2MTfinBcqPggP5Kfe+bqimTomTwWkg8tPaNjLC3bX5CxtKljjqxViGzyfFrFfTFB/3GK3w9zTvd49eyobCsNGPvlCl1ziKeGWQwxI2sYWx2QamwsFWWcQfO4hbM9EgNLIiaK1zrofGRy8PQ34o1mmf+Hyz5/nub9Kprh4qVS4WzBR6SFEOLVv3hze7zYOiAFTDqveUQ03829O0yDJrYm8+Lr9+/AztOn1SxHPNy/xoqklxEi9qAo7kPq0rGvcIBaOIah3s0yDOZO/rro6rIxDP1Pi1rIBKABb3tiIqCw0fzL38GmvKbuMUyOoMODmf9Ct8d3l3CsfpByR9Pu4KbXg5zhjxBUZlSp8yPPoF7NIhwWG5jb5/h16kbltBrShLw+K4SCvOVCYt2no7HslWg7e9iW5fWcxVNvIGmGVMRGYEoO4zmykLhsBx3heTk4VSgW+lENSObQ8n9POSOHUEi90L97dHOlQKtXg9FFSVwu+A+XLmbx5Tp2F1qhvr7d7Ezb+MhBPjD8tdbNA+SSGSgYwmUGpFwo7AczuYX/an/iEdM6B3qKqbZAbguIKJQEZEosYSLi3efzsKyVZxd3/V1Cc0FisQMGsMAUqkBXfXoqgXChjlgF/LAfCiLOXfuQ5G2tDRcY5CGaRhxO41R4qJlRJSaEZVrjOLbapY6Z9BASkJswn18Sw2CVqx/t5ghncoZElQsBTqm8u+X3A0UaRm48gcD8D/XZskfp8IFSwAAAABJRU5ErkJggg==")}.msp-plugin .msp-plugin-content{color:#332b1f}

`;pZe(hZe);var tee=function(t){var r=t.useInterface,n=t.pdbId,a=t.url,i=t.file,o=t.dimensions,s=t.className,u=t.showControls,l=t.showAxes,c=ke.exports.useRef(null),d=ke.exports.useRef(null),f=ke.exports.useRef(null);ke.exports.useEffect(function(){return VB(regeneratorRuntime.mark(function v(){var g,y;return regeneratorRuntime.wrap(function(S){for(;;)switch(S.prev=S.next){case 0:if(!r){S.next=8;break}return g=GQ(),g.layout={initial:{isExpanded:!1,controlsDisplay:"reactive",showControls:u}},S.next=5,fZe(c.current,g);case 5:f.current=S.sent,S.next=12;break;case 8:return f.current=new eee(IQ()),f.current.initViewer(d.current,c.current),S.next=12,f.current.init();case 12:return l||(y=f.current.canvas3d)===null||y===void 0||y.setProps({camera:{helper:{axes:{name:"off",params:{}}}}}),S.next=15,p(n,a,i,f.current);case 15:case"end":return S.stop()}},v)}))(),function(){return f.current=null}},[]),ke.exports.useEffect(function(){p(n,a,i,f.current)},[n,a,i]),ke.exports.useEffect(function(){if(f.current)if(l){var g;(g=f.current.canvas3d)===null||g===void 0||g.setProps({camera:{helper:{axes:M.getDefaultValues(Cb).axes}}})}else{var v;(v=f.current.canvas3d)===null||v===void 0||v.setProps({camera:{helper:{axes:{name:"off",params:{}}}}})}},[l]);var p=function(){var v=VB(regeneratorRuntime.mark(function g(y,b,S,x){var C,w,_,E,P,D;return regeneratorRuntime.wrap(function(F){for(;;)switch(F.prev=F.next){case 0:if(!x){F.next=26;break}if(x.clear(),!S){F.next=13;break}return F.next=5,x.builders.data.rawData({data:S.filestring});case 5:return C=F.sent,F.next=8,x.builders.structure.parseTrajectory(C,S.type);case 8:return w=F.sent,F.next=11,x.builders.structure.hierarchy.applyPreset(w,"default");case 11:F.next=26;break;case 13:if(_=b||(y?"https://files.rcsb.org/view/".concat(y,".cif"):null),_){F.next=16;break}return F.abrupt("return");case 16:return F.next=18,x.builders.data.download({url:_},{state:{isGhost:!0}});case 18:return E=F.sent,P=_.split(".").pop().replace("cif","mmcif"),P.includes("?")&&(P=P.substring(0,P.indexOf("?"))),F.next=23,x.builders.structure.parseTrajectory(E,P);case 23:return D=F.sent,F.next=26,x.builders.structure.hierarchy.applyPreset(D,"default");case 26:case"end":return F.stop()}},g)}));return function(y,b,S,x){return v.apply(this,arguments)}}(),h=o?o[0]:"100%",m=o?o[1]:"100%";return r?sa.createElement("div",{style:{position:"absolute",width:h,height:m,overflow:"hidden"}},sa.createElement("div",{ref:c,style:{position:"absolute",left:0,top:0,right:0,bottom:0}})):sa.createElement("div",{ref:c,style:{position:"relative",width:h,height:m},className:s||""},sa.createElement("canvas",{ref:d,style:{position:"absolute",top:0,left:0,right:0,bottom:0}}))};tee.propTypes={useInterface:tf.bool,pdbId:tf.string,url:tf.string,file:tf.object,dimensions:tf.array,showControls:tf.bool,showAxes:tf.bool,className:tf.string};const mZe=()=>B("div",{children:B(tee,{pdbId:"2pnc"})}),vZe=()=>B(mZe,{}),gZe=document.getElementById("root"),yZe=dH(gZe);yZe.render(B(ke.exports.StrictMode,{children:B(q0e,{children:B(nne,{children:B(vZe,{})})})}));
//# sourceMappingURL=index.5fdfd73c.js.map
